!function(a){"use strict";var b,c=function(){var a={};return $.extend(a,zmText.get("attachmentUtility"),zmText.get("attachComponent"),!0),a}();return function(){var a=Boolean(window.chrome)&&Boolean(window.chrome.webstore),d=Boolean(window.opr)&&Boolean(window.opr.addons)||Boolean(window.opera)||navigator.userAgent.indexOf(" OPR/")>=0,e=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;b=a||d||e?zmText.applyArgs(c.desktopMsg,{command:"ctrl+v"}):c.desktopMsgWithoutPaste}(),a.templates=a.templates||{},$.extend(a.templates,{docsOption:['<div class="SC_frt">'+c.label.insertAs+'<div data-readval="write" data-read="'+c.button.asAttach+'" data-write="'+c.button.asLink+'" class="SC_rwToggle attToggTemp"></div></div>'],docinsertAs:['<label style="padding-right:4px;padding-top:5px;float: right">'+c.label.insertAs+"</label>"],dragdropArea:['<div class="SC_drop SC_dropW100"><div class="SC_drag wht" style="height:100%;top:0"><span>'+b+"</span></div></div>"].join(""),dropMsgTemplate:['<div style="display:none; height: 100%; width: 100%; left: 0px; top: 0px; position: absolute;">','<div class="SC_drag" style="height:70%"><span>'+c.dropMsg+"</span></div></div>"].join(""),filterInfo:['<font class="SC_lnk" style="display:none"></font>'].join(""),cloudFrame:'<iframe frameborder="0" id="cloudIframe" style="height:100%;width:100%"></iframe>',browseInputEle:function(a,b){return'<input type="file" id="'+a+'" name="'+b+'" style="visibility:hidden;width:1px;height:1px">'},canvasTextArea:['<div style="position: absolute">','<textarea style="height:100px;width: 250px"></textarea>','<div class="SC_PUbtm" id="gpcrt">','<span id="zmTextDone" class="sel">'+c.button.done+"</span>",'<span id="zmTextCancel" class="sel" data-val="Cancel">'+c.button.cancel+"</span>","</div>","</div>"].join(""),colorPallete:['<div id="zmAnnonate_Color" class="SC_PUcen"style="position:absolute;background-color: white;border: 1px solid #017FBE;display:none;padding-top:10px;padding-left:10px;border-radius: 10px">',"<div>","<ul>","<li>",'<ul class="SC_cp">',"<li>",'<div style="background-color:#e5e5e5"></div>','<div style="background-color:#f9baab"></div>','<div style="background-color:#f9d3a2"></div>','<div style="background-color:#fef86a"></div>','<div style="background-color:#d7f3b0"></div>','<div style="background-color:#c8e5fb"></div>','<div style="background-color:#e0ceef"></div>','<div style="background-color:#f6d0e6"></div>','<div style="background-color:#c4c4c4"></div>','<div style="background-color:#e07861"></div>','<div style="background-color:#ecb772"></div>','<div style="background-color:#f6e565"></div>','<div style="background-color:#badf88"></div>','<div style="background-color:#96ccf5"></div>','<div style="background-color:#b99fce"></div>','<div style="background-color:#e099c2"></div>','<div style="background-color:#808080"></div>','<div id="zmAnnotate_selColor" class="sel" style="background-color:#ce232c"></div>','<div style="background-color:#dd902f"></div>','<div style="background-color:#d0c04b"></div>','<div style="background-color:#90ca40"></div>','<div style="background-color:#70abec"></div>','<div style="background-color:#a97ac6"></div>','<div style="background-color:#c26a9d"></div>','<div style="background-color:#000000"></div>','<div style="background-color:#9d1812"></div>','<div style="background-color:#a56016"></div>','<div style="background-color:#a69646"></div>','<div style="background-color:#5b8828"></div>','<div style="background-color:#4c76a2"></div>','<div style="background-color:#8343a0"></div>','<div style="background-color:#ba3682"></div>',"</li>","</ul>","</li>","</ul>","</div>","</div>"].join(""),leftHeaderHtml:['<div class="SC_flt"></div>'].join(""),docsTab:['<b id="attachFromDocs">'+c.cloudServiceName.zDocs+"</b>"].join(""),cloudTab:['<b id="attachFromCloud">'+c.cloudServiceName.otherCloud+"</b>"].join(""),desktopTab:['<b id="zmDesktop">'+c.cloudServiceName.desktop+"</b>"].join(""),dragtheme:['<div style="height:3px" class="dragtheme"></div>'],desktopListTemplate:['<div class="zmL zmAch SC_mlst">','<div class="zmLst">','<div draggable="true" class="zmFlt"><i class="msi-drag"></i></div>','<div class="zmDtl">','<div class="zmDate">',"<span></span>","</div>",'<div class="zmImg"></div>','<div class="zmSze">','<span class="sum Sc_lnk">'+c.UserMsg.download+"</span>","</div>",'<div class="zmFdr">',"<span></span>","</div>",'<div class="zmFrm">',"<div>",'<span contentEditable="true" id="listView"></span>',"</div>","</div>",'<div class="zmSub">','<span id="zmSubView" class="sum SC_thm">'+c.attachTemplateText.view+"</span>",'<span id="zmSubAnnotate" class="sum SC_thm">'+c.attachTemplateText.annotate+"</span>",'<span id="zmSubDownload" class="sum SC_thm">'+c.attachTemplateText.download+"</span>",'<span id="zmSubRemove" class="sum SC_thm">'+c.attachTemplateText.remove+"</span>",'<span id="zmWrnMsg" class="sum"></span>',"</div>",'<div class="SC_icn"></div>','<div class="zm_lbl"></div>',"</div>",'<div class="zmFrt"></div>',"</div>","</div>"].join(""),annonateBox:function(){var a=c.annotatebox.title,b=[["DIV",{attrs:{id:"zmAnnonateBox","class":"SC_Pop blk SC_cent tempAttPop"},child:[["DIV",{attrs:{"class":"SC_pe"},child:[["DIV",{attrs:{id:"sand","class":"SC_oh"},child:[["DIV",{attrs:{id:"zmCanvasCont",style:"overflow: auto;position:relative"},child:[["CANVAS",{attrs:{id:"zmCanvas"}}],["CANVAS",{attrs:{id:"zmtempCanvas",style:"position:absolute;top:0px;left:0px;"}}]]}],["DIV",{attrs:{"class":"SC_PUbtm",id:"gpcrt",style:"display:none"},child:[["SPAN",{attrs:{id:"zmImgEditDone","class":"sel"},child:[["text",c.button.done]]}],["SPAN",{attrs:{id:"zmImgEditCancel","class":"sel","data-val":"Cancel"},child:[["text",c.button.cancel]]}]]}]]}],["DIV",{attrs:{id:"lightnav"},child:[["DIV",{attrs:{"class":"At_nme"}}],["DIV",{attrs:{"class":"At_cls"},child:[["I",{attrs:{"class":"msi-close",iscancel:"true"}}]]}]]}]]}],["DIV",{attrs:{"class":"SC_tool",style:"left:-40px"},child:[["UL",{child:[["LI",{attrs:{"class":"sc_tb_hd"}}],["LI",{attrs:{id:"zmAttUndo",title:a.undo},child:[["I",{attrs:{"class":"msi-undo"}}]]}],["LI",{attrs:{id:"zmAttRedo",title:a.redo},child:[["I",{attrs:{"class":"msi-redo"}}]]}]]}],["UL",{child:[["LI",{attrs:{id:"zmAttSquare",title:a.square},child:[["I",{attrs:{"class":"msi-box"}}]]}],["LI",{attrs:{id:"zmAttHide",title:a.mask},child:[["I",{attrs:{"class":"msi-mask"}}]]}]]}],["UL",{child:[["LI",{attrs:{id:"zmAttCircle",title:a.circle},child:[["I",{attrs:{"class":"msi-ellipse"}}]]}],["LI",{attrs:{id:"zmAttLine",title:a.line},child:[["I",{attrs:{"class":"msi-line"}}]]}],["LI",{attrs:{id:"zmAttPen",title:a.pen},child:[["I",{attrs:{"class":"msi-pen"}}]]}]]}],["UL",{child:[["LI",{attrs:{id:"zmAttCrop",title:a.crop},child:[["I",{attrs:{"class":"msi-crop"}}]]}],["LI",{attrs:{id:"zmAttText",title:a.text},child:[["I",{attrs:{"class":"msi-text"}}]]}],["LI",{attrs:{id:"zmAttColor",title:a.color},child:[["I",{attrs:{"class":"msi-nclr"}}]]}],["LI",{attrs:{"class":"sc_tb_hd"}}]]}]]}]]}]];return $(_zm.getDOM(b))},cloudAttTempLoadingBox:['<div class="zmL SC_Pbar" id="attloading">','<div class="zmLst">','<div class="zmDtl">','<div class="zmSze">','<span class="sum">&nbsp;</span>',"</div>",'<div class="zmSub">','<span data-name="rename">'+c.UserMsg.rename+"</span>",'<span data-name="download">'+c.UserMsg.download+"</span>",'<i class="msi-action" title="'+c.UserMsg.more+'" data-name="showMore"></i>',"</div>",'<div class="zmFrm">','<span data-name="filename"></span>',"</div>",'<div class="zmImg">','<i class="msi-attothers SC_big"></i>',"</div>",'<div class="SC_icn">','<i class="msi-close"></i>',"</div>",'<div class="zm_lbl">','<div id="progressbar" style="width:0%"></div>',"</div>","</div>","</div>","</div>"].join(""),attachFromPopup:['<div class="SC_Pop SC_cent SC_add wht" id="zmAttachCompWhtPopup">','<div class="SC_pe">','<div class="SC_PU" style="max-width:1000px;">','<div class="SC_PUcen">','<div class="SCmc SC_attachviewer">','<div class="SC_mhd">','<div class="SC_flt">','<span id="zmACTabContainer" class="SC_mtb"></span>',"</div>","</div>",'<div class="SCmb">','<div class="SC_frt">',"<ul>",'<li style="display:none;" class="zmAttCompHideThis">','<b><span><i class="msi-filter"></i></span></b>',"</li>",'<li style="display:none;" class="zmAttCompHideThis">','<b class="SC_sel"><span><i class="msi-thumbview"></i></span></b>',"</li>",'<li style="display:none;" class="zmAttCompHideThis">','<b><span><i class="msi-listview"></i></span></b>',"</li>","<li>",'<b><span><i class="msi-close"></i></span></b>',"</li>","</ul>","</div>",'<div class="SC_flt"></div>',"</div>",'<div style="display:none;" class="SC_mclst SC_ren" id="zmattDesktop"></div>','<div id="zmattViewBrowse" class="SC_drop" style="width:100%"><span>'+zmText.applyArgs(c.desktopMsg,{command:"ctrl+v"})+"</span></div>",'<div id="zmattImport" style="display:none; height: 100%; width: 100%;left: 0px; top: 0px; position: absolute;"><div class="SC_drag" style="height:70%"><span>'+c.dropMsg+"</span></div></div>",'<div class="SC_mclst" id="zmattView"></div>','<div class="SC_mclst" id="zmMyDocs" style="display:none"></div>','<div class="SC_mclst" id="zmMyCloud" style="display:none;overflow:hidden"></div>',"</div>","</div>",'<div class="SC_PUbtm">','<span id="zmattViewAttach" class="sel">'+c.button.attach+"</span>",'<span id="zmattViewCancel" data-val="Cancel">'+c.button.cancel+"</span>",'<span id="zmattViewAsAtt" style="float:right" class="SC_vh">'+c.button.asAttach+"</span>",'<span id="zmattViewAsLink" style="float:right" class="SC_vh" data-val="Cancel">'+c.button.asLink+"</span>","</div>","</div>","</div>","</div>"].join(""),insertImageLoading:['<div id="progressbar" style="display: none" class="upldProgBar">','<div id="progressIndicator"></div>',"</div>"].join(""),insertImageMaskBtn:['<div id="blkMaskWthBtn" class="blkMask" style="opacity:0; display:none">','<div class="blkMaskBtn" style="left: 38%;">'+c.attachTemplateText.annotate+"</div>",'<div class="blkMaskBtn" style="left: 48%;">'+c.attachTemplateText.remove+"</div></div>"].join(""),blackMask:["<div id='uploadMask' style='display:none' class='blkMask'></div>"].join(""),selectedFile:['<span class="SC_fileSel"><span data-name="filename"></span><i class="msi-close"></i></span>'].join("")},!0),a}(window.zmAttachment=window.zmAttachment||{}),function(a){"use strict";a.utility=a.utility||{};var b=function(){var a={};return $.extend(a,zmText.get("attachmentUtility"),zmText.get("attachComponent"),!0),a}();return a.utility.setDragDrop=function(){function a(a){this.$centerEle=a.$centerEle,this.$dropMsgEle=a.$dropMsgEle,this.onDrop=a.onDrop,this.onDragover=a.onDragover,this.onDragLeave=a.onDragLeave,this.isDragOver=!1,this.eventIdentifier="",a.eventIdentifier&&(this.eventIdentifier="."+a.eventIdentifier),a.preventDefaultErrorHandler&&(this.preventDefaultErrorHandler=!0)}function c(a){var c,d,e;if(Array.isArray(a)){e=a.length,1===e?(c=a[0],d='<div class="SC_PUmsg">'+zmText.applyArgs(b.desktop.folderDropErr1,{folderName:c})+"</div>"):d=2===e?'<div class="SC_PUmsg">'+zmText.applyArgs(b.desktop.folderDropErr2,{folderName1:a[0],folderName2:a[1]})+"</div>":'<div class="SC_PUmsg">'+zmText.applyArgs(b.desktop.folderDropErrN,{folderName1:a[0],number:e-1})+"</div>";var f={title:b.desktop.folderDropDialogTitle,$content:d,buttons:[{name:b.button.ok,callback:function(a){a.remove()}}]};Dialog["new"](f)}}return a.prototype.init=function(){this.bindDropListener(),this.bindDragOver(),this.bindDragLeave()},a.prototype.getFiles=function(a){var b,c,d,e=[],f=[];if(a)if(b=a.items)if(c=b.length,c&&"function"==typeof b[0].webkitGetAsEntry)for(d=0;d<c;d++)b[d].webkitGetAsEntry().isFile?e.push(b[d].getAsFile()):f.push(b[d].getAsFile().name);else a.files&&(e=a.files);else a.files&&(e=a.files);return{files:e,directories:f}},a.prototype.bindDropListener=function(){var a=this;this.$centerEle.on("drop"+this.eventIdentifier,function(b){var d,e,f;return b.preventDefault(),a.isDragOver=!1,d=b.originalEvent.dataTransfer,f=d&&d.files,e=a.getFiles(d),f=e.files,!a.preventDefaultErrorHandler&&e.directories.length&&c(e.directories),f&&f.length?a.onDrop(f,a.$centerEle):"function"==typeof a.onDragLeave&&a.onDragLeave(),!1})},a.prototype.bindDragOver=function(){var a=this;this.$centerEle.on("dragover"+this.eventIdentifier+" dragenter"+this.eventIdentifier,function(b){var c=b.originalEvent.dataTransfer;if(b.preventDefault(),!a.isDragOver)return b&&"dragover"===b.type&&(a.isDragOver=!0),(null!==c.types||c.files&&c.files.length>0)&&(c.files&&c.files.length>0||(c.types.indexOf?c.types.indexOf("Files")!==-1:c.types.contains("application/x-moz-file"))||c.types.length&&"Files"===c.types[0])&&(c.dropEffect="copy","function"==typeof a.onDragover?a.onDragover():a.$dropMsgEle.hasClass("SC_dropW100")||a.$dropMsgEle.addClass("SC_dropW100").attr("centerover",!0)),!1})},a.prototype.bindDragLeave=function(){var a=this;this.$dropMsgEle.on("dragleave"+this.eventIdentifier,function(b){return b.preventDefault(),"function"==typeof a.onDragLeave&&a.isDragOver&&(a.isDragOver=!1,a.onDragLeave()),!1})},function(b){var c=new a(b);c.init()}}(),a.utility.createObjectURL=function(b,c){var d;if(window.URL=window.URL||window.webkitURL,window.URL&&b)return d=window.URL.createObjectURL(b),c&&window.setTimeout(function(){a.utility.revokeObjectURL(d)},c),d},a.utility.revokeObjectURL=function(a){window.URL=window.URL||window.webkitURL,window.URL&&a&&window.URL.revokeObjectURL(a)},a.utility.isFunction=function(a){return"function"==typeof a},a.utility.isChrome=function(){return Boolean(window.chrome)&&Boolean(window.chrome.webstore)},a.utility.isOpera=function(){return Boolean(window.opr)&&Boolean(window.opr.addons)||Boolean(window.opera)||navigator.userAgent.indexOf(" OPR/")>=0},a.utility.isFirefox=function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1},a.utility.filterMyAttachmentKey=function(a){var b={};return b.e=a.e,b.et=a.et,b.Id=a.Id,b.ft=a.ft,a.n&&(b.n=a.n),a.sid?b.groupId=a.sid:a.gId&&(b.groupId=a.gId),(a.sid||a.gId&&a.gId!==zmail.zuid)&&(b.streamsView=!0),b},a.utility.renameHelper=function(){function b(b){var c=this.config;60===b.which||62===b.which?b.preventDefault():13===b.which&&(b.preventDefault(),c.$ele.trigger("blur")),a.utility.isFunction(c.onKeypress)&&c.onKeypress(b)}function c(a){a.preventDefault()}function d(b){var c,d=this.config,e=d.$ele,f=e.closest("."+d.parentClass),g=d.orginalFileName,h=g.lastIndexOf(".");27===b.which?(b.preventDefault(),c=h!==-1?g.substring(0,h):g,e.text(c),e.blur()):c=e.text(),c&&c.length&&(h!==-1&&(c+=g.substring(h,g.length)),f.attr("title",_zm.escapeTags(c)),a.utility.isFunction(d.onChange)&&d.onChange.call(d.context||null,c,d.handbackData)),a.utility.isFunction(d.onKeyup)&&d.onKeyup(b)}function e(b){var c,d=this.config,e=d.$ele,f=d.orginalFileName,g=f.lastIndexOf(".");"true"===e.attr("contenteditable")&&(c=e.text(),c&&c.length?g!==-1&&(c+=f.substring(g,f.length)):c=f,e.text(zmUtil.getSubString(20,c)).attr("contenteditable",!1),this.config.orginalFileName=c,a.utility.isFunction(d.onBlur)&&d.onBlur(b))}function f(){var a=this.config.$ele;a.on("keypress",b.bind(this)),a.on("paste",c),a.on("keyup",d.bind(this)),a.blur(e.bind(this))}function g(a,b){"true"!==a.attr("contenteditable")&&(a.attr("contenteditable",!0),window.setTimeout(function(){var c,d,e,f;a.focus(),e=b.attr("title"),f=e.lastIndexOf("."),f!==-1&&a.text(e.substring(0,f)),document.createRange?(c=document.createRange(),c.selectNodeContents(a[0]),c.collapse(!1),d=window.getSelection(),d.removeAllRanges(),d.addRange(c)):document.selection&&(c=document.body.createTextRange(),c.moveToElementText(a[0]),c.collapse(!1),c.select())},10))}function h(a){a&&a.constructor===Object?(this.config=a,f.call(this)):zmUtil.debugLog("Rename attachment: Invalid config")}return{init:function(a){return new h(a)},onRenameAction:g}}(),a}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){"use strict";function b(){var a={allowDefaultScope:!1,shortcuts:[{uid:"close",keyStr:"esc",actions:[function(){S()}]}],scope:"imageAnnotate"};N=zmComponent.keybindings.getScope(),zmComponent.keybindings.registerAll(a),zmComponent.keybindings.setScope("imageAnnotate")}function c(a,b,c,d,e,f){for(var g=b.split("\n"),h=0,i=g.length;h<i;h++){for(var j="",k=g[h].split(" "),l=0,m=k.length;l<m;l++){var n=j+k[l]+" ",o=a.measureText(n),p=o.width;p>e?(a.fillText(j,c,d),j=k[l]+" ",d+=f):j=n}a.fillText(j,c,d),d+=f}}function d(a,b){var c=b.offset(),d=b.position(),e=a.clientX,f=a.clientY,g=e-c.left+d.left,h=f-c.top+d.top,i=$("#zmAnnonateBox #zmCanvasCont");return g+=i.scrollLeft(),h+=i.scrollTop(),{realX:g,realY:h}}function e(a,b){var c=d(a,b),e=$("#zmCanvasCont"),f=e.height(),g=e.width(),h=e[0].scrollHeight,i=e[0].scrollWidth,j=e[0].scrollTop,k=e[0].scrollLeft,l=35,m=35;h>f&&(c.realY+l>f&&j+f<h?e.scrollTop(j+m):j>0&&c.realY-l<j&&e.scrollTop(j-m)),i>g&&(c.realX+l>g&&k+g<i?e.scrollLeft(k+m):k>0&&c.realX-l<k&&e.scrollLeft(k-m))}function f(){Q.undoList.length?$("#zmAttUndo").addClass("sel"):$("#zmAttUndo").removeClass("sel"),Q.redoList.length?$("#zmAttRedo").addClass("sel"):$("#zmAttRedo").removeClass("sel")}function g(a){var b=document.createElement("canvas"),c=$("#zmCanvas")[0];b.height=c.height,b.width=c.width,b.getContext("2d").drawImage(c,0,0),a.push(b),f()}function h(a,b){a.getContext("2d").drawImage(b,0,0),b.getContext("2d").clearRect(0,0,b.width,b.height)}function i(a){Q.isDragging=!1;var b=$("#zmtempCanvas"),c=$("#zmCanvas")[0];b.off("mousemove.zmAttWidget"),b.off("mouseup.zmAttWidget"),b.off("mouseleave.zmAttWidget"),g(Q.undoList),a&&a(),h(c,b[0])}function j(a){var b=$("#zmCanvas")[0],c=b.getContext("2d"),d=$("#zmtempCanvas")[0],e=d.getContext("2d");c.beginPath(),c.clearRect(0,0,b.width,b.height),b.width=a.width,b.height=a.height,e.clearRect(0,0,d.width,d.height),d.width=a.width,d.height=a.height,c.drawImage(a,0,0)}function k(){if(Q.undoList.length){var a=Q.undoList[Q.undoList.length-1];g(Q.redoList),j(a),Q.undoList.pop(),f()}}function l(){if(Q.redoList.length){var a=Q.redoList[Q.redoList.length-1];g(Q.undoList),j(a),Q.redoList.pop(),f()}}function m(a,b){var e,f,g,h,j=d(a,b),k=j.realY,l=j.realX,m=$("#zmAnnonateBox"),n=m.find("#zmtempCanvas"),o=n.height(),p=n.width(),q="bold 14px sans-serif";o>=60&&k+50>o&&(k=o-60),p>=210&&l+200>p&&(l=p-210),f=p-l-20,g=o-k-20;var r=function(a){var b=n[0],d=b.getContext("2d"),g=parseFloat(e.css("left")),h=parseFloat(e.css("top"))+15;d.beginPath(),d.fillStyle=Q.selectedColor,d.font=q,d.textBaseline="bottom",c(d,a,g,h,f,16),d.closePath(),i()};$("#zmCanvTxtArea").length?(e=$("#zmCanvTxtArea"),h=e.val(),h.length&&r(h),$("#zmCanvTxtArea").remove()):(e=$("<textarea style='width: 200px; position: absolute;'></textarea>"),e.attr("id","zmCanvTxtArea").css({top:k,left:l}),e.css({"max-width":f,"max-height":g,border:"none",color:Q.selectedColor,font:q}),m.find("#zmCanvasCont").append(e),e.focus(),e.on("change keyup",function(){zmail.Utils.TextAreaResizer.resize(this,{maxHeight:g,maxWidth:f})}))}function n(a){var b=a.find("#zmAnnonate_Color");b.hide()}function o(a,b){b.find(".SC_tool").find("li").removeClass("sel"),a.addClass("sel")}function p(a){var b=$("#zmAnnonateBox"),c=b.find("#zmtempCanvas");a.cursorType&&c.css("cursor",a.cursorType),a.offEvents&&c.off(a.offEvents),a.onEvents&&c.on(a.onEvents,function(c){c.preventDefault(),n(b),a.onCallback&&a.onCallback(c,$(this))})}function q(a){Q.startX=a.realX,Q.startY=a.realY,Q.stopX=Q.startX,Q.stopY=Q.startY,Q.isDragging=!0}function r(a){Q.stopX=a.realX,Q.stopY=a.realY}function s(a){var b=$("#zmtempCanvas"),c=b[0].getContext("2d"),d=Q.stopX-Q.startX,e=Q.stopY-Q.startY,f=5;c.clearRect(0,0,b[0].width,b[0].height),c.beginPath(),c.rect(Q.startX,Q.startY,d,e),c.lineWidth=f,a?(a.lineWidth&&(c.lineWidth=a.lineWidth),a.strokeStyle&&(c.strokeStyle=a.strokeStyle),a.fillStyle&&(c.fillStyle=a.fillStyle,c.fill()),a.setLineDash&&c.setLineDash&&(c.setLineDash(a.setLineDash),c.lineDashOffset=2)):c.strokeStyle=Q.selectedColor,c.stroke()}function t(a,b){a.preventDefault(),Q.isDragging&&(r(d(a,b)),s(),e(a,b))}function u(a){var b={};b.strokeStyle=a,b.fillStyle=a,s(b)}function v(a,b){Q.isDragging&&(r(d(a,b)),u(Q.selectedColor),e(a,b))}function w(a,b){var c,e=$("#zmtempCanvas");e.on("mousemove.zmAttWidget",function(a){a.preventDefault(),t(a,$(this))}),e.on("mouseup.zmAttWidget mouseleave.zmAttWidget",function(a){a.preventDefault(),i()}),c=d(a,b),q(c),s()}function x(a,b){var c,e=$("#zmtempCanvas");e.on("mousemove.zmAttWidget",function(a){a.preventDefault(),v(a,$(this))}),e.on("mouseup.zmAttWidget mouseleave.zmAttWidget",function(a){a.preventDefault(),i()}),c=d(a,b),q(c),u(Q.selectedColor)}function y(){var a,b,c,d,e=$("#zmtempCanvas"),f=e[0].getContext("2d"),g=Math.abs(Q.stopX-Q.startX),h=Math.abs(Q.stopY-Q.startY);f.clearRect(0,0,e[0].width,e[0].height),f.beginPath(),f.ellipse?f.ellipse(Q.stopX,Q.stopY,g,h,0,0,2*Math.PI):(b=Math.max(g,h),c=g/b,d=h/b,a=g>h?g:h,f.save(),f.translate(Q.stopX,Q.stopY),f.scale(c,d),f.beginPath(),f.arc(0,0,a,0,2*Math.PI,!1),f.restore()),f.lineWidth=5,f.strokeStyle=Q.selectedColor,f.stroke()}function z(a,b){Q.isDragging&&(r(d(a,b)),y(),e(a,b))}function A(a,b){var c,e=$("#zmtempCanvas");e.on("mousemove.zmAttWidget",function(a){a.preventDefault(),z(a,$(this))}),e.on("mouseup.zmAttWidget mouseleave.zmAttWidget",function(a){a.preventDefault(),i()}),c=d(a,b),q(c),y()}function B(){var a=$("#zmtempCanvas")[0];if(a.getContext){var b=a.getContext("2d");b.beginPath(),b.strokeStyle=Q.selectedColor,b.clearRect(0,0,a.width,a.height),b.moveTo(Math.floor(Q.startX),Math.floor(Q.startY)),b.lineTo(Math.floor(Q.stopX),Math.floor(Q.stopY)),b.lineWidth=5,b.lineJoin="round",b.lineCap="round",b.fillStyle=Q.selectedColor,b.stroke(),b.closePath()}}function C(a,b){Q.isDragging&&(r(d(a,b)),B(),e(a,b))}function D(a,b){var c,e=$("#zmtempCanvas");e.on("mousemove.zmAttWidget",function(a){a.preventDefault(),C(a,$(this))}),e.on("mouseup.zmAttWidget mouseleave.zmAttWidget",function(a){a.preventDefault(),i()}),c=d(a,b),q(c),B()}function E(a,b){if(Q.isDragging){var c=$("#zmtempCanvas"),f=c[0].getContext("2d"),g=d(a,b);g.realY+=P,r(g),f.lineTo(Q.stopX,Q.stopY),f.stroke(),e(a,b)}}function F(a,b){var c,e=$("#zmtempCanvas"),f=e[0].getContext("2d");e.on("mousemove.zmAttWidget",function(a){a.preventDefault(),E(a,$(this))}),e.on("mouseup.zmAttWidget mouseleave.zmAttWidget",function(a){a.preventDefault(),f.closePath(),i()}),c=d(a,b),c.realY+=P,f.beginPath(),f.lineWidth=2,f.shadowBlur=1,f.strokeStyle=Q.selectedColor,q(c),f.moveTo(Q.startX,Q.startY)}function G(){var a=$("#zmtempCanvas"),b=a[0].getContext("2d"),c={},d={};Q.startX<Q.stopX?(c.startX=Q.startX,c.stopX=Q.stopX):(c.startX=Q.stopX,c.stopX=Q.startX),Q.startY<Q.stopY?(d.startY=Q.startY,d.stopY=Q.stopY):(d.startY=Q.stopY,d.stopY=Q.startX),b.clearRect(0,0,a[0].width,a[0].height),a[0].width=Math.abs(Q.startX-Q.stopX),a[0].height=Math.abs(Q.startY-Q.stopY),b.drawImage($("#zmCanvas")[0],c.startX,d.startY,Math.abs(c.startX-c.stopX),Math.abs(d.startY-d.stopY),0,0,Math.abs(c.startX-c.stopX),Math.abs(d.startY-d.stopY))}function H(a,b){Q.isDragging&&(r(d(a,b)),s({setLineDash:[2,5],strokeStyle:"Black",lineWidth:2}),e(a,b))}function I(a,b){var c,e=$("#zmtempCanvas");e.on("mousemove.zmAttWidget",function(a){a.preventDefault(),H(a,$(this))}),e.on("mouseup.zmAttWidget mouseleave.zmAttWidget",function(a){a.preventDefault(),Math.abs(Q.startX-Q.stopX)?(G(),i(function(){$("#zmCanvas")[0].getContext("2d").clearRect(0,0,$("#zmCanvas")[0].width,$("#zmCanvas")[0].height),$("#zmCanvas")[0].width=Math.abs(Q.startX-Q.stopX),$("#zmCanvas")[0].height=Math.abs(Q.startY-Q.stopY)})):(e.off("mousemove.zmAttWidget"),e.off("mouseup.zmAttWidget"),e.off("mouseleave.zmAttWidget"))}),c=d(a,b),q(c),s({setLineDash:[2,5],strokeStyle:"Black",lineWidth:2})}function J(a){var b=a.target||a.srcElement,c=b.className,d=$("#zmAnnonateBox"),e=$(b),g=e.parent(),h={cursorType:"crosshair",offEvents:"mousedown click",onEvents:"mousedown"};switch(c){case"msi-undo":k();break;case"msi-redo":l();break;case"msi-box":o(g,d),h.onCallback=w,h.cursorType="url("+zmail.imgPath+"rectangle.png), crosshair",p(h);break;case"msi-mask":o(g,d),h.onCallback=x,h.cursorType="url("+zmail.imgPath+"blackout.png), crosshair",p(h);break;case"msi-ellipse":o(g,d),h.onCallback=A,h.cursorType="url("+zmail.imgPath+"circle.png), crosshair",p(h);break;case"msi-line":o(g,d),h.onCallback=D,h.cursorType="url("+zmail.imgPath+"line.png), crosshair",p(h);break;case"msi-pen":o(g,d),h.onCallback=F,h.cursorType="url("+zmail.imgPath+"pen.png), auto",p(h);break;case"msi-crop":o(g,d),h.onCallback=I,h.cursorType="url("+zmail.imgPath+"crop.png), crosshair",p(h);break;case"msi-text":o(g,d),h.onCallback=m,h.offEvents="mousedown mousemove mouseup",h.onEvents="click",h.cursorType="auto",p(h);break;case"msi-nclr":var i=d.find("#zmAnnonate_Color"),j=e.offset().top-i.outerHeight()/2;i.show().css("top",j);break;default:o($("#zmAttSquare"),d),h.onCallback=w,h.cursorType="url("+zmail.imgPath+"rectangle.png), crosshair",p(h)}f()}function K(a){var b=a.find(".SC_tool");Q.selectedColor=a.find("#zmAnnotate_selColor")[0].style.backgroundColor,b.on("click",J),a.find("#zmAnnonate_Color .SC_cp").find("div").on("click",function(){a.find("#zmAnnotate_selColor").removeAttr("id").removeClass("sel"),$(this).addClass("sel").attr("id","zmAnnotate_selColor"),Q.selectedColor=$(this)[0].style.backgroundColor}),b.click()}function L(b){window.URL=window.URL||window.webkitURL;var c,d=new Image,e=$("#zmAnnonateBox"),f=e.find("#zmCanvasCont");$(d).css({visibility:"hidden"}),$("body").append(d),c=b.source?b.source:a.utility.createObjectURL(b),d.onload=function(){U(d),e.find(".SC_PUbtm").show(),f.find(".At_load").remove(),a.utility.revokeObjectURL(c)},f.append(zmAttachment.templates.loadingTemplate()),d.src=c}function M(){var a=$("#zmAnnonateBox");a.find("#zmCanvasCont, .SC_pe").css({"max-height":a.height()-5,"max-width":a.width()-5})}var N,O={},P=15,Q={startX:0,startY:0,stopX:0,stopY:0,isDragging:!1,undoList:[],redoList:[],selectedColor:"#ce232c"},R={};a.imageEditTool={},a.utility=a.utility||{},a.utility.dataURItoBlob=function(a){var b,c,d,e;for(b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):unescape(a.split(",")[1]),c=a.split(",")[0].split(":")[1].split(";")[0],d=new window.Uint8Array(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([d],{type:c})},O.getAnnonateAreaTemplate=function(){return zmAttachment.templates.annonateBox()},O.getColorPallete=function(){return zmAttachment.templates.colorPallete};var S=function(){$("#zmAnnonateBox").remove(),Q.undoList=[],Q.redoList=[],R.onClose&&R.onClose(),N&&zmComponent.keybindings.setScope(N)},T=function(){$("#zmAnnonateBox").on("mousedown mouseup",function(a){zmUtil.stopEvents(a,!0)})},U=function(a){var b=$("#zmCanvasCont"),c=b.find("#zmCanvas")[0],d=b.find("#zmtempCanvas")[0],e=$(a).height(),f=$(a).width(),g=c.getContext("2d");b.css("overflow","auto"),c.width=f,c.height=e,d.height=e,d.width=f,g.clearRect(0,0,f,e),g.drawImage(a,0,0,f,e),$(a).remove()};a.imageEditTool.init=function(c){var d,e=c.file,f=c.handBckObj;R=c,$("body").append(O.getAnnonateAreaTemplate()),d=$("#zmAnnonateBox"),d.append(O.getColorPallete()),b(),T(),M(),c.file?e=c.file:c.source&&(e={source:c.source}),d.find(".At_nme").text(e.name||" "),d.find(".At_cls,#zmImgEditCancel").off("click").on("click",function(){S()}),d.find("#zmImgEditDone").off("click").on("click",function(){var b,e,g;Q.undoList[0]||!R.file?(b=d.find("#zmCanvas"),e=b[0].toDataURL(),g=a.utility.dataURItoBlob(e)):g=R.file,d.remove(),c.onAttach&&c.onAttach({blob:g,handBckObj:f}),Q.undoList=[],Q.redoList=[]}),$(zmail.win).resize(function(){$("#zmAnnonateBox").length&&M()}),K($("#zmAnnonateBox")),L(e)}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){"use strict";function b(a){var b={};a.sN&&(b.aId=this.accId,b.sN=a.sN,b.fP=window.encodeURIComponent(a.fP),b.mode="d",zmAjq.XHR({u:zmail.conPath+"/attach.do",t:"POST",p:b}))}function c(){return zmail.isBaihui}function d(){return"false"!==zmail.isCloudServiceEnabled}function e(){return!zmUtil.isZohoAccount(zmail.accId)}function f(){document.body.addEventListener("paste",da)}function g(){document.body.removeEventListener("paste",da)}function h(a){return a.accId||zmUtil.getZohoAccId()}function i(a,b){var c,d={streams:"p",notes:"n",task:"t",bookmark:"l",mail:"m"},e=a.indexOf("zmEdi_")>=0;if("number"==typeof ea[a])return void("function"==typeof b&&b(ea[a]));if(e&&"number"==typeof ea.mail)return void("function"==typeof b&&b(ea.mail));if(d[a])c=d[a];else{if(!e)return;c="m"}$.ajax({url:zmail.conPath+"/attach.do",type:"POST",success:function(c){c=JSON.parse(c),"number"==typeof c.maxsize&&(e?ea.mail=c.maxsize:ea[a]=c.maxsize,"function"==typeof b&&b(c.maxsize))},data:{entity:c,mode:"maxsize",zmrcsr:zmAjq.getCookie("zmcsr")}})}function j(){var a;this.desktopAttachedSize=void 0,this.dialog=void 0,this.selectedattachUtilectsArr=[],this.desktopObj=[],this.filenameCountMap={},this.attachUtil&&(a=this.attachUtil.cache,"object"==typeof a&&a.flushExcept(this.attachUtil.appName,["l"+zmail.zuid+"all0 ","t"+zmail.zuid+"all0 "]),this.attachUtil=null)}function k(a,b){return a.filter(function(a){return a!==b})}function l(){this.isUploadCompleted()&&(this.attachTempArr.tempLocation=k(this.attachTempArr.tempLocation,void 0))}function m(a,b,c){"function"==typeof this.onAddAttachment&&this.onAddAttachment(a,b,c)}function n(a){"function"==typeof this.onRemoveAttachment&&this.onRemoveAttachment(a)}function o(a){var b;!function c(){var d=parseInt(a.find("#progressbar")[0].style.width);b&&window.clearTimeout(b),d>=90||(a.find("#progressbar")[0].style.width=d+10+"%",b=window.setTimeout(c,1e3))}()}function p(a,b,c,d){var e,f=zmUtil.isPreviewAvailable(a.fn||a.name);if(f.isPrev&&("myAttachment"===c?a.src=zmUtil.getTheSrc(f.apiName,a):a.src=zmUtil.getSrcForTempAtt(a,this.accId)),e=this.orderedListOfAttachedFile.length,b>e)for(;e<b;)this.orderedListOfAttachedFile[e]=void 0,e++;this.orderedListOfAttachedFile.splice(b,1,a),m.call(this,a,d,c)}function q(a){var b,c=[];this.orderedListOfAttachedFile=k(this.orderedListOfAttachedFile,void 0),b=this.orderedListOfAttachedFile.indexOf(_.findWhere(this.orderedListOfAttachedFile,a)),this.orderedListOfAttachedFile.forEach(function(a){var b="msi-attimg"===zmUtil.fileTyp(a.fn||a.name)[1]?101:103;c.push({ft:b,fn:a.n||a.fn||a.name,src:a.src})}),zmUtil.initAttSlideShow({startIndex:b||0,attObjList:c,hideAllOptions:!0,ignoreEMLParsing:!0})}function r(a){var b,c=this.orderedListOfAttachedFile.indexOf(_.findWhere(this.orderedListOfAttachedFile,a));return c>=0&&(this.slideListCount--,b=this.orderedListOfAttachedFile[c],this.orderedListOfAttachedFile.splice(c,1),n.call(this,b)),c}function s(){var a,b,f,g=this;b=function(){a=g.configJSON.attachFrom.indexOf("otherCloud"),a>=0&&g.configJSON.attachFrom.splice(a,1)},f=function(){a=g.configJSON.attachFrom.indexOf("zDocs"),a>=0&&g.configJSON.attachFrom.splice(a,1)},d()&&!c()||b(),zmAttachUtility.isDocsCompAllowed()||f(),e()&&(a=this.configJSON.attachFrom.indexOf("myAttachchment"),a>=0&&this.configJSON.attachFrom.splice(a,1))}function t(){var a=this.attachUtil;this.dialog.$el.find(".SC_srch").removeClass("shw"),this.dialog.$el.find(".SC_frt").find("b").removeClass("SC_sel"),this.dialog.$el.find(".msi-thumbview").closest("b").addClass("SC_sel"),a.restoreOptions(this.dialog.$el)," "===a.prvFltr.lblId?a.getAttLst({groupId:a.groupId,dType:"t",st:1,eType:a.entity,fType:a.fileType,prvFltr:a.prvFltr,isNew:"y",lstngObj:!1}):a.getAttLst({groupId:a.groupId,dType:"t",st:1,eType:a.entity,fType:a.fileType,prvFltr:a.prvFltr,isNew:"y",lstngObj:a.prvFltr})}function u(){var a=this.attachUtil;this.dialog.$el.find(".SC_srch").removeClass("shw"),this.dialog.$el.find(".SC_frt").find("b").removeClass("SC_sel"),this.dialog.$el.find(".msi-listview").closest("b").addClass("SC_sel"),a.restoreOptions(this.dialog.$el)," "===a.prvFltr.lblId?a.getAttLst({groupId:a.groupId,dType:"l",st:1,eType:a.entity,fType:a.fileType,prvFltr:a.prvFltr,isNew:"y",lstngObj:!1}):a.getAttLst({groupId:a.groupId,dType:"l",st:1,eType:a.entity,
fType:a.fileType,prvFltr:a.prvFltr,isNew:"y",lstngObj:a.prvFltr})}function v(){this.dialog.$el.find(".SC_srch").toggleClass("shw"),this.attachUtil.restoreOptions(this.dialog.$el)}function w(){var a=this.attachUtil,b=a.prvFltr.lblId;if("undefined"!=typeof this.dialog&&"myAttachment"===this.dialog.currentTab())if(a.groupId===zmail.zuid&&"all"===a.entity&&0===a.fileType&&" "===b)this.dialog.$el.find("#zmMyAttachments").hide();else{var c,d=zmail.zuid===a.groupId?ha.menuText.me:zmCont.getGroup()[a.groupId].name;c="f"===b?ha.menuText.favourites:" "===b?ha.menuText.notags:zmail.labInfo[b].dispName,this.dialog.$el.find("#zmMyAttachments").show(),this.dialog.$el.find("#zmMyAttachments").find("b").text(" "+_zm.escapeTags(d)+" - "+zmAttachUtility.entDrpTxtChange(a.entity)+" - "+ha.fType[a.fileType]+" - "+_zm.escapeTags(c)+" "),this.dialog.$el.find(".msi-filter").closest("b").addClass("SC_sel")}}function x(b){var c=this;return{id:"myAttachments",text:ha.common.me,selected:b,tabName:"myAttachment",onClk:function(a,b,d){d?w.call(c):(c.attachUtil=new zmAttachUtility.AttachmentListing({appName:"attComp",listElem:a.getCenterElem().find(".SC_mclst"),headerElem:a.$el,thumbWidth:95,onFilterAction:w.bind(c),cache:_zm._isPrivilegedUser()}),c.attachUtil.initAttachViewComp()),a.$el.find(".SC_PUsel_files").show()},forceCall:!0,listingArea:{id:"zmattView",classes:"SC_mclst",styles:{"overflow-y":"scroll"},parEle:$('<div class="SCmc SC_attachviewer"></div>')},icons:[{iconClass:"msi-filter",onClk:function(){v.call(c)}},{iconClass:"msi-thumbview",selected:!0,onClk:function(){t.call(c)}},{iconClass:"msi-listview",onClk:function(){u.call(c)}}],buttons:[{text:ha.button.attach,onClk:function(){a.myAttachment.onAttachHandler.call(c)}}]}}function y(b){var c=this,d={id:"attachFromDocs",text:ha.cloudServiceName.zDocs,tabName:"zDocs",selected:b,onClk:function(b,d,e){b.$el.find("#zmMyAttachments").hide(),b.$el.find(".SC_PUsel_files").hide(),e||a.zDocs.invokeZDocsComponent.call(c,b.getCenterElem())},forceCall:!0,listingArea:{id:"zmMyDocs",classes:"SCmc SC_attachviewer"},buttons:[]};return this.configJSON.showZDocsAsLinkOption?d.buttons.push({text:ha.button.insert,onClk:function(){a.zDocs.attachZDocsDocument.call(c)}}):d.buttons.push({text:ha.button.attach,onClk:function(){a.zDocs.attachZDocsDocument.call(c)}}),d}function z(b){var c=this;return{id:"attachFromCloud",text:ha.cloudServiceName.otherCloud,tabName:"oCloud",selected:b,onClk:function(b,d,e){b.$el.find("#zmMyAttachments").hide(),b.$el.find(".SC_PUsel_files").hide(),e||a.gagets.invokeGadgetComponent.call(c,b)},forceCall:!0,listingArea:{classes:"SCmc SC_attachviewer"},hideButtons:!0}}function A(b){var c=this;return{id:"zmDesktop",text:ha.cloudServiceName.desktop,tabName:"zDesktop",selected:b,onClk:function(b){b.$el.find("#zmMyAttachments").hide(),b.$el.find(".SC_PUsel_files").hide(),"undefined"==typeof c.dialog&&0===c.configJSON.attachFrom.indexOf("desktop")||a.desktop.onTabSelection.call(c)},forceCall:!0,listingArea:{classes:"SC_mclst SC_ren",parEle:$('<div class="SCmc SC_attachviewer"></div>')},buttons:[{text:ha.button.attach,onClk:function(){a.desktop.attachBtnHandler.call(c)}}]}}function B(b){return a.insertImage.getTabConfig.call(this,b)}function C(a,b){return"myAttachchment"===a?x.call(this,b):"zDocs"===a?y.call(this,b):"otherCloud"===a?z.call(this,b):"desktop"===a?A.call(this,b):"insertImage"===a?B.call(this,b):void 0}function D(a){var b=[],c=this,d=a.find("#zmAttGrp input"),e=a.find("#zmAttLbl input"),f=a.find("#zmAttEntity input"),g=a.find("#zmAttFilTyp input");e.val(ha.menuText.none).data({dataIndex:"all"}),d.val(ha.menuText.me).data({dataIndex:zmail.zuid}),f.val(ha.menuText.all).data({dataIndex:"all"}),g.val(ha.menuText.all).data({dataIndex:0}),a.find(".SC_frt").find(".msi-thumbview").closest("b").addClass("SC_sel"),a.find("#zmAttGrp").off("click").on("click",function(){zmAttachUtility.attDropDown("grp",d)}),a.find("#zmAttEntity").on("click",function(){zmAttachUtility.attDropDown("ent",f)}),a.find("#zmAttFilTyp").on("click",function(){zmAttachUtility.attDropDown("tfil",g)}),a.find("#zmAttLbl").on("click",function(){zmAttachUtility.attDropDown("lbl",e)}),a.find("#zmDfltAttView").off("click").on("click",function(){var b=c.attachUtil;a.find(".msi-filter").closest("b").removeClass("SC_sel"),a.find(".SC_srch").removeClass("shw"),b.prvFltr.lblId=" ",b.getAttLst({groupId:zmail.zuid,dType:b.dType,st:1,eType:"all",fType:0,prvFltr:b.prvFltr,isNew:"y",lstngObj:!0})}),a.find("#attFilter").on("click",function(){var h=d.data().dataIndex,i=f.data().dataIndex,j=g.data().dataIndex,k=e.data().dataIndex,l=c.attachUtil;if("all"===k&&(k=" "),a.find(".SC_srch").removeClass("shw"),l.groupId!==h||l.fileType!==j||l.entity!==i||l.prvFltr.lblId!==k){if(" "===k)return b.mthd=" ",b.lblId=" ",void l.getAttLst({groupId:h,dType:l.dType,st:1,eType:i,fType:j,prvFltr:l.prvFltr,isNew:"y",lstngObj:!0});"f"===k?(b.mthd="listFavourite",b.lblId=k):(b.mthd="labelListing",b.lblId=k),l.getAttLst({groupId:h,dType:l.dType,st:1,eType:i,fType:j,prvFltr:l.prvFltr,isNew:"y",lstngObj:b})}}),a.find("#filterCncl").on("click",function(){var b=c.attachUtil;a.find(".SC_srch").removeClass("shw"),b.restoreOptions(a)})}function E(b){var c=this;b.getCenterElem("myAttachment").on("click",".zmAch",function(b){a.myAttachment.toggleSelectedStatus.call(c,b,this)}),D.call(this,b.$el)}function F(b){function c(c){var d=b.getCenterElem("zDesktop").find(".SC_drop");d.removeClass("SC_dropW100");for(var f=function(b){var c=!1;return a.desktop.validateFile.call(e,b,b.name,function(d){d.status&&a.desktop.appendList.call(e,b)===!1&&(c=!0)}),c},g=0;g<c.length&&!f(c[g]);g++);0===e.desktopObj.length&&d.addClass("SC_dropW100")}function d(){e.desktopObj.length&&b.getCenterElem("zDesktop").find(".SC_drop").removeClass("SC_dropW100").removeAttr("centerover")}var e=this;b.getCenterElem("zDesktop").find(".SC_drop").click(function(){a.desktop.attachFromDesktopTab.call(e)}),a.utility.setDragDrop({onDrop:c,onDragLeave:d,$centerEle:b.getCenterElem("zDesktop"),$dropMsgEle:b.getCenterElem("zDesktop").find(".SC_drop")})}function G(b){var c=this,d=b.$el;a.utility.setDragDrop({onDrop:function(){c.desktopObj.length&&b.getCenterElem("zDesktop").find(".SC_drop").removeClass("SC_dropW100")},onDragover:function(){"zDesktop"===b.currentTab()&&b.getCenterElem("zDesktop").find(".SC_drop").addClass("SC_dropW100")},onDragLeave:function(){var a=b.getCenterElem("zDesktop").find(".SC_drop");c.desktopObj.length&&!a.attr("centerover")&&a.removeClass("SC_dropW100")},$centerEle:d,$dropMsgEle:d,eventIdentifier:"zmAttComp",preventDefaultErrorHandler:!0})}function H(b){var c=this.configJSON.attachFrom.indexOf("desktop"),d=this.configJSON.attachFrom.indexOf("insertImage");this.configJSON.attachFrom.indexOf("myAttachchment")>=0&&E.call(this,b),(c>=0||d>=0)&&f(),c>=0&&F.call(this,b),d>=0&&a.insertImage.bindEventsToTab.call(this,b),G.call(this,b)}function I(b){var c,d,e=this;$("body").append("<div style='max-height:1px;max-width:1px'id='zmpastefirefox' contentEditable=true></div>"),c=new window.MutationObserver(function(c){c.forEach(function(c){"childList"===c.type&&c.addedNodes&&c.addedNodes.length&&Array.prototype.forEach.call(c.addedNodes,function(c){if("IMG"===c.tagName){var f=$(c),g=a.utility.dataURItoBlob(f.attr("src"));d="ScreenShot_"+(new Date).getMilliseconds()+".png",f.remove(),"zDesktop"===b.currentTab()?a.desktop.appendList.call(e,g,d):"insertImage"===b.currentTab()&&a.insertImage.pasteHandler(g,b)}})})}),c.observe($("#zmpastefirefox")[0],{childList:!0})}function J(b){var c,d=this,e=b.$el.find("."+b.contentClass),f=this.configJSON.attachFrom,g="none";if(this.dialog=b,(window.ActiveXObject||"ActiveXObject"in window)&&b.$el.find("."+b.contentWrapperClass).css({opacity:1}),f.indexOf("desktop")>=0&&(b.getCenterElem("zDesktop").append(zmAttachment.templates.dragdropArea),this.desktop.autoBrowse&&(b.$el.hide(),a.desktop.attachFromDesktopTab.call(this,!0))),f.indexOf("myAttachchment")>=0&&(b.$el.find("."+b.headerClass).after('<div id="zmMyAttachments" style="display:none;position:absolute; margin-top:-17px;padding-left:10px;">'+ha.filterMenu.filterBy+':<b></b><font class="SC_lnk" style="" id="zmDfltAttView">('+ha.common.clearFilter+")</font></div>"),"myAttachment"===b.currentTab()&&(g="block"),b.$el.find("."+b.contentClass).after('<div style = "display:'+g+'" class="SC_PUsel_files"><label>'+ha.common.selectedfiles+"</label></div>"),b.getCenterElem("myAttachment").append(ca.getFilterDropTemplate())),b.$el.find("."+b.contentClass).css({overflow:"hidden",width:""}),b.$el.find(".SCmc.SC_attachviewer").css({"max-height":e.css("max-height"),"max-width":e.css("max-width")}),this.configJSON.showZDocsAsLinkOption){var h;b.getButtonContainer("zDocs").append(zmAttachment.templates.docsOption),h=b.getButtonContainer("zDocs").find(".SC_frt div"),h.click(function(){var a=$(this);a.hasClass("SC_rwWrite")?(d.asLink=!1,ATTACHDIALOG.asAttachment(),b.hideSuccErrMsg("zDocs")):(d.asLink=!0,ATTACHDIALOG.asLink(),b.showSuccErrMsg("w",ha.zohoDocs.aslinkwmsg,"zDocs")),a.toggleClass("SC_rwWrite")})}f.indexOf("insertImage")>=0&&a.insertImage.dialogDidMount(b),c=window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,da=function(e){d.dialog&&(c?$("#zmpastefirefox").html("").focus():(e.preventDefault(),"zDesktop"===d.dialog.currentTab()?a.desktop.onPaste.call(d,e):"insertImage"===d.dialog.currentTab()&&a.insertImage.pasteHandler(e,b)))},c&&I.call(this,b),H.call(this,b)}function K(){return"/zm/attach.do?mode=temp"}function L(){return{type:"f",accId:this.accId,tSize:0}}function M(){return fa}function N(){return ga}function O(){return{extension:["ade","adp","bat","chm","cmd","com","cpl","exe","hta","ins","isp","jar","jse","lib","lnk","mde","msc","msp","mst","pif","scr","sct","shb","sys","vb","vbe","vbs","vxd","wsc","wsf","wsh"]}}function P(){var a={},b=this.configJSON.desktop;return b?(a.uploadAPI=b.uploadAPI||K(),a.requireParamToUpload=b.requireParamToUpload||L.call(this),a.uploadCallBack=b.uploadCallBack,a.autoBrowse=b.autoBrowse,b.allowedType&&(a.allowedFileType=b.allowedType.type,a.fileTypeErr=b.allowedType.error||ha.desktop.invalidFormat),"boolean"==typeof b.multiple?a.multiple=b.multiple:a.multiple="true",b.excludeType instanceof Object?a.excludeType=b.excludeType:a.excludeType=O(),a):(a.uploadAPI=K(),a.requireParamToUpload=L.call(this),a.multiple="true",a.excludeType=O(),a)}function Q(a){return!(!a||a.constructor!==Object||"string"!=typeof a.url||!a.params||a.params.constructor!==Object)}function R(a){return a instanceof $?a:$("#"+a)}function S(a,b){var c,d,e={},f={},g=b.from,h=b.uuid;if("temp"===g)c=this.attachTempArr.tempLocation,f=e={fP:h};else{if("myAttachment"!==g)return;c=this.attachTempArr.myAttachment,e={uniqueId:h},f={uuid:h}}d=c.indexOf(_.findWhere(c,e)),d>=0&&(c[d].n=a),d=this.orderedListOfAttachedFile.indexOf(_.findWhere(this.orderedListOfAttachedFile,f)),d>=0&&(this.orderedListOfAttachedFile[d].n=a)}function T(){var a=this;$.subscribe("attachment/cloudUpload",function b(c,d,e,f){$.unsubscribe("attachment/cloudUpload",b),a.cloudUpload(d,e,f)}),$.subscribe("attachment/cloudClose",function c(){$.unsubscribe("attachment/cloudClose",c),a.closeThisAppView()}),$.subscribe("attachment/markSelectedAttachmentInUI",a.subMarkAttachment)}function U(){var a={},b=this.configJSON.attachFrom,c=!1;a.id="zmAttachCompWhtPopup",a.tabs=[];for(var d=0,e=b.length;d<e;d++)c=0===d,a.tabs.push(C.call(this,b[d],c));a.onClose=this.closeThisAppView.bind(this,!0),a.dialogDidMount=J.bind(this),a.onMouseDown=function(){$("#zm_flpopup, #zmAtt_dropDown").remove()},a.classes="SC_add",this.dialog=zmsDialog.createTabPopupDialog(a)}function V(b){var c,d,e,f,g,h,i,j=b.success,k=j.length;void 0!==this.$ele&&this.$ele.length||(this.$ele=R(this.configJSON.eleId)),g=this.$ele;for(var l=0;l<k;l++)f=void 0,c=$(zmAttachment.templates.attListingTemplate),i=zmUtil.fileTyp(j[l].name)[1],this.configJSON.renameSupport?"msi-attimg"!==i&&c.find('.zmSub i[data-name="showMore"]').remove():(h=c.find('.zmSub span[data-name="rename"]'),"msi-attimg"===i?h.attr("data-name","showMore").text(ha.attachTemplateText.annotate):h.remove(),c.find('.zmSub i[data-name="showMore"]').remove()),d=zmUtil.getDummyFilename(j[l].name),e=zmUtil.isPreviewAvailable(d),"msi-attimg"===i&&(j[l].src?f=j[l].src:(f=zmail.conPath+"/"+e.apiName+"/"+d,f+="?mode=tmpview&entityType=1&accId="+this.accId+"&fpath="+j[l].fP+"&fstorename="+j[l].sN)),c.find(".zmSze span").eq(0).text(zmUtil.sizeConv(j[l].size)),c.find(".zmFrm span").text(zmUtil.getSubString(20,j[l].name)),c.find(".zmImg").append(zmPreviewTemplate.attPrevInr({fn:j[l].name,thn:f},!0)),c.attr("title",_zm.escapeTags(j[l].name)),g.append(c),a.core.storeTempAttachments.call(this,j[l],c,this.fromDesktopCount++,this.slideListCount++);a.core.onAppend.call(this)}function W(a){var b,c,d,e=this.attachTempArr.tempLocation,f=e.length;for(b=0;b<f&&(c=e[b],d=this.orderedListOfAttachedFile.indexOf(_.findWhere(this.orderedListOfAttachedFile,{fP:c.fP})),!(d>a));b++);return b<f?b:-1}function X(a){var b=this.attachTempArr.tempLocation,c=b.length,d=c-1;if(!(a<0||a>c))for(d=c-1;d>=a;d--)b[d+1]=b[d]}function Y(b,c,d,e){function f(f,g,i){var j=f.blob,k=f.handBckObj;j.name=b.attr("title"),h.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(c.fs||c.size||0),a.desktop.formUpload.call(h,{file:j,name:j.name,$replaceEle:b,dIndex:k.attachTempArrIndex,sIndex:k.slideArrIndex,from:k.from,onerror:function(a){a.replaceWith(b),h.configJSON.currentAttachedSize+=zmAttachUtility.parseToNumber(c.fs||c.size||0),Y.call(h,b,c,d,e)},onsuccess:function(){if("temp"!==d){var a=h.attachTempArr.myAttachment,b=a.indexOf(_.findWhere(a,{uniqueId:c.uuid}));b>=0&&(a[b]&&a[b].streamsView&&h.streaViewCount--,a.splice(b,1))}},beforeStoreTempUpdate:function(){if(k.from&&"temp"!==k.from){var a=W.call(h,k.slideArrIndex);if(a>=0)return X.call(h,a),a}}})}function g(){var b,c,e,g="";c=h.orderedListOfAttachedFile.indexOf(_.findWhere(h.orderedListOfAttachedFile,i)),e=h.orderedListOfAttachedFile[c],"temp"===d?(g=zmUtil.getSrcForTempAtt(e),b=h.attachTempArr.tempLocation.indexOf(_.findWhere(h.attachTempArr.tempLocation,i))):g=zmUtil.getTheSrc("FileDownload",e),a.imageEditTool.init({source:g,handBckObj:{attObj:e,from:d,attachTempArrIndex:b,slideArrIndex:c,searchObj:i},onAttach:f})}var h=this,i={},j=b.find(".zmFrm span"),k=c.name||c.fn;"temp"===d?(e=c.fP,i={fP:e}):"myAttachment"===d&&e&&(i={uuid:e}),b.on("click",function(b){var c,e,f,j=$(b.target||b.srcElement),l=zmUtil.encodeFileName(k),m=zmUtil.isPreviewAvailable(l);if("filename"===j.attr("data-name")&&h.configJSON.renameSupport)a.utility.renameHelper.onRenameAction(j,j.closest(".zmL"));else if(j.hasClass("zmFrm")&&h.configJSON.renameSupport)j=j.find("span"),a.utility.renameHelper.onRenameAction(j,j.closest(".zmL"));else if("rename"===j.attr("data-name")&&h.configJSON.renameSupport)j=j.closest(".zmL").find(".zmFrm span"),a.utility.renameHelper.onRenameAction(j,j.closest(".zmL"));else if("download"!==j.attr("data-name")&&m.isPrev)if("showMore"===j.attr("data-name"))if("SPAN"===j[0].nodeName)g();else{var n={par:j,parWidth:!0},o=[{htm:ha.attachTemplateText.annotate,data:{action:"annotate"}}];j.find("b").addClass("SC_ddn"),j.closest(".zmL").addClass("sel"),n.list=o,n.divId="zmAtt_dropDown",n.clk=function(a){"annotate"===a.action&&(zmUtil.hideMenu(),g())},n.onHide=function(){j.find("b").removeClass("SC_ddn"),j.closest(".zmL").removeClass("sel")},n.showArrow=!0,zmUtil.isChildWindow()?(e=new zmDropDownMenu,e.setDropObj(n),e.paint()):zmsuite.showMenu(n)}else a.utility.initSlideshow.call(h,i);else c=h.orderedListOfAttachedFile.indexOf(_.findWhere(h.orderedListOfAttachedFile,i)),c>=0&&(f=h.orderedListOfAttachedFile[c],"temp"===d?zmUtil.downloadTempAttachment({accId:h.accId,fP:f.fP,sN:f.sN,name:f.n||f.name}):zmUtil.downloadAttachment(f))}),a.utility.renameHelper.init({context:this,$ele:j,onChange:S,handbackData:{from:d,uuid:e||c.fP},orginalFileName:k,parentClass:"zmL"})}function Z(){this.asLink=!1}function aa(){var a=this.configJSON;this.actionMode=a.actionMode||0,a.$actionEle&&(this.$actionEle=a.$actionEle),a.classToRemove&&(this.classToRemove=a.classToRemove),a.classToAdd&&(this.classToAdd=a.classToAdd),"function"==typeof a.onRemoveAttachment&&(this.onRemoveAttachment=a.onRemoveAttachment),"function"==typeof a.onAddAttachment&&(this.onAddAttachment=a.onAddAttachment),"function"==typeof a.onRemoveElement&&(this.onRemoveElement=a.onRemoveElement),"function"==typeof a.onAddElement&&(this.onAddElement=a.onAddElement),a.$dropCenter&&(this.$dropCenter=a.$dropCenter),a.insertImage&&a.insertImage.constructor===Object&&(this.insertImage=a.insertImage),Q(a.myAttachment)&&(this.myAttachment=a.myAttachment),void 0===a.maxAttachedSize&&(this.configJSON.maxAttachedSize=M(),i(a.componentId,function(a){this.configJSON.maxAttachedSize=a}.bind(this))),void 0===a.currentAttachedSize&&(this.configJSON.currentAttachedSize=N())}function ba(a){this.dialog=void 0,this.isAttachingCount=0,this.fromDesktopCount=0,this.slideListCount=0,this.attachTempArr={tempLocation:[],myAttachment:[]},this.attachUtil=null,this.selectedattachUtilectsArr=[],this.asLink=!1,this.orderedListOfAttachedFile=[],this.streaViewCount=0,this.desktopObj=[],this.filenameCountMap={},this.updateConfig(a)}var ca={},da=function(){},ea={},fa=10485760,ga=0,ha=function(){var a={};return $.extend(a,zmText.get("attachmentUtility"),zmText.get("attachComponent"),!0),a}();a.core={},a.utility=a.utility||{},ca.getTempLoadingTemplate=function(){return zmAttachment.templates.cloudAttTempLoadingBox},ca.getFilterDropTemplate=function(){return zmAttachUtility.getFilterDropTemplate()},a.utility.isAttachmentSelected=function(a){return!!a||(zmUtil.succErrMsg("e",ha.selectAttach),!1)};var ia={initDragDropArea:function(){var b=$(zmAttachment.templates.dropMsgTemplate),c=this;if(this.$dropCenter instanceof $){var d=function(d){var e,f;if(f=function(b){var d=!1;return a.desktop.validateFile.call(c,b,b.name,function(e){e.status?a.desktop.uploadToTempLocation.call(c,[{file:b,fileName:e.name}]):d=!e["continue"]}),d},b.hide(),d)for(e=0;e<d.length&&!f(d[e]);e++);};this.$dropCenter.append(b),a.utility.setDragDrop({onDrop:d,onDragLeave:function(){return b.hide(),!1},onDragover:function(){b.show()},$centerEle:this.$dropCenter,$dropMsgEle:b})}},createActionMenu:function(){var a=this.$actionEle,b=this;if(this.desktop.autoBrowse)this.browseDesktop();else{var c,d=a,e={par:d,parWidth:!0},f=75,g=[{htm:ha.attachDropMenu.quickAttach,data:{action:"desktop"}},{htm:ha.attachDropMenu.compAttach,data:{action:"cloud"}}];d.find("b").addClass("SC_ddn"),e.list=g,e.divId="zmAtt_dropDown",e.clk=function(a){zmUtil.hideMenu(),"desktop"===a.action?b.browseDesktop():b.init()},c=$("body").height()-a.offset().top>=f?"up":"bottom",e.align="pleft",e.direction=c,zmsuite.showMenu(e)}},bindClickEventToActionEle:function(){var a=this;this.$actionEle.click(function(b){var c=b.target||b.srcElement;0===a.actionMode?"msi-barrow"===c.className?ia.createActionMenu.call(a):a.browseDesktop():1===a.actionMode?a.browseDesktop():a.init()})},addTempLocationAttachment:function(a){V.call(this,{success:[a]})},appendPreAttachedFile:function(b){b.fP?ia.addTempLocationAttachment.call(this,b):a.myAttachment.appendAttachment.call(this,b)},processPreAttachedFile:function(a){var b=a||this.configJSON.preAttachedFile;b instanceof Array&&b.forEach(function(a){ia.appendPreAttachedFile.call(this,a)},this)},doInitialAction:function(){this.$dropCenter instanceof $&&ia.initDragDropArea.call(this),this.autoLaunch?this.init():this.$actionEle instanceof $?ia.bindClickEventToActionEle.call(this):1===this.actionMode&&this.browseDesktop(),this.configJSON.preAttachedFile&&ia.processPreAttachedFile.call(this)}};a.core.onAllUploadFinish=function(){var a,b,c=this.configJSON.onAllUploadFinish;this.isUploadCompleted()&&"object"==typeof c&&"function"==typeof c.handler&&(a=this.attachTempArr,b=$.extend(!0,{},a),c.resetData&&this.clearStoreAttachments(),c.removeAttachDOM&&this.$ele.find(".zmL.SC_Pbar").remove(),Array.isArray(b.myAttachment)&&b.myAttachment.filter(function(a){return delete a.uniqueId}),c.handler(b))},a.core.incrementAttachCount=function(){this.isAttachingCount++},a.core.decrementAttachCount=function(){this.isAttachingCount>0&&this.isAttachingCount--},a.core.addRemoveClassToParentDom=function(){var a=this.attachTempArr.myAttachment,b=this.attachTempArr.tempLocation;this.isAttachingCount||b.length||a.length?(this.classToAdd&&this.$ele.addClass(this.classToAdd),this.classToRemove&&this.$ele.removeClass(this.classToRemove)):this.classToRemove&&this.$ele.addClass(this.classToRemove)},a.core.onAppend=function(){"function"==typeof this.onAddElement&&this.onAddElement()},a.core.onRemove=function(){"function"==typeof this.onRemoveElement&&this.onRemoveElement()},a.core.storeTempAttachments=function(c,d,e,f){var g=this,h=this.attachTempArr.tempLocation,i=h.length;if(e>i)for(;i<e;)h[i]=void 0,i++;this.configJSON.currentAttachedSize+=zmAttachUtility.parseToNumber(c.size||0),h.splice(e,1,c);var j=function(){var e,f=g.attachTempArr.tempLocation,h=f.indexOf(_.findWhere(f,{fP:c.fP}))||0;h>=0&&(d.remove(),e=f[h],g.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(c.size),f.splice(h,1),g.fromDesktopCount--,a.core.addRemoveClassToParentDom.call(g),b.call(g,e),a.core.onRemove.call(g)),a.utility.modifySlideshowArray.call(g,{fP:c.fP})};d.data({uniqueId:c.fP}),d.find(".SC_icn").off("click").on("click",j),Y.call(this,d,c,"temp"),a.utility.storeAttListForSlideshow.call(this,c,f,"tempAttachment",d)},ba.prototype={init:function(){1===this.actionMode?this.browseDesktop():(s.call(this),Z.call(this),U.call(this),T.call(this))},updateConfig:function(a){null!==a&&"object"==typeof a&&("object"==typeof this.configJSON?$.extend(!0,this.configJSON,a):this.configJSON=a,this.componentId=this.configJSON.componentId,this.autoLaunch="undefined"==typeof this.configJSON.autoLaunch||this.configJSON.autoLaunch,this.$ele=R(this.configJSON.eleId),this.accId=h(this.configJSON),this.desktop=P.call(this),aa.call(this))},browseDesktop:function(){a.desktop.browseDesktop.call(this)},uploadFiles:function(b){var c=this,d=function(b){var d=!1;return a.desktop.validateFile.call(c,b,b.name,function(e){e.status?a.desktop.uploadToTempLocation.call(c,[{file:b,fileName:e.name}]):d=!e["continue"]}),d};if(b instanceof window.File)d(b);else if(b.length)for(var e=0,f=b.length;e<f&&!d(b[e]);e++);},addFiles:function(a){a instanceof Array&&a.length&&ia.processPreAttachedFile.call(this,a)},isStreamView:function(){return this.streaViewCount>0},closeThisAppView:function(b){this.dialog&&(b||this.dialog.close(),$.unsubscribe("attachment/cloudClose"),$.unsubscribe("attachment/cloudUpload"),$.unsubscribe("attachment/markSelectedAttachmentInUI",this.subMarkAttachment),g(),j.call(this),this.configJSON.onClose&&this.configJSON.onClose(),a.insertImage.clear(),$("#zmpastefirefox").remove())},cloudUpload:function(b,c,d,e){var f,g,h,i,j=this;h=$(ca.getTempLoadingTemplate()),h.find(".zmSub").html(""),this.closeThisAppView(),a.core.incrementAttachCount.call(this),this.$ele&&!this.$ele.length&&(this.$ele=R(this.configJSON.eleId)),i=function(b,c){if(a.core.decrementAttachCount.call(j),b.success&&b.success.length){var e,f,g,i=j.configJSON.maxAttachedSize,k=j.configJSON.currentAttachedSize,l=ha,m={};for(e=0,f=b.success.length;e<f;e++)if(k+=zmAttachUtility.parseToNumber(b.success[e].size||0),k>i){b.success=b.success.splice(0,e);var n=i/1048576,o=f-e;g=zmText.applyArgs(l.maxsizeerr,{size:n+"MB",leftfiles:o}),zmUtil.succErrMsg("e",g);break}if(h.remove(),m.tmpObj=b,m.eprm=c,m.loadType="attachment",V.call(j,b),b.failure&&b.failure.length){var p=b.failure,q=p.length,r="";for(g=ha.ajaxErr,e=0;e<q;e++)r+=0===e?p[0].fileName:","+p[0].fileName;_zm.succErrMsg("e",g.attFromCloudPartialErr1+" "+r+" "+g.attFromCloudPartialErr2)}}else b.failure&&b.failure.length&&(h.remove(),"object"==typeof b.failure[0]&&"string"==typeof b.failure[0].msg?_zm.succErrMsg("e",b.failure[0].msg):_zm.succErrMsg("e",ha.ajaxErr.attFromCloud),j.configJSON.onCloudAttachAbort&&j.configJSON.onCloudAttachAbort(d,j.configJSON.handBckObj),a.core.onRemove.call(j));a.core.onAllUploadFinish.call(j)},h.find(".msi-close").on("click",function(){f.abort(),a.core.decrementAttachCount.call(j),a.core.addRemoveClassToParentDom.call(j),a.core.onRemove.call(j)}),e="z"!==e?ha.cloudServiceName.otherCloud:ha.cloudServiceName.zDocs,g=zmText.applyArgs(ha.attachingfrom,{filecount:c,servicename:e}),h.find(".zmFrm span").text(g),this.$ele.append(h),a.core.addRemoveClassToParentDom.call(this),a.core.onAppend.call(this);var k={docs:b,method:"attachFromCloud",groupId:zmail.zuid,entityType:1,accId:j.accId},l={cmpId:d,tol:c};this.configJSON.handBckObj&&(l.handBckObj=this.configJSON.handBckObj);var m={u:zmail.conPath+"/postAttach.do",t:"POST",fn:i,p:k,ep:l,csr:"s",efn:function(b,c,e){h.remove(),a.core.onRemove.call(j),"abort"!==e.statusText&&_zm.succErrMsg("e",ha.ajaxErr.attFromCloud),j.configJSON.onCloudAttachAbort&&j.configJSON.onCloudAttachAbort(d,j.configJSON.handBckObj)}};"function"==typeof this.configJSON.beforeAttach?this.configJSON.beforeAttach(function(){f=zmAjq.XHR(m),o(h)}):(f=zmAjq.XHR(m),o(h))},isUploadCompleted:function(){return 0===this.isAttachingCount},isUploadInProgress:function(){return!this.isUploadCompleted()},getStoreAttachments:function(a){var b,c,d,e,f={},g={},h={fP:!0,sN:!0,size:!0,n:!0};if(this.isUploadCompleted()||a){for(l.call(this),f.tempLocation=[],c=0,d=this.attachTempArr.tempLocation.length;c<d;c++){g={};for(e in this.attachTempArr.tempLocation[c])h[e]?g[e]=this.attachTempArr.tempLocation[c][e]:"name"!==e||this.attachTempArr.tempLocation[c].n||(g.n=this.attachTempArr.tempLocation[c][e]);$.isEmptyObject(g)||f.tempLocation.push(g)}for(f.myAttachment=[],b=0,d=this.attachTempArr.myAttachment.length;b<d;b++){g={};for(e in this.attachTempArr.myAttachment[b])"uniqueId"!==e&&(g[e]=this.attachTempArr.myAttachment[b][e]);f.myAttachment.push(g)}return f}return!1},getAllAttachedList:function(){var a=k(this.orderedListOfAttachedFile,void 0);return a},clearStoreAttachments:function(){this.attachTempArr.tempLocation=[],this.attachTempArr.myAttachment=[],this.orderedListOfAttachedFile=[],this.configJSON.currentAttachedSize=0,this.fromDesktopCount=0,this.slideListCount=0,this.streaViewCount=0}},a.init=function(b,c){var d;if(c)d=c;else{var e=function(){a.myAttachment.markSelectedAttachmentInUI.call(d)};ba.prototype.subMarkAttachment=e,d=new ba(b)}return ia.doInitialAction.call(d),d},a.cloudUpload=function(a,b,c){$.publish("attachment/cloudUpload",[a,b,c])},a.closeThisAppView=function(a){$.publish("attachment/cloudClose",[a])},a.markSelectedAttachmentInUI=function(a){$.publish("attachment/markSelectedAttachmentInUI",[a])},a.core.bindTempListedAttachment=Y,a.getAttachComponent=ba,a._i18N=ha,a.utility.getElementReference=R,a.utility.initSlideshow=q,a.utility.modifySlideshowArray=r,a.utility.storeAttListForSlideshow=p}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){"use strict";function b(a,b){var c,d,e=this.desktopObj;a<b?e.splice(b,0,e.splice(a,1)[0]):a>b&&(0===b?(c=e.splice(a,1),this.desktopObj=c.concat(e)):(c=e.splice(0,b),d=e.splice(a-b,1),this.desktopObj=c.concat(d.concat(e))))}var c,d={},e=!1;a.utility=a.utility||{},a.utility.fileReorder={},a.utility.fileReorder.handleDragStart=function(a){var b=a.target||a.srcElement,f=$(b).closest(".zmL"),g=this.desktopObj[f.index()].fileName,h=document.createElement("div");g=zmUtil.getSubString(20,g),navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&a.originalEvent.dataTransfer.setData("text/plain",g),"function"==typeof a.originalEvent.dataTransfer.setDragImage&&($("#zacdummydrag").remove(),h.id="zacdummydrag",h.className="SC_dg",h.style.top="0px",h.style.left="-1000px",h.innerText=g,document.body.appendChild(h),a.originalEvent.dataTransfer.setDragImage(h,0,0)),e=!0,c=this.dialog.$el,d.dragElement=f,d.dragElementIndex=f.index()},a.utility.fileReorder.handleDragOver=function(a){var b,f;e&&(b=a.target||a.srcElement,f=$(b).closest(".zmL"),c.find(".dragtheme").remove(),d.dragOverElement=f,d.dragOverElementIndex=f.index(),d.dragElementIndex<d.dragOverElementIndex?f.after(zmAttachment.templates.dragtheme):d.dragElementIndex>d.dragOverElementIndex&&f.before(zmAttachment.templates.dragtheme))},a.utility.fileReorder.handleDragEnd=function(){var a;c.find(".dragtheme").remove(),d.dragElementIndex<d.dragOverElementIndex?(a=d.dragElement.detach(),d.dragOverElement.after(a),b.call(this,d.dragElementIndex,d.dragOverElementIndex)):d.dragElementIndex>d.dragOverElementIndex&&(a=d.dragElement.detach(),d.dragOverElement.before(a),b.call(this,d.dragElementIndex,d.dragOverElementIndex))}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){"use strict";function b(b){var c=a.utility.createObjectURL(b.file,5e3),d=document.createElement("a");document.body.appendChild(d),d.href=c,d.download=b.fileName,d.click(),$(d).remove()}function c(b,c){window.URL=window.URL||window.webkitURL;var d={startIndex:c||0,attObjList:[],hideAllOptions:!0,ignoreThumb:!0,ignoreEMLParsing:!0,isDataURL:!0};d.onCancel=function(){d.attObjList.forEach(function(b){b.src&&a.utility.revokeObjectURL(b.src)})},Array.isArray(b)&&b.forEach(function(b,c){var e,f=b.file,g=zmUtil.fileTyp(f.name),h={pdf:1,html:1,htm:1},i=zmUtil.isPreviewAvailable(f.name);return i.isPrev&&"FileDownload"===i.apiName?(h[g[2]]||"text/plain"===f.type||"msi-attimg"===g[1]||(f=new Blob([f],{type:"text/plain"})),e=a.utility.createObjectURL(f),void d.attObjList.push({ft:"msi-attimg"===g[1]?101:103,fn:b.fileName,src:e})):void(c<=d.startIndex&&(d.startIndex-=1))}),zmUtil.initAttSlideShow(d)}function d(b,c){var d=a.utility.createObjectURL(c,4e3);b.find(".zmImg img").attr("src",d)}function e(b){function c(a){var c=a.blob;c.name=b.find("#listView").text(),g.desktopObj[b.index()]={file:c,fileName:e.fileName},d(b,c)}var e=this.desktopObj[b.index()],f=e.file,g=this;a.imageEditTool.init({file:f,handBckObj:e,onAttach:c})}function f(a){var b=this.dialog.getCenterElem("zDesktop").find(".SC_mclst"),c=a.index();this.desktopAttachedSize-=zmAttachUtility.parseToNumber(this.desktopObj[c].file.size||0),this.desktopObj.splice(c,1),1===b.children().length?this.dialog.getCenterElem("zDesktop").find(".SC_drop").addClass("SC_dropW100"):0===c&&a.next().find(".zmFrm").find("span").addClass("sel"),a.remove()}function g(a){var b,c,d=0,e=this.filenameCountMap,f=a.lastIndexOf(".");return e[a]?(d=e[a],e[a]+=1):e[a]=1,d>0&&(c=zmUtil.fileTyp(a)[2],b=f!==-1?a.substr(0,f):a,1===d?b+="_(copy)":b=b+"_(copy"+(d-1)+")",a=c.length?b+"."+c:b),a}function h(a,b,c){var d=r.desktop,e=a.text(),f=function(c,d){a.text(c),b.find(".zmSub").find("#zmWrnMsg").text(d),b.addClass("SC_renErr"),window.setTimeout(function(){b.removeClass("SC_renErr")},2e3)};e.indexOf(">")>=0||e.indexOf("<")>=0?f(c,r.desktop.charnotallowed):e.length?(e=g.call(this,e),a.text(e),this.desktopObj[b.index()].fileName=e):f(c,d.fileNameErr)}function i(a){var b,c,d,e=!1;return a&&a.name?(d=zmUtil.fileTyp(a.name)[2],this.desktop.allowedFileType&&(c=this.desktop.allowedFileType.split(",")),"undefined"!=typeof c?(b=a.type.substr(0,a.type.lastIndexOf("/")+1)+"*",c.indexOf(a.type)>=0||c.indexOf(b)>=0||c.indexOf("."+d)>=0?e=!0:zmUtil.succErrMsg("e",this.desktop.fileTypeErr)):this.desktop.excludeType&&(this.desktop.excludeType.extension.indexOf(d)<0?e=!0:zmUtil.succErrMsg("e",zmText.applyArgs(r.desktop.attachmentPolicyErr,{filename:a.name}))),e):(zmUtil.debugLog("File name empty"),!1)}function j(a){var b=this.configJSON.currentAttachedSize;return b+=zmAttachUtility.parseToNumber(a.size||0),a.size<=0?(zmUtil.succErrMsg("e",zmText.applyArgs(r.desktop.zero_size,{name:a.name})),!1):!(b>this.configJSON.maxAttachedSize)||(zmUtil.succErrMsg("e",r.maxSizeErr1+" "+zmUtil.sizeConv(this.configJSON.maxAttachedSize)),!1)}function k(a,b,c){var d=i.call(this,a),e=j.call(this,a);d&&e?(b=b.replace(/[<>]/g,""),c({status:!0,name:b})):c({status:!1,name:b,"continue":e})}function l(b,c){var d,e,f,g=b.target||b.srcElement,h=g.files,i=h.length,j=!1,k="function"==typeof c?c:a.desktop.appendList.bind(this);
for(f=function(a){a.status&&k(d,a.name)===!1&&(j=!0)},e=0;e<i&&(d=h[e],a.desktop.validateFile.call(this,d,d.name,f),!j);e++);}function m(b){var c=this;b.find(".zmFlt").on("drag",function(a){zmUtil.stopEvents(a,!0)}),b.find(".zmFlt").on("dragstart",function(b){zmUtil.stopEvents(b,!0),a.utility.fileReorder.handleDragStart.call(c,b)}),b.on("dragover",function(b){zmUtil.stopEvents(b),a.utility.fileReorder.handleDragOver.call(c,b)}),b.on("dragend",function(b){zmUtil.stopEvents(b),a.utility.fileReorder.handleDragEnd.call(c,b)})}function n(){var a=this;$("body").off("mousedown.attCmp").on("mousedown.attCmp",function(){$("body").off("mousedown.attCmp"),a.dialog&&"none"===a.dialog.$el.css("display")&&a.closeThisAppView()})}function o(){try{return new window.XMLHttpRequest}catch(a){}}function p(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}}function q(){return o()||p()}var r=a._i18N,s={};a.desktop={},a.utility=a.utility||{},s.getListTemplate=function(){return zmAttachment.templates.desktopListTemplate},s.getTempLoadingTemplate=function(){return zmAttachment.templates.cloudAttTempLoadingBox},a.utility.createXHR=function(){return window.ActiveXObject?q():o()},a.desktop.onTabSelection=function(){this.desktopObj.length||this.desktop.autoBrowse||a.desktop.attachFromDesktopTab.call(this)},a.desktop.onPaste=function(b){var c,d,e,f,g=b.clipboardData.items,h=this,i=!1;for(f=function(b){c="ScreenShot_"+(new Date).getMilliseconds()+".png",b.status&&a.desktop.appendList.call(h,d,c)===!1&&(i=!0)},e=0;e<g.length&&("file"!==g[e].kind||g[e].type.indexOf("image/")===-1||(d=g[e].getAsFile(),!d||(d.name||(d.name="ScreenShot_"+(new Date).getMilliseconds()+".png"),a.desktop.validateFile.call(this,d,d.name,f),!i)));++e);},a.desktop.formUpload=function(b){var c,d,e,f,g,h,i,j,k=a.utility.createXHR(),l=new window.FormData,m=zmAjq.getCookie("zmcsr"),n=b.file,o=n.size,p=b.name||n.name,q=this;if(this.configJSON.currentAttachedSize+=zmAttachUtility.parseToNumber(o||0),this.configJSON.currentAttachedSize>this.configJSON.maxAttachedSize)return zmUtil.succErrMsg("e",r.maxSizeErr1+" "+zmUtil.sizeConv(this.configJSON.maxAttachedSize)),this.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(o||0),!1;a.core.incrementAttachCount.call(this),void 0!==this.$ele&&this.$ele.length||(this.$ele=a.utility.getElementReference(this.configJSON.eleId)),l.append("fileName",encodeURIComponent(p)),l.append("attach",n,encodeURIComponent(p)),l.append("zmrcsr",m);for(g in this.desktop.requireParamToUpload)l.append(g,this.desktop.requireParamToUpload[g]);q.configJSON.eleId&&(c=$(s.getTempLoadingTemplate()),e="number"==typeof b.dIndex?b.dIndex:this.fromDesktopCount++,f="number"==typeof b.sIndex?b.sIndex:this.slideListCount++,c.find(".SC_icn").on("click",function(){k.abort(),q.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(o||0),a.core.decrementAttachCount.call(q),a.core.addRemoveClassToParentDom.call(q),c.remove(),a.core.onRemove.call(q)}),i=zmUtil.fileTyp(p)[1],"msi-attimg"===i&&(d=a.utility.createObjectURL(n,4e3)),q.configJSON.renameSupport?"msi-attimg"!==i&&c.find('.zmSub i[data-name="showMore"]').remove():(j=c.find('.zmSub span[data-name="rename"]'),"msi-attimg"===i?j.attr("data-name","showMore").text(r.attachTemplateText.annotate):j.remove(),c.find('.zmSub i[data-name="showMore"]').remove()),c.find(".zmFrm span").text(zmUtil.getSubString(20,p)),c.find(".zmImg").html(zmPreviewTemplate.attPrevInr({fn:p,thn:d},!0)),c.attr("title",_zm.escapeTags(p)),c.find(".zmSub").addClass("SC_vh"),k.upload.addEventListener("loadstart",function(){b.$replaceEle instanceof $?b.$replaceEle.replaceWith(c):q.$ele.append(c),a.core.addRemoveClassToParentDom.call(q),a.core.onAppend.call(q)},!1),k.upload.addEventListener("progress",function(a){var b=Math.round(100*a.loaded/a.total);c.find("#progressbar").width(b+"%")},!1)),k.onreadystatechange=function(){if(4===k.readyState)if(200===k.status){var d=$.parseJSON(k.responseText);q.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(o||0),a.core.decrementAttachCount.call(q),d.fP||1===d[0]?(q.configJSON.eleId&&(c.find("#progressbar").remove(),c.find(".zmSub").removeClass("SC_vh"),c.find(".zmSze span").text(zmUtil.sizeConv(o)),"function"==typeof b.beforeStoreTempUpdate&&(h=b.beforeStoreTempUpdate(e,f),"number"==typeof h&&(e=h)),a.core.storeTempAttachments.call(q,d,c,e,f)),"function"==typeof b.onsuccess&&b.onsuccess.call(q),q.desktop.uploadCallBack&&q.desktop.uploadCallBack(d,c)):(0===d[0]?_zm.succErrMsg("e",r.ajaxErr.attFromCloudPartialErr1):d.emsg&&"string"==typeof d.emsg&&_zm.succErrMsg("e",d.emsg.replace(/\\x20/g," ")),"function"==typeof b.onerror?b.onerror.call(q,c):(c.remove(),a.core.onRemove.call(q))),a.core.onAllUploadFinish.call(q)}else 500!==k.status&&400!==k.status||(q.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(o||0),a.core.decrementAttachCount.call(q),_zm.succErrMsg("e",r.ajaxErr.attFromCloudPartialErr1),"function"==typeof b.onerror?b.onerror.call(q,c):c.remove(),a.core.onRemove.call(q),a.core.onAllUploadFinish.call(q))},k.open("POST",this.desktop.uploadAPI,!0),k.send(l)},a.desktop.attachFromDesktopTab=function(a){var b,c=this;$("#zmAttach_file_Desktop").remove(),$("body").append(zmAttachment.templates.browseInputEle("zmAttach_file_Desktop","zmAttach_Desktop")),b=$("#zmAttach_file_Desktop"),this.desktop.multiple&&b.attr("multiple","true"),this.desktop.allowedFileType&&b.attr("accept",this.desktop.allowedFileType),b.off("change").on("change",function(b){return l.call(c,b,a),c.desktopObj.length&&c.desktop.autoBrowse&&"boolean"==typeof a&&c.dialog.$el.show(),this.value="",!1}),this.desktop.autoBrowse&&n.call(this),b.click()},a.desktop.appendList=function(d,i){var j,k,l=$(s.getListTemplate()),n=this,o=i||d.name,p=zmUtil.isPreviewAvailable(o),q=zmUtil.fileTyp(o),t=this.dialog.getCenterElem("zDesktop").find(".SC_mclst");if(o=o.replace(/[<>]/g,""),o=g.call(this,o),void 0===this.desktopAttachedSize&&(this.desktopAttachedSize=this.configJSON.currentAttachedSize),this.desktopAttachedSize+=zmAttachUtility.parseToNumber(d.size||0),this.desktopAttachedSize>this.configJSON.maxAttachedSize)return zmUtil.succErrMsg("e",r.maxSizeErr1+" "+zmUtil.sizeConv(this.configJSON.maxAttachedSize)),this.desktopAttachedSize-=zmAttachUtility.parseToNumber(d.size||0),!1;if(this.desktopObj.push({file:d,fileName:o}),l.find(".zmSze").find("span").text(zmUtil.sizeConv(d.size)),l.find("#listView").text(zmUtil.getSubString(60,o)),d.type.indexOf("image/")!==-1){var u=a.utility.createObjectURL(d,4e3);j="<img src='"+u+"'></img>"}else j="<i class='"+q[1]+"'></i>";l.find(".zmImg").append(j),t.append(l),m.call(this,l),1===t.children().length&&(l.find(".zmFrm").find("span").addClass("sel"),this.dialog.getCenterElem("zDesktop").find(".SC_drop").removeClass("SC_dropW100")),k=l.find(".zmSub").find("span"),p.isPrev&&"FileDownload"===p.apiName&&"html"!==q[2]&&"htm"!==q[2]||k.eq(0).remove(),"msi-attimg"!==zmUtil.fileTyp(o)[1]&&k.eq(1).remove(),a.utility.isChrome()||a.utility.isFirefox()||a.utility.isOpera()||k.eq(2).remove(),l.click(function(a){var d=a.target||a.srcElement,g=d.id;switch(g){case"zmSubDownload":b(n.desktopObj[l.index()]);break;case"zmSubView":c(n.desktopObj,l.index());break;case"zmSubAnnotate":e.call(n,l);break;case"zmSubRemove":f.call(n,l)}});var v,w,x=l.find("#listView");x.focus(function(){var a=$(this);v=a.text(),w=v.lastIndexOf("."),w!==-1&&a.text(v.substring(0,w)),a.addClass("sel")}),x.keypress(function(a){13===a.which&&(a.preventDefault(),$(this).blur())}),x.keyup(function(a){var b;27===a.which&&(a.preventDefault(),b=w!==-1?v.substring(0,v.lastIndexOf(".")):v,x.text(b),x.blur())}),x.blur(function(){var a=$(this);w!==-1&&a.text(a.text()+v.substring(w,v.length)),l.index()&&a.removeClass("sel"),v!==a.text()&&h.call(n,a,l,v)})},a.desktop.showRenameDialog=function(a,b){var c,d=zmUtil.fileTyp(a);a=a.substr(0,a.lastIndexOf(".")),a=a.replace(/[<>]/g,"");var e={title:r.renamefile,$content:$(r.desktop.charnotallowed+".<br><br><div class='SC_tiput' contentEditable=true>"+a+"</div>"),dialogWillMount:function(a){setTimeout(function(){var b=$(a.$els.$contentWrapper).find(".SC_PUcen div");b.focus(),b.on("keypress",function(a){60!==a.which&&62!==a.which||a.preventDefault()}),b.on("paste",function(a){a.preventDefault()})},500),$(a.$els.$content).filter(".SC_PUcen").css({"font-size":"13px",color:"grey"})},buttons:[{name:r.button.done,callback:function(){var a=$(c.$els.$contentWrapper).find(".SC_PUcen div").text()+"."+d[2];c.remove(),b(a)}}]};c=Dialog["new"](e)},a.desktop.uploadToTempLocation=function(b){var c,d,e=b||this.desktopObj,f=this;if(e.length)for(var g=0,h=e.length;g<h;g++)window.FormData?(d=e[g].file,c=e[g].fileName||d.name,a.desktop.formUpload.call(f,{file:d,name:c})):zmUtil.succErrMsg("e",r.desktop.upload_unsupport_browser);else zmUtil.succErrMsg("e",r.desktop.pleaseattach)},a.desktop.browseDesktop=function(){var b=this;a.desktop.attachFromDesktopTab.call(this,function(c,d){"function"==typeof b.configJSON.beforeAttach&&1===b.actionMode?b.configJSON.beforeAttach(function(){a.desktop.uploadToTempLocation.call(b,[{file:c,fileName:d}])}):a.desktop.uploadToTempLocation.call(b,[{file:c,fileName:d}])})},a.desktop.attachBtnHandler=function(){var b=this;this.desktopObj&&this.desktopObj.length?"function"==typeof this.configJSON.beforeAttach?this.configJSON.beforeAttach(function(){a.desktop.uploadToTempLocation.call(b),b.closeThisAppView()}):(a.desktop.uploadToTempLocation.call(this),this.closeThisAppView()):zmUtil.succErrMsg("e",r.desktop.pleaseattach)},a.desktop.validateFile=k}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){"use strict";var b=a._i18N;a.myAttachment={};var c=function(){return"xxxxxxxx-xxxy-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.floor(16*Math.random());return"x"!==a&&(b=3&b|8),b.toString(16)})},d=function(b,d){var e=this,f=this.attachTempArr.myAttachment,g=a.utility.filterMyAttachmentKey(b);g.streamsView&&(g.streamsView=!0,this.streaViewCount++),b.uuid=g.uniqueId=c(),f.push(g),this.configJSON.currentAttachedSize+=zmAttachUtility.parseToNumber(b.fs);var h=function(){var c=f.indexOf(_.findWhere(f,{uniqueId:g.uniqueId}))||0;c>=0&&(d.remove(),e.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(b.fs),f.splice(c,1),g.streamsView&&e.streaViewCount--,a.core.addRemoveClassToParentDom.call(e),a.core.onRemove.call(e),a.utility.modifySlideshowArray.call(e,{uuid:g.uniqueId}))};d.data({uniqueId:g.uniqueId}),d.find(".SC_icn").off("click").on("click",h),a.core.bindTempListedAttachment.call(this,d,b,"myAttachment",g.uniqueId),a.utility.storeAttListForSlideshow.call(this,b,this.slideListCount++,"myAttachment",d)},e=function(a,b){var c=b._self;"function"==typeof c.myAttachment.onUploadSuccess&&c.myAttachment.onUploadSuccess(a,b.templateList)},f=function(a,b){var c=b._self;b.templateList.forEach(function(a){a.remove()}),"function"==typeof c.myAttachment.onUploadFailure&&c.myAttachment.onUploadFailure.apply(c,arguments)},g=function(b,c){var d=[],g=this.myAttachment.params;b.forEach(function(b){d.push(a.utility.filterMyAttachmentKey(b))},this),g.attEntObj=d,zmAjq.XHR({u:this.myAttachment.url,t:"POST",fn:e,efn:f,p:g,ep:{_self:this,templateList:c}})},h=function(c){var e,f,h,i=c.length,j=0,k=[];for(void 0!==this.$ele&&this.$ele.length||(this.$ele=a.utility.getElementReference(this.configJSON.eleId)),f=this.$ele,j=0;j<i;j++){if(e=$(zmAttachment.templates.attListingTemplate),h=c[j],this.configJSON.renameSupport)101!==h.ft&&e.find('.zmSub i[data-name="showMore"]').remove();else{var l=e.find('.zmSub span[data-name="rename"]');101===h.ft?l.attr("data-name","showMore").text(b.attachTemplateText.annotate):l.remove(),e.find('.zmSub i[data-name="showMore"]').remove()}e.find(".zmSze span").eq(0).text(zmUtil.sizeConv(h.fs)),e.find(".zmFrm span").text(zmUtil.getSubString(20,h.n||h.fn)),e.find(".zmImg").append(zmPreviewTemplate.attPrevInr(h,!0)),e.attr("title",_zm.escapeTags(h.n||h.fn)),f.append(e),d.call(this,h,e),this.myAttachment&&k.push(e)}this.myAttachment&&g.call(this,c,k),a.core.addRemoveClassToParentDom.call(this),a.core.onAppend.call(this),a.core.onAllUploadFinish.call(this)},i=function(a,b){var c,d=b.attachmentID;c=this.selectedattachUtilectsArr.indexOf(_.findWhere(this.selectedattachUtilectsArr,{uniqueId:d})),c>=0&&(this.selectedattachUtilectsArr[c].n=a),c=this.orderedListOfAttachedFile.indexOf(_.findWhere(this.orderedListOfAttachedFile,{uuid:d})),c>=0&&(this.orderedListOfAttachedFile[c].n=a)},j=function(b){var c=$(b.target||b.srcElement);c.hasClass("msi-close")?a.myAttachment.modifyCheckedAttachmentArray.call(this,c.closest(".SC_fileSel").attr("data-attid")):this.configJSON.renameSupport&&a.utility.renameHelper.onRenameAction(c,c.closest(".SC_fileSel"))},k=function(b){var c=$(zmAttachment.templates.selectedFile),d=this.attachUtil.attDet[b],e=c.find('span[data-name="filename"]'),f=d.fn;c.attr({"data-attid":b,title:_zm.escapeTags(f)}),e.text(zmUtil.getSubString(10,d.fn)),this.dialog.$el.find(".SC_PUsel_files").append(c),c.click(j.bind(this)),a.utility.renameHelper.init({context:this,$ele:e,onChange:i,handbackData:{attachmentID:b},orginalFileName:f,parentClass:"SC_fileSel"})},l=function(a){var b=this.dialog.$el.find('.SC_PUsel_files span[data-attid="'+a+'"]');b.remove(),this.dialog.getCenterElem("myAttachment").find('.zmL[data-atid="'+a+'"]').removeClass("SC_check")};a.myAttachment.toggleSelectedStatus=function(b,c){var d,e=$(c),f=$(b.target||b.srcElement),g=!0,h=f.attr("id");"thumbView"!==h&&"listView"!==h||(g=!1),g?(e.toggleClass("SC_check"),this.dialog.$el.find(".SC_srch").removeClass("shw"),a.myAttachment.modifyCheckedAttachmentArray.call(this,e.attr("data-atid"))):(d=this.attachUtil.attDet[f.closest(".zmL").attr("data-atid")],d&&d.constructor===Object&&zmUtil.initAttSlideShow({attObjList:[d],startIndex:0,hideAllOptions:!0}))},a.myAttachment.appendAttachment=function(a){var b,c=this;b=Array.isArray(a)?a:[a],"function"==typeof this.configJSON.beforeAttach?this.configJSON.beforeAttach(function(){h.call(c,b)}):h.call(c,b)},a.myAttachment.modifyCheckedAttachmentArray=function(a){var b=a,c=this.selectedattachUtilectsArr.indexOf(_.findWhere(this.selectedattachUtilectsArr,{uniqueId:b}));c>=0?(this.selectedattachUtilectsArr.splice(c,1),l.call(this,b)):(this.selectedattachUtilectsArr.push(this.attachUtil.attDet[b]),k.call(this,b))},a.myAttachment.markSelectedAttachmentInUI=function(){var a,b,c,d;for(c=0,d=this.selectedattachUtilectsArr.length;c<d;c++)a=this.selectedattachUtilectsArr[c].uniqueId,b=this.dialog.$el.find("div[data-atid='"+a+"']"),b.length&&b.addClass("SC_check")},a.myAttachment.onAttachHandler=function(){var c,d,e,f,g,h,i,j;if(a.utility.isAttachmentSelected(this.selectedattachUtilectsArr.length)){for(c=this.selectedattachUtilectsArr,d=this.configJSON.maxAttachedSize,e=this.configJSON.currentAttachedSize,f=b,i=0,j=c.length;i<j;i++)if(e+=zmAttachUtility.parseToNumber(c[i].fs||0),e>d){e-=zmAttachUtility.parseToNumber(c[i].fs||0),c=c.splice(0,i),g=d/1048576,h=j-i,zmUtil.succErrMsg("e",f.maxSizeErr1+" "+g+" "+f.maxSizeErr2+" ,"+h+" "+f.maxSizeErr3,void 0,5e3);break}this.closeThisAppView(),a.myAttachment.appendAttachment.call(this,c)}}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){"use strict";a.zDocs={},a.zDocs.invokeZDocsComponent=function(a){var b=a.attr("id"),c=zmComponent.loadingBand({container:a[0],type:"pagination"}),d={servicename:"zmail",docsURL:"//"+zmail.urls.docsURL,container_id:b,isnewui:!0};ZDDialog.closePopUp("zdattachcontainer"),d.height=a.height()+100,d.width=a.width();var e=new MutationObserver(function(a){c(),a.forEach(function(a){"childList"===a.type&&a.addedNodes&&a.addedNodes.length&&Array.prototype.forEach.call(a.addedNodes,function(a){"zdattachcontainer"===$(a).attr("id")&&($(a).find("#mainPanelforservicefiles").css("margin","0px"),e.disconnect())})})});e.observe(a[0],{childList:!0}),ATTACHDIALOG.showAttachFileDialog(d)},a.zDocs.attachZDocsDocument=function(){var b=ATTACHDIALOG.getSelectedDocs(),c=[],d={},e=b.length;if(a.utility.isAttachmentSelected(e)){ZDDialog.closePopUp("zdattachcontainer"),this.closeThisAppView();for(var f=0;f<e;f++){var g=b[f],h={};h.docId=g.docId,h.docName=g.docName,h.docType="zw"!==g.service?g.service:"writer",c.push(h)}if(d.zohodocs=c,d=JSON.stringify(d),this.asLink){var i={};i.docObj=d,i.eprm={cmpId:zmUtil.zmsubStr(this.configJSON.componentId,"zmEdi_"),tol:e},i.loadType="link",this.configJSON.insertDocsLink(i)}else this.cloudUpload(d,e,zmUtil.zmsubStr(this.configJSON.componentId,"zmEdi_"),"z")}}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){"use strict";a.gagets={},a.gagets.invokeGadgetComponent=function(a){var b,c=a.getCenterElem(),d="Cmp1",e=$(zmAttachment.templates.cloudFrame),f=zmComponent.loadingBand({container:c[0],type:"pagination"});b=zmail.urls.gadURL+"/CloudPicker?sources=gdrive,dropbox,skydrive,box,evernote&purpose=mailView&zservice=zmail&disableSync=gdrive,dropbox,skydrive,box,evernote&serURL=",b+=location.protocol+"//"+window.location.hostname+zmail.conPath+"/jsp/cloudPicker.jsp?cmpId="+d,e.attr("src",b),e.on("load",function(){f()}),c.append(e)}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){"use strict";function b(a){var b,c,d=!1;return c=o.TYPE.split(","),b=a.type.substr(0,a.type.lastIndexOf("/")+1)+"*",(c.indexOf(a.type)>=0||c.indexOf(b)>=0||c.indexOf("."+zmUtil.fileTyp(a.name)[2])>=0)&&(d=!0),d}function c(a){return b(a)}function d(a){return a.size<=o.MAX_SIZE}function e(a){a.find("#blkMaskWthBtn").show(),a.on("mouseover",function(){a.find("#blkMaskWthBtn").css("opacity",1)}),a.on("mouseleave",function(){a.find("#blkMaskWthBtn").css("opacity",0)})}function f(a){a.off("mouseover mouseleave")}function g(b,c){var d,f,g=$("<img>"),h=a.utility.createObjectURL(b),i=15;n=b,d=c instanceof $?c:c.getCenterElem("insertImage"),f=d.find(".SC_mclst"),g[0].onload=function(){d.find(".SC_drop.SC_dropW100").hide(),e(d),a.utility.revokeObjectURL(h)},g.attr("src",h).css({maxWidth:f.width()-i,maxHeight:f.height()-i}).addClass("upldIMG"),f.append(g)}function h(a,b){var e;c(a)?d(a)?g(a,b):(e=p.maxSizeErr1+zmUtil.sizeConv(o.MAX_SIZE),zmUtil.succErrMsg("e",e)):(e=zmText.applyArgs(p.insertImage.typeerror,{ftype:"[JPG/JPEG/PNG/GIF]"}),zmUtil.succErrMsg("e",e))}function i(a,b){var c,d,e=a.clipboardData.items;for(d=0;d<e.length;++d)"file"===e[d].kind&&e[d].type.indexOf("image/")!==-1&&(c=e[d].getAsFile(),c&&(c.name||(c.name=o.filename+".png"),h(c,b)))}function j(a){var b;$("#zmAttach_file_Desktop").remove(),$("body").append(zmAttachment.templates.browseInputEle("zmAttach_file_Desktop","zmAttach_Desktop")),b=$("#zmAttach_file_Desktop"),b.attr("accept",o.TYPE),b.off("change").on("change",function(b){var c=b.target||b.srcElement;return h(c.files[0],a),this.value="",!1}),b.click()}function k(){var b=this;a.imageEditTool.init.call(this,{file:n,onAttach:function(a){var c=b.dialog.getCenterElem("insertImage");n=a.blob,n.name=o.filename+".png",c.find(".SC_mclst img").remove(),g(n,c)}})}function l(){var a=this.dialog.getCenterElem("insertImage");a.find(".SC_mclst img").remove(),a.find("#blkMaskWthBtn").hide(),a.find(".SC_drop.SC_dropW100").show(),f(a)}function m(){var b,c,d=this,g=a.utility.createXHR(),h=new window.FormData,i=zmAjq.getCookie("zmcsr"),j=o.filename+"."+zmUtil.fileTyp(n.name)[2],k=this.insertImage.requireParamToUpload||{};this.insertImage.ignoreFileNameParam||h.append(this.insertImage.fileNameParam||"fileName",encodeURIComponent(j)),h.append(this.insertImage.imgFileParamName||"attach",n,j),h.append("zmrcsr",i);for(c in k)k.hasOwnProperty(c)&&h.append(c,k[c]);b=function(){var a=d.dialog.getCenterElem("insertImage");a.find("#uploadMask").hide(),a.find("#progressbar").hide(),e(a)},g.upload.addEventListener("loadstart",function(){var a=d.dialog.getCenterElem("insertImage");q=!0,a.find("#uploadMask").show(),a.find("#progressbar").show(),a.find("#progressIndicator").width("1%"),f(a)},!1),g.upload.addEventListener("progress",function(a){var b=Math.round(100*a.loaded/a.total);d.dialog.getCenterElem("insertImage").find("#progressIndicator").width(b+"%")},!1),g.onreadystatechange=function(){if(4===g.readyState){if(200===g.status){var a=$.parseJSON(g.responseText);q=!1,a.fP||a.storeName||1===a[0]?(d.insertImage.onUpload(a),d.closeThisAppView()):"string"==typeof a.emsg?(d.dialog.showSuccErrMsg("e",a.emsg.replace(/\\x20/g," ")),b()):(d.dialog.showSuccErrMsg("e",p.insertImage.inserterror),b())}}else 500!==g.status&&400!==g.status||(q=!1,d.dialog.showSuccErrMsg("e",p.insertImage.inserterror),b())},g.open("POST",this.insertImage.uploadAPI,!0),g.send(h)}a.insertImage={};var n,o={MAX_SIZE:3145728,TYPE:".png,.jpg,.jpeg,.gif",filename:"inline"},p=zmText.get("attachComponent"),q=!1,r=function(){return zmAttachment.templates.insertImageLoading};return a.insertImage.clear=function(){n=void 0,q=!1},a.insertImage.getTabConfig=function(a){var b=this,c={id:"insertImage",text:p.cloudServiceName.insertImage,tabName:"insertImage",selected:a,listingArea:{classes:"SC_mclst",styles:{overflow:"hidden"},parEle:$('<div class="SCmc SC_attachviewer"></div>')},buttons:[{text:p.button.insert,onClk:function(){q||(n?m.call(b):zmUtil.succErrMsg("e",p.insertImage.pleaseattach))}}]};return c},a.insertImage.dialogDidMount=function(a){var b=a.getCenterElem("insertImage");b.append(zmAttachment.templates.dragdropArea),b.find(".SC_mclst").append(zmAttachment.templates.insertImageMaskBtn,zmAttachment.templates.blackMask,r())},a.insertImage.pasteHandler=function(){var a;arguments[0]instanceof window.Blob?(a=arguments[0],a.name||(a.name=o.filename+".png"),h(a,arguments[1])):i(arguments[0],arguments[1])},a.insertImage.bindEventsToTab=function(b){function c(a){var c=a[0];h(c,b)}var d,e=b.getCenterElem("insertImage");e.find(".SC_drop").click(function(){j(b)}),a.utility.setDragDrop({onDrop:c,onDragLeave:function(){},onDragover:function(){},$centerEle:b.getCenterElem("insertImage"),$dropMsgEle:b.getCenterElem("insertImage")}),d=e.find("#blkMaskWthBtn .blkMaskBtn"),d.eq(0).on("click",k.bind(this)),d.eq(1).on("click",l.bind(this)),this.insertImage.type&&(o.TYPE=this.insertImage.type),this.insertImage.maxSize&&(o.MAX_SIZE=this.insertImage.maxSize)},a.insertImage.isUploading=function(){return!0},a}(window.zmAttachComponent=window.zmAttachComponent||{});