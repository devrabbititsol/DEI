function Screengrabber(){}var ZFeedback=function($){var dialogOpen=!1,zfeedbackKeys={"minimize.label":"Minimize","maximize.label":"Maximize","cancel.label":"Cancel","send.label":"Send","resend.label":"Resend","feedback.label":"Feedback","criticality.label":"Criticality","howcritical.label":"How critical is your feedback?","normal.label":"None","low.label":"Just FYI","medium.label":"Nothing urgent, can wait","high.label":"Emergency","subject.label":"Subject","comments.label":"Your Comments...","attachfile.label":"Attach File","screengrab.label":"Grab Screen","sending.label":"Sending...","thankyou.label":"Thank you","writesome.label":"Please write something...","invalidsizemessage.label":"File size exceeds the maximum allowed attachments limit of {0}.","removefile.label":"Remove","sendrequest.label":"Send Your Request","description.label":"Description","howcriticalrequest.label":"How critical is your request?","cancelfeedback.label":"Do you want to cancel this feedback?","cancelrequest.label":"Do you want to cancel this request?","alertmessage.label":'Press "OK" to proceed. "Cancel" to stay.',"screenshot.label":"Screenshot","unknownerror.label":"Sending failed due to an unknown error","close.label":"Close","viruspresent.label":"Virus found","collapse.label":"Collapse","expand.label":"Expand","attachments.label":"Attachments","tip.label":"Tip","usekeyboardshortcuts.label":"To grab the screen directly from the application window, use the below keyboard shortcuts","capturefullscreen.label":"Capture full screen","capturepartofscreen.label":"Capture part of the screen","unknownerrortext.label":"Unknown error","virusdetected.label":"Virus detected in the attached file. Please remove it.","virusdetectedinfile.label":"Virus detected in {0}. Please remove it.","unknownerrorinfile.label":"Unable to attach {0} due to an unknown error.","multiplefileserror.label":"{0} file(s) failed to upload. Please refer below for the reasons.","fileuploadinprogress.label":"File upload is in progress. Please send after it is complete.","multiplefilesuploadinprogress.label":"Uploading {0} files. Please send after they are complete."},zfeedbackDEFAULTS={minHeight:350,maxHeight:550,formType:"support",attachment:!0,criticality:!0,screengrabber:!0,attachmentURL:void 0,submitURL:void 0,customData:void 0,sendTo:"noreply@zohocorp.com",customHeaders:{}},zfeedback={widgetEventPrefix:"zfeedback",_EVENTS:{ONOPEN:"open",BEFORESEND:"beforesend",ONSEND:"send",ONSENDING:"sending",ONCLOSE:"close"},_isScreengrabberOpen:!1,_create:function(options){var base=this;this._formData={criticalType:"",mailSubject:"",mailContent:"",randomNumber:""},this.options=$.extend({},zfeedbackDEFAULTS,options),this._haveCustomKeys=void 0!==this.options.keys,this._customKeys=this.options.keys,this.options.keys=$.extend({},zfeedbackKeys,this.options.keys),this._windowObj=$(window),this._documentObj=$(document);var windowHeight=this._windowObj.innerHeight();this._dialogHeightAdjustment();var dialogWidth=530;dialogOpen=!0,this._dialogTop=windowHeight-this._dialogHeight;var dialogLeft=this._windowObj.innerWidth()-(dialogWidth+140);this.options.customData?this._feedbackData={sendTo:this.options.sendTo}:(this._feedbackData={sendTo:this.options.sendTo},this._feedbackData[FComponents.option("csrfParamName")]=FCUtil.getCSRFToken()),this._contextPath=FComponents.option("contextPath"),this.options.postURL&&(this._contextPath=this.options.postURL),(this.options.attachmentURL||this.options.postURL)&&(this._externalAttachmentURL=!0),(this.options.submitURL||this.options.postURL)&&(this._externalSubmitURL=!0),this._isTooltipComponentUsed=this._documentObj.data("zZtooltip")?!0:!1,this.options.proxyURL=(this.options.attachmentURL?this.options.attachmentURL.substring(0,this.options.attachmentURL.lastIndexOf("/")+1):this._contextPath)+"proxy.do",this.options.fileActionURL=this.options.attachmentURL?this.options.attachmentURL:this._contextPath+"fileaction.do",this._fileData={},this._overallArray=[],this._currAttachmentSize=0,this._attachmentArray=[],this._originalEvent=!1,this._dialogDragged=!1,this._isIE=!1,this._filesPending=!1,this._isEnterDisabled=!1,this._isFeedbackCancelled=!1,this._screengrabberAttached=!1,this._isSuccessful=!1,this._maxAllowedSize=15728640,this._canvasQuart=Math.PI/2,this._canvasCirc=2*Math.PI,this._IE=!1,this._randomNumber=this._randomString(),this._isMacOS()?(this._fullScreen=["Command","Option","Shift","3"],this._partialScreen=["Command","Option","Shift","4"]):(this._fullScreen=["Ctrl","Alt","PrtSc"],this._partialScreen=["Ctrl","Shift","PrtSc"]),this._screenshotCount=0,this._totalScreenshotCount=0,this._fileCount=0,this._uploadedCount=0,this._feedbakDialog=$("<div>").attr({id:"zfeedbackDialog"}).appendTo($("body")),this._feedbakDialog.zdialog({modal:!1,minimizable:!0,position:[dialogLeft,windowHeight],closeOnEscape:!0}),this._feedbakDialog.dialog("option",{width:dialogWidth,height:this._dialogHeight,dialogClass:"ui-zfeedback",minWidth:400,minHeight:this.options.minHeight,resizable:!1,beforeClose:function(ev){return base._checkClose(ev)?void 0:!1},close:function(){base._close()}}),this._feedbackUiDialog=this._feedbakDialog.closest(".ui-dialog").attr("id","ui-zfeedback-dialog"),this._titlebar=this._feedbackUiDialog.find(".ui-dialog-titlebar"),this._createFeedbackContainer(),this._feedbakDialog.dialog("open"),this._dialogPosition={},this._feedbackUiDialog.css({opacity:0,top:this._dialogTop+200,left:"auto",right:"120px"}).animate({top:this._dialogTop,opacity:1},300,"easeInSine",function(){base._resizeTextArea(),$(this).css({top:$("#ui-zfeedback-dialog").offset().top,height:base._dialogHeight}),base._dialogPosition.left=base._feedbackUiDialog.offset().left,base._dialogPosition.top=base._feedbackUiDialog.offset().top}),this._feedbackUiDialog.find(".ui-dialog-titlebar .ui-icon").removeClass("ui-icon ui-components-icon").addClass("ui-fcomponents-icon").text(""),this._feedbackUiDialog.find(".ui-dialog-titlebar .ui-dialog-titlebar-close").first().attr("title",FCUtil.getString("cancel.label")).find("span.ui-icon-closethick").attr("class","ui-fcomponents-icon ui-zfc-icon-closethick"),this._isPlaceholder&&this._feedbackSubject.trigger("focusout.placeholder"),this._triggerEvent(this._EVENTS.ONOPEN),this._minimizeBtn=this._titlebar.find(".ui-dialog-titlebar-minimize").attr("title",FCUtil.getString("minimize.label")),$("body").on("screengrabberopen",function(){$("#ui-zfeedback-dialog").hide()}).off("screengrabberclose").on("screengrabberclose",function(){$("#ui-zfeedback-dialog").show(),base._isScreengrabberOpen=!1,!base._screengrabberAttached&&base._screenshotFallEle&&base._screenshotFallEle.remove(),base._focussedEle=$(base._screenGrabLabel)[0],$(base._focussedEle).focus(),base._screengrabberAttached=!1,$("body").off("screengrabberdone")})},_checkClose:function(ev){return this._originalEvent?!0:ev.originalEvent&&"keydown"===ev.originalEvent.type&&(this._criticalPopup.is(":visible")||this._isScreengrabberOpen)?!1:this._screenshotSize||this._fileSize||this._feedbackSubject.val()||this._feedbackCommentArea.val()||this._currAttachmentSize?(this._alertDialog(),$(".ui-alert-dialog").css({top:"50%",left:"50%","margin-left":"-200px","margin-top":"-110px"}),$(".ui-alert-dialog .ui-dialog-content").css({padding:"0px !important"}),void 0):!0},_alertDialog:function(){var base=this;ZComponents.showMessageDialog({type:"warning",secondary:base._getString(base._cancelForm+".label"),icon:"ui-zalert-warning",commandType:"yes-no",onClose:function(args){args.isCancel?$(base._focussedEle).is("textarea")?base._feedbackCommentArea.focus():base._feedbackSubject.focus():(base._currAttachmentSize&&base._removeAllFiles(),base._close())}})},_close:function(){dialogOpen=!1,$("body").off("mousedown.zfeedback"),$("body").off("mousedown.errorBanner"),this._feedbakDialog.off("keydown.zfeedback"),this._triggerEvent(this._EVENTS.ONCLOSE),this._feedbakDialog.remove()},close:function(){this._close()},_createFeedbackContainer:function(){var base=this,title="sendrequest",content="description",criticality="howcriticalrequest";this._cancelForm="cancelrequest";var dialogTitle=this._feedbackUiDialog.find(".ui-dialog-titlebar .ui-dialog-title");if(this._feedbackForm=$("<div>").attr("id","ui-zfb-form").appendTo(this._feedbakDialog),this._feedbackFormTop=$("<div>").attr("id","ui-zfb-form-top").appendTo(this._feedbackForm),"feedback"==this.options.formType&&(title="feedback",content="comments",criticality="howcritical",this._cancelForm="cancelfeedback"),this._feedbakDialog.dialog("option","title",this._getString(title+".label")),this._errorBanner=$("<div>").attr("class","ui-zfb-error-unknown").html("<span>"+this._getString("unknownerror.label")+'</span><label><span class = "ui-fcomponents-icon ui-zfc-icon-closethick"> </span></label>'),this._feedbakDialog.prepend(this._errorBanner),this._errorBanner.on("mouseenter.zfeedback",function(){$(this).find("span.ui-zfc-icon-closethick").show()}).on("mouseleave.zfeedback",function(){$(this).find("span.ui-zfc-icon-closethick").hide()}),this._feedbackSubject=$("<input>").attr({id:"zfb-input-subject",type:"text",tabindex:1,maxlength:500}).appendTo(this._feedbackFormTop),this._focussedEle=this._feedbackSubject[0],this._overallArray.push($(this._feedbackSubject)[0]),this._isPlaceholder=void 0===this._feedbackSubject[0].placeholder||null===this._feedbackSubject[0].placeholder||-1!==navigator.appVersion.indexOf("MSIE 10."),this._feedbackFormMiddle=$("<div>").attr("id","ui-zfb-form-middle").appendTo(this._feedbackForm),this._feedbackCommentArea=$("<textarea>").attr({id:"zfb-input-message",tabindex:2,maxlength:1e4}).appendTo(this._feedbackFormMiddle),this._overallArray.push($(this._feedbackCommentArea)[0]),this._feedbackSubject.add(this._feedbackCommentArea).on("keypress.feedback paste.feedback",function(){setTimeout(function(){base._isErrorShown&&(base._isPlaceholder?base._subjectText.attr("class","ui-zfb-placeholder").text(FCUtil.getString("subject.label")):base._feedbackSubject.attr({placeholder:FCUtil.getString("subject.label"),"class":""}))},1)}),this._isPlaceholder){this._subjectText=$("<div>").attr("class","ui-zfb-placeholder").text(FCUtil.getString("subject.label")),this._feedbackFormTop.prepend(this._subjectText),this._placeHolder(this._feedbackSubject,this._subjectText);var commentText=$("<div>").attr("class","ui-zfb-placeholder").text(this._getString(content+".label"));this._feedbackFormMiddle.prepend(commentText),this._placeHolder(this._feedbackCommentArea,commentText)}else this._feedbackSubject.attr("placeholder",FCUtil.getString("subject.label")),this._feedbackCommentArea.attr("placeholder",this._getString(content+".label"));this._attachmentContainer=$("<div>").attr("id","ui-ztb-form-attach-container").appendTo(this._feedbackForm),this._attachmentHeader=$("<div>").attr("class","ui-ztb-form-attach-header ").appendTo(this._attachmentContainer),this._attachmentInner=$("<div>").attr("class","ui-ztb-form-attach-inner").appendTo(this._attachmentContainer),this._attachmentCount=$("<div>").attr("class","ui-ztb-form-attach-count").append("<b>"+base._getString("attachments.label")+" ("+base._uploadedCount+")</b>").appendTo(this._attachmentHeader),this._attachmentTempHeader=$("<div>").attr("class","ui-ztb-form-attach-temp-header").appendTo(this._attachmentContainer),this._attachmentErrorHeader=$("<div>").attr("class","ui-zfb-form-attach-errorheader").append('<div><span class="ui-fcomponents-icon ui-zfc-icon-feedback-attachmentheader-error"></span> <div class = "ui-zfb-form-error-headertext"></div></div>').appendTo(this._attachmentHeader),this._isPlaceholder||-1!==navigator.appVersion.indexOf("MSIE 10.")?(this._isIE=!0,this._attachmentHeader.addClass("ui-zfb-transform-unsupported"),this._attachmentCount.css({top:"0px",position:"relative"}),this._attachmentErrorHeader.css({top:"-62px",position:"relative"})):(this._attachmentHeader.addClass("flip-to-top cube"),this._attachmentCount.addClass("default-state"),this._attachmentErrorHeader.addClass("active-state")),$('<span class = "ui-fcomponents-icon ui-zfc-icon-feedback-attachmentheader-collapse"></span>').attr("title",this._getString("collapse.label")).appendTo(this._attachmentCount),this._feedbackFormBottom=$("<div>").attr("id","ui-zfb-form-bottom").appendTo(this._feedbackForm),this._fileContainer=$("<div>").attr("id","ui-zfb-form-others").appendTo(this._feedbackFormBottom);var invalidSizeMessage="";if((this.options.screengrabber||this.options.attachment)&&(invalidSizeMessage=base._getString("invalidsizemessage.label","zfeedback",[this._bytesToSize(this._maxAllowedSize)])),this.options.attachment){var uploadTooltip='{"componentOptions":{"content":"'+FCUtil.getString("attachfile.label")+'","callout":"south"}}';this._isTooltipComponentUsed||(uploadTooltip=FCUtil.getString("attachfile.label")),this._uploadLabel=$("<label>").attr({title:uploadTooltip,tabindex:3}).appendTo(this._fileContainer),this._overallArray.push($(this._uploadLabel)[0]),this._uploadBtn=$("<input>").attr({type:"file",id:"ui-zfb-file",name:"fileAttachment",multiple:""}).appendTo(this._uploadLabel);{$("<span>").attr("class","ui-fcomponents-icon ui-zfc-icon-attach").appendTo(this._uploadLabel)}this._uploadBtn.on("change.feedback",function(ev){var file,fileSize,mimeType;if("undefined"!=typeof FileReader)for(var i=0;i<base._uploadBtn[0].files.length;++i){var targetELe=ev.originalEvent.target||ev.originalEvent.srcElement;if(file=targetELe.files[i],fileSize=file.size,mimeType=file.type,base._currAttachmentSize+=fileSize,invalidSize=base._currAttachmentSize>base._maxAllowedSize?!0:!1)return base._clearFile($(this)),base._currAttachmentSize-=fileSize,ZComponents.showMessageDialog({type:"alert",secondary:invalidSizeMessage,icon:"ui-zalert-error"}),$(".ui-alert-dialog").css({top:"50%",left:"50%","margin-left":"-200px","margin-top":"-110px"}),!1;base._attachFile(file.name,fileSize,mimeType,file)}else{file=base._uploadBtn[0],fileSize=file.size,mimeType=file.type,base._currAttachmentSize+=fileSize;var path=document.getElementById("ui-zfb-file").value,fileName=path.match(/[^\/\\]+$/);base._attachFile(fileName[0],fileSize,mimeType,file)}setTimeout(function(){base._notSupportedBrowser=!1,base._virusPresent=!1},2e3)}),this._errorBanner.find("label").on("click",function(){$(this).parent().fadeOut(300)}),this._feedbakDialog.on("drop.feedback",function(ev){ev.preventDefault(),ev.stopPropagation()}).on("dragenter.feedback dragover.feedback",function(ev){ev.preventDefault()})}if(this.options.screengrabber){this._toolTipContainer=$("<div>").attr("id","ui-zsg-toolTipContainer").appendTo("body"),$("<span>").text(FCUtil.getString("screengrab.label")).appendTo(this._toolTipContainer),$("<span>").attr("class","ui-zfb-tooltip-grabscreen-iconholder").append($("<span>").addClass("ui-fcomponents-icon ui-zfc-icon-feedback-tip")).appendTo(this._toolTipContainer);var _screenGrabTooltip='{"componentOptions":{"content":"ui-zsg-toolTipContainer", "contentType": "html","isContentElementId":true,"callout":"south","containerClass":"ui-zfb-tooltip-grabscreen","autohide":false}, "noautohide" :true}';this._isTooltipComponentUsed||(_screenGrabTooltip=FCUtil.getString("screengrab.label")),this._screenGrabLabel=$("<label>").attr({id:"screenGrabLabel",title:_screenGrabTooltip,tabindex:4}).appendTo(this._fileContainer),this._overallArray.push($(this._screenGrabLabel)[0]),$("<span>").attr("class","ui-fcomponents-icon ui-zfc-icon-screengrabber").add($("<input style= display:none;>")).appendTo(this._screenGrabLabel),this._screenGrabLabel.on("click",function(orgEvent){base.options.criticality&&base._criticalPopup.is(":visible")&&base._criticalPopup.fadeOut(100),orgEvent.preventDefault(),orgEvent.stopPropagation(),base._attachScreenGrab()}).on("mouseenter.feedback",function(){$("#ui-zsg-toolTipContainer").removeClass("ui-zfb-tip-icon-hide")}),this._screenGrabLabel.on("mousedown mouseup",function(orgEvent){orgEvent.preventDefault(),orgEvent.stopPropagation()}),this._documentObj.on("click.feedback",".ui-ztooltip.ui-zfb-tooltip-grabscreen .ui-zfc-icon-feedback-tip",function(){if(!base._overalDiv||!base._overalDiv.is(":visible")){var toolTipEle=$(".ui-ztooltip.ui-zfb-tooltip-grabscreen");base._shortcutKeyNotify(toolTipEle,!1,!0)}}).on("mouseleave.feedback",".ui-ztooltip.ui-zfb-tooltip-grabscreen",function(){$(this).hide()})}if(this.options.criticality){var _criticalityTooltip='{"componentOptions":{"content":"'+this._getString("criticality.label")+'","callout":"south"}}';this._isTooltipComponentUsed||(_criticalityTooltip=this._getString("criticality.label"));var criticalStatus=$("<label>").append("<input></input>").appendTo(this._fileContainer).attr({"class":"ui-zfb-criticality-button",title:_criticalityTooltip,tabindex:5}).on("click",function(){base._criticalPopup.is(":visible")||($("body").on("mousedown.base._criticalpopup",function(e){$(this).off("mousedown.base._criticalpopup"),setTimeout(function(){base._criticalPopup.fadeOut(100),criticalStatus.removeClass("ui-zfb-field-focus")},200),e.target===criticalStatus[0]&&e.preventDefault(),base._feedbakDialog.off("keydown.base._criticalpopup")}),base._feedbakDialog.on("keydown.base._criticalpopup",function(e){return 27===e.which||13===e.which||9===e.which?($("body").trigger("mousedown.base._criticalpopup"),$(this).off("drag.base._criticalpopup")):40===e.which?criticalPopupUl.find("li.ui-zfb-critical-selected").next().trigger("mousedown.li"):38===e.which&&criticalPopupUl.find("li.ui-zfb-critical-selected").prev().trigger("mousedown.li"),!1}),base._criticalPopup.css({bottom:base._feedbackFormBottom.outerHeight()+1}).fadeIn(100),criticalStatus.addClass("ui-zfb-field-focus"))});this._overallArray.push($(criticalStatus)[0]),this.optionList={normal:this._getString("normal.label"),low:this._getString("low.label"),medium:this._getString("medium.label"),high:this._getString("high.label")},this._criticalPopup=$("<div>").attr("class","ui-zfb-critical-popup").appendTo(this._feedbackFormBottom);var criticalPopupUl=($("<span>").text(this._getString(criticality+".label")).appendTo(this._criticalPopup),$("<ul>").appendTo(this._criticalPopup));for(var option in this.optionList)criticalPopupUl.append($("<li>").attr("criticality-level",option).text(this.optionList[option]).append($("<div>")));this._formData.criticalType="",criticalPopupUl.find("li").on("mousedown.li",function(){var rectangle=$(this).children("div");criticalPopupUl.find("div").css("background-color",""),rectangle.css("background",""),criticalPopupUl.find("li").removeClass("ui-zfb-critical-selected"),$(this).addClass("ui-zfb-critical-selected");var criticality=$(this).attr("criticality-level");criticalStatus.attr("criticality-level",criticality),base._formData.criticalType="normal"===criticality?"":base.optionList[criticality],setTimeout(function(){rectangle.css("background-color",rectangle.css("border-left-color"))},20)});var className="ui-zfb-critical-popup-arrow";this.options.screengrabber&&this.options.attachment||(className="ui-zfb-critical-popup-arrow ui-zfb-arrow-leftdjustment");{$("<div>").attr("class",className).appendTo(this._criticalPopup)}criticalPopupUl.find("li:first-child").trigger("mousedown.li")}$("body").on("mousedown.zfeedback",function(e){var temp;base._focussedEle&&$(base._focussedEle).removeClass("ui-zfb-field-focus"),temp="span"==e.target.tagName.toLowerCase()||"file"==e.target.tagName.toLowerCase()?$(e.target).parent():$(e.target),base._overallArray.indexOf($(temp)[0])>-1&&(base._focussedEle=temp)}),base._feedbakDialog.on("keydown.zfeedback",function(e){if(9!==e.which||e.shiftKey)if(e.shiftKey&&9==e.keyCode){do base._tabNavigation(e,!0);while(!$(base._focussedEle).is(":visible"))}else 13===e.which&&$(base._focussedEle).is(":visible")&&(1!==base._overallArray.indexOf($(base._focussedEle)[0])&&e.preventDefault(),base._isEnterDisabled||$(base._focussedEle).trigger("click",!0));else do base._tabNavigation(e);while(!$(base._focussedEle).is(":visible"))}),this._feedbackUiDialog.off("dialogdragstop").on("dialogdragstop",function(){base._dialogDragged=!0,base._dialogPosition.left=base._feedbackUiDialog.offset().left,base._dialogPosition.top=base._feedbackUiDialog.offset().top}),this._flipOver=void 0,this._zfeedbackSendbutton=$("<button>").attr("tabindex",6).text(FCUtil.getString("send.label")).appendTo(this._fileContainer).on("click",function(){if(clearTimeout(base._flipOver),clearTimeout(base._removeHeader),base._errorBanner.css("top","-36px").hide(),0!==base._feedbackSubject.val().length||0!==base._feedbackCommentArea.val().length)if(base._attachmentInner.find(".ui-ztb-filename-container").hasClass("ui-zfb-file-error"))base._attachmentErrorHeader.children().animate({"margin-left":6},50).animate({"margin-left":-6},50).animate({"margin-left":6},50).animate({"margin-left":-6},50).animate({"margin-left":0},50),base._attachmentInner.animate({scrollTop:base._attachmentInner.find(".ui-zfb-file-error:first").offset().top-base._attachmentInner.offset().top+base._attachmentInner.scrollTop()});else if(base._areAttachmentsPending())base._attachmentHeader.hasClass("flip-over")||base._attachmentHeader.hasClass("slide-down")?base._attachmentErrorHeader.children().animate({"margin-left":6},50).animate({"margin-left":-6},50).animate({"margin-left":6},50).animate({"margin-left":-6},50).animate({"margin-left":0},50):base._filesPendingHandle(),base._flipOver=setTimeout(function(){clearTimeout(base._flipOver),base._attachmentCount.show(),base._zfeedbackSendbutton.attr("disabled",!0),base._isIE?(base._slideAnimation(!0),base._attachmentHeader.removeClass("slide-down")):base._attachmentHeader.removeClass("flip-over"),base._removeHeader=setTimeout(function(){clearTimeout(base._removeHeader),base._attachmentErrorHeader.removeClass("ui-zfb-form-attach-pendingheader").find("span").removeClass("ui-zfc-icon-feedback-attachmentheader-info").addClass("ui-zfc-icon-feedback-attachmentheader-error"),base._zfeedbackSendbutton.attr("disabled",!1)},250)},2500);else{base._feedbackSubject.removeClass("ui-zfb-input-error"),$(this).attr("disabled",!0),base._isEnterDisabled=!0,base._triggerEvent(base._EVENTS.ONSENDING),base._sendFeedback();var formChanges=base._triggerEvent(base._EVENTS.BEFORESEND,base._feedbackData);base._feedbackData=$.extend({},base._feedbackData,formChanges);{var callbacks={progress:function(){},success:function(){base._isResponseReceived=!0,base._isSuccessful=!0,base._triggerEvent(base._EVENTS.ONSEND)},fail:function(){base._isResponseReceived=!0,base._isEnterDisabled=!1,base._isSuccessful=!1}},postURL=base.options.submitURL?base.options.submitURL:base._contextPath+"sendfeedback.do";base._submitRequest(postURL,base._feedbackData,callbacks,base._externalSubmitURL)}base._isErrorShown=!1}else{base._isIE?base._feedbackCommentArea.trigger("focus"):base._feedbackSubject.trigger("focus"),base._focussedEle=base._feedbackSubject;var currLeft=base._feedbackUiDialog.position().left;base._dialogDragged?base._feedbackUiDialog.animate({left:currLeft+6},50).animate({left:currLeft-6},50).animate({left:currLeft+6},50).animate({left:currLeft-6},50).animate({left:currLeft},50):base._feedbackUiDialog.animate({"margin-right":6},50).animate({"margin-right":-6},50).animate({"margin-right":6},50).animate({"margin-right":-6},50).animate({"margin-right":0},50),$(this).removeClass("ui-zfb-field-focus"),base._isPlaceholder?base._subjectText.addClass("ui-zfb-input-error").text(base._getString("writesome.label")):base._feedbackSubject.attr("placeholder",base._getString("writesome.label")),base._isErrorShown=!0,base._feedbackSubject.addClass("ui-zfb-input-error").off("focus.zfeedback").on("keypress.zfeedback",function(){base._isPlaceholder?base._subjectText.removeClass("ui-zfb-input-error").text(FCUtil.getString("subject.label")):base._feedbackSubject.removeClass("ui-zfb-input-error").attr("placeholder",FCUtil.getString("subject.label")),base._isErrorShown=!1})}}).on("keyup",function(ev){13!==ev.keyCode&&32!==ev.keyCode||0!==base._feedbackSubject.val().length&&0!==base._feedbackCommentArea.val().length||base._isPlaceholder||base._feedbackSubject.trigger("focus")}),this._overallArray.push($(this._zfeedbackSendbutton)[0]),this._feedbakDialog.on("zdialogminimize",function(){dialogTitle.addClass("ui-zfb-title-ellipsis"),dialogTitle[0].offsetWidth<dialogTitle[0].scrollWidth&&dialogTitle.attr("title",dialogTitle.text()),base._feedbackUiDialog.css({left:"auto",top:"auto"}),base._minimizeBtn.attr("title",FCUtil.getString("maximize.label"))}).on("zdialogmaximize",function(){dialogTitle.removeAttr("title").removeClass("ui-zfb-title-ellipsis"),base._minimizeBtn.attr("title",FCUtil.getString("minimize.label")),base._feedbackUiDialog.css({left:base._dialogPosition.left,top:base._dialogPosition.top})}),this._attachmentCount.on("click.zfeedback",function(){base._attachmentContainer.hasClass("ui-zfb-file-attach-collapse")?(base._attachmentContainer.add(base._attachmentCount.children("span").attr("title",base._getString("collapse.label"))).removeClass("ui-zfb-file-attach-collapse"),base._isAttachmentCollapsed=!1):(base._attachmentContainer.add(base._attachmentCount.children("span").attr("title",base._getString("expand.label"))).addClass("ui-zfb-file-attach-collapse"),base._isAttachmentCollapsed=!0),base._resetTextArea()}),this._attachmentInner.on("scroll.zfeedback",function(){base._attachmentInner.scrollTop()}),setInterval(function(){base._isOnline()?base._isConnectionFail&&(base._zfeedbackSendbutton.attr("disabled",!1).removeClass("ui-zfb-disable"),base._isConnectionFail=!1):base._isConnectionFail||(base._zfeedbackSendbutton.attr("disabled",!0).addClass("ui-zfb-disable"),base._isConnectionFail=!0)},5e3),this._windowObj.on("resize.zfeedback",function(){base._dialogDragged||(base._dialogHeightAdjustment(),base._feedbakDialog.dialog("option",{height:base._dialogHeight}),base._resizeTextArea(),base._resetTextArea())})},_tabNavigation:function(e,shiftPressed){if(e.preventDefault(),e.stopPropagation(),shiftPressed)0===this._overallArray.indexOf($(this._focussedEle)[0])?(this._zfeedbackSendbutton.addClass("ui-zfb-field-focus").focus(),prevEle=this._zfeedbackSendbutton):1===this._overallArray.indexOf($(this._focussedEle)[0])?($("#zfb-input-subject").focus(),prevEle=$("#zfb-input-subject")):this._overallArray.indexOf($(this._focussedEle)[0])>-1&&($(this._focussedEle).blur(),$(this._focussedEle).removeClass("ui-zfb-field-focus"),2===this._overallArray.indexOf($(this._focussedEle)[0])?($("#zfb-input-message").focus(),prevEle=$("#zfb-input-message")):prevEle=this._overallArray[this._overallArray.indexOf($(this._focussedEle)[0])-1],$(prevEle).addClass("ui-zfb-field-focus").focus()),this._focussedEle=prevEle;else{var nextEle,prevEle;0===this._overallArray.indexOf($(this._focussedEle)[0])?($(this._overallArray[this._overallArray.indexOf($(e.target)[0])+1]).focus(),this._focussedEle=$(this._overallArray[this._overallArray.indexOf($(e.target)[0])+1])):this._overallArray.indexOf($(this._focussedEle)[0])>=-1&&($(e.target).blur(),$(this._focussedEle).blur(),$(this._focussedEle).removeClass("ui-zfb-field-focus"),$(this._focussedEle)[0]===$(this._zfeedbackSendbutton)[0]?($("#zfb-input-subject").focus(),nextEle=$("#zfb-input-subject")):nextEle=this._overallArray[this._overallArray.indexOf($(this._focussedEle)[0])+1],$(nextEle).addClass("ui-zfb-field-focus").focus(),this._focussedEle=nextEle)}},_fetchImportStatus:function(ele,mimeType,file,screenshot){var base=this,data={action:"upload",screenGrabData:null,fileAttachment:null,randomNumber:this._randomNumber,attachmentSize:this._currAttachmentSize};screenshot?(data.screenGrabData=file,delete data.fileAttachment,base._screenshotCount=base._screenshotCount+1):(data.fileAttachment=file,delete data.screenGrabData,base._fileCount=base._fileCount+1),base._fileBorderAdjustment(),data.randomNumber=base._randomNumber+"-"+base._fileCount+"-"+base._screenshotCount,base._feedbackRandomNum=data.randomNumber,data.attachmentSize=data.attachmentSize-parseInt(ele.attr("fileSize")),ele.attr({fileID:data.randomNumber,mimeType:mimeType,uploaded:"pending"}).find(".ui-ztb-filename-label").addClass("ui-zfeedback-dim");var callbacks={customData:data,progress:function(e,customData){var percentage=customData.percentage,ele=base._attachmentInner.find($('.ui-ztb-filename-container[fileID="'+customData.randomNumber+'"]')),ctx=ele.data("context");ele.find(".ui-zfb-attachment-temp").hide(),ele.length&&100!==percentage&&base._canvasAnimatn(ctx,percentage/100)},success:function(resp,req,customData){var jsonResp=$.parseJSON(resp),stat=jsonResp.status;if("success"===stat&&"upload"===customData.action){var ele=base._attachmentInner.find($('.ui-ztb-filename-container[fileID="'+customData.randomNumber+'"]'));ele.find(".ui-zfb-attachment-temp").hide(),ele.find(".ui-ztb-filename-label").animate({top:"-9px"},300);var canvas=ele.find("canvas");canvas.hide(),ele.find(".ui-ztb-filename-size").css("opacity",1).animate({top:"-4px"},300),ele.is(":visible")&&(base._uploadedCount=base._uploadedCount+1,ele.attr("uploaded",!0)),base._attachmentCount.find("b").text(base._getString("attachments.label")+" ("+base._uploadedCount+")"),base._uploadedInfo=jsonResp.uploadedInfo;var uploadedFileSize=jsonResp.size;if(ele.is(":visible")){base._currAttachmentSize=base._currAttachmentSize+uploadedFileSize-parseInt(ele.attr("fileSize"));var fileName=ele.find(".ui-ztb-filename-label").text();ele.find(".ui-ztb-filename-label")[0].hasAttribute("title")&&(fileName=ele.find(".ui-ztb-filename-label").attr("title")),base._attachmentArray.push({fileID:ele.attr("fileID"),fileName:fileName,mimeType:ele.attr("mimeType")}),ele.find(".ui-ztb-filename-label").removeClass("ui-ztb--dim"),ele.attr("fileSize",uploadedFileSize).find(".ui-ztb-filename-size").text(base._bytesToSize(uploadedFileSize))}}else base._handleUploadFail(resp,customData)},fail:function(resp,req,customData){base._handleUploadFail(resp,customData)}},ctx=this._canvasInitialization(ele.find("canvas"),callbacks,"");ele.data("context",ctx);this._submitRequest(this.options.fileActionURL,data,callbacks,this._externalAttachmentURL)},_handleUploadFail:function(resp,customData){var ele=this._attachmentInner.find($('.ui-ztb-filename-container[fileID="'+customData.randomNumber+'"]'));ele.attr("uploaded",!1).find(".ui-ztb-filename-label").animate({top:"-9px"},300),this._currAttachmentSize-=parseInt(ele.attr("fileSize"));var responseText=resp.trim(),jsonResp=$.parseJSON(responseText);jsonResp||(jsonResp={}),null!==jsonResp&&"VIRUS_DETECTED"===jsonResp.errorType?ele.attr("errorType","virus-error-detected"):ele.attr("errorType","unknown-error-detected"),this._errorCaseHandle(ele)},_updateProgress:function(evt,ele,percentComplete){evt&&evt.lengthComputable?ele.css("width",percentComplete+"%"):ele.css("background-color","#00BD9C").animate({width:"20%"},300)},_attachFile:function(fileName,size,mimeType,file){var base=this,ext=fileName.split(".").pop().toLowerCase();this._fileData.fileAttachment=file;var fileNameBox=$("<div>").attr({"class":"ui-ztb-filename-container",uploaded:!1,fileSize:size}),fileText=$("<div>").attr({"class":"ui-ztb-filename-label"}).text(fileName).appendTo(fileNameBox);$("<span>").attr("class"," ui-ztb-filename-size").text(base._bytesToSize(size)).appendTo(fileNameBox),fileNameBox.appendTo(this._attachmentInner),fileText.text(base._start_and_end(fileName,fileText)),this._attachmentInner[0].offsetWidth>this._attachmentInner[0].scrollWidth&&this._getScrollBarWidth()&&this._attachmentInner.find(".ui-ztb-filename-container").css({width:fileNameBox.outerWidth()-this._getScrollBarWidth()/2}),this._attachmentContainer.show(),base._isAttachmentCollapsed&&base._attachmentCount.trigger("click"),$("<span>").attr({"class":"ui-fcomponents-icon ui-zfc-icon-feedback-attachment-close",title:this._getString("removefile.label")}).appendTo(fileNameBox).on("click.zfeedback",function(){$(this).off("click.zfeedback"),base._uploadBtn[0].value="",base._fileData.fileAttachment=void 0,base._uploadLabel.show(),base._isAlertShown=!1,base._removeFile(!1,$(this).parent())});{var appendEle;$("<canvas>").attr({width:"60px",height:"43px"}).appendTo(fileNameBox)}if("png"!==ext&&"jpg"!==ext&&"jpeg"!==ext&&"gif"!==ext||"undefined"==typeof FileReader)appendEle=document.createElement("span"),$(appendEle).attr("class","ui-fcomponents-icon ui-zfc-icon-filetype-others ui-zfc-icon-filetype-"+ext),$('<div class = "ui-zfb-attachment-outerRing">').append(appendEle).appendTo(fileNameBox);else{appendEle=document.createElement("img"),$(appendEle).addClass("ui-icon-fileType-img"),$('<div class = "ui-zfb-attachment-outerRing">').append(appendEle).appendTo(fileNameBox);var reader=new FileReader;reader.onloadend=function(){appendEle.src=reader.result},reader.readAsDataURL(file)}$('<div class = "ui-zfb-attachment-temp">').appendTo(fileNameBox),this._attachmentInner.scrollTop(this._attachmentInner.prop("scrollHeight")),this._resetTextArea(),this._fetchImportStatus(fileNameBox,mimeType,file,!1,!1)},_start_and_end:function(str,ele){return str.length>23?(ele.attr("title",str),str.substr(0,13)+"..."+str.substr(str.length-6,str.length)):str},_fileBorderAdjustment:function(){var count=this._attachmentInner.find(".ui-ztb-filename-container").length;count>=7&&($(this._attachmentInner.find(".ui-ztb-filename-container")[5]).removeClass("ui-zfb-fileName-removeBorder"),7===count&&$(this._attachmentInner.find(".ui-ztb-filename-container")[5]).addClass("ui-zfb-fileName-removeBorder"))},_adjustFileText:function(ele,str){ele.text("");var leftAdjus=$('<span class = "left-adjustment">').text(str),centerAdjus=$('<span class = "center-adjustment">').text("..."),rightAdjus=$('<span class = "right-adjustment">').text(str);leftAdjus.add(centerAdjus).add(rightAdjus).appendTo(ele)},_canvasInitialization:function(ele){var num=Math.random();ele.prev().show(),ele.attr("id","ui-zfb-canvas-"+num);var canvas=document.getElementById("ui-zfb-canvas-"+num);!function(){var requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=requestAnimationFrame}();var context=canvas.getContext("2d");return context.lineWidth=15,context.strokeStyle="rgba(0,0,0,0.55)",context},_canvasAnimatn:function(context,current){context.clearRect(0,0,60,44),context.fillStyle="rgba(0,0,0,0.7)",context.fillRect(0,0,60,44),context.beginPath(),context.fillStyle="black",context.globalCompositeOperation="destination-out",context.arc(30,22,17,0,this._canvasCirc),context.closePath(),context.fill(),context.beginPath(),context.globalCompositeOperation="source-over",context.arc(30,22,7,-this._canvasQuart,this._canvasCirc*current-this._canvasQuart,!0),context.strokeStyle="rgba(0,0,0,0.7)",context.stroke()},_attachScreenGrab:function(){function setCookie(cname,cvalue){document.cookie=cname+"="+cvalue+"; "}var base=this;errorType="",base._isScreengrabberOpen=!0,this._screenshotFallEle=$("<div>").attr({"class":"ui-ztb-filename-container",fileSize:1021121}).appendTo(this._attachmentInner);var canvasEle=$("<canvas>").attr({width:"60px",height:"43px"}).appendTo(this._screenshotFallEle);Screengrabber.open({targetObject:canvasEle,fetchImageURL:this.options.proxyURL}),$("body").off("screengrabberdone").on("screengrabberdone",function(event,ui){base._currImageSource=ui.imageSource,base._attachScreenshot(ui.imageSource,base._screenshotFallEle),base._screenshotFallEle=void 0;var screengrabberShortcut=FCUtil.getCSRFCookie("screengrabberShortcut");screengrabberShortcut||(setCookie("screengrabberShortcut",!0),setTimeout(function(){base._shortcutKeyNotify($(".ui-ztooltip.ui-zfb-tooltip-grabscreen"),!0)},1200))})},_attachScreenshot:function(imageSrc,targetObj){var base=this,size=1021121,mimeType="image/png";imageSrc&&(this._currImageSource=imageSrc),this._screengrabberAttached=!0,this._feedbackUiDialog.show();var fileNameBox,previewImg=$("<img>").attr({"class":"ui-zfeedback-imgpreview ui-zfb-screenshot-img",src:this._currImageSource});fileNameBox=targetObj?targetObj:$("<div>").attr({"class":"ui-ztb-filename-container",fileSize:size}),base._totalScreenshotCount=base._totalScreenshotCount+1,$("<span>").addClass("ui-ztb-filename-label").text(this._getString("screenshot.label")+"_"+base._totalScreenshotCount+".png").appendTo(fileNameBox),$("<span>").addClass("ui-ztb-filename-size").text(base._bytesToSize(size)).appendTo(fileNameBox),$("<span>").attr({"class":"ui-fcomponents-icon ui-zfc-icon-feedback-attachment-close",title:this._getString("removefile.label")}).appendTo(fileNameBox).on("click",function(){base._isAlertShown=!1,base._fileData.screenGrabData=void 0,base._removeFile(!0,$(this).parent())});$("<canvas>").attr({width:"60px",height:"43px"}).appendTo(fileNameBox);$('<div class = "ui-zfb-attachment-outerRing">').append(previewImg).appendTo(fileNameBox),fileNameBox.appendTo(this._attachmentInner),base._isAttachmentCollapsed&&base._attachmentCount.trigger("click"),this._attachmentInner[0].offsetWidth>this._attachmentInner[0].scrollWidth&&this._getScrollBarWidth()&&this._attachmentInner.find(".ui-ztb-filename-container").css({width:fileNameBox.outerWidth()-this._getScrollBarWidth()/2}),this._attachmentContainer.show(),this._resetTextArea(),this._attachmentInner.scrollTop(this._attachmentInner.prop("scrollHeight")),this._currAttachmentSize+=size,this._fetchImportStatus(fileNameBox,mimeType,this._currImageSource,!0),this._isScreengrabberOpen=!1},_shortcutKeyNotify:function(ele){var base=this,className="ui-zfb-info";this.options.attachment||(className="ui-zfb-info ui-zfb-screengrabber-only"),base._feedbackFormBottom.addClass(className),ele.hide(),this._overalDiv=$("<div>").attr("class","ui-zsg-shortcut-overaldiv"),this._outerTipContainer=$("<div>").attr("class","ui-zsg-outer-tipcontainer");{var tipClose=$("<span>").attr({"class":"ui-fcomponents-icon ui-zfc-icon-feedback-tip-close",title:FCUtil.getString("close.label")}).appendTo(this._outerTipContainer),tipContainer=$("<div>").attr("class","ui-zfb-tip-container").appendTo(this._outerTipContainer),tipNotifier=$("<div>").attr("class","ui-zfb-tip-notifier").appendTo(tipContainer);$("<span>").attr("class","ui-zfb-tip-ele").text(this._getString("tip.label")+":").appendTo(tipNotifier)}$("<span class = ui-zfb-tip-info></span>").text(this._getString("usekeyboardshortcuts.label")+":").appendTo(tipNotifier);var captureCentreContainer=$("<div>").attr("class","ui-zfb-capture-center-container").appendTo(tipContainer),captureContainer=$("<div>").attr("class","ui-zfb-capture-container").appendTo(captureCentreContainer);4===this._partialScreen.length&&4===this._fullScreen.length&&captureContainer.addClass("four");var captureFullScreenContainer=$("<div class = ui-zfb-capture-fullScreen></div>").appendTo(captureContainer);$("<b class = ui-zfb-fullscreen-capture-text>"+this._getString("capturefullscreen.label")+"</b>").appendTo(captureFullScreenContainer);var div1=$('<div class = "fullscreen-keys">').appendTo(captureFullScreenContainer),separator=$("<span class = ui-zfb-fullscreen-capture-separator>").text("-").appendTo(div1);$(this._tipFormat(this._fullScreen)).appendTo(div1);var capturePartialScreenContainer=$("<div class = ui-zfb-capture-partialScreen></div>").appendTo(captureContainer);$("<b class = ui-zfb-partial-capture-text>"+this._getString("capturepartofscreen.label")+"</b>").appendTo(capturePartialScreenContainer);var div2=$('<div class = "partialscreen-keys">').appendTo(capturePartialScreenContainer);separator.clone().appendTo(div2),$(this._tipFormat(this._partialScreen)).appendTo(div2),base._feedbackFormMiddle.add(base._feedbackFormBottom).addClass("ui-zsg-tipnotifier-pushup"),this._overalDiv.append(this._outerTipContainer).appendTo(this._feedbackFormBottom);var attachmentHeight=0;this._attachmentContainer.is(":visible")&&(attachmentHeight=this._attachmentContainer.outerHeight(!0));var scrollBarWidth=this._getScrollBarWidth();captureCentreContainer.css({"margin-left":parseInt(captureCentreContainer.css("margin-left"))-scrollBarWidth,"margin-right":parseInt(captureCentreContainer.css("margin-right"))-scrollBarWidth});var textAreaHeight=this._textAreaHeight-attachmentHeight-this._overalDiv.outerHeight();32>=textAreaHeight&&(textAreaHeight=30,this._attachmentInner.addClass("ui-zfb-maxheight-adjustment"),this._attachmentInner[0].offsetWidth>this._attachmentInner[0].scrollWidth&&this._getScrollBarWidth()&&this._attachmentInner.find(".ui-ztb-filename-container").css({width:265-this._getScrollBarWidth()/2}),this._attachmentContainer.is(":visible")&&(attachmentHeight=this._attachmentContainer.outerHeight(!0)));var tipHeight=this._textAreaHeight-attachmentHeight-textAreaHeight;tipHeight>193&&(tipHeight=193),this._overalDiv.height(tipHeight),textAreaHeight=this._textAreaHeight-attachmentHeight-tipHeight,this._feedbackFormMiddle.dequeue().animate({height:textAreaHeight},500);tipClose.on("click",function(){base._feedbackFormBottom.removeClass("ui-zfb-info ui-zfb-screengrabber-only");var tcontainer=base._overalDiv;setTimeout(function(){tcontainer.css({borderRadius:"100%"})},350),tipClose.hide();tcontainer.dequeue().animate({width:"17px",height:"17px",left:"140px",padding:"0px"},400,"linear",function(){var left=90;base.options.attachment||(left=50);var timeout,innerTimeout;tcontainer.dequeue().css({overflow:"hidden"}).animate({top:-60,left:left},600,"linear",function(){tcontainer.hide(),clearTimeout(timeout),clearTimeout(innerTimeout);var toolTipEle=$(".ui-ztooltip.ui-zfb-tooltip-grabscreen:visible");toolTipEle.find(".ui-zfb-tooltip-grabscreen-iconholder").addClass("yellow").animate({height:"16px"},600,"easeInSine"),timeout=setTimeout(function(){toolTipEle.find(".ui-zfb-tooltip-grabscreen-iconholder").removeClass("yellow"),innerTimeout=setTimeout(function(){tcontainer.remove(),$("#ui-zsg-toolTipContainer").removeClass("ui-zfb-tip-icon-hide"),toolTipEle.find("#ui-zsg-toolTipContainer").removeClass("ui-zfb-tip-icon-hide").find(".ui-zfb-tooltip-grabscreen-iconholder").css("height",""),toolTipEle.hide()},1e3)},1200)})}),base._feedbackFormMiddle.add(base._feedbackFormBottom).removeClass("ui-zsg-tipnotifier-pushup"),base._attachmentInner.removeClass("ui-zfb-maxheight-adjustment");var divHeight=base._resetTextArea(!0);base._feedbackFormMiddle.dequeue().animate({height:divHeight},600,"linear",function(ev){{var ele=$(".ui-zfc-icon-screengrabber").parent();ele.offset().left}$("#ui-zsg-toolTipContainer").addClass("ui-zfb-tip-icon-hide");var ev={target:base._screenGrabLabel[0]};base._isTooltipComponentUsed&&base._documentObj.ztooltip("show",ev,base._screenGrabLabel)})})},_sendFeedback:function(){{var base=this;this._isMacOS()?100:400}this._feedbackUiDialog.add(this._feedbakDialog).add($(this._feedbackFormBottom.find("#ui-zfb-form-others"))).css("overflow","visible !important"),this._feedbakDialog.height("auto");var bottomValue=$(window).height()-(this._dialogHeight+this._feedbackUiDialog.offset().top);base._feedbackUiDialog.css({top:"auto",bottom:bottomValue});var bottomValue=$(window).height()-(this._dialogHeight+this._feedbackUiDialog.offset().top);if(base._feedbackUiDialog.addClass("scaling"),setTimeout(function(){var offSetLeft=base._feedbackUiDialog.offset();base._feedbackUiDialog.css("opacity",0);{var sendingLabel=$("<div class = ui-zfb-sending-label >").css({left:offSetLeft.left}).append("<a>"+FCUtil.getString("sending.label")+"</a>").appendTo("body");$(window).height()-base._dialogHeight+parseInt(base._feedbackUiDialog.css("top"))}sendingLabel.find("a").queue(function(){$(this).addClass("fadeout").dequeue()});var responseTimeout,response=setInterval(function(){base._isResponseReceived&&(clearTimeout(responseTimeout),base._isSuccessful?(sendingLabel.find("a").removeClass("fadeout"),setTimeout(function(){sendingLabel.find("a").text(base._getString("thankyou.label")).addClass("fadeout").show();{var hide=function(){sendingLabel.animate({bottom:-50,opacity:.2},300,function(){$(this).remove(),base._originalEvent=!0,base._feedbakDialog.dialog("close")})};setTimeout(function(){hide()},1500)}},400)):sendingLabel.animate({opacity:.2},300,function(){$(this).remove(),base._dialogTop=base._windowObj.innerHeight()-base._dialogHeight,base._feedbackUiDialog.removeClass("scaling").css({opacity:0,top:base._dialogTop+base._dialogHeight}).animate({top:base._dialogTop,opacity:1},500,"easeInSine",function(){$(this).css({top:"auto",bottom:0,height:base._dialogHeight}),base._zfeedbackSendbutton.attr("disabled",!1).removeClass("ui-zfb-disable").addClass("ui-zfb-field-focus").text(base._getString("resend.label")).focus(),base._isEnterDisabled=!1,base._focussedEle=base._zfeedbackSendbutton,base._errorBanner.css({display:"block"}).animate({top:"0px"},300,function(){$("body").on("mousedown.errorBanner",function(){$(this).off("mousedown.errorBanner"),base._errorBanner.fadeOut(200)})})})}),clearInterval(response))},2500);responseTimeout=setTimeout(function(){base._isResponseReceived||(base._isSuccessful=!0,base._isResponseReceived=!0)},5100)},800),this._formData.mailSubject=$("#zfb-input-subject").val(),this._formData.mailContent=$("#zfb-input-message").val(),this.options.criticality)if(this._formData.criticalType){var criticalLevel=this._feedbackFormBottom.find(".ui-zfb-criticality-button").attr("criticality-level");"medium"===criticalLevel?this._formData.mailSubject=this._formData.mailSubject+" - "+this._formData.criticalType:(this._formData.criticalType="high"===criticalLevel?"["+this._formData.criticalType.toUpperCase()+"] ":this._formData.criticalType+": ",this._formData.mailSubject=this._formData.criticalType+this._formData.mailSubject)}else this._formData.criticalType="";var base=this;this._formData.randomNumber=this._feedbackRandomNum,this._attachmentArray.length&&(this._formData.fileDetails=JSON.stringify(this._attachmentArray));var customData={};customData["Screen Resolution"]=screen.width+" x "+screen.height,customData=$.extend({},customData,this.options.customHeaders);var result=[],obj={};for(var i in customData)obj[i]=customData[i],result.push(obj),obj={};this._formData.customHeaders=JSON.stringify(result);for(var i in this._formData)this._feedbackData[i]=void 0!=this._formData[i]?this._formData[i]:void 0;this._feedbackData.fileAttachment||delete this._feedbackData.fileAttachment,this._feedbackData.randomNumber||delete this._feedbackData.randomNumber,this._uploadedInfo&&(this._feedbackData=$.extend({},this._feedbackData,this._uploadedInfo))},_setOption:function(key,value){this.options[key]=value},_removeFile:function(screenshot,fileContainer){var timeout,data={randomNumber:fileContainer.attr("fileID"),action:"remove"},callbacks={progress:function(){},success:function(){},fail:function(){}},base=this;clearTimeout(timeout),fileContainer.dequeue().animate({opacity:.1},300,function(){for(var i=0;i<base._attachmentArray.length;i++)if(base._attachmentArray[i].fileID==fileContainer.attr("fileID")){base._attachmentArray.splice(i,1);break}fileContainer.remove(),base._errorTextHandle(fileContainer,!0),base._fileBorderAdjustment(),base._attachmentInner[0].offsetWidth===base._attachmentInner[0].scrollWidth&&base._getScrollBarWidth()&&base._attachmentInner.find(".ui-ztb-filename-container").css({width:"265px"}),base._resizeTextArea(),base._resetTextArea();base._submitRequest(base.options.fileActionURL,data,callbacks,base._externalAttachmentURL)}),timeout=setTimeout(function(){"true"===fileContainer.attr("uploaded")&&(base._uploadedCount=base._uploadedCount-1,base._attachmentCount.find("b").text(base._getString("attachments.label")+" ("+base._uploadedCount+")"),base._currAttachmentSize-=parseInt(fileContainer.attr("fileSize"))),"pending"===fileContainer.attr("uploaded")&&(base._currAttachmentSize-=parseInt(fileContainer.attr("fileSize"))),base._uploadedCount||1!==base._attachmentInner.children().length||(base._attachmentContainer.hide(),base._isIE?(base._slideAnimation(!0),base._attachmentHeader.removeClass("slide-down")):base._attachmentHeader.removeClass("flip-over"),base._attachmentErrorHeader.siblings(":last").removeClass("ui-zfc-icon-collapse-white"),base._attachmentHeader.removeClass("ui-zfb-form-attach-error")),base._resizeTextArea(),base._resetTextArea()},100)},_removeAllFiles:function(){var data={};this._attachmentArray.length&&(data.fileDetails=JSON.stringify(this._attachmentArray)),data.action="remove";{var callbacks={progress:function(){},success:function(){},fail:function(){}};this._submitRequest(this.options.fileActionURL,data,callbacks,this._externalAttachmentURL)}},_submitRequest:function(postURL,postData,callbacks){return this.options.customData?postData=$.extend({},postData,this.options.customData):postData[FComponents.option("csrfParamName")]=FCUtil.getCSRFToken(),postURL=this.options.postURL?this.options.postURL:postURL,$.ajaxUpload(postURL,postData,callbacks)},_isOnline:function(){return navigator.onLine},_clearFile:function(ele){ele.wrap("<form>").closest("form").get(0).reset(),ele.unwrap()},_bytesToSize:function(bytes){var sizes=["bytes","KB","MB","GB","TB"];if(0==bytes)return bytes+""+sizes[0];var i=parseInt(Math.floor(Math.log(bytes)/Math.log(1024)));return Math.ceil(bytes/Math.pow(1024,i)*100)/100+" "+sizes[i]},_tipFormat:function(arrayELe){for(var htmlEle="",i=0;i<arrayELe.length;i++)htmlEle+='<div class = "ui-keys-border">'+arrayELe[i]+"</div><span>+</span>";var result=htmlEle.substring(0,htmlEle.lastIndexOf("<span>"));return result},_errorCaseHandle:function(ele){ele.attr("errorFound",!0).find("canvas").remove(),$('<div class = "ui-ztb-file-error-blackout"></div><div class = "ui-ztb-file-error"><span class = "ui-fcomponents-icon ui-zfc-icon-feedback-attachment-error"></span></div>').appendTo(ele);$("<div>").attr("class","ui-zfb-file-error-text").appendTo(ele);this._errorTextHandle(ele),ele.find(".ui-zfc-icon-feedback-attachment-error").css({transform:"scale(1.1)"}),setTimeout(function(){ele.find(".ui-zfc-icon-feedback-attachment-error").css("transform","scale(1)")},200)},_errorTextHandle:function(ele,isRemoved){var headerText,text,className,timeout,base=this,fileName=ele.find(".ui-ztb-filename-label").text(),number=this._attachmentInner.find('.ui-ztb-filename-container[errorfound="true"]').length;if(this._errorText=[this._getString("viruspresent.label"),this._getString("unknownerrortext.label")],isRemoved)0===number?this._isIE?(this._slideAnimation(!0),this._attachmentHeader.removeClass("slide-down")):this._attachmentHeader.removeClass("flip-over"):number>=1&&(headerText=this._errorHeaderText(null,number,3),this._attachmentErrorHeader.find(".ui-zfb-form-error-headertext").text(headerText));else{var errorKind=ele.attr("errorType");"virus-error-detected"===errorKind?(text=this._errorText[0],className="ui-zfb-file-error",headerText=1==number?1===this._attachmentInner.find(".ui-ztb-filename-container").length?this._errorHeaderText(fileName,number,0):this._errorHeaderText(fileName,number,1):this._errorHeaderText(fileName,number,3)):"unknown-error-detected"===errorKind&&(text=this._errorText[1],className="ui-zfb-file-error",headerText=1===number?this._errorHeaderText(fileName,number,2):this._errorHeaderText(fileName,number,3)),clearTimeout(timeout),this._isIE?(this._attachmentHeader.addClass("slide-down"),this._slideAnimation()):(this._attachmentHeader.addClass("flip-over"),this._attachmentCount.add(this._attachmentHeader).addClass("ui-zfb-header-grey-effect"),this._attachmentTempHeader.show(),timeout=setTimeout(function(){base._attachmentTempHeader.hide(),base._attachmentCount.add(base._attachmentHeader).removeClass("ui-zfb-header-grey-effect")},400)),this._attachmentHeader.addClass("ui-zfb-form-attach-error"),ele.addClass(className),ele.find(".ui-zfb-file-error-text").text(text),this._attachmentErrorHeader.find(".ui-zfb-form-error-headertext").text(headerText)}this._resetTextArea()},_slideAnimation:function(resetAnim){var countTop,errorTop,base=this;resetAnim?(countTop="0px",errorTop="-62px"):(countTop="31px",errorTop="-31px"),this._attachmentCount.animate({top:countTop},300),setTimeout(function(){base._attachmentErrorHeader.animate({top:errorTop},300)},0)},_dialogHeightAdjustment:function(){this._dialogHeight=.7*this._windowObj.innerHeight();var minHeight=this.options.minHeight,maxHeight=this.options.maxHeight;this._dialogHeight<minHeight?this._dialogHeight=minHeight:this._dialogHeight>maxHeight&&(this._dialogHeight=maxHeight)},_errorHeaderText:function(fileName,number,index){return[this._getString("virusdetected.label"),this._getString("virusdetectedinfile.label","zfeedback",[fileName]),this._getString("unknownerrorinfile.label","zfeedback",[fileName]),this._getString("multiplefileserror.label","zfeedback",[number])][index]},_areAttachmentsPending:function(){return this._attachmentInner.find('.ui-ztb-filename-container[uploaded="pending"]').length},_filesPendingHandle:function(){var base=this;this._attachmentErrorHeader.addClass("ui-zfb-form-attach-pendingheader").find("span").removeClass("ui-zfc-icon-feedback-attachmentheader-error").addClass("ui-zfc-icon-feedback-attachmentheader-info");setTimeout(function(){clearTimeout(timeout),base._isIE?(base._attachmentHeader.addClass("slide-down"),base._slideAnimation()):(base._attachmentHeader.addClass("flip-over"),base._attachmentCount.add(base._attachmentHeader).addClass("ui-zfb-header-grey-effect"),base._attachmentTempHeader.show());var timeout,textEle=base._attachmentErrorHeader.find(".ui-zfb-form-error-headertext"),number=base._areAttachmentsPending();textEle.text(1===number?base._getString("fileuploadinprogress.label"):base._getString("multiplefilesuploadinprogress.label","zfeedback",[number])),base._resetTextArea(),timeout=setTimeout(function(){base._attachmentTempHeader.hide(),base._attachmentCount.add(base._attachmentHeader).removeClass("ui-zfb-header-grey-effect")},400)},100)},_resizeTextArea:function(){this._textAreaHeight=this._feedbakDialog.height()-this._fileContainer.outerHeight()-this._feedbackFormTop.outerHeight(),this._attachmentContainer.is(":visible")&&(this._textAreaHeight-=this._attachmentContainer.outerHeight()),this._feedbackFormMiddle.height(this._textAreaHeight)},_resetTextArea:function(valueNeeded){var shortcutHeight=0;this._overalDiv&&this._overalDiv.is(":visible")&&!valueNeeded&&(shortcutHeight=this._overalDiv.outerHeight(!0));var attachmentHeight=0;this._attachmentContainer.is(":visible")&&(attachmentHeight=this._attachmentContainer.outerHeight(!0));var feedbackHeight=this._textAreaHeight-attachmentHeight-shortcutHeight;feedbackHeight=feedbackHeight>30?feedbackHeight:30,32>=feedbackHeight?(this._attachmentInner.addClass("ui-zfb-maxheight-adjustment"),this._attachmentContainer.is(":visible")&&(attachmentHeight=this._attachmentContainer.outerHeight(!0)),this._attachmentInner[0].offsetWidth>this._attachmentInner[0].scrollWidth&&this._getScrollBarWidth()&&this._attachmentInner.find(".ui-ztb-filename-container").css({width:265-this._getScrollBarWidth()/2})):!valueNeeded&&this._attachmentInner.hasClass("ui-zfb-maxheight-adjustment")&&feedbackHeight>140?(this._attachmentInner.removeClass("ui-zfb-maxheight-adjustment"),attachmentHeight=this._attachmentContainer.outerHeight(!0)):this._overalDiv&&this._overalDiv.is(":visible")&&!valueNeeded&&this._attachmentInner.children().length&&!this._attachmentInner.hasClass("ui-zfb-maxheight-adjustment")&&feedbackHeight>70&&(shortcutHeight=193,this._overalDiv.height(shortcutHeight)),feedbackHeight=this._textAreaHeight-attachmentHeight-shortcutHeight,feedbackHeight=feedbackHeight>30?feedbackHeight:30;var tipHeight=this._textAreaHeight-attachmentHeight-feedbackHeight;return this._overalDiv&&this._overalDiv.is(":visible")&&!valueNeeded&&this._overalDiv.height(tipHeight>193?193:tipHeight),valueNeeded?feedbackHeight:void this._feedbackFormMiddle.css({height:feedbackHeight})},_placeHolder:function(input,text){$(input).on("focus.placeholder",function(){$(text).hide()}).on("focusout.placeholder",function(){0!=$(this).val().length?$(text).hide():$(text).show()}),setTimeout(function(){$("#zfb-input-subject").blur(),$("body").focus()},40)},_getScrollBarWidth:function(){var $outer=$("<div>").css({visibility:"hidden",width:100,overflow:"scroll"}).appendTo("body"),widthWithScroll=$("<div>").css({width:"100%"}).appendTo($outer).outerWidth();return $outer.remove(),100-widthWithScroll},_randomString:function(){for(var text="",possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;5>i;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text},_isMacOS:function(){var ua=navigator.userAgent.toLowerCase();return-1!=ua.indexOf("mac")},_getString:function(key,module,replaceArray){return this._haveCustomKeys&&void 0!==this._customKeys[key]?this._customKeys[key]:FCUtil.getI18NString(module,key,replaceArray,this.options.keys)},_triggerEvent:function(orgEvent,_ui){this._feedbakDialog.trigger("zfeedback"+orgEvent,_ui)}};return{init:function(options){if(zfeedbackDEFAULTS=$.extend({},zfeedbackDEFAULTS,options),zfeedbackDEFAULTS.screengrabber){var contextPath=FComponents.option("contextPath"),URL=zfeedbackDEFAULTS.proxyURL?zfeedbackDEFAULTS.proxyURL:contextPath+"proxy.do";Screengrabber.init({fetchImageURL:URL})}$("body").on("screengrabberopen",function(){$("#ui-zfeedback-dialog").hide()}).off("screengrabberclose").on("screengrabberclose",function(){zfeedback._totalScreenshotCount=0,$("#ui-zfeedback-dialog").css({display:"block",opacity:0}).animate({opacity:1,easing:"easeInExpo"},250),zfeedback._isScreengrabberOpen=!1,zfeedback._focussedEle=$(zfeedback._screenGrabLabel)[0],$(zfeedback._focussedEle).focus()})},option:function(name,value){zfeedback._setOption(name,value)},open:function(data){if(dialogOpen){var feedbackUiDialog=$("#ui-zfeedback-dialog");feedbackUiDialog.is(".ui-dialog-minimized")&&feedbackUiDialog.find(".ui-dialog-titlebar-minimize").trigger("click")}else zfeedback._create(data)},close:function(){zfeedback._close()},attachScreenshot:function(image,targetObj){ZFeedback.open({formType:"feedback"}),zfeedback._attachScreenshot(image.src,targetObj)}}}(window.jQuery);!function($){var zscreengrabber={widgetEventPrefix:"screengrabber",_EVENTS:{ONOPEN:"open",ONFINISH:"done",ONCLOSE:"close"},_grabAreaDrag:!1,_selectionDrag:!1,_isIE9:!1,_selectedTool:void 0,_toolSelected:!1,_undoCount:void 0,_undoFlag:void 0,_rightDrag:!1,_overflow:!0,_ctx:void 0,_memCtx:void 0,options:{targetObject:!1,fetchImageURL:""},_create:function(){var base=this;this._initalOverflow=$("body").css("overflow"),$("body").addClass("ui-zsg-userselect").css("overflow","hidden"),this._drawArray=[],this._scrollTopVal={},this._scrollTopVal.topval=window.pageYOffset||document.documentElement.scrollTop,this._scrollTopVal.leftval=window.pageXOffset||document.documentElement.scrollLeft,this.options=$.extend({},$.ui.zscreengrabber.config,this.options),-1!==navigator.appVersion.indexOf("MSIE 9.")&&(this._isIE9=!0),this._createScreenGrabber(),this._createTopBandTools(),$(window).on("keydown.screengrabber",function(ev){return 27===ev.which?(ev.stopPropagation(),base._close(!0),ev.preventDefault(),!1):void(13===ev.which&&base._canvasEleCreated&&!base._captureInProgress&&base._doneBtn.trigger("click.screengrabber"))}),base._triggerEvent(base._EVENTS.ONOPEN)},_close:function(){var base=this;this._loaderBar&&this._loaderBar.remove(),base._screenCaptureError.remove(),setTimeout(function(){base._centralDiv.add(base._screenGrabberArea).add(base._topBand).add(base._outerDragEle).remove(),$("body").removeClass("ui-zsg-userselect").css({cursor:"",overflow:base._initalOverflow}),base._triggerEvent(base._EVENTS.ONCLOSE),$(window).off("keydown.screengrabber"),$(window).off("keyup.screengrabber"),base.element.off("."+base.widgetName),$.Widget.prototype.destroy.apply(base,arguments)},200)},close:function(){this._close()},_createTopBandTools:function(){var base=this;this._topBand=$("<div>").addClass("ui-zsg-toolbar"),this._screenCaptureError=$("<div>").attr("id","ui-zsg-error-container"),$("<span>").text(this._getString("screencapturealert.label")).appendTo(this._screenCaptureError),$("<button>").attr("id","ui-zsg-retry").text(this._getString("retry.label")).appendTo(this._screenCaptureError),$("<button>").attr("id","ui-zsg-quit").text(this._getString("quit.label")).appendTo(this._screenCaptureError);var headerDiv=$("<div>").attr("id","ui-zsg-toolbar-left").appendTo(this._topBand),buttonDiv=$("<div>").attr("id","ui-zsg-toolbar-inner").appendTo(headerDiv),zoomBtn=$("<div>").attr({id:"ui-zfc-zoomin",title:this._getString("actualsize.label"),"class":"ui-zsg-icons"}).appendTo(buttonDiv).hide();$("<span>").addClass("ui-icon ui-components-icon ui-icon-zoomin").appendTo(zoomBtn);var highlightBtn=$("<div>").attr({title:this._getString("highlight.label")}).addClass("ui-zsg-icons").appendTo(buttonDiv);$("<span>").addClass("ui-icon ui-components-icon ui-icon-highlight").appendTo(highlightBtn);var blackoutBtn=$("<div>").attr({title:this._getString("blackout.label")}).addClass("ui-zsg-icons").appendTo(buttonDiv);$("<span>").addClass("ui-icon ui-components-icon ui-icon-blackout").appendTo(blackoutBtn),this._doneBtn=$("<div>").attr("title",this._getString("attach.label")).addClass("ui-zsg-donebtn").appendTo(buttonDiv),$("<span>").addClass("ui-icon ui-components-icon ui-icon-tick").appendTo(this._doneBtn),this._topBand.appendTo("body"),this._screenCaptureError.appendTo("body");var currentPath=this._scriptPath();highlightBtn.click(function(){base._selectedTool="line",base._isIE9?base._outerDragEle.css("cursor","url('"+currentPath+"/images/pen.cur'), auto"):base._outerDragEle.removeClass("ui-zsg-blackout-cursor ui-zsg-default-cursor").addClass("ui-zsg-highlight-cursor"),base._toolSelected=!0}),$("<div>").attr({title:this._getString("cancel.label"),"class":"ui-zsg-donebtn cancel"}).html('<span class="ui-icon ui-components-icon ui-icon-cross"></span>').appendTo(buttonDiv).click(function(){base._close(!0)}),blackoutBtn.click(function(){base._selectedTool="rectangle",base._isIE9?base._outerDragEle.css("cursor","crosshair"):base._outerDragEle.removeClass("ui-zsg-default-cursor ui-zsg-highlight-cursor").addClass("ui-zsg-blackout-cursor"),base._toolSelected=!0}),zoomBtn.on("click",function(){base._selectedTool="zoom",base._isIE9?base._outerDragEle.css("cursor","default"):base._outerDragEle.removeClass("ui-zsg-highlight-cursor ui-zsg-blackout-cursor").addClass("ui-zsg-default-cursor"),base._zoomImage(),base._toolSelected=!1}).on("mousedown.zscreengrabber",function(){zoomBtn.attr("title",base._getString(base._isZoomedIn?"actualsize.label":"smallsize.label"))})},_createScreenGrabber:function(){var base=this,end1=void 0;this._centralDiv=$("<div>").attr("id","ui-zsg-msg-default").html("<span>"+this._getString("message.label")+"</span>").appendTo("body"),this._screenGrabberArea=$("<div>").attr({id:"ui-zsg-screen-select","data-html2canvas-ignore":!0}).css({top:this._scrollTopVal.topval}).appendTo("body"),this._darkerDiv=$("<div>").attr({"data-html2canvas-ignore":!0,"class":"ui-zsg-fadeoutarea"}).appendTo(this._screenGrabberArea),this._innerDragEle=void 0,this._outerDragEle=$("<div>").addClass("ui-zsg-editor").appendTo(this._screenGrabberArea);var leftDiv,rightDiv,topDiv,bottomDiv;this._screenGrabberArea.on("contextmenu",function(e){e.preventDefault(),e.stopPropagation()}),$(document).on("click","#ui-zsg-retry",function(){base._screenCaptureError.hide(),$(this).hide(),base._screenGrabFail=!0,base._loaderBar.show(),base._doneBtn.trigger("click.screengrabber")}).on("click","#ui-zsg-quit",function(){base._screenCaptureError.hide(),base._close()}),this._mouseMove=!1,this._screenGrabberArea.mousedown(function(e){2!==e.button&&(e.preventDefault(),e.stopPropagation(),base._centralDiv.remove(),base._selectionDrag=!0,base._drag1=!0,base._mouseMove||(base._mouseMove=!1),base._windowWidth=$(window).width(),base._windowHeight=$(window).height(),base.id=Math.round(1e6*Math.random()),start1=[e.clientX,e.clientY],base._outerDragEle.show(),base._outerDragEle.attr("id",base.id))}).mouseup(function(e){if(2!==e.button){base._selectionDrag=!1,e.stopPropagation(),e.preventDefault(),$("body").get(0).style.cursor="auto",base._screenGrabberArea.css({"background-image":""});var x=base._outerDragEle.innerWidth(),y=base._outerDragEle.innerHeight(),ele=base._outerDragEle.position();base._topBandHeight=base._topBand.outerHeight(),base._defLeft=ele.left,base._defTop=ele.top,base._defWidth=x,base._defHeight=y,base._screenGrabberArea.off().on("mousedown click mouseup",function(ev){ev.stopPropagation(),ev.preventDefault()}),base._mouseMove?(topDiv.css({width:base._windowWidth,height:base._defTop}),leftDiv.css({top:base._efTop,width:base._defLeft,height:base._defHeight}),rightDiv.css({left:base._defLeft+base._defWidth,top:base._defTop,width:base._windowWidth-(base._defLeft+base._defWidth),height:base._defHeight}),bottomDiv.css({top:base._defTop+base._defHeight,width:base._windowWidth,height:base._windowHeight-(base._defTop+base._defHeight)}),base._darkerDiv.add(base._topBand).add($(window)).mouseup(function(){base._grabAreaDrag&&(base._grabAreaDrag=!1,base._drawCurve())})):(base._defHeight=base._windowHeight,base._defWidth=base._windowWidth),base._outerDragEle.css({left:base._defLeft,top:base._defTop,width:base._defWidth,height:base._defHeight});var screengrabArea={top:base._defTop+base._scrollTopVal.topval,height:base._defHeight,left:base._defLeft,width:base._defWidth};base._createLoaderBar();var insertCanvas=$("<canvas>").attr({id:"ui-zsg-editor-canvas",width:base._defWidth,height:base._defHeight}).appendTo(base._outerDragEle).focus();base._canvasEleCreated=!0;var mycanvas=document.getElementById("ui-zsg-editor-canvas");if(base._ctx=mycanvas.getContext("2d"),base._mouseMove){var marginLeft,topbarPos=base._defTop-base._topBandHeight,minTopbarWidthPerc=.25,topbarWidth=base._windowWidth*minTopbarWidthPerc;base._defWidth>topbarWidth&&(topbarWidth=base._defWidth);var iconAlignmentFactor=1/3;if(base._defWidth<base._windowWidth*iconAlignmentFactor){var buttonWidth=80;marginLeft=(topbarWidth-2*base._doneBtn.outerWidth()-buttonWidth)/2,$("#ui-zsg-toolbar-inner").css({margin:0,"margin-left":marginLeft})}base._topBand.css({top:topbarPos,left:base._defLeft,width:topbarWidth})}var req;base._isIE9||(base._defWidth>500?base._loaderBar.addClass("ui-zsg-loader-large"):base._defWidth>230?base._loaderBar.addClass("ui-zsg-loader-medium"):(base._loaderBar.addClass("ui-zsg-loader-small"),base._defWidth<100&&base._loaderBar.addClass("ui-zsg-loader-extra"))),base._loaderBar.css("top",base._defHeight/2-base._loaderBar.innerHeight()/2).show(),base._triggerEvent(base._EVENTS.ONSEND),base._captureInProgress=!0,setTimeout(function(){var callbacks={success:function(canvas){window.scroll(base._scrollTopVal.leftval,base._scrollTopVal.topval);var image=document.createElement("img");base._loaderBar.remove(),image.src=canvas.toDataURL("image/png");var width,left,top,y=-base._defTop,x=-base._defLeft;base._mouseMove?(width=base._defWidth,top=0,left=base._defLeft,y-=base._scrollTopVal.topval):(width=.8*base._windowWidth,left=.1*base._windowWidth,top=40,$(image).css({width:"100%"}),base._topBand.find(".ui-icon-zoomin").parent().show(),base._isZoomedIn=!1,base._defTop=top,base._defWidth=width,base._defLeft=left,base._screenGrabberArea.css("top",base._topBandHeight+base._scrollTopVal.topval),y=.8*-base._scrollTopVal.topval),$(topDiv).add(bottomDiv).add(leftDiv).add(rightDiv).fadeOut(200),base._darkerDiv.fadeIn(200),base._outerDragEle.css({height:base._defHeight,width:width,top:base._defTop,left:left});var canvasDiv=$("<div>").addClass("ui-zsg-editor-container").appendTo(base._outerDragEle);insertCanvas.attr("width",width).appendTo(canvasDiv);var imageDiv=$("<div>").addClass("ui-zsg-grab-container").appendTo(base._outerDragEle);imageDiv.append($(image).attr("id","ui-zsg-grabbed-img").css({left:x,top:y-1})),base._mouseMove||(base._defHeight=.8*base._windowHeight,base._outerDragEle.css({height:base._defHeight}),base._minimizedHeight=base._defHeight,insertCanvas.attr("height",base._defHeight),base._defTop=base._defTop+base._topBandHeight),base._defHeight=base._defHeight,base._captureInProgress=!1,setTimeout(function(){base._pushImage()},1)},fail:function(){base._topBand.hide(),$("#ui-zsg-quit-id").show(),base._screenCaptureError.fadeIn(200),base._captureInProgress=!1}};base._screenGrabFail||(base._outerDragEle.css("border","none"),html2canvas($("body"),{proxy:base.options.fetchImageURL,grabArea:screengrabArea,onrendered:function(canvas){base._screenGrabFail=!1,clearTimeout(req),callbacks.success(canvas)}})),req=setTimeout(function(){callbacks.fail(),base._loaderBar.hide(),base._screenGrabFail=!1},2e4)},50),base._doneBtn.on("click.screengrabber",function(){var req;base._screenGrabFail=!0,base._triggerEvent(base._EVENTS.ONSEND),setTimeout(function(){var callbacks={success:function(canvas){window.scroll(base._scrollTopVal.leftval,base._scrollTopVal.topval);var finalImgSrc=canvas.toDataURL("image/png");base._screenGrabberArea.hide();var targetTop,targetLeft,targetWidth,targetHeight;if(base.element.data("imageSource",finalImgSrc),base._triggerEvent(base._EVENTS.ONFINISH,{imageSource:finalImgSrc}),base.options.targetObject){var targetObject=base.options.targetObject;targetTop=targetObject.offset().top,targetLeft=targetObject.offset().left,targetWidth=targetObject.innerWidth(),targetHeight=targetObject.innerHeight()}else{var body=$("body");targetTop=body.innerHeight()/2,targetLeft=body.innerWidth()/2,targetWidth=0,targetHeight=0}base._topBand.remove();var finalImg=$("<img>").attr({src:finalImgSrc});finalImg.css({position:"absolute",top:base._defTop+base._scrollTopVal.topval,left:base._defLeft,width:base._defWidth,height:base._defHeight,"z-index":1e8}).appendTo("body"),finalImg.animate({top:targetTop,left:targetLeft,width:targetWidth,height:targetHeight,opacity:.2},500,function(){base._close(),$(this).remove(),base._captureInProgress=!1})},fail:function(){base._topBand.hide(),$("#ui-zsg-quit-id").show(),base._screenCaptureError.fadeIn(200),base._captureInProgress=!1}};html2canvas($(base._outerDragEle),{grabArea:screengrabArea,onrendered:function(canvas){base._screenGrabFail=!1,clearTimeout(req),callbacks.success(canvas)}}),req=setTimeout(function(){base._screenGrabFail&&(callbacks.fail(),base._loaderBar.hide(),base._screenGrabFail=!1)},2e4)},50)});var ctrlDown=!1,yKey=89,zKey=90;base._undoCount=0;$(window).on("keydown.screengrabber",function(e){var MAC=-1!==navigator.platform.toString().toLowerCase().indexOf("mac")?!0:!1;if(!MAC&&e.ctrlKey&&(ctrlDown=!0),e.metaKey&&e.keyCode===zKey&&!e.shiftKey&&!e.ctrlKey||ctrlDown&&e.keyCode===zKey){if(e.preventDefault(),e.stopPropagation(),base._undoFlag=!0,base._undoCount=base._undoCount+1,base._baseArray.length-base._undoCount<0)return void(base._undoCount=base._baseArray.length);var lastBaseId=base._baseArray[base._baseArray.length-base._undoCount];"rectangle"===base._drawArray["draw"+lastBaseId].tool?$("#"+lastBaseId).hide():base._undoRedo()}if((e.metaKey&&e.keyCode===zKey&&e.shiftKey&&!e.ctrlKey||ctrlDown&&e.keyCode===yKey)&&(e.preventDefault(),e.stopPropagation(),base._undoCount>0)){base._undoCount=base._undoCount-1;var lastBaseId=base._baseArray[base._baseArray.length-1-base._undoCount];if(base._baseArray.length-1-base._undoCount<0)return;"rectangle"===base._drawArray["draw"+lastBaseId].tool?$("#"+lastBaseId).show():base._undoRedo()}e.metaKey&&57===e.keyCode||e.metaKey&&189===e.keyCode||ctrlDown&&189===e.keyCode?base._isZoomedIn&&!base._mouseMove&&base._zoomImage():(e.metaKey&&48===e.keyCode||e.metaKey&&187===e.keyCode||ctrlDown&&48===e.keyCode||ctrlDown&&187===e.keyCode)&&(base._isZoomedIn||base._mouseMove||base._zoomImage())}).on("keyup.screengrabber",function(e){e.ctrlKey&&(ctrlDown=!1)}),base._baseArray=[],base._outerDragEle.on("contextmenu",function(e){return e.preventDefault(),e.stopPropagation(),!1}),base._outerDragEle.on("mousedown.screengrabber",function(e){if(base._toolSelected===!0){var i;for(i=1;i<=base._undoCount;i++){var d=0;for(var abc in base._drawArray)var d=abc;delete base._drawArray[d],base._baseArray.pop()}base._undoCount=0,base.id=Math.round(1e7*Math.random()),base._baseArray.push(base.id),"rectangle"===base._selectedTool&&(base._grabAreaDrag=!0,base._innerDragEle=$("<div>").attr({id:base.id,"class":"ui-zsg-editor-blackout"}).appendTo(base._outerDragEle),base._drawArray["draw"+base.id]={tool:"rectangle",offset:{Xaxis:0,Yaxis:0,Width:0,Height:0}},start=[e.clientX,e.clientY+base._screenGrabberArea.scrollTop()]),"line"===base._selectedTool&&(base._drawArray["draw"+base.id]=[],base._drawArray["draw"+base.id].offset=[],base._drawArray["draw"+base.id].tool="line",base._drawArray["draw"+base.id].zoom=base._isZoomedIn?"zoom-in":"zoom-out",base._grabAreaDrag=!0,e._x=e.clientX,e._y=e.clientY+base._screenGrabberArea.scrollTop(),base._ctx.beginPath(),base._ctx.moveTo(e._x-base._defLeft,e._y-base._defTop),base._drawArray["draw"+base.id].offset[base._drawArray["draw"+base.id].offset.length]={Xaxis:e._x-base._defLeft,Yaxis:e._y-base._defTop})}}).on("mouseup.screengrabber",function(){base._grabAreaDrag=!1,"line"===base._selectedTool&&setTimeout(function(){base._drawCurve()},100)}).on("mousemove.screengrabber",function(e){if($("body").get(0).style.cursor="auto",base._grabAreaDrag===!0)if("rectangle"===base._selectedTool){end=[e.clientX,e.clientY+base._screenGrabberArea.scrollTop()];var divTop=start[1];start[1]>end[1]&&(divTop=end[1]);var divLeft=start[0];start[0]>end[0]&&(divLeft=end[0]),divHeight=Math.abs(start[1]-end[1]),divWidth=Math.abs(start[0]-end[0]),$("#"+base.id).length&&$("#"+base.id).remove(),base._drawArray["draw"+base.id]={tool:"rectangle",offset:{Xaxis:divLeft-base._defLeft,Yaxis:divTop-base._defTop,Width:base._divWidth,Height:base._divHeight}},base._innerDragEle.css({left:divLeft-base._defLeft,top:divTop-base._defTop,width:divWidth,height:divHeight}).appendTo(base._outerDragEle)}else"line"===base._selectedTool&&base._grabAreaDrag&&(e._x=e.clientX,e._y=e.clientY+base._screenGrabberArea.scrollTop(),base._ctx.lineCap="round",base._ctx.lineTo(e._x-base._defLeft,e._y-base._defTop),base._ctx.lineWidth=5,base._drawArray["draw"+base.id].offset[base._drawArray["draw"+base.id].offset.length]={Xaxis:e._x-base._defLeft,Yaxis:e._y-base._defTop},base._ctx.strokeStyle="red",base._ctx.stroke())})}}).on("mousemove.screengrabber",function(e){if(base._selectionDrag){base._mouseMove=!0,$("body").css({cursor:"crosshair"}),end1=[e.clientX,e.clientY],void 0===topDiv&&(leftDiv=$("<div>").addClass("ui-zsg-outer-bg ui-zsg-left").appendTo(base._screenGrabberArea),topDiv=$("<div>").addClass("ui-zsg-outer-bg ui-zsg-top").appendTo(base._screenGrabberArea),rightDiv=$("<div>").addClass("ui-zsg-outer-bg ui-zsg-right").appendTo(base._screenGrabberArea),bottomDiv=$("<div>").addClass("ui-zsg-outer-bg ui-zsg-bottom").appendTo(base._screenGrabberArea));var divTop1=start1[1];start1[1]>end1[1]&&(divTop1=end1[1],base._rightDrag=!0);var divLeft1=start1[0];start1[0]>end1[0]&&(divLeft1=end1[0]),divHeight1=Math.abs(start1[1]-end1[1]),divWidth1=Math.abs(start1[0]-end1[0]);var rightTop=start1[1];base._rightDrag&&(rightTop=end1[1],base._rightDrag=!1),leftDiv.css({width:divLeft1,top:divTop1,height:divHeight1}),topDiv.css({width:base._windowWidth,height:divTop1}),rightDiv.css({top:rightTop,left:divLeft1+divWidth1,height:divHeight1}),bottomDiv.css({width:base._windowWidth,height:base._windowHeight-(divTop1+divHeight1)}),base._outerDragEle.css({left:divLeft1,top:divTop1,width:divWidth1,height:divHeight1})}}).on("click.screengrabber",function(e){e.preventDefault(),e.stopPropagation()})},_pushImage:function(){var base=this;if(this._defTop<this._topBand.outerHeight()&&this._defHeight<this._topBandHeight+20)this._topBand.css({top:this._defTop+this._defHeight,opacity:1}).fadeIn(250);else if(this._defTop<this._topBand.outerHeight()){this._topBand.addClass("ui-zsg-draggable").css({top:this._defTop-this._topBand.outerHeight()}).animate({top:this._defTop,opacity:1},300);var mousex,mousey,move=!1;this._topBand.on("mousedown.screengrabber",function(e){$(e.target)[0]===$("#ui-zsg-toolbar-left")[0]&&(mousex=e.clientX,mousey=e.clientY,move=!0,base._toolSelected=!1)}).add($("body")).on("mousemove.screengrabber",function(e){if(move){var top=parseInt(base._topBand.css("top"))+e.clientY-mousey,left=parseInt(base._topBand.css("left"))+e.clientX-mousex;0>top?top=0:top+base._topBand.outerHeight()>base._windowHeight&&(top=base._windowHeight-base._topBand.outerHeight()),0>left?left=0:left+base._topBand.outerWidth()>base._windowWidth&&(left=base._windowWidth-base._topBand.outerWidth()),base._topBand.css({top:top,left:left}),mousex=e.clientX,mousey=e.clientY,base._toolSelected=!1}}).on("mouseup.screengrabber",function(){move=!1,base._toolSelected=!0})}else this._topBand.fadeIn(250)},_createLoaderBar:function(){this._loaderBar=$("<div>").attr("data-html2canvas-ignore",!0).appendTo(this._outerDragEle),this._isIE9?this._loaderBar.addClass("ui-zsg-loading"):($("<div>").addClass("ui-zsg-loader-css1").appendTo(this._loaderBar),$("<div>").addClass("ui-zsg-loader-css2").appendTo(this._loaderBar),$("<div>").addClass("ui-zsg-loader-css3").appendTo(this._loaderBar),this._loaderBar.addClass("ui-zsg-loader"))},_drawCurve:function(){var memCanvas=document.createElement("canvas");memCanvas.width=this._defWidth,memCanvas.height=this._defHeight,this._memCtx=memCanvas.getContext("2d");var mycanvas=(memCanvas.getContext("2d"),document.getElementById("ui-zsg-editor-canvas"));for(var g in this._drawArray){if("line"===this._drawArray[g].tool){this._ctx.beginPath(),this._ctx.lineCap="round",this._ctx.lineWidth=5,this._mouseMove||(this._fullscreenScale=this._isZoomedIn?"zoom-in"===this._drawArray[g].zoom?1:1.25:"zoom-in"===this._drawArray[g].zoom?.8:1),this._ctx.scale(this._fullscreenScale,this._fullscreenScale),this._ctx.moveTo(this._drawArray[g].offset[0].Xaxis,this._drawArray[g].offset[0].Yaxis);for(var d in this._drawArray[g].offset){var e=parseInt(d)+parseInt(1);if(e<this._drawArray[g].offset.length){this._ctx.clearRect(0,0,this._defWidth,this._defHeight);var s=(this._drawArray[g].offset[d].Xaxis+this._drawArray[g].offset[e].Xaxis)/2,t=(this._drawArray[g].offset[d].Yaxis+this._drawArray[g].offset[e].Yaxis)/2;this._ctx.quadraticCurveTo(this._drawArray[g].offset[d].Xaxis,this._drawArray[g].offset[d].Yaxis,s,t),this._ctx.stroke(),this._ctx.strokeStyle="red"}}this._memCtx.drawImage(mycanvas,0,0)}this._mouseMove||this._ctx.scale(1/this._fullscreenScale,1/this._fullscreenScale)}this._ctx.drawImage(memCanvas,0,0)},_undoRedo:function(){var memCanvas=document.createElement("canvas");memCanvas.width=this._defWidth,memCanvas.height=this._defHeight,this._memCtx=memCanvas.getContext("2d");var mycanvas=document.getElementById("ui-zsg-editor-canvas");if(this._baseArray.length-this._undoCount===0)this._ctx.clearRect(0,0,this._defWidth,this._defHeight);else for(var i=0;i<this._baseArray.length-this._undoCount;i++){var g="draw"+this._baseArray[i];if(this._ctx.clearRect(0,0,this._defWidth,this._defHeight),"line"===this._drawArray[g].tool){this._ctx.beginPath(),this._ctx.lineCap="round",this._ctx.lineWidth=5,this._mouseMove||(this._fullscreenScaleRedo=this._isZoomedIn?"zoom-in"===this._drawArray[g].zoom?1:1.25:"zoom-in"===this._drawArray[g].zoom?.8:1,this._ctx.scale(this._fullscreenScaleRedo,this._fullscreenScaleRedo)),this._ctx.moveTo(this._drawArray[g].offset[0].Xaxis,this._drawArray[g].offset[0].Yaxis);for(var d in this._drawArray[g].offset){var e=parseInt(d)+1;if(e<this._drawArray[g].offset.length){this._ctx.clearRect(0,0,this._defWidth,this._defHeight);var s=(this._drawArray[g].offset[d].Xaxis+this._drawArray[g].offset[e].Xaxis)/2,t=(this._drawArray[g].offset[d].Yaxis+this._drawArray[g].offset[e].Yaxis)/2;this._ctx.quadraticCurveTo(this._drawArray[g].offset[d].Xaxis,this._drawArray[g].offset[d].Yaxis,s,t),this._ctx.stroke(),this._ctx.strokeStyle="red"}}this._memCtx.drawImage(mycanvas,0,0)}this._mouseMove||this._ctx.scale(1/this._fullscreenScaleRedo,i/this._fullscreenScaleRedo)}this._ctx.drawImage(memCanvas,0,0)},_zoomImage:function(){var width,left,height,alteredSize,top=0,canvas=$("#ui-zsg-editor-canvas"),zoomDiv=(parseInt(this._outerDragEle.css("width")),$("#ui-zfc-zoomin")),zoomIcon=zoomDiv.find("span");this._isZoomedIn?(width=.8*this._windowWidth,left=.1*this._windowWidth,top=40,this._isZoomedIn=!1,alteredSize=.8,height=this._minimizedHeight,zoomIcon.attr("class","ui-icon ui-components-icon ui-icon-zoomin"),zoomDiv.attr("title",this._getString("actualsize.label")),$("#ui-zsg-grabbed-img").css({top:-(.8*this._scrollTopVal.topval)})):(width=this._windowWidth,height=this._windowHeight+this._topBandHeight,left=0,alteredSize=1.25,this._isZoomedIn=!0,zoomIcon.attr("class","ui-icon ui-components-icon ui-icon-zoomout"),zoomDiv.attr("title",this._getString("smallsize.label")),$("#ui-zsg-grabbed-img").css({top:-(1*this._scrollTopVal.topval)})),this._defTop=top+this._topBandHeight,this._defLeft=left,this._outerDragEle.css({top:top,left:left,width:width,height:height});var drawObj=void 0;this._outerDragEle.find(".ui-zsg-inner-rect").each(function(i,obj){drawObj=$(obj),drawObj.css({top:alteredSize*parseInt(drawObj.css("top")),left:alteredSize*parseInt(drawObj.css("left")),width:alteredSize*parseInt(drawObj.css("width")),height:alteredSize*parseInt(drawObj.css("height"))})}),canvas.attr({width:width,height:height}),this._defWidth=width,this._defHeight=height,this._drawCurve(!0)},_getString:function(key,module,replaceArray){return $.ui.utils.getI18NString(module,key,replaceArray,this.options.keys)},_scriptPath:function(){var scripts=document.getElementsByTagName("SCRIPT"),path="";if(scripts&&scripts.length>0)for(var i in scripts)if(scripts[i].src&&scripts[i].src.match(/\/ui.zscreengrabber\.js$/)){path=scripts[i].src.replace(/(.*)\/ui.zscreengrabber\.js$/,"$1");break}var lastDir=path.lastIndexOf("/");return path.substr(0,lastDir)},_triggerEvent:function(orgEvent,_ui){var ui=_ui;if(void 0===_ui)var ui=$.extend(ui,_ui);$("body").trigger(this.widgetEventPrefix+orgEvent,ui)}};Screengrabber.open=function(options){$("body").zscreengrabber(options)},Screengrabber.close=function(){$("body").zscreengrabber("close")},$.widget("ui.zscreengrabber",zscreengrabber),$.ui.zscreengrabber.config={keys:{"highlight.label":"Highlight","blackout.label":"Blackout","attach.label":"Attach","cancel.label":"Cancel","message.label":"Click to select the full screen. Drag to select part of the screen.","screencapturealert.label":"Unable to capture your screen due to an unknown error","screencapturefailure.label":"Sorry! We are unable to capture your screen due to an unknown error","actualsize.label":"Actual Size","smallsize.label":"Small Size","retry.label":"Retry","quit.label":"Quit"}}}(jQuery),function(window,document,undefined){"use strict";function toPX(element,attribute,value){var left,rsLeft=element.runtimeStyle&&element.runtimeStyle[attribute],style=element.style;return!/^-?[0-9]+\.?[0-9]*(?:px)?$/i.test(value)&&/^-?\d/.test(value)&&(left=style.left,rsLeft&&(element.runtimeStyle.left=element.currentStyle.left),style.left="fontSize"===attribute?"1em":value||0,value=style.pixelLeft+"px",style.left=left,rsLeft&&(element.runtimeStyle.left=rsLeft)),/^(thin|medium|thick)$/i.test(value)?value:Math.round(parseFloat(value))+"px"}function asInt(val){return parseInt(val,10)}function parseBackgroundSizePosition(value,element,attribute,index){if(value=(value||"").split(","),value=value[index||0]||value[0]||"auto",value=_html2canvas.Util.trimText(value).split(" "),"backgroundSize"===attribute&&value[0]&&value[0].match(/^(cover|contain|auto)$/))return value;if(value[0]=-1===value[0].indexOf("%")?toPX(element,attribute+"X",value[0]):value[0],value[1]===undefined){if("backgroundSize"===attribute)return value[1]="auto",value;value[1]=value[0]}return value[1]=-1===value[1].indexOf("%")?toPX(element,attribute+"Y",value[1]):value[1],value}function h2cRenderContext(width,height){var storage=[];return{storage:storage,width:width,height:height,clip:function(){storage.push({type:"function",name:"clip",arguments:arguments})},translate:function(){storage.push({type:"function",name:"translate",arguments:arguments})},fill:function(){storage.push({type:"function",name:"fill",arguments:arguments})},save:function(){storage.push({type:"function",name:"save",arguments:arguments})},restore:function(){storage.push({type:"function",name:"restore",arguments:arguments})},fillRect:function(){storage.push({type:"function",name:"fillRect",arguments:arguments})},createPattern:function(){storage.push({type:"function",name:"createPattern",arguments:arguments})},drawShape:function(){var shape=[];return storage.push({type:"function",name:"drawShape",arguments:shape}),{moveTo:function(){shape.push({name:"moveTo",arguments:arguments})},lineTo:function(){shape.push({name:"lineTo",arguments:arguments})},arcTo:function(){shape.push({name:"arcTo",arguments:arguments})},bezierCurveTo:function(){shape.push({name:"bezierCurveTo",arguments:arguments})},quadraticCurveTo:function(){shape.push({name:"quadraticCurveTo",arguments:arguments})}}},drawImage:function(){storage.push({type:"function",name:"drawImage",arguments:arguments})},fillText:function(){storage.push({type:"function",name:"fillText",arguments:arguments})},setVariable:function(variable,value){return storage.push({type:"variable",name:variable,arguments:value}),value}}}function h2czContext(zindex){return{zindex:zindex,children:[]}}var previousElement,computedCSS,_html2canvas={};_html2canvas.Util={},_html2canvas.Util.log=function(a){_html2canvas.logging&&window.console&&window.console.log&&window.console.log(a)},_html2canvas.Util.trimText=function(isNative){return function(input){return isNative?isNative.apply(input):((input||"")+"").replace(/^\s+|\s+$/g,"")}}(String.prototype.trim),_html2canvas.Util.asFloat=function(v){return parseFloat(v)},function(){var TEXT_SHADOW_PROPERTY=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g,TEXT_SHADOW_VALUES=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g;_html2canvas.Util.parseTextShadows=function(value){if(!value||"none"===value)return[];for(var shadows=value.match(TEXT_SHADOW_PROPERTY),results=[],i=0;shadows&&i<shadows.length;i++){var s=shadows[i].match(TEXT_SHADOW_VALUES);results.push({color:s[0],offsetX:s[1]?s[1].replace("px",""):0,offsetY:s[2]?s[2].replace("px",""):0,blur:s[3]?s[3].replace("px",""):0})}return results}}(),_html2canvas.Util.parseBackgroundImage=function(value){var method,definition,prefix,prefix_i,block,c,quote,args,whitespace=" \r\n	",results=[],mode=0,numParen=0,appendResult=function(){method&&('"'===definition.substr(0,1)&&(definition=definition.substr(1,definition.length-2)),definition&&args.push(definition),"-"===method.substr(0,1)&&(prefix_i=method.indexOf("-",1)+1)>0&&(prefix=method.substr(0,prefix_i),method=method.substr(prefix_i)),results.push({prefix:prefix,method:method.toLowerCase(),value:block,args:args})),args=[],method=prefix=definition=block=""};appendResult();for(var i=0,ii=value.length;ii>i;i++)if(c=value[i],!(0===mode&&whitespace.indexOf(c)>-1)){switch(c){case'"':quote?quote===c&&(quote=null):quote=c;break;case"(":if(quote)break;if(0===mode){mode=1,block+=c;continue}numParen++;break;case")":if(quote)break;if(1===mode){if(0===numParen){mode=0,block+=c,appendResult();continue}numParen--}break;case",":if(quote)break;if(0===mode){appendResult();continue}if(1===mode&&0===numParen&&!method.match(/^url$/i)){args.push(definition),definition="",block+=c;continue}}block+=c,0===mode?method+=c:definition+=c}return appendResult(),results},_html2canvas.Util.Bounds=function(element){var clientRect,bounds={};return element.getBoundingClientRect&&(clientRect=element.getBoundingClientRect(),bounds.top=clientRect.top,bounds.bottom=clientRect.bottom||clientRect.top+clientRect.height,bounds.left=clientRect.left,bounds.width=element.offsetWidth,bounds.height=element.offsetHeight,_html2canvas.Util.isFixedEle&&(bounds.top+=window.zCurrentScrollTop,bounds.left+=window.zCurrentScrollLeft)),bounds},_html2canvas.Util.OffsetBounds=function(element){var parent=element.offsetParent?_html2canvas.Util.OffsetBounds(element.offsetParent):{top:0,left:0};return{top:element.offsetTop+parent.top,bottom:element.offsetTop+element.offsetHeight+parent.top,left:element.offsetLeft+parent.left,width:element.offsetWidth,height:element.offsetHeight}},_html2canvas.Util.getCSS=function(element,attribute,index){previousElement!==element&&(computedCSS=document.defaultView.getComputedStyle(element,null));var value=computedCSS[attribute];if(/^background(Size|Position)$/.test(attribute))return parseBackgroundSizePosition(value,element,attribute,index);if(/border(Top|Bottom)(Left|Right)Radius/.test(attribute)){var arr=value.split(" ");return arr.length<=1&&(arr[1]=arr[0]),arr.map(asInt)}return value},_html2canvas.Util.resizeBounds=function(current_width,current_height,target_width,target_height,stretch_mode){var output_width,output_height,target_ratio=target_width/target_height,current_ratio=current_width/current_height;return stretch_mode&&"auto"!==stretch_mode?current_ratio>target_ratio^"contain"===stretch_mode?(output_height=target_height,output_width=target_height*current_ratio):(output_width=target_width,output_height=target_width/current_ratio):(output_width=target_width,output_height=target_height),{width:output_width,height:output_height}},_html2canvas.Util.BackgroundPosition=function(element,bounds,image,imageIndex,backgroundSize){var leftPosition,topPosition,backgroundPosition=_html2canvas.Util.getCSS(element,"backgroundPosition",imageIndex);return 1===backgroundPosition.length&&(backgroundPosition=[backgroundPosition[0],backgroundPosition[0]]),leftPosition=-1!==backgroundPosition[0].toString().indexOf("%")?(bounds.width-(backgroundSize||image).width)*(parseFloat(backgroundPosition[0])/100):parseInt(backgroundPosition[0],10),topPosition="auto"===backgroundPosition[1]?leftPosition/image.width*image.height:-1!==backgroundPosition[1].toString().indexOf("%")?(bounds.height-(backgroundSize||image).height)*parseFloat(backgroundPosition[1])/100:isNaN(parseInt(backgroundPosition[1],10))?topPosition:parseInt(backgroundPosition[1],10),"auto"===backgroundPosition[0]&&(leftPosition=topPosition/image.height*image.width),{left:leftPosition,top:topPosition}},_html2canvas.Util.BackgroundSize=function(element,bounds,image,imageIndex){var width,height,backgroundSize=_html2canvas.Util.getCSS(element,"backgroundSize",imageIndex);if(1===backgroundSize.length&&(backgroundSize=[backgroundSize[0],backgroundSize[0]]),-1!==backgroundSize[0].toString().indexOf("%"))width=bounds.width*parseFloat(backgroundSize[0])/100;else if("auto"===backgroundSize[0])width=image.width;else{if(/contain|cover/.test(backgroundSize[0])){var resized=_html2canvas.Util.resizeBounds(image.width,image.height,bounds.width,bounds.height,backgroundSize[0]);return{width:resized.width,height:resized.height}}width=parseInt(backgroundSize[0],10)}return height="auto"===backgroundSize[1]?width/image.width*image.height:-1!==backgroundSize[1].toString().indexOf("%")?bounds.height*parseFloat(backgroundSize[1])/100:parseInt(backgroundSize[1],10),"auto"===backgroundSize[0]&&(width=height/image.height*image.width),{width:width,height:height}},_html2canvas.Util.Extend=function(options,defaults){for(var key in options)options.hasOwnProperty(key)&&(defaults[key]=options[key]);return defaults},_html2canvas.Util.Children=function(elem){var children;try{children=elem.nodeName&&"IFRAME"===elem.nodeName.toUpperCase()?elem.contentDocument||elem.contentWindow.document:function(array){var ret=[];return null!==array&&!function(first,second){var i=first.length,j=0;if("number"==typeof second.length)for(var l=second.length;l>j;j++)first[i++]=second[j];else for(;second[j]!==undefined;)first[i++]=second[j++];return first.length=i,first}(ret,array),ret}(elem.childNodes)}catch(ex){_html2canvas.Util.log("html2canvas.Util.Children failed with exception: "+ex.message),children=[]}return children},_html2canvas.Util.isTransparent=function(backgroundColor){return!backgroundColor||"transparent"===backgroundColor||"rgba(0, 0, 0, 0)"===backgroundColor},_html2canvas.Util.Font=function(){var fontData={};return function(font,fontSize,doc){if(fontData[font+"-"+fontSize]!==undefined)return fontData[font+"-"+fontSize];var baseline,middle,metricsObj,container=doc.createElement("div"),img=doc.createElement("img"),span=doc.createElement("span"),sampleText="Hidden Text";return container.style.visibility="hidden",container.style.fontFamily=font,container.style.fontSize=fontSize,container.style.margin=0,container.style.padding=0,doc.body.appendChild(container),img.src="data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=",img.width=1,img.height=1,img.style.margin=0,img.style.padding=0,img.style.verticalAlign="baseline",span.style.fontFamily=font,span.style.fontSize=fontSize,span.style.margin=0,span.style.padding=0,span.appendChild(doc.createTextNode(sampleText)),container.appendChild(span),container.appendChild(img),baseline=img.offsetTop-span.offsetTop+1,container.removeChild(span),container.appendChild(doc.createTextNode(sampleText)),container.style.lineHeight="normal",img.style.verticalAlign="super",middle=img.offsetTop-container.offsetTop+1,metricsObj={baseline:baseline,lineWidth:1,middle:middle},fontData[font+"-"+fontSize]=metricsObj,doc.body.removeChild(container),metricsObj}}(),function(){function addScrollStops(grad){return function(colorStop){try{grad.addColorStop(colorStop.stop,colorStop.color)}catch(e){Util.log(["failed to add color stop: ",e,"; tried to add: ",colorStop])}}}var Util=_html2canvas.Util,Generate={};_html2canvas.Generate=Generate;var reGradients=[/^(-webkit-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-gradient)\((linear|radial),\s((?:\d{1,3}%?)\s(?:\d{1,3}%?),\s(?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)\-]+)\)$/,/^(-moz-linear-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-moz-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s?([a-z\-]*)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/];Generate.parseGradient=function(css,bounds){var gradient,i,m1,stop,m2,m2Len,step,m3,tl,tr,br,bl,len=reGradients.length;for(i=0;len>i&&!(m1=css.match(reGradients[i]));i+=1);if(m1)switch(m1[1]){case"-webkit-linear-gradient":case"-o-linear-gradient":if(gradient={type:"linear",x0:null,y0:null,x1:null,y1:null,colorStops:[]},m2=m1[2].match(/\w+/g))for(m2Len=m2.length,i=0;m2Len>i;i+=1)switch(m2[i]){case"top":gradient.y0=0,gradient.y1=bounds.height;break;case"right":gradient.x0=bounds.width,gradient.x1=0;break;case"bottom":gradient.y0=bounds.height,gradient.y1=0;break;case"left":gradient.x0=0,gradient.x1=bounds.width}if(null===gradient.x0&&null===gradient.x1&&(gradient.x0=gradient.x1=bounds.width/2),null===gradient.y0&&null===gradient.y1&&(gradient.y0=gradient.y1=bounds.height/2),m2=m1[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g))for(m2Len=m2.length,step=1/Math.max(m2Len-1,1),i=0;m2Len>i;i+=1)m3=m2[i].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/),m3[2]?(stop=parseFloat(m3[2]),stop/="%"===m3[3]?100:bounds.width):stop=i*step,gradient.colorStops.push({color:m3[1],stop:stop});break;case"-webkit-gradient":if(gradient={type:"radial"===m1[2]?"circle":m1[2],x0:0,y0:0,x1:0,y1:0,colorStops:[]},m2=m1[3].match(/(\d{1,3})%?\s(\d{1,3})%?,\s(\d{1,3})%?\s(\d{1,3})%?/),m2&&(gradient.x0=m2[1]*bounds.width/100,gradient.y0=m2[2]*bounds.height/100,gradient.x1=m2[3]*bounds.width/100,gradient.y1=m2[4]*bounds.height/100),m2=m1[4].match(/((?:from|to|color-stop)\((?:[0-9\.]+,\s)?(?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)\))+/g))for(m2Len=m2.length,i=0;m2Len>i;i+=1)m3=m2[i].match(/(from|to|color-stop)\(([0-9\.]+)?(?:,\s)?((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\)/),stop=parseFloat(m3[2]),"from"===m3[1]&&(stop=0),"to"===m3[1]&&(stop=1),gradient.colorStops.push({color:m3[3],stop:stop});break;case"-moz-linear-gradient":if(gradient={type:"linear",x0:0,y0:0,x1:0,y1:0,colorStops:[]},m2=m1[2].match(/(\d{1,3})%?\s(\d{1,3})%?/),m2&&(gradient.x0=m2[1]*bounds.width/100,gradient.y0=m2[2]*bounds.height/100,gradient.x1=bounds.width-gradient.x0,gradient.y1=bounds.height-gradient.y0),m2=m1[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}%)?)+/g))for(m2Len=m2.length,step=1/Math.max(m2Len-1,1),i=0;m2Len>i;i+=1)m3=m2[i].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%)?/),m3[2]?(stop=parseFloat(m3[2]),m3[3]&&(stop/=100)):stop=i*step,gradient.colorStops.push({color:m3[1],stop:stop});break;case"-webkit-radial-gradient":case"-moz-radial-gradient":case"-o-radial-gradient":if(gradient={type:"circle",x0:0,y0:0,x1:bounds.width,y1:bounds.height,cx:0,cy:0,rx:0,ry:0,colorStops:[]},m2=m1[2].match(/(\d{1,3})%?\s(\d{1,3})%?/),m2&&(gradient.cx=m2[1]*bounds.width/100,gradient.cy=m2[2]*bounds.height/100),m2=m1[3].match(/\w+/),m3=m1[4].match(/[a-z\-]*/),m2&&m3)switch(m3[0]){case"farthest-corner":case"cover":case"":tl=Math.sqrt(Math.pow(gradient.cx,2)+Math.pow(gradient.cy,2)),tr=Math.sqrt(Math.pow(gradient.cx,2)+Math.pow(gradient.y1-gradient.cy,2)),br=Math.sqrt(Math.pow(gradient.x1-gradient.cx,2)+Math.pow(gradient.y1-gradient.cy,2)),bl=Math.sqrt(Math.pow(gradient.x1-gradient.cx,2)+Math.pow(gradient.cy,2)),gradient.rx=gradient.ry=Math.max(tl,tr,br,bl);break;case"closest-corner":tl=Math.sqrt(Math.pow(gradient.cx,2)+Math.pow(gradient.cy,2)),tr=Math.sqrt(Math.pow(gradient.cx,2)+Math.pow(gradient.y1-gradient.cy,2)),br=Math.sqrt(Math.pow(gradient.x1-gradient.cx,2)+Math.pow(gradient.y1-gradient.cy,2)),bl=Math.sqrt(Math.pow(gradient.x1-gradient.cx,2)+Math.pow(gradient.cy,2)),gradient.rx=gradient.ry=Math.min(tl,tr,br,bl);break;case"farthest-side":"circle"===m2[0]?gradient.rx=gradient.ry=Math.max(gradient.cx,gradient.cy,gradient.x1-gradient.cx,gradient.y1-gradient.cy):(gradient.type=m2[0],gradient.rx=Math.max(gradient.cx,gradient.x1-gradient.cx),gradient.ry=Math.max(gradient.cy,gradient.y1-gradient.cy));break;case"closest-side":case"contain":"circle"===m2[0]?gradient.rx=gradient.ry=Math.min(gradient.cx,gradient.cy,gradient.x1-gradient.cx,gradient.y1-gradient.cy):(gradient.type=m2[0],gradient.rx=Math.min(gradient.cx,gradient.x1-gradient.cx),gradient.ry=Math.min(gradient.cy,gradient.y1-gradient.cy))}if(m2=m1[5].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g))for(m2Len=m2.length,step=1/Math.max(m2Len-1,1),i=0;m2Len>i;i+=1)m3=m2[i].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/),m3[2]?(stop=parseFloat(m3[2]),stop/="%"===m3[3]?100:bounds.width):stop=i*step,gradient.colorStops.push({color:m3[1],stop:stop})}return gradient},Generate.Gradient=function(src,bounds){if(0!==bounds.width&&0!==bounds.height){var gradient,grad,canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");if(canvas.width=bounds.width,canvas.height=bounds.height,gradient=_html2canvas.Generate.parseGradient(src,bounds))switch(gradient.type){case"linear":grad=ctx.createLinearGradient(gradient.x0,gradient.y0,gradient.x1,gradient.y1),gradient.colorStops.forEach(addScrollStops(grad)),ctx.fillStyle=grad,ctx.fillRect(0,0,bounds.width,bounds.height);break;case"circle":grad=ctx.createRadialGradient(gradient.cx,gradient.cy,0,gradient.cx,gradient.cy,gradient.rx),gradient.colorStops.forEach(addScrollStops(grad)),ctx.fillStyle=grad,ctx.fillRect(0,0,bounds.width,bounds.height);break;case"ellipse":var canvasRadial=document.createElement("canvas"),ctxRadial=canvasRadial.getContext("2d"),ri=Math.max(gradient.rx,gradient.ry),di=2*ri;canvasRadial.width=canvasRadial.height=di,grad=ctxRadial.createRadialGradient(gradient.rx,gradient.ry,0,gradient.rx,gradient.ry,ri),gradient.colorStops.forEach(addScrollStops(grad)),ctxRadial.fillStyle=grad,ctxRadial.fillRect(0,0,di,di),ctx.fillStyle=gradient.colorStops[gradient.colorStops.length-1].color,ctx.fillRect(0,0,canvas.width,canvas.height),ctx.drawImage(canvasRadial,gradient.cx-gradient.rx,gradient.cy-gradient.ry,2*gradient.rx,2*gradient.ry)}return canvas}},Generate.ListAlpha=function(number){var modulus,tmp="";do modulus=number%26,tmp=String.fromCharCode(modulus+64)+tmp,number/=26;while(26*number>26);return tmp},Generate.ListRoman=function(number){var v,romanArray=["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"],decimal=[1e3,900,500,400,100,90,50,40,10,9,5,4,1],roman="",len=romanArray.length;if(0>=number||number>=4e3)return number;for(v=0;len>v;v+=1)for(;number>=decimal[v];)number-=decimal[v],roman+=romanArray[v];return roman}}(),_html2canvas.Parse=function(images,options){function documentWidth(){return Math.max(Math.max(doc.body.scrollWidth,doc.documentElement.scrollWidth),Math.max(doc.body.offsetWidth,doc.documentElement.offsetWidth),Math.max(doc.body.clientWidth,doc.documentElement.clientWidth))}function documentHeight(){return Math.max(Math.max(doc.body.scrollHeight,doc.documentElement.scrollHeight),Math.max(doc.body.offsetHeight,doc.documentElement.offsetHeight),Math.max(doc.body.clientHeight,doc.documentElement.clientHeight))}function getCSSInt(element,attribute){var val=parseInt(getCSS(element,attribute),10);return isNaN(val)?0:val}function renderRect(ctx,x,y,w,h,bgcolor){"transparent"!==bgcolor&&(ctx.setVariable("fillStyle",bgcolor),ctx.fillRect(x,y,w,h),numDraws+=1)}function capitalize(m,p1,p2){return m.length>0?p1+p2.toUpperCase():void 0}function textTransform(text,transform){switch(transform){case"lowercase":return text.toLowerCase();case"capitalize":return text.replace(/(^|\s|:|-|\(|\))([a-z])/g,capitalize);case"uppercase":return text.toUpperCase();default:return text}}function noLetterSpacing(letter_spacing){return/^(normal|none|0px)$/.test(letter_spacing)}function drawText(currentText,x,y,ctx){null!==currentText&&Util.trimText(currentText).length>0&&(ctx.fillText(currentText,x,y),numDraws+=1)}function setTextVariables(ctx,el,text_decoration,color){var align=!1,bold=getCSS(el,"fontWeight"),family=getCSS(el,"fontFamily"),size=getCSS(el,"fontSize"),shadows=Util.parseTextShadows(getCSS(el,"textShadow"));switch(parseInt(bold,10)){case 401:bold="bold";break;case 400:bold="normal"}return ctx.setVariable("fillStyle",color),ctx.setVariable("font",[getCSS(el,"fontStyle"),getCSS(el,"fontVariant"),bold,size,family].join(" ")),ctx.setVariable("textAlign",align?"right":"left"),shadows.length&&(ctx.setVariable("shadowColor",shadows[0].color),ctx.setVariable("shadowOffsetX",shadows[0].offsetX),ctx.setVariable("shadowOffsetY",shadows[0].offsetY),ctx.setVariable("shadowBlur",shadows[0].blur)),"none"!==text_decoration?Util.Font(family,size,doc):void 0}function renderTextDecoration(ctx,text_decoration,bounds,metrics,color){switch(text_decoration){case"underline":renderRect(ctx,bounds.left,Math.round(bounds.top+metrics.baseline+metrics.lineWidth),bounds.width,1,color);break;case"overline":renderRect(ctx,bounds.left,Math.round(bounds.top),bounds.width,1,color);break;case"line-through":renderRect(ctx,bounds.left,Math.ceil(bounds.top+metrics.middle+metrics.lineWidth),bounds.width,1,color)}}function getTextBounds(state,text,textDecoration,isLast,transform){var bounds;if(support.rangeBounds&&!transform)("none"!==textDecoration||0!==Util.trimText(text).length)&&(bounds=textRangeBounds(text,state.node,state.textOffset)),state.textOffset+=text.length;else if(state.node&&"string"==typeof state.node.nodeValue){var newTextNode=isLast?state.node.splitText(text.length):null;bounds=textWrapperBounds(state.node,transform),state.node=newTextNode}return bounds}function textRangeBounds(text,textNode,textOffset){var range=doc.createRange();return range.setStart(textNode,textOffset),range.setEnd(textNode,textOffset+text.length),range.getBoundingClientRect()}function textWrapperBounds(oldTextNode,transform){var parent=oldTextNode.parentNode,wrapElement=doc.createElement("wrapper"),backupText=oldTextNode.cloneNode(!0);wrapElement.appendChild(oldTextNode.cloneNode(!0)),parent.replaceChild(wrapElement,oldTextNode);var bounds=transform?Util.OffsetBounds(wrapElement):Util.Bounds(wrapElement);return parent.replaceChild(backupText,wrapElement),bounds}function renderText(el,textNode,stack){var metrics,textList,ctx=stack.ctx,color=getCSS(el,"color"),textDecoration=getCSS(el,"textDecoration"),textAlign=getCSS(el,"textAlign"),state={node:textNode,textOffset:0};Util.trimText(textNode.nodeValue).length>0&&(textNode.nodeValue=textTransform(textNode.nodeValue,getCSS(el,"textTransform")),textAlign=textAlign.replace(["-webkit-auto"],["auto"]),textList=textNode.nodeValue.split(!options.letterRendering&&/^(left|right|justify|auto)$/.test(textAlign)&&noLetterSpacing(getCSS(el,"letterSpacing"))?/(\b| )/:""),metrics=setTextVariables(ctx,el,textDecoration,color),options.chinese&&textList.forEach(function(word,index){/.*[\u4E00-\u9FA5].*$/.test(word)&&(word=word.split(""),word.unshift(index,1),textList.splice.apply(textList,word))}),textList.forEach(function(text,index){var bounds=getTextBounds(state,text,textDecoration,index<textList.length-1,stack.transform.matrix);if(bounds){var eleTop=bounds.top+bounds.height,eleLeft=bounds.left;_html2canvas.Util.isFixedEle&&(eleTop+=window.zCurrentScrollTop,eleLeft+=window.zCurrentScrollLeft),drawText(text,eleLeft,eleTop,ctx),renderTextDecoration(ctx,textDecoration,bounds,metrics,color)}}))}function listPosition(element,val){var originalType,bounds,boundElement=doc.createElement("boundelement");return boundElement.style.display="inline",originalType=element.style.listStyleType,element.style.listStyleType="none",boundElement.appendChild(doc.createTextNode(val)),element.insertBefore(boundElement,element.firstChild),bounds=Util.Bounds(boundElement),element.removeChild(boundElement),element.style.listStyleType=originalType,bounds}function elementIndex(el){var i=-1,count=1,childs=el.parentNode.childNodes;if(el.parentNode){for(;childs[++i]!==el;)1===childs[i].nodeType&&count++;return count}return-1}function listItemText(element,type){var text,currentIndex=elementIndex(element);switch(type){case"decimal":text=currentIndex;break;case"decimal-leading-zero":text=1===currentIndex.toString().length?currentIndex="0"+currentIndex.toString():currentIndex.toString();break;case"upper-roman":text=_html2canvas.Generate.ListRoman(currentIndex);break;case"lower-roman":text=_html2canvas.Generate.ListRoman(currentIndex).toLowerCase();break;case"lower-alpha":text=_html2canvas.Generate.ListAlpha(currentIndex).toLowerCase();break;case"upper-alpha":text=_html2canvas.Generate.ListAlpha(currentIndex)}return text+". "}function renderListItem(element,stack,elBounds){var x,text,listBounds,ctx=stack.ctx,type=getCSS(element,"listStyleType");if(/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(type)){if(text=listItemText(element,type),listBounds=listPosition(element,text),setTextVariables(ctx,element,"none",getCSS(element,"color")),"inside"!==getCSS(element,"listStylePosition"))return;ctx.setVariable("textAlign","left"),x=elBounds.left,drawText(text,x,listBounds.bottom,ctx)}}function loadImage(src){var img=images[src];return img&&img.succeeded===!0?img.img:!1}function clipBounds(src,dst){var x=Math.max(src.left,dst.left),y=Math.max(src.top,dst.top),x2=Math.min(src.left+src.width,dst.left+dst.width),y2=Math.min(src.top+src.height,dst.top+dst.height);return{left:x,top:y,width:x2-x,height:y2-y}}function setZ(element,stack,parentStack){var newContext,isPositioned="static"!==stack.cssPosition,zIndex=isPositioned?getCSS(element,"zIndex"):0,opacity=getCSS(element,"opacity"),isFloated="none"!==getCSS(element,"cssFloat");stack.zIndex=newContext=h2czContext(zIndex),newContext.isPositioned=isPositioned,newContext.isFloated=isFloated,newContext.opacity=opacity,newContext.ownStacking="auto"!==zIndex||1>opacity,parentStack&&parentStack.zIndex.children.push(stack)}function renderImage(ctx,element,image,bounds,borders){var paddingLeft=getCSSInt(element,"paddingLeft"),paddingTop=getCSSInt(element,"paddingTop"),paddingRight=getCSSInt(element,"paddingRight"),paddingBottom=getCSSInt(element,"paddingBottom");drawImage(ctx,image,0,0,image.width,image.height,bounds.left+paddingLeft+borders[3].width,bounds.top+paddingTop+borders[0].width,bounds.width-(borders[1].width+borders[3].width+paddingLeft+paddingRight),bounds.height-(borders[0].width+borders[2].width+paddingTop+paddingBottom))}function getBorderData(element){return["Top","Right","Bottom","Left"].map(function(side){return{width:getCSSInt(element,"border"+side+"Width"),color:getCSS(element,"border"+side+"Color")}})}function getBorderRadiusData(element){return["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(side){return getCSS(element,"border"+side+"Radius")})}function bezierCurve(start,startControl,endControl,end){var lerp=function(a,b,t){return{x:a.x+(b.x-a.x)*t,y:a.y+(b.y-a.y)*t}};return{start:start,startControl:startControl,endControl:endControl,end:end,subdivide:function(t){var ab=lerp(start,startControl,t),bc=lerp(startControl,endControl,t),cd=lerp(endControl,end,t),abbc=lerp(ab,bc,t),bccd=lerp(bc,cd,t),dest=lerp(abbc,bccd,t);return[bezierCurve(start,ab,abbc,dest),bezierCurve(dest,bccd,cd,end)]},curveTo:function(borderArgs){borderArgs.push(["bezierCurve",startControl.x,startControl.y,endControl.x,endControl.y,end.x,end.y])},curveToReversed:function(borderArgs){borderArgs.push(["bezierCurve",endControl.x,endControl.y,startControl.x,startControl.y,start.x,start.y])}}}function parseCorner(borderArgs,radius1,radius2,corner1,corner2,x,y){radius1[0]>0||radius1[1]>0?(borderArgs.push(["line",corner1[0].start.x,corner1[0].start.y]),corner1[0].curveTo(borderArgs),corner1[1].curveTo(borderArgs)):borderArgs.push(["line",x,y]),(radius2[0]>0||radius2[1]>0)&&borderArgs.push(["line",corner2[0].start.x,corner2[0].start.y])}function drawSide(borderData,radius1,radius2,outer1,inner1,outer2,inner2){var borderArgs=[];return radius1[0]>0||radius1[1]>0?(borderArgs.push(["line",outer1[1].start.x,outer1[1].start.y]),outer1[1].curveTo(borderArgs)):borderArgs.push(["line",borderData.c1[0],borderData.c1[1]]),radius2[0]>0||radius2[1]>0?(borderArgs.push(["line",outer2[0].start.x,outer2[0].start.y]),outer2[0].curveTo(borderArgs),borderArgs.push(["line",inner2[0].end.x,inner2[0].end.y]),inner2[0].curveToReversed(borderArgs)):(borderArgs.push(["line",borderData.c2[0],borderData.c2[1]]),borderArgs.push(["line",borderData.c3[0],borderData.c3[1]])),radius1[0]>0||radius1[1]>0?(borderArgs.push(["line",inner1[1].end.x,inner1[1].end.y]),inner1[1].curveToReversed(borderArgs)):borderArgs.push(["line",borderData.c4[0],borderData.c4[1]]),borderArgs}function calculateCurvePoints(bounds,borderRadius,borders){var x=bounds.left,y=bounds.top,width=bounds.width,height=bounds.height,tlh=borderRadius[0][0],tlv=borderRadius[0][1],trh=borderRadius[1][0],trv=borderRadius[1][1],brh=borderRadius[2][0],brv=borderRadius[2][1],blh=borderRadius[3][0],blv=borderRadius[3][1],halfHeight=Math.floor(height/2);tlh=tlh>halfHeight?halfHeight:tlh,tlv=tlv>halfHeight?halfHeight:tlv,trh=trh>halfHeight?halfHeight:trh,trv=trv>halfHeight?halfHeight:trv,brh=brh>halfHeight?halfHeight:brh,brv=brv>halfHeight?halfHeight:brv,blh=blh>halfHeight?halfHeight:blh,blv=blv>halfHeight?halfHeight:blv;var topWidth=width-trh,rightHeight=height-brv,bottomWidth=width-brh,leftHeight=height-blv;return{topLeftOuter:getCurvePoints(x,y,tlh,tlv).topLeft.subdivide(.5),topLeftInner:getCurvePoints(x+borders[3].width,y+borders[0].width,Math.max(0,tlh-borders[3].width),Math.max(0,tlv-borders[0].width)).topLeft.subdivide(.5),topRightOuter:getCurvePoints(x+topWidth,y,trh,trv).topRight.subdivide(.5),topRightInner:getCurvePoints(x+Math.min(topWidth,width+borders[3].width),y+borders[0].width,topWidth>width+borders[3].width?0:trh-borders[3].width,trv-borders[0].width).topRight.subdivide(.5),bottomRightOuter:getCurvePoints(x+bottomWidth,y+rightHeight,brh,brv).bottomRight.subdivide(.5),bottomRightInner:getCurvePoints(x+Math.min(bottomWidth,width+borders[3].width),y+Math.min(rightHeight,height+borders[0].width),Math.max(0,brh-borders[1].width),Math.max(0,brv-borders[2].width)).bottomRight.subdivide(.5),bottomLeftOuter:getCurvePoints(x,y+leftHeight,blh,blv).bottomLeft.subdivide(.5),bottomLeftInner:getCurvePoints(x+borders[3].width,y+leftHeight,Math.max(0,blh-borders[3].width),Math.max(0,blv-borders[2].width)).bottomLeft.subdivide(.5)}}function getBorderClip(element,borderPoints,borders,radius,bounds){var backgroundClip=getCSS(element,"backgroundClip"),borderArgs=[];switch(backgroundClip){case"content-box":case"padding-box":parseCorner(borderArgs,radius[0],radius[1],borderPoints.topLeftInner,borderPoints.topRightInner,bounds.left+borders[3].width,bounds.top+borders[0].width),parseCorner(borderArgs,radius[1],radius[2],borderPoints.topRightInner,borderPoints.bottomRightInner,bounds.left+bounds.width-borders[1].width,bounds.top+borders[0].width),parseCorner(borderArgs,radius[2],radius[3],borderPoints.bottomRightInner,borderPoints.bottomLeftInner,bounds.left+bounds.width-borders[1].width,bounds.top+bounds.height-borders[2].width),parseCorner(borderArgs,radius[3],radius[0],borderPoints.bottomLeftInner,borderPoints.topLeftInner,bounds.left+borders[3].width,bounds.top+bounds.height-borders[2].width);break;default:parseCorner(borderArgs,radius[0],radius[1],borderPoints.topLeftOuter,borderPoints.topRightOuter,bounds.left,bounds.top),parseCorner(borderArgs,radius[1],radius[2],borderPoints.topRightOuter,borderPoints.bottomRightOuter,bounds.left+bounds.width,bounds.top),parseCorner(borderArgs,radius[2],radius[3],borderPoints.bottomRightOuter,borderPoints.bottomLeftOuter,bounds.left+bounds.width,bounds.top+bounds.height),parseCorner(borderArgs,radius[3],radius[0],borderPoints.bottomLeftOuter,borderPoints.topLeftOuter,bounds.left,bounds.top+bounds.height)}return borderArgs}function parseBorders(element,bounds,borders){var borderSide,bx,by,bw,bh,borderArgs,x=bounds.left,y=bounds.top,width=bounds.width,height=bounds.height,borderRadius=getBorderRadiusData(element),borderPoints=calculateCurvePoints(bounds,borderRadius,borders),borderData={clip:getBorderClip(element,borderPoints,borders,borderRadius,bounds),borders:[]};for(borderSide=0;4>borderSide;borderSide++)if(borders[borderSide].width>0){switch(bx=x,by=y,bw=width,bh=height-borders[2].width,borderSide){case 0:bh=borders[0].width,borderArgs=drawSide({c1:[bx,by],c2:[bx+bw,by],c3:[bx+bw-borders[1].width,by+bh],c4:[bx+borders[3].width,by+bh]},borderRadius[0],borderRadius[1],borderPoints.topLeftOuter,borderPoints.topLeftInner,borderPoints.topRightOuter,borderPoints.topRightInner);break;case 1:bx=x+width-borders[1].width,bw=borders[1].width,borderArgs=drawSide({c1:[bx+bw,by],c2:[bx+bw,by+bh+borders[2].width],c3:[bx,by+bh],c4:[bx,by+borders[0].width]},borderRadius[1],borderRadius[2],borderPoints.topRightOuter,borderPoints.topRightInner,borderPoints.bottomRightOuter,borderPoints.bottomRightInner);break;case 2:by=by+height-borders[2].width,bh=borders[2].width,borderArgs=drawSide({c1:[bx+bw,by+bh],c2:[bx,by+bh],c3:[bx+borders[3].width,by],c4:[bx+bw-borders[3].width,by]},borderRadius[2],borderRadius[3],borderPoints.bottomRightOuter,borderPoints.bottomRightInner,borderPoints.bottomLeftOuter,borderPoints.bottomLeftInner);break;case 3:bw=borders[3].width,borderArgs=drawSide({c1:[bx,by+bh+borders[2].width],c2:[bx,by],c3:[bx+bw,by+borders[0].width],c4:[bx+bw,by+bh]},borderRadius[3],borderRadius[0],borderPoints.bottomLeftOuter,borderPoints.bottomLeftInner,borderPoints.topLeftOuter,borderPoints.topLeftInner)}borderData.borders.push({args:borderArgs,color:borders[borderSide].color})}return borderData}function createShape(ctx,args){var shape=ctx.drawShape();return args.forEach(function(border,index){shape[0===index?"moveTo":border[0]+"To"].apply(null,border.slice(1))}),shape}function renderBorders(ctx,borderArgs,color){"transparent"!==color&&(ctx.setVariable("fillStyle",color),createShape(ctx,borderArgs),ctx.fill(),numDraws+=1)}function renderFormValue(el,bounds,stack){var textValue,textNode,valueWrap=doc.createElement("valuewrap"),cssPropertyArray=["lineHeight","textAlign","fontFamily","color","fontSize","paddingLeft","paddingTop","width","height","border","borderLeftWidth","borderTopWidth"];if(cssPropertyArray.forEach(function(property){try{valueWrap.style[property]=getCSS(el,property)}catch(e){Util.log("html2canvas: Parse: Exception caught in renderFormValue: "+e.message)}}),valueWrap.style.borderColor="black",valueWrap.style.borderStyle="solid",valueWrap.style.display="block",valueWrap.style.position="absolute",(/^(submit|reset|button|text|password)$/.test(el.type)||"SELECT"===el.nodeName)&&(valueWrap.style.lineHeight=getCSS(el,"height")),valueWrap.style.top=bounds.top+"px",valueWrap.style.left=bounds.left+"px",textValue=el.value,"SELECT"===el.nodeName&&(textValue=" ",el.hasAttribute("multiple")||(textValue="SELECT"===el.nodeName?(el.options[el.selectedIndex]||el.options[0]).text:el.value)),"OPTION"===el.nodeName){var parentNode=el.parentNode;textValue="SELECT"===parentNode.nodeName?(parentNode.options[parentNode.selectedIndex]||parentNode.options[0]).text:parentNode.value,el.parentNode.hasAttribute("multiple")&&(textValue=el.text)}("checkbox"===el.type||"radio"===el.type)&&(valueWrap.style.fontSize="10px",valueWrap.style.lineHeight="10px",renderRect(stack.ctx,bounds.left-2,bounds.top-1,13,13,"#888888"),renderRect(stack.ctx,bounds.left-1,bounds.top,11,11,"#dddddd"),"checkbox"===el.type?textValue=el.checked?"":" ":"radio"===el.type&&(textValue=el.checked?"":" ")),textValue||(textValue=el.placeholder),textNode=doc.createTextNode(textValue),valueWrap.appendChild(textNode),body.appendChild(valueWrap),renderText(el,textNode,stack),body.removeChild(valueWrap)}function drawImage(ctx){ctx.drawImage.apply(ctx,Array.prototype.slice.call(arguments,1)),numDraws+=1}function getPseudoElement(el,which){var elStyle=window.getComputedStyle(el,which);if(elStyle&&elStyle.content&&"none"!==elStyle.content&&"-moz-alt-content"!==elStyle.content&&"none"!==elStyle.display){var content=elStyle.content+"",first=content.substr(0,1);first===content.substr(content.length-1)&&first.match(/'|"/)&&(content=content.substr(1,content.length-2));var isImage="url"===content.substr(0,3),elps=document.createElement(isImage?"img":"span");elps.className=pseudoHide+"-before "+pseudoHide+"-after";for(var prop in elStyle)if(indexedProperty(prop)&&"cssText"!==prop)try{elps.style[prop]=elStyle[prop]}catch(e){Util.log(["Tried to assign readonly property ",prop,"Error:",e])}return isImage?elps.src=Util.parseBackgroundImage(content)[0].args[0]:elps.innerHTML=content,elps}}function indexedProperty(property){return isNaN(window.parseInt(property,10))}function injectPseudoElements(el,stack){var before=getPseudoElement(el,":before"),after=getPseudoElement(el,":after");(before||after)&&(before&&(el.className+=" "+pseudoHide+"-before",el.parentNode.insertBefore(before,el),parseElement(before,stack,!0),el.parentNode.removeChild(before),el.className=el.className.replace(pseudoHide+"-before","").trim()),after&&(el.className+=" "+pseudoHide+"-after",el.appendChild(after),parseElement(after,stack,!0),el.removeChild(after),el.className=el.className.replace(pseudoHide+"-after","").trim()))}function renderBackgroundRepeat(ctx,image,backgroundPosition,bounds){var offsetX=Math.round(bounds.left+backgroundPosition.left),offsetY=Math.round(bounds.top+backgroundPosition.top);ctx.createPattern(image),ctx.translate(offsetX,offsetY),ctx.fill(),ctx.translate(-offsetX,-offsetY)}function backgroundRepeatShape(ctx,image,backgroundPosition,bounds,left,top,width,height){var args=[];args.push(["line",Math.round(left),Math.round(top)]),args.push(["line",Math.round(left+width),Math.round(top)]),args.push(["line",Math.round(left+width),Math.round(height+top)]),args.push(["line",Math.round(left),Math.round(height+top)]),createShape(ctx,args),ctx.save(),ctx.clip(),renderBackgroundRepeat(ctx,image,backgroundPosition,bounds),ctx.restore()}function renderBackgroundColor(ctx,backgroundBounds,bgcolor){renderRect(ctx,backgroundBounds.left,backgroundBounds.top,backgroundBounds.width,backgroundBounds.height,bgcolor)}function renderBackgroundRepeating(el,bounds,ctx,image,imageIndex){var backgroundSize=Util.BackgroundSize(el,bounds,image,imageIndex),backgroundPosition=Util.BackgroundPosition(el,bounds,image,imageIndex,backgroundSize),backgroundRepeat=getCSS(el,"backgroundRepeat").split(",").map(Util.trimText);switch(image=resizeImage(image,backgroundSize),backgroundRepeat=backgroundRepeat[imageIndex]||backgroundRepeat[0]){case"repeat-x":backgroundRepeatShape(ctx,image,backgroundPosition,bounds,bounds.left,bounds.top+backgroundPosition.top,99999,image.height);break;case"repeat-y":backgroundRepeatShape(ctx,image,backgroundPosition,bounds,bounds.left+backgroundPosition.left,bounds.top,image.width,99999);break;case"no-repeat":backgroundRepeatShape(ctx,image,backgroundPosition,bounds,bounds.left+backgroundPosition.left,bounds.top+backgroundPosition.top,image.width,image.height);break;default:renderBackgroundRepeat(ctx,image,backgroundPosition,{top:bounds.top,left:bounds.left,width:image.width,height:image.height})}}function renderBackgroundImage(element,bounds,ctx){for(var image,backgroundImage=getCSS(element,"backgroundImage"),backgroundImages=Util.parseBackgroundImage(backgroundImage),imageIndex=backgroundImages.length;imageIndex--;)if(backgroundImage=backgroundImages[imageIndex],backgroundImage.args&&0!==backgroundImage.args.length){var key="url"===backgroundImage.method?backgroundImage.args[0]:backgroundImage.value;image=loadImage(key),image?renderBackgroundRepeating(element,bounds,ctx,image,imageIndex):Util.log("html2canvas: Error loading background:",backgroundImage)}}function resizeImage(image,bounds){if(image.width===bounds.width&&image.height===bounds.height)return image;var ctx,canvas=doc.createElement("canvas");return canvas.width=bounds.width,canvas.height=bounds.height,ctx=canvas.getContext("2d"),drawImage(ctx,image,0,0,image.width,image.height,0,0,bounds.width,bounds.height),canvas}function setOpacity(ctx,element,parentStack){return ctx.setVariable("globalAlpha",getCSS(element,"opacity")*(parentStack?parentStack.opacity:1))}function removePx(str){return str.replace("px","")}function getTransform(element){var transform=getCSS(element,"transform")||getCSS(element,"-webkit-transform")||getCSS(element,"-moz-transform")||getCSS(element,"-ms-transform")||getCSS(element,"-o-transform"),transformOrigin=getCSS(element,"transform-origin")||getCSS(element,"-webkit-transform-origin")||getCSS(element,"-moz-transform-origin")||getCSS(element,"-ms-transform-origin")||getCSS(element,"-o-transform-origin")||"0px 0px";transformOrigin=transformOrigin.split(" ").map(removePx).map(Util.asFloat);var matrix;if(transform&&"none"!==transform){var match=transform.match(transformRegExp);if(match)switch(match[1]){case"matrix":matrix=match[2].split(",").map(Util.trimText).map(Util.asFloat)}}return{origin:transformOrigin,matrix:matrix}}function createStack(element,parentStack,bounds,transform){var ctx=h2cRenderContext(parentStack?bounds.width:documentWidth(),parentStack?bounds.height:documentHeight()),stack={ctx:ctx,opacity:setOpacity(ctx,element,parentStack),cssPosition:getCSS(element,"position"),borders:getBorderData(element),transform:transform,clip:parentStack&&parentStack.clip?Util.Extend({},parentStack.clip):null};return setZ(element,stack,parentStack),options.useOverflow===!0&&/(hidden|scroll|auto)/.test(getCSS(element,"overflow"))===!0&&/(BODY)/i.test(element.nodeName)===!1&&(stack.clip=stack.clip?clipBounds(stack.clip,bounds):bounds),stack}function getBackgroundBounds(borders,bounds,clip){var backgroundBounds={left:bounds.left+borders[3].width,top:bounds.top+borders[0].width,width:bounds.width-(borders[1].width+borders[3].width),height:bounds.height-(borders[0].width+borders[2].width)};return clip&&(backgroundBounds=clipBounds(backgroundBounds,clip)),backgroundBounds}function getBounds(element,transform){var bounds=transform.matrix?Util.OffsetBounds(element):Util.Bounds(element);return transform.origin[0]+=bounds.left,transform.origin[1]+=bounds.top,bounds}function renderElement(element,parentStack,pseudoElement,ignoreBackground){var image,transform=getTransform(element,parentStack),bounds=getBounds(element,transform),stack=createStack(element,parentStack,bounds,transform),borders=stack.borders,ctx=stack.ctx,backgroundBounds=getBackgroundBounds(borders,bounds,stack.clip),borderData=parseBorders(element,bounds,borders),backgroundColor=ignoreElementsRegExp.test(element.nodeName)?"#efefef":getCSS(element,"backgroundColor");switch(createShape(ctx,borderData.clip),ctx.save(),ctx.clip(),backgroundBounds.height>0&&backgroundBounds.width>0&&!ignoreBackground?(renderBackgroundColor(ctx,bounds,backgroundColor),renderBackgroundImage(element,backgroundBounds,ctx)):ignoreBackground&&(stack.backgroundColor=backgroundColor),ctx.restore(),borderData.borders.forEach(function(border){renderBorders(ctx,border.args,border.color)}),pseudoElement||injectPseudoElements(element,stack),element.nodeName){case"IMG":(image=loadImage(element.getAttribute("src")))?renderImage(ctx,element,image,bounds,borders):Util.log("html2canvas: Error loading <img>:"+element.getAttribute("src"));break;case"INPUT":/^(text|url|email|submit|button|reset|checkbox|radio)$/.test(element.type)&&(element.value||element.placeholder||"").length>0&&renderFormValue(element,bounds,stack);break;case"TEXTAREA":(element.value||element.placeholder||"").length>0&&renderFormValue(element,bounds,stack);break;case"SELECT":(element.options||element.placeholder||"").length>0&&renderFormValue(element,bounds,stack);break;case"OPTION":renderFormValue(element,bounds,stack);case"LI":renderListItem(element,stack,backgroundBounds);break;case"CANVAS":renderImage(ctx,element,element,bounds,borders)}return stack}function isElementVisible(element){return"none"!==getCSS(element,"display")&&"hidden"!==getCSS(element,"visibility")&&!element.hasAttribute("data-html2canvas-ignore")}function parseElement(element,stack,pseudoElement,isParentFixed){if(isElementVisible(element)){var isInViewPort,isFixedEle;isParentFixed?isInViewPort=!0:(isFixedEle="fixed"===getCSS(element,"position")?!0:!1,isInViewPort=isFixedEle||_html2canvas.Util.isElementInViewport(element,options,0,0)),_html2canvas.Util.isFixedEle=isFixedEle||isParentFixed?!0:!1,isInViewPort&&(stack=renderElement(element,stack,pseudoElement,!1)||stack,ignoreElementsRegExp.test(element.nodeName)||parseChildren(element,stack,pseudoElement,_html2canvas.Util.isFixedEle))}}function parseChildren(element,stack,pseudoElement,isParentFixed){Util.Children(element).forEach(function(node){node.nodeType===node.ELEMENT_NODE?parseElement(node,stack,pseudoElement,isParentFixed):node.nodeType===node.TEXT_NODE&&renderText(element,node,stack)})}function init(){var background=getCSS(document.documentElement,"backgroundColor"),transparentBackground=Util.isTransparent(background)&&element===document.body,stack=renderElement(element,null,!1,transparentBackground);return parseChildren(element,stack),transparentBackground&&(background=stack.backgroundColor),body.removeChild(hidePseudoElements),{backgroundColor:background,stack:stack}}window.scroll(0,0);var element=options.elements===undefined?document.body:options.elements[0],numDraws=0,doc=element.ownerDocument,Util=_html2canvas.Util,support=Util.Support(options,doc),ignoreElementsRegExp=new RegExp("("+options.ignoreElements+")"),body=doc.body,getCSS=Util.getCSS,pseudoHide="___html2canvas___pseudoelement",hidePseudoElements=doc.createElement("style");hidePseudoElements.innerHTML="."+pseudoHide+'-before:before { content: "" !important; display: none !important; }.'+pseudoHide+'-after:after { content: "" !important; display: none !important; }',body.appendChild(hidePseudoElements),images=images||{};var getCurvePoints=function(kappa){return function(x,y,r1,r2){var ox=r1*kappa,oy=r2*kappa,xm=x+r1,ym=y+r2;return{topLeft:bezierCurve({x:x,y:ym},{x:x,y:ym-oy},{x:xm-ox,y:y},{x:xm,y:y}),topRight:bezierCurve({x:x,y:y},{x:x+ox,y:y},{x:xm,y:ym-oy},{x:xm,y:ym}),bottomRight:bezierCurve({x:xm,y:y},{x:xm,y:y+oy},{x:x+ox,y:ym},{x:x,y:ym}),bottomLeft:bezierCurve({x:xm,y:ym},{x:xm-ox,y:ym},{x:x,y:y+oy},{x:x,y:y})}}}(4*((Math.sqrt(2)-1)/3)),transformRegExp=/(matrix)\((.+)\)/;return init()},_html2canvas.Preload=function(options){function isSameOrigin(url){link.href=url,link.href=link.href;var origin=link.protocol+link.host;return origin===pageOrigin}function start(){Util.log("html2canvas: start: images: "+images.numLoaded+" / "+images.numTotal+" (failed: "+images.numFailed+")"),images.firstRun||images.numLoaded!==images.numTotal||(Util.log("Finished loading images: # "+images.numTotal+" (failed: "+images.numFailed+")"),"function"==typeof options.complete&&options.complete(images))}function proxyGetImage(url,img,imageObj){var callback_name,script,scriptUrl=options.proxy;link.href=url,url=link.href;var arr=url.split("/");"http:"===arr[0]||"https:"===arr[0]?(callback_name="html2canvas_"+count++,imageObj.callbackname=callback_name,scriptUrl+=scriptUrl.indexOf("?")>-1?"&":"?",scriptUrl+="url="+encodeURIComponent(url)+"&callback="+callback_name,script=doc.createElement("script"),window[callback_name]=function(a){"error:"===a.substring(0,6)?(imageObj.succeeded=!1,images.numLoaded++,images.numFailed++,start()):(setImageLoadHandlers(img,imageObj),img.src=a),window[callback_name]=undefined;try{delete window[callback_name]}catch(ex){}script.parentNode.removeChild(script),script=null,delete imageObj.script,delete imageObj.callbackname},script.setAttribute("type","text/javascript"),script.setAttribute("src",scriptUrl),imageObj.script=script,window.document.body.appendChild(script)):(imageObj.succeeded=!1,images.numLoaded++,images.numFailed++,start())}function loadPseudoElement(element,type){var style=window.getComputedStyle(element,type),content=style.content;"url"===content.substr(0,3)&&methods.loadImage(_html2canvas.Util.parseBackgroundImage(content)[0].args[0]),loadBackgroundImages(style.backgroundImage,element)}function loadPseudoElementImages(element){loadPseudoElement(element,":before"),loadPseudoElement(element,":after")}function loadGradientImage(backgroundImage,bounds){var img=_html2canvas.Generate.Gradient(backgroundImage,bounds);img!==undefined&&(images[backgroundImage]={img:img,succeeded:!0},images.numTotal++,images.numLoaded++,start())}function invalidBackgrounds(background_image){return background_image&&background_image.method&&background_image.args&&background_image.args.length>0}function loadBackgroundImages(background_image,el){var bounds;_html2canvas.Util.parseBackgroundImage(background_image).filter(invalidBackgrounds).forEach(function(background_image){"url"===background_image.method?methods.loadImage(background_image.args[0]):background_image.method.match(/\-?gradient$/)&&(bounds===undefined&&(bounds=_html2canvas.Util.Bounds(el)),loadGradientImage(background_image.value,bounds))})}function getImages(el){var elNodeType=!1;try{Util.Children(el).forEach(getImages)}catch(e){}try{elNodeType=el.nodeType}catch(ex){elNodeType=!1,Util.log("html2canvas: failed to access some element's nodeType - Exception: "+ex.message)}if((1===elNodeType||elNodeType===undefined)&&_html2canvas.Util.isElementInViewport(el,options,window.zCurrentScrollTop,window.zCurrentScrollLeft)){loadPseudoElementImages(el);try{loadBackgroundImages(Util.getCSS(el,"backgroundImage"),el)}catch(e){Util.log("html2canvas: failed to get background-image - Exception: "+e.message)}loadBackgroundImages(el)}}function setImageLoadHandlers(img,imageObj){img.onload=function(){imageObj.timer!==undefined&&window.clearTimeout(imageObj.timer),images.numLoaded++,imageObj.succeeded=!0,img.onerror=img.onload=null,start()},img.onerror=function(){if("anonymous"===img.crossOrigin&&(window.clearTimeout(imageObj.timer),options.proxy)){var src=img.src;return img=new Image,imageObj.img=img,img.src=src,void proxyGetImage(img.src,img,imageObj)}images.numLoaded++,images.numFailed++,imageObj.succeeded=!1,img.onerror=img.onload=null,start()}}window.zCurrentScrollTop=document.body.scrollTop||document.documentElement.scrollTop,window.zCurrentScrollLeft=document.body.scrollLeft||document.documentElement.scrollLeft;for(var pageOrigin,methods,i,timeoutTimer,images={numLoaded:0,numFailed:0,numTotal:0,cleanupDone:!1},Util=_html2canvas.Util,count=0,element=options.elements[0]||document.body,doc=element.ownerDocument,domImages1=element.getElementsByTagName("img"),imgLen1=domImages1.length,link=doc.createElement("a"),supportCORS=function(img){return img.crossOrigin!==undefined}(new Image),domImages=new Array,imagesURL=new Array,i=0;imgLen1>i;i++)_html2canvas.Util.isElementInViewport(domImages1[i],options,window.zCurrentScrollTop,window.zCurrentScrollLeft)&&-1===imagesURL.indexOf(domImages1[i].src)&&(imagesURL.push(domImages1[i].src),domImages.push(domImages1[i]));var imgLen=domImages.length;for(link.href=window.location.href,pageOrigin=link.protocol+link.host,methods={loadImage:function(src){var img,imageObj;src&&images[src]===undefined&&(img=new Image,src.match(/data:image\/.*;base64,/i)?(img.src=src.replace(/url\(['"]{0,}|['"]{0,}\)$/gi,""),imageObj=images[src]={img:img},images.numTotal++,setImageLoadHandlers(img,imageObj)):isSameOrigin(src)||options.allowTaint===!0?(imageObj=images[src]={img:img},images.numTotal++,setImageLoadHandlers(img,imageObj),img.src=src):supportCORS&&!options.allowTaint&&options.useCORS?(img.crossOrigin="anonymous",imageObj=images[src]={img:img},images.numTotal++,setImageLoadHandlers(img,imageObj),img.src=src):options.proxy&&(imageObj=images[src]={img:img},images.numTotal++,proxyGetImage(src,img,imageObj)))},cleanupDOM:function(cause){var img,src;if(!images.cleanupDone){Util.log(cause&&"string"==typeof cause?"html2canvas: Cleanup because: "+cause:"html2canvas: Cleanup after timeout: "+options.timeout+" ms.");for(src in images)if(images.hasOwnProperty(src)&&(img=images[src],"object"==typeof img&&img.callbackname&&img.succeeded===undefined)){window[img.callbackname]=undefined;try{delete window[img.callbackname]}catch(ex){}img.script&&img.script.parentNode&&(img.script.setAttribute("src","about:blank"),img.script.parentNode.removeChild(img.script)),images.numLoaded++,images.numFailed++,Util.log("html2canvas: Cleaned up failed img: '"+src+"' Steps: "+images.numLoaded+" / "+images.numTotal)}window.stop!==undefined?window.stop():document.execCommand!==undefined&&document.execCommand("Stop",!1),document.close!==undefined&&document.close(),images.cleanupDone=!0,cause&&"string"==typeof cause||start()}},renderingDone:function(){timeoutTimer&&window.clearTimeout(timeoutTimer)}},options.timeout>0&&(timeoutTimer=window.setTimeout(methods.cleanupDOM,options.timeout)),Util.log("html2canvas: Preload starts: finding background-images"),images.firstRun=!0,getImages(element),Util.log("html2canvas: Preload: Finding images"),i=0;imgLen>i;i+=1)methods.loadImage(domImages[i].getAttribute("src"));return images.firstRun=!1,Util.log("html2canvas: Preload: Done."),images.numTotal===images.numLoaded&&start(),methods},_html2canvas.Renderer=function(parseQueue,options){function createRenderQueue(parseQueue){function sortZ(context){Object.keys(context).sort().forEach(function(zi){var nonPositioned=[],floated=[],positioned=[],list=[];context[zi].forEach(function(v){v.node.zIndex.isPositioned||v.node.zIndex.opacity<1?positioned.push(v):v.node.zIndex.isFloated?floated.push(v):nonPositioned.push(v)}),function walk(arr){arr.forEach(function(v){list.push(v),v.children&&walk(v.children)})}(nonPositioned.concat(floated,positioned)),list.forEach(function(v){v.context?sortZ(v.context):queue.push(v.node)})})}var rootContext,queue=[];return rootContext=function(rootNode){function insert(context,node,specialParent){var zi="auto"===node.zIndex.zindex?0:Number(node.zIndex.zindex),contextForChildren=context,isPositioned=node.zIndex.isPositioned,isFloated=node.zIndex.isFloated,stub={node:node},childrenDest=specialParent;node.zIndex.ownStacking?(contextForChildren=stub.context={"!":[{node:node,children:[]}]},childrenDest=undefined):(isPositioned||isFloated)&&(childrenDest=stub.children=[]),0===zi&&specialParent?specialParent.push(stub):(context[zi]||(context[zi]=[]),context[zi].push(stub)),node.zIndex.children.forEach(function(childNode){insert(contextForChildren,childNode,childrenDest)})}var rootContext={};return insert(rootContext,rootNode),rootContext}(parseQueue),sortZ(rootContext),queue}function getRenderer(rendererName){var renderer;if("string"==typeof options.renderer&&_html2canvas.Renderer[rendererName]!==undefined)renderer=_html2canvas.Renderer[rendererName](options);else{if("function"!=typeof rendererName)throw new Error("Unknown renderer");renderer=rendererName(options)}if("function"!=typeof renderer)throw new Error("Invalid renderer defined");return renderer}return getRenderer(options.renderer)(parseQueue,options,document,createRenderQueue(parseQueue.stack),_html2canvas)},_html2canvas.Util.Support=function(options,doc){function supportSVGRendering(){var img=new Image,canvas=doc.createElement("canvas"),ctx=canvas.getContext===undefined?!1:canvas.getContext("2d");if(ctx===!1)return!1;canvas.width=canvas.height=10,img.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'>","<foreignObject width='10' height='10'>","<div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>","sup","</div>","</foreignObject>","</svg>"].join("");try{ctx.drawImage(img,0,0),canvas.toDataURL()}catch(e){return!1}return _html2canvas.Util.log("html2canvas: Parse: SVG powered rendering available"),!0}function supportRangeBounds(){var r,testElement,rangeBounds,rangeHeight,support=!1;return doc.createRange&&(r=doc.createRange(),r.getBoundingClientRect&&(testElement=doc.createElement("boundtest"),testElement.style.height="123px",testElement.style.display="block",doc.body.appendChild(testElement),r.selectNode(testElement),rangeBounds=r.getBoundingClientRect(),rangeHeight=rangeBounds.height,123===rangeHeight&&(support=!0),doc.body.removeChild(testElement))),support}return{rangeBounds:supportRangeBounds(),svgRendering:options.svgRendering&&supportSVGRendering()}},_html2canvas.Util.isElementInViewport=function(element,options,currentScrollTop,currentScrollLeft){if(options.grabArea===undefined)return!0;var eleOffsetTop=element.getBoundingClientRect().top,eleOffsetLeft=element.getBoundingClientRect().left;return currentScrollTop&&(eleOffsetTop+=currentScrollTop),currentScrollLeft&&(eleOffsetLeft+=currentScrollLeft),null===element.offsetParent?!1:(eleOffsetTop>=options.grabArea.top&&eleOffsetTop<=options.grabArea.top+options.grabArea.height||eleOffsetTop<=options.grabArea.top&&eleOffsetTop+element.offsetHeight>=options.grabArea.top||!element.offsetHeight)&&(eleOffsetLeft>=options.grabArea.left&&eleOffsetLeft<=options.grabArea.left+options.grabArea.width||eleOffsetLeft<=options.grabArea.left&&eleOffsetLeft+element.offsetWidth>=options.grabArea.left||!element.offsetWidth)?!0:!1},window.html2canvas=function(elements,opts){elements=elements.length?elements:[elements];var queue,canvas,options={logging:!1,elements:elements,background:"#fff",proxy:null,timeout:0,useCORS:!1,allowTaint:!1,svgRendering:!1,ignoreElements:"IFRAME|OBJECT|PARAM",useOverflow:!0,letterRendering:!1,chinese:!1,width:null,height:null,taintTest:!0,renderer:"Canvas",grabArea:undefined};return options=_html2canvas.Util.Extend(opts,options),_html2canvas.logging=options.logging,options.complete=function(images){("function"!=typeof options.onpreloaded||options.onpreloaded(images)!==!1)&&(queue=_html2canvas.Parse(images,options),("function"!=typeof options.onparsed||options.onparsed(queue)!==!1)&&(canvas=_html2canvas.Renderer(queue,options),"function"==typeof options.onrendered&&options.onrendered(canvas)))},window.setTimeout(function(){_html2canvas.Preload(options)},0),{render:function(queue,opts){return _html2canvas.Renderer(queue,_html2canvas.Util.Extend(opts,options))},parse:function(images,opts){return _html2canvas.Parse(images,_html2canvas.Util.Extend(opts,options))},preload:function(opts){return _html2canvas.Preload(_html2canvas.Util.Extend(opts,options))},log:_html2canvas.Util.log}},window.html2canvas.log=_html2canvas.Util.log,window.html2canvas.Renderer={Canvas:undefined},_html2canvas.Renderer.Canvas=function(options){function createShape(ctx,args){ctx.beginPath(),args.forEach(function(arg){ctx[arg.name].apply(ctx,arg.arguments)}),ctx.closePath()}function safeImage(item){if(-1===safeImages.indexOf(item.arguments[0].src)){testctx.drawImage(item.arguments[0],0,0);try{testctx.getImageData(0,0,1,1)}catch(e){return testCanvas=doc.createElement("canvas"),testctx=testCanvas.getContext("2d"),!1}safeImages.push(item.arguments[0].src)}return!0}function renderItem(ctx,item){switch(item.type){case"variable":ctx[item.name]=item.arguments;break;case"function":switch(item.name){case"createPattern":if(item.arguments[0].width>0&&item.arguments[0].height>0)try{ctx.fillStyle=ctx.createPattern(item.arguments[0],"repeat")}catch(e){Util.log("html2canvas: Renderer: Error creating pattern",e.message)}break;case"drawShape":createShape(ctx,item.arguments);break;case"drawImage":item.arguments[8]>0&&item.arguments[7]>0&&(!options.taintTest||options.taintTest&&safeImage(item))&&ctx.drawImage.apply(ctx,item.arguments);break;default:ctx[item.name].apply(ctx,item.arguments)}}}options=options||{};var doc=document,safeImages=[],testCanvas=document.createElement("canvas"),testctx=testCanvas.getContext("2d"),Util=_html2canvas.Util,canvas=options.canvas||doc.createElement("canvas");return function(parsedData,options,document,queue,_html2canvas){var newCanvas,bounds,fstyle,ctx=canvas.getContext("2d"),zStack=parsedData.stack;return canvas.width=canvas.style.width=options.width||zStack.ctx.width,canvas.height=canvas.style.height=options.height||zStack.ctx.height,fstyle=ctx.fillStyle,ctx.fillStyle=Util.isTransparent(zStack.backgroundColor)&&options.background!==undefined?options.background:parsedData.backgroundColor,ctx.fillRect(0,0,canvas.width,canvas.height),ctx.fillStyle=fstyle,queue.forEach(function(storageContext){ctx.textBaseline="bottom",ctx.save(),storageContext.transform.matrix&&(ctx.translate(storageContext.transform.origin[0],storageContext.transform.origin[1]),ctx.transform.apply(ctx,storageContext.transform.matrix),ctx.translate(-storageContext.transform.origin[0],-storageContext.transform.origin[1])),storageContext.clip&&(ctx.beginPath(),ctx.rect(storageContext.clip.left,storageContext.clip.top,storageContext.clip.width,storageContext.clip.height),ctx.clip()),storageContext.ctx.storage&&storageContext.ctx.storage.forEach(function(item){renderItem(ctx,item)}),ctx.restore()}),Util.log("html2canvas: Renderer: Canvas renderer done - returning canvas obj"),1===options.elements.length&&"object"==typeof options.elements[0]&&"BODY"!==options.elements[0].nodeName?(bounds=_html2canvas.Util.Bounds(options.elements[0]),newCanvas=document.createElement("canvas"),newCanvas.width=Math.ceil(bounds.width),newCanvas.height=Math.ceil(bounds.height),ctx=newCanvas.getContext("2d"),ctx.drawImage(canvas,bounds.left,bounds.top,bounds.width,bounds.height,0,0,bounds.width,bounds.height),canvas=null,newCanvas):canvas}}}(window,document);