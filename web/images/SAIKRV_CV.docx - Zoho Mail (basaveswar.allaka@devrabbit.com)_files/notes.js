"use strict";window.znBox=function(){var a;return a={storeId:"",savedSelection:{},savedSel:[],isPaste:!1,getSummary:function(a){var b=a.slice(0,255),c=b.lastIndexOf("<"),d=b.lastIndexOf(">");return d<c&&(b=a.slice(0,c)),b},spCharRep:function(a){return a?a=a.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&#39;/g,"'").replace(/&amp;/g,"&"):""},revSpCharRep:function(a){return a?a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/'/g,"&#39;"):""},saveSelection:function(a){znBox.storeNode=a;var b=window.getSelection(),c=[];if(b.rangeCount)for(var d=0,e=b.rangeCount;d<e;++d)c.push(b.getRangeAt(d));return c},restoreSelection:function(a){if(znBox.storeNode&&znBox.savedSel.length&&(znBox.storeNode[0]===a[0]||znBox.storeNode[0].isSameNode&&znBox.storeNode[0].isSameNode(a[0]))){var b=window.getSelection();b.removeAllRanges();for(var c=0,d=znBox.savedSel.length;c<d;++c)b.addRange(znBox.savedSel[c]);return!0}return!1},saveSelectionNew:function(a){var b=window.getSelection();if(b.rangeCount){var c=window.getSelection().getRangeAt(0),d=c.cloneRange();d.selectNodeContents(a),d.setEnd(c.startContainer,c.startOffset);var e=d.toString().length;return{start:e,end:e+c.toString().length}}return{start:0,end:0}},restoreSelectionNew:function(a,b){if(b){var c=0,d=document.createRange();d.setStart(a,0),d.collapse(!0);for(var e,f=[a],g=!1,h=!1;!h&&(e=f.pop());)if(3===e.nodeType){var i=c+e.length;!g&&b.start>=c&&b.start<=i&&(d.setStart(e,b.start-c),g=!0),g&&b.end>=c&&b.end<=i&&(d.setEnd(e,b.end-c),h=!0),c=i}else for(var j=e.childNodes.length;j--;)f.push(e.childNodes[j]);var k=window.getSelection();return k.removeAllRanges(),k.addRange(d),!0}return!1},insertHtmlAtCaret:function(a){var b,c;if(window.getSelection&&(b=window.getSelection(),b.getRangeAt&&b.rangeCount)){c=b.getRangeAt(0),c.deleteContents();var d=document.createElement("div");d.innerHTML=a;for(var e,f,g=document.createDocumentFragment();e=d.firstChild;)f=g.appendChild(e);c.insertNode(g),f&&(c=c.cloneRange(),c.setStartAfter(f),c.collapse(!0),b.removeAllRanges(),b.addRange(c))}},isIE:function(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");return!!(b>0||Boolean(navigator.userAgent.match(/Trident.*rv:11\./)))},getLabelArray:function(a){var b=[],c=zmUtil.getTagList("default");for(var d in c)if(a.indexOf(d)===-1){var e={};e.id=c[d].id,e.name=c[d].dispName,e.hashname="#"+c[d].dispName,b.push(e)}return b},handlePaste:function(a,b,c){znBox.savedSel=znBox.saveSelection(a),$("body").append("<div id='d1' contenteditable=true style=left:-500px;word-wrap:break-word;max-height:300px;max-width:300px;overflow:hidden;position:relative></div>"),$("#d1").focus();var d;setTimeout(function(){d=znBox.getContentEditableText($(document.getElementById("d1"))),$("#d1").remove(),d=d.replace(/\n/g,"<br>");var e=znBox.pasteSanitize(d);c&&(e=e.replace(/<br>/g," ").slice(0,c)),$(a).trigger("focus",!0),znBox.restoreSelection(a),znBox.isIE()?znBox.insertHtmlAtCaret(e):document.execCommand("insertHTML",!1,e),b&&znNote.setTopLeft(znNote.getCurNoteParam(b)),znBox.savedSel=znBox.saveSelection(a)},100)},handleFileInputOnChange:function(a){var b=$.Deferred(),c=[],d={};try{c.push({name:"accId",value:zmail.accId},{name:"zmrcsr",value:zmAjq.getCookie("zmcsr")},{name:"fileName",value:"inline.png"},{name:"type",value:"f"},{name:"tSize",value:0},{name:"attach",value:a}),zmail.fileUploader.flags.isAjaxable||c.push({name:"browser",value:"ie9"}),d.payloads=c,d.url=zmail.conPath+"/attach.do?mode=temp",zmail.fileUploader.upload(d).progress(function(a,b){window.console.info("total: "+a+"  ,loaded: "+b)}).done(function(a){var c=$.parseJSON(a);b.resolve(c)}).fail(function(){})}catch(e){return}return b.promise()},getBlobFromImageUrl:function(a){var b=$.Deferred(),c=new XMLHttpRequest;return c.onreadystatechange=function(){4===this.readyState&&200===this.status&&b.resolve(this.response)},c.open("GET",a),c.responseType="blob",c.send(),b.promise()},convertImageToInlineImages:function(a){var b=znBox.InlineImageSanitize(a),c=[],d=$.Deferred(),e=$("<div>").html(b);return e.find("img").each(function(){var a=this,b=$.Deferred();znBox.getBlobFromImageUrl(this.src).done(function(c){znBox.handleFileInputOnChange(c).done(function(c){a.src=zmail.conPath+"/FileDownload/"+zmUtil.getDummyFilename(c.name)+"?mode=tmpview&entityType=1&accId="+zmail.accId+"&fpath="+c.fP+"&fstorename="+c.sN,b.resolve()})}),c.push(b)}),$.when.apply($,c).then(function(){var a=znBox.domParser(znBox.getContentEditableText(e));d.resolve(a)}),d.promise()},InlineImageSanitize:function(a){try{var b=a,c=$("<div>").html(b),d="";return $.each($(c),function(a,b){for(var c=znBox.walkDom(b),e=0;e<c.length;e++)if(3===c[e].nodeType)c[e].nodeValue=c[e].nodeValue.replace(/&/g,"&amp;"),c[e].nodeValue=c[e].nodeValue.replace(/</g,"&lt;"),c[e].nodeValue=c[e].nodeValue.replace(/>/g,"&gt;"),d+=c[e].nodeValue;else if(1!==c[e].nodeType||"BR"!==c[e].nodeName&&"TR"!==c[e].nodeName&&"P"!==c[e].nodeName){if(1===c[e].nodeType&&"TD"===c[e].nodeName)d+="&nbsp;";else if(1===c[e].nodeType&&"IMG"===c[e].nodeName){var f=c[e].getAttribute("src");/\/ImageDisplay\?na=[0-9]+&nmsgId=[0-9]+&f=[0-9a-zA-Z]+.[a-z]+&mode=inline&/.test(f)&&(d+="<img src="+f+"></img>")}}else d+="<br>"}),d}catch(e){}},pasteSanitize:function(a,b){try{var c=a,d=$("<div>").html(c),e="";return $.each($(d),function(a,c){for(var d=znBox.walkDomPaste(c),f=0;f<d.length;f++)if(3===d[f].nodeType)d[f].nodeValue=d[f].nodeValue.replace(/&/g,"&amp;"),d[f].nodeValue=d[f].nodeValue.replace(/</g,"&lt;"),d[f].nodeValue=d[f].nodeValue.replace(/>/g,"&gt;"),e+=d[f].nodeValue;else if(1!==d[f].nodeType||"BR"!==d[f].nodeName&&"TR"!==d[f].nodeName&&"P"!==d[f].nodeName){if(1===d[f].nodeType&&"TD"===d[f].nodeName)e+="&nbsp;";else if(1===d[f].nodeType&&"IMG"===d[f].nodeName&&!b){var g=d[f].getAttribute("src");e+="<img src="+g+"></img>"}}else e+="<br>"}),e}catch(f){}},walkDomPaste:function(a){var b=[],c=function(a){do 3!==a.nodeType&&(1!==a.nodeType||"BR"!==a.nodeName&&"DIV"!==a.nodeName&&"TR"!==a.nodeName&&"TD"!==a.nodeName&&"P"!==a.nodeName)||b.push(a),a.hasChildNodes()&&c(a.firstChild),a=a.nextSibling;while(a)};return c(a),b},walkDom:function(a){var b=[],c=function(a){do 3!==a.nodeType&&(1!==a.nodeType||"BR"!==a.nodeName&&"IMG"!==a.nodeName)||b.push(a),a.hasChildNodes()&&c(a.firstChild),a=a.nextSibling;while(a)};return c(a),b},domParserforImgReplace:function(a){try{var b=a,c=$("<div>").html(b),d="";return $.each($(c),function(a,b){for(var c=znBox.walkDom(b),e=0;e<c.length;e++)3===c[e].nodeType?(c[e].nodeValue=c[e].nodeValue.replace(/&/g,"&amp;"),c[e].nodeValue=c[e].nodeValue.replace(/</g,"&lt;"),c[e].nodeValue=c[e].nodeValue.replace(/>/g,"&gt;"),d+=c[e].nodeValue):1===c[e].nodeType&&"BR"===c[e].nodeName&&(d+="<br/>")}),d}catch(e){}},domParser:function(a){try{var b=a,c=$("<div>").html(b),d="";return $.each($(c),function(a,b){for(var c=znBox.walkDom(b),e=0;e<c.length;e++)if(3===c[e].nodeType)c[e].nodeValue=c[e].nodeValue.replace(/&/g,"&amp;"),c[e].nodeValue=c[e].nodeValue.replace(/</g,"&lt;"),c[e].nodeValue=c[e].nodeValue.replace(/>/g,"&gt;"),d+=c[e].nodeValue;else if(1===c[e].nodeType&&"BR"===c[e].nodeName)d+="\n";else if(1===c[e].nodeType&&"IMG"===c[e].nodeName){var f=c[e].getAttribute("id"),g=c[e].getAttribute("src");d+=f?"<img id='"+f+"' src='"+g+"'></img>":'<img src="'+g+'" ></img>'}}),d}catch(e){}},getContentEditableText:function(a){var b=$("<pre />").html(a.html());return $.browser.webkit&&(b.html(b.html().replace(/<div><br><\/div>/g,"<br>")),b.find("div").replaceWith(function(){return"<br>"+this.innerHTML}),b.html(b.html().replace(/<br>$/,""))),$.browser.msie&&b.find("p").replaceWith(function(){return this.innerHTML+"<br>"}),($.browser.webkit||$.browser.mozilla||$.browser.opera||$.browser.msie)&&b.find("br").replaceWith("\n"),b.html()},getContentEditableTextFromHTML:function(a){var b=$("<pre />").html(a);return $.browser.webkit&&(b.html(b.html().replace(/<div><br><\/div>/g,"<br>")),b.find("div").replaceWith(function(){return"<br>"+this.innerHTML}),b.html(b.html().replace(/<br>$/,""))),$.browser.msie&&b.find("p").replaceWith(function(){return this.innerHTML+"<br>"}),($.browser.webkit||$.browser.mozilla||$.browser.opera||$.browser.msie)&&b.find("br").replaceWith("\n"),b.html()},getConstantsValues:function(a,b){return"color"===b?zNote.CONSTANTS.COLORNAME[a]:""},getTextContentFromHTML:function(a){var b=a?a:"";b=b.replace(/\n/g,"<br>");var c=znBox.pasteSanitize(b).replace(/<br>/g,"\n");return c},getNoteListForGivenIds:function(a){var b={entityIds:a.id,groupIds:a.groupId,mode:"getNotes"};return zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",p:b})},CONTS:{ntWid:300,ntBorPad:57,defaultTitle:"Title",nColClsArr:{zn_clr1:"0",zn_clr2:"1",zn_clr3:"2",zn_clr4:"3"},nColArr:["zn_clr1","zn_clr2","zn_clr3","zn_clr4"]}}}(),window.znNote=function(){var a,b,c,d,e,f,g,h;h={appid:"zm_notes",appicon:"msi-notes",modulename:"notes"},g=zmText.get(h.modulename);var i={fav:g.fav,sharedtome:g.left.sharedtome};return a={updateCatCache:function(a,b,c){var d,e,f=znNote.catCacheObj[b],g=f.length;if("addCat"===a)f.push(c);else if("editCat"===a)for(d=0;d<g;d++)f[d].catId===c.catId&&(f[d].category=c.category);else if("delCat"===a){for(g=f.length,d=0;d<g;d++)if(f[d].catId===c.catId){e=d;break}f.splice(e,1)}}},b={getCat:function(){var a={mode:"getCategories",groupId:zmail.zuid,streamsView:"Notes",actionType:"appView"};return zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",p:a})},getGroupCat:function(){var a,b,c=$.Deferred();if(a=zmCont.getGroupOrder(),!a.length)return c.reject();b=a.join();var d={mode:"getGrpCategories",groupId:zmail.zuid,groupIds:b,streamsView:"Notes",actionType:"appView"};return zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",p:d})},switchView:function(){var a,c,d=znNote.noteListing.props.noteList;if(znNote.lstDetails().type===d.listInfo.mode&&znNote.lstDetails().fId===d.listInfo.id){var e=[{}];e[0].Notes=d.toJSON(),e[0].page=d.options.page;var f={mode:d.listInfo.mode,id:d.listInfo.id,groupId:d.listInfo.groupId};f.noteView=znNote.noteView,f.isnew=!0;var g=function(d){d&&(znNote.noteListing=d,znNote.noteListing.props.noteList.on("remove",function(){if(this.length<25){var d=this.options.page;if(d&&"1"===d.showNextPage){var e=znNote.lstDetails();a=e.fId,c=e.type;var f={start:d.end};b.getNotes(c,a,f)}}}))};znNote.noteListing&&ReactDOM.unmountComponentAtNode(znNote.noteListing.props.noteList.mountingElem[0]),zNote.listRowNotes(e,f,znNote.noteListing.props.noteList.mountingElem,g)}else b.getNotes(znNote.lstDetails().type,znNote.lstDetails().fId)},getNotesList:function(a,c,e){znNote.currNoteId="";var f,g={limit:"25"},h={},i=znNote.lstDetails().groupId;if(e)e.start&&(g.start=e.start,h.isnew=!1),f=function(a,b){d.scrolling=!1,d.destroyLoadingDiv(),d.containerDiv&&d.containerDiv.remove(),h.groupId=i,b.currentObj=znNote.noteListing,zNote.listRowNotes(a,b,document.getElementsByClassName("SC_mclst SC_notes"))};else{h.isnew=!0,h.groupId=i;var j=function(d){d&&(znNote.noteListing=d,znNote.noteListing.props.noteList.on("remove",function(){if(this.length<25){var d=this.options.page;if(d&&"1"===d.showNextPage){var e=znNote.lstDetails();c=e.fId,a=e.type;var f={start:d.end};b.getNotes(a,c,f)}}}))};znNote.previousListingAjax&&"pending"===znNote.previousListingAjax.state()&&znNote.previousListingAjax.abort(),znNote.noteListing&&ReactDOM.unmountComponentAtNode(znNote.noteListing.props.noteList.mountingElem[0]),d.destroyLoadingDiv=zmComponent.loadingBand({container:znNote.listingDiv[0],type:"listing"}),f=function(a,b){d.scrolling=!1,d.destroyLoadingDiv(),znNote.noteListing?zNote.listRowNotes(a,b,znNote.noteListing.props.noteList.mountingElem,j):zNote.listRowNotes(a,b,document.getElementsByClassName("SC_mclst SC_notes"),j)}}"c"===a?("zn_catAll"===c?g.mode="getAllNotes":(g.mode="getCatNotes",g.catId=c),g.groupId=znNote.groupId):"l"===a?(g.mode="getTagNotes",g.tagId=c,g.groupId=zmail.zuid):"fav"===a?(g.mode="getAllFavNotes",g.groupId=zmail.zuid):"sharedtome"===a?(g.mode="getNotesToMe",g.groupId=zmail.zuid):"sharedbyme"===a?(g.mode="getMyNotes",g.groupId=zmail.zuid):"search"===a?(g.mode="search",g.searchkey=$(".SC_sch input").attr("value"),h.searchkey=$(".SC_sch input").attr("value")):"byuser"===a&&(g.mode="getAllNotes",g.userId=c,g.groupId=znNote.groupId),h.mode=a,h.id=c,h.noteView=znNote.noteView,g.streamsView="Notes",g.actionType="appView",g.entityType=zNote.CONSTANTS.entityType;var k={};return k.prm=g,k.eprm=h,znNote.previousListingAjax=b.sendListingRequest(k,f),znNote.previousListingAjax},sendListingRequest:function(a,b){return zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:b,p:a.prm,ep:a.eprm})},getNotes:function(a,c,e){if(_zm._isPrivilegedUser())return void b.getNotesList(a,c,e);znNote.currNoteId="";var f,g={limit:"25"},h={},i=znNote.lstDetails().groupId;e?(e.start&&(g.start=e.start,h.isnew=!1),f=function(a,b){d.scrolling=!1,d.destroyLoadingDiv(),d.containerDiv&&d.containerDiv.remove(),h.groupId=i,zNote.listNotes(a,b,document.getElementsByClassName("SC_mclst SC_notes"),znNote.noteListing)}):(h.isnew=!0,h.groupId=i,znNote.previousListingAjax&&"pending"===znNote.previousListingAjax.state()&&znNote.previousListingAjax.abort(),znNote.noteListing&&ReactDOM.unmountComponentAtNode(znNote.noteListing.props.noteList.mountingElem[0]),d.destroyLoadingDiv=zmComponent.loadingBand({container:znNote.listingDiv[0],type:"listing"}),f=function(e,f){d.scrolling=!1,d.destroyLoadingDiv(),znNote.noteListing?znNote.noteListing=zNote.listNotes(e,f,znNote.noteListing.props.noteList.mountingElem):znNote.noteListing=zNote.listNotes(e,f,document.getElementsByClassName("SC_mclst SC_notes")),znNote.noteListing.props.noteList.on("remove",function(){if(this.length<25){var d=this.options.page;if(d&&"1"===d.showNextPage){var e=znNote.lstDetails();c=e.fId,a=e.type;var f={start:d.end};b.getNotes(a,c,f)}}})}),"c"===a?("zn_catAll"===c?g.mode="getAllNotes":(g.mode="getCatNotes",g.catId=c),g.groupId=znNote.groupId):"l"===a?(g.mode="getTagNotes",g.tagId=c,g.groupId=zmail.zuid):"fav"===a?(g.mode="getAllFavNotes",g.groupId=zmail.zuid):"sharedtome"===a?(g.mode="getNotesToMe",g.groupId=zmail.zuid):"sharedbyme"===a?(g.mode="getMyNotes",g.groupId=zmail.zuid):"search"===a?(g.mode="search",g.searchkey=$(".SC_sch input").attr("value"),h.searchkey=$(".SC_sch input").attr("value")):"byuser"===a&&(g.mode="getAllNotes",g.userId=c,g.groupId=znNote.groupId),h.mode=a,h.id=c,g.streamsView="Notes",g.actionType="appView",g.entityType=zNote.CONSTANTS.entityType;var j={};return j.prm=g,j.eprm=h,znNote.previousListingAjax=b.sendListingRequest(j,f),znNote.previousListingAjax},sendNewCatReq:function(a,b,e){var f,g,h;return h=e?e:d.currLayId,b.fn=void 0===b.fn?c.left.cateResult:b.fn,f={mode:"addCat",catName:a,groupId:h,streamsView:"Notes",actionType:"addCommonLabel",entityType:zNote.CONSTANTS.entityType},g={mode:"addCat",groupId:h},zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",fn:b.fn,t:"POST",p:f,ep:g})},sendEditCatReq:function(a,b){var e,f,g;g=d.currLayId,e={mode:"editCat",catName:a,catId:b,groupId:g,streamsView:"Notes",actionType:"editCommonLabel",entityType:zNote.CONSTANTS.entityType},f={mode:"editCat",groupId:g},zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",fn:c.left.cateResult,t:"POST",p:e,ep:f})},sendNewLabReq:function(a,b,d){var e,f={};f={name:a,color:b||"#FFD700",accId:zmail.defAccId,mode:"a"},e={name:a,mode:"a"};var g=d&&d.fn?d.fn:c.left.tagResult;return zmAjq.XHR({u:zmail.conPath+"/lA.do",t:"POST",fn:g,p:f,ep:e})},sendEditLabReq:function(a,b,c){var d,e={};a=$.trim(a),e={name:a,color:b,accId:zmail.defAccId,labId:znNote.labelId,mode:"e"},d={name:a,color:b,labId:znNote.labelId,mode:"e"},zmAjq.XHR({u:zmail.conPath+"/lA.do",t:"POST",fn:c.fn,p:e,ep:d})},sendDelLabReq:function(a){var b={labId:znNote.labelId,mode:"d",accId:zmail.defAccId},c={labId:znNote.labelId,mode:"d"};zmAjq.XHR({u:zmail.conPath+"/lA.do",t:"POST",fn:a.fn,p:b,ep:c})},delNoteCat:function(a){var b={mode:"delCat",catId:a,groupId:d.currLayId,streamsView:"Notes",actionType:"deleteCommonLabel",entityType:zNote.CONSTANTS.entityType},e={catId:a,mode:"delCat",groupId:d.currLayId};zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:c.left.cateResult,p:b,ep:e})}},c={left:{cateResult:function(b,c){var d,e,f,g,i=c.mode;if(b&&b[0]&&(b[0].catId||"success"===b[0].response)){if(g=c.groupId===zmail.zuid?"nviews":"ngroups",!zmsuite.isWorkspaceAvailable(h.appid))return void("addCat"===i&&(b[0].count=0,a.updateCatCache(i,c.groupId,b[0])));if(d=b[0],e=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(g),"addCat"===i){f={},f[d.catId]={},f[d.catId].name=d.category,f[d.catId].id=d.catId,f[d.catId].groupId=c.groupId,d.count=0;var j=znNote.catCacheObj[c.groupId].length;if(j>1){var k=znNote.catCacheObj[c.groupId][j-1].catId;e.insertNodeAfter(f,e.mapObject,k,c.groupId)}else e.appendNode(f,e.mapObject,c.groupId);a.updateCatCache(i,c.groupId,d)}else"editCat"===i?(f=e.getRowObjfromId(d.catId),f[d.catId].name=d.category,e.editNode(f,e.mapObject),a.updateCatCache(i,c.groupId,d),$.publish("/rename/notescat",[d])):"delCat"===i&&(f=e.getRowObjfromId(c.catId),e.deleteNode(f,c.groupId),a.updateCatCache(i,c.groupId,c),$.publish("/delete/notescat",[c.catId]))}},tagResult:function(a,b){var c,d=a.id,e={};if(e[d]={color:a.c,id:a.id,label:a.n,dispName:a.n,fav:"true",se:a.seq},!zmsuite.isWorkspaceAvailable(h.appid))return void("a"===b.mode&&(zmUtil.getTagList("default")[d]=e[d]));var f=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer("zmllabelH");if("a"===b.mode){var g=_.findWhere(zmail.labInfo,{se:a.seq});g?f.insertNodeBefore(e,f.mapObject,g.id):f.appendNode(e,f.mapObject)}else"e"===b.mode?(c=f.getRowObjfromId(d),c[d].dispName=c[d].label=a.n,c[d].color=a.c,f.editNode(c,f.mapObject),$.publish("/rename/noteslabel",[b])):"d"===b.mode&&(c=f.getRowObjfromId(b.labId),f.deleteNode(c),$.publish("/delete/noteslabel",[b]));zmail.zohoAccLabInfo=$.extend({},f.getListObject()),zmail.accId===zmail.defAccId&&(zmail.labInfo=f.getListObject())}},setGrpCat:function(a){$.each(a[0],function(a,b){znNote.catCacheObj[a]=b}),znNote.noteGroupOrderAndCount=a[1]}},f={cmenuItemClick:function(a){var e,f;switch(a.action){case"EditLabel":e=d.rgtMenuId,zmlab.labelId=e,zmlab.showCreateTagPopUp({mode:"rename",accType:"default",callback:function(a,e,g){d.isValidLabel($("#zm_createlabelpopup").find("input").val(),"e")&&(f={fn:c.left.tagResult},b.sendEditLabReq($("#zm_createlabelpopup").find("input").val(),g,f),zmsDialog.remove())}}),$("#znCntxtMenu").hide();break;case"DelLabel":if(e=d.rgtMenuId,!e)return!1;var h={};h.onOk=function(){f={fn:c.left.tagResult},b.sendDelLabReq(f)},h.stopPropagation=!0,zmsDialog.confirm(g.deltag,h),$("#znCntxtMenu").hide();break;case"CreateCat":e=d.rgtMenuId,zmUtil.setEditable({ele:$("#znLTMenu_Nc"),target:$("#"+e),callback:d.cmenuActions,allowCondition:function(){if(!e)return!0},parentdiv:$("#znCntxtMenu")});break;case"EditCat":e=d.rgtMenuId;var i=!0,j=znNote.getNamefrmCatObj(e,d.currLayId);if(""===e||"zn_catAll"===e||"General"===j||!j)return!1;zmUtil.setEditable({ele:$("#znLTMenu_Rc"),target:$("#"+e),callback:d.cmenuActions,initialize:!0,allowCondition:function(){return!!e&&i},parentdiv:$("#znCntxtMenu")});break;case"DelCat":if(e=d.rgtMenuId,h={},j=znNote.getNamefrmCatObj(e,d.currLayId),""===e||"zn_catAll"===e||"General"===j||!j)return znNote.hideMenu(),!1;h.onOk=function(){znNote.hideMenu(),b.delNoteCat(e)},h.stopPropagation=!0,zmsDialog.confirm(g.delbook,h)}}},d={catIdGen:[],currLayId:"",rgtMenuId:"",pageDivTop:0,destroyLoadingDiv:"",scrolling:!1,nCMenuCatArr:[{htm:g.left.createBook,id:"znLTMenu_Nc",cEdit:!0,data:{action:"CreateCat"}},{sep:!0},{htm:g.left.renameBook,id:"znLTMenu_Rc",cEdit:!0,data:{action:"EditCat"}},{htm:g.left.deleteBook,id:"znLTMenu_Dc",data:{action:"DelCat"}}],nCMenuTagArr:[{htm:g.left.editTag,id:"znLTMenu_Rl",data:{action:"EditLabel"}},{htm:g.left.deleteTag,id:"znLTMenu_Dl",data:{action:"DelLabel"}}],nCMenuTagArr1:[{htm:g.left.createTag,id:"znLTMenu_Cl",cEdit:!0,data:{action:"CreateLabel"}},{htm:g.left.deleteTag,id:"znLTMenu_Dl",data:{action:"DelLabel"}}],actIconObj:{list:{left:{leftHTML:"",centerAlign:!0},right:[]}},actIconObj1:{list:{left:[],right:[{actionArr:[{iconList:["msi-thumbview"],data:"thumb",tooltip:g.tooltips.gridView},{iconList:["msi-listview"],data:"list",tooltip:g.tooltips.listView}]}]},clk:function(a,c){"msi-thumbview"===c?(zmsuite.getCenter()[0].getNodes()[2].$el.removeClass("SC_cmptNotes"),zmsuite.getCenter()[0].$el.find(".SC_frt").find("li").find("b").removeClass("SC_sel"),$(a.target).closest("b").addClass("SC_sel"),znNote.noteView=1,b.switchView()):"msi-listview"===c&&(zmsuite.getCenter()[0].getNodes()[2].$el.addClass("SC_cmptNotes"),zmsuite.getCenter()[0].$el.find(".SC_frt").find("li").find("b").removeClass("SC_sel"),$(a.target).closest("b").addClass("SC_sel"),znNote.noteView=2,b.switchView())}},pageDetails:function(){var a=znNote.listingDiv.attr("page-detail");if(a=$.parseJSON(a))return a},getFrameworkObject:function(){var a,b,c,e,f,g=$.extend(!0,{},znNote.catCacheObj),h={},i={};delete g[zmail.zuid],e=Object.keys(g),f=e.length;var j=function(a){return function(c){if(e[a]!==zmail.zuid){if(c.id=c.catId,c.name=c.category,"General"!==c.category)return c.seq=b++,c.name=c.category,c.SE=c.seq,c.groupId=e[a],i[c.catId]={},i[c.catId].c=c.count,i[c.catId].p=e[a],c.catId;d.catIdGen[e[a]]=c.catId}}};for(a=0;a<f;a++)b=1,c=_.map(g[e[a]],j(a)),h[e[a]]={},h[e[a]].CH=_.object(c.slice(1,c.length),g[e[a]].slice(1,g[e[a]].length));return{newObject:h,countObject:i}},getCountAndChildObject:function(){var a,b=$.extend(!0,{},znNote.catCacheObj),c={};c[zmail.zuid]={},c[zmail.zuid].c=znNote.myNotesCount,c[zmail.zuid].p="-1";var e={},f=1;return e[zmail.zuid]={},a=_.map(b[zmail.zuid],function(a){return a.id=a.catId,a.name=a.category,"General"!==a.category?(a.seq=f++,a.name=a.category,a.SE=a.seq,a.groupId=zmail.zuid,c[a.catId]={},c[a.catId].c=a.count,c[a.catId].p=zmail.zuid,a.catId):void(d.catIdGen[zmail.zuid]=a.catId)}),e[zmail.zuid].CH=_.object(a.slice(1,a.length),b[zmail.zuid].slice(1,b[zmail.zuid].length)),{childObject:e,countObject:c}},promoteGroup:function(a){var b=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer("ngroups"),c=b.getRowObjfromId(a.group.id);if(b.getListObject()[a.group.id].shouldshow=!1,b.moveNode(c,b.mapObject),b.getListObject().more&&b.getListObject().more.SE>8){var d=_.findWhere(b.getListObject(),{SE:7});c=b.getRowObjfromId(d.id),b.moveNode(c,b.mapObject,"more"),b.getListObject()[d.id].shouldshow=!0,b.getListObject().more.hideNode||b.hideNode(d.id)}},showMoreOrLess:function(a,b){var c,d,e=Object.keys(a.rowObject)[0];"more"===a.rowObject[e].id?(c=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer("ngroups"),d=c.listObject,Object.keys(d).forEach(function(a){c.showNode(a,b)}),c.showNode("less",b),c.hideNode("more",b)):"less"===a.rowObject[e].id&&(c=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer("ngroups"),d=c.listObject,Object.keys(d).forEach(function(a){d[a].shouldshow?c.hideNode(a,b):c.showNode(a,b)}),c.showNode("more",b),c.hideNode("less",b),$("#"+a.rowInfo.layerId)[0].children[0].firstElementChild.scrollIntoView(),"function"==typeof b&&b())},constructLeft:function(){var a,e=[];znNote.noteView=1;var f=zmsuite.getLeft(),i=f.getNodes();if("n"!==zmApp.selectedApp)return void zmsuite.deleteAppInfo(h.appid);var j={},k={},l={},m=d.getCountAndChildObject();k=m.childObject,l=m.countObject,j.fav={id:"fav",name:g.fav,SE:1,groupId:zmail.zuid},j.sharedtome={id:"sharedtome",name:g.left.sharedtome,SE:2,groupId:zmail.zuid},j[zmail.zuid]={id:zmail.zuid,name:g.myNotes,SE:3,groupId:zmail.zuid,HC:_.keys(k[zmail.zuid].CH).length,E:1};var n={dropdown:"min",id:"hviews",name:g.left.views},o=new ZMLayer,p={id:"id",name:"name",infoObject:"views",count:"c",parentId:"p",notBold:!0,sequence:"SE",hasChild:"HC",expChild:"E"},q={type:"1",mapObject:p,id:"nviews",isHeaderSel:!1,hasChild:!0,hasCountObject:!0,dataObject:{headerObject:n,listObject:j,childObject:k,countObject:l}};o.push(q),e.push(o),znNote.groupObj=zmCont.getGroup(),znNote.groupObj[zmail.zuid]={name:g.myNotes};var r=new ZMLayer,s=[],t={id:"hgroups",name:g.left.groups,showList:!0},u=$.extend(!0,{},znNote.groupObj);delete u[zmail.zuid],r.setHeaderObject(t);var v={name:"name",id:"id",groupId:zmail.zuid,count:"c",parentId:"p",notBold:!0,infoObject:"c",sequence:"SE",hasChild:"HC",expChild:"E"};s=u;var w=d.getFrameworkObject(),x=w.newObject,y=w.countObject,z=1;_.each(znNote.noteGroupOrderAndCount,function(a,b){7===b&&znNote.noteGroupOrderAndCount.length>7&&(s.more={showNode:!0,id:"more",name:g.left.more,SE:z++,rowTitle:g.tooltips.viewallgroups,txtNodeClass:"SC_thm"},y.more={},y.more.c=0,y.more.p="-1");var c=s[a.groupId];znNote.catCacheObj[a.groupId]&&znNote.catCacheObj[a.groupId].length?c.HC=_.keys(x[a.groupId].CH).length:c.HC=0,y[a.groupId]={},y[a.groupId].c="-"===a.count?0:a.count,y[a.groupId].p="-1",c.E=0,c.id=a.groupId,c.SE=z++,b>=7&&(c.hideNode=!0),s[a.groupId].shouldshow=s[a.groupId].hideNode}),s.more&&(s.less={hideNode:!0,id:"less",name:g.left.less,SE:z++,rowTitle:g.tooltips.hidegroups,txtNodeClass:"SC_thm"},y.less={},y.less.c=0,y.less.p="-1");var A={type:"1",hasChild:!0,hasCountObject:!0,mapObject:v,id:"ngroups",isHeaderSel:!1,dataObject:{headerObject:t,listObject:s,childObject:x,countObject:y}};r.push(A),e.push(r);var B={dropdown:"min",id:"header2",name:g.left.tags,showList:!0,c:"<i class='msi-plus'></i>",onAdd:function(){$("div#zmCntxtMenu").remove(),zmlab.showCreateTagPopUp({mode:"new",accType:"default",callback:function(d,e,f){a={fn:c.left.tagResult},b.sendNewLabReq(e,f,a),zmsDialog.remove()}})}},C=new ZMLayer,D=zmail.labInfo,E={name:"dispName",id:"id",count:"c",parentId:"p",color:"color",sequence:"se",infoObject:"l"},F={type:"2",mapObject:E,listId:"zmllabel",id:"zmllabelH",dataObject:{headerObject:B,listObject:D}};C.setHeaderObject(B),C.push(F),e.push(C),i[0].push({layerArr:e}),f.render(),zmNCenter.handlers.add("streams",function(a,b){b.etype===zNote.CONSTANTS.entityType&&"true"===b.grp&&"30"===b.ntype&&d.promoteGroup(b)})},constructCenter:function(){var a=zmsuite.getCenter(),b=a[0].getNodes();_zm._isPrivilegedUser()&&(b[0].push(d.actIconObj1.list),b[0].setListener("click",d.actIconObj1.clk)),b[1].push(d.actIconObj.list),znNote.listingDiv=zmsuite.getCenter()[0].getNodes()[2].getListElem(),znNote.listingDiv.addClass("SC_notes"),zmsuite.renderCenter(),zmsuite.showApp(h.appid),zmsuite.getCenter()[0].getNodes()[2].setListener("scroll",function(a){a.stopPropagation(),d.fillNotes()}),zmsuite.getLeft().setListener("click",znNote.znLeftClbk),zmsuite.getLeft().setListener("contextmenu",znNote.znLeftClbk),zmsuite.getLeft().getNodes()[0].getLayer("ngroups").setChildToggle(function(a,b,c){var d;if(a&&a.zmsData)for(var e in a.zmsData.rowObject)d=a.zmsData.rowObject[e];else d=a;d.E=c?1:0}),zmsuite.getLeft().getNodes()[0].getLayer("nviews").setChildToggle(function(a,b,c){var d;if(a&&a.zmsData)for(var e in a.zmsData.rowObject)d=a.zmsData.rowObject[e];else d=a;d.E=c?1:0}),zmsuite.getCenter(h.appid)[0].$el.find(".SC_frt").find("."+zNote.CONSTANTS.listTypeClass[znNote.noteView]).closest("b").addClass("SC_sel")},popup:function(a,b){if("options"===a){var c,d,e=[],f=b.length;for(d=0;d<f;d++)c=b[d]?["LI",{child:[["text",b[d]]]}]:["LI",{attrs:{"class":"SC_lne"}}],e.push(_zm.getDOM(c));return e}},isValidCategory:function(a,b){var c,e,f=a;if(e=b?b:d.currLayId,f=f.trim(),c=f.toLowerCase(),zmUtil.hasSpecialChars(f,"labelName"))return zmUtil.succErrMsg("e",g.nosp),!1;if(!c)return zmUtil.succErrMsg("e",g.nonull),!1;for(var h=znNote.catCacheObj[e],i=h.length,j=0;j<i;j++)if(h[j].category===f)return zmUtil.succErrMsg("e",g.bookexist),!1;return!0},isValidLabel:function(a,b){var c=$.trim(a.toLowerCase());if(zmUtil.hasSpecialChars(c))return zmUtil.succErrMsg("e",g.tagdata.errors.specialCharacters),!1;if(c.length>25)return zmUtil.succErrMsg("e",g.tagdata.errors.lengthExceeded),!1;if("info"===c||"important"===c||"follow-up"===c)return zmUtil.succErrMsg("e",g.tagdata.errors.retrictedWord),!1;if(!c)return zmUtil.succErrMsg("e",g.tagdata.errors.empty),!1;var d=zmUtil.getTagList("default");for(var e in d)if(("e"!==b||znNote.labelId!==e)&&d[e].label.toLowerCase()===c)return zmUtil.succErrMsg("e",g.tagdata.errors.exists),!1;return!0},cmenuActions:function(){var a,e,f;$("#znActionNewCategory[contentEditable='true']").length||$("#znLTMenu_Nc[contentEditable='true']").length?($("#znActionNewCategory[contentEditable='true']").length?(a=$("#znActionNewCategory").text(),e=d.currLayId?d.currLayId:zmail.zuid):a=$("#znLTMenu_Nc").text(),a=a.trim(),d.isValidCategory(a,e)&&(f={fn:c.left.cateResult},b.sendNewCatReq(a,f,e),$("#znLTMenu").hide(),$("#znCntxtMenu").remove()),znNote.currNoteId=""):$("#znLTMenu_Rc[contentEditable='true']").length&&(a=$("#znLTMenu_Rc").text(),d.isValidCategory(a)&&(b.sendEditCatReq(a,d.rgtMenuId),$("#znLTMenu").hide(),$("#znCntxtMenu").remove()),znNote.currNoteId="")},dimUtility:function(a){for(var b=a.length,c=0;c<b;c++)"znLTMenu_Rc"===a[c]||"znLTMenu_Rl"===a[c]||"znLTMenu_Nc"===a[c]?$("#"+a[c]).parent().addClass("SC_op3"):$("#"+a[c]).addClass("SC_op3")},updateCountReact:function(a,b){"addNote"===b.mode?(d.updateCatCount(b.cat,"inc",b.namespaceId),d.updateCatCount(b.namespaceId,"inc",b.namespaceId)):"delNote"===b.mode?(d.updateCatCount(b.cat,"dec",b.groupId),d.updateCatCount(b.groupId,"dec",b.groupId)):"moveNote"===b.mode&&(d.updateCatCount(b.pCatId,"dec",b.groupId),d.updateCatCount(b.catId,"inc",b.groupId))},updateCatCount:function(a,b,c){if(zmsuite.isWorkspaceAvailable(h.appid)){var d,e=znNote.getNamefrmCatObj(a,c);if("General"!==e||a===c){d=c===zmail.zuid?"nviews":"ngroups";var f=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(d);f.updateCount(a,b)}}},showAdd:function(){var a,b,c=znNote.lstDetails();c&&"zn_catAll"!==c.fId&&"c"===c.type?(a=c.fId,b=znNote.groupId):"zn_catAll"===c.fId?(a=d.catIdGen[znNote.groupId],b=znNote.groupId):(a=d.catIdGen[zmail.zuid],b=zmail.zuid),zmail.showFeature?zNote.addNoteAutoSave({notes:{color:"0",notecont:"",catid:a},cntnt:{title:""},gnrl:{group:{id:b},by:zmail.zuid}}):zNote.addNote({catId:a,namespaceId:b})},fillNotes:function(){var a=znNote.listingDiv,c=a.scrollTop(),e=a.prop("scrollHeight")-a.height();if($("[data-drop='1']").removeAttr("data-drop"),znNote.hideMenu(),c&&Math.floor(c)>=.8*Math.floor(e)&&d.scrolling===!1){d.scrolling=!0;var f=znNote.noteListing.props.noteList.options.page;if(f&&"1"===f.showNextPage){var g=znNote.lstDetails(),h=g.fId,i=g.type,j={start:f.end};znNote.listingDiv.append("<div id=pgdiv style=position:absolute;width:100%;top:"+d.pageDivTop+"px;left:0px></div>"),d.destroyLoadingDiv=zmComponent.loadingBand({container:$("#pgdiv")[0],type:"pagination"}),d.containerDiv=$("#pgdiv"),b.getNotes(i,h,j)}}},foldView:function(a,c){var e,f,g,i,j=a.rowInfo.info,k=!0;if("header"!==a.rowInfo.type&&j){if(zmTab.currentTab!==h.appid&&zmsuite.showApp(h.appid),"c"===j){if(g=Object.keys(a.rowObject)[0],"more"===a.rowObject[g].id||"less"===a.rowObject[g].id)return void d.showMoreOrLess(a,c);void 0!==a.rowObject[g].HC?(e="zn_catAll",znNote.groupId=a.rowObject[g].id,f=a.rowObject[g].name,$.isEmptyObject(znNote.catCacheObj[znNote.groupId])&&(k=!1)):(e=a.rowObject[g].id,znNote.groupId=a.rowObject[g].groupId,f=a.rowObject[g].name,i="catload")}else if("l"===j){for(var l in a.rowObject){e=a.rowObject[l].id,f=a.rowObject[l].dispName;break}znNote.groupId=zmail.zuid}else"views"===j&&(g=Object.keys(a.rowObject)[0],e=a.rowObject[g].id,znNote.groupId=a.rowObject[g].groupId,f=a.rowObject[g].name,"fav"===e||"sharedtome"===e||"trash"===e?j=e:(j="c",void 0!==a.rowObject[g].HC&&(e="zn_catAll")));d.currLayId=znNote.groupId,znNote.cacheObj={},znNote.noteObj={};var m='{"fId":"'+e+'","type":"'+j+'","groupId":"'+znNote.groupId+'"}';if(znNote.updateHeaderBand(f,i),d.updateRouter({type:j,folId:e,groupId:znNote.groupId}),k)znNote.listingDiv.attr("data-detail",m),b.getNotes(j,e);else{var n={};n.gid=znNote.groupId,n.fn=function(a,c){znNote.catCacheObj[c.id]=a,
d.catIdGen[c.id]=a[0].catId,znNote.listingDiv.attr("data-detail",m),b.getNotes(j,e)},znNote.getGenCat(n)}}},updateRouter:function(a){var b=[];"c"===a.type?a.groupId===zmail.zuid?(b.push("views"),b.push("mynotes"),"zn_catAll"!==a.folId&&b.push(a.folId)):(b.push(zNote.CONSTANTS.hashUrl.type[a.type]),b.push(a.groupId),"zn_catAll"!==a.folId&&b.push(a.folId)):"l"===a.type?(b.push(zNote.CONSTANTS.hashUrl.type[a.type]),b.push(a.folId)):"fav"!==a.type&&"sharedtome"!==a.type||(b.push(zNote.CONSTANTS.hashUrl.type[a.type]),b.push(zNote.CONSTANTS.hashUrl.folId[a.folId])),zNote.RouteHelper.setParams(b),zNote.RouteHelper.update()},FLUtility:function(a){var b,c=a.rowInfo.info;if(c){var e;if("c"===c||"views"===c&&"fav"!==a.rowObject[Object.keys(a.rowObject)[0]].id&&"sharedtome"!==a.rowObject[Object.keys(a.rowObject)[0]].id){if("header"===a.rowInfo.type)return;var g=zmCont.getGroup();e={clk:function(a,b){f.cmenuItemClick(b)},divId:"znCntxtMenu",conArr:d.nCMenuCatArr};var h=Object.keys(a.rowObject)[0];d.rgtMenuId=void 0===a.rowObject[h].HC?a.rowObject[h].id:void 0,d.currLayId=a.rowObject[h].groupId||a.rowObject[h].id,zmsuite.showContextMenu(a.eventInfo,e),d.rgtMenuId?(b=["znLTMenu_Nc"],d.dimUtility(b)):(b=["znLTMenu_Rc","znLTMenu_Dc"],d.dimUtility(b)),g[d.currLayId]&&!g[d.currLayId].isOwner&&d.dimUtility(["znLTMenu_Rc","znLTMenu_Dc"])}else if("l"===c){if("header"===a.rowInfo.type)return;var i;for(var j in a.rowObject){d.rgtMenuId=a.rowObject[j].id;break}d.currLayId=a.rowInfo.layerId,znNote.labelId=d.rgtMenuId,i=d.rgtMenuId?d.nCMenuTagArr:d.nCMenuTagArr1,e={clk:function(a,b){f.cmenuItemClick(b)},divId:"znCntxtMenu",conArr:i},zmsuite.showContextMenu(a.eventInfo,e),d.rgtMenuId&&!zmUtil.isSystemLabel(znNote.labelId)||(b=["znLTMenu_Rl","znLTMenu_Dl"],d.dimUtility(b))}}},findScroll:function(){var a=znNote.listingDiv,c=znNote.lstDetails(),e=c.fId,f=c.type;setTimeout(function(){var c=a.get(0).scrollHeight>a.get(0).clientHeight,g=d.pageDetails(),h={start:g.end};c||"1"!==g.showNextPage||b.getNotes(f,e,h)},100)},renameLabel:function(a,b){$(".listBoxNote").remove();var c=zmUtil.getTagList("default"),d=znNote.lstDetails(),e=d.fId;e===b.labId&&znNote.updateHeaderBand(c[znNote.labelId].dispName)},deleteLabel:function(a,c){var d=znNote.lstDetails(),e=d.fId;if(e===c.labId)return d='{"fId":"zn_catAll","type":"c","groupId":"'+zmail.zuid+'"}',znNote.listingDiv.attr("data-detail",d),b.getNotes("c","zn_catAll"),zmsuite.getLeft().selRow(zmail.zuid,"nviews"),void znNote.updateHeaderBand(znNote.groupObj[zmail.zuid].name)},deleteCat:function(a,c){var d=znNote.lstDetails(),e=d.fId;if(e===c){d='{"fId":"zn_catAll","type":"c","groupId":"'+znNote.groupId+'"}',znNote.listingDiv.attr("data-detail",d),b.getNotes("c","zn_catAll");var f=znNote.groupId===zmail.zuid?"nviews":"ngroups";return zmsuite.getLeft().selRow(znNote.groupId,f),void znNote.updateHeaderBand(znNote.groupObj[znNote.groupId].name)}},renameCat:function(a,b){var c=znNote.lstDetails(),d=c.fId;d===b.catId&&znNote.updateHeaderBand(b.category)},getAttSlideArray:function(a,b,c){for(var d=[],e=0,f=a.length;e<f;e++)for(var g in a[e]){var h={Id:a[e][g].Id,e:b,et:2,ft:a[e][g].ft,fs:a[e][g].fs,fn:a[e][g].fn,p:a[e][g].p,tn:!1,gId:c,u:""};c!==zmail.zuid&&(h.type="viewGroupData"),d.push(h)}return d}},e={cacheObj:{},noteObj:{},catCacheObj:{},noteView:1,iSSubscribed:!1,currNoteId:"",listingDiv:"",labelId:"",groupObj:{},groupId:"",getNamefrmCatObj:function(a,b){if(b){for(var c=znNote.catCacheObj[b],d=c?c.length:0,e=0;e<d;e++)if(c[e].catId===a)return c[e].category;return"General"}},getNamefrmGrpObj:function(a){var b;return $.each(znNote.groupObj,function(c,d){if(a===c)return b=d.name,!1}),b},lstDetails:function(){if(znNote.listingDiv){var a=znNote.listingDiv.attr("data-detail");return a=$.parseJSON(a),a?a:void 0}},getCatId:function(a,b){for(var c=znNote.catCacheObj[b],d=c.length,e=0;e<d;e++)if(c[e].category===a)return c[e].catId},hideRgt:function(){1!==znNote.noteView||$("#nonotes").length||setTimeout(function(){znNote.setTopLeft()},100)},removeNote:function(a){var b,c=$("#"+a),e=znNote.listingDiv;if(1===znNote.noteView){znNote.listingDiv.addClass("zn_note_animation");var f=c.attr("data-sno"),g=c.attr("data-cno");g=parseInt(g);var h=c.css("top");h=h.replace("px",""),b=e.get(0).scrollHeight>e.get(0).clientHeight,c.remove();var i={sno:f,cno:g,top:h};znNote.setTopLeft(i),setTimeout(function(){znNote.listingDiv.removeClass("zn_note_animation")},500)}else b=e.get(0).scrollHeight>e.get(0).clientHeight,c.remove();b&&d.findScroll()},hideMenu:function(){$(".zn_note.sel").removeClass("sel"),$(".zmL.sel").removeClass("sel"),$("[data-visible='true']").not($("[data-current='true']")).attr("data-visible","false"),$("#znLTMenu").hide(),$("#znCntxtMenu").remove(),$("#zn_foltagpopup").remove(),$("#zm_dropDown").remove()},setTopLeft:function(a,b,c){function e(){b&&f.addClass("zn_note_animation");var a=Math.min.apply(Math,k),c=k.indexOf(a),g=l[n];if(k[c]===a){var h=c*(i+p)+"px",j=a+"px";$(g).attr({"data-cno":c,"data-sno":n}).css({top:j,left:h}),k[c]=parseInt($(g).outerHeight())+parseInt(a)+parseInt(19)}n+=1,n<m?setTimeout(e,0):(d.pageDivTop=Math.max.apply(Math,k),setTimeout(function(){b&&f.removeClass("zn_note_animation")},500))}if(1===znNote.noteView&&(zmTab.currentTab===h.appid||zmTab.currentTab.startsWith("zm_srch")!==!1||"n"===zmSearch.getSearchAppType())){var f=c?$(c).children():znNote.listingDiv,g=c?$(c).width()-20:f.width()-20,i=znBox.CONTS.ntWid;if(!(a&&a.sno&&f.children().length<=a.sno)){a&&a.width&&(g=a.width-20);var j,k=[],l=f.children(),m=l.length,n=0,o=Math.floor(g/i);o=Math.max(o,1),j=o;var p=Math.floor((g-o*i)/o),q=i-znBox.CONTS.ntBorPad+p;for(l.each(function(){$(this).css({width:q+"px"})});j--;)k.push(0);if(a&&void 0!==a.sno&&void 0!==a.cno&&void 0!==a.top){var r=a.sno,s=a.cno,t=a.top,u=o,v=[];k[s]=parseInt(t),v.push(s);for(var w=1,x=1;x<=r;x++){var y=$(l[r-x]),z=y.attr("data-cno");if(0===k[z]){var A=y.css("top");A=A.replace("px",""),A=parseInt(A),k[z]=A+y.outerHeight()+parseInt(19),++w}if(w===u)break}n=parseInt(r)}setTimeout(e,0)}}},getCurNoteParam:function(a){var b=$("#"+a+".zn_note");if(b.length){var c=parseInt(b.attr("data-sno"))+1,d=b.attr("data-cno");d=parseInt(d);var e=b.css("top");e=e.replace("px",""),e=b.outerHeight()+parseInt(e)+parseInt(19);var f={sno:c,cno:d,top:e};return f}},loadNoteData:function(){var a=$.Deferred();return znNote.groupId=zmail.zuid,$.isEmptyObject(znNote.catCacheObj)?b.getCat().done(function(e){znNote.catCacheObj[zmail.zuid]=e[1][0].Category,znNote.myNotesCount=e[1][0].noteCount,b.getGroupCat().done(function(b){c.setGrpCat(b[1]),d.constructLeft(),a.resolve()}).fail(function(){d.constructLeft(),a.resolve()})}):(d.constructLeft(),a.resolve()),a.promise()},toggleChild:function(a,b,c){var d=zmsuite.getLeft().getNodes()[0].getLayer(b),e=d.getChildObject()[a];if(e)if("show"===c){var f=$("#"+a);d.showChild(f.find(".msi-rarrow"),a,f)}else d.hideChild($("#"+a).find(".msi-rarrow"),a)},validateHashParams:function(a){if("l"===a.type){if(a.groupId&&a.fId&&a.groupId===zmail.zuid&&zmail.labInfo[a.fId])return!0}else if("c"===a.type){if(a.groupId&&a.fId&&znNote.groupObj[a.groupId]&&("zn_catAll"===a.fId||znNote.getNamefrmCatObj(a.fId,a.groupId)))return!0}else if(("sharedtome"===a.type||"fav"===a.type)&&a.groupId===zmail.zuid)return!0;return!1},deduceHashParams:function(a){var b,c,d;if(a&&a.data&&a.data.router&&a.hashParams&&a.hashParams.length){"tags"===a.hashParams[0]?(c=zmail.zuid,b=a.hashParams[1],d=zNote.CONSTANTS.hashUrl.typeCode[a.hashParams[0]]):"group"===a.hashParams[0]?(c=a.hashParams[1],b=a.hashParams[2]||"zn_catAll",d=zNote.CONSTANTS.hashUrl.typeCode[a.hashParams[0]]):"views"===a.hashParams[0]&&("mynotes"===a.hashParams[1]?(b=a.hashParams[2]||"zn_catAll",d="c"):b=d=zNote.CONSTANTS.hashUrl.folIdCode[a.hashParams[1]],c=zmail.zuid);var e=znNote.validateHashParams({fId:b,groupId:c,type:d});e||(c=zmail.zuid,b="zn_catAll",d="c")}else c=zmail.zuid,b="zn_catAll",d="c";return{fId:b,groupId:c,type:d}},notesLoad:function(a){a=a||{},zmsuite.setAppInfo({appname:"Notes",appId:h.appid,appIcon:h.appicon,isCacheable:"yes",faqKey:"notes",searchPlaceHolder:zmText.get("mailsuite").searchMail,data:{LNodes:"2",CNodes:3,PNodes:2},handler:{create:d.showAdd},router:zNote.RouteHelper}),znNote.loadNoteData().done(function(){d.constructCenter(),znNote.handleHashUrl(a)}),$(zmail.win).mousedown(function(){"n"===zmApp.currentApp&&znNote.hideMenu()}),znNote.isSubscribed||($.subscribe("/rename/noteslabel",d.renameLabel),$.subscribe("/delete/noteslabel",d.deleteLabel),$.subscribe("/rename/notescat",d.renameCat),$.subscribe("/delete/notescat",d.deleteCat),$.subscribe("note/updateCount",d.updateCountReact),$.subscribe("group/added",znNote.appendLeftLayer),$.subscribe("/apps/tabSwitched",function(a,b){1===znNote.noteView&&b===h.appid&&znNote.listingDiv&&!znNote.listingDiv.find("#nonotes").length&&znNote.setTopLeft(!1,!0,znNote.listingDiv)}),znNote.isSubscribed=!0)},handleHashUrl:function(a){var c=znNote.deduceHashParams(a),e=c.fId,f=c.groupId,g=c.type;znNote.groupId=f;var h="",j='{"fId":"'+e+'","type":"'+g+'","groupId":"'+f+'"}';if(znNote.listingDiv.attr("data-detail",j),d.updateRouter({type:g,folId:e,groupId:f}),"c"===g){var k=f===zmail.zuid?"nviews":"ngroups";if("zn_catAll"===e)h=znNote.getGroupName(f),zmsuite.getLeft().selRow(f,k);else{var l=zmsuite.getLeft().getNodes()[0];l.layerArr&&znNote.toggleChild(f,k,"show"),h=znNote.getNamefrmCatObj(e,f),zmsuite.getLeft().selRow(e,k)}}else"l"===g?(h=zmail.labInfo[e].dispName,zmsuite.getLeft().selRow(e,"zmllabelH")):"sharedtome"!==g&&"fav"!==g||(h=i[e],zmsuite.getLeft().selRow(e,"nviews"));znNote.updateHeaderBand(h),_zm._isPrivilegedUser()?b.getNotesList(g,e).done(function(){znNote.notesLoaded=!0}):b.getNotes(g,e).done(function(){znNote.notesLoaded=!0})},showNotesApp:function(a){znNote.notesLoaded?(zmsuite.getLeft().setListener("click",znNote.znLeftClbk),zmsuite.getLeft().setListener("contextmenu",znNote.znLeftClbk),zmsuite.getLeft().getNodes()[0].getLayer("ngroups").setChildToggle(function(a,b,c){var d;if(a&&a.zmsData)for(var e in a.zmsData.rowObject)d=a.zmsData.rowObject[e];else d=a;d.E=c?1:0}),zmsuite.getLeft().getNodes()[0].getLayer("nviews").setChildToggle(function(a,b,c){var d;if(a&&a.zmsData)for(var e in a.zmsData.rowObject)d=a.zmsData.rowObject[e];else d=a;d.E=c?1:0}),a&&a.data&&a.data.router&&znNote.handleHashUrl(a)):znNote.loadNoteData()},appendLeftLayer:function(a,b){var c=zmCont.getGroup()[b.groupID];znNote.groupObj[b.groupID]=c;var e=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer("ngroups"),f={};f[b.groupID]=c,f[b.groupID].HC=0,f[b.groupID].E=0,f[b.groupID].zerogroup=!0,e.getChildObject()[b.groupID]={CH:{}},e.getListObject().less?(f[b.groupID].hideNode=e.getListObject().less.hideNode,f[b.groupID].shouldshow=!0,e.insertNodeBefore(f,e.mapObject,"less")):e.appendNode(f,e.mapObject);var g={gid:b.groupID};g.fn=function(a,b){znNote.catCacheObj[b.id]=a,d.catIdGen[b.id]=a[0].catId},znNote.getGenCat(g)},getGenCat:function(a){var b={mode:"getGeneralCat",groupId:a.gid,streamsView:"Notes",actionType:"appView",entityType:"2"},c={id:a.gid,mode:"getGeneralCat"},e=function(a,b){znNote.catCacheObj[b.id]=a,d.catIdGen[b.id]=a[0].catId},f=a.fn?a.fn:e;return zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:f,p:b,ep:c})},updateHeaderBandWithObj:function(a){var b,c=String(a.zid);"byuser"===a.mode&&zmail.ContactBook.get({zuid:c}).done(function(b){var c=b[0];d.actIconObj.list.left.leftHTML=znNote.getGroupName(a.groupId)+'<span class="sum unreadCount SC_folFil"><b>'+g.createdby+"</b>"+c.attrs.fn+'<i id="clrFilter" class="msi-close"></span>'}),b=zmsuite.getCenter()[0].getNodes()[1],b.push(d.actIconObj.list),b.paint(),b.$el.find("#clrFilter").length&&b.$el.find("#clrFilter").off("click").on("click",function(){znNote.leftSelectedId=zmsuite.getLeft().selId,$("#ngroups").find("#"+znNote.leftSelectedId).trigger("click")})},updateHeaderBand:function(a,c){var e,f;znNote.groupId!==zmail.zuid?"catload"===c?d.actIconObj.list.left.leftHTML="<b class='SC_opa50'>"+znNote.getGroupName(znNote.groupId)+"</b> <i class='msi-rarrow'></i>"+_zm.escapeTags(a)+"<span id='ngroupmembers' class='SC_lnk'>"+znNote.groupObj[znNote.groupId].members.length+" members</span>":d.actIconObj.list.left.leftHTML=_zm.escapeTags(a)+"<span id='ngroupmembers' class='SC_lnk'>"+znNote.groupObj[znNote.groupId].members.length+" members</span>":d.actIconObj.list.left.leftHTML=_zm.escapeTags(a),e=zmsuite.getCenter()[0].getNodes()[1],e.push(d.actIconObj.list),e.paint(),f=function(a){a.dialog.remove();var c="byuser";b.getNotes("byuser",a.zid);var d='{"fId":"'+a.zid+'","type":"'+c+'","groupId":"'+znNote.groupId+'"}';znNote.listingDiv.attr("data-detail",d),znNote.updateHeaderBandWithObj({groupId:znNote.groupId,mode:"byuser",zid:a.zid})},e.$el.find("#ngroupmembers").length&&e.$el.find("#ngroupmembers").off("click").on("click",function(){zmAppLoader.load("streamsGroup").done(function(){zmStreamsApp.GroupApp.showMemberDialog({gid:znNote.groupId,title:g.tooltips.viewNoteByCreator,callback:f})})})},deleteNotesReq:function(a,b){var c={entityId:a.id,mode:"delNote",groupId:a.groupId,streamsView:"Notes",actionType:"delEntity",entityType:"2"},d={id:a.id,mode:"delNote"},e=function(a,d){b&&b(d),$.publish("/note/delete",[c.entityId,c.groupId]),$.publish("note/deleteNote",[{pid:c.entityId,gid:c.groupId}])};zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:e,p:c,ep:d})},znLeftClbk:function(a){var b,c=a.zmsData;"clbk"in a&&(b=a.clbk);var e;e=c.rowInfo.info,"click"===c.type?e&&2===c.colInfo.column&&d.foldView(c,b):"contextmenu"===c.type&&d.FLUtility(c)},getGeneralCatId:function(a){for(var b in znNote.catCacheObj)if(b===String(a))return znNote.catCacheObj[b]&&znNote.catCacheObj[b][0]&&znNote.catCacheObj[b][0].catId},getGroupArray:function(){var a=[],b=zmCont.getGroupOrder();a.push({id:zmail.zuid,name:"My Notes",display_text:"My Notes",tooltip:"My Notes"});for(var c=0,d=b.length;c<d;c++){var e={};e.id=b[c],e.name=znNote.getGroupName(b[c]),e.display_text=znNote.getGroupName(b[c]),e.tooltip=znNote.getGroupName(b[c]),a.push(e)}return a},getGroupName:function(a){return String(a)===zmail.zuid?"My Notes":znNote.groupObj[a]?znNote.groupObj[a].name:""},getCategoryArray:function(a){for(var b=[],c=0;c<znNote.catCacheObj[a].length;c++)b.push({id:znNote.catCacheObj[a][c].catId,display_text:znNote.catCacheObj[a][c].category,name:znNote.catCacheObj[a][c].category});return b},loadAndCategoryArray:function(a){var b=$.Deferred();return zNote.loadNoteCategories().done(function(){for(var c=[],d=0;d<znNote.catCacheObj[a].length;d++)c.push({id:znNote.catCacheObj[a][d].catId,display_text:znNote.catCacheObj[a][d].category,name:znNote.catCacheObj[a][d].category});b.resolve(c)}),b.promise()},getCat:b.getCat,getGroupCat:b.getGroupCat,createInlineNotes:d.showAdd,setGrpCat:c.setGrpCat,notei18n:g,getAttSlideArray:d.getAttSlideArray,sendNewCatReq:b.sendNewCatReq,sendNewLabReq:b.sendNewLabReq,getNotes:b.getNotes}}(),window.noteHashtag=function(){var a=[],b={checkForTrigger:function(a,c,d){(a.which&&35===a.which||a.keyCode&&35===a.keyCode)&&(d.initialCallback&&d.initialCallback(),a.preventDefault(),znBox.insertHtmlAtCaret("<input id=s1 value=# style='background-color:transparent;border:0px;outline:none'></input>"),$("#s1")[0].style.width="200px",$("#s1").trigger("focus",!0),zmMention.setCaretPosition(document.getElementById("s1"),document.getElementById("s1").value.length),zmMention.isAtPressed=!0,$("#s1").off("keyup").keyup(function(a){b.handleNoteTagFill(a,this,d)}),$("#s1").off("keypress").keypress(function(a){a.stopPropagation()}))},setContent:function(b,c,d){d=$(d).closest("li")[0],d||(d=$("#zm_afill .SC_Psli")[0]);var e=d.id,f=e.slice(3,e.length);c.callback(a[f]);var g=b.parentNode,h=document.createTextNode(a[f].hashname+" ");document.getElementById("s1").parentNode.replaceChild(h,document.getElementById("s1")),g.contentEditable=!0,setTimeout(function(){zmMention.placeCaretAfterNode(h),c.finallyCallback&&c.finallyCallback()},100),$("#zm_afill").remove()},handleKey:function(a,c,d){var e,f,g,h,i,j,k;return 40===c.keyCode?(e=$("#zm_afill li.SC_Psli"),e.removeClass("SC_Psli"),e.next().length?e.next().addClass("SC_Psli"):$("#zm_afill li").first().addClass("SC_Psli"),!0):38===c.keyCode?(e=$("#zm_afill li.SC_Psli"),e.removeClass("SC_Psli"),e.prev().length?e.prev().addClass("SC_Psli"):$("#zm_afill li").last().addClass("SC_Psli"),!0):13===c.keyCode?(c.stopImmediatePropagation(),b.setContent(c.target,d),!0):8===c.keyCode?(zmMention.getCaretPosition(a)||(f=a.parentNode,g=document.createTextNode(a.value),document.getElementById("s1").parentNode.replaceChild(g,document.getElementById("s1")),f.contentEditable=!0,f.focus(),setTimeout(function(){zmMention.placeCaretBeforeNode(g),d.finallyCallback&&d.finallyCallback()},100),$("#zm_afill").remove()),!0):37===c.keyCode?(zmMention.getCaretPosition(a)||(f=a.parentNode,g=document.createTextNode(a.value),document.getElementById("s1").parentNode.replaceChild(g,document.getElementById("s1")),f.contentEditable=!0,f.focus(),setTimeout(function(){zmMention.placeCaretBeforeNode(g),d.finallyCallback&&d.finallyCallback()},100),$("#zm_afill").remove()),!0):39===c.keyCode?(zmMention.getCaretPosition(a)===a.value.trim().length&&(f=a.parentNode,g=document.createTextNode(a.value),document.getElementById("s1").parentNode.replaceChild(g,document.getElementById("s1")),f.contentEditable=!0,f.focus(),setTimeout(function(){zmMention.placeCaretAfterNode(g),d.finallyCallback&&d.finallyCallback()},100),$("#zm_afill").remove()),!0):32===c.keyCode&&(h=zmMention.getCaretPosition(a),f=a.parentNode,i=a.value.substring(0,h),j=a.value.substring(h),k=document.createTextNode(i),document.getElementById("s1").parentNode.replaceChild(k,document.getElementById("s1")),f.contentEditable=!0,f.focus(),setTimeout(function(){zmMention.placeCaretAfterNode(k);var a=document.createTextNode(j);zmMention.insertNodeAtCaret(a),setTimeout(function(){zmMention.placeCaretAfterNode(k),d.finallyCallback&&d.finallyCallback()},100)},100),!0)},handleNoteTagFill:function(a,c,d){var e=b.handleKey(c,a,d),f=_zm("#","zm_afill");c.value.length?e||($("#zm_afill").remove(),b.constructListView(a,c,d)):_zm.remove(f),$(c).off("focusout.autofill").on("focusout.autofill",function(){_zm.remove(_zm("#","zm_afill")),d.finallyCallback&&d.finallyCallback()})},constructListView:function(a,c,d){var e=b.patternMatch1(d,c.value,!0);b.listSuggestions(c,d,e)},createAutoFillDiv:function(a,c,d,e,f){var g,h=$(a).offset().top+$(a).height()+5,i=$(a).offset().left,j=_zm("<","body")[0].getBoundingClientRect(),k=i+90>j.width?j.width-90-40:i,l=35*c.length;if(h+l+30>j.height){var m,n,o=_zm("#","ztb-topband"),p=h-l;g=o?o.getBoundingClientRect().height:0,m=p>0?g:zmUtil.wmsBarHeight(),n=Math.round((l+m+100-j.height)/35),n>0&&c.splice(c.length-n,n),h=h-l>0?$(a).offset().top-l-20:h}var q=_zm.getDOM(["DIV",{attrs:{id:"zm_afill",style:"top:"+h+"px;left:"+k+"px;","class":"SC_dd shw  SC_zi900",onmousedown:"zmUtil.stopEvents(event,true);"},child:[["DIV",{child:[["UL",{attrs:{"class":d}}]]}]]}]);return _zm("<","body")[0].appendChild(q),_zm.bind(q,"mousedown",function(c){b.setContent(a,f,c.target)},[]),_zm.show(q),_zm("#","zm_afill")},listSuggestions:function(b,c,d){a=d;var e,f,g,h="",i=_zm("#","zm_afill").querySelector("ul"),j=d.length;for(j||$("#zm_afill").remove(),e=0;e<j;e++)h=0===e?"SC_Psli":"",g="name",f=_zm.getDOM(["LI",{attrs:{id:"pos"+e,"class":h},child:[["text",d[e][g]]]}]),i.appendChild(f)},patternMatch1:function(a,b,c){var d,e,f=[],g=a.getContentArray(),h=g.length,i=a.compare,j=i.length,k=-1;for(d=0;d<h;d++){for(e=0;e<j;e++)if(k=i[e]&&g[d][i[e]]&&g[d][i[e]].toLowerCase().indexOf(b.toLowerCase()),k!==-1&&!c||c&&0===k){f.push(g[d]);break}if(f.length>10)break}return f}},c={setHashtag:function(a,c){$(c).off("keypress").keypress(function(c){b.checkForTrigger(c,this,a)})}};return c}(),function(){window.zNote=window.zNote||{},zNote.Models={},zNote.Views={},zNote.Collections={},zNote.noteCollection={},zNote.eventBus=_.extend({},Backbone.Events),zNote.notei18n=zmText.get("notes"),zNote.dialog=void 0,zNote.prev_shortcut_scope=void 0,zNote.unSavedData={};var a=function(a,b){return!(window.innerHeight<a.top+b.height||window.innerWidthwidth<a.left+b.width)},b=function(){var a;$.subscribe("stickyNoteMod",function(){var a=zNote.stickyNoteCollection.toJSON().map(function(a){var b={entityId:a.id,groupId:a.namespaceId};b.state=a.showStickyNote===!0?"open":"minimize";var c={top:a.top,left:a.left},d={width:a.width,height:a.height};return b.top=parseInt(c.top),b.left=parseInt(c.left),b.width=parseInt(d.width),b.height=parseInt(d.height),b});zmAdHocSettings.setNotes({stickyNotes:a})}),$.subscribe("notes/Notification",function(b,c){zNote.stickyNoteCollection&&zNote.stickyNoteCollection.where({id:c.eid}).length&&(a="string"==typeof c.group||c.group instanceof String?$.parseJSON(c.group).id:c.group.id,znBox.getNoteListForGivenIds({id:c.eid,groupId:a}).done(function(a){a[1].forEach(function(a){$.publish("stickyNotes/EditNotified",[a])})}))}),$.subscribe("zmailReconnect",function(a,b){if(zNote.stickyNoteCollection&&zNote.stickyNoteCollection.length){zmUtil.debugLog("Reconnect called. Updating sticky notes");var c=zNote.stickyNoteCollection.pluck("id"),d=zNote.stickyNoteCollection.pluck("namespaceId");b={id:c.join(","),groupId:d.join(",")},znBox.getNoteListForGivenIds(b).done(function(a){a[1].forEach(function(a){$.publish("stickyNotes/EditNotified",[a])})})}})};zNote.init=function(){$(zmail.win).mousedown(function(){$("#ngoto").remove()}),b(),zmNCenter.handlers.add("streams",function(a,b){b.etype===zNote.CONSTANTS.entityType&&"37"===b.ntype&&(zmUtil.debugLog("Notification for note edit. Updating stickyNotes"),$.publish("notes/Notification",[b]))})},zNote.getStickyNoteCollection=function(){return zNote.stickyNoteCollection instanceof zNote.Collections.Note?zNote.stickyNoteCollection:(zNote.stickyNoteCollection=new zNote.Collections.Note([]),zNote.stickyNoteCollection)},zNote.checkForstickyNote=function(){var a=zNote.stickyNoteCollection.length;zmsuite.getTabDOM().find(".notes-count").find("span").text(a),0===zNote.stickyNoteCollection.length&&($("#sNoteTab").remove(),$.publish("BOTTOM_ICONS_LIST_CHANGE"),zNote.dialog&&!zNote.dialog.isRemoved&&zNote.dialog.remove())},zNote.isStickyNote=function(a){return!!(zNote.stickyNoteCollection instanceof zNote.Collections.Note&&zNote.stickyNoteCollection.findWhere({id:a.id}))},zNote.addAsStickyNote=function(a,b){var c=a;c.type=b,c.showStickyNote=void 0===c.showStickyNote||c.showStickyNote;var d=function(a,b){zNote.stickyNoteCollectionView=a};if(zNote.stickyNoteCollection instanceof zNote.Collections.Note&&zNote.stickyNoteCollection.findWhere({id:c.id}))return void zNote.eventBus.trigger("openStickyNote",{namespaceId:c.namespaceId,id:c.id});if(zNote.stickyNoteCollection instanceof zNote.Collections.Note)$.publish("/note/addstickynote",c);else{var e=$('<div id="stickyNote"></div>');$("body").append(e),zNote.stickyNoteCollection=new zNote.Collections.Note(c,(void 0),{mode:"stickyNote"});var f={stickyNote:!0};ReactDOM.render(React.createElement(zNote.Views.NoteCollectionReact,{ref:d,extraOptions:f,noteList:zNote.stickyNoteCollection}),e[0]),zNote.stickyNoteCollection.on("remove",zNote.checkForstickyNote)}var g=zNote.stickyNoteCollection.length;0===zmsuite.getTabDOM().find(".msi-stickyNotes").length?(zmsuite.getTabDOM().find(".SC_exp ul").prepend("<li title='"+zNote.notei18n.tooltips.stickyNotes+"' id='sNoteTab'><div class='notes-count'><span>"+g+"</span><i class='msi-stickyNotes'></i></div></li>"),zmsuite.getTabDOM().find(".msi-stickyNotes").on("click",function(){if(!zNote.dialog||zNote.dialog.isRemoved===!0){var a=function(){zNote.dialog.isRemoved||(ReactDOM.unmountComponentAtNode(zNote.dialog.$els.$content[0]),zNote.dialog.isRemoved=!0,zNote.dialog.remove())},b=new zNote.Collections.Note(zNote.stickyNoteCollection.toJSON(),(void 0),{mode:"stickyNote"}),c={title:zNote.notei18n.allStickyNotes,mask:"none",contentWrapperClass:"SC_PU ztb-notesPopover",maskWrapperClass:"SC_Pop",defaultCloseIcon:!1,icons:{right:[[{"class":"msi-popout",callback:function(a,b){zNote.stickyNoteCollection.forEach(function(a){a.showNote(!0)})}},{"class":"msi-minus",callback:function(a,b){zNote.stickyNoteCollection.forEach(function(a){a.showNote(!1)})}}]]},closeAction:function(a){ReactDOM.unmountComponentAtNode(a.$els.$content[0]),a.isRemoved=!0},dialogDidMount:function(a){var c=zmsuite.getTabDOM().find(".msi-stickyNotes").offset().left,d=zmsuite.getTabDOM().find(".msi-stickyNotes").offset().top,e=zmsuite.getTabDOM().find(".msi-stickyNotes").height(),f=d+e;ReactDOM.render(React.createElement(zNote.Views.NoteListCollectionView,{noteList:b}),a.$els.$content[0]),a.$els.$rightHeader.find(".SCmb").addClass("puClose"),zmComponent.tooltip({elm:a.$els.$rightHeader.find(".msi-popout")[0],text:zNote.notei18n.tooltips.openallsticky,arrow:"top"}),zmComponent.tooltip({elm:a.$els.$rightHeader.find(".msi-minus")[0],text:zNote.notei18n.tooltips.minimizeallsticky,arrow:"top"}),a.$els.$positionWrapper.css("position","absolute"),a.$els.$positionWrapper.css("right",$("body").width()-c+"px"),a.$els.$positionWrapper.css("bottom",$("body").height()-f+"px")}};$.publish("/mail/menuCreated",{menuHandler:a}),zNote.dialog=Dialog["new"](c)}}),$.publish("BOTTOM_ICONS_LIST_CHANGE")):zmsuite.getTabDOM().find(".notes-count").find("span").text(g)},zNote.listNotes=function(a,b,c,d){var e;if(b.isnew){var f=new zNote.Collections.Note(a[0].Notes,{page:a[0].page},{mode:b.mode,id:b.id,groupId:b.groupId},c);e=ReactDOM.render(React.createElement(zNote.Views.NoteCollectionReact,{noteList:f}),c[0])}else d.props.noteList.add(a[0].Notes,{silent:!0}),d.props.noteList.options.page=a[0].page,d.forceUpdate(),e=d;return e},zNote.openNoteInPreview=function(a){var b=zmsuite.getCenter()[1].getNodes();zmsuite.getCenter()[1].$el.html("");var c="",d=[];d.push({tooltip:"prev",iconClass:"msi-prev",data:"prev"}),d.push({tooltip:"next",iconClass:"msi-next",data:"next"}),d.push({tooltip:"close",iconClass:"msi-close",data:"close"});var e={text:c,rIcons:[d]};b[0].push(e),b[0].setListener("click",function(a){"close"===a||"clsPrev"===a.action?($.publish(zmStreamsApp.constants.removeNotificationPreview,zmsuite.getCenter()[1].$el),zmStreamsApp.util.closePreview()):"prev"===a||"msi-prev"===a.action||"next"===a||"msi-next"===a.action}),zNote.getNoteDetails(a).done(function(a){var c=a[1],d=$("<div class='SC_notePreview'></div>"),e=$("<div class='postMsg'></div>"),f=new zNote.Models.previewNote(c),g={previewCard:"true",disableShortcuts:"true"};ReactDOM.render(React.createElement(zNote.Views.NotePreview,{options:g,note:f}),e[0]),zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:d,viewPost:!0,fixedComment:!1,isPreview:!1,response:c,hideContent:!0}),d.find(".SCS_postHead").after(e),b[1].push(d[0]),zmsuite.getCenter()[1].show()})})},zNote.listRowNotes=function(a,b,c,d){var e;b.isnew?1===b.noteView?(e=new zNote.Collections.Note(a[0].Notes,{page:a[0].page},{mode:b.mode,id:b.id,groupId:b.groupId},c),ReactDOM.render(React.createElement(zNote.Views.NoteCollectionReact,{noteList:e,ref:d}),c[0])):(e=new zNote.Collections.Note(a[0].Notes,{page:a[0].page},{mode:b.mode,id:b.id,groupId:b.groupId,source:"noteApp"},c),ReactDOM.render(React.createElement(zNote.Views.NoteListCollectionView,{noteList:e,ref:d}),c[0])):(b.currentObj.props.noteList.add(a[0].Notes,{silent:!0}),b.currentObj.props.noteList.options.page=a[0].page,b.currentObj.forceUpdate())},zNote.getNoteList=function(a,b,c,d){zNote.loadNoteCategories().done(function(){var e=new zNote.Collections.Note(a[0].Notes,b.options,b.listInfo);ReactDOM.render(React.createElement(zNote.Views.NoteListCollectionView,{noteList:e,ref:d}),c[0])})},zNote.dropKeyBoardShortcuts=function(){zmComponent.keybindings.dropScope("notepopup"),zmComponent.keybindings.setScope(zNote.prev_shortcut_scope)},zNote.removeNoteFromView=function(a){var b=$.Deferred();ReactDOM.unmountComponentAtNode(a),b.resolve().promise()},zNote.setKeyBoardShortcuts=function(a){zNote.prev_shortcut_scope=zmComponent.keybindings.getScope();var b={allowDefaultScope:!1,shortcuts:[{uid:"close",keyStr:"esc",actions:[function(){a.esc()}]}],scope:"notepopup"};zmComponent.keybindings.registerAll(b),zmComponent.keybindings.setScope("notepopup")},zNote.loadNoteCategories=function(){var a=$.Deferred();return $.isEmptyObject(znNote.catCacheObj)?(znNote.groupObj=zmCont.getGroup(),znNote.groupObj[zmail.zuid]={name:zmText.get("notes").myNotes},znNote.getCat().done(function(b){znNote.catCacheObj[zmail.zuid]=b[1][0].Category,znNote.myNotesCount=b[1][0].noteCount,znNote.isMigrated=b[1][0].isMigratedUser,znNote.getGroupCat().done(function(b){znNote.setGrpCat(b[1]),a.resolve()}).fail(function(){a.reject()})}).fail(function(){a.reject()}),a.promise()):a.resolve()},zNote.openNote=function(a,b){var c=a.noteData,d=a.previewCard,e=new zNote.Models.previewNote(c);if(d===!0){b&&$(b).find(".postMsg").length&&zNote.removeNoteFromView($(b).find(".postMsg")[0]),b.html("");var f=$("<div class='SC_notePreview'></div>"),g=$("<div class='postMsg'></div>"),h={previewCard:"true",disableShortcuts:"true"};ReactDOM.render(React.createElement(zNote.Views.NotePreview,{options:h,note:e}),g[0]),zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:f,viewPost:!0,fixedComment:!1,isPreview:!1,response:c,hideContent:!0}),f.find(".SCS_postHead").after(g),b.append(f)})}else ReactDOM.render(React.createElement(zNote.Views.NotePreview,{note:e}),b[0])},zNote.getNoteDetails=function(a){var b={mode:"singlePost",actionType:"viewGroupEntity",groupId:a.namespaceId,entityId:a.id,entityType:zNote.CONSTANTS.entityType,allComments:!0,fixedComment:!0,streamsView:!0};return zmAjq.XHR({u:zmail.conPath+"/stream.do",t:"POST",p:b})},zNote.printNote=function(a){zNote.getNoteDetails(a).done(function(a){var b=a[1],c=$("<div id=noteBox></div>"),d=new zNote.Models.previewNote(b),e={print:!0};ReactDOM.render(React.createElement(zNote.Views.NotePreview,{options:e,note:d}),c[0]);var f=$("<div class=SCS_prnCmnt></div>"),g=b.act.likedby?_.toArray(b.act.likedby.split(", ")):[],h={by:b.gnrl.by,id:b.notes.id,etype:zNote.CONSTANTS.entityType,groupId:b.gnrl.group.id,showinvite:b.myact.showinvite,like:b.myact.like,invitee:parseInt(b.act.invitees),likes:parseInt(b.act.likes),inviteeList:b.myact.inviteeList,lockInvites:b.gnrl.lockInvites,likeList:g,isPrint:!0};b.gnrl.group.isGroup?h.actionType="viewGroupEntity":h.actionType="viewSelfData",zmUtil.requireStreamsApp().done(function(){f.append(zmStreamsApp.PostActions.init(h))});var i=_.size(b.myact.inviteeList)?b.myact.inviteeList:[],j={comments:b.cmnt,id:b.notes.id,isShare:!1,fixedComment:!1,groupId:b.gnrl.group.id,etype:zNote.CONSTANTS.entityType,owner:b.gnrl.by,inviteeList:i};zmUtil.requireStreamsApp().done(function(){j.mentions=zmStreamsApp.util.getMentionList(b),f.append(zmStreamsApp.CommentModule.init(j))});var k=$("<div id=printnote class=SC_prntNotes></div>");$("body").append(),zmUtil.requireStreamsApp().done(function(){var a=zmStreamsApp.PostApp.singlePost({viewPost:!0,fixedComment:!1,isPreview:!1,response:b,hideContent:!0,isPrint:!0});k.append(a),k.append(c),k.append(f);var d=function(){var a=k[0].cloneNode(!0);zmail.Printer.print({title:zNote.notei18n.print,content:a,css:["streams.css","notes.css"]}),setTimeout(function(){ReactDOM.unmountComponentAtNode(c[0]),k.remove()},1e3)};d()})})},zNote.viewNote=function(a){var b,c,d=this;zNote.getNoteDetails(a).done(function(e){if(0===e[0])return void $.publish("zm/framework/dialogClosed");var f=e[1],g=$('<div id="nmask" class="SC_Pop tra SC_cent" style="pointer-events:auto"><div class="SCmb puClose nPuClose" id="nclose"><ul><li><b><span class="SC_ttip ttr"><i class="msi-close"></i></span></b></li></ul></div><div class="SC_pe"><div class="SC_peCen" id="noteBox"></div></div></div>'),h=$('<div id="colorMask" style="z-index:101" class="SC_Pop tra">');$("body").append(h),$("body").append(g);var i=$(g).innerHeight()-50,j=$(g).innerWidth()-50,k=function n(){
g.remove(),h.remove(),zNote.eventBus.off("removeMask",n,d),zmUtil.hideMenu(),zNote.dropKeyBoardShortcuts()};b=function(){h.removeClass("blk").addClass("tra"),g.find(".SCS_post").hide(),g.find(".zn_popNote").removeClass("zn_popNote"),setTimeout(function(){zmStreamsApp.util.detachAndRemove(g.find(".SC_ScrollY")).always(function(){$.publish("zm/framework/dialogClosed"),ReactDOM.unmountComponentAtNode(g.find("#noteBox")[0]),g.remove(),h.remove(),zNote.dropKeyBoardShortcuts(),zNote.eventBus.off("removeMask",k,d),$.unsubscribe("zm/closeAllOpenDialog",b),zmUtil.hideMenu()})})};var l=new zNote.Models.previewNote(f);c=ReactDOM.render(React.createElement(zNote.Views.NotePreview,{removeNotePreview:b,note:l}),g.find("#noteBox")[0]),g.find("#nclose").on("click",function(){b()}),$.subscribe("zm/closeAllOpenDialog",b),zNote.eventBus.on("removeMask",k,d),ReactDOM.findDOMNode(c.refs.notebox).style.left="-4000px";var m=$('<div class=""><div class=""><div class="SC_ScrollY"></div></div></div>');zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:m.find(".SC_ScrollY"),viewPost:!0,fixedComment:!1,isPreview:!1,response:f,hideContent:!0})}),setTimeout(function(){var d=i-($(ReactDOM.findDOMNode(c.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(c.refs.desc.refs.content)).height());$(ReactDOM.findDOMNode(c.refs.desc.refs.content)).css("height",d-60),$(ReactDOM.findDOMNode(c.refs.desc.refs.content)).css("max-height",d),$(ReactDOM.findDOMNode(c.refs.desc.refs.content))[0].style.overflow="hidden",$(ReactDOM.findDOMNode(c.refs.desc.refs.content))[0].style.overflowY="auto",g.find(".SC_pe").css("max-height",i),g.find(".SC_pe").css("min-width",j-200),g.find(".SC_pe").css("max-width",j-200),ReactDOM.findDOMNode(c.refs.notebox).style.left="0px",m.find(".SC_ScrollY").css("max-height",i),g.find("#noteBox").append(m),h.removeClass("tra").addClass("blk"),zNote.setKeyBoardShortcuts({esc:b}),zmHash.setHash("notes",["preview",a.namespaceId,a.id])},100)})},zNote.addNoteAutoSave=function(a){var b,c,d,e=this,f=$('<div id="nmask" class="SC_Pop tra SC_cent" style="pointer-events:auto"><div class="SCmb puClose nPuClose" id="nclose"><ul><li><b><span class="SC_ttip ttr"><i class="msi-close"></i></span></b></li></ul></div><div class="SC_pe"><div class="SC_peCen" id="noteBox"></div></div></div>'),g=$('<div id="colorMask" style="z-index:101" class="SC_Pop tra">');$("body").append(g),$("body").append(f);var h=$(f).innerHeight()-50,i=$(f).innerWidth()-50,j=_.random(0,3);a.notes.color=j;var k=new zNote.Models.previewNote(a),l=function(){c&&(f.find(".SC_pe").animate({"min-width":i-550,"max-width":i-550},{always:function(){c.find(".SC_ScrollY").removeClass("SC_dyn")}}),$(ReactDOM.findDOMNode(d.refs.notebox)).animate({"margin-right":"0%"},{always:function(){f.find(c).remove()}}))},m=function(a){c=$('<div><div><div class="SC_ScrollY"></div></div></div>'),zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:c.find(".SC_ScrollY"),viewPost:!0,fixedComment:!1,isPreview:!1,response:a,hideContent:!0}),c.find(".SC_ScrollY").css("max-height",h),f.find("#noteBox").append(c),f.find(".SC_pe").animate({"min-width":i-200,"max-width":i-200},{always:function(){c.find(".SC_ScrollY").removeClass("SC_dyn")}}),$(ReactDOM.findDOMNode(d.refs.notebox)).animate({"margin-right":"35%"}),k.hideStream()})},n=function o(){f.remove(),g.remove(),zNote.eventBus.off("removeMask",o,e),zmUtil.hideMenu(),zNote.dropKeyBoardShortcuts(),$.unsubscribe("zm/closeAllOpenDialog",b)};d=ReactDOM.render(React.createElement(zNote.Views.NotePreview,{note:k,showStreamsBar:m,removeStreamsBar:l}),f.find("#noteBox")[0]),b=function(){g.removeClass("blk").addClass("tra"),f.find(".SCS_post").hide(),f.find(".zn_popNote").removeClass("zn_popNote"),setTimeout(function(){ReactDOM.unmountComponentAtNode($(ReactDOM.findDOMNode(d.refs.notebox)).parent()[0]),f.remove(),g.remove(),zNote.dropKeyBoardShortcuts(),zNote.eventBus.off("removeMask",n,e),zmUtil.hideMenu(),$.unsubscribe("zm/closeAllOpenDialog",b)})},f.find("#nclose").on("click",function(){b()}),$.subscribe("zm/closeAllOpenDialog",b),zNote.eventBus.on("removeMask",n,e),ReactDOM.findDOMNode(d.refs.notebox).style.left="-4000px",setTimeout(function(){var a=h-($(ReactDOM.findDOMNode(d.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(d.refs.desc.refs.content)).height());$(ReactDOM.findDOMNode(d.refs.desc.refs.content)).css("height",a-60),$(ReactDOM.findDOMNode(d.refs.desc.refs.content)).css("max-height",a),$(ReactDOM.findDOMNode(d.refs.desc.refs.content))[0].style.overflow="hidden",$(ReactDOM.findDOMNode(d.refs.desc.refs.content))[0].style.overflowY="auto",f.find(".SC_pe").css("max-height",h),f.find(".SC_pe").css("min-width",i-550),f.find(".SC_pe").css("max-width",i-550),ReactDOM.findDOMNode(d.refs.notebox).style.left="0px",ReactDOM.findDOMNode(d.refs.notebox).style.marginRight="0px",g.removeClass("tra").addClass("blk"),zNote.setKeyBoardShortcuts({esc:b})},100)},zNote.loadAndOpenNote=function(a){zNote.loadNoteCategories().done(function(){zNote.viewNote(a)})},zNote.getNewNote=function(a,b){var c=_.random(0,3);zmCont.isGroup(a.namespaceId)||a.namespaceId===zmail.zuid||(a.namespaceId=zmail.zuid,a.catId=znNote.getGeneralCatId(a.namespaceId));var d=new zNote.Models.addNote({addparams:a.addparams,desc:a.desc,title:a.title,namespaceId:a.namespaceId,catId:a.catId,attEntObj:a.attEntObj,color:c});ReactDOM.render(React.createElement(zNote.Views.addNoteViewReact,{ref:b.ref,addCallback:a.addCallback,cancelCallback:a.cancelCallback,streams:b.streams,noAddCancel:b.noAddCancel,note:d}),b.mountingElem[0])},zNote.addNote=function(a){var b,c,d=$.extend(!0,{},a),e=$('<div id="nmask" style="z-index:101" class="SC_Pop blk SC_cent"><div class="SCmb puClose" id="nclose"><ul><li><b><span class="SC_ttip ttr"><i class="msi-close"></i></span></b></li></ul></div><div class="SC_pe"><div class="SC_peCen" id="noteBox"></div></div></div>');$("body").append(e),c=function(){ReactDOM.unmountComponentAtNode(e.find("#noteBox")[0]),$("#nmask").remove(),zNote.eventBus.off("removeMask",c),zNote.dropKeyBoardShortcuts()},d.addCallback=function(){a.addCallback&&a.addCallback(),c(b)},e.find("#nclose").on("click",function(){b.checkDataAlert(c)});var f=function(a){b=a};zNote.getNewNote(d,{mountingElem:e.find("#noteBox"),ref:f}),zNote.eventBus.on("removeMask",c);var g=$(e).innerHeight(),h=$(e).innerWidth(),i=g-($(ReactDOM.findDOMNode(b.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(b.refs.content)).height());$(ReactDOM.findDOMNode(b.refs.content)).css("max-height",i-100),$(ReactDOM.findDOMNode(b.refs.content)).css("min-height",.4*i),ReactDOM.findDOMNode(b.refs.notebox).style.marginRight="0px",ReactDOM.findDOMNode(b.refs.content).style.overflow="hidden",ReactDOM.findDOMNode(b.refs.content).style.overflowY="auto",e.find(".SC_pe").css("min-height",.5*g),e.find(".SC_pe").css("max-height",g),e.find(".SC_pe").css("min-width",.5*h),e.find(".SC_pe").css("max-width",.5*h),zNote.setKeyBoardShortcuts({esc:b.checkDataAlert.bind(b,c)})},zNote.getSelectedTextWithin=function(a){var b="";if("undefined"!=typeof window.getSelection){var c,d=window.getSelection();if((c=d.rangeCount)>0)for(var e,f=document.createRange(),g=0;g<c;++g)f.selectNodeContents(a),e=d.getRangeAt(g),1===e.compareBoundaryPoints(f.START_TO_END,f)&&e.compareBoundaryPoints(f.END_TO_START,f)===-1&&(1===e.compareBoundaryPoints(f.START_TO_START,f)&&f.setStart(e.startContainer,e.startOffset),e.compareBoundaryPoints(f.END_TO_END,f)===-1&&f.setEnd(e.endContainer,e.endOffset),b+=f.toString())}else if("undefined"!=typeof document.selection&&"Text"===document.selection.type){var h=document.selection.createRange(),i=h.duplicate();i.moveToElementText(a),1===h.compareEndPoints("EndToStart",i)&&h.compareEndPoints("StartToEnd",i)===-1&&(1===h.compareEndPoints("StartToStart",i)&&i.setEndPoint("StartToStart",h),h.compareEndPoints("EndToEnd",i)===-1&&i.setEndPoint("EndToEnd",h),b=i.text)}return b},zNote.loadAddNote=function(a,b){var c=a?a.addparams:void 0,d=a?a:{},e=d.groupId||zmail.zuid,f=d.attEntObj||[];b&&b.richText?znBox.convertImageToInlineImages(d.descHTML).done(function(a){zNote.loadNoteCategories().done(function(){b&&b.mountingElem?zNote.getNewNote({addparams:c,addCallback:d.addCallback,cancelCallback:d.cancelCallback,desc:a,title:d.title,namespaceId:e,attEntObj:f,catId:znNote.getGeneralCatId(e)},{mountingElem:b.mountingElem,noAddCancel:!0,ref:b.doneCallback}):zNote.addNote({addparams:c,desc:a,addCallback:d.addCallback,title:d.title,namespaceId:e,attEntObj:f,catId:znNote.getGeneralCatId(e)})})}):zNote.loadNoteCategories().done(function(){b&&b.mountingElem?zNote.getNewNote({addparams:c,addCallback:d.addCallback,cancelCallback:d.cancelCallback,desc:d.desc,title:d.title,namespaceId:e,attEntObj:f,catId:znNote.getGeneralCatId(e)},{mountingElem:b.mountingElem,noAddCancel:!0,streams:!0,ref:b.doneCallback}):zNote.addNote({addparams:c,desc:d.desc,addCallback:d.addCallback,title:d.title,namespaceId:e,attEntObj:f,catId:znNote.getGeneralCatId(e)})})},zNote.addNoteValidations=function(a,b){var c=b||{};return a.title&&a.title.length>100?(_zm.succErrMsg("e",zNote.notei18n.titexceed),!0):a.desc&&a.desc.length>65e3?(_zm.succErrMsg("e",zNote.notei18n.contexceed),!0):c.allowEmpty||void 0===a.desc||0!==a.desc.trim().length?!c.allowEmpty&&void 0!==a.richTextSummary&&0===znBox.domParser(znBox.getContentEditableTextFromHTML(a.richTextSummary)).trim().length&&(_zm.succErrMsg("e",zNote.notei18n.descempty),!0):(_zm.succErrMsg("e",zNote.notei18n.descempty),!0)},zNote.convertStreamsFormatToNotes=function(a,b,c,d){var e=$.isArray(a[1])?a[1]:[a[1]];return zNote.listNotes(e,b,$(c),d)},zNote.getNoteDataInListFormat=function(a){var b={};b.id=a.notes.id,b.title=a.notes.title,b.cat=a.notes.catid,b.desc=a.notes.notecont,b.namespaceId=a.gnrl.group.id,b.starred=a.notes.starred,b.color=a.notes.color,b.summary=a.notes.desc,b.ownerZUID=a.gnrl.by,b.email=$.extend(!0,{},a.notes.email),b.commentCount=a.cmnt.total,b.tagId=a.myact.label.slice(0),b.disptime=a.gnrl.cdate,b.starred=a.myact.starred,b.attachments=[];for(var c=0;c<a.attach.length;c++){var d=a.attach[c],e={};d.inline||(e[d.id]={Id:d.id,s:d.size,fn:d.name,ft:d.ft,p:d.part},b.attachments.push(e))}return b},zNote.streamListNote=function(a,b){var c=new zNote.Models.previewNote(a);ReactDOM.render(React.createElement(zNote.Views.NotePreview,{note:c,streamList:!0}),b[0])},zNote.getNoteSearchQuery=function(a){var b={};return b.start=0,b.limit=10,b.search=a.data[0].value,b.streamsView="Notes",b.mode="searchNotes",b.isPrev=!1,b.groupId=zmail.zuid,b.actionType="viewSelfData",b.entityType=2,b},zNote.updateLinks=function(a){var b=znBox.saveSelectionNew(a);$(a).html(zNote.linkify(znBox.domParser(znBox.getContentEditableText($(a)))).replace(/\n/g,"<br />")),znBox.restoreSelectionNew(a,b)},zNote.disable=function(a){var b=!0;if(a.ctrlKey||a.metaKey)switch(a.keyCode){case 66:case 98:b=!1;break;case 73:case 105:b=!1;break;case 85:case 117:b=!1}return b},zNote.linkify=function(a){if(a){var b,c;return c=/((href|src)=["']|)((?=http|https)[\S]*:\/\/[\S]+)|(www\.[\S]+)/gi,b=a.replace(c,function(a,b){return arguments[2]?arguments[0]:arguments[3]?'<a href="'+arguments[0]+'" target="_blank">'+arguments[0]+"</a>":'<a href="http://'+arguments[0]+'" target="_blank">'+arguments[0]+"</a>"})}return""},zNote.checkForPrintableKeys=function(a){return"undefined"==typeof a.which||(!(a.ctrlKey||a.metaKey||a.altKey||8===!a.which||13===!a.which)||void 0)},zNote.restoreStickyNotes=function(){var b=zmAdHocSettings.getNotes(),c=_.pluck(b.stickyNotes,"entityId"),d=_.pluck(b.stickyNotes,"groupId"),e={id:c.join(","),groupId:d.join(",")};znBox.getNoteListForGivenIds(e).done(function(c){zNote.loadNoteCategories().done(function(){c[1].forEach(function(c){var d=_.findWhere(b.stickyNotes,{entityId:c.id});c.showStickyNote="open"===d.state,c.left=d.left,c.top=d.top,c.height=d.height,c.width=d.width,a({top:c.top,left:c.left},{height:c.height,width:c.width})||(c.left=void 0,c.top=void 0),zNote.addAsStickyNote(c,"restore")})})})},zNote.getSmartNote=function(a,b,c){var d=$.Deferred(),e={};return zNote.loadNoteCategories().done(function(){var f=c.cmpId?c.cmpId:c.noteView.model.get("id");if(c.noteView&&c.noteView.model instanceof Backbone.Model)c.noteView.setEditor({editor:b}),c.noteView.render(),d.resolve(c.noteView);else{e.id=f,e.groupId=c.noteView&&c.noteView.groupId?c.noteView.groupId:zmail.zuid,e.color=_.random(0,3),e.catId=znNote.getGeneralCatId(e.groupId);var g=new zNote.Models.addSmartNote(e),h=new zNote.Views.addNote({model:g,editor:b,dom:a});d.resolve(h)}}),d.promise()},zNote.init()}(),zNote.CONSTANTS=zNote.CONSTANTS||{},zNote.CONSTANTS.entityType="2",zNote.CONSTANTS.COLOR={zn_clr1:"0",zn_clr2:"1",zn_clr3:"2",zn_clr4:"3"},zNote.CONSTANTS.MAXCHARACTER={TITLE:100},zNote.CONSTANTS.COLORCODE={0:"zn_clr1",1:"zn_clr2",2:"zn_clr3",3:"zn_clr4"},zNote.CONSTANTS.COLORNAME={0:"Blue",1:"Green",2:"Yellow",3:"Red"},zNote.CONSTANTS.NOTECOLOR=[{value:"0",dispname:"Blue"},{value:"1",dispname:"Green"},{value:"2",dispname:"Yellow"},{value:"3",dispname:"Red"}],zNote.CONSTANTS.listTypeClass={1:"msi-thumbview",2:"msi-listview"},zNote.CONSTANTS.hashUrl={},zNote.CONSTANTS.hashUrl.type={c:"group",l:"tags",fav:"views",sharedtome:"views"},zNote.CONSTANTS.hashUrl.typeCode={group:"c",tags:"l",favourites:"views",sharedtome:"views"},zNote.CONSTANTS.hashUrl.folId={fav:"favourites",sharedtome:"sharedtome"},zNote.CONSTANTS.hashUrl.folIdCode={favourites:"fav",sharedtome:"sharedtome"},function(){var a=zmsuite.createAppRouter();window.zNote=window.zNote||{},window.zNote.RouteHelper=a;var b=function(a){if("preview"===a[0])zmUtil.loadNotes("openNote",{gId:a[1],e:a[2]});else{var b={};b.hashParams=a,b.data={router:!0},zmAppLoader.load("notes").done(function(){zmApp.showApp("n",b)})}return!0},c=function(a){var c,d=this;return zmail.postJsDeffered.done(function(){c=b.call(d,a)}),{updateParams:c}},d=function(){a.initialize({hashKey:"notes",handler:c}),a.activate()};d()}(),function(){zNote.Models=zNote.Models||{},zNote.Models.Note=Zmail.Model.extend({initialize:function(){zNote.eventBus.on("editNote",this.updateModel,this),this.triggerUpdateModelSubscription=this.triggerUpdateModel.bind(this),this.renameNoteCatSubscription=this.renameNoteCat.bind(this),this.handleEditedStickyNoteSubscription=this.handleEditedStickyNote.bind(this),$.subscribe("/rename/notescat",this.renameNoteCatSubscription),$.subscribe("/rename/noteslabel",this.renameNoteCatSubscription),$.subscribe("/delete/noteslabel",this.renameNoteCatSubscription),$.subscribe("zmstreamsapp/addLabel",this.triggerUpdateModelSubscription),$.subscribe("/streams/comment",this.triggerUpdateModelSubscription),void 0!==this.get("showStickyNote")&&(zNote.eventBus.on("openStickyNote",this.openStickyNote,this),this.on("change:showStickyNote",function(a){$.publish("stickyNoteMod")}),$.subscribe("stickyNotes/EditNotified",this.handleEditedStickyNoteSubscription),$.subscribe("zmailReconnect",this.handleEditedStickyNoteSubscription))},handleEditedStickyNote:function(a,b){var c=this;b.id===c.get("id")&&c.set(b)},triggerUpdateModel:function(a,b){var c,d={};b.id&&b.id.indexOf("#")!==-1?(d.id=b.id.slice(b.id.indexOf("#")+1,b.id.length),d.id===this.get("id")&&(void 0!==b.starred?(d.starred=b.starred,c={id:b.id,p:d},zNote.eventBus.trigger("editNote",self,{id:d.id,cattribute:"starred",p:d})):b.isAddLabel===!0?(c=b.label,zNote.eventBus.trigger("editNote",self,{id:d.id,cattribute:"addLabel",p:c})):b.isAddLabel===!1&&(c=b.label,zNote.eventBus.trigger("editNote",self,{id:d.id,cattribute:"removeLabel",p:c})))):b.entityId===this.get("id")&&zNote.eventBus.trigger("editNote",self,{id:b.entityId,cattribute:"commentCount",p:{commentCount:b.total}})},updateModel:function(a,b){var c=this;if(b.id===c.get("id"))if("title"===b.cattribute)c.set(b.cattribute,znBox.revSpCharRep(b.p.title));else if("category"===b.cattribute)c.set("cat",b.p.catId);else if("color"===b.cattribute)c.set("color",b.p.color);else if("desc"===b.cattribute)c.set("desc",b.p.desc);else if("starred"===b.cattribute)c.set("starred",b.p.starred);else if("addLabel"===b.cattribute)c.set("tagId",b.p);else if("removeLabel"===b.cattribute)c.set("tagId",b.p);else if("commentCount"===b.cattribute)c.set("commentCount",b.p.commentCount);else if("removeAttachment"===b.cattribute){var d=c.get("attachments").slice();$.each(d,function(a,c){if(c[b.p.attachId])return d.splice(a,1),!1}),c.set("attachments",d),c.trigger("change")}else if("addAttachment"===b.cattribute){var e=c.get("attachments")?c.get("attachments").slice():[],f=e.concat(b.p.attachments);c.set("attachments",f),c.trigger("change")}},openStickyNote:function(a){var b=this;a.id===b.get("id")&&(this.get("showStickyNote")===!0?this.trigger("change:addedagain"):this.showNote(!0))},renameNoteCat:function(a,b){"/rename/noteslabel"!==a.type&&"/delete/noteslabel"!==a.type||this.get("tagId").indexOf(b.labId)!==-1&&("/delete/noteslabel"===a.type&&this.trigger("change:renamenotecat"),"/delete/noteslabel"===a.type&&this.removeTagDone(b.labId)),this.get("cat")===b.catId&&this.trigger("change:renamenotecat")},stopSubscriptions:function(){zNote.eventBus.off("editNote",this.updateModel,this),zNote.eventBus.off("openStickyNote",this.openStickyNote,this),this.off(),$.unsubscribe("zmstreamsapp/addLabel",this.triggerUpdateModelSubscription),$.unsubscribe("/streams/comment",this.triggerUpdateModelSubscription),$.unsubscribe("/rename/notescat",this.renameNoteCatSubscription),$.unsubscribe("/rename/noteslabel",this.renameNoteCatSubscription),$.unsubscribe("/delete/noteslabel",this.renameNoteCatSubscription),$.unsubscribe("notes/Notification",this.handleEditedStickyNoteSubscription),$.unsubscribe("zmailReconnect",this.handleEditedStickyNoteSubscription)},deleteNote:function(){var a=this,b={entityId:this.get("id"),mode:"delNote",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"delEntity",entityType:"2"},c=b;c.cat=this.get("cat"),Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:b,success:function(){$.publish("/note/delete",[a.get("id"),a.get("namespaceId")]),$.publish("note/deleteNote",[{pid:a.get("id"),gid:a.get("namespaceId")}]),$.publish("note/updateCount",b)}})},saveTitle:function(a){var b=this;if(a=a||"",a!==this.get("title")){a.trim().length||(a=znBox.CONTS.defaultTitle);var c={title:a,entityId:this.get("id"),mode:"editNTitle",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"changeEntity",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(){zNote.eventBus.trigger("editNote",b,{id:c.entityId,cattribute:"title",p:c})}})}},changeGroup:function(a){var b=this,c={toNamespace:a,entityId:this.get("id"),mode:"changeGroup",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"addEntity",entityType:zNote.CONSTANTS.entityType,deleteOriginal:!0},d=c;d.cat=b.get("cat"),Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(a){var b=zNote.getNoteDataInListFormat(a[0].data);$.publish("/note/delete",[c.entityId,c.groupId]),$.publish("note/updateCount",d),$.publish("/note/add",[b]),$.publish("note/updateCount",[{mode:"addNote",cat:b.cat,namespaceId:b.namespaceId}])}})},changeBook:function(a){var b=this,c=this.get("cat"),d={catId:a,entityId:this.get("id"),mode:"moveNote",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"changeEntity",entityType:"2"},e=d;e.pCatId=c,Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:d,success:function(){zNote.eventBus.trigger("editNote",b,{id:d.entityId,cattribute:"category",p:d}),$.publish("note/updateCount",e)}})},attachFiles:function(a,b,c){var d=this.get("namespaceId"),e=this.get("id"),f=a,g=f.files[0];if(g){var h=g.size;if(h&&h>=10485760)return void zmsDialog.alert(notei18n.filesizeexceed);var i=g.name;if(/[<>]/g.test(i))return void _zm.succErrMsg("e",notei18n.filenamespl);var j=new FormData,k=zmAjq.getCookie("zmcsr");g&&j.append("attach",g),j.append("groupId",d),j.append("zmrcsr",k),j.append("mode","addAttach"),j.append("entityId",e),j.append("actionType","addEntity"),j.append("streamsView","Notes"),j.append("entityType","2"),"image"===b&&j.append("inLine","true");var l={};if(l.ep={id:e,groupId:d},"attachment"===b)l.fn=this.addAttachment.bind(this);else{if(!/(\.(gif|jpg|jpeg|png))$/i.test(i))return zmsDialog.alert(notei18n.imgSelect),!1;l.fn=c}this.formSubmit(j,l)}},formSubmit:function(a,b){var c=new XMLHttpRequest;c.open("POST",zmail.conPath+"/NotesAction.do?mode=addAttach",!0),c.onreadystatechange=function(){if(4===c.readyState&&200===c.status&&b.fn){var a=$.parseJSON(c.responseText);"object"==typeof a&&(1===a[0]?b.fn&&b.fn(a[1],b.ep):zmInit.notificationBand.failure({msg:a[1].msg}))}},c.send(a)},saveAttachment:function(a){var b,c=this,d=[],e=[],f={mode:"addAttach",entityId:this.get("id"),groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"addEntity",entityType:"2"};if(a.tempLocation){for(var g=0;g<a.tempLocation.length;g++)d.push(a.tempLocation[g].fP),e.push(a.tempLocation[g].sN);f.attachname=d,f.attachstore=e}a.myAttachment&&(b=JSON.stringify(a.myAttachment),f.attEntObj=b),Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:f,success:function(a){zNote.eventBus.trigger("editNote",c,{id:f.entityId,cattribute:"addAttachment",p:a[0]})}})},addAttachment:function(a){zNote.eventBus.trigger("editNote",self,{id:this.get("id"),cattribute:"addAttachment",p:a[0]})},delAtt:function(a,b){$.publish("attachment/closeSlideshow");var c=this,d={mode:"delAttach",entityId:this.get("id"),groupId:this.get("namespaceId"),attachId:b,streamsView:"Notes",actionType:"delEntity",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:d,success:function(){zNote.eventBus.trigger("editNote",c,{id:d.entityId,cattribute:"removeAttachment",p:d})}})},saveDescription:function(a){var b=this;if(a!==this.get("desc")&&(0!==a.trim().length||a.trim()!==this.get("desc"))){var c={desc:a,entityId:this.get("id"),mode:"editNContent",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"changeEntity",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(){zNote.eventBus.trigger("editNote",b,{id:c.entityId,cattribute:"desc",p:c})}})}},sendAsMail:function(){var a={},b=[];if(a.SUBJECT=this.get("title"),a.CONTENT=this.get("desc").replace(/\n/g,"<br/>"),this.get("attachments")&&this.get("attachments").length){for(var c=this.get("attachments").length,d=0;d<c;d++){var e=this.get("attachments")[d];for(var f in e){var g={gId:this.get("namespaceId"),Id:e[f].Id,e:this.get("id"),et:2,fn:e[f].fn,fs:e[f].fs,p:e[f].p,ft:e[f].ft};b.push(g)}}a.NEWATT=b}zmUtil.compose(a,"",{entityType:"note"})},addTag:function(a){var b=this,c={tagId:a,entityId:this.get("id"),mode:"setTag",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"addLabel",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(){var d=b.get("tagId").slice();d.push(a),zNote.eventBus.trigger("editNote",b,{id:c.entityId,cattribute:"addLabel",p:d}),$.publish("note/editNote",[{mode:"addLabel",gid:b.get("namespaceId"),pid:c.entityId,labelId:a}])}})},removeTag:function(a){var b=this,c={tagId:a,entityId:this.get("id"),mode:"removeTag",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"addLabel",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(){b.removeTagDone(a)}})},removeTagDone:function(a){var b=this.get("tagId").slice();b.splice(this.get("tagId").indexOf(a),1),zNote.eventBus.trigger("editNote",this,{id:this.get("id"),cattribute:"removeLabel",p:b}),$.publish("note/editNote",[{mode:"removeLabel",pid:this.get("id"),gid:this.get("namespaceId"),labelId:a}])},saveColor:function(a){var b=this,c={color:a,entityId:this.get("id"),mode:"editNColor",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"changeEntity",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(){zNote.eventBus.trigger("editNote",b,{id:c.entityId,cattribute:"color",p:c})}})},showNote:function(a){this.set("showStickyNote",a)},closeNote:function(){$.publish("/note/closeStickyNote",[this.get("id"),this.get("namespaceId")])},saveFavourite:function(){var a=this,b=!this.get("starred"),c=b?"addLabel":"deleteLabel",d={starred:b,entityId:this.get("id"),mode:"editNFav",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:c,entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:d,success:function(){zNote.eventBus.trigger("editNote",a,{id:d.entityId,cattribute:"starred",p:d}),$.publish("note/editNote",[{mode:"changeFavourite",pid:d.entityId,gid:a.get("namespaceId"),starred:b}])}})}})}(),function(){zNote.Collections=zNote.Collections||{},zNote.Collections.Note=Zmail.Collection.extend({initialize:function(a,b,c,d){this.options=b,this.listInfo=c,this.mountingElem=d,this.on("change:cat",function(a){"c"===this.listInfo.mode&&this.listInfo.id!==a.get("cat")&&"zn_catAll"!==this.listInfo.id&&this.remove(a)}.bind(this)),this.on("change:tagId",function(a){"l"===this.listInfo.mode&&a.get("tagId").indexOf(this.listInfo.id)===-1&&this.remove(a)}.bind(this)),this.on("change:starred",function(a){"fav"===this.listInfo.mode&&a.get("starred")===!1&&this.remove(a)}.bind(this)),this.addNoteSubscription=this.addNoteToCollection.bind(this),this.removeNoteSubscription=this.removeNoteFromCollection.bind(this),this.deleteNoteCatSubscription=this.deleteNoteCat.bind(this),$.subscribe("/note/add",this.addNoteSubscription),$.subscribe("/note/delete",this.removeNoteSubscription),$.subscribe("/delete/notescat",this.deleteNoteCatSubscription),this.listInfo&&"stickyNote"===this.listInfo.mode&&($.subscribe("/note/closeStickyNote",this.removeNoteSubscription),$.subscribe("/note/addstickynote",this.addNoteSubscription))},addNoteToCollection:function(a,b){var c=this;"mailassociated"===c.listInfo.id&&c.listInfo.msgid===b.email.msgid&&c.unshift(b),"c"===c.listInfo.mode&&("zn_catAll"===c.listInfo.id&&c.listInfo.groupId===b.namespaceId||c.listInfo.id===b.cat)&&c.unshift(b),"stickyNote"===c.listInfo.mode&&void 0!==b.showStickyNote&&c.add(b)},removeNoteFromCollection:function(a,b){this.remove(this.get(b))},deleteNoteCat:function(a,b){var c=this.where({cat:b});c.length&&(this.remove(c,{silent:!0}),this.trigger("remove"))},stopSubscriptions:function(){$.unsubscribe("/note/delete",this.removeNoteSubscription),$.unsubscribe("/note/add",this.addNoteSubscription),$.unsubscribe("/delete/notescat",this.deleteNoteCatSubscription),"stickyNote"===this.listInfo.mode&&($.unsubscribe("/note/closeStickyNote",this.removeNoteSubscription),$.unsubscribe("/note/addstickynote",this.addNoteSubscription))},model:zNote.Models.Note})}(),function(){zNote.Views=zNote.Views||{},zNote.Views.NoteCollectionReact=React.createClass({displayName:"NoteCollectionReact",getInitialState:function(){return this.initializeValue(),{}},componentDidUpdate:function(){(!this.props.noteList.listInfo||this.props.noteList.listInfo&&"stickyNote"!==this.props.noteList.listInfo.mode)&&this.props.noteList.length&&znNote.setTopLeft(!1,!0,this.props.noteList.mountingElem)},componentDidMount:function(){var a=this;this.props.noteList.on("change",function(){(!a.props.noteList.listInfo||a.props.noteList.listInfo&&"stickyNote"!==a.props.noteList.listInfo.mode)&&a.props.noteList.length&&znNote.setTopLeft(!1,!0,this.props.noteList.mountingElem)}.bind(this)),this.props.noteList.on("change:renamenotecat",function(){this.forceUpdate()}.bind(this)),this.props.noteList.on("remove",function(){this.forceUpdate()}.bind(this)),this.props.noteList.on("add",function(){this.forceUpdate()}.bind(this)),setTimeout(function(){(!a.props.noteList.listInfo||a.props.noteList.listInfo&&"stickyNote"!==a.props.noteList.listInfo.mode)&&a.props.noteList.length&&znNote.setTopLeft(!1,!1,a.props.noteList.mountingElem)},100),setTimeout(function(){(!a.props.noteList.listInfo||a.props.noteList.listInfo&&"stickyNote"!==a.props.noteList.listInfo.mode)&&a.props.noteList.length&&znNote.setTopLeft(!1,!1,a.props.noteList.mountingElem)},10)},initializeValue:function(){this.top=this.top||30,this.left=this.left||30,this.maxZIndex=this.maxZIndex||2},getAvailableTopLeft:function(){var a=this.top,b=this.left;this.incrementTopLeft(),this.top>document.body.clientHeight-400&&(this.top=30),this.left>document.body.clientWidth-400&&(this.left=30);var c=this.maxZIndex;return this.maxZIndex<100&&this.incrementZIndex(),{top:a,left:b,zIndex:c}},getCurrentTopLeft:function(){var a=this.top,b=this.left;return{top:a,left:b}},componentWillUnmount:function(){this.props.noteList.stopSubscriptions()},incrementZIndex:function(){this.maxZIndex=this.maxZIndex+1},incrementTopLeft:function(){this.top=this.top+60,this.left=this.left+30},handleZIndex:function(a){this.maxZIndex>=99&&(this.props.noteList.each(function(a){a.set({zIndex:1})}),this.maxZIndex=2),a.get("zIndex")+1!==this.maxZIndex&&(a.set({zIndex:this.maxZIndex}),this.incrementZIndex())},appendList:function(){this.props.noteList.concat()},setOpenNote:function(a){this.previewId=a},getOpenNote:function(){return this.previewId||""},noteView:function(a,b){this.noteViewList=this.noteViewList||{},this.noteViewList[b.get("id")]=a},noteViewList:function(){return this.noteViewList},getTopLeft:function(a){var b=this.noteViewList[a].top,c=this.noteViewList[a].left;return{top:b,left:c}},getWidthHeight:function(a){var b=this.noteViewList[a].width,c=this.noteViewList[a].getDescriptionHeight();return{width:b,height:c}},render:function(){var a,b,c,d=this,e=this.props.extraOptions,f=this.props.noteList.listInfo.mode;return a="byuser"===f||"sharedtome"===f?{__html:zmText.get("notes","nonotesavailable")}:"search"===f?{__html:zmText.get("notes","nosearchnotes")}:{__html:zmText.get("notes","nonotescreate",{create:"<font onClick={znNote.createInlineNotes()}>"+zNote.notei18n.create+"</font>"})},e&&(b=this.handleZIndex,c=this.getAvailableTopLeft),this.props.noteList.length?React.createElement("div",{id:"wrapperNoteDiv",ref:"wrapDiv"},this.props.noteList.map(function(a){return React.createElement(zNote.Views.NoteViewReact,{note:a,ref:function(b){d.noteView(b,a)},extraOptions:e,handleOnOpenNote:d.setOpenNote,openedNote:d.getOpenNote,getAvailableTopLeft:c,handleZIndex:b,key:a.get("id"),mountingElem:d.props.noteList.mountingElem})})):React.createElement("div",{id:"wrapperNoteDiv",ref:"wrapDiv"},React.createElement("div",{id:"nonotes",className:"SC_nmsg",dangerouslySetInnerHTML:a}))}})}(),function(){zNote.Views=zNote.Views||{},zNote.Views.NoteViewReact=React.createClass({displayName:"NoteViewReact",getInitialState:function(){return{select:""}},componentDidMount:function(){var a=this;this.props.note.on("change",function(a){this.forceUpdate()}.bind(this)),this.props.note.on("change:renamenotecat",function(){this.forceUpdate()}.bind(this)),this.props.extraOptions&&this.props.extraOptions.stickyNote&&("restore"!==a.props.note.get("type")&&$.publish("stickyNoteMod"),setTimeout(function(){$(ReactDOM.findDOMNode(a.refs.notebox)).removeClass("zn_fadeIn")},500),$(ReactDOM.findDOMNode(this.refs.notebox)).draggable({scroll:!1,containment:"window",stop:function(b,c){a.left=c.position.left,a.top=c.position.top,a.props.note.set({left:c.position.left},{silent:!0}),a.props.note.set({top:c.position.top},{silent:!0}),$.publish("stickyNoteMod")},stack:$(ReactDOM.findDOMNode(this.refs.notebox))}),$(ReactDOM.findDOMNode(a.refs.desc)).resizable({containment:"document",handles:{se:".ui-resizable-se",e:".ui-resizable-e",s:".ui-resizable-s"},maxHeight:"500",maxWidth:"400",minHeight:"24",minWidth:"200",start:function(){$(ReactDOM.findDOMNode(a.refs.desc.refs.content)).css("maxHeight","500px")},resize:function(b,c){var d=c.size.width,e=c.size.height;$(ReactDOM.findDOMNode(a.refs.notebox)).css("width",d+"px"),$(ReactDOM.findDOMNode(a.refs.desc.refs.content)).css("height",e+"px"),document.body.clientHeight<$(ReactDOM.findDOMNode(a.refs.notebox)).position().top+$(ReactDOM.findDOMNode(a.refs.notebox)).outerHeight(!0)&&($(ReactDOM.findDOMNode(a.refs.desc.refs.content)).css("height",e-30+"px"),
$(ReactDOM.findDOMNode(a.refs.desc)).css("height",e-30+"px"),$(this).resizable("widget").trigger("mouseup"))},stop:function(b,c){a.width=c.size.width,a.height=c.size.height,a.props.note.set({width:c.size.width},{silent:!0}),a.props.note.set({height:c.size.height},{silent:!0}),$.publish("stickyNoteMod")}}),$(ReactDOM.findDOMNode(this.refs.notebox)).mousedown(function(){a.props.handleZIndex(a.props.note)}),this.props.note.on("change:addedagain",function(b){a.props.handleZIndex(a.props.note),$(ReactDOM.findDOMNode(a.refs.notebox)).addClass("zn_selNote"),setTimeout(function(){$(ReactDOM.findDOMNode(a.refs.notebox)).removeClass("zn_selNote")},500)})),$(ReactDOM.findDOMNode(this.refs.notebox)).on("mousedown",function(){document.activeElement.blur()})},componentDidUpdate:function(){var a=this;setTimeout(function(){$(ReactDOM.findDOMNode(a.refs.notebox)).removeClass("zn_fadeIn")},100)},componentWillUnmount:function(){this.props.note.stopSubscriptions()},handleOnClose:function(){this.props.note.closeNote(),$.publish("stickyNoteMod")},setDescriptionHeight:function(a){this.height=a},getDescriptionHeight:function(){return this.height},viewNote:function(){if(""===this.props.openedNote()){var a,b,c,d,e=this;this.props.handleOnOpenNote(this.props.note.get("id"));var f=$.extend(!0,{},this),g={};g.clientX=$(ReactDOM.findDOMNode(f.refs.notebox)).offset().left,g.clientY=$(ReactDOM.findDOMNode(f.refs.notebox)).offset().top,zNote.getNoteDetails({namespaceId:this.props.note.get("namespaceId"),id:this.props.note.get("id")}).done(function(h){if(e.props.handleOnOpenNote(""),0!==h[0]){var i=h[1],j=$('<div id="nmask" class="SC_Pop tra SC_cent"style="pointer-events:auto"><div class="SCmb puClose nPuClose" id="nclose"><ul><li><b><span class="SC_ttip ttr"><i class="msi-close"></i></span></b></li></ul></div><div class="SC_pe"><div class="SC_peCen" id="noteBox"></div></div></div>'),k=$('<div id="colorMask" style="z-index:101" class="SC_Pop tra">');$("body").append(k),$("body").append(j);var l=$(j).innerHeight()-50,m=$(j).innerWidth()-50,n=new zNote.Models.previewNote(i),o=function s(){e.props.handleOnOpenNote(""),j.remove(),k.remove(),zNote.eventBus.off("removeMask",s,e),$(ReactDOM.findDOMNode(f.refs.notebox)).show(),zmUtil.hideMenu(),zNote.dropKeyBoardShortcuts()},p=function(h){a=h?h.top:g.clientY,b=h?h.left:g.clientX,e.props.handleOnOpenNote(""),k.removeClass("blk").addClass("tra"),j.find(".SCS_post").hide(),j.find(".zn_popNote").removeClass("zn_popNote");var i=$(ReactDOM.findDOMNode(c.refs.notebox)),l=i.offset(),m=i.width();i[0].style.position="fixed",i[0].style.bottom="auto",i[0].style.width=m+"px",i[0].style.top=l.top+"px",i[0].style.left=l.left+"px",$(ReactDOM.findDOMNode(c.refs.notebox)).animate({top:a+"px",left:b+"px",height:"UNMOUNTED"!==f.refs.notebox._lifeCycleState?$(ReactDOM.findDOMNode(f.refs.notebox)).height():0,width:"UNMOUNTED"!==f.refs.notebox._lifeCycleState?$(ReactDOM.findDOMNode(f.refs.notebox)).width():0},{complete:function(){"UNMOUNTED"!==f.refs.notebox._lifeCycleState&&$(ReactDOM.findDOMNode(f.refs.notebox)).show(),zmStreamsApp.util.detachAndRemove(j.find(".SC_ScrollY")).always(function(){ReactDOM.unmountComponentAtNode($(ReactDOM.findDOMNode(c.refs.notebox)).parent()[0]),j.remove(),k.remove(),$.unsubscribe("zm/closeAllOpenDialog",d)})},always:function(){$.publish("zm/framework/dialogClosed")}}),zNote.dropKeyBoardShortcuts(),zNote.eventBus.off("removeMask",o,e),zmUtil.hideMenu()};j.find("#nclose").on("click",function(){p()}),d=function(a,b){p(b)},$.subscribe("zm/closeAllOpenDialog",d),c=ReactDOM.render(React.createElement(zNote.Views.NotePreview,{note:n,removeNotePreview:p}),j.find("#noteBox")[0]),zNote.eventBus.on("removeMask",o,e),ReactDOM.findDOMNode(c.refs.notebox).style.left="-4000px";var q=$('<div class=""><div class=""><div class="SC_ScrollY"></div></div></div>'),r={by:i.gnrl.by,id:i.notes.id,etype:2,groupId:i.gnrl.group.id,showinvite:i.myact.showinvite,lockInvites:i.gnrl.lockInvites,like:i.myact.like,invitee:parseInt(i.act.invitees),inviteeList:i.myact.inviteeList,likes:parseInt(i.act.likes)};i.gnrl.group.isGroup?r.actionType="viewGroupEntity":r.actionType="viewSelfData",zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:q.find(".SC_ScrollY"),viewPost:!0,fixedComment:!1,isPreview:!1,response:i,hideContent:!0})}),setTimeout(function(){var a=l-($(ReactDOM.findDOMNode(c.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(c.refs.desc.refs.content)).height());$(ReactDOM.findDOMNode(c.refs.desc.refs.content)).css("height",a-60),$(ReactDOM.findDOMNode(c.refs.desc.refs.content)).css("max-height",a),$(ReactDOM.findDOMNode(c.refs.desc.refs.content))[0].style.overflow="hidden",$(ReactDOM.findDOMNode(c.refs.desc.refs.content))[0].style.overflowY="auto",j.find(".SC_pe").css("max-height",l),j.find(".SC_pe").css("min-width",m-200),j.find(".SC_pe").css("max-width",m-200),ReactDOM.findDOMNode(c.refs.notebox).style.left="0px",j[0].style.left=g.clientX-$(ReactDOM.findDOMNode(c.refs.notebox)).offset().left+"px",j[0].style.top=g.clientY-$(ReactDOM.findDOMNode(c.refs.notebox)).offset().top+"px",q.find(".SC_ScrollY").css("max-height",l),j.find("#noteBox").append(q),k.removeClass("tra").addClass("blk"),j.animate({top:0,left:0},{complete:function(){"UNMOUNTED"!==f.refs.notebox._lifeCycleState&&$(ReactDOM.findDOMNode(f.refs.notebox)).hide(),zNote.setKeyBoardShortcuts({esc:p}),zmHash.setHash("notes",["preview",e.props.note.get("namespaceId"),e.props.note.get("id")])}})},100)}}).fail(function(){e.props.handleOnOpenNote("")})}},handleOnMinimize:function(){var a=this;this.left=$(ReactDOM.findDOMNode(this.refs.notebox)).offset().left,this.top=$(ReactDOM.findDOMNode(this.refs.notebox)).offset().top;var b=$(".SC_exp").find(".msi-stickyNotes").offset().left,c=$(".SC_exp").find(".msi-stickyNotes").offset().top,d=$(ReactDOM.findDOMNode(this.refs.notebox)).outerHeight(!0),e=$(ReactDOM.findDOMNode(this.refs.notebox)).outerWidth(!0),f=$(ReactDOM.findDOMNode(this.refs.notebox)).width();$(ReactDOM.findDOMNode(this.refs.notebox)).animate({left:b-16,top:c-20,height:0,width:0},{complete:function(){ReactDOM.findDOMNode(a.refs.notebox).style.top=a.top+"px",ReactDOM.findDOMNode(a.refs.notebox).style.left=a.left+"px",$(ReactDOM.findDOMNode(a.refs.notebox)).outerHeight(d),$(ReactDOM.findDOMNode(a.refs.notebox)).outerWidth(e),$(ReactDOM.findDOMNode(a.refs.notebox)).css("height",""),$(ReactDOM.findDOMNode(a.refs.notebox)).width(f),a.props.note.showNote(!1)},duration:700})},handleMouseUp:function(){this.selection=zNote.getSelectedTextWithin(ReactDOM.findDOMNode(this.refs.notebox))},handleOpenNote:function(){var a=this,b=_.debounce(function(){a.viewNote(a)},1e3,{leading:!0});this.selection=zNote.getSelectedTextWithin(ReactDOM.findDOMNode(this.refs.notebox)),this.selection.length||this.props.extraOptions&&this.props.extraOptions.stickyNote&&this.props.extraOptions||b()},handlePopOutNote:function(a){a.stopPropagation();var b=this,c=_.debounce(function(){b.viewNote(b)},1e3,{leading:!0});c()},render:function(){var j,m,n,o=this.state.select,p=this.props.extraOptions&&this.props.extraOptions.stickyNote?"zn_note zn_stickyNote "+zNote.CONSTANTS.COLORCODE[this.props.note.get("color")]+" "+o:"zn_note cursorPointer "+zNote.CONSTANTS.COLORCODE[this.props.note.get("color")]+" "+o;this.props.note.get("showStickyNote")===!1&&(p+=" SC_dyn");var q={left:"-1000",width:"276"};return this.props.extraOptions&&this.props.extraOptions.stickyNote&&(this.props.note.get("showStickyNote")===!0&&(p+=" zn_fadeIn"),m=React.createElement("div",{className:"cursorMove",ref:"dragband",title:zNote.notei18n.holdanddrag}),j=React.createElement("div",{className:"SCmb SC_frt"},React.createElement("li",{onClick:this.handlePopOutNote},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-popout"})))),React.createElement("li",{onClick:this.handleOnMinimize},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-minus"})))),React.createElement("li",{onClick:this.handleOnClose},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-close"}))))),void 0!==this.props.note.get("top")&&(this.top=this.props.note.get("top"),this.props.note.set({top:void 0},{silent:!0})),void 0!==this.props.note.get("left")&&(this.left=this.props.note.get("left"),this.props.note.set({left:void 0},{silent:!0})),void 0!==this.left&&void 0!==this.top&&void 0!==this.props.note.get("zIndex")||(n=this.props.getAvailableTopLeft()),void 0!==this.props.note.get("width")?this.width=this.props.note.get("width"):(this.width=276,this.props.note.set({width:"276"},{silent:!0})),void 0===this.props.note.get("zIndex")&&this.props.note.set({zIndex:n.zIndex},{silent:!0}),this.left=void 0!==this.left?this.left:n.left,this.top=void 0!==this.top?this.top:n.top,this.props.note.set({left:this.left},{silent:!0}),this.props.note.set({top:this.top},{silent:!0}),q.left=this.left,q.top=this.top,q.width=this.width,q.zIndex=this.props.note.get("zIndex")),React.createElement("div",{className:p,onMouseUp:this.handleMouseUp,onClick:this.handleOpenNote,ref:"notebox",style:q},m,React.createElement("div",{className:"zn_dd"},j,React.createElement(a,{note:this.props.note}),React.createElement("span",{className:"zn_date"},this.props.note.get("disptime"))),React.createElement("div",null,React.createElement(i,{note:this.props.note,extraOptions:this.props.extraOptions,parent:this}),React.createElement(h,{note:this.props.note,print:this.props.print,parent:this,viewNote:this.viewNote,extraOptions:this.props.extraOptions,mountingElem:this.props.mountingElem,ref:"desc"})),React.createElement("div",{className:"zn_act zn_clear"},React.createElement("div",{className:"SCmb"},React.createElement("div",{className:"SC_flt"},React.createElement("ul",null,React.createElement(b,{note:this.props.note}),React.createElement(d,{note:this.props.note,parent:this}),React.createElement(k,{ref:"showmore",note:this.props.note,extraOptions:this.props.extraOptions,parent:this}))),React.createElement("div",{className:"SC_frt"},React.createElement("ul",null,React.createElement(f,{note:this.props.note,parent:this}),React.createElement(e,{note:this.props.note,parent:this}))))),React.createElement("div",{id:"grpDiv",className:"zn_folder zn_clear"},function(a){return React.createElement(c,{note:a.props.note,parent:a,ref:"tag"})}(this),React.createElement(g,{note:this.props.note})),function(a){return React.createElement(l,{ref:"attDiv",note:a.props.note})}(this))}});var a=React.createClass({displayName:"NoteCreator",componentDidMount:function(){var a=this;zmail.ContactBook.get({zuid:a.props.note.get("ownerZUID")}).done(function(b){var c=b[0];zmComponent.tooltip({elm:$(ReactDOM.findDOMNode(a.refs.creator))[0],text:c.attrs.fn,arrow:"top"}),$(ReactDOM.findDOMNode(a.refs.creator)).append(c.avatar())})},render:function(){return React.createElement("span",{ref:"creator"})}}),b=React.createClass({displayName:"Favourite",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.star,text:zNote.notei18n.tooltips.changeFavourite,arrow:"top"})},handleSetFavourite:function(a){a.stopPropagation(),this.props.note.saveFavourite()},render:function(){var a=this.props.note.get("starred")?"SC_fav":"";return React.createElement("li",{id:"znfav",ref:"star",onClick:this.handleSetFavourite,className:a},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-fav"}))))}}),c=React.createClass({displayName:"Tags",componentDidMount:function(){var a=this.refs.labelicon||this.refs.plus;zmComponent.tooltip({elm:a,text:zNote.notei18n.note.addTag,arrow:"top"})},addLabel:function(a,b){a.stopPropagation();var c,d=this,e={};e.parentDOM=this.refs.plus?ReactDOM.findDOMNode(this.refs.plus):b,e.displayAs="popup",e.labelState={labelList:this.props.note.get("tagId")},e.showCreate=!0,e.accType="default",e.onHide=function(){$("#zm_dropDown").remove()},e.onCreate=function(a){znNote.sendNewLabReq(a).done(function(a){a&&1===a[0]&&a[1].id&&(c.hide(),d.props.note.addTag(a[1].id))})},e.onStateChange=function(a,b){b?d.props.note.addTag(a):d.props.note.removeTag(a)},c=zmUtil.createFLComp("label",e),c.show()},render:function(){var a={backgroundColor:""},b=this;return b.props.note.get("tagId")&&b.props.note.get("tagId").length>0?React.createElement("div",{className:"zm_lbl"},b.props.note.get("tagId").map(function(c){return!!zmUtil.getTagList("default")[c]&&(a={backgroundColor:zmUtil.getTagList("default")[c].color},React.createElement("p",{"data-mid":"",title:zmUtil.getTagList("default")[c].label,onClick:function(a){b.addLabel(a)},className:"zmAttLbl"},React.createElement("font",{style:a})))}),React.createElement("i",{className:"msi-plus",ref:"plus",onClick:function(a){b.addLabel(a)}})):React.createElement("div",{className:"zm_lbl"},React.createElement("i",{className:"msi-label",ref:"labelicon",onClick:function(a){b.addLabel(a,$(ReactDOM.findDOMNode(b.refs.labelicon))[0])}}))}}),d=React.createClass({displayName:"Color",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.palette,text:zNote.notei18n.tooltips.changeColor,arrow:"top"})},handleSetColor:function(a){a.stopPropagation();var b=this;if("true"===$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible")){var c=$('<li><div class="zn_clr"><div class="zn_clr1"></div><div class="zn_clr2"></div><div class="zn_clr3"></div><div class="zn_clr4"></div></div></li>');c.find("."+zNote.CONSTANTS.COLORCODE[this.props.note.get("color")]).append("<i class=msi-tick></i>");var d={par:a.target,showArrow:!0,liDom:c,direction:"bottom",ulClass:"zn_clrSel",spanClass:"minwid"};zmsuite.showMenu(d),$(c[0]).find("div").children("div").off("click").on("click",function(a){a.stopPropagation(),$("#zm_dropDown").remove(),$(ReactDOM.findDOMNode(b.refs.palette)).attr("data-visible","false"),b.props.note.saveColor(zNote.CONSTANTS.COLOR[this.className])})}$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-current","false"),$(ReactDOM.findDOMNode(this.props.parent.refs.notebox)).addClass("sel")},handleSetAttributes:function(){$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-current","true"),"true"===$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible")?$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible","false"):$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible","true")},render:function(){var a=this.props.note.get("ownerZUID")!==zmail.zuid?"SC_dyn":"";return React.createElement("li",{id:"zncolor",className:a,ref:"palette",onMouseDown:this.handleSetAttributes,onClick:this.handleSetColor},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-nclr"}))))}}),e=React.createClass({displayName:"CommentIndicator",render:function(){return this.props.note.get("commentCount")&&0!==this.props.note.get("commentCount")?React.createElement("li",{className:"zn_actVIcon"},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-lcmnt"}),React.createElement("span",null,this.props.note.get("commentCount"))))):null}}),f=React.createClass({displayName:"AssociatedMail",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.mailopen,text:zNote.notei18n.tooltips.openmail,arrow:"top"})},handleViewAssociatedMail:function(a){a.stopPropagation();var b={};this.props.note.get("email").accid!==zmail.accId&&(b={actionType:"viewGroupMailEntity",entityId:this.props.note.get("email").msgid,entityType:"1",streamsView:"true",streams:!0,groupId:this.props.note.get("ownerZUID"),accId:this.props.note.get("email").accid}),zmList.getMailData({msgId:this.props.note.get("email").msgid,opentype:2,type:"lt",src:"external",eprm:b})},render:function(){var a=this.props.note.get("email")&&!$.isEmptyObject(this.props.note.get("email"))?"zn_actVIcon":"zn_actVIcon SC_dyn";return React.createElement("li",{id:"znmail",className:a,ref:"mailopen",onClick:this.handleViewAssociatedMail},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-mailopen"}))))}}),g=React.createClass({displayName:"Book",componentDidMount:function(){this.props.note.get("ownerZUID")===zmail.zuid&&zmComponent.tooltip({elm:this.refs.book,text:zNote.notei18n.tooltips.moveNote,arrow:"top"})},changeGroup:function(a){if(this.props.note.get("ownerZUID")===zmail.zuid){var b;a.stopPropagation();var c=znNote.getGroupArray(),d=this,e={};e.parentDOM=ReactDOM.findDOMNode(this.refs.group),e.displayAs="popup",e.showCreate=!0,e.onSelect=function(a){d.props.note.changeGroup(a),b.hide()},e.onHide=function(){$("#zm_dropDown").remove()},e.dataCallback=function(){return c},b=zmUtil.createFLComp("group",e),b.show()}},handleChangeBook:function(a){if(this.props.note.get("ownerZUID")===zmail.zuid){a.stopPropagation();var b,c=znNote.getCategoryArray(this.props.note.get("namespaceId")),d=this,e={};e.parentDOM=ReactDOM.findDOMNode(this.refs.book),e.displayAs="popup",e.onSelect=function(a){d.props.note.changeBook(a),b.hide()},(this.props.note.get("namespaceId")===zmail.zuid||zmCont.getGroup()[this.props.note.get("namespaceId")]&&zmCont.getGroup()[this.props.note.get("namespaceId")].isOwner)&&(e.onCreate=function(a){znNote.sendNewCatReq(a,{},d.props.note.get("namespaceId")).done(function(a){d.props.note.changeBook(a[1][0].catId),b.hide()})}),e.onHide=function(){$("#zm_dropDown").remove()},e.dataCallback=function(){return c},b=zmUtil.createFLComp("category",e),b.show()}},render:function(){var a=znNote.getGroupName(this.props.note.get("namespaceId")),b=znNote.getNamefrmCatObj(this.props.note.get("cat"),this.props.note.get("namespaceId")),c=""===a?"zn_cgy SC_dyn":"zn_cgy";return React.createElement("div",{className:c,ref:"cgy",id:"zncat"},React.createElement("font",{id:"zngroup",ref:"group",className:"zn_ngrp"},a),React.createElement("i",{className:"msi-rarrow"}),React.createElement("font",{id:"znscat",ref:"book",className:"zn_nbook",onClick:this.handleChangeBook},b))}}),h=React.createClass({displayName:"Description",getInitialState:function(){var a=!1;return this.props.note.get("desc")&&this.props.note.get("desc").length>=255&&!this.props.print&&(a=!0),this.ispaste=!1,{height:0,readmore:a}},componentDidMount:function(){this.props.extraOptions&&this.props.extraOptions.stickyNote&&($(ReactDOM.findDOMNode(this.refs.content)).css({"max-height":"300px","overflow-y":"auto","overflow-x":"hidden"}),$(ReactDOM.findDOMNode(this.refs.content)).on("mousedown",function(a){a.stopPropagation()})),void 0===this.props.note.get("height")||null===this.props.note.get("height")||isNaN(parseInt(this.props.note.get("height")))?(this.setState({height:$(ReactDOM.findDOMNode(this.refs.content)).height()}),this.props.note.set({height:$(ReactDOM.findDOMNode(this.refs.content)).innerHeight()},{silent:!0})):(this.setState({height:this.props.note.get("height")}),$(ReactDOM.findDOMNode(this.refs.content)).css("height",this.props.note.get("height")+"px"),$(ReactDOM.findDOMNode(this.refs.content)).css({"max-height":"500px"}))},handleOpenNote:function(a){a.stopPropagation();var b=this,c=_.debounce(function(){b.props.viewNote(b.props.parent)},1e3,{leading:!0});c()},componentWillReceiveProps:function(){this.props.note.get("desc")&&this.props.note.get("desc").length>=255?this.setState({readmore:!0}):this.setState({readmore:!1})},handleSetDescription:function(a){this.ispaste===!1&&this.props.note.saveDescription(znBox.domParser(znBox.getContentEditableText($(a.target))))},setImage:function(a){var b=this.selection;$(ReactDOM.findDOMNode(this.refs.content)).trigger("focus",!0,!0);var c=Object.keys(a[0].inline[0])[0],d=zmail.conPath+"/FileDownload/"+zmUtil.getDummyFilename(a[0].inline[0][c].fn)+"?attachId="+a[0].inline[0][c].Id+"&entityType=2&entityId="+this.props.note.get("id")+"&actionType=viewGroupEntity&groupId="+this.props.note.get("namespaceId")+"&streamsView=Notes&mode=view&app=notes&attachType=inline",e=znBox.restoreSelectionNew(ReactDOM.findDOMNode(this.refs.content),b);e||$(ReactDOM.findDOMNode(this.refs.content)).trigger("focus"),znBox.isIE?znBox.insertHtmlAtCaret("<img id="+a[0].inline[0][c].Id+" src="+d+"></img>"):document.execCommand("insertHTML",!1,"<img id="+a[0].inline[0][c].Id+" src="+d+"></img>")},handleSetHeight:function(){this.selection=znBox.saveSelectionNew(ReactDOM.findDOMNode(this.refs.content)),this.state.height!==$(ReactDOM.findDOMNode(this.refs.content)).height()&&this.setState({height:$(ReactDOM.findDOMNode(this.refs.content)).height()})},handleSaveSelection:function(a,b,c){c||(this.selection=znBox.saveSelectionNew(ReactDOM.findDOMNode(this.refs.content)))},restoreSelection:function(){znBox.restoreSelectionNew(ReactDOM.findDOMNode(this.refs.content),this.selection)},handlePaste:function(a){var b=this;this.ispaste=!0,znBox.handlePaste(a.target),setTimeout(function(){b.ispaste=!1},200)},fillSummary:function(){this.setState({readmore:!1})},clickHandler:function(a){if("IMG"===a.target.nodeName){var b=a.target.src,c=[],d={attObj:{ft:101,fn:" "},src:b};c.push(d),zmUtil.initAttSlideShow(c,0,!0)}else this.saveSelection(a)},render:function(){var a,b="",c=zNote.notei18n.placeholder.writeSome,d=Boolean(this.props.extraOptions&&this.props.extraOptions.stickyNote);return b=this.state.readmore&&!d?React.createElement("div",null,React.createElement("div",{className:"zn_cont zn_trunc",ref:"content","data-plhr":c,contentEditable:d,onPaste:this.handlePaste,onFocus:this.handleSaveSelection,onKeyUp:this.handleSetHeight,onBlur:this.handleSetDescription,dangerouslySetInnerHTML:{__html:this.props.note.get("desc")?this.props.note.get("desc").replace(/\n/g,"<br />"):""}}),React.createElement("div",{className:"SC_lnk",onClick:this.handleOpenNote},"Read More ...")):React.createElement("div",null,React.createElement("div",{className:"zn_cont",ref:"content","data-plhr":c,contentEditable:d,onPaste:this.handlePaste,onFocus:this.handleSaveSelection,onKeyUp:this.handleSetHeight,onBlur:this.handleSetDescription,dangerouslySetInnerHTML:{__html:this.props.note.get("desc")?this.props.note.get("desc").replace(/\n/g,"<br />"):""}}),React.createElement("div",{className:"SC_lnk SC_dyn"},"Read More ...")),this.props.extraOptions&&this.props.extraOptions.stickyNote&&(a=React.createElement("div",{className:"sticky_resizable",title:zNote.notei18n.tooltips.resize},React.createElement("div",{className:"ui-resizable-handle ui-resizable-e"}),React.createElement("div",{className:"ui-resizable-handle ui-resizable-s"}),React.createElement("div",{className:"ui-resizable-handle ui-resizable-se"}))),React.createElement("div",{className:"zn_base"},b,a)}}),i=React.createClass({displayName:"Title",componentDidMount:function(){this.props.extraOptions&&this.props.extraOptions.stickyNote&&$(ReactDOM.findDOMNode(this.refs.title)).on("mousedown",function(a){a.stopPropagation()})},handleSetTitle:function(a){a.target.textContent.trim().length||$(ReactDOM.findDOMNode(this.refs.title)).text(""),this.props.note.saveTitle(a.target.textContent)},handleKeyDown:function(a){13===a.keyCode&&(a.preventDefault(),ReactDOM.findDOMNode(this.props.parent.refs.desc.refs.content).focus())},render:function(){var a=zNote.notei18n.placeholder.title,b=Boolean(this.props.extraOptions&&this.props.extraOptions.stickyNote),c=this.props.note.get("title")&&this.props.note.get("title")!==znBox.CONTS.defaultTitle?znBox.spCharRep(this.props.note.get("title")):"";return React.createElement("div",{className:"zn_tit",contentEditable:b,ref:"title",onBlur:this.handleSetTitle,onKeyDown:this.handleKeyDown,"data-plhr":a},c)}}),j=React.createClass({displayName:"InsertImg",componentDidMount:function(){var a=this;$(ReactDOM.findDOMNode(this.refs.fileinput)).trigger("click"),$(ReactDOM.findDOMNode(this.refs.fileinput)).change(function(){a.props.note.attachFiles(ReactDOM.findDOMNode(a.refs.fileinput),"image",a.props.parent.refs.desc.setImage)})},render:function(){return React.createElement("input",{type:"file",id:"addAttach",name:"attach",accept:".gif,.jpg,.jpeg,.png",ref:"fileinput"})}}),k=React.createClass({displayName:"ShowMore",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.showmoreicon,text:zNote.notei18n.tooltips.moreOptions,arrow:"top"})},popupClick:function(a){switch(znNote.hideMenu(),a.action){case"addAttach":this.addAttachment();break;case"insertImg":$("#fileattach").length&&$("#fileattach").remove(),$(document.body).append("<div id=fileattach></div>"),ReactDOM.render(React.createElement(j,{note:this.props.note,parent:this.props.parent}),document.getElementById("fileattach"));break;case"stickyNote":zNote.addAsStickyNote(this.props.note.toJSON());break;case"addTag":this.props.parent.refs.tag.addLabel(ReactDOM.findDOMNode(this.props.parent.refs.showmore));break;case"sendMail":this.props.note.sendAsMail();break;case"delNote":this.props.note.deleteNote(this.props.note.get("id"));break;case"print":zNote.printNote({id:this.props.note.get("id"),namespaceId:this.props.note.get("namespaceId")})}},addAttachment:function(){var a=this;if(a.attRefObj)a.attRefObj.init();else{var b={componentId:"notes",isNewImp:!0,attachFrom:["desktop","myAttachchment","zDocs","otherCloud"],currentAttachedSize:0,eleId:$(ReactDOM.findDOMNode(a.props.parent.refs.attDiv)),onAllUploadFinish:{handler:function(b){a.props.note.saveAttachment(b)},resetData:!0,removeAttachDOM:!0}};zmUtil.initAttachComponent(b,function(b){a.attRefObj=b})}},setAttributes:function(){$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-current","true"),"true"===$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible")?$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible","false"):$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible","true")},showMoreOptions:function(a){a.stopPropagation();var b=this,c={};c.addAttach={htm:zNote.notei18n.note.addAttach,data:{action:"addAttach"}},c.sendMail={htm:zNote.notei18n.note.sendMail,data:{action:"sendMail"}},c.makeSticky={htm:zNote.notei18n.note.makeSticky,data:{action:"stickyNote"}},c.printNote={htm:zNote.notei18n.note.printNote,data:{action:"print"}},c.delNote={htm:zNote.notei18n.note.delNote,data:{action:"delNote"}},c.separator={sep:!0},this.props.note.get("ownerZUID")!==zmail.zuid&&(c.addAttach.state="disabled",c.addAttach.nohover=!0,(!zmCont.getGroup()[this.props.note.get("namespaceId")]||zmCont.getGroup()[this.props.note.get("namespaceId")]&&!zmCont.getGroup()[this.props.note.get("namespaceId")].isOwner)&&(c.delNote.state="disabled",c.delNote.nohover=!0));var d=[c.addAttach,c.sendMail];if(this.props.extraOptions&&this.props.extraOptions.stickyNote||d.push(c.makeSticky),d.push(c.printNote),d=d.concat([c.separator,c.delNote]),"true"===$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible")){var e={par:a.target,showArrow:!0,spanClass:"SC_dd",list:d,direction:"bottom",clk:function(a,c){$(c).hasClass("SC_op3")||b.popupClick(a)}};zmsuite.showMenu(e),$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-current","false"),$(ReactDOM.findDOMNode(this.props.parent.refs.notebox)).addClass("sel")}},render:function(){var a=this;return React.createElement("li",{id:"znopt",ref:"showmoreicon",onClick:function(b){a.showMoreOptions(b)},onMouseDown:function(b){a.setAttributes(b)}},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-nmore"}))))}}),l=React.createClass({displayName:"Attachment",viewImage:function(a,b,c){c.stopPropagation();var d=this,e=znNote.getAttSlideArray(this.props.note.get("attachments"),this.props.note.get("id"),this.props.note.get("namespaceId")),f={},g={},h=[];g.trash={"class":"msi-trash",title:zNote.notei18n.tooltips.deleteAttach,after:".msi-download",events:[{name:"click",listener:function(a,b,c){d.props.note.delAtt(b.e,b.Id,c)}}]},h.push(".msi-fav"),h.push("#etyIcon"),f.extraIcons=g,f.hideOptions=h,zmUtil.initAttSlideShow(e,b,!1,f)},render:function(){var a,b,c=this;return this.props.note.get("attachments")&&this.props.note.get("attachments").length?React.createElement("div",{className:"zn_folder zn_clear zn_attach"},React.createElement("div",{className:"icn"},React.createElement("i",{className:"msi-attachpin"})),this.props.note.get("attachments").map(function(d,e){var f=d[Object.keys(d)[0]],g=zmUtil.fileTyp(f.fn);if("msi-attimg"===g[1])a=c.props.note.get("namespaceId")===zmail.zuid?zmail.conPath+"/FileDownload/"+zmUtil.getDummyFilename(f.fn)+"?attachId="+f.Id+"&entityType=2&entityId="+c.props.note.get("id")+"&groupId="+c.props.note.get("namespaceId")+"&mode=thb&app=notes":zmail.conPath+"/FileDownload/"+zmUtil.getDummyFilename(f.fn)+"?attachId="+f.Id+"&entityType=2&entityId="+c.props.note.get("id")+"&groupId="+c.props.note.get("namespaceId")+"&streamsView=Notes&actionType=viewGroupEntity&mode=thb&app=notes",b=React.createElement("img",{src:a,title:f.fn});else{var h=g[1]+" sc_big";b=React.createElement("i",{className:h,title:f.fn})}return React.createElement("div",{className:"zmL zmAch",key:f.Id,onClick:function(a){c.viewImage(f,e,a)}},React.createElement("div",{className:"zmLst"},React.createElement("div",{className:"zmDtl"},React.createElement("div",{className:"zmImg"},b))))})):React.createElement("div",{ref:"attach",className:"zn_clear zn_attach SC_dyn"},React.createElement("div",{className:"icn"},React.createElement("i",{className:"msi-attachpin"})))}})}(),function(){zNote.Models=zNote.Models||{},zNote.Models.previewNote=Zmail.Model.extend({initialize:function(){zNote.eventBus.on("editNote",this.customEvent,this),this.debounceAddNote=_.debounce(this.addNote,1e3)},customEvent:function(a,b){var c,d,e,f,g,h,i,j=this;if(b.id===this.get("notes").id)if("title"===b.cattribute)c=j.get("cntnt"),c.title=znBox.revSpCharRep(b.p.title),j.set("cntnt",c),j.trigger("change");else if("category"===b.cattribute)c=j.get("notes"),c.catid=b.p.catId,j.set("notes",c),j.trigger("change");else if("color"===b.cattribute)c=j.get("notes"),c.color=b.p.color,j.set("notes",c),j.trigger("change");else if("desc"===b.cattribute)c=j.get("notes"),c.notecont=b.p.desc,j.set("notes",c),j.trigger("change");else if("starred"===b.cattribute)c=j.get("myact"),c.starred=b.p.starred,j.set("myact",c),j.trigger("change");else if("addLabel"===b.cattribute)c=j.get("myact"),c.label=b.p,j.set("myact",c),j.trigger("change");else if("removeLabel"===b.cattribute)c=j.get("myact"),c.label=b.p,j.set("myact",c),j.trigger("change");else if("removeAttachment"===b.cattribute)d=j.get("attach").slice(),$.each(d,function(a,c){if(c.id===b.p.attachId)return d.splice(a,1),!1}),j.set("attach",d),j.trigger("change");else if("addAttachment"===b.cattribute){i=[],f=j.get("attach")?j.get("attach").slice():[];var k;_.each(b.p.attachments,function(a){k=_.keys(a)[0],g=a[k],e={id:g.Id,size:g.fs,name:g.fn,ft:g.ft,part:g.p},i.push(e)}),h=f.concat(i),j.set("attach",h),j.trigger("change")}},deleteNote:function(){var a=this,b={entityId:this.get("notes").id,mode:"delNote",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"delEntity",entityType:"2"},c=b;c.cat=this.get("cat"),Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:b,success:function(){$.publish("/note/delete",[a.get("id"),a.get("namespaceId")]),$.publish("note/updateCount",b)}})},saveTitle:function(a){var b,c,d=this;if(a=a||"",this.get("notes").id)this.get("notes").title!==a&&(0===a.trim().length&&(a=znBox.CONTS.defaultTitle),b={title:a,entityId:this.get("notes").id,mode:"editNTitle",groupId:this.get("gnrl").group.id,streamsView:"Notes",actionType:"changeEntity",entityType:"2"},Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:b,success:function(){zNote.eventBus.trigger("editNote",d,{id:b.entityId,
cattribute:"title",p:b})}}));else{if(0===a.trim().length)return;b={title:a,color:0},c=this.get("cntnt"),c.title=a,this.set("cntnt",c),this.debounceAddNote(b)}},changeBook:function(a){var b=this,c=this.get("notes").catid,d={catId:a,entityId:this.get("notes").id,mode:"moveNote",groupId:this.get("gnrl").group.id,streamsView:"Notes",actionType:"changeEntity",entityType:"2"},e=d;if(e.pCatId=c,this.get("notes").id)Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:d,success:function(){zNote.eventBus.trigger("editNote",b,{id:d.entityId,cattribute:"category",p:d}),$.publish("note/updateCount",e)}});else{var f=this.get("notes");f.catid=a,this.set("notes",f),this.trigger("change")}},changeGroup:function(a){var b=this,c={toNamespace:a,entityId:this.get("notes").id,mode:"changeGroup",groupId:this.get("gnrl").group.id,streamsView:"Notes",actionType:"addEntity",entityType:zNote.CONSTANTS.entityType,deleteOriginal:!0},d=c;if(d.cat=b.get("notes").catid,this.get("notes").id)Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(a){var e=zNote.getNoteDataInListFormat(a[0].data);b.set(a[0].data),b.set("showstream",!0),$.publish("/note/delete",[c.entityId,c.groupId]),$.publish("note/updateCount",d),$.publish("/note/add",[e]),$.publish("note/updateCount",[{mode:"addNote",cat:e.cat,namespaceId:e.namespaceId}])}});else{var e=this.get("gnrl");e.group.id=a,this.set("gnrl",e);var f=znNote.getGeneralCatId(a),g=this.get("notes");g.catid=f,this.set("notes",g),this.trigger("change")}},attachFiles:function(a,b,c,d){var e=this.get("gnrl").group.id,f=this.get("notes").id,g=a,h=g.files[0];if(h){var i=h.size;if(i&&i>=10485760)return zmsDialog.alert(zNote.notei18n.filesizeexceed),void(d&&d());var j=h.name;if(/[<>]/g.test(j))return _zm.succErrMsg("e",zNote.notei18n.filenamespl),void(d&&d());var k=new FormData,l=zmAjq.getCookie("zmcsr");h&&k.append("attach",h),k.append("groupId",e),k.append("zmrcsr",l),k.append("mode","addAttach"),k.append("entityId",f),k.append("actionType","addEntity"),k.append("streamsView","Notes"),k.append("entityType","2"),"image"===b&&k.append("inLine","true");var m={};if(m.ep={id:f,groupId:e},"attachment"===b)m.fn=this.addAttachment.bind(this);else{if(!/(\.(gif|jpg|jpeg|png))$/i.test(j))return zmsDialog.alert(zNote.notei18n.imgSelect),d&&d(),!1;m.fn=c}this.formSubmit(k,m,d)}},formSubmit:function(a,b,c){var d=new XMLHttpRequest;d.open("POST",zmail.conPath+"/NotesAction.do?mode=addAttach",!0),d.onreadystatechange=function(){if(4===d.readyState&&200===d.status&&b.fn){var a=$.parseJSON(d.responseText);"object"==typeof a&&(1===a[0]?b.fn&&b.fn(a[1],b.ep):c&&c(a,b.ep))}},d.send(a)},sendAsMail:function(){var a={},b=[],c=this;if(a.SUBJECT=this.get("notes").title,a.CONTENT=this.get("notes").notecont&&this.get("notes").notecont.replace(/\n/g,"<br/>")||this.get("cntnt").summary&&this.get("cntnt").summary.replace(/\n/g,"<br/>"),this.get("attach")&&this.get("attach").length){for(var d=this.get("attach").length,e=0;e<d;e++){var f=this.get("attach")[e];if(!f.inline){var g={gId:this.get("gnrl").group.id,Id:f.id,e:c.get("notes").id,et:2,fn:f.name,fs:f.size,p:f.part,ft:f.ft};b.push(g)}}a.NEWATT=b}zmUtil.compose(a,"",{entityType:"note"})},saveAttachment:function(a){var b,c=this,d=[],e=[],f={mode:"addAttach",entityId:this.get("notes").id,groupId:this.get("gnrl").group.id,attachname:d,attachstore:e,streamsView:"Notes",actionType:"addEntity",entityType:"2"};if(a.tempLocation){for(var g=0;g<a.tempLocation.length;g++)d.push(a.tempLocation[g].fP),e.push(a.tempLocation[g].sN);f.attachname=d,f.attachstore=e}a.myAttachment&&(b=JSON.stringify(a.myAttachment),f.attEntObj=b),Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:f,success:function(a){zNote.eventBus.trigger("editNote",c,{id:f.entityId,cattribute:"addAttachment",p:a[0]})}})},addAttachment:function(a){zNote.eventBus.trigger("editNote",self,{id:this.get("notes").id,cattribute:"addAttachment",p:a[0]})},delAtt:function(a,b){$.publish("attachment/closeSlideshow");var c=this,d={mode:"delAttach",entityId:this.get("notes").id,groupId:this.get("gnrl").group.id,attachId:b,streamsView:"Notes",actionType:"delEntity",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:d,success:function(){zNote.eventBus.trigger("editNote",c,{id:d.entityId,cattribute:"removeAttachment",p:d})}})},hideStream:function(){this.set("showstream",!1)},addNote:function(a){var b=this,c={desc:a.desc||this.get("notes").notecont,mode:"addNote",groupId:this.get("gnrl").group.id,entityType:zNote.CONSTANTS.entityType,streamsView:"Notes",actionType:"addEntity",catId:this.get("notes").catid,title:a.title||this.get("cntnt").title,color:a.color||this.get("notes").color};return Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(a){b.set(a[0].data),b.set("showstream",!0);var c=zNote.getNoteDataInListFormat(a[0].data);$.publish("/note/add",[c]),$.publish("/note/addNote",[a[0].data]),c.mode="addNote",$.publish("note/updateCount",[c])}})},saveDescription:function(a){var b,c,d=this;if(this.get("notes").id){if(this.get("notes").notecont!==a){if(0===a.trim().length)return void _zm.succErrMsg("e",zNote.notei18n.descempty);b={desc:a,entityId:this.get("notes").id,mode:"editNContent",groupId:this.get("gnrl").group.id,streamsView:"Notes",actionType:"changeEntity",entityType:"2"},Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:b,success:function(){zNote.eventBus.trigger("editNote",d,{id:b.entityId,cattribute:"desc",p:b})}})}}else{if(0===a.trim().length)return;b={desc:a,color:0},c=this.get("notes"),c.notecont=a,this.set("notes",c),this.debounceAddNote(b)}},addTag:function(a){var b=this,c={tagId:a,entityId:this.get("notes").id,mode:"setTag",groupId:this.get("gnrl").group.id,streamsView:"Notes",actionType:"addLabel",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(){var d=b.get("myact").label.slice();d.push(a),zNote.eventBus.trigger("editNote",b,{id:c.entityId,cattribute:"addLabel",p:d}),$.publish("note/editNote",[{mode:"addLabel",gid:b.get("gnrl").group.id,pid:c.entityId,labelId:a}])}})},removeTag:function(a){var b=this,c={tagId:a,entityId:this.get("notes").id,mode:"removeTag",groupId:this.get("gnrl").group.id,streamsView:"Notes",actionType:"addLabel",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(){var d=b.get("myact").label.slice();d.splice(b.get("myact").label.indexOf(a),1),zNote.eventBus.trigger("editNote",b,{id:c.entityId,cattribute:"removeLabel",p:d}),$.publish("note/editNote",[{mode:"removeLabel",entityId:c.entityId,labelId:a}])}})},saveColor:function(a){var b=this;if(this.get("notes").id){var c={color:a,entityId:this.get("notes").id,mode:"editNColor",groupId:this.get("gnrl").group.id,streamsView:"Notes",actionType:"changeEntity",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(){zNote.eventBus.trigger("editNote",b,{id:c.entityId,cattribute:"color",p:c})}})}else{var d=this.get("notes");d.color=a,this.set("notes",d),this.trigger("change")}},saveFavourite:function(){var a=this,b=!this.get("myact").starred,c=b?"addLabel":"deleteLabel",d={starred:b,entityId:this.get("notes").id,mode:"editNFav",groupId:this.get("gnrl").group.id,streamsView:"Notes",actionType:c,entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:d,success:function(){zNote.eventBus.trigger("editNote",a,{id:d.entityId,cattribute:"starred",p:d}),$.publish("note/editNote",[{mode:"changeFavourite",entityId:d.entityId,starred:b}])}})}})}(),function(){zNote.Views=zNote.Views||{},zNote.Views.NotePreview=React.createClass({displayName:"NotePreview",getInitialState:function(){return{select:""}},componentDidMount:function(){this.props.note.on("change",function(){this.props.note.hasChanged("showstream")&&this.props.note.get("showstream")===!0&&this.props.removeStreamsBar(),this.forceUpdate()}.bind(this)),this.triggerRemoveNoteSubscription=this.triggerRemoveNote.bind(this),this.props.streamList||$.subscribe("/note/delete",this.triggerRemoveNoteSubscription),this.props.streamList!==!0&&(!this.props.options||this.props.options&&this.props.options.print!==!0)&&this.refs.attachment.setAttachmentConfig()},triggerRemoveNote:function(a,b){this.props.note.get("notes").id===b&&this.removeNote()},componentWillUnmount:function(){zNote.eventBus.off("editNote",this.props.note.customEvent,this.props.note),$.unsubscribe("/note/delete",this.triggerRemoveNoteSubscription)},removeNote:function(){var a={id:this.props.note.get("notes").id,namespaceId:this.props.note.get("gnrl").group.id};ReactDOM.unmountComponentAtNode($(ReactDOM.findDOMNode(this.refs.notebox)).parent()[0]),zNote.eventBus.trigger("removeMask",[a])},stopEvents:function(a){zmUtil.stopEvents(a,!0)},render:function(){var j=String("zn_note zn_popNote "+zNote.CONSTANTS.COLORCODE[this.props.note.get("notes").color]);return this.props.streamList?React.createElement("div",{className:j,ref:"notebox",id:this.props.note.get("notes").id},React.createElement("div",null,React.createElement(l,{note:this.props.note,streamList:this.props.streamList}),React.createElement(k,{note:this.props.note,ref:"desc",streamList:this.props.streamList}))):React.createElement("div",{className:j,ref:"notebox",id:this.props.note.get("notes").id},React.createElement(h,{note:this.props.note,showStreamsBar:this.props.showStreamsBar}),React.createElement(a,{note:this.props.note,options:this.props.options,removeNotePreview:this.props.removeNotePreview}),React.createElement("div",null,React.createElement(l,{note:this.props.note,options:this.props.options,ref:"title",parent:this}),React.createElement(k,{note:this.props.note,options:this.props.options,ref:"desc"})),React.createElement("div",{className:"zn_act zn_clear"},React.createElement("div",{className:"SCmb"},React.createElement("div",{className:"SC_flt"},React.createElement("ul",null,React.createElement(g,{note:this.props.note,parent:this}),React.createElement(d,{note:this.props.note,ref:"attachment",parent:this}),React.createElement(b,{note:this.props.note,parent:this}),React.createElement(e,{note:this.props.note,removeNote:this.removeNote}),React.createElement(f,{note:this.props.note,options:this.props.options}))),React.createElement("div",{className:"SC_frt"},React.createElement("ul",null,React.createElement(c,{note:this.props.note,removeNote:this.removeNote}))))),React.createElement(i,{note:this.props.note,removeNote:this.removeNote,options:this.props.options}),function(a){if(a.props.note.get("attach"))return React.createElement(m,{ref:"attDiv",note:a.props.note})}(this))}});var a=React.createClass({displayName:"ToggleStickyPreview",getInitialState:function(){var a=zNote.isStickyNote(this.props.note.toJSON());return{sticky:a}},componentDidMount:function(){this.showToolTips()},componentDidUpdate:function(){this.showToolTips()},showToolTips:function(){this.state.sticky===!0?zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.note.removeSticky,arrow:"top"}):zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.note.makeSticky,arrow:"top"})},stickyOrUnSticky:function(){var a=this;this.state.sticky===!1?(zNote.addAsStickyNote(zNote.getNoteDataInListFormat(this.props.note.toJSON())),setTimeout(function(){var b=zNote.stickyNoteCollectionView.getTopLeft(a.props.note.get("notes").id);$.publish("zm/closeAllOpenDialog",b)}),this.setState({sticky:!0})):(this.setState({sticky:!1}),$.publish("/note/closeStickyNote",[a.props.note.get("notes").id,a.props.note.get("gnrl").group.id]))},handleMakeSticky:function(){var a=this;a.props.note.get("notes").id?a.stickyOrUnSticky():a.props.note.addNote({}).done(function(){a.stickyOrUnSticky()})},render:function(){var a=this.state.sticky?"SC_mkStky active":"SC_mkStky";a+=this.props.options&&this.props.options.previewCard?" SC_dyn":"";var b=this.state.sticky?"msi-stiPNotes":"msi-stiNotes";return React.createElement("div",{className:a,ref:"stickyNote",onClick:this.handleMakeSticky},React.createElement("i",{className:b}))}}),b=React.createClass({displayName:"InsertImgPreview",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.insertImgIcon,text:zNote.notei18n.tooltips.insertImg,arrow:"top"})},handleInsertImg:function(){var a,b=this;a=this.props.note.get("notes").id?{componentId:"notes",attachFrom:["insertImage"],insertImage:{type:".png,.jpg,.jpeg,.gif",maxSize:3145728,uploadAPI:zmail.conPath+"/NotesAction.do?mode=addAttach",requireParamToUpload:{groupId:b.props.note.get("gnrl").group.id,mode:"addAttach",entityId:b.props.note.get("notes").id,actionType:"addEntity",streamsView:"Notes",entityType:2,inLine:"true"},onUpload:function(a){b.props.parent.refs.desc.setImage(a[1])}}}:{componentId:"notes",attachFrom:["insertImage"],insertImage:{type:".png,.jpg,.jpeg,.gif",maxSize:3145728,uploadAPI:"/zm/attach.do?mode=temp",requireParamToUpload:{type:"f",accId:zmail.accId,tSize:0},onUpload:function(a){b.props.parent.refs.desc.setImage1(a)}}},this.attRefObj?(b.attRefObj.updateConfig(a),this.attRefObj.init()):zmUtil.initAttachComponent(a,function(a){b.attRefObj=a})},render:function(){var a=this.props.note.get("gnrl").by!==zmail.zuid?"SC_dyn":"";return React.createElement("li",{id:"znImg",ref:"insertImgIcon",className:a,onClick:this.handleInsertImg},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-image"}))))}}),c=React.createClass({displayName:"AssociatedMailPreview",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.mailopen,text:zNote.notei18n.tooltips.openmail,arrow:"top"})},handleViewAssociatedMail:function(){$.publish("zm/closeAllOpenDialog");var a={};this.props.note.get("notes").email.accid!==zmail.accId&&(a={actionType:"viewGroupMailEntity",entityId:this.props.note.get("notes").email.msgid,entityType:"1",streamsView:"true",streams:!0,groupId:this.props.note.get("gnrl").by,accId:this.props.note.get("notes").email.accid}),zmList.getMailData({msgId:this.props.note.get("notes").email.msgid,opentype:2,type:"lt",src:"external",eprm:a})},render:function(){var a=this.props.note.get("notes").email&&!$.isEmptyObject(this.props.note.get("notes").email)?"zn_actVIcon":"zn_actVIcon SC_dyn";return React.createElement("li",{id:"znmail",className:a,ref:"mailopen",onClick:this.handleViewAssociatedMail},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-mailopen"}))))}}),d=React.createClass({displayName:"AttachPreview",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.attachIcon,text:zNote.notei18n.tooltips.addAttach,arrow:"top"})},setAttachmentConfig:function(){var a,b=this;a={componentId:"notes",isNewImp:!0,attachFrom:["desktop","myAttachchment","zDocs","otherCloud"],currentAttachedSize:0,eleId:$(ReactDOM.findDOMNode(b.props.parent.refs.attDiv)),autoLaunch:!1,onAllUploadFinish:{handler:function(a){b.props.note.saveAttachment(a)},resetData:!0,removeAttachDOM:!0},$dropCenter:$(ReactDOM.findDOMNode(this.props.parent.refs.notebox))},b.props.note.get("notes").id?a.beforeAttach=!1:a.beforeAttach=function(a){b.props.note.addNote({}).done(function(){b.attRefObj.updateConfig({}),a()})},zmUtil.initAttachComponent(a,function(a){b.attRefObj=a})},handleAddAttachment:function(){var a=this,b=a.attRefObj.configJSON;a.props.note.get("notes").id?b.beforeAttach=!1:b.beforeAttach=function(b){a.props.note.addNote({}).done(function(){a.attRefObj.updateConfig({}),b()})},a.attRefObj.updateConfig(b),a.attRefObj.init()},render:function(){var a=this.props.note.get("gnrl").by!==zmail.zuid?"SC_dyn":"";return React.createElement("li",{id:"znattach",ref:"attachIcon",className:a,onClick:this.handleAddAttachment},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-attachment"}))))}}),e=React.createClass({displayName:"ComposeMailPreview",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.sendmail,text:zNote.notei18n.tooltips.sendMail,arrow:"top"})},handleSendMail:function(){$.publish("zm/closeAllOpenDialog"),this.props.note.sendAsMail()},render:function(){var a=this.props.note.get("notes").id?"":"SC_dyn";return React.createElement("li",{id:"znsend",ref:"sendmail",className:a,onClick:this.handleSendMail},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-send"}))))}}),f=React.createClass({displayName:"MakeStickyPreview",getInitialState:function(){var a=zNote.isStickyNote(this.props.note.toJSON());return{sticky:a}},componentDidMount:function(){this.showToolTips()},componentDidUpdate:function(){this.showToolTips()},showToolTips:function(){this.state.sticky===!0?zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.note.removeSticky,arrow:"top"}):zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.note.makeSticky,arrow:"top"})},stickyOrUnSticky:function(){var a=this;this.state.sticky===!1?(zNote.addAsStickyNote(zNote.getNoteDataInListFormat(this.props.note.toJSON())),setTimeout(function(){var b=zNote.stickyNoteCollectionView.getTopLeft(a.props.note.get("notes").id);$.publish("zm/closeAllOpenDialog",b)}),this.setState({sticky:!0})):(this.setState({sticky:!1}),$.publish("/note/closeStickyNote",[a.props.note.get("notes").id,a.props.note.get("gnrl").group.id]))},handleMakeSticky:function(){var a=this;a.props.note.get("notes").id?a.stickyOrUnSticky():a.props.note.addNote({}).done(function(){a.stickyOrUnSticky()})},render:function(){if(!this.props.options||!this.props.options.previewCard)return null;var a=this.state.sticky?"msi-stiPNotes":"msi-stiNotes";return React.createElement("li",{id:"znsticky",ref:"stickyNote",onClick:this.handleMakeSticky},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:a}))))}}),g=React.createClass({displayName:"ColorPreview",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.palette,text:zNote.notei18n.tooltips.changeColor,arrow:"top"})},handleSetColor:function(a){var b=this;if("true"===$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible")){var c=$('<li><div class="zn_clr"><div class="zn_clr1"></div><div class="zn_clr2"></div><div class="zn_clr3"></div><div class="zn_clr4"></div></div></li>');c.find("."+zNote.CONSTANTS.COLORCODE[this.props.note.get("notes").color]).append("<i class=msi-tick></i>");var d={par:a.target,showArrow:!0,liDom:c,direction:"bottom",ulClass:"zn_clrSel",spanClass:"minwid"};zmsuite.showMenu(d),$(c[0]).find("div").children("div").off("click").on("click",function(a){a.stopPropagation(),$("#zm_dropDown").remove(),$(ReactDOM.findDOMNode(b.refs.palette)).attr("data-visible","false"),b.props.note.saveColor(zNote.CONSTANTS.COLOR[this.className])})}$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-current","false"),$(ReactDOM.findDOMNode(this.props.parent.refs.notebox)).addClass("sel")},handleSetAttributes:function(){$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-current","true"),"true"===$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible")?$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible","false"):$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible","true")},render:function(){var a=this.props.note.get("gnrl").by!==zmail.zuid?"SC_dyn":"";return React.createElement("li",{id:"zncolor",className:a,ref:"palette",onMouseDown:this.handleSetAttributes,onClick:this.handleSetColor},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-nclr"}))))}}),h=React.createClass({displayName:"StreamsShowPreview",handleShowStreamsBar:function(){this.props.showStreamsBar(this.props.note.toJSON())},render:function(){var a;return a=this.props.note.get("showstream")&&this.props.note.get("notes").id?"zn_commentsOpen":"zn_commentsOpen SC_dyn",React.createElement("span",{className:a,ref:"showstream",onClick:this.handleShowStreamsBar},React.createElement("i",{className:"msi-nextHR"}))}}),i=React.createClass({displayName:"GroupBookPreview",render:function(){return!this.props.note.get("gnrl").group.isGroup&&this.props.note.get("gnrl").group.id!==zmail.zuid&&this.props.options&&this.props.options.print?React.createElement("div",{id:"grpDiv",className:"zn_folder zn_clear SC_dyn"}):React.createElement("div",{id:"grpDiv",className:"zn_folder zn_clear"},React.createElement(j,{note:this.props.note,removeNote:this.props.removeNote}))}}),j=React.createClass({displayName:"BookPreview",handleChangeBook:function(){var a;if(this.props.note.get("gnrl").by===zmail.zuid){var b=znNote.getCategoryArray(this.props.note.get("gnrl").group.id),c=this,d={};d.parentDOM=ReactDOM.findDOMNode(this.refs.book),d.displayAs="popup",d.onSelect=function(b){c.props.note.changeBook(b),a.hide()},(this.props.note.get("namespaceId")===zmail.zuid||zmCont.getGroup()[this.props.note.get("gnrl").group.id]&&zmCont.getGroup()[this.props.note.get("gnrl").group.id].isOwner)&&(d.onCreate=function(b){znNote.sendNewCatReq(b,{},c.props.note.get("gnrl").group.id).done(function(b){c.props.note.changeBook(b[1][0].catId),a.hide()})}),d.onHide=function(){$("#zm_dropDown").remove()},d.dataCallback=function(){return b},a=zmUtil.createFLComp("category",d),a.show()}},handleChangeGroup:function(){if(this.props.note.get("gnrl").by===zmail.zuid&&zmail.showFeature){var a,b=znNote.getGroupArray(),c=this,d={};d.parentDOM=ReactDOM.findDOMNode(this.refs.group),d.displayAs="popup",d.showCreate=!0,d.onSelect=function(b){c.props.note.changeGroup(b),a.hide()},d.onHide=function(){$("#zm_dropDown").remove()},d.dataCallback=function(){return b},a=zmUtil.createFLComp("group",d),a.show()}},render:function(){var a=znNote.getGroupName(this.props.note.get("gnrl").group.id),b=znNote.getNamefrmCatObj(this.props.note.get("notes").catid,this.props.note.get("gnrl").group.id),c=""===a?"zn_cgy SC_dyn":"zn_cgy";return React.createElement("div",{className:c,ref:"cgy",id:"zncat"},React.createElement("font",{id:"zngroup",className:"zn_ngrp",ref:"group",onClick:this.handleChangeGroup},a),React.createElement("i",{className:"msi-rarrow"}),React.createElement("font",{id:"znscat",ref:"book",className:"zn_nbook",onClick:this.handleChangeBook},b))}}),k=React.createClass({displayName:"DescriptionPreview",getInitialState:function(){this.ispaste=!1;var a=this.props.note.get("notes").id?2e4:5e3;this.checkSaveDesc=_.debounce(this.setDescription,a);var b=!1;return this.props.note.get("notes").notecont&&this.props.note.get("notes").notecont.length>=255&&(b=!0),{height:0,readmore:b,istagCheck:!1}},shouldComponentUpdate:function(a,b){return a.note.get("notes").notecont!==this.descOnView},setDescription:function(a,b){b||this.ispaste===!1&&this.state.istagCheck===!1&&(this.descOnView=znBox.domParser(znBox.getContentEditableText($(ReactDOM.findDOMNode(this.refs.content)))),this.props.note.saveDescription(znBox.domParser(znBox.getContentEditableText($(ReactDOM.findDOMNode(this.refs.content))))))},componentWillUnmount:function(){$(ReactDOM.findDOMNode(this.refs.content)).off("mousedown","a"),$(ReactDOM.findDOMNode(this.refs.content)).off("click","a"),$(ReactDOM.findDOMNode(this.refs.content)).off("focus"),this.checkSaveDesc({},!0)},componentDidMount:function(){this.setState({height:$(ReactDOM.findDOMNode(this.refs.content)).height()});var a=this,b=function(b){a.props.note.addTag(b.id)},c=function(){a.setState({istagCheck:!0})},d=function(){a.setState({istagCheck:!1})},e={compare:["hashname"],LType:"2",OType:"4",callback:b,initialCallback:c,finallyCallback:d};e.getContentArray=function(){return znBox.getLabelArray(a.props.note.get("myact").label)};var f=function(a){a.stopPropagation(),$("#ngoto").remove();var b=a.target.getBoundingClientRect().left,c=a.target.getBoundingClientRect().top+(a.target.getBoundingClientRect().bottom-a.target.getBoundingClientRect().top);$("body").append('<span id="ngoto" class="zn_lnkBar" style="left: '+b+"px; top: "+c+'px; right: auto;z-index:1001"><a id=nlink href='+this.href+' target="_blank">Go to link</a></span>'),$("#ngoto").on("mousedown",function(a){a.stopPropagation()}),$("#ngoto").on("click",function(){$("#ngoto").remove()}),$("#nlink").on("click",function(a){a.stopPropagation(),$("#ngoto").remove()})};this.props.streamList!==!0&&($(ReactDOM.findDOMNode(this.refs.content)).on("focus",a.handleSaveSelection),$(ReactDOM.findDOMNode(this.refs.content)).on("mousedown","a",f),$(ReactDOM.findDOMNode(this.refs.content)).on("click","a",function(a){a.preventDefault(),a.stopPropagation()}))},setImage1:function(a){var b=this.selection;$(ReactDOM.findDOMNode(this.refs.content)).trigger("focus",!0,!0);var c=zmail.conPath+"/FileDownload/"+zmUtil.getDummyFilename(a.name)+"?mode=tmpview&entityType=1&accId="+zmail.accId+"&fpath="+a.fP+"&fstorename="+a.sN,d=znBox.restoreSelectionNew($(ReactDOM.findDOMNode(this.refs.content))[0],b);d||$(ReactDOM.findDOMNode(this.refs.content)).trigger("focus"),znBox.isIE?znBox.insertHtmlAtCaret("<img src="+c+"></img>"):document.execCommand("insertHTML",!1,"<img src="+c+"></img>")},setImage:function(a){var b=this.selection,c=Object.keys(a[0].inline[0])[0],d=zmail.conPath+"/FileDownload/"+zmUtil.getDummyFilename(a[0].inline[0][c].fn)+"?attachId="+a[0].inline[0][c].Id+"&entityType=2&entityId="+this.props.note.get("notes").id+"&actionType=viewGroupEntity&groupId="+this.props.note.get("gnrl").group.id+"&streamsView=Notes&mode=view&app=notes&attachType=inline",e=znBox.restoreSelectionNew(ReactDOM.findDOMNode(this.refs.content),b);e||$(ReactDOM.findDOMNode(this.refs.content)).trigger("focus"),znBox.isIE?znBox.insertHtmlAtCaret("<img id="+a[0].inline[0][c].Id+" src="+d+"></img>"):document.execCommand("insertHTML",!1,"<img id="+a[0].inline[0][c].Id+" src="+d+"></img>")},handleSetHeight:function(a){this.selection=znBox.saveSelectionNew(ReactDOM.findDOMNode(this.refs.content)),this.state.height!==$(ReactDOM.findDOMNode(this.refs.content)).height()&&this.setState({height:$(ReactDOM.findDOMNode(this.refs.content)).height()}),32===a.keyCode&&zNote.updateLinks(ReactDOM.findDOMNode(this.refs.content)),this.checkSaveDesc()},handleSaveSelection:function(a,b,c){c||(this.selection=znBox.saveSelectionNew(ReactDOM.findDOMNode(this.refs.content)))},restoreSelection:function(){znBox.restoreSelectionNew(ReactDOM.findDOMNode(this.refs.content),this.selection)},handlePaste:function(a){var b=this;this.ispaste=!0,znBox.handlePaste(a.target),setTimeout(function(){b.ispaste=!1},200)},handleKeyDown:function(a){zNote.disable(a)?27!==a.keyCode&&27!==a.which||this.setDescription():a.preventDefault()},fillSummary:function(){this.setState({readmore:!1})},handleClickHandler:function(a){if("IMG"===a.target.nodeName){var b=a.target.src,c=[],d={ft:101,fn:" ",src:b};c.push(d),zmUtil.initAttSlideShow(c,0,!0)}else this.handleSaveSelection(a)},render:function(){var a=this,b=this.props.streamList||this.props.note.get("gnrl").by!==zmail.zuid||this.props.options&&this.props.options.print===!0?"false":"true",c=zNote.linkify(this.props.note.get("notes").notecont).replace(/\n/g,"<br />"),d=this.props.options&&"true"===this.props.options.disableShortcuts?"false":"true",e=zNote.notei18n.placeholder.writeSome;return"false"===b&&this.props.streamList&&this.state.readmore?React.createElement("div",{className:"zn_base"},React.createElement("div",{className:"zn_cont zn_trunc","data-enableshortcuts":d,"data-plhr":e,ref:"content",onKeyDown:this.handleKeyDown,onPaste:this.handlePaste,onClick:this.handleClickHandler,onKeyUp:this.handleSetHeight,onBlur:function(b,c){a.setDescription(b,c),a.checkSaveDesc({},!0)},contentEditable:b,dangerouslySetInnerHTML:{__html:c}}),React.createElement("div",{className:"SC_lnk",onClick:this.fillSummary},"Read More ...")):React.createElement("div",{className:"zn_base"},React.createElement("div",{className:"zn_cont","data-enableshortcuts":d,"data-plhr":e,ref:"content",onKeyDown:this.handleKeyDown,onPaste:this.handlePaste,onClick:this.handleClickHandler,onKeyUp:this.handleSetHeight,onBlur:function(b,c){a.setDescription(b,c),a.checkSaveDesc({},!0)},contentEditable:b,dangerouslySetInnerHTML:{__html:c}}))}}),l=React.createClass({displayName:"TitlePreview",getInitialState:function(){var a=this.props.note.get("notes").id?2e4:5e3;return this.checkSaveTitle=_.debounce(this.setTitle,a),{}},componentWillUnmount:function(){zmail.showFeature&&this.checkSaveTitle({},!0)},shouldComponentUpdate:function(a,b){return a.note.get("notes").title!==this.titleOnView},handleKeyDown:function(a){13===a.keyCode?(a.preventDefault(),ReactDOM.findDOMNode(this.props.parent.refs.desc.refs.content).focus()):27===a.keyCode||27===a.which?this.setTitle():zNote.disable(a)||a.preventDefault()},setTitle:function(a,b){b||($(ReactDOM.findDOMNode(this.refs.title)).text().trim().length||$(ReactDOM.findDOMNode(this.refs.title)).text(""),this.titleOnView=znBox.domParser(znBox.getContentEditableText($(ReactDOM.findDOMNode(this.refs.title)))),this.props.note.saveTitle($(ReactDOM.findDOMNode(this.refs.title)).text()))},handlePasteForTitle:function(a){var b=zNote.CONSTANTS.MAXCHARACTER.TITLE-ReactDOM.findDOMNode(this.refs.title).textContent.length;this.handleSetMaxCharacter(a)&&(this.ispaste=!0,znBox.handlePaste(a.target,void 0,b),this.ispaste=!1)},handleKeyUp:function(){zmail.showFeature&&this.checkSaveTitle()},handleSetMaxCharacter:function(a){var b=zNote.CONSTANTS.MAXCHARACTER.TITLE-ReactDOM.findDOMNode(this.refs.title).textContent.length;return!(b<=0)||(a.preventDefault(),_zm.succErrMsg("e",zNote.notei18n.titexceed),!1)},render:function(){var a=this,b=zNote.notei18n.placeholder.title,c=this.props.streamList||this.props.note.get("gnrl").by!==zmail.zuid||this.props.options&&this.props.options.print?"false":"true",d=this.props.note.get("cntnt").title&&this.props.note.get("cntnt").title!==znBox.CONTS.defaultTitle?znBox.spCharRep(this.props.note.get("cntnt").title):"",e=this.props.options&&"true"===this.props.options.disableShortcuts?"false":"true";return React.createElement("div",{className:"zn_tit","data-enableshortcuts":e,onPaste:this.handlePasteForTitle,onKeyPress:this.handleSetMaxCharacter,onKeyUp:this.handleKeyUp,onKeyDown:this.handleKeyDown,ref:"title",contentEditable:c,onBlur:function(){a.setTitle(),zmail.showFeature&&a.checkSaveTitle({},!0)},"data-plhr":b},d)}}),m=React.createClass({displayName:"AttachmentViewPreview",viewImage:function(a,b){for(var c=this,d=[],e=this.props.note.get("attach"),f=0,g=e.length;f<g;f++)e[f].inline||d.push({Id:e[f].id,e:this.props.note.get("notes").id,et:2,ft:e[f].ft,fs:e[f].size,fn:e[f].name,p:e[f].part,tn:!1,gId:this.props.note.get("gnrl").group.id,u:""});var h={},i={},j=[];i.trash={"class":"msi-trash",title:zNote.notei18n.tooltips.deleteAttach,after:".msi-download",events:[{name:"click",listener:function(a,b,d){c.props.note.delAtt(b.e,b.Id,d)}}]},j.push(".msi-fav"),j.push("#etyIcon"),h.extraIcons=i,h.hideOptions=j,zmUtil.initAttSlideShow(d,b,!1,h)},render:function(){var a,b,c=this,d=this.props.note.get("attach")&&_.filter(this.props.note.get("attach"),function(a){return!a.inline});return d&&d.length?React.createElement("div",{className:"zn_folder zn_clear zn_attach"},React.createElement("div",{className:"icn"},React.createElement("i",{className:"msi-attachpin"})),d.map(function(d,e){var f=d,g=zmUtil.fileTyp(f.name);if("msi-attimg"===g[1])b=c.props.note.get("notes").id===zmail.zuid?zmail.conPath+"/FileDownload/"+zmUtil.getDummyFilename(f.name)+"?attachId="+f.id+"&entityType=2&entityId="+c.props.note.get("notes").id+"&groupId="+c.props.note.get("gnrl").group.id+"&mode=thb&app=notes":zmail.conPath+"/FileDownload/"+zmUtil.getDummyFilename(f.name)+"?attachId="+f.id+"&entityType=2&entityId="+c.props.note.get("notes").id+"&groupId="+c.props.note.get("gnrl").group.id+"&streamsView=Notes&actionType=viewGroupEntity&mode=thb&app=notes",
a=React.createElement("img",{src:b,title:f.name});else{var h=g[1]+" sc_big";a=React.createElement("i",{className:h,title:f.name})}return React.createElement("div",{className:"zmL zmAch",key:f.id,onClick:function(){c.viewImage(f,e)}},React.createElement("div",{className:"zmLst"},React.createElement("div",{className:"zmDtl"},React.createElement("div",{className:"zmImg"},a))))})):React.createElement("div",{className:"zn_folder zn_clear SC_dyn zn_attach"},React.createElement("div",{className:"icn"},React.createElement("i",{className:"msi-attachpin"})))}})}(),function(){zNote.Models=zNote.Models||{},zNote.Models.addNote=Zmail.Model.extend({initialize:function(){},save:function(a,b){var c=b,d=function(a){var b=zNote.getNoteDataInListFormat(a[0].data);$.publish("/note/add",[b]),$.publish("/note/addNote",[a[0].data]),c.cat=b.cat,c.namespaceId=b.namespaceId,$.publish("note/updateCount",[c]),c.callback&&c.callback(),c.sticky&&zNote.addAsStickyNote(b)};return a.catId?zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:d,p:a,ep:c}):void znNote.getGenCat({gid:a.groupId}).done(function(){return a.catId=znNote.getGeneralCatId(a.groupId),zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:d,p:a,ep:c})})}})}(),function(){zNote.Views=zNote.Views||{},zNote.Views.addNoteViewReact=React.createClass({displayName:"addNoteViewReact",getInitialState:function(){return this.ispaste=!1,this.title=this.props.note.get("title")||zNote.unSavedData.title||"",this.desc=this.props.note.get("desc")||zNote.unSavedData.desc||"",this.props.note.get("attEntObj")?this.attArray=this.props.note.get("attEntObj").slice():this.attArray=[],{namespaceId:this.props.note.get("namespaceId"),starred:this.props.note.get("starred"),color:this.props.note.get("color"),catId:this.props.note.get("catId"),addparams:this.props.note.get("addparams"),attachpath:[],attachstore:[],attachname:[],attEntObj:this.props.note.get("attEntObj")||[],adding:!1,stickyEnabled:!1}},componentDidMount:function(){this.sticky=!1,this.setState({height:$(ReactDOM.findDOMNode(this.refs.content)).height()}),$(ReactDOM.findDOMNode(this.refs.content)).focus(),$(ReactDOM.findDOMNode(this.refs.content)).on("mousedown","a",function(a){a.stopPropagation(),$("#ngoto").remove();var b=a.target.getBoundingClientRect().left,c=a.target.getBoundingClientRect().top+(a.target.getBoundingClientRect().bottom-a.target.getBoundingClientRect().top);$("body").append('<span id="ngoto" class="zn_lnkBar" style="left: '+b+"px; top: "+c+'px; right: auto;z-index:1001"><a id=nlink href='+this.href+' target="_blank">Go to link</a></span>'),$("#ngoto").on("mousedown",function(a){a.stopPropagation()}),$("#ngoto").on("click",function(){$("#ngoto").remove()}),$("#nlink").on("click",function(a){a.stopPropagation(),$("#ngoto").remove()})}),$(ReactDOM.findDOMNode(this.refs.content)).on("click","a",function(a){a.stopPropagation()}),this.setAttachmentConfig(),this.showToolTips()},componentWillUnmount:function(){$(ReactDOM.findDOMNode(this.refs.content)).off("mousedown","a"),$(ReactDOM.findDOMNode(this.refs.content)).off("click","a")},componentDidUpdate:function(){this.sticky===!0?zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.note.removeSticky,arrow:"top"}):zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.note.makeSticky,arrow:"top"})},showToolTips:function(){this.sticky===!0?zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.note.removeSticky,arrow:"top"}):zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.note.makeSticky,arrow:"top"}),this.refs.insertImgIcon&&zmComponent.tooltip({elm:this.refs.insertImgIcon,text:zNote.notei18n.tooltips.insertImg,arrow:"top"}),this.refs.attachIcon&&zmComponent.tooltip({elm:this.refs.attachIcon,text:zNote.notei18n.tooltips.addAttach,arrow:"top"}),this.refs.palette&&zmComponent.tooltip({elm:this.refs.palette,text:zNote.notei18n.tooltips.changeColor,arrow:"top"}),this.refs.cgy&&zmComponent.tooltip({elm:this.refs.cgy,text:zNote.notei18n.tooltips.moveNote,arrow:"top"}),this.refs.group&&zmComponent.tooltip({elm:this.refs.group,text:zNote.notei18n.tooltips.changeGroup,arrow:"top"})},handleSetTitle:function(){this.ispaste===!1&&($(ReactDOM.findDOMNode(this.refs.title)).text().trim().length?this.title=$(ReactDOM.findDOMNode(this.refs.title)).text().trim():($(ReactDOM.findDOMNode(this.refs.title)).text(""),this.title=""),this.forceUpdate())},handleSetDescription:function(){this.ispaste===!1&&(this.desc=znBox.domParser(znBox.getContentEditableText($(ReactDOM.findDOMNode(this.refs.content)))))},setFavourite:function(){var a=!this.state.starred;this.setState({starred:a})},clearValues:function(){this.title="",this.desc="",this.setState({color:_.random(0,3)}),this.forceUpdate()},setBook:function(a){this.setState({catId:a})},setGroup:function(a){this.setState({namespaceId:a}),this.setState({catId:znNote.getGeneralCatId(a)})},handleChangeGroup:function(){var a,b=znNote.getGroupArray(),c=this,d={};d.parentDOM=ReactDOM.findDOMNode(this.refs.group),d.displayAs="popup",d.showCreate=!0,d.onSelect=function(b){c.setGroup(b),a.hide()},d.onHide=function(){$("#zm_dropDown").remove()},d.dataCallback=function(){return b},a=zmUtil.createFLComp("group",d),a.show()},handleChangeBook:function(){var a,b=znNote.getCategoryArray(this.state.namespaceId),c=this,d={};d.parentDOM=ReactDOM.findDOMNode(this.refs.cgy),d.displayAs="popup",d.showCreate=!0,d.onSelect=function(b){c.setBook(b),a.hide()},d.onHide=function(){$("#zm_dropDown").remove()},d.onCreate=function(b){znNote.sendNewCatReq(b,{},c.state.namespaceId).done(function(b){c.setBook(b[1][0].catId),a.hide()})},d.dataCallback=function(){return b},a=zmUtil.createFLComp("category",d),a.show()},handleSetColor:function(a){var b=this,c=$('<li><div class="zn_clr"><div class="zn_clr1"></div><div class="zn_clr2"></div><div class="zn_clr3"></div><div class="zn_clr4"></div></div></li>');c.find("."+zNote.CONSTANTS.COLORCODE[this.state.color]).append("<i class=msi-tick></i>");var d={par:a.target,showArrow:!0,liDom:c,direction:"bottom",ulClass:"zn_clrSel",spanClass:"minwid"};zmsuite.showMenu(d),$(c[0]).find("div").children("div").off("click").on("click",function(){a.stopPropagation(),$("#zm_dropDown").remove(),b.setState({color:zNote.CONSTANTS.COLOR[this.className]})}),$(ReactDOM.findDOMNode(this.refs.notebox)).addClass("sel")},save:function(){var a=this,b=[];zNote.unSavedData.desc="",zNote.unSavedData.title="",this.handleSetTitle(),this.handleSetDescription();var c={desc:this.desc,color:this.state.color,catId:this.state.catId,title:this.title,mode:"addNote",groupId:this.state.namespaceId,streamsView:"Notes",actionType:"addEntity",entityType:"2",attachstore:this.state.attachstore,attachname:this.state.attachpath},d={desc:this.desc,mode:"addNote",title:this.title,tagId:[],color:this.state.color,cat:this.state.catId,sticky:this.sticky,namespaceId:this.state.namespaceId};this.state.attEntObj.length&&(_.each(this.state.attEntObj,function(a){b.push(zmAttachComponent.utility.filterMyAttachmentKey(a))}),c.attEntObj=JSON.stringify(b)),this.state.addparams&&(c=$.extend(c,this.state.addparams),d=$.extend(d,this.state.addparams));var e={allowEmpty:this.sticky};zNote.addNoteValidations(c,e)||(d.callback=this.props.addCallback,this.setState({adding:!0}),this.props.note.save(c,d).always(function(b){a.setState({adding:!1})}))},streamsAdd:function(a,b){var c=this,d=$.Deferred();this.handleSetTitle(),this.handleSetDescription();var e=znNote.getGeneralCatId(a.groupId||this.state.namespaceId);this.setState({catId:e});var f={desc:this.desc,color:this.state.color,catId:e,title:this.title,mode:"addNote",groupId:a.groupId||this.state.namespaceId,streamsView:"Notes",actionType:"addEntity",lockinvites:a.lockinvites,entityType:"2"},g={desc:this.desc,mode:"addNote",title:this.title,tagId:[],color:this.state.color,cat:e,namespaceId:a.groupId||this.state.namespaceId};return zNote.addNoteValidations(f)?d.resolve().promise():(g.callback=function(){c.clearValues(),b&&b()},this.props.note.save(f,g).always(function(){d.resolve()}),d.promise())},handleCancel:function(){zNote.unSavedData.desc="",zNote.unSavedData.title="",zNote.eventBus.trigger("removeMask",this),this.props.cancelCallback&&this.props.cancelCallback()},checkDataAlert:function(a){var b=a.bind(null,this);zNote.unSavedData.desc=this.getNoteDetails().desc,zNote.unSavedData.title=this.getNoteDetails().title,b()},handleOnRemoveAttachment:function(a,b){var c=this.state.attachpath.slice(),d=c.indexOf(b.attachpath);c.splice(d,1),this.setState({attachpath:c});var e=this.state.attachstore.slice();e.splice(d,1),this.setState({attachstore:e});var f=this.state.attachname.slice();f.splice(d,1),this.setState({attachname:f});var g=_.filter(this.attArray,function(a){if(a.fP!==b.attachpath)return a});this.attArray=g},triggerFileInputClickEvent:function(){var a=this;if(this.insertRefObj)this.insertRefObj.init();else{var b={componentId:"notes",attachFrom:["insertImage"],insertImage:{type:".png,.jpg,.jpeg,.gif",maxSize:3145728,uploadAPI:"/zm/attach.do?mode=temp",requireParamToUpload:{type:"f",accId:zmail.accId,tSize:0},onUpload:function(b){a.setImage(b)}}};zmUtil.initAttachComponent(b,function(b){a.insertRefObj=b})}},setAttachmentConfig:function(){var a=this;if(!this.attRefObj){var b={componentId:"notes",isNewImp:!0,attachFrom:["desktop","myAttachchment","zDocs","otherCloud"],currentAttachedSize:0,eleId:$(ReactDOM.findDOMNode(a.refs.attDiv)),autoLaunch:!1,onAddAttachment:function(b,c,d){if(c.remove(),"myAttachment"===d){var e=a.state.attEntObj.slice();e.push(b),a.attArray.push(b),a.setState({attEntObj:e})}else a.attArray.push(b),a.saveAttachment(b)},$dropCenter:$(ReactDOM.findDOMNode(this.refs.notebox))};zmUtil.initAttachComponent(b,function(b){a.attRefObj=b})}},triggerAttachComponent:function(){this.attRefObj.init()},removeMyAttachment:function(a){var b=this.state.attEntObj.slice(),c=_.filter(b,function(b){if(b.uniqueId!==a.uniqueId)return b}),d=_.filter(this.attArray,function(b){if(b.uniqueId!==a.uniqueId)return b});this.attArray=d,this.setState({attEntObj:c})},setImage:function(a){var b=this.selection;$(ReactDOM.findDOMNode(this.refs.content)).trigger("focus",!0,!0);var c=zmail.conPath+"/FileDownload/"+zmUtil.getDummyFilename(a.name)+"?mode=tmpview&entityType=1&accId="+zmail.accId+"&fpath="+a.fP+"&fstorename="+a.sN,d=znBox.restoreSelectionNew($(ReactDOM.findDOMNode(this.refs.content))[0],b);d||$(ReactDOM.findDOMNode(this.refs.content)).trigger("focus"),znBox.isIE?znBox.insertHtmlAtCaret("<img src="+c+"></img>"):document.execCommand("insertHTML",!1,"<img src="+c+"></img>")},handleSetHeight:function(a){this.selection=znBox.saveSelectionNew(ReactDOM.findDOMNode(this.refs.content)),zmail.isWatchUser&&32===a.keyCode&&zNote.updateLinks(ReactDOM.findDOMNode(this.refs.content))},handleSaveSelection:function(a,b,c){c||(this.selection=znBox.saveSelectionNew(ReactDOM.findDOMNode(this.refs.content)))},saveAttachment:function(a){var b=this.state.attachpath.slice(),c=this.state.attachname.slice(),d=this.state.attachstore.slice();c.push(a.name),b.push(a.fP),d.push(a.sN),this.setState({attachname:c}),this.setState({attachpath:b}),this.setState({attachstore:d})},getNoteValues:function(){var a={title:this.title,desc:this.desc,catId:this.state.catId,groupId:this.state.namespaceId,color:this.state.color};return a},getNoteDetails:function(){this.handleSetTitle(),this.handleSetDescription();var a={title:this.title,desc:this.desc,catId:this.state.catId,groupId:this.state.namespaceId,color:this.state.color};return a},handlePaste:function(a){var b=this;this.ispaste=!0,znBox.handlePaste(a.target),setTimeout(function(){b.ispaste=!1,b.handleKeyPress(a)},200)},handleKeyDown:function(a){13===a.keyCode&&(a.preventDefault(),ReactDOM.findDOMNode(this.refs.content).focus())},handleKeyPress:function(a){!this.state.stickyEnabled&&zNote.checkForPrintableKeys(a)&&this.setState({stickyEnabled:!0})},handleTitleFocused:function(){$(ReactDOM.findDOMNode(this.refs.title)).text()===znBox.CONTS.defaultTitle&&$(ReactDOM.findDOMNode(this.refs.title)).text("").attr("data-plhr",!1)},handlePasteForTitle:function(a){var b=zNote.CONSTANTS.MAXCHARACTER.TITLE-ReactDOM.findDOMNode(this.refs.title).textContent.length;this.handleKeyPress(a),this.setMaxCharacter(a)&&(this.ispaste=!0,znBox.handlePaste(a.target,void 0,b),this.ispaste=!1)},handleSetMaxCharacter:function(a){var b=zNote.CONSTANTS.MAXCHARACTER.TITLE-ReactDOM.findDOMNode(this.refs.title).textContent.length;return this.handleKeyPress(a),!(b<=0)||(a.preventDefault(),_zm.succErrMsg("e",zNote.notei18n.titexceed),!1)},handleStickyNote:function(){this.state.stickyEnabled&&(this.sticky=!0,this.save())},render:function(){var b=this,c=!0,d=zNote.notei18n.placeholder.title,e=zNote.notei18n.placeholder.writeSome;this.props.streams&&(c=!1);var f="zn_note zn_popNote "+zNote.CONSTANTS.COLORCODE[this.state.color],g=znNote.getGroupName(this.state.namespaceId),h=znNote.getNamefrmCatObj(this.state.catId,this.state.namespaceId),i=this.state.stickyEnabled?"":"SC_disIco",j=this.sticky?i+" SC_mkStky active":i+" SC_mkStky",k=this.sticky?"msi-stiPNotes":"msi-stiNotes",l=zmail.isWatchUser?zNote.linkify(this.desc).replace(/\n/g,"<br />"):this.desc.replace(/\n/g,"<br />");return this.props.streams?React.createElement("div",{className:zNote.CONSTANTS.COLORCODE[this.state.color],ref:"notebox"},React.createElement("div",{className:"zn_tit","data-enableshortcuts":c,ref:"title",onPaste:function(a){b.handlePasteForTitle(a,!0)},onKeyPress:this.handleSetMaxCharacter,onKeyDown:this.handleKeyDown,onBlur:this.handleSetTitle,contentEditable:"true","data-plhr":d},this.title),React.createElement("div",{className:"zn_base"},React.createElement("div",null,React.createElement("div",{ref:"content",className:"zn_cont","data-plhr":e,"data-enableshortcuts":c,onPaste:this.handlePaste,onFocus:this.handleSaveSelection,onClick:this.handleSaveSelection,onKeyUp:this.handleSetHeight,onBlur:this.handleSetDescription,dangerouslySetInnerHTML:{__html:l},contentEditable:"true"}),React.createElement("div",{className:"SC_lnk SC_dyn"},"Read More ...")))):React.createElement("div",{className:f,ref:"notebox"},React.createElement("div",{className:j,ref:"stickyNote",onClick:this.handleStickyNote},React.createElement("i",{className:k})),React.createElement("div",{className:"zn_dd"},React.createElement("div",{className:"zn_date"})),React.createElement("div",null,React.createElement("div",{className:"zn_tit","data-enableshortcuts":c,ref:"title",onPaste:function(a){b.handlePasteForTitle(a,!0)},onKeyPress:this.handleSetMaxCharacter,onKeyDown:this.handleKeyDown,onBlur:this.handleSetTitle,contentEditable:"true","data-plhr":d},this.title),React.createElement("div",{className:"zn_base"},React.createElement("div",null,React.createElement("div",{ref:"content",className:"zn_cont","data-plhr":e,"data-enableshortcuts":c,onPaste:this.handlePaste,onFocus:this.handleSaveSelection,onClick:this.handleSaveSelection,onKeyUp:this.handleSetHeight,onBlur:this.handleSetDescription,onKeyPress:this.handleKeyPress,dangerouslySetInnerHTML:{__html:l},contentEditable:"true"}),React.createElement("div",{className:"SC_lnk SC_dyn"},"Read More ...")))),React.createElement("div",{className:"zn_act zn_clear"},React.createElement("div",{className:"SCmb"},React.createElement("div",{className:"SC_flt",id:"noteL"},React.createElement("ul",null,React.createElement("li",{id:"zncolor",ref:"palette",onClick:this.handleSetColor},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-nclr"})))),React.createElement("li",{id:"znImage",ref:"insertImgIcon",onClick:function(){b.triggerFileInputClickEvent("insertImage")}},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-image"})))),React.createElement("li",{id:"znAttach",ref:"attachIcon",onClick:function(){b.triggerAttachComponent("addAttachment")}},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-attachment"})))))))),React.createElement("div",{id:"grpDiv",className:"zn_folder zn_clear"},React.createElement("div",{className:"zn_cgy",id:"zncat"},React.createElement("font",{id:"zngroup",ref:"group",className:"zn_ngrp cursorPointer",onClick:this.handleChangeGroup},g),React.createElement("i",{className:"msi-rarrow"}),React.createElement("font",{id:"znscat",ref:"cgy",className:"zn_nbook",onClick:this.handleChangeBook},h))),React.createElement(a,{ref:"attDiv",onRemoveAttachment:this.handleOnRemoveAttachment,onRemoveMyAttachment:this.removeMyAttachment,attachname:this.state.attachname,attachpath:this.state.attachpath,attachstore:this.state.attachstore,attEntObj:this.state.attEntObj,attArray:this.attArray}),function(){if(!b.props.noAddCancel){var a=b.state.adding?zNote.notei18n.adding:zNote.notei18n.add;return React.createElement("div",{className:"zn_clear",ref:"addCancel"},React.createElement("div",{className:"SC_PUbtm"},React.createElement("span",{onClick:_.debounce(b.save,1e3,{leading:!0})},a),React.createElement("span",{"data-val":"Cancel",onClick:b.handleCancel},zNote.notei18n.cancel)))}}(),React.createElement("div",{className:"zn_clear zn_lbl SC_dyn"}))}});var a=React.createClass({displayName:"AddAttachment",getInitialState:function(){return{attachpath:[],attachstore:[],attachname:[]}},deleteAttachment:function(a,b){a.stopPropagation();var c={aId:zmail.accId,sN:b.attachstore,fP:b.attachpath,mode:"d"},d={attachstore:b.attachstore,attachpath:b.attachpath},e={u:"/zm/attach.do",t:"POST",csr:"s",fn:this.props.onRemoveAttachment,p:c,ep:d};zmAjq.XHR(e)},viewMyAttachment:function(a){var b={};b.startIndex=a,b.attObjList=this.props.attArray.slice(),b.hideAllOptions=!0,zmUtil.initAttSlideShow(b)},render:function(){function a(a,i){e=zmUtil.fileTyp(a.name),d=zmUtil.getSrcForTempAtt({name:a.name,fP:a.fP,sN:a.sN}),"msi-attimg"===e[1]?(c=zmail.conPath+"/FileDownload/"+a.attachname+"?mode=tmpview&entityType=1&accountId="+zmail.accId+"&fpath="+a.fP+"&fstorename="+a.sN,b=React.createElement("img",{src:c,title:a.name})):(f=e[1]+" sc_big",b=React.createElement("i",{className:f,title:a.name})),g.push(React.createElement("div",{className:"zmL zmAch",onClick:function(){h.viewMyAttachment(i)}},React.createElement("div",{className:"zmLst"},React.createElement("div",{className:"zmDtl"},React.createElement("div",{className:"zmImg"},b),React.createElement("div",{className:"SC_icn",onClick:function(b){h.deleteAttachment(b,{attachname:a.name,attachstore:a.sN,attachpath:a.fP})}},React.createElement("i",{className:"msi-close"}))))))}var b,c,d,e,f,g=[],h=this;if(!this.props.attArray.length)return React.createElement("div",{ref:"attach",className:"zn_clear zn_attach SC_dyn"},React.createElement("div",{className:"icn"},React.createElement("i",{className:"msi-attachpin"})));for(var i=function(a,i){e=zmUtil.fileTyp(a.fn),d=a.thn,d?(c=d,b=React.createElement("img",{src:c,title:a.fn})):(f=e[1]+" sc_big",b=React.createElement("i",{className:f,title:a.fn})),g.push(React.createElement("div",{className:"zmL zmAch",onClick:function(){h.viewMyAttachment(i)}},React.createElement("div",{className:"zmLst"},React.createElement("div",{className:"zmDtl"},React.createElement("div",{className:"zmImg"},b),React.createElement("div",{className:"SC_icn"},React.createElement("i",{className:"msi-close",onClick:function(b){b.stopPropagation(),h.props.onRemoveMyAttachment(a)}}))))))},j=0;j<this.props.attArray.length;j++)this.props.attArray[j].Id?i(this.props.attArray[j],j):a(this.props.attArray[j],j);return React.createElement("div",{className:"zn_folder zn_clear zn_attach"},React.createElement("div",{className:"icn"},React.createElement("i",{className:"msi-attachpin"})),g)}})}(),function(){zNote.Collections=zNote.Collections||{},zNote.Collections.noteList=Zmail.Collection.extend({initialize:function(a,b,c,d){this.listInfo=c,this.options=b,this.mountingElem=d,this.addNoteSubscription=this.addNoteToCollection.bind(this),$.subscribe("/note/add",this.addNoteSubscription),this.removeNoteSubscription=this.removeNoteFromCollection.bind(this),$.subscribe("/note/delete",this.removeNoteSubscription),"stickyNote"===this.listInfo.mode&&($.subscribe("/note/closeStickyNote",this.removeNoteSubscription),$.subscribe("/note/addstickynote",this.addNoteSubscription))},addNoteToCollection:function(a,b){var c=this;"mailassociated"===c.listInfo.id&&c.listInfo.msgid===b.email.msgid&&c.unshift(b),"c"===c.listInfo.mode&&("zn_catAll"===c.listInfo.id&&c.listInfo.groupId===b.namespaceId||c.listInfo.id===b.cat)&&c.unshift(b),"stickyNote"===c.listInfo.mode&&void 0!==b.showStickyNote&&c.add(b)},removeNoteFromCollection:function(a,b){this.remove(this.get(b))},stopSubscriptions:function(){$.unsubscribe("/note/add",this.addNoteSubscription),$.unsubscribe("/note/delete",this.removeNoteSubscription),"stickyNote"===this.listInfo.mode&&($.unsubscribe("/note/closeStickyNote",this.removeNoteSubscription),$.unsubscribe("/note/addstickynote",this.addNoteSubscription))},model:zNote.Models.Note})}(),function(){zNote.Views=zNote.Views||{},zNote.Views.NoteListView=React.createClass({displayName:"NoteListView",getInitialState:function(){return{select:""}},handleViewNote:function(){"stickyNote"===this.props.note.collection.listInfo.mode?zNote.eventBus.trigger("openStickyNote",{namespaceId:this.props.note.get("namespaceId"),id:this.props.note.get("id")}):"noteApp"===this.props.note.collection.listInfo.source?(this.props.openNoteInPreviewCard({namespaceId:this.props.note.get("namespaceId"),id:this.props.note.get("id")}),$(ReactDOM.findDOMNode(this.refs.notelist)).addClass("zmSLst")):zNote.loadAndOpenNote({namespaceId:this.props.note.get("namespaceId"),id:this.props.note.get("id")})},componentDidMount:function(){this.props.note.on("change",function(){this.forceUpdate()}.bind(this))},componentWillUnmount:function(){this.props.note.stopSubscriptions()},render:function(){var a="zmImg SC_link "+zNote.CONSTANTS.COLORCODE[this.props.note.get("color")];return React.createElement("div",{className:"zmL zm_urd",ref:"notelist",onClick:this.handleViewNote},React.createElement("div",{className:"zmLst"},React.createElement(zNote.Views.NoteListView.Favourite,{extraOptions:this.props.extraOptions,note:this.props.note}),React.createElement("div",{className:"zmDtl"},React.createElement("div",{className:"zmDate"},React.createElement("span",null,this.props.note.get("disptime"))),React.createElement("div",{className:a},this.props.note.get("title").slice(0,1)),React.createElement(zNote.Views.NoteListView.Creator,{extraOptions:this.props.extraOptions,note:this.props.note}),React.createElement("div",{className:"zmFrm"},React.createElement("span",{placeholder:"No Title"},znBox.spCharRep(this.props.note.get("title"))),React.createElement(zNote.Views.NoteListView.Description,{extraOptions:this.props.extraOptions,note:this.props.note}),React.createElement(zNote.Views.NoteListView.CommentIndicator,{extraOptions:this.props.extraOptions,note:this.props.note})),React.createElement("div",{className:"zmSub"},React.createElement(zNote.Views.NoteListView.AttachIndicator,{extraOptions:this.props.extraOptions,note:this.props.note}),React.createElement(zNote.Views.NoteListView.Book,{extraOptions:this.props.extraOptions,note:this.props.note})),React.createElement("div",{className:"zmFdr"},React.createElement("span",null,React.createElement(zNote.Views.NoteListView.Color,{extraOptions:this.props.extraOptions,note:this.props.note,parent:this}),React.createElement(zNote.Views.NoteListView.Sticky,{extraOptions:this.props.extraOptions,note:this.props.note}),React.createElement(zNote.Views.NoteListView.ShowMore,{extraOptions:this.props.extraOptions,note:this.props.note,parent:this}))),React.createElement("div",{className:"SC_icn"},React.createElement(zNote.Views.NoteListView.Delete,{extraOptions:this.props.extraOptions,note:this.props.note}),React.createElement(zNote.Views.NoteListView.AssociatedMail,{extraOptions:this.props.extraOptions,note:this.props.note})),React.createElement(zNote.Views.NoteListView.Tags,{extraOptions:this.props.extraOptions,note:this.props.note})),React.createElement(zNote.Views.NoteListView.Right,{extraOptions:this.props.extraOptions,note:this.props.note})))}}),zNote.Views.NoteListView.Description=React.createClass({displayName:"Description",render:function(){return React.createElement("span",{className:"sum"}," - ",this.props.note.get("summary"))}}),zNote.Views.NoteListView.Title=React.createClass({displayName:"Title",render:function(){var a=znBox.spCharRep(znBox.getTextContentFromHTML(this.props.note.get("desc")));return React.createElement("span",{className:"sum"}," - ",a)}}),zNote.Views.NoteListView.Delete=React.createClass({displayName:"Delete",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.deleteIcon,text:zNote.notei18n.tooltips.deleteNote,arrow:"top"})},handleDeleteNote:function(a){a.stopPropagation(),this.props.note.deleteNote(this.props.note.get("id"))},render:function(){return this.props.note.get("ownerZUID")!==zmail.zuid||"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode?null:React.createElement("i",{className:"msi-trash",ref:"deleteIcon",onClick:this.handleDeleteNote})}}),zNote.Views.NoteListView.AssociatedMail=React.createClass({displayName:"AssociatedMail",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.mailopen,text:zNote.notei18n.tooltips.openmail,arrow:"top"})},handleViewAssociatedMail:function(a){var b={};a.stopPropagation(),this.props.note.get("email").accid!==zmail.accId&&(b={actionType:"viewGroupMailEntity",entityId:this.props.note.get("notes").email.msgid,entityType:"1",streamsView:"true",streams:!0,groupId:this.props.note.get("namespaceId"),accId:this.props.note.get("email").accid}),zmList.getMailData({msgId:this.props.note.get("email").msgid,opentype:2,type:"lt",src:"external",eprm:b})},render:function(){return!this.props.note.get("email")||$.isEmptyObject(this.props.note.get("email"))||"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode?null:React.createElement("i",{className:"msi-mailopen",ref:"mailopen",onClick:this.handleViewAssociatedMail})}}),zNote.Views.NoteListView.CommentIndicator=React.createClass({displayName:"CommentIndicator",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.star,text:zNote.notei18n.tooltips.changeFavourite,arrow:"top"})},handleSetFavourite:function(a){a.stopPropagation(),this.props.note.saveFavourite()},render:function(){return"mailassociated"!==this.props.extraOptions.id&&"stickyNote"!==this.props.extraOptions.mode&&this.props.note.get("commentCount")&&0!==this.props.note.get("commentCount")?React.createElement("div",{className:"SC_dft"},React.createElement("i",{className:"msi-lcmnt",title:"Comments available"}),React.createElement("span",null,this.props.note.get("commentCount"))):null}}),zNote.Views.NoteListView.AttachIndicator=React.createClass({displayName:"AttachIndicator",handleShowAttachments:function(a){var b,c=this;a.stopPropagation();var d=this.props.note.get("attachments").map(function(a){var b=a[Object.keys(a)[0]];return b.e=c.props.note.get("id"),b.et=zNote.CONSTANTS.entityType,b.gId=c.props.note.get("namespaceId"),b}),e='<div class="SC_PUtt"><div class="SCmb"><ul><li><b><div class="SC_hd"></div><span class="SC_ttip ttr" data-tooltip="Close"><i class="msi-close" data-msg="close"></i></span></b></li></ul></div></div>',f='<div class="SC_tp10"> '+zmText.applyArgs("{{count}} Attachments",{count:d.length})+"</div>";f+=zmAttach.build(d,{from:"compose"});var g="zmail.zuid"===this.props.note.get("namespaceId")?void 0:"viewGroupData",h=e+'<div class="zmPAtt" data-eId ='+this.props.note.get("id")+">"+f+"</div>",i=$(h),j={par:ReactDOM.findDOMNode(this.refs.attachicon),showArrow:!0,liDom:i,spanClass:"zm_attPop minwid zmAtt_mulMail",clk:function(a,b){}};zmsuite.showMenu(j),i.find(".zmImg").click(function(){b=$(this).parents(".zmL").data("detail"),zmUtil.initAttSlideShow(d,b)}),i.find(".zmAch").click(function(a){b=$(this).data("detail"),zmAttach.util.bindoptions(a,{attList:d,from:"streams",pid:c.props.note.get("id"),type:g,index:b})})},render:function(){return this.props.note.get("attachments")&&this.props.note.get("attachments").length&&"mailassociated"!==this.props.extraOptions.id&&"stickyNote"!==this.props.extraOptions.mode?React.createElement("i",{className:"msi-attachicon",ref:"attachicon",onMouseDown:this.handleSetAttributes,onClick:this.handleShowAttachments}):null}}),zNote.Views.NoteListView.Book=React.createClass({displayName:"Book",componentDidMount:function(){this.props.note.get("ownerZUID")===zmail.zuid&&zmComponent.tooltip({elm:this.refs.book,text:zNote.notei18n.tooltips.moveNote,arrow:"top"})},changeGroup:function(a){if(this.props.note.get("ownerZUID")===zmail.zuid){var b;a.stopPropagation();var c=znNote.getGroupArray(),d=this,e={};e.parentDOM=ReactDOM.findDOMNode(this.refs.group),e.displayAs="popup",e.showCreate=!0,e.onSelect=function(a){d.props.note.changeGroup(a),b.hide()},e.onHide=function(){$("#zm_dropDown").remove()},e.dataCallback=function(){return c},b=zmUtil.createFLComp("group",e),b.show()}},handleChangeBook:function(a){if(this.props.note.get("ownerZUID")===zmail.zuid){a.stopPropagation();var b,c=znNote.getCategoryArray(this.props.note.get("namespaceId")),d=this,e={};e.parentDOM=ReactDOM.findDOMNode(this.refs.book),e.displayAs="popup",e.onSelect=function(a){d.props.note.changeBook(a),b.hide()},(this.props.note.get("namespaceId")===zmail.zuid||zmCont.getGroup()[this.props.note.get("namespaceId")]&&zmCont.getGroup()[this.props.note.get("namespaceId")].isOwner)&&(e.onCreate=function(a){znNote.sendNewCatReq(a,{},d.props.note.get("namespaceId")).done(function(a){d.props.note.changeBook(a[1][0].catId),b.hide()})}),e.onHide=function(){$("#zm_dropDown").remove()},e.dataCallback=function(){return c},b=zmUtil.createFLComp("category",e),b.show()}},render:function(){var a=znNote.getGroupName(this.props.note.get("namespaceId")),b=znNote.getNamefrmCatObj(this.props.note.get("cat"),this.props.note.get("namespaceId"));return""===a?null:React.createElement("span",{className:"zn_cat"},React.createElement("font",{id:"zngroup",ref:"group",className:"zn_ngrp"},a),React.createElement("i",{className:"msi-rarrow"}),React.createElement("font",{id:"znscat",ref:"book",className:"zn_nbook",onClick:this.handleChangeBook},b))}}),zNote.Views.NoteListView.Favourite=React.createClass({displayName:"Favourite",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.star,text:zNote.notei18n.tooltips.changeFavourite,arrow:"top"})},handleSetFavourite:function(a){a.stopPropagation(),this.props.note.saveFavourite()},render:function(){var a=this.props.note.get("starred")?"msi-fav SC_fav":"msi-fav";return"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode?null:React.createElement("div",{className:"zmFlt",onClick:this.handleSetFavourite},React.createElement("i",{className:a,ref:"star"}))}}),zNote.Views.NoteListView.Sticky=React.createClass({displayName:"Sticky",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.sticky,text:zNote.notei18n.note.makeSticky,arrow:"top"})},handleMakeSticky:function(a){a.stopPropagation(),zNote.addAsStickyNote(this.props.note.toJSON())},handleSetAttributes:function(){$(ReactDOM.findDOMNode(this.refs.sticky)).attr("data-current","true"),"true"===$(ReactDOM.findDOMNode(this.refs.sticky)).attr("data-visible")?$(ReactDOM.findDOMNode(this.refs.sticky)).attr("data-visible","false"):$(ReactDOM.findDOMNode(this.refs.sticky)).attr("data-visible","true")},render:function(){return"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode?null:React.createElement("i",{className:"msi-stiNotes",ref:"sticky",onMouseDown:this.handleSetAttributes,onClick:this.handleMakeSticky})}}),zNote.Views.NoteListView.Creator=React.createClass({
displayName:"Creator",componentDidMount:function(){var a=this;zmail.ContactBook.get({zuid:a.props.note.get("ownerZUID")}).done(function(b){var c=b[0];zmComponent.tooltip({elm:a.refs.creator,text:c.attrs.fn,arrow:"top"}),$(ReactDOM.findDOMNode(a.refs.creatorname)).text(c.attrs.fn)})},render:function(){var a="zmOwn";return"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode||"c"===this.props.extraOptions.mode&&this.props.extraOptions.groupId===zmail.zuid?null:React.createElement("div",{className:a,ref:"creator"},React.createElement("span",{className:"SC_thm",ref:"creatorname"}))}}),zNote.Views.NoteListView.Color=React.createClass({displayName:"Color",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.palette,text:zNote.notei18n.tooltips.changeColor,arrow:"top"})},handleSetColor:function(a){a.stopPropagation();var b=this;if("true"===$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible")){var c=$('<li><div class="zn_clr"><div class="zn_clr1"></div><div class="zn_clr2"></div><div class="zn_clr3"></div><div class="zn_clr4"></div></div></li>');c.find("."+zNote.CONSTANTS.COLORCODE[this.props.note.get("color")]).append("<i class=msi-tick></i>");var d={par:a.target,showArrow:!0,liDom:c,direction:"bottom",ulClass:"zn_clrSel",spanClass:"minwid"};zmsuite.showMenu(d),$(c[0]).find("div").children("div").off("click").on("click",function(a){a.stopPropagation(),$("#zm_dropDown").remove(),$(ReactDOM.findDOMNode(b.refs.palette)).attr("data-visible","false"),b.props.note.saveColor(zNote.CONSTANTS.COLOR[this.className]),$(ReactDOM.findDOMNode(b.props.parent.refs.notelist)).addClass("sel")})}$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-current","false"),$(ReactDOM.findDOMNode(this.props.parent.refs.notelist)).addClass("sel"),$(ReactDOM.findDOMNode(this.refs.palette)).addClass("active")},handleSetAttributes:function(){$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-current","true"),"true"===$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible")?$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible","false"):$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible","true")},render:function(){return"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode||this.props.note.get("ownerZUID")!==zmail.zuid?null:React.createElement("i",{className:"msi-nclr",ref:"palette",onMouseDown:this.handleSetAttributes,onClick:this.handleSetColor})}}),zNote.Views.NoteListView.ShowMore=React.createClass({displayName:"ShowMore",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.showmoreicon,text:zNote.notei18n.tooltips.moreOptions,arrow:"top"})},popupClick:function(a){switch(znNote.hideMenu(),a.action){case"addTag":this.props.parent.refs.tag.addLabel(ReactDOM.findDOMNode(this.props.parent.refs.showmore));break;case"sendMail":this.props.note.sendAsMail();break;case"delNote":this.props.note.deleteNote(this.props.note.get("id"));break;case"print":zNote.printNote({id:this.props.note.get("id"),namespaceId:this.props.note.get("namespaceId")})}},addAttachment:function(){var a=this;if(a.attRefObj)a.attRefObj.init();else{var b={componentId:"notes",isNewImp:!0,attachFrom:["desktop","myAttachchment","zDocs","otherCloud"],currentAttachedSize:0,eleId:$(ReactDOM.findDOMNode(a.props.parent.refs.attDiv)),onAllUploadFinish:{handler:function(b){a.props.note.saveAttachment(b)},resetData:!0,removeAttachDOM:!0}};zmUtil.initAttachComponent(b,function(b){a.attRefObj=b})}},setAttributes:function(){$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-current","true"),"true"===$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible")?$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible","false"):$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible","true")},showMoreOptions:function(a){a.stopPropagation();var b=this,c={};c.sendMail={htm:zNote.notei18n.note.sendMail,data:{action:"sendMail"}},c.printNote={htm:zNote.notei18n.note.printNote,data:{action:"print"}};var d=[c.sendMail,c.printNote];if("true"===$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible")){var e={par:a.target,showArrow:!0,spanClass:"SC_dd",list:d,direction:"bottom",clk:function(a,c){$(c).hasClass("SC_op3")||b.popupClick(a)}};zmsuite.showMenu(e),$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-current","false"),$(ReactDOM.findDOMNode(this.props.parent.refs.notelist)).addClass("sel")}},render:function(){var a=this;return"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode?null:React.createElement("i",{className:"msi-nmore",ref:"showmoreicon",onClick:function(b){a.showMoreOptions(b)},onMouseDown:function(b){a.setAttributes(b)}})}}),zNote.Views.NoteListView.Tags=React.createClass({displayName:"Tags",componentDidMount:function(){var a=this.refs.labelicon||this.refs.plus;zmComponent.tooltip({elm:a,text:zNote.notei18n.note.addTag,arrow:"top"})},addLabel:function(a,b){a.stopPropagation();var c,d=this,e={};e.parentDOM=this.refs.plus?ReactDOM.findDOMNode(this.refs.plus):b,e.displayAs="popup",e.labelState={labelList:this.props.note.get("tagId")},e.showCreate=!0,e.accType="default",e.onHide=function(){$("#zm_dropDown").remove()},e.onCreate=function(a){znNote.sendNewLabReq(a).done(function(a){a&&1===a[0]&&a[1].id&&(c.hide(),d.props.note.addTag(a[1].id))})},e.onStateChange=function(a,b){b?d.props.note.addTag(a):d.props.note.removeTag(a)},c=zmUtil.createFLComp("label",e),c.show()},render:function(){var a={backgroundColor:""},b=this;return this.props.note.get("tagId")&&this.props.note.get("tagId").length&&"mailassociated"!==this.props.extraOptions.id&&"stickyNote"!==this.props.extraOptions.mode?b.props.note.get("tagId")&&b.props.note.get("tagId").length>0?React.createElement("div",{className:"zm_lbl"},b.props.note.get("tagId").map(function(c){return!!zmUtil.getTagList("default")[c]&&(a={backgroundColor:zmUtil.getTagList("default")[c].color},React.createElement("p",{"data-mid":"",title:zmUtil.getTagList("default")[c].label,onClick:function(a){b.addLabel(a)},className:"zmAttLbl"},React.createElement("font",{style:a})))}),React.createElement("i",{className:"msi-plus",ref:"plus",onClick:function(a){b.addLabel(a)}})):void 0:null}}),zNote.Views.NoteListView.Right=React.createClass({displayName:"Right",render:function(){return"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode?null:React.createElement("div",{className:"zmFrt"})}})}(),function(){zNote.Views=zNote.Views||{},zNote.Views.NoteListCollectionView=React.createClass({displayName:"NoteListCollectionView",componentDidMount:function(){this.props.noteList.on("add",function(){this.forceUpdate()}.bind(this)),this.props.noteList.on("remove",function(){this.forceUpdate()}.bind(this)),zNote.eventBus.on("removeMask",this.checkAndClosePreview,this)},componentWillUnmount:function(){zNote.eventBus.off("removeMask",this.checkAndClosePreview,this),this.closePreview(),this.props.noteList.stopSubscriptions()},checkAndClosePreview:function(a){this.openPreviewNoteData&&a&&a[0]&&this.openPreviewNoteData.id===a[0].id&&this.openPreviewNoteData.namespaceId===a[0].namespaceId&&this.closePreview()},closePreview:function(){if("noteApp"===this.props.noteList.listInfo.source){var a=zmsuite.getCenter("zm_notes"),b=a[0].getNodes();b[2].$el.find(".zmSLst").removeClass("zmSLst"),zmsuite.getCenter("zm_notes")[1].close(),this.openPreviewNoteData={}}},noteView:function(a,b){this.noteViewList=this.noteViewList||{},this.noteViewList[b.get("id")]=a},handleAddNote:function(){zNote.loadAddNote({addparams:{msgid:this.props.noteList.listInfo.msgid,senderid:this.props.noteList.listInfo.senderid,accid:this.props.noteList.listInfo.accid}})},handleOpenNoteInPreviewcard:function(a){var b,c,d,e,f,g=this,h=zmsuite.getCenter("zm_notes"),i=h[1].getNodes(),j=h[0].getNodes();j[2].$el.find(".zmSLst").removeClass("zmSLst"),i[1].$el.find(".postMsg").length&&ReactDOM.unmountComponentAtNode(i[1].$el.find(".postMsg")[0]),i[1].$el.html(""),i[1].$el.empty();var k="",l=[];this.openPreviewNoteData=a,d=g.props.noteList.where({id:g.openPreviewNoteData.id,namespaceId:g.openPreviewNoteData.namespaceId})[0],e=g.props.noteList.indexOf(d),l.push({tooltip:"prev",iconClass:"msi-prev",data:"prev"}),l.push({tooltip:"next",iconClass:"msi-next",data:"next"}),l.push({tooltip:"close",iconClass:"msi-close",data:"close"});var m={text:k,rIcons:[l]};i[0].push(m),i[0].setListener("click",function(a){"close"===a||"clsPrev"===a.action?(j[2].$el.find(".zmSLst").removeClass("zmSLst"),ReactDOM.unmountComponentAtNode(c[0]),zmsuite.getCenter("zm_notes")[1].close(),g.openPreviewNoteData={}):"prev"===a||"msi-prev"===a.action?(f=g.props.noteList.at(e-1),g.noteViewList[f.get("id")].handleViewNote(),$(ReactDOM.findDOMNode(g.noteViewList[f.get("id")].refs.notelist))[0].scrollIntoView()):"next"!==a&&"msi-next"!==a.action||(f=g.props.noteList.at(e+1),g.noteViewList[f.get("id")].handleViewNote(),$(ReactDOM.findDOMNode(g.noteViewList[f.get("id")].refs.notelist))[0].scrollIntoView())}),h[1].show(),0===e&&i[0].$el.find(".msi-prev").closest("li").addClass("SC_opy3 SC_nopntr"),e===g.props.noteList.length-1&&i[0].$el.find(".msi-next").closest("li").addClass("SC_opy3 SC_nopntr");var n=zmComponent.loadingBand({container:i[1].$el[0],type:"pagination"});zNote.getNoteDetails(a).done(function(a){n(),b=a[1];var d=$("<div class='SC_notePreview'></div>");c=$("<div class='postMsg'></div>");var e=new zNote.Models.previewNote(b),f={previewCard:"true",disableShortcuts:"true"};ReactDOM.render(React.createElement(zNote.Views.NotePreview,{options:f,note:e}),c[0]),zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:d,viewPost:!0,fixedComment:!1,isPreview:!1,response:b,hideContent:!0}),d.find(".SCS_postHead").after(c),i[1].push(d[0])})})},render:function(){var a,b=this,c={id:this.props.noteList.listInfo.id,groupId:this.props.noteList.listInfo.groupId,mode:this.props.noteList.listInfo.mode};return"noteApp"===this.props.noteList.listInfo.source?this.props.noteList.length?React.createElement("div",{id:"wrapperNoteDiv",ref:"wrapDiv"},this.props.noteList.map(function(a){return React.createElement(zNote.Views.NoteListView,{ref:function(c){b.noteView(c,a)},openNoteInPreviewCard:b.handleOpenNoteInPreviewcard,extraOptions:c,note:a,key:a.get("id")})})):React.createElement("div",{id:"wrapperNoteDiv",ref:"wrapDiv"},React.createElement("div",{id:"nonotes",className:"SC_nmsg"},zNote.notei18n.nonotes)):this.props.noteList.length?(a=this.props.noteList.options&&this.props.noteList.options.showHeader?"multiAppHead":"multiAppHead SC_dyn",React.createElement("div",{className:"multiAppData"},React.createElement("div",{className:"multiAppInfo SC_notes SC_cmptNotes"},React.createElement("div",{className:a}," ",React.createElement("span",null,"Notes"),React.createElement("div",{className:"SCmb SC_frt"},React.createElement("ul",null,React.createElement("li",{className:"SCtxt"},React.createElement("b",null,React.createElement("span",{onClick:this.handleAddNote},"Add Note")))))),this.props.noteList.map(function(a){return React.createElement(zNote.Views.NoteListView,{extraOptions:c,ref:function(c){b.noteView(c,a)},note:a,key:a.get("id")})})))):(a=this.props.noteList.options&&this.props.noteList.options.showHeader?"multiAppHead":"multiAppHead SC_dyn",React.createElement("div",{className:"multiAppData"},React.createElement("div",{className:"multiAppInfo SC_notes SC_cmptNotes"},React.createElement("div",{className:a}," ",React.createElement("span",null,"Notes"),React.createElement("div",{className:"SCmb SC_frt"},React.createElement("ul",null,React.createElement("li",{className:"SCtxt"},React.createElement("b",null,React.createElement("span",{onClick:this.handleAddNote},"Add Note")))))),React.createElement("div",{id:"wrapperNoteDiv",ref:"wrapDiv"},React.createElement("div",{id:"nonotes",className:"SC_nmsg"},zNote.notei18n.nonotes)))))}})}();