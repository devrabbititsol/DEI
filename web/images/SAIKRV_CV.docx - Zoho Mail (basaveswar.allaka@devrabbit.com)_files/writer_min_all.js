if(!this.JSON)this.JSON={};
(function(){function d(h){return h<10?"0"+h:h}function a(h){e.lastIndex=0;return e.test(h)?'"'+h.replace(e,function(m){var j=q[m];return typeof j==="string"?j:"\\u"+("0000"+m.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+h+'"'}function b(h,m){var j,k,n,r,p=f,l,g=m[h];if(g&&typeof g==="object"&&typeof g.toJSON==="function")g=g.toJSON(h);if(typeof o==="function")g=o.call(m,h,g);switch(typeof g){case "string":return a(g);case "number":return isFinite(g)?String(g):"null";case "boolean":case "null":return String(g);
case "object":if(!g)return"null";f+=i;l=[];if(Object.prototype.toString.apply(g)==="[object Array]"){r=g.length;for(j=0;j<r;j+=1)l[j]=b(j,g)||"null";n=l.length===0?"[]":f?"[\n"+f+l.join(",\n"+f)+"\n"+p+"]":"["+l.join(",")+"]";f=p;return n}if(o&&typeof o==="object"){r=o.length;for(j=0;j<r;j+=1){k=o[j];if(typeof k==="string")if(n=b(k,g))l.push(a(k)+(f?": ":":")+n)}}else for(k in g)if(Object.hasOwnProperty.call(g,k))if(n=b(k,g))l.push(a(k)+(f?": ":":")+n);n=l.length===0?"{}":f?"{\n"+f+l.join(",\n"+f)+
"\n"+p+"}":"{"+l.join(",")+"}";f=p;return n}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+d(this.getUTCMonth()+1)+"-"+d(this.getUTCDate())+"T"+d(this.getUTCHours())+":"+d(this.getUTCMinutes())+":"+d(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var c=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,i,q={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},o;if(typeof JSON.stringify!=="function")JSON.stringify=function(h,m,j){var k;i=f="";if(typeof j==="number")for(k=0;k<j;k+=1)i+=" ";else if(typeof j==="string")i=j;if((o=m)&&typeof m!=="function"&&(typeof m!=="object"||typeof m.length!=="number"))throw Error("JSON.stringify");return b("",
{"":h})};if(typeof JSON.parse!=="function")JSON.parse=function(h,m){function j(n,r){var p,l,g=n[r];if(g&&typeof g==="object")for(p in g)if(Object.hasOwnProperty.call(g,p)){l=j(g,p);if(l!==undefined)g[p]=l;else delete g[p]}return m.call(n,r,g)}var k;h=String(h);c.lastIndex=0;if(c.test(h))h=h.replace(c,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(h.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){k=eval("("+h+")");return typeof m==="function"?j({"":k},""):k}throw new SyntaxError("JSON.parse");}})();Math.uuid=function(){var d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");return function(a,b){var c=[];b=b||d.length;if(a)for(var e=0;e<a;e++)c[e]=d[0|Math.random()*b];else{var f;c[8]=c[13]=c[18]=c[23]="-";c[14]="4";for(e=0;e<36;e++)if(!c[e]){f=0|Math.random()*16;c[e]=d[e==19?f&3|8:f]}}return c.join("")}}();Math.uuid2=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var a=Math.random()*16|0;return(d=="x"?a:a&3|8).toString(16)}).toUpperCase()};(function(d){d.whileAsync=function(a){var b=Math.abs(a.delay)||10,c=isNaN(a.bulk)?500:Math.abs(a.bulk),e=a.test||function(){return true},f=a.loop||function(){},i=a.end||function(){};(function(){for(var q=false,o=new Date;q=e();){f();if(c===0||new Date-o>c)break}q?setTimeout(arguments.callee,b):i()})()};d.eachAsync=function(a,b){var c=0,e=a.length,f=b.loop||function(){};d.whileAsync(d.extend(b,{test:function(){return c<e},loop:function(){var i=a[c];return f.call(i,c++,i)}}))};d.fn.eachAsync=function(a){d.eachAsync(this,
a);return this}})(jQuery);(function(d){jQuery.extend({isObject:function(a){if(typeof a!=="object")return false;return true},emptyBox:function(a){a=d(a);a.empty();a.removeData()},getTimeElapsed:function(a){var b="";a=Math.floor(a/1E3);b=Math.floor(a/60);var c=Math.floor(a/3600),e=Math.floor(a/86400);return b=e>0?d.i18n("common","daysago",[e]):c>0?d.i18n("common","hoursago",[c]):b>0?d.i18n("common","minutesago",[b]):d.i18n("common","secondsago",[a])},getScrollWidth:function(){var a=d('<div style="width:100%;height:200px;" />'),
b=d('<div style="position:absolute;top:0px;left:0px;visibility:hidden;width:200px;height:100px;overflow:hidden;" />');b.append(a);d(document.body).append(b);var c=a[0].offsetWidth;b.css({overflow:"scroll"});a=a[0].offsetWidth;if(c===a)a=b[0].clientWidth;b.remove();return c-a},replaceSplChar:function(a){if(a){a=a.replace(/</,"&lt");a=a.replace(/>/,"&gt")}return a},setPageTitle:function(a){document.title=this.getPageTitle(a)},getPageTitle:function(a){return d.i18n("show.common.productname",[this.unEscapeSingleQuote(a)])},
unEscapeString:function(a){if(a){a=a.replace(/&amp;/g,"&");a=a.replace(/&gt;/g,">");a=a.replace(/&lt;/g,"<");a=a.replace(/&#39;/g,"'");a=a.replace(/&quot;/g,'"')}return a},unEscapeSingleQuote:function(a){if(a)a=a.replace(/&#39;/g,"'");return a},createObject:function(a){var b=undefined;if(a){var c=this,e=[];d.each(a,function(f,i){if(!b){b={};b[i]={};e[e.length]=i;return true}c.getObject(b,e)[i]={};e[e.length]=i})}else b={};return b},getObject:function(a,b){var c=a;d.each(b,function(e,f){c=c[f];if(!c)return false});
return c},setObj:function(a,b,c){a=this.getObject(a,b);return d.extend(true,a,c)},appendVendorPrefix:function(a,b){var c=document.createElement("div");if(a in c.style)return a;var e=a;a=a.replace(/^[a-z]/,function(i){return i.toUpperCase()});if(a.indexOf("-")!=-1)a=a.replace(/-.{1}/g,function(i){return i.replace(/-/g,"").toUpperCase()});var f=undefined;d.each(["Moz","Webkit","ms","O"],function(i,q){var o=q+a;if(o in c.style){a=o;f="-"+q.toLowerCase()+"-"+e;d.support[e]=a;return false}});c=null;return b?
f:a},isCSSPropsSupports:function(a){var b=document.createElement("div"),c=["Moz","Webkit","ms","O"],e=false;if(a in b.style)e=true;else{a=a.replace(/^[a-z]/,function(f){return f.toUpperCase()});d.each(c,function(f,i){if(i+a in b.style){e=true;return false}})}b=null;return e},TAG_NAMES:{select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"},isEventSupported:function(a){var b=document.createElement(this.TAG_NAMES[a]||"div");a="on"+a;var c=a in b;if(!c){b.setAttribute(a,
"return;");c=typeof b[a]=="function"}return c},isTouchDevice:function(){return this.isEventSupported("touchmove")}})})(jQuery);
(function(m){ShapeConfig={container:undefined,drawcontainer:undefined,shapedim:{width:50,height:50},init:function(){},allowMouseEvent:function(){},focusDrawContainer:function(){},isSlideLocked:function(){},checkGroupShapeLockStatus:function(){},get:{i18nMap:{left:"Left",top:"Top",width:"Width",height:"Height",rotate:"Rotate",cannoteditgroupshape:"Cannot Edit Group Shape",cannoteditnoselect:"Cannot Edit Locked Shape"},label:function(a){return this.i18nMap[a]},shapes:{all:function(){},hidden:function(){},
visible:function(){}},showContextPath:function(){return""},mergeShape:function(){},mergeTransformShape:function(){},shape:function(){},groupselect:function(){return m.ShapeDefault.groupselect},scale:function(){return 1},shapeContainer:function(){},shapeContainerId:function(){},zIndies:function(){},max:{zIndex:function(){}},slideSize:function(){},getAllShapeData:function(){},viewPropsData:function(){return{display:{showSmartGuides:true}}}},eventTrigger:{rightClick:function(){}},isSupported:{text:true,
draw:true,connector:true,shapeEdit:true,selection:true,grids_guides:true},drawOnMouseDown:{preset:false,custom:true},mouse:{down:function(){},doubleClick:function(){}}}})(jQuery);Math.uuid=function(){var m="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");return function(a,b){var c=[];b=b||m.length;if(a)for(var f=0;f<a;f++)c[f]=m[0|Math.random()*b];else{var d;c[8]=c[13]=c[18]=c[23]="-";c[14]="4";for(f=0;f<36;f++)if(!c[f]){d=0|Math.random()*16;c[f]=m[f==19?d&3|8:d]}}return c.join("")}}();Math.uuid2=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(m){var a=Math.random()*16|0;return(m=="x"?a:a&3|8).toString(16)}).toUpperCase()};(function(m){m.ShapePresets={COLORMODE:{NOVARIENTS:{NONE:{colorMode:{mode:"NONE"}}},RECOLORMODE:{GRAYSCALE:{colorMode:{mode:"GRAYSCALE"}},BILEVEL:{colorMode:{mode:"BILEVEL"}},SEPIA:{colorMode:{mode:"SEPIA"}}},DARKERVARIENTS:{DUOTONE_BLACK_ACCENT_1:{colorMode:{mode:"DUOTONE",duotone:[{type:"CUSTOM",rgb:[0,0,0]},{type:"A1",tweaks:{tint:0.45,hsl:{saturation:[{mode:"MODIFY",value:4}]}}}]}},DUOTONE_BLACK_ACCENT_2:{colorMode:{mode:"DUOTONE",duotone:[{type:"CUSTOM",rgb:[0,0,0]},{type:"A2",tweaks:{tint:0.45,
hsl:{saturation:[{mode:"MODIFY",value:4}]}}}]}},DUOTONE_BLACK_ACCENT_3:{colorMode:{mode:"DUOTONE",duotone:[{type:"CUSTOM",rgb:[0,0,0]},{type:"A3",tweaks:{tint:0.45,hsl:{saturation:[{mode:"MODIFY",value:4}]}}}]}},DUOTONE_BLACK_ACCENT_4:{colorMode:{mode:"DUOTONE",duotone:[{type:"CUSTOM",rgb:[0,0,0]},{type:"A4",tweaks:{tint:0.45,hsl:{saturation:[{mode:"MODIFY",value:4}]}}}]}},DUOTONE_BLACK_ACCENT_5:{colorMode:{mode:"DUOTONE",duotone:[{type:"CUSTOM",rgb:[0,0,0]},{type:"A5",tweaks:{tint:0.45,hsl:{saturation:[{mode:"MODIFY",
value:4}]}}}]}},DUOTONE_BLACK_ACCENT_6:{colorMode:{mode:"DUOTONE",duotone:[{type:"CUSTOM",rgb:[0,0,0]},{type:"A6",tweaks:{tint:0.45,hsl:{saturation:[{mode:"MODIFY",value:4}]}}}]}}},LIGHTERVARIENTS:{DUOTONE_WHITE_ACCENT_1:{colorMode:{mode:"DUOTONE",duotone:[{type:"A1",tweaks:{shade:0.45,hsl:{saturation:[{mode:"MODIFY",value:1.35}]}}},{type:"CUSTOM",rgb:[255,255,255]}]}},DUOTONE_WHITE_ACCENT_2:{colorMode:{mode:"DUOTONE",duotone:[{type:"A2",tweaks:{shade:0.45,hsl:{saturation:[{mode:"MODIFY",value:1.35}]}}},
{type:"CUSTOM",rgb:[255,255,255]}]}},DUOTONE_WHITE_ACCENT_3:{colorMode:{mode:"DUOTONE",duotone:[{type:"A3",tweaks:{shade:0.45,hsl:{saturation:[{mode:"MODIFY",value:1.35}]}}},{type:"CUSTOM",rgb:[255,255,255]}]}},DUOTONE_WHITE_ACCENT_4:{colorMode:{mode:"DUOTONE",duotone:[{type:"A4",tweaks:{shade:0.45,hsl:{saturation:[{mode:"MODIFY",value:1.35}]}}},{type:"CUSTOM",rgb:[255,255,255]}]}},DUOTONE_WHITE_ACCENT_5:{colorMode:{mode:"DUOTONE",duotone:[{type:"A5",tweaks:{shade:0.45,hsl:{saturation:[{mode:"MODIFY",
value:1.35}]}}},{type:"CUSTOM",rgb:[255,255,255]}]}},DUOTONE_WHITE_ACCENT_6:{colorMode:{mode:"DUOTONE",duotone:[{type:"A6",tweaks:{shade:0.45,hsl:{saturation:[{mode:"MODIFY",value:1.35}]}}},{type:"CUSTOM",rgb:[255,255,255]}]}}}},REFLECTION:{PRESET2:{alpha:{st:0.5},pos:{end:0.55},distance:{radius:0},preset:"PRESET2"},PRESET1:{alpha:{st:0.48},pos:{end:0.35},distance:{radius:0},preset:"PRESET1"},PRESET6:{alpha:{st:0.5},pos:{end:0.9},distance:{radius:4},preset:"PRESET6"},PRESET5:{alpha:{st:0.5},pos:{end:0.555},
distance:{radius:4},preset:"PRESET5"},PRESET4:{alpha:{st:0.5},pos:{end:0.385},distance:{radius:4},preset:"PRESET4"},PRESET3:{alpha:{st:0.5},pos:{end:0.9},distance:{radius:0},preset:"PRESET3"},PRESET9:{alpha:{st:0.5},pos:{end:0.92},distance:{radius:8},preset:"PRESET9"},PRESET8:{alpha:{st:0.5},pos:{end:0.555},distance:{radius:8},preset:"PRESET8"},PRESET7:{alpha:{st:0.5},pos:{end:0.4},distance:{radius:8},preset:"PRESET7"}},SHADOW:{PRESET2:{type:"OUTER",color:{type:"CUSTOM",rgb:[63,63,63],tweaks:{alpha:0.5}},
distance:{radius:10,angle:90},preset:"PRESET2",blur:{radius:4}},PRESET1:{type:"OUTER",color:{type:"CUSTOM",rgb:[63,63,63],tweaks:{alpha:0.5}},distance:{radius:10,angle:45},preset:"PRESET1",blur:{radius:4}},PRESET6:{type:"OUTER",color:{type:"CUSTOM",rgb:[63,63,63],tweaks:{alpha:0.5}},distance:{radius:10,angle:180},preset:"PRESET6",blur:{radius:4}},PRESET5:{type:"OUTER",color:{type:"CUSTOM",rgb:[63,63,63],tweaks:{alpha:0.5}},distance:{radius:0,angle:0},preset:"PRESET5",blur:{radius:4}},PRESET4:{type:"OUTER",
color:{type:"CUSTOM",rgb:[63,63,63],tweaks:{alpha:0.5}},distance:{radius:10,angle:0},preset:"PRESET4",blur:{radius:4}},PRESET3:{type:"OUTER",color:{type:"CUSTOM",rgb:[63,63,63],tweaks:{alpha:0.5}},distance:{radius:10,angle:135},preset:"PRESET3",blur:{radius:4}},PRESET9:{type:"OUTER",color:{type:"CUSTOM",rgb:[63,63,63],tweaks:{alpha:0.5}},distance:{radius:10,angle:225},preset:"PRESET9",blur:{radius:4}},PRESET8:{type:"OUTER",color:{type:"CUSTOM",rgb:[63,63,63],tweaks:{alpha:0.5}},distance:{radius:10,
angle:270},preset:"PRESET8",blur:{radius:4}},PRESET7:{type:"OUTER",color:{type:"CUSTOM",rgb:[63,63,63],tweaks:{alpha:0.5}},distance:{radius:10,angle:315},preset:"PRESET7",blur:{radius:4}}},GRADIENT:{PRESET2:{type:"LINEAR",rotate:90,stops:[{color:{type:"CUSTOM",rgb:[170,255,255]},position:0},{color:{type:"CUSTOM",rgb:[0,168,255]},position:0.28},{color:{type:"CUSTOM",rgb:[28,137,195]},position:0.42},{color:{type:"CUSTOM",rgb:[0,168,255]},position:0.62},{color:{type:"CUSTOM",rgb:[83,196,255]},position:0.81},
{color:{type:"CUSTOM",rgb:[153,220,255]},position:1}]},PRESET1:{type:"LINEAR",rotate:90,stops:[{color:{type:"CUSTOM",rgb:[245,132,31]},position:0},{color:{type:"CUSTOM",rgb:[180,84,39]},position:0.47},{color:{type:"CUSTOM",rgb:[194,89,39]},position:0.48},{color:{type:"CUSTOM",rgb:[244,123,32]},position:1}]},PRESET6:{type:"LINEAR",rotate:90,stops:[{color:{type:"CUSTOM",rgb:[255,147,147]},position:0},{color:{type:"CUSTOM",rgb:[130,255,155]},position:0.36},{color:{type:"CUSTOM",rgb:[14,150,255]},position:0.84},
{color:{type:"CUSTOM",rgb:[199,231,255]},position:1}]},PRESET5:{type:"LINEAR",rotate:90,stops:[{color:{type:"CUSTOM",rgb:[255,126,0]},position:0},{color:{type:"CUSTOM",rgb:[255,0,0]},position:0.42},{color:{type:"CUSTOM",rgb:[14,150,255]},position:0.84},{color:{type:"CUSTOM",rgb:[199,231,255]},position:1}]},PRESET4:{type:"LINEAR",rotate:90,stops:[{color:{type:"CUSTOM",rgb:[255,90,0]},position:0},{color:{type:"CUSTOM",rgb:[193,0,0]},position:0.19},{color:{type:"CUSTOM",rgb:[249,103,0]},position:0.74},
{color:{type:"CUSTOM",rgb:[255,0,0]},position:0.84},{color:{type:"CUSTOM",rgb:[178,0,0]},position:1}]},PRESET3:{type:"LINEAR",rotate:90,stops:[{color:{type:"CUSTOM",rgb:[184,255,0]},position:0},{color:{type:"CUSTOM",rgb:[148,212,19]},position:0.52},{color:{type:"CUSTOM",rgb:[131,178,22]},position:0.52},{color:{type:"CUSTOM",rgb:[180,218,35]},position:0.92},{color:{type:"CUSTOM",rgb:[210,238,53]},position:1}]},PRESET17:{type:"LINEAR",rotate:90,stops:[{color:{type:"CUSTOM",rgb:[255,241,101]},position:0},
{color:{type:"CUSTOM",rgb:[255,217,89]},position:0.28},{color:{type:"CUSTOM",rgb:[37,178,75]},position:0.67},{color:{type:"CUSTOM",rgb:[29,120,126]},position:0.89},{color:{type:"CUSTOM",rgb:[46,48,146]},position:1}]},PRESET9:{type:"LINEAR",rotate:90,stops:[{color:{type:"CUSTOM",rgb:[255,201,153]},position:0},{color:{type:"CUSTOM",rgb:[204,99,0]},position:0.59},{color:{type:"CUSTOM",rgb:[255,124,0]},position:0.6},{color:{type:"CUSTOM",rgb:[255,238,223]},position:1}]},PRESET16:{type:"LINEAR",rotate:90,
stops:[{color:{type:"CUSTOM",rgb:[151,70,26]},position:0},{color:{type:"CUSTOM",rgb:[251,216,197]},position:0.3},{color:{type:"CUSTOM",rgb:[108,46,22]},position:1}]},PRESET8:{type:"LINEAR",rotate:90,stops:[{color:{type:"CUSTOM",rgb:[41,10,89]},position:0},{color:{type:"CUSTOM",rgb:[255,124,0]},position:1}]},PRESET19:{type:"LINEAR",rotate:90,stops:[{color:{type:"CUSTOM",rgb:[89,181,245]},position:0},{color:{type:"CUSTOM",rgb:[255,255,255]},position:0.5},{color:{type:"CUSTOM",rgb:[193,232,250]},position:0.52},
{color:{type:"CUSTOM",rgb:[255,255,255]},position:1}]},PRESET7:{type:"LINEAR",rotate:90,stops:[{color:{type:"CUSTOM",rgb:[41,137,204]},position:0},{color:{type:"CUSTOM",rgb:[217,159,0]},position:0.5},{color:{type:"CUSTOM",rgb:[255,255,255]},position:0.83},{color:{type:"CUSTOM",rgb:[247,181,0]},position:0.84},{color:{type:"CUSTOM",rgb:[122,185,234]},position:1}]},PRESET18:{type:"LINEAR",rotate:90,stops:[{color:{type:"CUSTOM",rgb:[30,93,178]},position:0},{color:{type:"CUSTOM",rgb:[127,169,226]},position:0.29},
{color:{type:"CUSTOM",rgb:[10,57,122]},position:0.5},{color:{type:"CUSTOM",rgb:[127,169,226]},position:0.8},{color:{type:"CUSTOM",rgb:[30,93,178]},position:1}]},PRESET13:{type:"LINEAR",rotate:90,stops:[{color:{type:"CUSTOM",rgb:[120,212,0]},position:0},{color:{type:"CUSTOM",rgb:[136,209,0]},position:0.17},{color:{type:"CUSTOM",rgb:[87,134,0]},position:0.29},{color:{type:"CUSTOM",rgb:[56,99,0]},position:0.29},{color:{type:"CUSTOM",rgb:[255,255,255]},position:0.52},{color:{type:"CUSTOM",rgb:[139,235,
0]},position:0.71},{color:{type:"CUSTOM",rgb:[63,109,0]},position:1}]},PRESET12:{type:"LINEAR",rotate:90,stops:[{color:{type:"CUSTOM",rgb:[255,255,255]},position:0},{color:{type:"CUSTOM",rgb:[255,248,136]},position:0.25},{color:{type:"CUSTOM",rgb:[249,185,32]},position:0.5},{color:{type:"CUSTOM",rgb:[255,248,136]},position:0.75},{color:{type:"CUSTOM",rgb:[255,255,255]},position:1}]},PRESET15:{type:"LINEAR",rotate:90,stops:[{color:{type:"CUSTOM",rgb:[10,77,178]},position:0},{color:{type:"CUSTOM",rgb:[255,
255,255]},position:0.15},{color:{type:"CUSTOM",rgb:[0,63,190]},position:0.3},{color:{type:"CUSTOM",rgb:[173,234,42]},position:0.54},{color:{type:"CUSTOM",rgb:[176,195,235]},position:0.79},{color:{type:"CUSTOM",rgb:[220,231,251]},position:1}]},PRESET14:{type:"LINEAR",rotate:90,stops:[{color:{type:"CUSTOM",rgb:[201,242,131]},position:0},{color:{type:"CUSTOM",rgb:[159,216,36]},position:0.24},{color:{type:"CUSTOM",rgb:[128,187,0]},position:0.4},{color:{type:"CUSTOM",rgb:[173,234,142]},position:0.54},
{color:{type:"CUSTOM",rgb:[182,171,0]},position:0.77},{color:{type:"CUSTOM",rgb:[255,246,0]},position:1}]},PRESET20:{type:"LINEAR",rotate:90,stops:[{color:{type:"CUSTOM",rgb:[89,181,245]},position:0},{color:{type:"CUSTOM",rgb:[13,84,134]},position:0.58},{color:{type:"CUSTOM",rgb:[255,255,255]},position:1}]},PRESET11:{type:"LINEAR",rotate:90,stops:[{color:{type:"CUSTOM",rgb:[141,168,255]},position:0},{color:{type:"CUSTOM",rgb:[112,131,255]},position:0.55},{color:{type:"CUSTOM",rgb:[83,103,255]},position:0.55},
{color:{type:"CUSTOM",rgb:[255,255,255]},position:1}]},PRESET10:{type:"LINEAR",rotate:90,stops:[{color:{type:"CUSTOM",rgb:[255,15,15]},position:0},{color:{type:"CUSTOM",rgb:[255,143,143]},position:0.3},{color:{type:"CUSTOM",rgb:[255,15,15]},position:0.59},{color:{type:"CUSTOM",rgb:[191,6,6]},position:0.65},{color:{type:"CUSTOM",rgb:[255,15,15]},position:0.87},{color:{type:"CUSTOM",rgb:[255,255,255]},position:1}]},PRESET21:{type:"LINEAR",rotate:90,stops:[{color:{type:"CUSTOM",rgb:[252,227,166]},position:0},
{color:{type:"CUSTOM",rgb:[187,132,1]},position:0.52},{color:{type:"CUSTOM",rgb:[193,141,16]},position:0.74},{color:{type:"CUSTOM",rgb:[255,190,34]},position:1}]}}}})(jQuery);(function(m){var a=/(webkit)[ \/]([\w.]+)/,b=/(opera)(?:.*version)?[ \/]([\w.]+)/,c=/(msie) ([\w.]+)/,f=/(mozilla)(?:.*? rv:([\w.]+))?/;m.browser={};var d=function(e){e=e.toLowerCase();e=a.exec(e)||b.exec(e)||c.exec(e)||e.indexOf("compatible")<0&&f.exec(e)||[];return{browser:e[1]||"",version:e[2]||"0"}}(navigator.userAgent);if(d.browser){m.browser[d.browser]=true;m.browser.version=d.version}if(m.browser.webkit)m.browser.safari=true})(jQuery);(function(m){m.ShowConstants={ScreenType:{SIXTEEN_BY_TEN:{width:"960",height:"600"},FOUR_BY_THREE:{width:"960",height:"720"},SIXTEEN_BY_NINE:{width:"960",height:"540"}},DateTimeField:{FORMAT9:"monthnum-date-year-hour-min-sec-ampm",FORMAT7:"halfmonth-halfyear",FORMAT8:"monthnum-date-year-hour-min-ampm",FORMAT1:"monthnum-date-year",FORMAT11:"hour-min-sec",FORMAT2:"day-month-date-year",FORMAT10:"hour-min",FORMAT5:"date-halfmonth-halfyear",FORMAT6:"month-halfyear",FORMAT3:"date-month-year",FORMAT4:"month-date-year",
FORMAT15:"year-monthnum-date",FORMAT14:"year-monthnum-date",FORMAT13:"hour-min-sec-ampm",FORMAT12:"hour-min-ampm"}}})(jQuery);(function(m){m.ShapeConstants={StyleAnimationProp:{STROKE:"STROKE",FILL:"FILL",TRANSFORM:"TRANSFORM",PROPS:"PROPS",EFFECTS:"EFFECTS"},AnimationStart:{WITHEFFECT:"WITHEFFECT",AFTEREFFECT:"AFTEREFFECT",CLICK:"CLICK"},FontRef:{MAJOR:"MAJOR",MINOR:"MINOR"},PresetProps:{PRESET2:"PRESET2",PRESET1:"PRESET1",PRESET6:"PRESET6",PRESET5:"PRESET5",PRESET4:"PRESET4",PRESET3:"PRESET3",PRESET9:"PRESET9",PRESET8:"PRESET8",PRESET7:"PRESET7",PRESET13:"PRESET13",PRESET12:"PRESET12",PRESET14:"PRESET14",PRESET11:"PRESET11",
PRESET10:"PRESET10"},Size:{MEDIUM:"MEDIUM",WIDE:"WIDE",NARROW:"NARROW"},SearchedFrom:{PICASA:"PICASA",FLICKR:"FLICKR",GOOGLE:"GOOGLE"},LangDirection:{LTR:"LTR",RTL:"RTL"},TweakMode:{ABSOLUTE:"ABSOLUTE",MODIFY:"MODIFY",OFFSET:"OFFSET"},DateTimeField:{FORMAT9:"FORMAT9",FORMAT7:"FORMAT7",FORMAT8:"FORMAT8",FORMAT1:"FORMAT1",FORMAT11:"FORMAT11",FORMAT2:"FORMAT2",FORMAT10:"FORMAT10",FORMAT5:"FORMAT5",FORMAT6:"FORMAT6",FORMAT3:"FORMAT3",FORMAT4:"FORMAT4",FORMAT15:"FORMAT15",FORMAT14:"FORMAT14",FORMAT13:"FORMAT13",
FORMAT12:"FORMAT12"},AllowedDomains:{TUBECHOP_COM:"TUBECHOP_COM",PHOTOSYNTH_NET:"PHOTOSYNTH_NET",PREZI_COM:"PREZI_COM",VIDDLER_COM:"VIDDLER_COM",LIVESTREAM_COM:"LIVESTREAM_COM",YOUKU_COM:"YOUKU_COM",ZOHO_COM:"ZOHO_COM",YAHOO_COM:"YAHOO_COM",YOUTU_BE:"YOUTU_BE",SKYDESK_JP:"SKYDESK_JP",PHOTOBUCKET_COM:"PHOTOBUCKET_COM",NO_DOMAIN:"NO_DOMAIN",CLICFLIC_COM:"CLICFLIC_COM",_24TRU_COM:"_24TRU_COM",TEACHERTUBE_COM:"TEACHERTUBE_COM",NDTV_COM:"NDTV_COM",MLB_COM:"MLB_COM",SALESFORCE_COM:"SALESFORCE_COM",SOUNDCLOUD_COM:"SOUNDCLOUD_COM",
TED_COM:"TED_COM",FLICKR_COM:"FLICKR_COM",ANIMOTO_COM:"ANIMOTO_COM",YIMG_COM:"YIMG_COM",GOANIMATE_COM:"GOANIMATE_COM",BLIP_TV:"BLIP_TV",QUALVU_COM:"QUALVU_COM",REVERBNATION_COM:"REVERBNATION_COM",GOOGLE_COM:"GOOGLE_COM",DAILYMOTION_COM:"DAILYMOTION_COM",FACEBOOK_COM:"FACEBOOK_COM",SLIDESHARE_NET:"SLIDESHARE_NET",GETLOUPE_COM:"GETLOUPE_COM",VIMEO_COM:"VIMEO_COM",_360CITIES_NET:"_360CITIES_NET",PLANNINGCENTERONLINE_COM:"PLANNINGCENTERONLINE_COM",LATERALVISION_COM:"LATERALVISION_COM",HISTORY_COM:"HISTORY_COM",
YOUTUBE_COM:"YOUTUBE_COM",ZOHOPUBLIC_COM:"ZOHOPUBLIC_COM",SCREENCAST_COM:"SCREENCAST_COM",VOCAROO_COM:"VOCAROO_COM",DOTSUB_COM:"DOTSUB_COM",VOICETHREAD_COM:"VOICETHREAD_COM",SLIDESHARECDN_COM:"SLIDESHARECDN_COM",SCHOOLTUBE_COM:"SCHOOLTUBE_COM",MYSPACE_COM:"MYSPACE_COM",_4SHARED_COM:"_4SHARED_COM",AMCHARTS_COM:"AMCHARTS_COM"},TextOverflow:{OVERFLOW:"OVERFLOW",CLIP:"CLIP"},SpacingValueType:{ABSOLUTE:"ABSOLUTE",PERCENT:"PERCENT"},TextDirection:{VERTICAL:"VERTICAL",VERTICAL270:"VERTICAL270",WORDARTVERTICAL:"WORDARTVERTICAL",
HORIZONTAL:"HORIZONTAL"},CapType:{SQUARE:"SQUARE",CROUND:"CROUND",FLAT:"FLAT"},ScreenType:{SIXTEEN_BY_TEN:"SIXTEEN_BY_TEN",CUSTOM:"CUSTOM",FOUR_BY_THREE:"FOUR_BY_THREE",SIXTEEN_BY_NINE:"SIXTEEN_BY_NINE"},FillType:{GRP:"GRP",NONE:"NONE",SOLID:"SOLID",GRADIENT:"GRADIENT",PICT:"PICT"},TimeUnit:{MONTHS:"MONTHS",YEARS:"YEARS",DAYS:"DAYS"},DynamicSlideType:{LAST:"LAST",NEXT:"NEXT",LASTVIEWED:"LASTVIEWED",FIRST:"FIRST",PREVIOUS:"PREVIOUS"},RepresentBubbleSize:{AREA:"AREA",WIDTH:"WIDTH"},PatternType:{NONE:"NONE",
FADE:"FADE"},LinkSlideType:{FIXED:"FIXED",DYNAMIC:"DYNAMIC"},HideElement:{ALL:"ALL",SHAPES:"SHAPES",PLACEHOLDERS:"PLACEHOLDERS"},LayoutMode:{FACTOR:"FACTOR",EDGE:"EDGE"},TickMarkType:{IN:"IN",CROSS:"CROSS",NONE:"NONE",OUT:"OUT"},AnimationNode:{BG:"BG",PARA:"PARA"},Grouping:{STACKED:"STACKED",PERCENTSTACKED:"PERCENTSTACKED",STANDARD:"STANDARD",CLUSTERED:"CLUSTERED"},Orientation:{MINMAX:"MINMAX",MAXMIN:"MAXMIN"},BarShapeType:{CYLINDER:"CYLINDER",PYRAMID:"PYRAMID",BOX:"BOX",CONE:"CONE"},GraphicObjectType:{TABLE:"TABLE",
CHART:"CHART"},TextType:{STR:"STR",RICH:"RICH"},FontVariant:{CAPITALIZE:"CAPITALIZE",ALLCAPS:"ALLCAPS",SMALLCAPS:"SMALLCAPS",NONE:"NONE"},StyleAnimationType:{OBJECT_COLOR:"OBJECT_COLOR",STROKE_COLOR:"STROKE_COLOR",SPIN:"SPIN",DESATURATE:"DESATURATE",COMPLEMENTARY_COLOR:"COMPLEMENTARY_COLOR",TEETER:"TEETER",GROW_WITH_COLOR:"GROW_WITH_COLOR",LIGHTEN:"LIGHTEN",CONTRAST_COLOR:"CONTRAST_COLOR",UNDERLINE:"UNDERLINE",FLASH:"FLASH",COLORPULSE:"COLORPULSE",GROW:"GROW",BRUSH:"BRUSH",BOLD_REVEAL:"BOLD_REVEAL",
SHAKE:"SHAKE",PULSE:"PULSE",TRANSPARENCY:"TRANSPARENCY",FONT_COLOR:"FONT_COLOR",FILL_COLOR:"FILL_COLOR",DARKEN:"DARKEN",NONE:"NONE",BOLD_FLASH:"BOLD_FLASH"},ReviewState:{PROCESSED:"PROCESSED",ERROR:"ERROR",IGNORED:"IGNORED"},OperationType:{DELETE:"DELETE",REORDER:"REORDER",CUSTOM:"CUSTOM",INSERT:"INSERT",UPDATE:"UPDATE",TEXT:"TEXT"},EmbedObjectType:{NOT_KNOWN:"NOT_KNOWN",IFRAME:"IFRAME"},TextWrap:{RECT:"RECT",NONE:"NONE"},DocumentContentOperationType:{GROUP:"GROUP",UNGROUP:"UNGROUP"},PortionType:{FIELD:"FIELD",
LINEBREAK:"LINEBREAK"},RepresentiveType:{BAR:"BAR",PIE:"PIE"},DisplayUnitType:{HUNDREDS:"HUNDREDS",THOUSANDS:"THOUSANDS",MILLIONS:"MILLIONS",BILLIONS:"BILLIONS",HUNDREDMILLIONS:"HUNDREDMILLIONS",HUNDREDTHOUSANDS:"HUNDREDTHOUSANDS",TENMILLIONS:"TENMILLIONS",TENTHOUSANDS:"TENTHOUSANDS",CUSTOM:"CUSTOM",TRILLIONS:"TRILLIONS",NONE:"NONE"},VerticalAlignType:{TOP:"TOP",BOTTOM:"BOTTOM",MIDDLE:"MIDDLE"},BulletType:{NUMBER:"NUMBER",PICTURE:"PICTURE",CHARACTER:"CHARACTER",NONE:"NONE"},Direction:{CENTER:"CENTER",
DOWN:"DOWN",LEFT_DOWN:"LEFT_DOWN",RIGHT_UP:"RIGHT_UP",LEFT:"LEFT",RIGHT:"RIGHT",LEFT_UP:"LEFT_UP",RIGHT_DOWN:"RIGHT_DOWN",UP:"UP"},TwitterType:{MARKED:"MARKED",LIVE:"LIVE"},ObjectType:{STRIP:"STRIP",PARTICLE:"PARTICLE"},EmbeddedSite:{YOUTUBE:"YOUTUBE",DAILYMOTION:"DAILYMOTION",TWITTER:"TWITTER"},PresetShapeGeometry:{CURVED_UP_RIBBON:"CURVED_UP_RIBBON",SNIP_ROUND_SINGLE_RECT:"SNIP_ROUND_SINGLE_RECT",RIGHT_ARROW:"RIGHT_ARROW",MAGNETIC_DISK:"MAGNETIC_DISK",SIX_POINT_STAR:"SIX_POINT_STAR",CURVED_DOWN_ARROW:"CURVED_DOWN_ARROW",
CHEVRON:"CHEVRON",DOUBLE_WAVE:"DOUBLE_WAVE",DOUBLE_BRACKET:"DOUBLE_BRACKET",MINUS:"MINUS",MANUAL_OPERATION:"MANUAL_OPERATION",OFFPAGE_CONNECTOR:"OFFPAGE_CONNECTOR",TWELVE_POINT_STAR:"TWELVE_POINT_STAR",PROCESS:"PROCESS",U_TURN_ARROW:"U_TURN_ARROW",BENT_UP_ARROW:"BENT_UP_ARROW",SEQUENTIAL_ACCESS_STORAGE:"SEQUENTIAL_ACCESS_STORAGE",EIGHT_POINT_STAR:"EIGHT_POINT_STAR",CURVED_UP_ARROW:"CURVED_UP_ARROW",DODECAGON:"DODECAGON",MOON:"MOON",ACTION_NEXT:"ACTION_NEXT",LEFT_BRACKET:"LEFT_BRACKET",LEFT_UP_ARROW:"LEFT_UP_ARROW",
PARALLELOGRAM:"PARALLELOGRAM",STORED_DATA:"STORED_DATA",CUBE:"CUBE",STRIPED_RIGHT_ARROW:"STRIPED_RIGHT_ARROW",BENT_ARROW:"BENT_ARROW",LEFT_ARROW_CALLOUT:"LEFT_ARROW_CALLOUT",SUN:"SUN",TEARDROP:"TEARDROP",DOWN_ARROW:"DOWN_ARROW",HEART:"HEART",ARC:"ARC",SNIP_SAMESIDE_RECT:"SNIP_SAMESIDE_RECT",SEVEN_POINT_STAR:"SEVEN_POINT_STAR",UP_DOWN_ARROW:"UP_DOWN_ARROW",ELBOW_CONNECTOR5:"ELBOW_CONNECTOR5",ELBOW_CONNECTOR2:"ELBOW_CONNECTOR2",CLOCK:"CLOCK",ELBOW_CONNECTOR4:"ELBOW_CONNECTOR4",ACTION_HOME:"ACTION_HOME",
ELBOW_CONNECTOR3:"ELBOW_CONNECTOR3",FLOWCHART_CONNECTOR:"FLOWCHART_CONNECTOR",DIAMOND:"DIAMOND",MERGE:"MERGE",FIVE_POINT_STAR:"FIVE_POINT_STAR",CALLOUT1:"CALLOUT1",CALLOUT2:"CALLOUT2",TRAPEZOID:"TRAPEZOID",BLOCK_ARC:"BLOCK_ARC",LEFT_RIGHT_ARROW:"LEFT_RIGHT_ARROW",CALLOUT3:"CALLOUT3",FRAME:"FRAME",DIVIDE:"DIVIDE",EXPLOSION1:"EXPLOSION1",EXPLOSION2:"EXPLOSION2",QUAD_ARROW_CALLOUT:"QUAD_ARROW_CALLOUT",HORIZONTAL_SCROLL:"HORIZONTAL_SCROLL",ACTION_BEGIN:"ACTION_BEGIN",SIXTEEN_POINT_STAR:"SIXTEEN_POINT_STAR",
SNIP_DIAGONAL_RECT:"SNIP_DIAGONAL_RECT",ROUND_SINGLE_RECT:"ROUND_SINGLE_RECT",PUNCHED_CARD:"PUNCHED_CARD",SNIP_SINGLE_RECT:"SNIP_SINGLE_RECT",HEPTAGON:"HEPTAGON",ACTION_INFORMATION:"ACTION_INFORMATION",TWENTY_FOUR_POINT_STAR:"TWENTY_FOUR_POINT_STAR",COLLATE:"COLLATE",CURVED_DOWN_RIBBON:"CURVED_DOWN_RIBBON",GRID:"GRID",CURVED_CONNECTOR5:"CURVED_CONNECTOR5",NOTCHED_RIGHT_ARROW:"NOTCHED_RIGHT_ARROW",CURVED_CONNECTOR4:"CURVED_CONNECTOR4",SUMMING_JUNCTION:"SUMMING_JUNCTION",CURVED_CONNECTOR3:"CURVED_CONNECTOR3",
ACTION_END:"ACTION_END",PIE:"PIE",PLAQUE:"PLAQUE",UP_RIBBON:"UP_RIBBON",SMILEY:"SMILEY",ACTION_MOVIE:"ACTION_MOVIE",ACCENT_CALLOUT2:"ACCENT_CALLOUT2",CURVED_CONNECTOR2:"CURVED_CONNECTOR2",HEXAGON:"HEXAGON",ACCENT_CALLOUT1:"ACCENT_CALLOUT1",OVAL:"OVAL",RECTANGULAR_CALLOUT:"RECTANGULAR_CALLOUT",NOT_EQUAL:"NOT_EQUAL",TEN_POINT_STAR:"TEN_POINT_STAR",ACCENT_CALLOUT3:"ACCENT_CALLOUT3",PREDEFINED_PROCESS:"PREDEFINED_PROCESS",PUNCHED_TAPE:"PUNCHED_TAPE",TERMINATOR:"TERMINATOR",DIAGONAL_STRIPE:"DIAGONAL_STRIPE",
DECISION:"DECISION",RIGHT_TRIANGLE:"RIGHT_TRIANGLE",FLOWCHART_DOCUMENT:"FLOWCHART_DOCUMENT",LEFT_ARROW:"LEFT_ARROW",FOLDED_CORNER:"FOLDED_CORNER",OVAL_CALLOUT:"OVAL_CALLOUT",ACTION_CUSTOM:"ACTION_CUSTOM",TABLECELL:"TABLECELL",PENTAGON_ARROW:"PENTAGON_ARROW",DOWN_ARROW_CALLOUT:"DOWN_ARROW_CALLOUT",ACTION_RETURN:"ACTION_RETURN",MANUAL_INPUT:"MANUAL_INPUT",CURVED_RIGHT_ARROW:"CURVED_RIGHT_ARROW",LIGHTNING_BOLT:"LIGHTNING_BOLT",BEVEL:"BEVEL",OCTAGON:"OCTAGON",LEFT_BRACE:"LEFT_BRACE",ACTION_PREVIOUS:"ACTION_PREVIOUS",
CURVED_LEFT_ARROW:"CURVED_LEFT_ARROW",PREPARATION:"PREPARATION",EXTRACT:"EXTRACT",LOCK_SYMBOL:"LOCK_SYMBOL",UP_ARROW_CALLOUT:"UP_ARROW_CALLOUT",NO_SYMBOL:"NO_SYMBOL",DIRECT_ACCESS_STORAGE:"DIRECT_ACCESS_STORAGE",FOUR_POINT_STAR:"FOUR_POINT_STAR",ACTION_SOUND:"ACTION_SOUND",ISOSCELES_TRIANGLE:"ISOSCELES_TRIANGLE",ROUND_DIAGONAL_RECT:"ROUND_DIAGONAL_RECT",CAN:"CAN",HALF_FRAME:"HALF_FRAME",DOUBLE_BRACE:"DOUBLE_BRACE",RIGHT_ARROW_CALLOUT:"RIGHT_ARROW_CALLOUT",DATA:"DATA",ROUNDED_RECTANGULAR_CALLOUT:"ROUNDED_RECTANGULAR_CALLOUT",
ALTERNATE_PROCESS:"ALTERNATE_PROCESS",SORT:"SORT",THIRTY_TWO_POINT_STAR:"THIRTY_TWO_POINT_STAR",MULTIPLY:"MULTIPLY",DELAY:"DELAY",PLUS:"PLUS",RECT:"RECT",PENTAGON:"PENTAGON",CLOUD:"CLOUD",ACTION_DOCUMENT:"ACTION_DOCUMENT",UP_ARROW:"UP_ARROW",ROUND_SAMESIDE_RECT:"ROUND_SAMESIDE_RECT",LEFT_RIGHT_UP_ARROW:"LEFT_RIGHT_UP_ARROW",QUAD_ARROW:"QUAD_ARROW",WAVE:"WAVE",DISPLAY:"DISPLAY",DECAGON:"DECAGON",DOWN_RIBBON:"DOWN_RIBBON",LSHAPE:"LSHAPE",MULTI_DOCUMENT:"MULTI_DOCUMENT",ACCENT_BORDER_CALLOUT3:"ACCENT_BORDER_CALLOUT3",
LEFT_RIGHT_ARROW_CALLOUT:"LEFT_RIGHT_ARROW_CALLOUT",ACCENT_BORDER_CALLOUT2:"ACCENT_BORDER_CALLOUT2",LINE:"LINE",ACTION_HELP:"ACTION_HELP",CLOUD_CALLOUT:"CLOUD_CALLOUT",DONUT:"DONUT",RIGHT_BRACE:"RIGHT_BRACE",OR:"OR",EQUAL:"EQUAL",VERTICAL_SCROLL:"VERTICAL_SCROLL",ACCENT_BORDER_CALLOUT1:"ACCENT_BORDER_CALLOUT1",CIRCULAR_ARROW:"CIRCULAR_ARROW",ROUND_RECT:"ROUND_RECT",CHORD:"CHORD",RIGHT_BRACKET:"RIGHT_BRACKET",BORDER_CALLOUT3:"BORDER_CALLOUT3",CROSS:"CROSS",BORDER_CALLOUT1:"BORDER_CALLOUT1",BORDER_CALLOUT2:"BORDER_CALLOUT2",
INTERNAL_STORAGE:"INTERNAL_STORAGE"},MergeRule:{COMBINE:"COMBINE",NO_RULE:"NO_RULE",INTERSECT:"INTERSECT",UNION:"UNION",SUBTRACT:"SUBTRACT",INVERSE_INTERFECT:"INVERSE_INTERFECT"},CreativeCommonsLicense:{ANN:"ANN",A:"A",AS:"AS",ANCS:"ANCS",ANC:"ANC",AN:"AN"},AnimationVariant:{PATH:"PATH",ENTRY:"ENTRY",EMPHASIS:"EMPHASIS",EXIT:"EXIT"},ScatterType:{LINEMARKER:"LINEMARKER",MARKER:"MARKER",SMOOTHMARKER:"SMOOTHMARKER",LINE:"LINE",SMOOTH:"SMOOTH",NONE:"NONE"},ShadowType:{OUTER:"OUTER",INNER:"INNER"},CyclicCategory:{TOGGLE:"TOGGLE",
PEAK_AND_RETURN:"PEAK_AND_RETURN"},HorizontalAlignType:{CENTER:"CENTER",LEFT:"LEFT",RIGHT:"RIGHT"},PathType:{CC:"CC",QC:"QC",C:"C",L:"L",EA:"EA",M:"M"},Ref:{THEME:"THEME",CUSTOM:"CUSTOM",THEMEINDEX:"THEMEINDEX"},DataLabelPosition:{CENTER:"CENTER",LEFT:"LEFT",TOP:"TOP",RIGHT:"RIGHT",BOTTOM:"BOTTOM",INBASE:"INBASE",OUTEND:"OUTEND",BESTFIT:"BESTFIT",INEND:"INEND"},ColorSchemeIndex:{ACCENT4:"ACCENT4",DARK2:"DARK2",ACCENT5:"ACCENT5",ACCENT2:"ACCENT2",ACCENT3:"ACCENT3",DARK1:"DARK1",ACCENT6:"ACCENT6",HLINK:"HLINK",
FOLLOWHLINK:"FOLLOWHLINK",LIGHT2:"LIGHT2",LIGHT1:"LIGHT1",ACCENT1:"ACCENT1"},LinkType:{SLIDE:"SLIDE",CUSTOM:"CUSTOM",LINK:"LINK",NONE:"NONE",EMAIL:"EMAIL"},BarType:{COL:"COL",BAR:"BAR"},ActionType:{CHANGE_THEME:"CHANGE_THEME",PAGE_SETUP:"PAGE_SETUP"},KeyType:{DEFINED:"DEFINED",USER_DEFINED:"USER_DEFINED",NO_TYPE:"NO_TYPE"},RotateDirection:{CLOCKWISE:"CLOCKWISE",ANTI_CLOCKWISE:"ANTI_CLOCKWISE"},StrokeType:{DASHDOT:"DASHDOT",SQUARE_DOT:"SQUARE_DOT",LONG_DASH:"LONG_DASH",ROUND_DOT:"ROUND_DOT",LONG_DASH_DOT_DOT:"LONG_DASH_DOT_DOT",
LONG_DASH_DOT:"LONG_DASH_DOT",SOLID:"SOLID",DASH:"DASH"},LayoutType:{TXT_TWO_OBJ:"TXT_TWO_OBJ",TWO_OBJ:"TWO_OBJ",OBJ_TXT:"OBJ_TXT",TWO_OBJ_OBJ:"TWO_OBJ_OBJ",CLIPART_VERT_TXT:"CLIPART_VERT_TXT",TWO_OBJ_TXT:"TWO_OBJ_TXT",TITLE_FOUR_PICT:"TITLE_FOUR_PICT",TABLE:"TABLE",TXT:"TXT",TXT_OVER_OBJ:"TXT_OVER_OBJ",PIC_TITLE_CENTER:"PIC_TITLE_CENTER",MEDIA_TXT:"MEDIA_TXT",OBJ:"OBJ",TWO_OBJ_TWO_TXT:"TWO_OBJ_TWO_TXT",VERT_TITLE_TXT:"VERT_TITLE_TXT",CUSTOM:"CUSTOM",TXT_CHART:"TXT_CHART",PIC_TXT:"PIC_TXT",THREE_PICT_TXT:"THREE_PICT_TXT",
PIC_TITLE_TXT_RGT:"PIC_TITLE_TXT_RGT",CHART_TXT:"CHART_TXT",TITLE_ONLY:"TITLE_ONLY",FOUR_OBJ:"FOUR_OBJ",PIC_TITLE_TXT_LFT:"PIC_TITLE_TXT_LFT",OBJ_OVER_TXT:"OBJ_OVER_TXT",TXT_OBJ:"TXT_OBJ",TWO_OBJ_OVER_TXT:"TWO_OBJ_OVER_TXT",OBJ_ONLY:"OBJ_ONLY",PIC_TITLE_LFT:"PIC_TITLE_LFT",TXT_CLIPART:"TXT_CLIPART",SMARTART:"SMARTART",VERT_TXT:"VERT_TXT",CHART:"CHART",VERT_TITLE_TX_OVER_CHART:"VERT_TITLE_TX_OVER_CHART",BLANK:"BLANK",SEC_HEADER:"SEC_HEADER",OBJ_AND_TXT:"OBJ_AND_TXT",TXT_MEDIA:"TXT_MEDIA",PIC_TITLE_RGT:"PIC_TITLE_RGT",
TITLE_THREE_PICT_TXT:"TITLE_THREE_PICT_TXT",TITLE_TXT_TWO_PICT:"TITLE_TXT_TWO_PICT",TITLE:"TITLE",TWO_TXT:"TWO_TXT",OBJ_TWO_OBJ:"OBJ_TWO_OBJ",CLIPART_TXT:"CLIPART_TXT"},SlideType:{MASTER:"MASTER",SLIDE:"SLIDE",LAYOUT:"LAYOUT"},TransitionType:{PATH:"PATH",GLITTER:"GLITTER",DOOR:"DOOR",WHIP:"WHIP",CURVY_FLOAT:"CURVY_FLOAT",RANDOMBAR:"RANDOMBAR",NONE:"NONE",COMB:"COMB",CHECKERS:"CHECKERS",CUT:"CUT",RIPPLE:"RIPPLE",FERRISWHEEL:"FERRISWHEEL",TWIRL:"TWIRL",FADED_SWIVEL:"FADED_SWIVEL",BOUNCE:"BOUNCE",CUBE:"CUBE",
GALLERY:"GALLERY",BOX:"BOX",PIVOT:"PIVOT",FADED_ZOOM:"FADED_ZOOM",SPINNER:"SPINNER",REVEAL:"REVEAL",FLASH:"FLASH",CIRCLE:"CIRCLE",GEOMETRIC:"GEOMETRIC",STRIPS:"STRIPS",NEWSFLASH:"NEWSFLASH",SWAP:"SWAP",CURVE_UP_OR_DOWN:"CURVE_UP_OR_DOWN",ROTATE:"ROTATE",PIN_WHEEL:"PIN_WHEEL",HONEYCOMB:"HONEYCOMB",CONVEYOR:"CONVEYOR",FLYTHRU:"FLYTHRU",DISSOLVE:"DISSOLVE",PLUS:"PLUS",PUSH:"PUSH",COVER:"COVER",FLOAT:"FLOAT",DIAMOND:"DIAMOND",GROW_OR_SHRINK_AND_TURN:"GROW_OR_SHRINK_AND_TURN",BOOMER:"BOOMER",CENTER_REVOLVE:"CENTER_REVOLVE",
WHEEL_WIPE:"WHEEL_WIPE",SPLIT:"SPLIT",FLIP:"FLIP",BLINDS:"BLINDS",DROP:"DROP",SHRED:"SHRED",WHEEL:"WHEEL",FLY:"FLY",ORBIT:"ORBIT",SPIRAL:"SPIRAL",FALL:"FALL",FADE:"FADE",RISEUP_SINKDOWN:"RISEUP_SINKDOWN",PULL:"PULL",EXPAND_OR_CONTRACT:"EXPAND_OR_CONTRACT",CREDITS:"CREDITS",APPEAR:"APPEAR",DRAW:"DRAW",RANDOM:"RANDOM",REVOLVINGDOOR:"REVOLVINGDOOR",VORTEX:"VORTEX",WINDOW:"WINDOW",WIPE:"WIPE",METEOR:"METEOR",SWIVEL:"SWIVEL",ZOOM:"ZOOM",PAN:"PAN",WEDGE:"WEDGE",PEEK:"PEEK"},AnimationObject:{SHAPE:"SHAPE",
CHART:"CHART"},SoundType:{EXTERNAL:"EXTERNAL",BUILTIN:"BUILTIN"},GradientFillType:{PATH:"PATH",RECTANGULAR:"RECTANGULAR",LINEAR:"LINEAR",RADIAL:"RADIAL"},ElementType:{STR:"STR",NUM:"NUM"},PageOrientation:{LANDSCAPE:"LANDSCAPE",PORTRAIT:"PORTRAIT"},DisplayBlank:{ZERO:"ZERO",GAP:"GAP",SPAN:"SPAN"},LinkOpenType:{NEW:"NEW",SELF:"SELF"},CrossBetween:{MIDCAT:"MIDCAT",DEFAULT:"DEFAULT"},ChartType:{AREA3D:"AREA3D",REPPIE:"REPPIE",DOUGHNUT:"DOUGHNUT",BUBBLE:"BUBBLE",BAR:"BAR",AREA:"AREA",BAR3D:"BAR3D",PIE3D:"PIE3D",
LINE:"LINE",SCATTER:"SCATTER",LINE3D:"LINE3D",PIE:"PIE"},AnimationRepeatType:{NEXTSLIDE:"NEXTSLIDE",REPEATCOUNT:"REPEATCOUNT",NEXTCLICK:"NEXTCLICK"},DefinedKey:{FULLSCREEN:"FULLSCREEN",BORDER:"BORDER",TRANSPARENCY:"TRANSPARENCY",UNDEFINED:"UNDEFINED",SCROLLING:"SCROLLING"},ColorReference:{FOLLOWHLINK:"FOLLOWHLINK",LT1:"LT1",DK1:"DK1",TX1:"TX1",BG2:"BG2",BG1:"BG1",TX2:"TX2",A1:"A1",A2:"A2",A3:"A3",A4:"A4",A5:"A5",HOLDER:"HOLDER",A6:"A6",HLINK:"HLINK",CUSTOM:"CUSTOM"},MergeRelative:{NON_RELATED:"NON_RELATED",
TOP:"TOP",BG:"BG",BOTTOM:"BOTTOM"},PictureType:{TEXTURE:"TEXTURE",EXTERNAL:"EXTERNAL",THEMEBG:"THEMEBG",CLIPART:"CLIPART",USERDEFINED:"USERDEFINED",PLACEHOLDER:"PLACEHOLDER"},ShapeGeometryType:{PRESET:"PRESET",CUSTOM:"CUSTOM"},TextAnimationType:{PARA:"PARA",BOX:"BOX",LEVEL:"LEVEL"},CrossType:{MIN:"MIN",MAX:"MAX",MANUAL:"MANUAL",AUTOZERO:"AUTOZERO"},ShapeNodeType:{SHAPE:"SHAPE",PICTURE:"PICTURE",PARAGRAPH:"PARAGRAPH",GRAPHICFRAME:"GRAPHICFRAME",GROUPSHAPE:"GROUPSHAPE",CONNECTOR:"CONNECTOR"},FontWeight:{HEAVY:"HEAVY",
MEDIUM:"MEDIUM",LIGHT:"LIGHT",BOLD:"BOLD",BLACK:"BLACK",EXTRA_LIGHT:"EXTRA_LIGHT",DEMI_BOLD:"DEMI_BOLD",THIN:"THIN",NORMAL:"NORMAL"},PositionElement:{B:"B",R:"R",T:"T",L:"L",TR:"TR"},ProtocolScheme:{HTTPS:"HTTPS",NO_SCHEME:"NO_SCHEME",HTTP:"HTTP"},SplitType:{POS:"POS",PERCENT:"PERCENT",CUSTOM:"CUSTOM",VALUE:"VALUE"},Gradual:{PER_WORD:"PER_WORD",PER_LETTER:"PER_LETTER",PER_LINE:"PER_LINE",UNTIL_PROP:"UNTIL_PROP",UNTIL_END:"UNTIL_END",FULL_TEXT:"FULL_TEXT"},ChartLinePropsType:{STD:"STD",CUSTOM:"CUSTOM"},
LineType:{SINGLE:"SINGLE",NONE:"NONE"},Axis:{VER:"VER",HOR:"HOR"},MergeReference:{ABSOLUTE:"ABSOLUTE",RELATIVE:"RELATIVE",NO_REFERENCE:"NO_REFERENCE"},Loop:{FOREVER:"FOREVER",TILL_CHANGE:"TILL_CHANGE"},EmbedType:{EXTERNAL:"EXTERNAL",INTERNAL:"INTERNAL"},ValueType:{FLOAT:"FLOAT",STRING:"STRING",UNKNOWN:"UNKNOWN",BOOLEAN:"BOOLEAN"},Mode:{BILEVEL:"BILEVEL",SEPIA:"SEPIA",DUOTONE:"DUOTONE",GRAYSCALE:"GRAYSCALE",NONE:"NONE"},LockProp:{ROTATION:"ROTATION",ASPECT_CHANGE:"ASPECT_CHANGE",GROUP:"GROUP",RESIZE:"RESIZE",
MODIFY:"MODIFY",MOVE:"MOVE",ARROW_HEAD_CHANGE:"ARROW_HEAD_CHANGE",SHAPE_TYPE_CHANGE:"SHAPE_TYPE_CHANGE",UNGROUP:"UNGROUP",HANDLES:"HANDLES",SELECT:"SELECT",CROP:"CROP"},JoinType:{ROUND:"ROUND",BEVEL:"BEVEL",MITER:"MITER"},NumberedBulletType:{LCROMAN:"LCROMAN",UCROMAN:"UCROMAN",NUMERIC:"NUMERIC",UCALPHABET:"UCALPHABET",LCALPHABET:"LCALPHABET"},FillPictureAs:{TILE:"TILE",FRAME:"FRAME"},UpdateType:{AUTOMATIC:"AUTOMATIC",MANUAL:"MANUAL"},AutoFitType:{SHAPE:"SHAPE",NONE:"NONE",NORMAL:"NORMAL"},FieldType:{DATETIME:"DATETIME",
SLIDENUM:"SLIDENUM"},StyleAnimationCategory:{CYCLIC:"CYCLIC",GRADUAL:"GRADUAL"},PlaceHolderType:{TXTBODY:"TXTBODY",CLIPART:"CLIPART",FOOTER:"FOOTER",SUBTITLE:"SUBTITLE",SMARTART:"SMARTART",PICT:"PICT",CHART:"CHART",TABLE:"TABLE",TXT:"TXT",DATETIME:"DATETIME",MEDIA:"MEDIA",TITLE:"TITLE",CONTENT:"CONTENT",SLIDENUM:"SLIDENUM"},LabelPos:{NIL:"NIL",NEXTTO:"NEXTTO",HIGH:"HIGH",LOW:"LOW"},SeparatorType:{COMMA:"COMMA",SPACE:"SPACE",SEMICOLON:"SEMICOLON",NEWLINE:"NEWLINE",PERIOD:"PERIOD",ANY:"ANY"},SlideNumberField:{NUM2:"NUM2",
NUM1:"NUM1"},MarkerType:{DIAMOND:"DIAMOND",OVAL:"OVAL",BLOCK:"BLOCK",NONE:"NONE",CLASSIC:"CLASSIC",OPEN:"OPEN"},TransitionDirection:{OUT_FROM_BOTTOM:"OUT_FROM_BOTTOM",IN_FROM_CENTER:"IN_FROM_CENTER",IN:"IN",OUT_TO_CENTER:"OUT_TO_CENTER",OUT_SLIGHTLY:"OUT_SLIGHTLY",IN_TO_BOTTOM:"IN_TO_BOTTOM",IN_SLIGHTLY:"IN_SLIGHTLY",OUT:"OUT"},DataMarkerType:{SQUARE:"SQUARE",TRIANGLE:"TRIANGLE",STAR:"STAR",DIAMOND:"DIAMOND",PICTURE:"PICTURE",DOT:"DOT",XMARK:"XMARK",NONE:"NONE",DASH:"DASH",CIRCLE:"CIRCLE",PLUS:"PLUS"}}})(jQuery);(function(m){m.Preset={CURVED_UP_RIBBON:{name:"Curved Up Ribbon",modifiers:[0.25,0.5,0.125],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END"},ssDependent:false,max:{val:1},min:{val:0}}]},{values:[{num:1,modifier:{type:"X",origin:"END",multiplier:2},ssDependent:false,max:{val:0.75},min:{val:0.25}}]},{values:[{num:0,modifier:{type:"Y"},ssDependent:false}]}],pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.8}]}}},stroke:{fill:"NONE"}},
{fill:{fill:"NONE"}}]},SNIP_ROUND_SINGLE_RECT:{name:"Snip Round Single Rect",modifiers:[0.16,0.16],handles:[{values:[{num:0,modifier:{type:"X",origin:"END"},ssDependent:true,max:{val:0.5},min:{val:0}}]},{values:[{num:1,modifier:{type:"X"},ssDependent:true,max:{val:0.5},min:{val:0}}]}]},RIGHT_ARROW:{name:"Right Arrow",modifiers:[0.5,0.5],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END",multiplier:2},ssDependent:false,max:{val:1},min:{val:0}}]},{values:[{num:1,modifier:{type:"X",origin:"END"},
ssDependent:true,max:{val:1,compute:true},min:{val:0}}]}]},MAGNETIC_DISK:{name:"Magnetic Disk"},SIX_POINT_STAR:{name:"Six Point Star",modifiers:[0.28868],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END"},ssDependent:false,max:{val:0.5},min:{val:0}}]}]},CURVED_DOWN_ARROW:{name:"Curved Down Arrow",modifiers:[0.25,0.5,0.25],handles:[{values:[{num:0,modifier:{type:"X",origin:"END",multiplier:2},ssDependent:true,min:{val:0}}]},{values:[{num:1,modifier:{type:"X",origin:"END"},ssDependent:true,min:{val:0}}]},
{values:[{num:2,modifier:{type:"Y",origin:"END"},ssDependent:true,min:{val:0}}]}],pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.8}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"}}]},CHEVRON:{name:"Chevron",modifiers:[0.5],handles:[{values:[{num:0,modifier:{type:"X",origin:"END"},ssDependent:true,max:{val:1,compute:true},min:{val:0}}]}]},DOUBLE_WAVE:{name:"Double Wave",modifiers:[0.0625,0],handles:[{values:[{num:0,modifier:{type:"Y"},
ssDependent:false,max:{val:0.125},min:{val:0}}]},{values:[{num:1,modifier:{type:"X"},ssDependent:false,max:{val:0.1},min:{val:-0.1}}]}]},DOUBLE_BRACKET:{name:"Double Bracket",modifiers:[0.16],handles:[{values:[{num:0,modifier:{type:"Y"},ssDependent:true,max:{val:0.5},min:{val:0}}]}]},MINUS:{name:"Minus",modifiers:[0.2352],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END",multiplier:2},ssDependent:false,max:{val:0.7349},min:{val:0}}]}]},MANUAL_OPERATION:{name:"Manual Operation"},OFFPAGE_CONNECTOR:{name:"Offpage Connector"},
TWELVE_POINT_STAR:{name:"Twelve Point Star",modifiers:[0.375],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END"},ssDependent:false,max:{val:0.5},min:{val:0}}]}]},PROCESS:{name:"Process"},U_TURN_ARROW:{name:"U Turn Arrow",modifiers:[0.25,0.25,0.25,0.4375,0.75],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:true,min:{val:0}}]},{values:[{num:1,modifier:{type:"X",origin:"END",multiplier:0.5},ssDependent:true,max:{val:0.25},min:{val:0}}]},{values:[{num:2,modifier:{type:"Y",origin:"END"},
ssDependent:true,min:{val:0}}]},{values:[{num:3,modifier:{type:"X"},ssDependent:true,min:{val:0}}]},{values:[{num:4,modifier:{type:"Y"},ssDependent:false,max:{val:1},min:{val:0}}]}]},BENT_UP_ARROW:{name:"Bent Up Arrow",modifiers:[0.25,0.25,0.25],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END"},ssDependent:true,max:{val:0.5},min:{val:0}}]},{values:[{num:1,modifier:{type:"X",origin:"END",multiplier:0.5},ssDependent:true,max:{val:0.5},min:{val:0}}]},{values:[{num:2,modifier:{type:"Y"},ssDependent:true,
max:{val:0.5},min:{val:0}}]}]},SEQUENTIAL_ACCESS_STORAGE:{name:"Sequential Access Storage"},EIGHT_POINT_STAR:{name:"Eight Point Star",modifiers:[0.375],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END"},ssDependent:false,max:{val:0.5},min:{val:0}}]}]},CURVED_UP_ARROW:{name:"Curved Up Arrow",modifiers:[0.25,0.5,0.25],handles:[{values:[{num:0,modifier:{type:"X",origin:"END",multiplier:2},ssDependent:true,min:{val:0}}]},{values:[{num:1,modifier:{type:"X",origin:"END"},ssDependent:true,min:{val:0}}]},
{values:[{num:2,modifier:{type:"Y"},ssDependent:true,min:{val:0}}]}],pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.8}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"}}]},DODECAGON:{name:"Dodecagon"},MOON:{name:"Moon",modifiers:[0.5],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:false,max:{val:0.875},min:{val:0}}]}]},ACTION_NEXT:{name:"Action Next",pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",
tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.6}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},LEFT_BRACKET:{name:"Left Bracket",modifiers:[0.0833],handles:[{values:[{num:0,modifier:{type:"Y"},ssDependent:true,max:{val:0.5,compute:true},min:{val:0}}]}]},LEFT_UP_ARROW:{name:"Left Up Arrow",modifiers:[0.25,0.25,0.25],handles:[{values:[{num:0,modifier:{type:"X",origin:"END",multiplier:2},ssDependent:true,min:{val:0}}]},{values:[{num:1,
modifier:{type:"X",origin:"END",multiplier:0.5},ssDependent:true,max:{val:0.5},min:{val:0}}]},{values:[{num:2,modifier:{type:"Y"},ssDependent:true,min:{val:0}}]}]},PARALLELOGRAM:{name:"Parallelogram",modifiers:[0.25],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:true,max:{val:1,compute:true},min:{val:0}}]}]},STORED_DATA:{name:"Stored Data"},CUBE:{name:"Cube",modifiers:[0.25],handles:[{values:[{num:0,modifier:{type:"Y"},ssDependent:true,max:{val:1},min:{val:0}}]}],pathList:[{fill:{fill:"NORMAL"},
stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.8},{mode:"OFFSET",value:0.2}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.8}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"}}]},STRIPED_RIGHT_ARROW:{name:"Striped Right Arrow",modifiers:[0.5,0.5],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END",multiplier:2},ssDependent:false,max:{val:1},min:{val:0}}]},{values:[{num:1,modifier:{type:"X",origin:"END"},ssDependent:true,
max:{val:0.84375,compute:true},min:{val:0}}]}]},BENT_ARROW:{name:"Bent Arrow",modifiers:[0.25,0.25,0.25,0.4375],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:true,min:{val:0}}]},{values:[{num:1,modifier:{type:"Y",multiplier:0.5},ssDependent:true,max:{val:0.5},min:{val:0}}]},{values:[{num:2,modifier:{type:"X",origin:"END"},ssDependent:true,max:{val:0.5},min:{val:0}}]},{values:[{num:3,modifier:{type:"X"},ssDependent:true,min:{val:0}}]}]},LEFT_ARROW_CALLOUT:{name:"Left Arrow Callout",modifiers:[0.25,
0.25,0.25,0.64997],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END",multiplier:2},ssDependent:true,min:{val:0}}]},{values:[{num:1,modifier:{type:"Y",origin:"END"},ssDependent:true,max:{val:0.5,compute:true},min:{val:0}}]},{values:[{num:2,modifier:{type:"X"},ssDependent:true,max:{val:1,compute:true},min:{val:0}}]},{values:[{num:3,modifier:{type:"X",origin:"END"},ssDependent:false,min:{val:0}}]}]},SUN:{name:"Sun",modifiers:[0.25],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:false,
max:{val:0.46875},min:{val:0.125}}]}]},TEARDROP:{name:"Teardrop",modifiers:[1],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:false,max:{val:1},min:{val:0.5}}]}]},DOWN_ARROW:{name:"Down Arrow",modifiers:[0.5,0.5],handles:[{values:[{num:0,modifier:{type:"X",origin:"END",multiplier:2},ssDependent:false,max:{val:1},min:{val:0}}]},{values:[{num:1,modifier:{type:"Y",origin:"END"},ssDependent:true,max:{val:1,compute:true},min:{val:0}}]}]},HEART:{name:"Heart"},ARC:{name:"Arc",modifiers:[4.712389,
0],handles:[{values:[{num:0,modifier:{type:"ANGLE"}}]},{values:[{num:1,modifier:{type:"ANGLE"}}]}]},SNIP_SAMESIDE_RECT:{name:"Snip Sameside Rect",modifiers:[0.16,0],handles:[{values:[{num:0,modifier:{type:"X",origin:"END"},ssDependent:true,max:{val:0.5},min:{val:0}}]},{values:[{num:1,modifier:{type:"X"},ssDependent:true,max:{val:0.5},min:{val:0}}]}]},SEVEN_POINT_STAR:{name:"Seven Point Star",modifiers:[0.34601],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END"},ssDependent:false,max:{val:0.5},
min:{val:0}}]}]},UP_DOWN_ARROW:{name:"Up Down Arrow",modifiers:[0.5,0.5],handles:[{values:[{num:0,modifier:{type:"X",origin:"END",multiplier:2},ssDependent:false,max:{val:1},min:{val:0}}]},{values:[{num:1,modifier:{type:"Y"},ssDependent:true,max:{val:0.5,compute:true},min:{val:0}}]}]},ELBOW_CONNECTOR5:{name:"Elbow Connector5",modifiers:[0.5,0.5,0.5],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:false}]},{values:[{num:1,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:2,modifier:{type:"X"},
ssDependent:false}]}],pathList:[{fill:{fill:"NONE"}}]},ELBOW_CONNECTOR2:{name:"Elbow Connector2",pathList:[{fill:{fill:"NONE"}}]},CLOCK:{name:"Clock",modifiers:[5.7595863,3.6651914],handles:[{values:[{num:0,modifier:{type:"ANGLE"}}]},{values:[{num:1,modifier:{type:"ANGLE"}}]}]},ELBOW_CONNECTOR4:{name:"Elbow Connector4",modifiers:[0.5,0.5],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:false}]},{values:[{num:1,modifier:{type:"Y"},ssDependent:false}]}],pathList:[{fill:{fill:"NONE"}}]},ACTION_HOME:{name:"Action Home",
pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.6}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.8}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},ELBOW_CONNECTOR3:{name:"Elbow Connector3",modifiers:[0.5],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:false}]}],pathList:[{fill:{fill:"NONE"}}]},FLOWCHART_CONNECTOR:{name:"Flowchart Connector"},
DIAMOND:{name:"Diamond"},MERGE:{name:"Merge"},FIVE_POINT_STAR:{name:"Five Point Star",modifiers:[0.19098],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END"},ssDependent:false,max:{val:0.5},min:{val:0}}]}]},CALLOUT1:{name:"Callout1",modifiers:[0.187,-0.083,1.125,-0.383],handles:[{values:[{num:1,modifier:{type:"X"},ssDependent:false},{num:0,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:3,modifier:{type:"X"},ssDependent:false},{num:2,modifier:{type:"Y"},ssDependent:false}]}],pathList:[{fill:{fill:"NORMAL"},
stroke:{fill:"NONE"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},CALLOUT2:{name:"Callout2",modifiers:[0.187,-0.083,0.187,-0.166,1.125,-0.466],handles:[{values:[{num:1,modifier:{type:"X"},ssDependent:false},{num:0,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:3,modifier:{type:"X"},ssDependent:false},{num:2,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:5,modifier:{type:"X"},ssDependent:false},{num:4,modifier:{type:"Y"},ssDependent:false}]}],pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},
{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},TRAPEZOID:{name:"Trapezoid",modifiers:[0.2],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:true,max:{val:0.5,compute:true},min:{val:0}}]}]},BLOCK_ARC:{name:"Block Arc",modifiers:[3.1415927,0,0.25],handles:[{values:[{num:0,modifier:{type:"ANGLE"}}]},{values:[{num:1,modifier:{type:"ANGLE"}},{num:2,modifier:{type:"RADIUS"}}]}]},LEFT_RIGHT_ARROW:{name:"Left Right Arrow",modifiers:[0.5,0.5],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END",
multiplier:2},ssDependent:false,max:{val:1},min:{val:0}}]},{values:[{num:1,modifier:{type:"X"},ssDependent:true,max:{val:0.5,compute:true},min:{val:0}}]}]},CALLOUT3:{name:"Callout3",modifiers:[0.187,-0.083,0.187,-0.166,1,-0.166,1.129,-0.083],handles:[{values:[{num:1,modifier:{type:"X"},ssDependent:false},{num:0,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:3,modifier:{type:"X"},ssDependent:false},{num:2,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:5,modifier:{type:"X"},ssDependent:false},
{num:4,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:7,modifier:{type:"X"},ssDependent:false},{num:6,modifier:{type:"Y"},ssDependent:false}]}],pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},FRAME:{name:"Frame",modifiers:[0.125],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:true,max:{val:0.5},min:{val:0}}]}]},DIVIDE:{name:"Divide",modifiers:[0.2352,0.0588,0.1176],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END",multiplier:2},
ssDependent:false,max:{val:0.36745},min:{val:0.01}}]},{values:[{num:1,modifier:{type:"Y",origin:"END"},ssDependent:false,min:{val:0}}]},{values:[{num:2,modifier:{type:"X",origin:"END"},ssDependent:false,min:{val:0.01}}]}]},EXPLOSION1:{name:"Explosion1"},EXPLOSION2:{name:"Explosion2"},QUAD_ARROW_CALLOUT:{name:"Quad Arrow Callout",modifiers:[0.18515,0.18515,0.18515,0.48123],handles:[{values:[{num:0,modifier:{type:"X",origin:"END",multiplier:2},ssDependent:true,min:{val:0}}]},{values:[{num:1,modifier:{type:"X",
origin:"END"},ssDependent:true,max:{val:0.5},min:{val:0}}]},{values:[{num:2,modifier:{type:"Y"},ssDependent:true,min:{val:0}}]},{values:[{num:3,modifier:{type:"Y",origin:"END"},ssDependent:true}]}]},HORIZONTAL_SCROLL:{name:"Horizontal Scroll",modifiers:[0.125],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:true,max:{val:0.25},min:{val:0}}]}],pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.8}]}}},stroke:{fill:"NONE"}},
{fill:{fill:"NONE"}}]},ACTION_BEGIN:{name:"Action Begin",pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.6}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},SIXTEEN_POINT_STAR:{name:"Sixteen Point Star",modifiers:[0.375],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END"},ssDependent:false,max:{val:0.5},min:{val:0}}]}]},SNIP_DIAGONAL_RECT:{name:"Snip Diagonal Rect",
modifiers:[0.16,0],handles:[{values:[{num:0,modifier:{type:"X",origin:"END"},ssDependent:true,max:{val:0.5},min:{val:0}}]},{values:[{num:1,modifier:{type:"X"},ssDependent:true,max:{val:0.5},min:{val:0}}]}]},ROUND_SINGLE_RECT:{name:"Round Single Rect",modifiers:[0.16],handles:[{values:[{num:0,modifier:{type:"X",origin:"END"},ssDependent:true,max:{val:0.5},min:{val:0}}]}]},PUNCHED_CARD:{name:"Punched Card"},SNIP_SINGLE_RECT:{name:"Snip Single Rect",modifiers:[0.16],handles:[{values:[{num:0,modifier:{type:"X",
origin:"END"},ssDependent:true,max:{val:0.5},min:{val:0}}]}]},HEPTAGON:{name:"Heptagon"},ACTION_INFORMATION:{name:"Action Information",pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.6}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.6},{mode:"OFFSET",value:0.4}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},TWENTY_FOUR_POINT_STAR:{name:"Twenty Four Point Star",
modifiers:[0.375],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END"},ssDependent:false,max:{val:0.5},min:{val:0}}]}]},COLLATE:{name:"Collate"},CURVED_DOWN_RIBBON:{name:"Curved Down Ribbon",modifiers:[0.25,0.5,0.125],handles:[{values:[{num:0,modifier:{type:"Y"},ssDependent:false,max:{val:1},min:{val:0}}]},{values:[{num:1,modifier:{type:"X",origin:"END",multiplier:2},ssDependent:false,max:{val:0.75},min:{val:0.25}}]},{values:[{num:0,modifier:{type:"Y",origin:"END"},ssDependent:false}]}],pathList:[{fill:{fill:"NORMAL"},
stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.8}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"}}]},GRID:{name:"Grid",modifiers:[0.1,6]},CURVED_CONNECTOR5:{name:"Curved Connector5",modifiers:[0.5,0.5,0.5],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:false}]},{values:[{num:1,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:2,modifier:{type:"X"},ssDependent:false}]}],pathList:[{fill:{fill:"NONE"}}]},NOTCHED_RIGHT_ARROW:{name:"Notched Right Arrow",
modifiers:[0.5,0.5],handles:[{values:[{num:0,modifier:{type:"Y",multiplier:2},ssDependent:false,max:{val:1},min:{val:0}}]},{values:[{num:1,modifier:{type:"X",origin:"END"},ssDependent:true,max:{val:1,compute:true},min:{val:0}}]}]},CURVED_CONNECTOR4:{name:"Curved Connector4",modifiers:[0.5,0.5],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:false}]},{values:[{num:1,modifier:{type:"Y"},ssDependent:false}]}],pathList:[{fill:{fill:"NONE"}}]},SUMMING_JUNCTION:{name:"Summing Junction"},CURVED_CONNECTOR3:{name:"Curved Connector3",
modifiers:[0.5],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:false}]}],pathList:[{fill:{fill:"NONE"}}]},ACTION_END:{name:"Action End",pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.6}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},PIE:{name:"Pie",modifiers:[0,4.712389],handles:[{values:[{num:0,modifier:{type:"ANGLE"}}]},{values:[{num:1,modifier:{type:"ANGLE"}}]}]},
PLAQUE:{name:"Plaque",modifiers:[0.16],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:true,max:{val:0.5},min:{val:0}}]}]},UP_RIBBON:{name:"Up Ribbon",modifiers:[0.1667,0.5],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END"},ssDependent:false,max:{val:0.333},min:{val:0}}]},{values:[{num:1,modifier:{type:"X",origin:"END",multiplier:2},ssDependent:false,max:{val:0.75},min:{val:0.25}}]}],pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",
value:0.8}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"}}]},CROP_FRAME:{name:"CropFrame",modifiers:[0.2,0.2,0.5,0.5,0.8,0.8,0.8,0.2,0.2,0.8,0.8,0.8,0.2,0.2],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:false,max:{val:1},min:{val:0}},{num:1,modifier:{type:"Y"},ssDependent:false,max:{val:1},min:{val:0}}]},{values:[{num:2,modifier:{type:"X"},ssDependent:false},{num:3,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:4,modifier:{type:"X"},ssDependent:false,max:{val:1},min:{val:0}},{num:5,
modifier:{type:"Y"},ssDependent:false,max:{val:1},min:{val:0}}]},{values:[{num:6,modifier:{type:"X"},ssDependent:false,max:{val:1},min:{val:0}},{num:7,modifier:{type:"Y"},ssDependent:false,max:{val:1},min:{val:0}}]},{values:[{num:8,modifier:{type:"X"},ssDependent:false,max:{val:1},min:{val:0}},{num:9,modifier:{type:"Y"},ssDependent:false,max:{val:1},min:{val:0}}]},{values:[{num:10,modifier:{type:"Y"},ssDependent:false,max:{val:1},min:{val:0}}]},{values:[{num:11,modifier:{type:"X"},ssDependent:false,
max:{val:1},min:{val:0}}]},{values:[{num:12,modifier:{type:"Y"},ssDependent:false,max:{val:1},min:{val:0}}]},{values:[{num:13,modifier:{type:"X"},ssDependent:false,max:{val:1},min:{val:0}}]}]},SMILEY:{name:"Smiley",modifiers:[0.04653],handles:[{values:[{num:0,modifier:{type:"Y"},ssDependent:false,max:{val:0.04653},min:{val:-0.04653}}]}],pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.8}]}}}},{fill:{fill:"NONE"}},{fill:{fill:"NONE"}}]},
ACTION_MOVIE:{name:"Action Movie",pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.6}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},ACCENT_CALLOUT2:{name:"Accent Callout2",modifiers:[0.187,-0.083,0.187,-0.166,1.125,-0.466],handles:[{values:[{num:1,modifier:{type:"X"},ssDependent:false},{num:0,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:3,modifier:{type:"X"},
ssDependent:false},{num:2,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:5,modifier:{type:"X"},ssDependent:false},{num:4,modifier:{type:"Y"},ssDependent:false}]}],pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},CURVED_CONNECTOR2:{name:"Curved Connector2",pathList:[{fill:{fill:"NONE"}}]},HEXAGON:{name:"Hexagon",modifiers:[0.25],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:true,max:{val:0.5,compute:true},min:{val:0}}]}]},ACCENT_CALLOUT1:{name:"Accent Callout1",
modifiers:[0.187,-0.083,1.125,-0.383],handles:[{values:[{num:1,modifier:{type:"X"},ssDependent:false},{num:0,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:3,modifier:{type:"X"},ssDependent:false},{num:2,modifier:{type:"Y"},ssDependent:false}]}],pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},OVAL:{name:"Oval"},RECTANGULAR_CALLOUT:{name:"Rectangular Callout",modifiers:[-0.208,0.625],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:false},
{num:1,modifier:{type:"Y"},ssDependent:false}]}]},NOT_EQUAL:{name:"Not Equal",modifiers:[0.2352,1.9198622,0.1176],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END"},ssDependent:false,max:{val:0.5},min:{val:0}}]},{values:[{num:1,modifier:{type:"ANGLE"},ssDependent:false,max:{val:1.9198622},min:{val:1.2217305}}]},{values:[{num:2,modifier:{type:"Y",origin:"END",multiplier:2},ssDependent:false,min:{val:0}}]}]},TEN_POINT_STAR:{name:"Ten Point Star",modifiers:[0.42533],handles:[{values:[{num:0,modifier:{type:"Y",
origin:"END"},ssDependent:false,max:{val:0.5},min:{val:0}}]}]},ACCENT_CALLOUT3:{name:"Accent Callout3",modifiers:[0.187,-0.083,0.187,-0.166,1,-0.166,1.129,-0.083],handles:[{values:[{num:1,modifier:{type:"X"},ssDependent:false},{num:0,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:3,modifier:{type:"X"},ssDependent:false},{num:2,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:5,modifier:{type:"X"},ssDependent:false},{num:4,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:7,modifier:{type:"X"},
ssDependent:false},{num:6,modifier:{type:"Y"},ssDependent:false}]}],pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},PREDEFINED_PROCESS:{name:"Predefined Process"},PUNCHED_TAPE:{name:"Punched Tape"},TERMINATOR:{name:"Terminator"},DIAGONAL_STRIPE:{name:"Diagonal Stripe",modifiers:[0.5],handles:[{values:[{num:0,modifier:{type:"Y"},ssDependent:false,max:{val:1},min:{val:0}}]}]},DECISION:{name:"Decision"},RIGHT_TRIANGLE:{name:"Right Triangle"},FLOWCHART_DOCUMENT:{name:"Flowchart Document"},
LEFT_ARROW:{name:"Left Arrow",modifiers:[0.5,0.5],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END",multiplier:2},ssDependent:false,max:{val:1},min:{val:0}}]},{values:[{num:1,modifier:{type:"X"},ssDependent:true,max:{val:1,compute:true},min:{val:0}}]}]},FOLDED_CORNER:{name:"Folded Corner",modifiers:[0.16],handles:[{values:[{num:0,modifier:{type:"X",origin:"END"},ssDependent:true,max:{val:0.5},min:{val:0}}]}],pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",
value:0.8}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"}}]},TABLECELL:{name:"Tablecell",modifiers:[0.25],pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},OVAL_CALLOUT:{name:"Oval Callout",modifiers:[-0.208,0.625],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:false},{num:1,modifier:{type:"Y"},ssDependent:false}]}]},
ACTION_CUSTOM:{name:"Action Custom"},PENTAGON_ARROW:{name:"Pentagon Arrow",modifiers:[0.5],handles:[{values:[{num:0,modifier:{type:"X",origin:"END"},ssDependent:true,max:{val:1,compute:true},min:{val:0}}]}]},DOWN_ARROW_CALLOUT:{name:"Down Arrow Callout",modifiers:[0.25,0.25,0.25,0.64997],handles:[{values:[{num:0,modifier:{type:"X",origin:"END",multiplier:2},ssDependent:true,min:{val:0}}]},{values:[{num:1,modifier:{type:"X",origin:"END"},ssDependent:true,max:{val:0.5,compute:true},min:{val:0}}]},{values:[{num:2,
modifier:{type:"Y",origin:"END"},ssDependent:true,max:{val:1,compute:true},min:{val:0}}]},{values:[{num:3,modifier:{type:"Y"},ssDependent:false,min:{val:0}}]}]},ACTION_RETURN:{name:"Action Return",pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.6}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},MANUAL_INPUT:{name:"Manual Input"},CURVED_RIGHT_ARROW:{name:"Curved Right Arrow",
modifiers:[0.25,0.5,0.25],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END",multiplier:2},ssDependent:true,min:{val:0}}]},{values:[{num:1,modifier:{type:"Y",origin:"END"},ssDependent:true,min:{val:0}}]},{values:[{num:2,modifier:{type:"X",origin:"END"},ssDependent:true,min:{val:0}}]}],pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.8}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"}}]},LIGHTNING_BOLT:{name:"Lightning Bolt"},
BEVEL:{name:"Bevel",modifiers:[0.125],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:true,max:{val:0.5},min:{val:0}}]}],pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.6},{mode:"OFFSET",value:0.4}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.8},{mode:"OFFSET",value:0.2}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.6}]}}},
stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.8}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"}}]},OCTAGON:{name:"Octagon",modifiers:[0.3],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:true,max:{val:0.5},min:{val:0}}]}]},LEFT_BRACE:{name:"Left Brace",modifiers:[0.0833,0.5],handles:[{values:[{num:0,modifier:{type:"Y"},ssDependent:true,min:{val:0}}]},{values:[{num:1,modifier:{type:"Y"},ssDependent:false,max:{val:1},min:{val:0}}]}]},ACTION_PREVIOUS:{name:"Action Previous",
pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.6}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},CURVED_LEFT_ARROW:{name:"Curved Left Arrow",modifiers:[0.25,0.5,0.25],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END",multiplier:2},ssDependent:true,min:{val:0}}]},{values:[{num:1,modifier:{type:"Y",origin:"END"},ssDependent:true,min:{val:0}}]},{values:[{num:2,
modifier:{type:"X"},ssDependent:true,min:{val:0}}]}],pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.8}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"}}]},PREPARATION:{name:"Preparation"},EXTRACT:{name:"Extract"},LOCK_SYMBOL:{name:"Lock Symbol"},UP_ARROW_CALLOUT:{name:"Up Arrow Callout",modifiers:[0.25,0.25,0.25,0.64997],handles:[{values:[{num:0,modifier:{type:"X",origin:"END",multiplier:2},ssDependent:true,min:{val:0}}]},{values:[{num:1,
modifier:{type:"X",origin:"END"},ssDependent:true,max:{val:0.5,compute:true},min:{val:0}}]},{values:[{num:2,modifier:{type:"Y"},ssDependent:true,max:{val:1,compute:true},min:{val:0}}]},{values:[{num:3,modifier:{type:"Y",origin:"END"},ssDependent:false,min:{val:0}}]}]},NO_SYMBOL:{name:"No Symbol",modifiers:[0.15],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:true,max:{val:0.5},min:{val:0}}]}]},DIRECT_ACCESS_STORAGE:{name:"Direct Access Storage"},FOUR_POINT_STAR:{name:"Four Point Star",modifiers:[0.125],
handles:[{values:[{num:0,modifier:{type:"Y",origin:"END"},ssDependent:false,max:{val:0.5},min:{val:0}}]}]},ACTION_SOUND:{name:"Action Sound",pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.6}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},ISOSCELES_TRIANGLE:{name:"Isosceles Triangle",modifiers:[0.5],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:false,
max:{val:1},min:{val:0}}]}]},ROUND_DIAGONAL_RECT:{name:"Round Diagonal Rect",modifiers:[0,0.16],handles:[{values:[{num:0,modifier:{type:"X",origin:"END"},ssDependent:true,max:{val:0.5},min:{val:0}}]},{values:[{num:1,modifier:{type:"X"},ssDependent:true,max:{val:0.5},min:{val:0}}]}]},CAN:{name:"Can",modifiers:[0.25],handles:[{values:[{num:0,modifier:{type:"Y"},ssDependent:true,max:{val:0.5,compute:true},min:{val:0}}]}],pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",
value:0.6},{mode:"OFFSET",value:0.4}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"}}]},HALF_FRAME:{name:"Half Frame",modifiers:[0.33,0.33],handles:[{values:[{num:0,modifier:{type:"Y"},ssDependent:true}]},{values:[{num:1,modifier:{type:"X"},ssDependent:true,max:{val:1,compute:true},min:{val:0}}]}]},DOUBLE_BRACE:{name:"Double Brace",modifiers:[0.083],handles:[{values:[{num:0,modifier:{type:"Y"},ssDependent:true,max:{val:0.25},min:{val:0}}]}]},RIGHT_ARROW_CALLOUT:{name:"Right Arrow Callout",modifiers:[0.25,
0.25,0.25,0.64997],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END",multiplier:2},ssDependent:true,min:{val:0}}]},{values:[{num:1,modifier:{type:"Y",origin:"END"},ssDependent:true,max:{val:0.5,compute:true},min:{val:0}}]},{values:[{num:2,modifier:{type:"X",origin:"END"},ssDependent:true,max:{val:1,compute:true},min:{val:0}}]},{values:[{num:3,modifier:{type:"X"},ssDependent:false,min:{val:0}}]}]},DATA:{name:"Data"},ROUNDED_RECTANGULAR_CALLOUT:{name:"Rounded Rectangular Callout",modifiers:[-0.208,
0.625],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:false},{num:1,modifier:{type:"Y"},ssDependent:false}]}]},ALTERNATE_PROCESS:{name:"Alternate Process"},SORT:{name:"Sort"},THIRTY_TWO_POINT_STAR:{name:"Thirty Two Point Star",modifiers:[0.375],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END"},ssDependent:false,max:{val:0.5},min:{val:0}}]}]},MULTIPLY:{name:"Multiply",modifiers:[0.2352],handles:[{values:[{num:0,modifier:{type:"Y"},ssDependent:true,max:{val:0.51965},min:{val:0}}]}]},
DELAY:{name:"Delay"},PLUS:{name:"Plus",modifiers:[0.2352],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END",multiplier:2},ssDependent:true,max:{val:0.7349},min:{val:0}}]}]},RECT:{name:"Rect"},PENTAGON:{name:"Pentagon"},CLOUD:{name:"Cloud",pathList:[{fill:{fill:"NORMAL"}},{fill:{fill:"NONE"}}]},ACTION_DOCUMENT:{name:"Action Document",pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.6}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",
tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.8}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},UP_ARROW:{name:"Up Arrow",modifiers:[0.5,0.5],handles:[{values:[{num:0,modifier:{type:"X",origin:"END",multiplier:2},ssDependent:false,max:{val:1},min:{val:0}}]},{values:[{num:1,modifier:{type:"Y"},ssDependent:true,max:{val:1,compute:true},min:{val:0}}]}]},ROUND_SAMESIDE_RECT:{name:"Round Sameside Rect",modifiers:[0.16,0],handles:[{values:[{num:0,
modifier:{type:"X",origin:"END"},ssDependent:true,max:{val:0.5},min:{val:0}}]},{values:[{num:1,modifier:{type:"X"},ssDependent:true,max:{val:0.5},min:{val:0}}]}]},LEFT_RIGHT_UP_ARROW:{name:"Left Right Up Arrow",modifiers:[0.25,0.25,0.25],handles:[{values:[{num:0,modifier:{type:"X",origin:"END",multiplier:2},ssDependent:true,min:{val:0}}]},{values:[{num:1,modifier:{type:"X",origin:"END"},ssDependent:true,max:{val:0.5},min:{val:0}}]},{values:[{num:2,modifier:{type:"Y"},ssDependent:true,min:{val:0}}]}]},
QUAD_ARROW:{name:"Quad Arrow",modifiers:[0.225,0.225,0.225],handles:[{values:[{num:0,modifier:{type:"X",origin:"END",multiplier:2},ssDependent:true,min:{val:0}}]},{values:[{num:1,modifier:{type:"X",origin:"END"},ssDependent:true,max:{val:0.5},min:{val:0}}]},{values:[{num:2,modifier:{type:"Y"},ssDependent:true,min:{val:0}}]}]},WAVE:{name:"Wave",modifiers:[0.125,0],handles:[{values:[{num:0,modifier:{type:"Y"},ssDependent:false,max:{val:0.2},min:{val:0}}]},{values:[{num:1,modifier:{type:"X"},ssDependent:false,
max:{val:0.1},min:{val:-0.1}}]}]},DISPLAY:{name:"Display"},DECAGON:{name:"Decagon"},DOWN_RIBBON:{name:"Down Ribbon",modifiers:[0.1667,0.5],handles:[{values:[{num:0,modifier:{type:"Y"},ssDependent:false,max:{val:0.333},min:{val:0}}]},{values:[{num:1,modifier:{type:"X",origin:"END",multiplier:2},ssDependent:false,max:{val:0.75},min:{val:0.25}}]}],pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.8}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"}}]},
LSHAPE:{name:"Lshape",modifiers:[0.5,0.5],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END"},ssDependent:true,max:{val:1,compute:true},min:{val:0}}]},{values:[{num:1,modifier:{type:"X"},ssDependent:true,max:{val:1,compute:true},min:{val:0}}]}]},MULTI_DOCUMENT:{name:"Multi Document"},ACCENT_BORDER_CALLOUT3:{name:"Accent Callout3",modifiers:[0.187,-0.083,0.187,-0.166,1,-0.166,1.129,-0.083],handles:[{values:[{num:1,modifier:{type:"X"},ssDependent:false},{num:0,modifier:{type:"Y"},ssDependent:false}]},
{values:[{num:3,modifier:{type:"X"},ssDependent:false},{num:2,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:5,modifier:{type:"X"},ssDependent:false},{num:4,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:7,modifier:{type:"X"},ssDependent:false},{num:6,modifier:{type:"Y"},ssDependent:false}]}],pathList:[{fill:{fill:"NORMAL"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},LEFT_RIGHT_ARROW_CALLOUT:{name:"Left Right Arrow Callout",modifiers:[0.25,0.25,0.25,0.48123],handles:[{values:[{num:0,
modifier:{type:"Y",origin:"END",multiplier:2},ssDependent:true,min:{val:0}}]},{values:[{num:1,modifier:{type:"Y",origin:"END"},ssDependent:true,max:{val:0.5,compute:true},min:{val:0}}]},{values:[{num:2,modifier:{type:"X"},ssDependent:true,max:{val:0.5,compute:true},min:{val:0}}]},{values:[{num:3,modifier:{type:"X",origin:"END",multiplier:2},ssDependent:false,min:{val:0}}]}]},ACCENT_BORDER_CALLOUT2:{name:"Accent Border Callout2",modifiers:[0.187,-0.083,0.187,-0.166,1.125,-0.466],handles:[{values:[{num:1,
modifier:{type:"X"},ssDependent:false},{num:0,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:3,modifier:{type:"X"},ssDependent:false},{num:2,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:5,modifier:{type:"X"},ssDependent:false},{num:4,modifier:{type:"Y"},ssDependent:false}]}],pathList:[{fill:{fill:"NORMAL"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},LINE:{name:"Line",pathList:[{fill:{fill:"NONE"}}]},ACTION_HELP:{name:"Action Help",pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},
{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.6}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},CLOUD_CALLOUT:{name:"Cloud Callout",modifiers:[-0.208,0.625],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:false},{num:1,modifier:{type:"Y"},ssDependent:false}]}],pathList:[{fill:{fill:"NORMAL"}},{fill:{fill:"NONE"}},{fill:{fill:"NORMAL"}}]},DONUT:{name:"Donut",modifiers:[0.25],handles:[{values:[{num:0,
modifier:{type:"X"},ssDependent:true,max:{val:0.5},min:{val:0}}]}]},RIGHT_BRACE:{name:"Right Brace",modifiers:[0.0833,0.5],handles:[{values:[{num:0,modifier:{type:"Y"},ssDependent:true,min:{val:0}}]},{values:[{num:1,modifier:{type:"Y"},ssDependent:false,max:{val:1},min:{val:0}}]}]},OR:{name:"Or"},EQUAL:{name:"Equal",modifiers:[0.2352,0.1176],handles:[{values:[{num:0,modifier:{type:"Y",origin:"END"},ssDependent:false,max:{val:0.36745},min:{val:0}}]},{values:[{num:1,modifier:{type:"Y",origin:"END",
multiplier:2},ssDependent:false,min:{val:0}}]}]},VERTICAL_SCROLL:{name:"Vertical Scroll",modifiers:[0.125],handles:[{values:[{num:0,modifier:{type:"Y"},ssDependent:true,max:{val:0.25},min:{val:0}}]}],pathList:[{fill:{fill:"NORMAL"},stroke:{fill:"NONE"}},{fill:{fill:"NORMAL",tweaks:{hsl:{luminance:[{mode:"MODIFY",value:0.8}]}}},stroke:{fill:"NONE"}},{fill:{fill:"NONE"}}]},ACCENT_BORDER_CALLOUT1:{name:"Accent Border Callout1",modifiers:[0.187,-0.083,1.125,-0.383],handles:[{values:[{num:1,modifier:{type:"X"},
ssDependent:false},{num:0,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:3,modifier:{type:"X"},ssDependent:false},{num:2,modifier:{type:"Y"},ssDependent:false}]}],pathList:[{fill:{fill:"NORMAL"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},CIRCULAR_ARROW:{name:"Circular Arrow"},ROUND_RECT:{name:"Round Rect",modifiers:[0.16],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:true,max:{val:0.5},min:{val:0}}]}]},CHORD:{name:"Chord",modifiers:[0.7853982,4.712389],handles:[{values:[{num:0,
modifier:{type:"ANGLE"}}]},{values:[{num:1,modifier:{type:"ANGLE"}}]}]},RIGHT_BRACKET:{name:"Right Bracket",modifiers:[0.0833],handles:[{values:[{num:0,modifier:{type:"Y"},ssDependent:true,max:{val:0.5,compute:true},min:{val:0}}]}]},BORDER_CALLOUT3:{name:"Border Callout3",modifiers:[0.187,-0.083,0.187,-0.166,1,-0.166,1.129,-0.083],handles:[{values:[{num:1,modifier:{type:"X"},ssDependent:false},{num:0,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:3,modifier:{type:"X"},ssDependent:false},{num:2,
modifier:{type:"Y"},ssDependent:false}]},{values:[{num:5,modifier:{type:"X"},ssDependent:false},{num:4,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:7,modifier:{type:"X"},ssDependent:false},{num:6,modifier:{type:"Y"},ssDependent:false}]}],pathList:[{fill:{fill:"NORMAL"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},CROSS:{name:"Cross",modifiers:[0.25],handles:[{values:[{num:0,modifier:{type:"X"},ssDependent:true,max:{val:0.5},min:{val:0}}]}]},BORDER_CALLOUT1:{name:"Border Callout1",modifiers:[0.187,
-0.083,1.125,-0.383],handles:[{values:[{num:1,modifier:{type:"X"},ssDependent:false},{num:0,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:3,modifier:{type:"X"},ssDependent:false},{num:2,modifier:{type:"Y"},ssDependent:false}]}],pathList:[{fill:{fill:"NORMAL"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},BORDER_CALLOUT2:{name:"Border Callout2",modifiers:[0.187,-0.083,0.187,-0.166,1.125,-0.466],handles:[{values:[{num:1,modifier:{type:"X"},ssDependent:false},{num:0,modifier:{type:"Y"},ssDependent:false}]},
{values:[{num:3,modifier:{type:"X"},ssDependent:false},{num:2,modifier:{type:"Y"},ssDependent:false}]},{values:[{num:5,modifier:{type:"X"},ssDependent:false},{num:4,modifier:{type:"Y"},ssDependent:false}]}],pathList:[{fill:{fill:"NORMAL"}},{fill:{fill:"NONE"},stroke:{fill:"NORMAL"}}]},INTERNAL_STORAGE:{name:"Internal Storage"}}})(jQuery);(function(m){m.ShapeDefault={pointer:{nvOProps:{nvDProps:{id:"pointer"}},props:{transform:{fliph:false,flipv:false,dim:{width:20,height:20},pos:{left:10,top:10,zindex:1E4}},fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[255,0,0]}}},stroke:{type:"SOLID",width:0,jointype:"MITER",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[255,255,255]}}}},geom:{type:"PRESET",preset:{type:"DONUT",modifiers:[0.25]}}}},shape:{nvOProps:{nvDProps:{id:"shape"}},props:{transform:{fliph:false,flipv:false,dim:{width:50,
height:50},pos:{left:10,top:10}}},themeRef:{fillRef:{ref:"THEME",color:{type:"A1"}},strokeRef:{ref:"THEME",color:{type:"A1",tweaks:{shade:0.5}}},fontRef:{ref:"MINOR",color:{type:"CUSTOM",rgb:[255,255,255]}}},textBody:{props:{valign:"MIDDLE",autoFit:{type:"NONE"}},paras:[{portions:[{}],style:{halign:"CENTER"}}]}},custom:{nvOProps:{nvDProps:{id:"custom"}},props:{transform:{fliph:false,flipv:false,dim:{width:8,height:8},pos:{left:10,top:10,zindex:1E4}},geom:{type:"CUSTOM",custom:{pathList:[{width:1,
height:1,path:[{type:"M",m:{x:1,y:1}},{type:"L",l:{x:1,y:1}}]}]}}},themeRef:{fillRef:{ref:"THEME",color:{type:"A1"}},strokeRef:{ref:"THEME",color:{type:"A1",tweaks:{shade:0.5}}},fontRef:{ref:"MINOR",color:{type:"TX1"}}},textBody:{props:{valign:"MIDDLE",autoFit:{type:"NONE"}},paras:[{portions:[{}],style:{halign:"CENTER"}}]}},fill:{SOLID:{color:{type:"A1"}},GRADIENT:{LINEAR:{type:"LINEAR",rotate:0,stops:[{color:{type:"A1",tweaks:{tint:0.5,hsl:{saturation:[{mode:"MODIFY",value:3}]}}},position:0},{color:{type:"A1",
tweaks:{tint:0.37,hsl:{saturation:[{mode:"MODIFY",value:3}]}}},position:0.35},{color:{type:"A1",tweaks:{tint:0.15,hsl:{saturation:[{mode:"MODIFY",value:3.5}]}}},position:1}]},RADIAL:{type:"RADIAL",rotate:0,stops:[{color:{type:"A1",tweaks:{tint:0.5,hsl:{saturation:[{mode:"MODIFY",value:3}]}}},position:0},{color:{type:"A1",tweaks:{tint:0.37,hsl:{saturation:[{mode:"MODIFY",value:3}]}}},position:0.35},{color:{type:"A1",tweaks:{tint:0.15,hsl:{saturation:[{mode:"MODIFY",value:3.5}]}}},position:1}],radial:{fillToRect:{left:0.5,
top:0.5,right:0.5,bottom:0.5}}}}},FontWeight:{HEAVY:"800",MEDIUM:"500",LIGHT:"300",BOLD:"700",BLACK:"900",EXTRA_LIGHT:"200",DEMI_BOLD:"600",THIN:"100",NORMAL:"400"},staticshape:{nvOProps:{nvDProps:{id:"staticshape"}},props:{transform:{fliph:false,flipv:false,dim:{width:50,height:50},pos:{left:10,top:10}}},themeRef:{fillRef:{ref:"THEME",color:{type:"A1"}},strokeRef:{ref:"THEME",color:{type:"A1",tweaks:{shade:0.5}}},fontRef:{ref:"MINOR",color:{type:"CUSTOM",rgb:[255,255,255]}}}},picture:{nvOProps:{nvDProps:{id:"picture"},
nvODProps:{locks:{noAspectChange:true}}},value:{id:"picture",type:"USERDEFINED"},props:{transform:{fliph:false,flipv:false,dim:{width:16,height:16},pos:{left:10,top:10,zindex:1E4}}}},FontVariants:{CAPITALIZE:"capitalize",ALLCAPS:"uppercase",SMALLCAPS:"lowercase",NONE:"none"},connector:{nvOProps:{nvDProps:{id:"connector"}},props:{transform:{fliph:false,flipv:false,dim:{width:50,height:50},pos:{left:10,top:10}}},themeRef:{fillRef:{ref:"THEME",color:{type:"A1"}},strokeRef:{ref:"THEME",color:{type:"A1"}},
fontRef:{ref:"MINOR",color:{type:"CUSTOM",rgb:[255,255,255]}}}},selection:{nvOProps:{nvDProps:{id:"selection"}},props:{transform:{fliph:false,flipv:false,dim:{width:8,height:8},pos:{left:10,top:10,zindex:1E4}},fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[149,179,215],tweaks:{alpha:0.7}}}},stroke:{type:"SOLID",width:2,jointype:"ROUND",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[54,93,140]}}}},geom:{type:"PRESET",preset:{type:"RECT"}}}},highlighter:{nvOProps:{nvDProps:{id:"highlighter"}},
props:{transform:{fliph:false,flipv:false,dim:{width:8,height:8},pos:{left:10,top:10,zindex:1E4}},fill:{type:"NONE"},stroke:{type:"SOLID",width:18,jointype:"ROUND",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[255,255,0],tweaks:{alpha:0.6}}}}},geom:{type:"CUSTOM",custom:{pathList:[{width:1,height:1,path:[{type:"M",m:{x:1,y:1}},{type:"L",l:{x:1,y:1}}]}]}}}},grid:{nvOProps:{nvDProps:{id:"grid"},nvODProps:{locks:{noMove:true,noSelect:true}}},props:{transform:{fliph:false,flipv:false,dim:{width:1,
height:1},pos:{left:10,top:10,zindex:1E4}},stroke:{type:"ROUND_DOT",width:1,jointype:"MITER",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[64,64,64]}}},captype:"CROUND"},geom:{type:"PRESET",preset:{type:"GRID"}}}},bgshape:{nvOProps:{nvDProps:{id:"bgshape"},nvODProps:{locks:{noSelect:true}}},props:{transform:{fliph:false,flipv:false,dim:{width:1,height:1},pos:{left:0,top:0,zindex:100}},geom:{type:"PRESET",preset:{type:"RECT"}}},themeRef:{fillRef:{ref:"THEME",color:{type:"BG1"}},fontRef:{ref:"MINOR",
color:{type:"TX1"}}}},pen:{nvOProps:{nvDProps:{id:"pen"}},props:{transform:{fliph:false,flipv:false,dim:{width:8,height:8},pos:{left:10,top:10,zindex:1E4}},fill:{type:"NONE"},stroke:{type:"SOLID",width:2,jointype:"ROUND",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[255,0,0]}}}},geom:{type:"CUSTOM",custom:{pathList:[{width:1,height:1,path:[{type:"M",m:{x:1,y:1}},{type:"L",l:{x:1,y:1}}]}]}}}},cropBox:{nvOProps:{nvDProps:{id:"cropBox"}},props:{transform:{fliph:false,flipv:false,dim:{width:8,height:8},
pos:{left:10,top:10,zindex:1E4}},fill:{type:"NONE"},stroke:{type:"DASH",width:1,jointype:"ROUND",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[164,164,164]}}},captype:"FLAT"},geom:{type:"PRESET",preset:{type:"RECT"}}}},text:{nvOProps:{nvDProps:{id:"shape"},nvODProps:{textbox:true}},props:{transform:{fliph:false,flipv:false,dim:{width:300,height:50},pos:{left:10,top:10,zindex:1E4}},geom:{type:"PRESET",preset:{type:"RECT"}}},textBody:{props:{inset:{left:10,top:5,right:10,bottom:5},autoFit:{type:"SHAPE"}},
paras:[{portions:[{}]}]},edit:{htmlbox:true}},groupselect:{nvOProps:{nvDProps:{id:"groupselect"}},props:{transform:{fliph:false,flipv:false,dim:{width:8,height:8},pos:{left:10,top:10,zindex:1E4}},fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[149,179,215],tweaks:{alpha:0.6}}}},stroke:{type:"SOLID",width:1,jointype:"ROUND",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[54,93,140]}}}},geom:{type:"PRESET",preset:{type:"RECT"}}}},guide:{nvOProps:{nvDProps:{id:"guide"}},props:{transform:{fliph:false,
flipv:false,dim:{width:1,height:1},pos:{left:10,top:10,zindex:1E4}},stroke:{type:"DASH",width:1,jointype:"MITER",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[255,0,0]}}},captype:"SQUARE"},geom:{type:"PRESET",preset:{type:"LINE"}}}},bgfill:{SOLID:{color:{type:"BG2"}},GRADIENT:{LINEAR:{type:"LINEAR",rotate:0,stops:[{color:{type:"BG2",tweaks:{tint:0.5,hsl:{saturation:[{mode:"MODIFY",value:3}]}}},position:0},{color:{type:"BG2",tweaks:{tint:0.37,hsl:{saturation:[{mode:"MODIFY",value:3}]}}},position:0.35},
{color:{type:"BG2",tweaks:{tint:0.15,hsl:{saturation:[{mode:"MODIFY",value:3.5}]}}},position:1}]},RADIAL:{type:"RADIAL",rotate:0,stops:[{color:{type:"BG2",tweaks:{tint:0.5,hsl:{saturation:[{mode:"MODIFY",value:3}]}}},position:0},{color:{type:"BG2",tweaks:{tint:0.37,hsl:{saturation:[{mode:"MODIFY",value:3}]}}},position:0.35},{color:{type:"BG2",tweaks:{tint:0.15,hsl:{saturation:[{mode:"MODIFY",value:3.5}]}}},position:1}],radial:{fillToRect:{left:0.5,top:0.5,right:0.5,bottom:0.5}}}}}}})(jQuery);(function(m){m.Stroke={type:[{DASHDOT:"4,2,1,2",SQUARE_DOT:"1,2",LONG_DASH:"8,2",ROUND_DOT:"1,2",LONG_DASH_DOT_DOT:"8,2,1,2,1,2",LONG_DASH_DOT:"8,2,1,2",SOLID:"0",DASH:"4,2"},{DASHDOT:"dashdot",SQUARE_DOT:"dot",LONG_DASH:"longdash",ROUND_DOT:"dot",LONG_DASH_DOT_DOT:"longdashdotdot",LONG_DASH_DOT:"longdashdot",SOLID:"solid",DASH:"dash"}],marker:[{MEDIUM:"5",WIDE:"7",NARROW:"4"},{WIDE:"LONG",NARROW:"SHORT"}],captype:{SQUARE:"SQUARE",CROUND:"ROUND",FLAT:"FLAT"}}})(jQuery);(function(m){m.ShapeUtil=function(){};m.ShapeUtil.prototype={globalMergeOptions:{deep:true,overwrite:["stops","color"],skip:[]},createPara:function(e){return this.constructParaData(m.i18n("show.render.placeholder."+e.type.toLowerCase()))},constructParaData:function(e){e=this.createPortion(e);var g=[];g.push(e);return{portions:g}},getPlaceHolderText:function(e,g){return m.i18n(e+"."+g.toLowerCase())},createPortion:function(e){return{t:e}},mergeFill:function(e,g,h){if(e||h){if(h&&h.fillRef){var j=h.fillRef;
e=h.useBGFill?this._getBG(e,g,j):this._getFill(e,g,j)}j=undefined;if(h&&h.fillRef)j=h.fillRef;this._updateFillColor(e,g,j);return e}},mergeStroke:function(e,g,h){if(!e&&(!h||!h.strokeRef))return{fill:{type:"NONE"}};if(h&&h.strokeRef)e=this._getStroke(e,g,h.strokeRef);if(e&&e.fill){this._updateFillColor(e.fill,g,h.strokeRef);this.updateFillToSolid(e.fill)}return e=m.extend(true,{jointype:m.ShapeConstants.JoinType.ROUND,captype:m.ShapeConstants.CapType.FLAT,width:1},e)},mergeDuotone:function(e,g){var h=
this;m.each(e,function(j){e[j]=h.mergeColor(e[j],g)})},mergeShadow:function(e,g){if(e&&e.shadow)e.shadow.color=this.mergeColor(e.shadow.color,g)},mergeColor:function(e,g,h){var j=e;if(h){var l=h.ref.toLowerCase();if((l==="theme"||l==="themeindex")&&e.type&&e.type.toLowerCase()=="holder"&&h.color)j=m.extend(true,{},e,h.color)}j.rgb=this._getColor(j,g);j.rgb=j.tweaks?zoho.color.tweak(j.rgb,j.tweaks):j.rgb;return j},mergePictureProps:function(e,g,h){var j=this;if(e){if(e.colorMode){var l=e.colorMode;
if(l.mode==m.ShapeConstants.Mode.DUOTONE){var n=l[l.mode.toLowerCase()];n||(n=[]);m.each(n,function(o){n[o]=j.mergeColor(n[o],g,h)})}}if(e.colorChange){e=e.colorChange;if(e.from)e.from=j.mergeColor(e.from,g,h);if(e.to)e.to=j.mergeColor(e.to,g,h)}}},_getFill:function(e,g,h){g=m.ThemeUtil.getFill(h.ref,h.index,g);h=e;if(g)h=zoho.customMerge(this.globalMergeOptions,{},g,e);return h},_getBG:function(e,g,h){g=m.ThemeUtil.getBG(h.ref,h.index,g);h=e;if(g)h=zoho.customMerge(this.globalMergeOptions,{},g,e);
return h},_getColor:function(e,g){var h=e.rgb,j=m.ThemeUtil.getColorValue(e.type,g);if(j)h=m.extend(true,{},j,h);if(h&&!Array.isArray(h))h=[h["0"],h["1"],h["2"]];return h},getStroke:function(e,g,h){return this._getStroke(e,g,h)},_getStroke:function(e,g,h){if(g=m.ThemeUtil.getStroke(h.ref,h.index,g))e=zoho.customMerge(this.globalMergeOptions,{},g,e);return e},_updateFillColor:function(e,g,h){var j=this;if(e){if(e&&e.solid)if(e.solid.color)e.solid.color=this.mergeColor(e.solid.color,g,h);var l=e.gradient?
e.gradient.stops:undefined;l||(l=[]);m.each(l,function(n,o){o.color=j.mergeColor(o.color,g,h)});e&&e.pict&&j.mergePictureProps(e.pict.props,g,h)}},mergeFont:function(e,g){if(e){var h=m.ThemeUtil.getFont(e,g);if(h)e=m.extend(true,{},h,e);h=e.fontFamily.name;var j=function(l){if(m.WebFonts.loadedWebFonts[l.fontName])return true;else{l.shapeObj.data.textBody.paras[l.paraNum].portions[l.portionNum].props.font.loader=false;m.WebFonts.init([l.fontName],function(){Shape.textBody.paras.portions.props.resetPropsForPortion(l.shapeObj.data,
l.shapeObj.container,l.shapeObj.box,l.paraNum,l.portionNum)})}};if(m.WebFonts&&m.inArray(h,m.WebFonts.supportedWebFonts)!=-1)if(!m.WebFonts.loadedWebFonts[h])e.loader=j;return e}},mergeParas:function(e,g,h,j,l,n,o){var p=e.nvOProps.nvProps&&e.nvOProps.nvProps.placeHolder?e.nvOProps.nvProps.placeHolder:undefined;if(!(!p&&(!g.textBody||!g.textBody.paras||g.textBody.paras.length==0))){if(p){if(!g.textBody)return[];var r=g.value?true:false;if(p.type===m.ShapeConstants.PlaceHolderType.PICT&&r||p.type===
m.ShapeConstants.PlaceHolderType.CONTENT&&r||p.type===m.ShapeConstants.PlaceHolderType.CHART||p.type===m.ShapeConstants.PlaceHolderType.CONTENT&&r||p.type===m.ShapeConstants.PlaceHolderType.CLIPART)return[]}else if(g.textBody){if(!g.textBody.paras)g.textBody.paras=[]}else{g.textBody={};g.textBody.paras=[]}g=m.merge([],g.textBody.paras);r=false;if(g.length&&g[0].portions&&m.isEmptyObject(g[0].portions[0]))r=false;if(!g||g.length==0||r)g=[this.constructParaData()];if(!e.themeRef)e.themeRef={};r=c(j.textStyle,
p);r=d(j.defTextStyles,r,e.textBody.listStyles);e.textBody.listStyles=r;r={stylesInfo:j,mergedListStyles:r,themeObject:{themeRef:e.themeRef,themeInfo:h}};e.textBody.linkProps=m.shapeUtil.getThemeLinkProps("HLINK",h);g=this.mergeParaStyles(g,r,p,l);if(!e.isRendering){var q=this;m.each(e.textBody.listStyles,function(s,t){var u=a(j.textStyle,p,t.level);q.mergeListStyle(t,u,h);q.mergeDefaultParaStyle(t,e.themeRef,h,e.textBody.cellTextStyle)})}if(n!=m.ShapeConstants.SlideType.SLIDE&&p)g=this.updateMasterPlaceHolderText(g,
p,e,o);return g}},mergeParaStyles:function(e,g,h,j){var l=this,n=[],o=g.stylesInfo.textStyle;m.each(e,function(p,r){if(m.isEmptyObject(r))r={portions:[{}]};var q=r.style&&r.style.level?r.style.level:1,s=b(g.mergedListStyles,q),t=m.extend(true,{},r),u=m.extend(true,{},r.style);m.isEmptyObject(u)||delete u.level;t.style=zoho.customMerge(l.globalMergeOptions,{},s,r.style);if(!t.portions||t.portions.length==0)t.portions=[{}];n[n.length]=t;q=a(o,h,q);if(!j){l.mergePortionProps(t,g.themeObject,h);l.mergeListStyle(t.style,
q,g.themeObject.themeInfo,r.style);l.mergeDefaultParaStyle(t.style,g.themeObject.themeRef,g.themeObject.themeInfo)}u&&l.mergeListStyle(u,q,g.themeObject.themeInfo,r.style);t.unmerged={style:u}});return n},mergeDefaultParaStyle:function(e,g,h,j){var l={type:m.ShapeConstants.SpacingValueType.PERCENT,percent:1};if(e)if(e.spacing){if(!e.spacing.line)e.spacing.line=l}else e.spacing={line:l};else e={spacing:{line:l}};e=e.defPrProps;if(j&&j.bold)e.bold=j.bold;if(e.fill&&e.fill.solid){if(g&&g.fontRef&&g.fontRef.color)e.fill.solid.color=
m.extend(true,e.fill.solid.color,g.fontRef.color);if(j&&j.fontRef&&j.fontRef.color)e.fill.solid.color=m.extend(true,e.fill.solid.color,j.fontRef.color)}if(j=this.mergeFill(e.fill,h,g))e.fill=j;if(g=this.mergeStroke(e.stroke,h,g))e.stroke=g;if(h=this.mergeFont(e.font,h))e.font=h},updateMasterPlaceHolderText:function(e,g,h,j){var l=this,n=h.props?h.props.fill?h.props.fill.type==m.ShapeConstants.FillType.PICT:false:false;n=h.type==m.ShapeConstants.ShapeNodeType.PICTURE?true:n;m.each(e,function(o,p){var r=
g.type;if(r!=m.ShapeConstants.PlaceHolderType.SLIDENUM&&r!=m.ShapeConstants.PlaceHolderType.DATETIME&&r!=m.ShapeConstants.PlaceHolderType.FOOTER){if(r==m.ShapeConstants.PlaceHolderType.TXTBODY||r==m.ShapeConstants.PlaceHolderType.CONTENT||r==m.ShapeConstants.PlaceHolderType.TXT)r="txtbodylevel"+p.style.level;var q=l.getPlaceHolderText("show.render.masterplaceholder",r);n=r==m.ShapeConstants.PlaceHolderType.PICT&&n;if(j=="THEME"){n=r==m.ShapeConstants.PlaceHolderType.PICT;q=r===m.ShapeConstants.PlaceHolderType.PICT?
!o?m.i18n("show.render.masterplaceholder.pict"):"":"Lorem ipsum dolor";m.each(p.portions,function(s){p.portions[s].t=!s?q:""})}else m.each(p.portions,function(s){p.portions[s].t=!s?!n?q:p.portions[0].t:""})}});return e},updateFillToSolid:function(e){if(e.type=="GRADIENT"){e.type="SOLID";e.solid={};e.solid.color=m.extend(true,{},e.gradient.stops[0].color)}},mergePortionProps:function(e,g){var h=this,j=e.portions;if(j){var l=h.getFontRefData(g.themeRef.fontRef,g.themeInfo);m.each(j,function(n,o){var p=
m.extend(true,{},l);o.unmerged={props:m.extend(true,p,o.props)};if(o.unmerged.props.fill){var r=o.unmerged.props.fill;h.updateFillToSolid(r);if(r.solid){var q=h.mergeColor(r.solid.color,g.themeInfo);r.solid.color=q}}if(!e.style.defPrProps.fill)e.style.defPrProps.fill={type:m.ShapeConstants.FillType.SOLID,solid:{color:{type:"TX1"}}};o.props=zoho.customMerge(h.globalMergeOptions,{},e.style.defPrProps,p,o.props);if(o.props){if(p=h.mergeFill(o.props.fill,g.themeInfo,g.themeRef)){h.updateFillToSolid(p);
o.props.fill=p}if(p=h.mergeStroke(o.props.stroke,g.themeInfo,g.themeRef))o.props.stroke=p;if(p=h.mergeFont(o.props.font,g.themeInfo))o.props.font=p;if((p=o.props.click)&&p.type!="NONE"){var s="HLINK";if(p.type=="EMAIL "||p.type=="LINK"){if((r=window.$.slideUtil.doc.sessionProps)&&r.length){var t=p[p.type.toLowerCase()];t=t.email?t.email:t;m.each(r,function(u,v){if(v.key==t&&v.value=="visited")s="FOLLOWHLINK"})}}else if(p.type=="SLIDE")if(p.visited)s="FOLLOWHLINK";p=m.shapeUtil.getThemeLinkProps(s,
g.themeInfo);o.props.click.props=p}}})}},getThemeLinkProps:function(e,g){return{fill:{type:"SOLID",solid:{color:{rgb:m.ThemeUtil.getColorValue(e,g)}}},underline:"SINGLE"}},getFontRefData:function(e,g){var h={};if(!e)return h;if(e.ref===m.ShapeConstants.FontRef.MAJOR)h.font=m.extend(true,{},g.theme.fontScheme.latin[0]);else if(e.ref===m.ShapeConstants.FontRef.MINOR)h.font=m.extend(true,{},g.theme.fontScheme.latin[1]);h.fill={type:"SOLID",solid:{color:e.color}};return h},mergeListStyle:function(e,g,
h,j){if(e){var l=e.listStyle;if(l)if(g&&!g.listStyle&&(!j||!j.listStyle))delete e.listStyle;else{if(l.color)if(e=this.mergeColor(l.color,h))l.color=e;if(l.bullet&&l.bullet.picture){e=l.bullet.picture.value;g=undefined;if(e.type==="USERDEFINED"){e=m.slideUtil.getRelationshipKey(e.id,"pictures");g=m.slideUtil.imageURLCache[e]?m.slideUtil.imageURLCache[e].serverUrl:showContextPath+ZURLS.IMAGE+"?id="+e+"&rid="+m.slideUtil.docInfo.RESOURCE_ID+"&a_t=IMAGE_VIEW";l.bullet.picture.value.url=g}}if(!m.isEmptyObject(l.font))if(l.bullet&&
l.bullet.type===m.ShapeConstants.BulletType.NUMBER&&l.font&&l.font.fontFamily&&l.font.fontFamily.name==="Wingdings")l.font=m.ThemeUtil.getFont(l.font,h);else if(h=this.mergeFont(l.font,h))l.font=h}}},getText:function(e){var g="";m.each(e.portions,function(h,j){if(j.t)g+=j.t});return g=g!=""?g:undefined},isPlaceHolderEditedBefore:function(e){var g=false;if(!this.isPlaceHolderShape(e))return!g;var h=e[e.type.toLowerCase()],j=h.nvOProps.nvProps.placeHolder.type;if(j===m.ShapeConstants.PlaceHolderType.PICT||
e.type==m.ShapeConstants.ShapeNodeType.PICTURE&&j===m.ShapeConstants.PlaceHolderType.CONTENT)g=!this.checkPicturePhStatus(e);else if(e.type==m.ShapeConstants.ShapeNodeType.SHAPE&&j===m.ShapeConstants.PlaceHolderType.CONTENT&&h.nvOProps.nvProps.embed)g=true;else if(e.type==m.ShapeConstants.ShapeNodeType.GRAPHICFRAME&&j===m.ShapeConstants.PlaceHolderType.CONTENT)g=true;if(g)return g;if(h.textBody&&h.textBody.paras){var l=this;m.each(h.textBody.paras,function(n,o){if(g=!l.isEmptyPortions(o))return false})}return g},
checkPicturePhStatus:function(e,g,h){var j=m.SlideHandler.getSelectedSlideData(),l=j.slide.slide?j.slide.slide:j.slide,n=l.data.id;e=typeof e=="string"?this.getShapeObjectById(e,l):e;var o=e.type.toLowerCase(),p=e[o].nvOProps,r=p?p.nvProps?p.nvProps.placeHolder:false:false;j=false;if(r)if(r.type==m.ShapeConstants.PlaceHolderType.PICT||o===m.ShapeConstants.ShapeNodeType.PICTURE.toLowerCase()&&r.type===m.ShapeConstants.PlaceHolderType.CONTENT){if(!h){p=e[o].value;if(l.data.type=="LAYOUT")j=p?j:true;
else if(l.data.type==m.ShapeConstants.SlideType.SLIDE){g=g?g:m.slideUtil.getMasterSlide(n);l=g.slide?g.slide:g;j=(g=(g=m.slideUtil.getShape(r.relId,l))?g.value:undefined)?g.id==p.id:p?j:true}}}else if(r.type==m.ShapeConstants.PlaceHolderType.CONTENT)j=(j=(j=e[o].textBody)?j.paras:undefined)&&j.length==1&&!(p.nvProps&&p.nvProps.embed)?this.isEmptyPortions(j[0]):false;return j},isPlaceHolderShape:function(e){e=e[e.type.toLowerCase()];return e.nvOProps.nvProps&&e.nvOProps.nvProps.placeHolder},isEmptyPortions:function(e){var g=
true;e&&m.each(e.portions,function(h,j){if(j.t&&j.t.length)return g=false});return g},isEmptyTextBody:function(e){var g=this,h=false;e.textBody&&e.textBody.paras&&m.each(e.textBody.paras,function(j,l){if(h=!g.isEmptyPortions(l))return false});return!h},isEmptyContent:function(e){var g=e.textBody&&e.textBody.paras?e.textBody.paras:undefined;return e.nvOProps&&e.nvOProps.nvProps&&e.nvOProps.nvProps.embed?false:g&&g.length==1?m.shapeUtil.isEmptyPortions(g[0]):false},containsText:function(e){var g=this,
h=false;m.each(e,function(j,l){if(h=!g.isEmptyPortions(l))return false});return h},getParaMarginForLevelChange:function(e,g,h,j){var l={};g=e.textBody.paras[g].unmerged.style;if(g.margin&&!isNaN(g.margin.left)){h=b(e.textBody.listStyles,h);e=b(e.textBody.listStyles,j).margin.left+(g.margin.left-h.margin.left);if(e<0)e=0;l={margin:{left:e}}}return l},getPortionSizeForLevelChange:function(e,g,h,j){var l=[],n=b(e.textBody.listStyles,h),o=b(e.textBody.listStyles,j);m.each(e.textBody.paras[g].portions,
function(p,r){var q=r.unmerged;if(q&&q.props&&q.props.size&&r.t){q=parseInt(o.defPrProps.size-n.defPrProps.size);q=parseInt(r.props.size)+q;var s=r.t.length,t=m.TextConverter.getIndex(g,p,s,e.textBody);s=t-s;t-=1;q={at:"update",ut:m.ShapeConstants.UpdateType.PORTION.toLowerCase(),si:s,ei:t,value:{value:{size:q}}};l.push(q)}});return l}};var a=function(e,g,h){if(!(!g||m.isEmptyObject(g))){g=g.type;if(g===m.ShapeConstants.PlaceHolderType.TITLE)return b(e.titleStyles,h);if(g===m.ShapeConstants.PlaceHolderType.TXTBODY||
g===m.ShapeConstants.PlaceHolderType.SUBTITLE||g===m.ShapeConstants.PlaceHolderType.CONTENT||g===m.ShapeConstants.PlaceHolderType.TXT)return b(e.txtbodyStyles,h);return b(e.otherStyles,h)}},b=function(e,g){var h;e&&m.each(e,function(j,l){if(l.level===g){h=l;return false}});return h},c=function(e,g){if(!(!g||m.isEmptyObject(g))){var h=g.type;if(h===m.ShapeConstants.PlaceHolderType.TITLE)return e.titleStyles;if(h===m.ShapeConstants.PlaceHolderType.TXTBODY||h===m.ShapeConstants.PlaceHolderType.SUBTITLE||
h===m.ShapeConstants.PlaceHolderType.CONTENT||h===m.ShapeConstants.PlaceHolderType.TXT)return e.txtbodyStyles;return e.otherStyles}},f=function(e,g){var h=[];m.each(e,function(j,l){var n=b(g,l.level);h[h.length]=zoho.customMerge(m.shapeUtil.globalMergeOptions,{},l,n)});return h},d=function(e,g,h){var j=h;m.isEmptyObject(g)||(j=f(g,h));return j=f(e,j)};m.shapeUtil=new m.ShapeUtil})(jQuery);(function(m){PathGenerator=function(a){this.init(a)};PathGenerator.prototype={pathArray:undefined,pathNumber:undefined,init:function(a){this.pathutil=a?DrawingPathUtil:VectorUtil.supportsSvg()?SVGPathUtil:VMLPathUtil},getCustomPathPoints:function(a,b,c){this.pathArray=[[]];this.pathNumber=0;var f=VectorUtil.getViewBoxDimensions(b,c);b=f[0];c=f[1];var d=this;m.each(a.pathList,function(e,g){e!=0&&d.createNewPath();var h=g.width,j=g.height;m.each(g.path,function(l,n){var o=n.type.split("_"),p="";m.each(o,
function(r,q){var s=q.toLowerCase();if(r!=0)s=VectorUtil.capitalise(s);p+=s});o=m.extend(true,{},n[p]);if(n[p].length)m.each(o,function(r,q){q.x=q.x/h*b;q.y=q.y/j*c});else{o.x=o.x/h*b;o.y=o.y/j*c}d[p].call(d,o)})});return this.pathArray},getCustomPath:function(a,b,c){var f=this.getCustomPathPoints(a,b,c);a={};a.path=this.convertToPath(f);f=m.extend(true,[],a.path);a.path=f.concat(a.path);b=VectorUtil.getViewBoxDimensions(b,c);this.setConnectorAndTextBox(m.ShapeConstants.PresetShapeGeometry.RECT,b[0],
b[1],a);this.convertTextBoxAndConnector(a);return a},getPath:function(a,b,c,f){a=this.getPathPoints(a,f,b,c);a.path=this.convertToPath(a.path);this.convertTextBoxAndConnector(a);b=a.path;c=b.length;b[c]=b[c-1];return a},convertTextBoxAndConnector:function(a){var b=a[Shape.textbox];if(b)a[Shape.textbox]=this.convertTextBox(b);if(b=a[Shape.connector])a[Shape.connector]=this.convertConnectorPoints(b)},convertToPath:function(a){var b=[],c=this;m.each(a,function(){var f="";m.each(this,function(){m.each(this,
function(d,e){f+=c.pathutil.getNumber(e);f+=" "})});f.length>0&&b.push(f)});return b},convertTextBox:function(a){return m.map(a,function(b){return Math.round(b)})},convertConnectorPoints:function(a){var b=[];m.each(a,function(c,f){var d=[];d[0]=Math.round(f[0]);d[1]=Math.round(f[1]);d[2]=Math.round(f[2]);b[c]=d});return b},getX:function(a,b,c){return a*b/c},getY:function(a,b,c){return a*c/b},getRectCoordinates:function(a,b,c){var f=this.getCoordinates(a[0],b,c);if(typeof a[1]=="undefined")return f;
a=this.getCoordinates(a[1],b,c);return[f,a]},getCoordinates:function(a,b,c,f,d){var e=Math.min(b,c);if(typeof f=="undefined")f=0.5;var g=e*f;if(d=="x")g=b*f;else if(d=="y")g=c*f;return a=zoho.math.maxLimit(a*e,g)},getEllipseCoordinates:function(a,b,c,f,d,e){d||(d=c);e||(e=f);var g=d+c*Math.cos(a);a=e+f*Math.sin(a);if(typeof b==undefined)return[g,a];return[g,a,d+c*Math.cos(b),e+f*Math.sin(b)]},isLargeArc:function(a,b){var c=true,f=Math.abs(b-a);if(a<b){if(f<Math.PI)c=false}else if(f>Math.PI)c=false;
return c},checkBraceMax:function(a,b,c){var f=a[1]*c,d=c-f;d=this.getCoordinates(a[0],b,c,d<f?c?d*0.5/c:0:c?f*0.5/c:0,"y");b=Math.min(b,c);if(d!=0&&b!=0)a[0]=d/b;return[f,d]},drawBracket:function(a,b,c,f,d,e){this.move(a,c);this.addXCurve(a,c,b,f);this.addLine(b,d);this.addYCurve(b,d,a,e)},drawBrace:function(a,b,c,f,d,e,g,h,j,l){this.move(a,f);this.addXCurve(a,f,b,d);this.addLine(b,e);this.addXCurve(b,e,c,l,true);this.addYCurve(c,l,b,g,true);this.addLine(b,h);this.addYCurve(b,h,a,j)},drawArrow:function(a,
b,c,f,d,e,g,h){this.move(b,d);this.addLine(b,f);this.moveLine(c,h,b,g,b,e,a,e,a,d);this.closePath()},drawVerticalArrow:function(a,b,c,f,d,e,g,h){this.move(d,b);this.addLine(d,c);this.moveLine(e,c,e,b,g,b,h,a,f,b);this.closePath()},computeArrowValues:function(a,b,c){var f=Math.min(b,c),d=this.getCoordinates(a[1],b,c),e=this.getCoordinates(a[0],b,c,a[1]*2);if(Shape.selectedHandle==0)a[0]=e/f;b=this.getCoordinates(a[2],b,c,0.5-a[1]);if(Shape.selectedHandle==2)a[2]=b/f;return[d,e*0.5,b]},computeArrowCalloutValues:function(a,
b,c,f,d,e){var g=Math.min(b,c),h,j;if(f){h="y";j=c}else{h="x";j=b}var l=this.getCoordinates(a[2],b,c,1,h);h=a[3]*j;var n=j-l;if(e)n=j-l*2;h=zoho.math.maxLimit(h,n);if(Shape.selectedHandle==3)a[3]=h/j;if(d){d=l;h=j-h}else d=j-l;j=this.getCoordinates(a[1],b,c,0.5,f?"x":"y");e=this.getCoordinates(a[0],b,c,a[1]*2);if(Shape.selectedHandle==0)a[0]=e/g;e*=0.5;a=f?b*0.5:c*0.5;return[h,d,a-j,a-e,a+e,a+j]},computeCurvedArrowValues:function(a,b,c,f){var d=c*0.5;if(f)d=b*0.5;var e=Math.min(b,c),g="y";if(f)g=
"x";g=this.getCoordinates(a[1],b,c,0.5,g);if(Shape.selectedHandle==1)a[1]=g/e;var h=this.getCoordinates(a[0],b,c,a[1]);if(Shape.selectedHandle==0)a[0]=h/e;d-=(h+g)*0.25;var j=d*2,l=Math.sqrt(j*j-h*h),n=j?l*b/j:0;if(f)n=j?l*c/j:0;j=b?n/b:0;if(f)j=c?n/c:0;l="x";if(f)l="y";b=this.getCoordinates(a[2],b,c,j,l);if(Shape.selectedHandle==2)a[2]=b/e;return[h,g,b,d,n]},computeEllipticCoords:function(a,b,c,f,d,e){d=zoho.math.toRadians(d);e=zoho.math.toRadians(e);c-=a*Math.cos(d);f-=b*Math.sin(d);d+=e;d%=360;
return[c+a*Math.cos(d),f+b*Math.sin(d)]},setConnectorAndTextBox:function(a,b,c,f){var d=b*0.5,e=c*0.5;if(a==m.ShapeConstants.PresetShapeGeometry.OVAL){a=this.setTextBox(a,d,e,f);f[Shape.connector]=[[d,0,270],[a[0],a[1],270],[0,e,180],[a[0],a[3],90],[d,c,90],[a[2],a[3],90],[b,e,0],[a[2],a[1],270]]}else if(a==m.ShapeConstants.PresetShapeGeometry.RECT){f[Shape.textbox]=[0,0,b,c];f[Shape.connector]=[[d,0,270],[0,e,180],[d,c,90],[b,e,0]]}},setTextBox:function(a,b,c,f){if(a==m.ShapeConstants.PresetShapeGeometry.OVAL){a=
zoho.math.toRadians(225);var d=zoho.math.toRadians(45);b=this.getEllipseCoordinates(a,d,b,c);f[Shape.textbox]=[b[0],b[1],b[2],b[3]];return b}},setConnector:function(a,b,c,f){var d=b*0.5,e=c*0.5;if(a==m.ShapeConstants.PresetShapeGeometry.RECT)f[Shape.connector]=[[d,0,270],[0,e,180],[d,c,90],[b,e,0]]},modifier:{QuadArrow:function(a,b,c){return this.computeArrowValues(a,b,c)},LeftRightUpArrow:function(a,b,c){return this.computeArrowValues(a,b,c)},BentArrow:function(a,b,c){var f=Math.min(b,c),d=this.getCoordinates(a[1],
b,c),e=this.getCoordinates(a[0],b,c,a[1]*2);if(Shape.selectedHandle==0)a[0]=e/f;var g=d-e*0.5,h=this.getCoordinates(a[2],b,c);g=Math.min(c-g,b-h);a=this.getCoordinates(a[3],b,c,f?g/f:0);return[e,d,h,a]},UTurnArrow:function(a,b,c){var f=Math.min(b,c),d=this.getCoordinates(a[1],b,c),e=this.getCoordinates(a[0],b,c,a[1]*2);if(Shape.selectedHandle==0)a[0]=e/f;var g=a[4]*c;g=zoho.math.minLimit(g,e+a[2]*f);var h=this.getCoordinates(a[2],b,c,c?(g-e)/c:0,"y"),j=(b-(d-e*0.5))*0.5,l=g-h;if(l<j)j=l;b=this.getCoordinates(a[3],
b,c,b?j/b:0,"x");if(Shape.selectedHandle==3)a[3]=b/f;return[e,d,h,b,g]},LeftUpArrow:function(a,b,c){var f=Math.min(b,c),d=this.getCoordinates(a[1],b,c),e=this.getCoordinates(a[0],b,c,a[1]*2);if(Shape.selectedHandle==0)a[0]=e/f;b=this.getCoordinates(a[2],b,c,c?(f-d*2)/c:0,"y");if(Shape.selectedHandle==2)a[2]=b/f;return[e,d,b]},BentUpArrow:function(a,b,c){var f=Math.min(b,c),d=this.getCoordinates(a[1],b,c),e=this.getCoordinates(a[0],b,c,a[1]*2);if(Shape.selectedHandle==0)a[0]=e/f;a=this.getCoordinates(a[2],
b,c);return[e,d,a]},CurvedRightArrow:function(a,b,c){return this.computeCurvedArrowValues(a,b,c)},CurvedLeftArrow:function(a,b,c){return this.computeCurvedArrowValues(a,b,c)},CurvedUpArrow:function(a,b,c){return this.computeCurvedArrowValues(a,b,c,true)},CurvedDownArrow:function(a,b,c){return this.computeCurvedArrowValues(a,b,c,true)},RightArrowCallout:function(a,b,c){return this.computeArrowCalloutValues(a,b,c)},DownArrowCallout:function(a,b,c){return this.computeArrowCalloutValues(a,b,c,true)},
LeftArrowCallout:function(a,b,c){return this.computeArrowCalloutValues(a,b,c,false,true)},UpArrowCallout:function(a,b,c){return this.computeArrowCalloutValues(a,b,c,true,true)},LeftRightArrowCallout:function(a,b,c){return this.computeArrowCalloutValues(a,b,c,false,true,true)},QuadArrowCallout:function(a,b,c){var f=this.computeArrowValues(a,b,c);b=Math.min(b,c);c=a[3]*b;c=zoho.math.limit(c,f[1]*2,b-f[2]*2);if(Shape.selectedHandle==3)a[3]=c/b;c*=0.5;f[3]=c;return f},Divide:function(a,b,c){b=zoho.math.limit(a[2],
0.01,Math.min((0.7349+-1*a[0])*0.25,c?0.36745*b/c:0));if(Shape.selectedHandle==2)a[2]=b;c=zoho.math.limit(a[1],0,0.7349+-4*b-a[0]);if(Shape.selectedHandle==1)a[1]=c;return[a[0],c,b]},Equal:function(a,b,c){b=a[0]*c;var f=a[1]*c;f=zoho.math.maxLimit(f,c-b*2);if(Shape.selectedHandle==1)a[1]=f/c;f*=0.5;return[b,f]},NotEqual:function(a,b,c){b=a[0]*c;var f=a[2]*c;f=zoho.math.maxLimit(f,c-b*2);if(Shape.selectedHandle==2)a[2]=f/c;f*=0.5;return[b,f]},CropFrame:function(){}},Rect:function(a,b,c,f){this.move(0,
0);this.addLine(b,0);this.moveLine(b,c,0,c,0,0);this.closePath();if(f){f[Shape.textbox]=[0,0,b,c];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)}},RoundRect:function(a,b,c,f){a=this.getCoordinates(a[0],b,c);var d=b-a,e=c-a;this.move(a,0);this.addLine(d,0);this.addXCurve(d,0,b,a);this.addLine(b,e);this.addYCurve(b,e,d,c);this.addLine(a,c);this.addXCurve(a,c,0,e);this.addLine(0,a);this.addYCurve(0,a,a,0);f[Shape.handle]=[[a,0]];a*=0.293;f[Shape.textbox]=[a,a,b-a,c-a];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,
b,c,f)},SnipSingleRect:function(a,b,c,f){a=this.getRectCoordinates(a,b,c);var d=b-a;this.move(0,0);this.addLine(d,0);this.moveLine(b,a,b,c,0,c);this.closePath();f[Shape.handle]=[[d,0]];f[Shape.textbox]=[0,a*0.5,(d+b)*0.5,c];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},SnipSamesideRect:function(a,b,c,f){var d=this.getRectCoordinates(a,b,c),e=b-d[0];a=d[0];var g=d[1],h=b-g;d=c-g;this.move(b-e,0);this.addLine(e,0);this.moveLine(b,a,b,d,h,c,g,c,0,d,0,a);this.closePath();f[Shape.handle]=
[[e,0],[g,c]];e=zoho.math.ifElse(a-g,a,g)*0.5;f[Shape.textbox]=[e,a*0.5,b-e,(d+c)*0.5];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},SnipDiagonalRect:function(a,b,c,f){var d=this.getRectCoordinates(a,b,c);a=b-d[0];var e=d[0];d=d[1];var g=b-d,h=c-d,j=c-e;this.move(a,0);this.addLine(b,e);this.moveLine(b,h,g,c,e,c,0,j,0,d,d,0);this.closePath();f[Shape.handle]=[[a,0],[d,0]];a=zoho.math.ifElse(d-e,d,e)*0.5;f[Shape.textbox]=[a,a,b-a,c-a];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,
b,c,f)},SnipRoundSingleRect:function(a,b,c,f){var d=this.getRectCoordinates(a,b,c);a=b-d[0];var e=d[0];d=d[1];this.move(a,0);this.addLine(b,e);this.moveLine(b,c,0,c,0,d);this.addYCurve(0,d,d,0);this.closePath();f[Shape.handle]=[[a,0],[d,0]];e=d*0.293;f[Shape.textbox]=[e,e,(a+b)*0.5,c];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},RoundSingleRect:function(a,b,c,f){a=this.getRectCoordinates(a,b,c);var d=b-a;this.move(0,0);this.addLine(d,0);this.addXCurve(d,0,b,a);this.addLine(b,
c);this.moveLine(0,c);this.closePath();f[Shape.handle]=[[d,0]];f[Shape.textbox]=[0,0,b-a*0.293,c];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},RoundSamesideRect:function(a,b,c,f){var d=this.getRectCoordinates(a,b,c),e=b-d[0];a=d[0];d=d[1];var g=b-e,h=b-d,j=c-d;this.move(g,0);this.addLine(e,0);this.addXCurve(e,0,b,a);this.addLine(b,j);this.addYCurve(b,j,h,c);this.addLine(d,c);this.addXCurve(d,c,0,j);this.addLine(0,a);this.addYCurve(0,a,g,0);this.closePath();f[Shape.handle]=[[e,
0],[d,c]];e=a*0.293;g=d*0.293;a=zoho.math.ifElse(a-d,e,g);f[Shape.textbox]=[a,e,b-a,c-g];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},RoundDiagonalRect:function(a,b,c,f){var d=this.getRectCoordinates(a,b,c),e=b-d[0];a=d[0];d=d[1];var g=b-d,h=c-d,j=c-a;this.move(d,0);this.addLine(e,0);this.addXCurve(e,0,b,a);this.addLine(b,h);this.addYCurve(b,h,g,c);this.addLine(a,c);this.addXCurve(a,c,0,j);this.addLine(0,d);this.addYCurve(0,d,d,0);this.closePath();f[Shape.handle]=[[e,0],[d,
0]];e=d*0.293;a*=0.293;a=zoho.math.ifElse(e-a,e,a);f[Shape.textbox]=[a,a,b-a,c-a];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},Oval:function(a,b,c,f){a=b*0.5;var d=c*0.5;this.move(0,d);this.addEllipse(a,d,a,d);f&&this.setConnectorAndTextBox(m.ShapeConstants.PresetShapeGeometry.OVAL,b,c,f)},IsoscelesTriangle:function(a,b,c,f){a=a[0]*b;this.move(a,0);this.addLine(b,c);this.moveLine(0,c);this.closePath();f[Shape.handle]=[[a,0]];var d=c*0.5,e=a*0.5,g=e+b*0.5;f[Shape.textbox]=[e,
d,g,c];f[Shape.connector]=[[a,0,270],[e,d,180],[0,c,90],[a,c,90],[b,c,90],[g,d,0]]},RightTriangle:function(a,b,c,f){this.move(0,0);this.addLine(b,c);this.moveLine(0,c);this.closePath();a=b*0.5;var d=c*0.5,e=7/12;f[Shape.textbox]=[b*(1/12),c*e,b*e,c*(11/12)];f[Shape.connector]=[[0,0,270],[0,d,180],[0,c,90],[a,c,90],[b,c,90],[a,d,0]]},Parallelogram:function(a,b,c,f){var d=a[0];a=this.getCoordinates(d,b,c,1,"x");var e=b-a;this.move(a,0);this.addLine(b,0);this.moveLine(e,c,0,c);this.closePath();f[Shape.handle]=
[[a,0]];var g=(1+5*(d*b/b))/12;d=g*b;g*=c;var h=b-d,j=c-g,l=b*0.5,n=c*0.5,o=zoho.math.limit(c*(l/a),0,c);e*=0.5;a*=0.5;f[Shape.textbox]=[d,g,h,j];f[Shape.connector]=[[l,c-o,270],[b-e,0,270],[b-a,n,0],[e,c,90],[l,o,90],[a,n,180]]},Trapezoid:function(a,b,c,f){var d=a[0];a=this.getCoordinates(d,b,c,0.5,"x");if(Shape.selectedHandleNumber==0)modifier[0][0]=a/Math.min(b,c);var e=b-a;this.move(a,0);this.addLine(e,0);this.moveLine(b,c,0,c);this.closePath();f[Shape.handle]=[[a,0]];d=d*b/(0.5*b);e=b*1/3*d;
var g=b*0.5,h=c*0.5;a*=0.5;f[Shape.textbox]=[e,c*1/3*d,b-e,c];f[Shape.connector]=[[g,0,270],[a,h,180],[g,c,90],[b-a,h,0]]},Diamond:function(a,b,c,f){a=b*0.5;var d=c*0.5;this.move(a,0);this.addLine(b,d);this.moveLine(a,c,0,d);this.closePath();if(f){var e=b*0.25,g=c*0.25;f[Shape.textbox]=[e,g,b-e,c-g];f[Shape.connector]=[[a,0,270],[0,d,180],[a,c,90],[b,d,0]]}},Pentagon:function(a,b,c,f){a=b*0.5;var d=a*1.05,e=c*0.55,g=zoho.math.toRadians(18),h=zoho.math.toRadians(306);b=d*Math.cos(g);var j=d*Math.cos(h);
d=a-b;var l=a-j,n=a+j,o=a+b;g=e-e*Math.sin(g);e-=e*Math.sin(h);b=g*j/b;this.move(d,g);this.addLine(a,0);this.moveLine(o,g,n,e,l,e);this.closePath();f[Shape.textbox]=[l,b,n,e];f[Shape.connector]=[[a,0,270],[d,g,180],[l,e,90],[a,c,90],[n,e,90],[o,g,0]]},Hexagon:function(a,b,c,f){var d=a[0];a=this.getCoordinates(d,b,c,0.5,"x");if(Shape.selectedHandleNumber==0)modifier[0][0]=a/Math.min(b,c);var e=b-a,g=c*0.5;this.move(a,0);this.addLine(e,0);this.moveLine(b,g,e,c,a,c,0,g);this.closePath();f[Shape.handle]=
[[a,0]];var h=b*-0.25;d*=b;var j=d+h,l=zoho.math.ifElse(j,4,2),n=zoho.math.ifElse(j,3,2);j=zoho.math.ifElse(j,h,0);d=(l+(d+j)/h*n/-1)/24;h=b*d;d*=c;f[Shape.textbox]=[h,d,b-h,c-d];f[Shape.connector]=[[b,g,0],[e,c,90],[a,c,90],[0,g,180],[a,0,270],[e,0,270]]},Heptagon:function(a,b,c,f){a=b*0.5;var d=13328/21600*c,e=4278/21600*c,g=2139/21600*b,h=19460/21600*b,j=0.7225*b,l=5993/21600*b;this.move(0,d);this.addLine(g,e);this.moveLine(a,0,h,e,b,d,j,c,l,c);this.closePath();f[Shape.textbox]=[g,e,h,c-e];f[Shape.connector]=
[[h,e,0],[b,d,0],[j,c,90],[l,c,90],[0,d,180],[g,e,180],[a,0,270]]},Octagon:function(a,b,c,f){a=this.getCoordinates(a[0],b,c);var d=b-a,e=c-a;this.move(a,0);this.addLine(d,0);this.moveLine(b,a,b,e,d,c,a,c,0,e,0,a);this.closePath();f[Shape.handle]=[[a,0]];var g=a*0.5;f[Shape.textbox]=[g,g,b-g,c-g];f[Shape.connector]=[[b,a,0],[b,e,0],[d,c,90],[a,c,90],[0,e,180],[0,a,180],[a,0,270],[d,0,270]]},Decagon:function(a,b,c,f){a=c*0.5;var d=b*0.5,e=a*1.05146,g=zoho.math.toRadians(36),h=zoho.math.toRadians(72),
j=d*Math.cos(g),l=d*Math.cos(h);c=d-j;var n=d-l;l=d+l;d+=j;h=e*Math.sin(h);j=e*Math.sin(g);e=a-h;g=a-j;j=a+j;h=a+h;this.move(0,a);this.addLine(c,g);this.moveLine(n,e,l,e,d,g,b,a,d,j,l,h,n,h,c,j);this.closePath();f[Shape.textbox]=[c,g,d,j];f[Shape.connector]=[[d,g,0],[b,a,0],[d,j,0],[l,h,90],[n,h,90],[c,j,180],[0,a,180],[c,g,180],[n,e,270],[l,e,270]]},Dodecagon:function(a,b,c,f){a=0.134*b;var d=0.366*b,e=0.634*b,g=0.866*b,h=0.134*c,j=0.366*c,l=0.634*c,n=0.866*c;this.move(0,j);this.addLine(a,h);this.moveLine(d,
0,e,0,g,h,b,j,b,l,g,n,e,c,d,c,a,n,0,l);this.closePath();f[Shape.textbox]=[a,h,g,n];f[Shape.connector]=[[g,h,0],[b,j,0],[b,l,0],[g,n,0],[e,c,90],[d,c,90],[a,n,180],[0,l,180],[0,j,180],[a,h,180],[d,0,270],[e,0,270]]},Pie:function(a,b,c,f){var d=a[0],e=a[1];a=b*0.5;var g=c*0.5,h=this.getEllipseCoordinates(d,e,a,g),j=h[0],l=h[1],n=h[2];h=h[3];this.addFiller(a,g);this.move(a,g);this.addLine(j,l);d=this.isLargeArc(d,e);this.addEllipseCurve(a,g,j,l,n,h,false,d);this.closePath();f[Shape.handle]=[[j,l],[n,
h]];this.setConnectorAndTextBox(m.ShapeConstants.PresetShapeGeometry.OVAL,b,c,f)},Chord:function(a,b,c,f){var d=a[0];a=a[1];var e=b*0.5,g=c*0.5,h=this.getEllipseCoordinates(d,a,e,g);c=h[0];b=h[1];var j=h[2];h=h[3];this.addFiller(c,b);var l=this.isLargeArc(d,a);this.addEllipseCurve(e,g,c,b,j,h,false,l);this.closePath();f[Shape.handle]=[[c,b],[j,h]];this.setTextBox(m.ShapeConstants.PresetShapeGeometry.OVAL,e,g,f);e=(c+j)*0.5;g=(b+h)*0.5;l=a-d;l=zoho.math.ifElse(l,l,l+360)*0.5;f[Shape.connector]=[[c,
b,d],[j,h,a],[e,g,d+l-180]]},Teardrop:function(a,b,c,f){var d=zoho.math.minLimit(a[0],0.5);d-=0.5;d*=2;a=b*0.5;var e=c*0.5,g=Math.sqrt(2),h=b?g*a*d*b/b:0;g=c?g*e*d*c/c:0;d=zoho.math.toRadians(45);h=a+h*Math.cos(d);g=e-g*Math.sin(d);var j=(a+h)*0.5;d=(e+g)*0.5;this.move(b,e);this.addEllipseCurve(a,e,b,e,a,0,false,true);j=zoho.math.toCubicControlPoints(a,0,j,0,h,g);this.addCubicCurve(j[0],j[1],j[2],j[3],h,g);j=zoho.math.toCubicControlPoints(h,g,b,d,b,e);this.addCubicCurve(j[0],j[1],j[2],j[3],b,e);this.closePath();
f[Shape.handle]=[[h,0]];d=this.setTextBox(m.ShapeConstants.PresetShapeGeometry.OVAL,a,e,f);f[Shape.connector]=[[b,e,0],[d[2],d[3],90],[a,c,90],[d[0],d[3],90],[0,e,180],[d[0],d[1],270],[a,0,270],[h,g,270]]},Frame:function(a,b,c,f){a=this.getCoordinates(a[0],b,c);var d=b-a,e=c-a;this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.move(d,e);this.addLine(d,a);this.moveLine(a,a,a,e);this.closePath();f[Shape.handle]=[[a,0]];f[Shape.textbox]=[a,a,d,e];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,
b,c,f)},updateModifiers:function(a,b,c,f,d){m.each(b,function(e,g){a[e]=g/f});m.each(c,function(e,g){a[e]=g/d})},getValues:function(a){return{sx:Math.min(a.x1,a.x2),sy:Math.min(a.y1,a.y2),lx:Math.max(a.x1,a.x2),ly:Math.max(a.y1,a.y2)}},CropFrame:function(a,b,c,f){var d=a.innerShape,e=a[0]*b,g=a[1]*c,h=a[4]*b,j=a[5]*c,l=a[2]*b,n=a[3]*c,o=a[6]*b,p=a[7]*c,r=a[8]*b,q=a[9]*c,s=a[10]*c,t=a[11]*b,u=a[12]*c,v=a[13]*b,w,x,y={x1:e,y1:g,x2:h,y2:j};if(Shape.selectedHandle==0||Shape.selectedHandle==2){l=(e+h)*
0.5;n=(g+j)*0.5;o=t=h;p=u=g;r=v=e;q=s=j;x6=x8=l;y7=y9=n;w={2:l,6:o,8:r,11:t,13:v};x={3:n,7:p,9:q,10:s,12:u}}if(Shape.selectedHandle==3||Shape.selectedHandle==4){l=(o+r)*0.5;n=(p+q)*0.5;e=v=r;g=u=p;h=t=o;j=s=q;x6=x8=l;y7=y9=n;w={0:e,2:l,4:h,11:t,13:v};x={1:g,3:n,5:j,10:s,12:u}}if(Shape.selectedHandle==5){h=t=o;j=q=s;r=v=e;l=(o+r)*0.5;y7=y9=n=(p+q)*0.5;w={2:l,4:h,8:r,11:t,13:v};x={3:n,5:j,9:q}}if(Shape.selectedHandle==6){h=o=t;j=s=q;p=u=g;l=(o+r)*0.5;n=(p+q)*0.5;x6=x8=l;w={2:l,4:h,6:o};x={3:n,5:j,7:p,
10:s,12:u}}if(Shape.selectedHandle==7){e=v=r;g=p=u;o=t=h;y7=y9=n;l=(o+r)*0.5;n=(p+q)*0.5;w={2:l,0:e,6:o,11:t,13:v};x={3:n,1:g,7:p}}if(Shape.selectedHandle==8){e=r=v;g=u=p;q=s=j;x6=x8=l;l=(o+r)*0.5;n=(p+q)*0.5;w={2:l,0:e,8:r};x={3:n,1:g,9:q,10:s,12:u}}if(Shape.selectedHandle==1){y=Math.abs(e-h)*0.5;w=Math.abs(g-j)*0.5;l=zoho.math.limit(l,y,b-y);n=zoho.math.limit(n,w,c-w);var A=l-y,E=n-w;y=l+y;x=n+w;if(e<h){e=A;h=y}else{e=y;h=A}if(g<j){g=E;j=x}else{g=x;j=E}if(r<o){r=A;o=y}else{r=y;o=A}if(q<p){q=E;p=
x}else{q=x;p=E}if(s<u){s=E;u=x}else{s=x;u=E}if(t<v){t=A;v=y}else{t=y;v=A}w={0:e,2:l,4:h,6:o,8:r,11:t,13:v};x={1:g,3:n,5:j,7:p,9:q,10:s,12:u}}if(w||x)this.updateModifiers(a,w,x,b,c);w=undefined;if(d){a=this.getPath(d.geom.preset.type,Math.abs(b-(a[13]+(1-a[11]))*b),Math.abs(c-(a[12]+(1-a[10]))*c),d.geom.preset.modifiers);a=m.extend(true,{},a);w=a.croppath;innerPathArray=m.extend(true,[],this.pathArray);this.clearPathArray()}this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c,0,0);if(Shape.selectedHandle!=
1){y={x1:e,y1:g,x2:h,y2:j};b=this.getValues(y);A=b.sx;E=b.sy;y=b.lx;x=b.ly}m.each(innerPathArray,function(C,F){m.each(F,function(G,B){var z=B[0];z=z.toLowerCase();if(z=="m"||z=="l"||z=="c"||z=="q")m.each(B,function(H){if(H&&typeof B[H]!="undefined")B[H]+=H%2?A:E});else z=="a"&&m.each(B,function(H){if(typeof B[H]=="string"&&B[H].toLowerCase()=="a")if(typeof B[H+7]!="undefined"){B[H+6]+=A;B[H+7]+=E}})})});if(typeof w=="undefined")w=[innerPathArray.length-1];var D=this;m.each(w,function(C,F){m.merge(D.pathArray[D.pathArray.length-
1],innerPathArray[F])});f[Shape.handle]=[[e,g,"nwcrop"],[l,n,"cropframe"],[h,j,"secrop"],[o,p,"necrop"],[r,q,"swcrop"],[l,s,"scrop"],[t,n,"ecrop"],[l,u,"ncrop"],[v,n,"wcrop"]]},HalfFrame:function(a,b,c,f){var d=a[0],e=Math.min(b,c),g=zoho.math.limit(a[1],0,e?1*b/e:0);g=e*g/1;d=zoho.math.limit(d,0,e?1*(c-(b?c*g/b:0))/e:0);if(Shape.selectedHandle==0)a[0]=d;a=e*d/1;e=b-(c?a*b/c:0);d=c-(b?g*c/b:0);var h=g*0.5,j=(d+c)*0.5,l=(e+b)*0.5,n=a*0.5,o=c*0.5,p=b*0.5;this.move(0,0);this.addLine(b,0);this.moveLine(e,
a,g,a,g,d,0,c);this.closePath();f[Shape.handle]=[[0,a],[g,0]];f[Shape.textbox]=[0,0,b,c];f[Shape.connector]=[[l,n,0],[h,j,90],[0,o,180],[p,0,270]]},Lshape:function(a,b,c,f){var d=c-this.getCoordinates(a[0],b,c,1,"y"),e=this.getCoordinates(a[1],b,c,1,"x");this.move(e,0);this.addLine(e,d);this.moveLine(b,d,b,c,0,c,0,0);this.closePath();f[Shape.handle]=[[0,d],[e,0]];a=e*0.5;var g=(d+c)*0.5,h=b*0.5,j=c*0.5,l=b-c;d=zoho.math.ifElse(l,d,0);e=zoho.math.ifElse(l,b,e);f[Shape.textbox]=[0,d,e,c];f[Shape.connector]=
[[b,g,0],[h,c,90],[0,j,180],[a,0,270]]},DiagonalStripe:function(a,b,c,f){var d=a[0];a=d*c;d*=b;this.move(0,a);this.addLine(d,0);this.moveLine(b,0,0,c);this.closePath();f[Shape.handle]=[[0,a]];var e=(d+b)*0.5,g=(a+c)*0.5;f[Shape.textbox]=[0,0,e,g];f[Shape.connector]=[[b*0.5,c*0.5,0],[0,g,180],[d*0.5,a*0.5,180],[e,0,270]]},Cross:function(a,b,c,f){var d=this.getCoordinates(a[0],b,c),e=b-d,g=c-d;this.move(d,0);this.addLine(e,0);this.moveLine(e,d,b,d,b,g,e,g,e,c,d,c,d,g,0,g,0,d,d,d);this.closePath();f[Shape.handle]=
[[d,0]];var h=b-c;a=zoho.math.ifElse(h,0,d);e=zoho.math.ifElse(h,b,e);d=zoho.math.ifElse(h,d,0);g=zoho.math.ifElse(h,g,c);f[Shape.textbox]=[a,d,e,g];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},Plaque:function(a,b,c,f){a=this.getCoordinates(a[0],b,c);var d=b-a,e=c-a;this.move(a,0);this.addLine(d,0);this.addXCurve(d,0,b,a,true);this.addLine(b,e);this.addYCurve(b,e,d,c,true);this.addLine(a,c);this.addXCurve(a,c,0,e,true);this.addLine(0,a);this.addYCurve(0,a,a,0,true);f[Shape.handle]=
[[a,0]];a*=0.707;f[Shape.textbox]=[a,a,b-a,c-a];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},Can:function(a,b,c,f){var d=this.getCoordinates(a[0],b,c,0.5,"y");if(Shape.selectedHandleNumber==0)a[0]=d/Math.min(b,c);var e=d*0.5;a=e+e;d=c-e;var g=b*0.5;this.move(0,e);this.addLine(0,d);this.addXEllipseCurve(g,e,0,b,d,true);this.addLine(b,e);this.addXEllipseCurve(g,e,b,0,e);this.createNewPath();this.move(0,e);this.addXEllipseCurve(g,e,0,b,e);this.addXEllipseCurve(g,e,b,0,e);this.createNewPath();
this.move(0,e);this.addXEllipseCurve(g,e,0,b,e);this.addXEllipseCurve(g,e,b,0,e);this.addLine(0,d);this.addXEllipseCurve(g,e,0,b,d,true);this.addLine(b,e);f[Shape.handle]=[[g,a]];g=b*0.5;e=c*0.5;f[Shape.textbox]=[0,a,b,d];f[Shape.connector]=[[g,a,270],[g,0,270],[0,e,180],[g,c,90],[b,e,0]]},Cube:function(a,b,c,f){a=this.getCoordinates(a[0],b,c,1,"x");var d=b-a,e=c-a;this.move(0,a);this.addLine(0,c);this.moveLine(d,c,d,a);this.createNewPath();this.move(0,a);this.addLine(a,0);this.moveLine(b,0,d,a);
this.createNewPath();this.move(d,c);this.addLine(d,a);this.moveLine(b,0,b,e);this.createNewPath();this.move(0,c);this.addLine(0,a);this.moveLine(a,0,b,0,b,e,d,c);this.closePath();this.move(0,a);this.addLine(d,a);this.move(d,a);this.addLine(d,c);this.move(d,a);this.addLine(b,0);f[Shape.handle]=[[0,a]];var g=d*0.5,h=(a+c)*0.5;f[Shape.textbox]=[0,a,d,c];f[Shape.connector]=[[(a+b)*0.5,0,270],[g,a,270],[0,h,180],[g,c,90],[d,h,0],[b,e*0.5,0]]},Tablecell:function(a,b,c,f){this.move(0,0);this.addLine(b,0);
this.moveLine(b,c,0,c,0,0);this.closePath();this.createNewPath();this.move(0,0);this.addLine(b,0);this.createNewPath();this.move(b,0);this.addLine(b,c);this.createNewPath();this.move(b,c);this.addLine(0,c);this.createNewPath();this.move(0,c);this.addLine(0,0);if(f){f[Shape.textbox]=[0,0,b,c];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)}},Bevel:function(a,b,c,f){a=this.getCoordinates(a[0],b,c);var d=b-a,e=c-a;this.move(a,a);this.addLine(d,a);this.moveLine(d,e,a,e);this.createNewPath();
this.move(0,0);this.addLine(a,a);this.moveLine(a,e,0,c);this.createNewPath();this.move(0,0);this.addLine(b,0);this.moveLine(d,a,a,a);this.createNewPath();this.move(b,0);this.addLine(b,c);this.moveLine(d,e,d,a);this.createNewPath();this.move(b,c);this.addLine(0,c);this.moveLine(a,e,d,e);this.createNewPath();this.move(0,0);this.addLine(0,c);this.moveLine(b,c,b,0);this.closePath();this.move(a,a);this.addLine(a,e);this.moveLine(d,e,d,a);this.closePath();this.move(0,0);this.addLine(a,a);this.move(0,c);
this.addLine(a,e);this.move(b,c);this.addLine(d,e);this.move(b,0);this.addLine(d,a);f[Shape.handle]=[[a,0]];var g=b*0.5,h=c*0.5;f[Shape.textbox]=[a,a,d,e];f[Shape.connector]=[[b,h,0],[d,h,0],[g,c,90],[g,e,90],[0,h,180],[a,h,180],[g,0,270],[g,a,270]]},Donut:function(a,b,c,f){a=this.getCoordinates(a[0],b,c);var d=g=b*0.5,e=h=c*0.5;this.move(0,e);this.addEllipse(g,h,d,e);this.move(a,e);var g,h;this.addEllipse(d-a,e-a,d,e,true);f[Shape.handle]=[[a,e]];this.setConnectorAndTextBox(m.ShapeConstants.PresetShapeGeometry.OVAL,
b,c,f)},NoSymbol:function(a,b,c,f){var d=this.getCoordinates(a[0],b,c,0.33,"x");if(Shape.selectedHandleNumber==0)a[0]=d/Math.min(b,c);a=b*0.5;var e=c*0.5,g=zoho.math.toRadians(45),h=Math.cos(g),j=Math.sin(g);g=a-d;var l=d/2,n=Math.sqrt(g*g-l*l);g=h*-1*l+j*-1*n+a;var o=h*-1*l+j*n+a,p=h*l+j*n+a;l=h*l+j*-1*n+a;n=this.getY(d,b,c);var r=e-n,q=n/2,s=Math.sqrt(r*r-q*q);r=-1*(j*-1*q-h*-1*s)+e;var t=-1*(j*-1*q-h*s)+e,u=-1*(j*q-h*s)+e;h=-1*(j*q-h*-1*s)+e;this.move(0,e);this.addEllipse(a,e,a,e);j=a-d;n=e-n;
this.move(g,r);this.addEllipseCurve(j,n,g,r,o,t,true,false,a-j,e-n);this.closePath();this.move(p,u);this.addEllipseCurve(j,n,p,u,l,h,true,false,a-j,e-n);this.closePath();f[Shape.handle]=[[d,e]];this.setConnectorAndTextBox(m.ShapeConstants.PresetShapeGeometry.OVAL,b,c,f)},BlockArc:function(a,b,c,f){var d=a[0],e=a[1],g=this.getCoordinates(a[2],b,c,0.5,"x"),h=midX=b*0.5,j=midY=c*0.5,l=this.getEllipseCoordinates(d,e,h,j),n=l[0],o=l[1];a=l[2];l=l[3];var p=this.isLargeArc(d,e);this.addFiller(n,o);this.addEllipseCurve(h,
j,n,o,a,l,false,p);h=Math.abs(midX-g);j=Math.abs(midY-g);var r=this.getEllipseCoordinates(d,e,h,j,midX,midY),q=r[0],s=r[1],t=r[2];g=r[3];this.addLine(t,g);this.addEllipseCurve(h,j,t,g,q,s,true,p,midX-h,midY-j);this.closePath();f[Shape.handle]=[[n,o],[t,g]];r=zoho.math.toRadians(360);h=e-d;h=zoho.math.ifElse(h,h,h+r);j=n>t?n:t;p=a>q?a:q;b=zoho.math.ifElse(h-(r-d),b,j>p?j:p);r=zoho.math.toRadians(90)-d;j=zoho.math.toRadians(450)-d;r=zoho.math.ifElse(r,r,j);j=o>g?o:g;p=l>s?l:s;r=zoho.math.ifElse(h-r,
c,j>p?j:p);c=zoho.math.toRadians(180)-d;j=zoho.math.toRadians(540)-d;c=zoho.math.ifElse(c,c,j);j=n<t?n:t;p=a<q?a:q;c=zoho.math.ifElse(h-c,0,j<p?j:p);j=zoho.math.toRadians(270)-d;p=zoho.math.toRadians(630)-d;j=zoho.math.ifElse(j,j,p);p=o<g?o:g;var u=l<s?l:s;h=zoho.math.ifElse(h-j,0,p<u?p:u);n=(n+q)*0.5;o=(o+s)*0.5;a=(a+t)*0.5;l=(l+g)*0.5;d=zoho.math.toDegrees(d)-90;e=zoho.math.toDegrees(e)+90;f[Shape.textbox]=[c,h,b,r];f[Shape.connector]=[[n,o,d],[a,l,e],[midX,midY,(d+e)*0.5]]},FoldedCorner:function(a,
b,c,f){var d=this.getCoordinates(a[0],b,c);a=b-d;var e=a+d*0.2,g=c-d;d=g+d*0.2;this.move(0,0);this.addLine(b,0);this.moveLine(b,g,a,c,0,c);this.createNewPath();this.move(a,c);this.addLine(e,d);this.moveLine(b,g);this.createNewPath();this.move(a,c);this.addLine(e,d);this.moveLine(b,g,a,c,0,c,0,0,b,0,b,g);f[Shape.handle]=[[a,c]];f[Shape.textbox]=[0,0,b,g];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},Smiley:function(a,b,c,f){var d=b*0.2289,e=b*0.2877,g=b*0.608,h=b*0.77,j=c*0.35,
l=c*0.764,n=a[0]*c;a=l-n;l+=n;n=l+n*2;var o=0.052*b,p=0.052*c,r=midx=b*0.5,q=midy=c*0.5;this.move(0,midy);this.addEllipse(r,q,midx,midy);this.createNewPath();this.move(e,j);this.addEllipse(o,p,e+o,j);this.move(g,j);this.addEllipse(o,p,g+o,j);this.createNewPath();this.move(d,a);d=zoho.math.toCubicControlPoints(d,a,midx,n,h,a);this.addCubicCurve(d[0],d[1],d[2],d[3],h,a);this.createNewPath();this.move(0,midy);this.addEllipse(midx,midy,midx,midy);f[Shape.handle]=[[midx,l]];this.setConnectorAndTextBox(m.ShapeConstants.PresetShapeGeometry.OVAL,
b,c,f)},Heart:function(a,b,c,f){var d=b*49/48,e=b*9/48;a=b*0.5;var g=a-d,h=a-e;e=a+e;d=a+d;var j=-1*c/3,l=c/4;this.move(a,l);this.addCubicCurve(e,j,d,l,a,c);this.moveCurve(g,l,h,j,a,l);this.closePath();f[Shape.textbox]=[b*(1/6),l,b*(5/6),c*(2/3)];f[Shape.connector]=[[a,l,270],[a,c,90]]},LightningBolt:function(a,b,c,f){a=0.3922*b;var d=0.5954*b,e=0.2814*c,g=0.5115*b,h=0.3146*c,j=0.7674*b,l=0.5558*c,n=0.6836*b,o=0.5961*c,p=0.4635*b,r=0.6905*c,q=0.5658*b,s=0.6475*c,t=0.2325*b,u=0.4493*c,v=0.3519*b,w=
0.388*c,x=0.18009*c;this.move(a,0);this.addLine(d,e);this.moveLine(g,h,j,l,n,o,b,c,p,r,q,s,t,u,v,w,0,x);this.closePath();g=b/21600;h=c/21600;f[Shape.textbox]=[8757*g,7437*h,13917*g,14277*h];f[Shape.connector]=[[a,0,270],[0,x,270],[p,r,180],[t,u,180],[b,c,90],[d,e,0],[j,l,0]]},Sun:function(a,b,c,f){var d=a[0]*b;a=b*0.5;var e=c*0.5,g=a-d,h=this.getY(g,b,c),j=(a-g*0.9238)*0.75,l=(a-g*0.3826)*0.75,n=(e-h*0.9328)*0.75,o=(e-h*0.3826)*0.75,p=0.03662*b,r=j+p;p=l+p;var q=0.03662*c,s=n+q;q=o+q;l+=0.125*b;o+=
0.125*c;var t=b-j,u=c-n,v=b-r,w=c-s,x=b-p,y=c-q,A=b-l,E=c-o,D=b*0.853,C=c*0.1464,F=b*0.1464,G=c*0.853;this.move(b,e);this.addLine(t,E);this.moveLine(t,o);this.closePath();this.move(D,C);this.addLine(v,q);this.moveLine(x,s);this.closePath();this.move(a,0);this.addLine(A,n);this.moveLine(l,n);this.closePath();this.move(F,C);this.addLine(p,s);this.moveLine(r,q);this.closePath();this.move(0,e);this.addLine(j,o);this.moveLine(j,E);this.closePath();this.move(F,G);this.addLine(r,y);this.moveLine(p,w);this.closePath();
this.move(a,c);this.addLine(l,u);this.moveLine(A,u);this.closePath();this.move(D,G);this.addLine(x,w);this.moveLine(v,y);this.closePath();this.move(d,e);this.addEllipse(g,h,a,e);f[Shape.handle]=[[d,e]];d=zoho.math.toRadians(225);j=zoho.math.toRadians(45);a=this.getEllipseCoordinates(d,j,g,h,a,e);f[Shape.textbox]=[a[0],a[1],a[2],a[3]];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},Moon:function(a,b,c,f){var d=VectorUtil.getHTMLDimension(b);VectorUtil.getHTMLDimension(c);var e=
a[0]*d,g=c*0.5,h=d-e,j=(h?d*d/h:0)*2-(h?e*e/h:0);h=j-e;d=d?Math.abs((j*0.5-e)*g/d):0;e=VectorUtil.getViewBoxDimensions(e);h=VectorUtil.getViewBoxDimensions(h);h=Math.abs(h-e)*0.5;this.move(b,0);this.addYEllipseCurve(b,g,0,c,b,true);this.addYEllipseCurve(h,d,c,0,b,false,false,e,g-d);f[Shape.handle]=[[e,g]];h=Math.min(b,c);a=this.getCoordinates(a[0],b,c)*0.3;a=h?a*b/h:0;d=h-a;d=Math.sqrt(h*h-d*d);h=h?d*g/h:0;f[Shape.textbox]=[a,g-h,e,g+h];f[Shape.connector]=[[b,0,270],[0,g,180],[b,c,90],[e,g,0]]},Cloud:function(a,
b,c,f){var d=21600;a=b/d;d=c/d;this.move(1950*a,7185*d);this.addEllipseCurve(3376.5*a,4595*d,1950*a,7185*d,7005*a,2580*d,false,false,1912*a,1972*d);this.addEllipseCurve(2666.5*a,3633.5*d,7005*a,2580*d,11250*a,1665*d,false,false,6692*a,650*d);this.addEllipseCurve(2182.5*a,2972.5*d,11250*a,1665*d,14910*a,1170*d,false,false,10992*a,0*d);this.addEllipseCurve(2428.5*a,3297.5*d,14910*a,1170*d,19140*a,2715*d,false,false,14330*a,0*d);this.addEllipseCurve(2666.5*a,3636.5*d,19140*a,2715*d,20895*a,7665*d,false,
false,15772*a,2592*d);this.addEllipseCurve(3387.5*a,4610*d,20895*a,7665*d,18690*a,15045*d,false,false,14822*a,5862*d);this.addEllipseCurve(2893.5*a,3933.5*d,18690*a,15045*d,14280*a,18330*d,false,false,12910*a,11080*d);this.addEllipseCurve(3376*a,4607.5*d,14280*a,18330*d,8235*a,19545*d,false,false,7660*a,12382*d);this.addEllipseCurve(3860*a,5271.5*d,8235*a,19545*d,2910*a,17640*d,false,false,2387*a,9757*d);this.addEllipseCurve(2180*a,2959*d,2910*a,17640*d,1080*a,12690*d,false,false,475*a,11732*d);this.addEllipseCurve(2172.5*
a,2972.5*d,1080*a,12690*d,1950*a,7185*d,false,false,0*a,7165*d);this.createNewPath();this.move(2340*a,13080*d);this.addEllipseCurve(2172.5*a,2972.5*d,2340*a,13080*d,1080*a,12690*d,false,false,0*a,7165*d);this.move(3465*a,17445*d);this.addEllipseCurve(2180*a,2959*d,3465*a,17445*d,2910*a,17640*d,false,false,475*a,11732*d);this.move(8235*a,19545*d);this.addEllipseCurve(3376*a,4607.5*d,8235*a,19545*d,7905*a,18675*d,false,false,7660*a,12382*d);this.move(14400*a,17370*d);this.addEllipseCurve(3376*a,4607.5*
d,14400*a,17370*d,14280*a,18330*d,false,false,7660*a,12382*d);this.move(17070*a,11475*d);this.addEllipseCurve(2892.5*a,3933.5*d,17070*a,11475*d,18690*a,15045*d,false,false,12910*a,11080*d);this.move(20895*a,7665*d);this.addEllipseCurve(2666.5*a,3636.5*d,20895*a,7665*d,20175*a,9015*d,false,false,15772*a,2592*d);this.move(19140*a,2715*d);this.addEllipseCurve(2428.5*a,3297.5*d,19140*a,2715*d,19200*a,3345*d,false,false,14330*a,0*d);this.move(14550*a,1980*d);this.addEllipseCurve(2428.5*a,3297.5*d,14550*
a,1980*d,14910*a,1170*d,false,false,14330*a,0*d);this.move(11040*a,2340*d);this.addEllipseCurve(2182.5*a,2972.5*d,11040*a,2340*d,11250*a,1665*d,false,false,10992*a,0*d);this.move(7005*a,2580*d);this.addEllipseCurve(3376.5*a,4595*d,7005*a,2580*d,7650*a,3270*d,false,false,1912*a,1972*d);this.move(2070*a,7890*d);this.addEllipseCurve(3376.5*a,4595*d,2070*a,7890*d,1950*a,7185*d,false,false,1912*a,1972*d);b*=0.5;c*=0.5;f[Shape.textbox]=[2977*a,3262*d,17087*a,17337*d];f[Shape.connector]=[[21582*a,c,0],[b,
21577*d,90],[67*a,c,180],[b,1235*d,270]];f.croppath=[0]},Arc:function(a,b,c,f){var d=a[0],e=a[1],g=b*0.5,h=c*0.5,j=this.getEllipseCoordinates(d,e,g,h);a=j[0];var l=j[1],n=j[2];j=j[3];this.addFiller(a,l);var o=this.isLargeArc(d,e);this.addEllipseCurve(g,h,a,l,n,j,false,o);f[Shape.handle]=[[a,l],[n,j]];g=zoho.math.toRadians(360);h=e-d;h=zoho.math.ifElse(h,h,h+g);g=zoho.math.ifElse(h-(g-d),b,a>n?a:n);o=zoho.math.toRadians(90)-d;var p=zoho.math.toRadians(450)-d;o=zoho.math.ifElse(o,o,p);o=zoho.math.ifElse(h-
o,c,l>j?l:j);p=zoho.math.toRadians(180)-d;var r=zoho.math.toRadians(540)-d;p=zoho.math.ifElse(p,p,r);p=zoho.math.ifElse(h-p,0,a<n?a:n);r=zoho.math.toRadians(270)-d;var q=zoho.math.toRadians(630)-d;r=zoho.math.ifElse(r,r,q);h=zoho.math.ifElse(h-r,0,l<j?l:j);d=zoho.math.toDegrees(d)-90;e=zoho.math.toDegrees(e)+90;f[Shape.textbox]=[p,h,g,o];f[Shape.connector]=[[a,l,d],[b*0.5,c*0.5,(d+e)*0.5],[n,j,e]]},DoubleBracket:function(a,b,c,f){a=this.getCoordinates(a[0],b,c);var d=c-a;this.drawBracket(b-a,b,0,
a,d,c);this.drawBracket(a,0,c,d,a,0);f[Shape.handle]=[[0,a]];a*=0.293;f[Shape.textbox]=[a,a,b-a,c-a];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},DoubleBrace:function(a,b,c,f){a=this.getCoordinates(a[0],b,c,0.25);var d=c*0.5,e=a*2,g=d-a,h=d+a,j=c-a;this.drawBrace(b-e,b-a,b,0,a,g,h,j,c,d);this.drawBrace(e,a,0,c,j,h,g,a,0,d);f[Shape.handle]=[[0,a]];d=a*0.293;a+=d;f[Shape.textbox]=[a,d,b-a,c-d];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},LeftBracket:function(a,
b,c,f){var d=this.getCoordinates(a[0],b,c,0.5,"y");if(Shape.selectedHandleNumber==0)a[0]=d/Math.min(b,c);this.drawBracket(b,0,c,c-d,d,0);f[Shape.handle]=[[0,d]];a=zoho.math.toRadians(45);var e=d*Math.sin(a);f[Shape.textbox]=[b-b*Math.cos(a),d-e,b,c+e-d];f[Shape.connector]=[[b,0,90],[0,c*0.5,180],[b,c,270]]},RightBracket:function(a,b,c,f){var d=this.getCoordinates(a[0],b,c,0.5,"y");if(Shape.selectedHandleNumber==0)a[0]=d/Math.min(b,c);this.drawBracket(0,b,0,d,c-d,c);f[Shape.handle]=[[b,d]];a=zoho.math.toRadians(45);
var e=d*Math.sin(a);f[Shape.textbox]=[0,d-e,b*Math.cos(a),c+e-d];f[Shape.connector]=[[0,0,90],[0,c,270],[b,c*0.5,180]]},LeftBrace:function(a,b,c,f){var d=b*0.5,e=this.checkBraceMax(a,b,c);a=e[0];e=e[1];this.drawBrace(b,d,0,c,c-e,a+e,a-e,e,0,a);f[Shape.handle]=[[d,e],[0,a]];d=b*0.5;var g=zoho.math.toRadians(45),h=e*Math.sin(g);f[Shape.textbox]=[b-d*Math.cos(g),e-h,b,c+h-e];f[Shape.connector]=[[b,0,90],[0,a,180],[b,c,270]]},RightBrace:function(a,b,c,f){var d=b*0.5,e=this.checkBraceMax(a,b,c);a=e[0];
e=e[1];this.drawBrace(0,d,b,0,e,a-e,a+e,c-e,c,a);f[Shape.handle]=[[d,e],[b,a]];d=b*0.5;var g=zoho.math.toRadians(45),h=e*Math.sin(g);f[Shape.textbox]=[0,e-h,d*Math.cos(g),c+h-e];f[Shape.connector]=[[0,0,90],[b,a,180],[0,c,270]]},Clock:function(a,b,c,f){var d=midY=c*0.5,e=midX=b*0.5;this.move(0,midY);this.addEllipse(e,d,midX,midY);var g=e*0.03,h=d*0.03;this.move(midX-g,midY);this.addEllipse(g,h,midX,midY,true);g=0.96*e;h=0.96*d;for(var j=30;j<361;){if(j%90==0){rx3=0.84*e;ry3=0.84*d}else{rx3=0.9*e;
ry3=0.9*d}var l=zoho.math.toRadians(j),n=this.getEllipseCoordinates(l,undefined,g,h,midX,midY);l=this.getEllipseCoordinates(l,undefined,rx3,ry3,midX,midY);this.move(n[0],n[1]);this.addLine(l[0],l[1]);j+=30}g=a[0];a=a[1];h=0.6*e;j=0.6*d;d=this.getEllipseCoordinates(g,undefined,0.75*e,0.75*d,midX,midY);e=this.getEllipseCoordinates(a,undefined,h,j,midX,midY);this.move(d[0],d[1]);this.addLine(midX,midY);this.move(e[0],e[1]);this.addLine(midX,midY);f[Shape.handle]=[[d[0],d[1]],[e[0],e[1]]];g=zoho.math.toRadians(225);
a=zoho.math.toRadians(45);n=this.getEllipseCoordinates(g,a,rx3,ry3,midX,midY);f[Shape.textbox]=[n[0],n[1],n[2],n[3]];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},ActionPrevious:function(a,b,c,f){var d=b*0.5;a=c*0.5;var e=this.getCoordinates(0.375,b,c),g=d-e;d+=e;var h=a-e;e=a+e;this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.move(g,a);this.addLine(g,a);this.moveLine(d,h,d,e);this.closePath();this.createNewPath();this.move(g,a);this.addLine(g,a);
this.moveLine(d,h,d,e);this.closePath();this.createNewPath();this.move(g,a);this.addLine(g,a);this.moveLine(d,h,d,e);this.closePath();this.createNewPath();this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.setConnectorAndTextBox(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},ActionNext:function(a,b,c,f){var d=b*0.5;a=c*0.5;var e=this.getCoordinates(0.375,b,c),g=d+e;d-=e;var h=a+e;e=a-e;this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.move(g,
a);this.addLine(g,a);this.moveLine(d,h,d,e);this.closePath();this.createNewPath();this.move(g,a);this.addLine(g,a);this.moveLine(d,h,d,e);this.closePath();this.createNewPath();this.move(g,a);this.addLine(g,a);this.moveLine(d,h,d,e);this.closePath();this.createNewPath();this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.setConnectorAndTextBox(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},ActionBegin:function(a,b,c,f){var d=b*0.5;a=c*0.5;var e=this.getCoordinates(0.375,
b,c),g=a-e,h=a+e,j=d-e;d+=e;var l=this.getCoordinates(0.75,b,c,1);e=j+l*0.125;l=j+l*0.25;this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.move(l,a);this.addLine(d,g);this.moveLine(d,g,d,h);this.closePath();this.move(e,g);this.addLine(e,g);this.moveLine(j,g,j,h,e,h);this.closePath();this.createNewPath();this.move(l,a);this.addLine(d,g);this.moveLine(d,g,d,h);this.closePath();this.move(e,g);this.addLine(e,g);this.moveLine(j,g,j,h,e,h);this.closePath();this.createNewPath();
this.move(l,a);this.addLine(d,g);this.moveLine(d,g,d,h);this.closePath();this.move(e,g);this.addLine(e,g);this.moveLine(j,g,j,h,e,h);this.closePath();this.createNewPath();this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.setConnectorAndTextBox(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},ActionEnd:function(a,b,c,f){var d=b*0.5;a=c*0.5;var e=this.getCoordinates(0.375,b,c),g=a-e,h=a+e,j=d-e;d+=e;var l=this.getCoordinates(0.75,b,c,1);e=j+l*0.75;l=j+l*0.875;this.move(0,
0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.move(e,a);this.addLine(e,a);this.moveLine(j,g,j,h);this.closePath();this.move(l,g);this.addLine(l,g);this.moveLine(d,g,d,h,l,h);this.closePath();this.createNewPath();this.move(e,a);this.addLine(e,a);this.moveLine(j,g,j,h);this.closePath();this.move(l,g);this.addLine(l,g);this.moveLine(d,g,d,h,l,h);this.closePath();this.createNewPath();this.move(e,a);this.addLine(e,a);this.moveLine(j,g,j,h);this.closePath();this.move(l,g);this.addLine(l,
g);this.moveLine(d,g,d,h,l,h);this.closePath();this.createNewPath();this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.setConnectorAndTextBox(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},ActionHome:function(a,b,c,f){a=b*0.5;var d=c*0.5,e=this.getCoordinates(0.375,b,c),g=d-e,h=d+e,j=a-e;e=a+e;var l=this.getCoordinates(0.75,b,c,1),n=g+l*0.0625,o=g+l*0.1875,p=g+l*0.3125,r=g+l*0.75,q=j+l*0.125,s=j+l*0.4375,t=j+l*0.5625,u=j+l*0.6875,v=j+l*0.8125;l=j+l*0.875;this.move(0,
0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.move(a,g);this.addLine(a,g);this.moveLine(j,d,q,d,q,h,l,h,l,d,e,d,v,p,v,n,u,n,u,o);this.closePath();this.createNewPath();this.move(q,d);this.addLine(q,h);this.moveLine(s,h,s,r,t,r,t,h,l,h,l,d);this.closePath();this.move(u,n);this.addLine(v,n);this.moveLine(v,p,u,o);this.closePath();this.createNewPath();this.move(a,g);this.addLine(j,d);this.moveLine(e,d);this.closePath();this.move(s,h);this.addLine(s,r);this.moveLine(t,r,t,h);this.closePath();
this.createNewPath();this.move(a,g);this.addLine(a,g);this.moveLine(j,d,q,d,q,h,l,h,l,d,e,d,v,p,v,n,u,n,u,o);this.closePath();this.move(q,d);this.addLine(q,h);this.moveLine(s,h,s,r,t,r,t,h,l,h,l,d);this.closePath();this.move(u,n);this.addLine(v,n);this.moveLine(v,p,u,o);this.closePath();this.move(a,g);this.addLine(j,d);this.moveLine(e,d);this.closePath();this.move(s,h);this.addLine(s,r);this.moveLine(t,r,t,h);this.closePath();this.createNewPath();this.move(0,0);this.addLine(b,0);this.moveLine(b,c,
0,c);this.closePath();this.setConnectorAndTextBox(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},ActionMovie:function(a,b,c,f){var d=b*0.5;a=c*0.5;var e=this.getCoordinates(0.375,b,c),g=a-e;a=d-e;d+=e;var h=this.getCoordinates(0.75,b,c,1);e=a+h*(1455/21600);var j=a+h*(1905/21600),l=a+h*(2325/21600),n=a+h*(16155/21600),o=a+h*0.7875,p=a+h*(19335/21600),r=a+h*(19725/21600),q=a+h*(20595/21600),s=g+h*(5280/21600),t=g+h*(5730/21600),u=g+h*(6630/21600),v=g+h*(7492/21600),w=g+h*(9067/21600),x=g+h*(9555/
21600),y=g+h*(13342/21600),A=g+h*0.675;g+=h*(15592/21600);this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.move(a,s);this.addLine(a,x);this.moveLine(a,x,e,x,j,w,l,w,l,g,o,g,o,y,p,y);this.moveLine(q,A,d,A,d,A,d,u,q,u,r,v,o,v,o,u,n,t,j,t,e,s);this.createNewPath();this.move(a,s);this.addLine(a,x);this.moveLine(a,x,e,x,j,w,l,w,l,g,o,g,o,y,p,y);this.moveLine(q,A,d,A,d,A,d,u,q,u,r,v,o,v,o,u,n,t,j,t,e,s);this.closePath();this.createNewPath();this.move(0,0);this.addLine(b,0);
this.moveLine(b,c,0,c);this.closePath();this.move(a,s);this.addLine(a,x);this.moveLine(a,x,e,x,j,w,l,w,l,g,o,g,o,y,p,y);this.moveLine(q,A,d,A,d,A,d,u,q,u,r,v,o,v,o,u,n,t,j,t,e,s);this.closePath();this.createNewPath();this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.setConnectorAndTextBox(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},ActionSound:function(a,b,c,f){var d=b*0.5;a=c*0.5;var e=this.getCoordinates(0.375,b,c),g=a-e,h=a+e,j=d-e;d+=e;var l=this.getCoordinates(0.75,b,c,1),n=
l*0.3125;e=g+l*0.125;var o=g+n,p=g+l*0.6875,r=g+l*0.875;n=j+n;var q=j+l*0.625;l=j+l*0.75;this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.move(j,o);this.addLine(j,p);this.moveLine(n,p,q,h,q,g,n,o);this.createNewPath();this.move(j,o);this.addLine(j,p);this.moveLine(n,p,q,h,q,g,n,o);this.closePath();this.createNewPath();this.move(j,o);this.addLine(j,p);this.moveLine(n,p,q,h,q,g,n,o);this.move(j,o);this.addLine(n,o);this.moveLine(q,g,q,h,n,p,j,p);this.closePath();this.move(l,
o);this.addLine(d,e);this.move(l,a);this.moveLine(d,a);this.move(l,p);this.moveLine(d,r);this.closePath();this.createNewPath();this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.setConnectorAndTextBox(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},ActionCustom:function(a,b,c,f){this.Rect(a,b,c,f)},ActionDocument:function(a,b,c,f){var d=b*0.5,e=c*0.5,g=this.getCoordinates(0.375,b,c);a=e-g;e+=g;var h=this.getCoordinates(0.28125,b,c);g=d-h;d+=h;var j=this.getCoordinates(0.1875,
b,c);h=d-j;j=a+j;this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.move(g,a);this.addLine(h,a);this.moveLine(d,j,d,e,g,e);this.closePath();this.createNewPath();this.move(g,a);this.addLine(h,a);this.moveLine(d,j,d,e,g,e);this.closePath();this.move(h,a);this.addLine(h,j);this.moveLine(d,j,h,a);this.closePath();this.createNewPath();this.move(h,a);this.addLine(h,j);this.moveLine(d,j);this.closePath();this.createNewPath();this.move(g,a);this.addLine(h,a);this.moveLine(d,j,d,
e,g,e);this.closePath();this.move(h,a);this.addLine(h,j);this.moveLine(d,j);this.closePath();this.createNewPath();this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.setConnectorAndTextBox(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},ActionInformation:function(a,b,c,f){a=b*0.5;var d=c*0.5,e=this.getCoordinates(0.375,b,c),g=d-e,h=a-e,j=this.getCoordinates(0.75,b,c,1),l=j*0.3125,n=g+j*0.03125,o=g+l,p=g+j*0.375,r=g+j*0.8125;g+=j*0.875;l=h+l;var q=h+j*0.40625,s=h+j*0.59375,
t=h+j*0.6875;j*=0.09375;var u=a-j;this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.move(h,d);this.addEllipse(e,e,a,d);this.createNewPath();this.move(h,d);this.addEllipse(e,e,a,d);this.move(u,n+j);this.addEllipse(j,j,a,n+j);this.move(l,o);this.addLine(l,p);this.moveLine(q,p,q,r,l,r,l,g,t,g,t,r,s,r,s,o);this.closePath();this.createNewPath();this.move(u,n+j);this.addEllipse(j,j,a,n+j);this.move(l,o);this.addLine(l,p);this.moveLine(q,p,q,r,l,r,l,g,t,g,t,r,s,r,s,o);this.closePath();
this.createNewPath();this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.move(h,d);this.addEllipse(e,e,a,d);this.move(u,n+j);this.addEllipse(j,j,a,n+j);this.move(l,o);this.addLine(l,p);this.moveLine(q,p,q,r,l,r,l,g,t,g,t,r,s,r,s,o);this.closePath();this.createNewPath();this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.setConnectorAndTextBox(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},ActionHelp:function(a,b,c,f){a=b*0.5;var d=c*0.5,e=this.getCoordinates(0.375,
b,c),g=d-e,h=a-e,j=this.getCoordinates(0.75,b,c,1);e=j*(1/7);var l=j*(3/14);d=j*(2/7);var n=g+d,o=g+j*(17/28),p=g+j*0.75,r=g+j*(11/14);g=h+l;var q=h+j*(3/7);h+=j*(4/7);var s=j*(1/14);j*=3/28;var t=j+r,u=a-j;r+=j;var v=this.computeEllipticCoords(d,d,g,n,180,180),w=this.computeEllipticCoords(e,l,v[0],v[1],0,90),x=this.computeEllipticCoords(s,j,w[0],w[1],270,270);l=this.computeEllipticCoords(e,l,q,o,180,90);s=this.computeEllipticCoords(s,j,l[0],l[1],90,270);var y=this.computeEllipticCoords(e,e,s[0],
s[1],0,180);this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.move(g,n);this.addXEllipseCurve(d,d,g,v[0],n);this.addYCurve(v[0],v[1],w[0],w[1]);this.addYCurve(w[0],w[1],x[0],x[1],true);this.move(h,o);this.addLine(h,p);this.moveLine(q,p,q,o);this.addYCurve(q,o,l[0],l[1]);this.addYCurve(l[0],l[1],s[0],s[1],true);this.addXEllipseCurve(e,e,s[0],y[0],s[1],true);this.addLine(g,n);this.move(u,r);this.addEllipse(j,j,a,t);this.createNewPath();this.move(g,n);this.addXEllipseCurve(d,
d,g,v[0],n);this.addYCurve(v[0],v[1],w[0],w[1]);this.addYCurve(w[0],w[1],x[0],x[1],true);this.move(h,o);this.addLine(h,p);this.moveLine(q,p,q,o);this.addYCurve(q,o,l[0],l[1]);this.addYCurve(l[0],l[1],s[0],s[1],true);this.addXEllipseCurve(e,e,s[0],y[0],s[1],true);this.addLine(g,n);this.move(u,r);this.addEllipse(j,j,a,t);this.createNewPath();this.move(g,n);this.addXEllipseCurve(d,d,g,v[0],n);this.addYCurve(v[0],v[1],w[0],w[1]);this.addYCurve(w[0],w[1],x[0],x[1],true);this.move(h,o);this.addLine(h,p);
this.moveLine(q,p,q,o);this.addYCurve(q,o,l[0],l[1]);this.addYCurve(l[0],l[1],s[0],s[1],true);this.addXEllipseCurve(e,e,s[0],y[0],s[1],true);this.addLine(g,n);this.move(u,r);this.addEllipse(j,j,a,t);this.createNewPath();this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.setConnectorAndTextBox(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},ActionReturn:function(a,b,c,f){a=b*0.5;var d=c*0.5,e=this.getCoordinates(0.375,b,c),g=d-e;d+=e;var h=a-e;e=a+e;var j=this.getCoordinates(0.75,
b,c,1),l=j*0.75,n=j*0.625,o=j*0.375,p=j*0.25,r=g+l,q=g+n,s=g+p,t=h+j*0.875;l=h+l;n=h+n;var u=h+o;p=h+p;var v=j*0.125;j=this.computeEllipticCoords(v,v,n,q,0,90);v=this.computeEllipticCoords(v,v,u,r,90,90);var w=this.computeEllipticCoords(o,o,h,q,180,270);o=this.computeEllipticCoords(o,o,a,d,90,270);this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.move(e,s);this.addLine(l,g);this.moveLine(a,s,n,s,n,q);this.addYCurve(n,q,j[0],j[1]);this.addLine(u,r);this.addXCurve(u,r,v[0],
v[1]);this.addLine(p,s);this.moveLine(h,s,h,q);this.addXCurve(h,q,w[0],w[1],true);this.addLine(a,d);this.addYCurve(a,d,o[0],o[1],true);this.addLine(t,s);this.moveLine(e,s);this.createNewPath();this.move(e,s);this.addLine(l,g);this.moveLine(a,s,n,s,n,q);this.addYCurve(n,q,j[0],j[1]);this.addLine(u,r);this.addXCurve(u,r,v[0],v[1]);this.addLine(p,s);this.moveLine(h,s,h,q);this.addXCurve(h,q,w[0],w[1],true);this.addLine(a,d);this.addYCurve(a,d,o[0],o[1],true);this.addLine(t,s);this.moveLine(e,s);this.createNewPath();
this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.move(e,s);this.addLine(l,g);this.moveLine(a,s,n,s,n,q);this.addYCurve(n,q,j[0],j[1]);this.addLine(u,r);this.addXCurve(u,r,v[0],v[1]);this.addLine(p,s);this.moveLine(h,s,h,q);this.addXCurve(h,q,w[0],w[1],true);this.addLine(a,d);this.addYCurve(a,d,o[0],o[1],true);this.addLine(t,s);this.moveLine(e,s);this.closePath();this.createNewPath();this.move(0,0);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();this.setConnectorAndTextBox(m.ShapeConstants.PresetShapeGeometry.RECT,
b,c,f)},RightArrow:function(a,b,c,f){var d=(c-a[0]*c)*0.5;a=this.getCoordinates(a[1],b,c,1,"x");var e=b-a,g=c-d,h=c*0.5;this.drawArrow(0,e,b,0,d,g,c,h);f[Shape.handle]=[[0,d],[e,0]];f[Shape.textbox]=[0,d,e+d*a/h,g];f[Shape.connector]=[[e,0,270],[0,h,180],[e,c,90],[b,h,0]]},LeftArrow:function(a,b,c,f){var d=(c-a[0]*c)*0.5;a=this.getCoordinates(a[1],b,c,1,"x");var e=c-d,g=c*0.5;this.drawArrow(b,a,0,c,e,d,0,g);f[Shape.handle]=[[b,d],[a,0]];f[Shape.textbox]=[a-d*a/g,d,b,e];f[Shape.connector]=[[a,0,270],
[0,g,180],[a,c,90],[b,g,0]]},UpArrow:function(a,b,c,f){var d=(b-a[0]*b)*0.5;a=this.getCoordinates(a[1],b,c,1,"y");var e=b-d,g=b*0.5;this.drawVerticalArrow(0,a,c,0,d,e,b,g);f[Shape.handle]=[[d,c],[0,a]];f[Shape.textbox]=[d,a-d*a/g,e,c];f[Shape.connector]=[[g,0,270],[0,a,180],[g,c,90],[b,a,0]]},DownArrow:function(a,b,c,f){var d=(b-a[0]*b)*0.5;a=this.getCoordinates(a[1],b,c,1,"y");var e=c-a,g=b-d,h=b*0.5;this.drawVerticalArrow(c,e,0,b,g,d,0,h);f[Shape.handle]=[[d,0],[0,e]];f[Shape.textbox]=[d,0,g,e+
d*a/c];f[Shape.connector]=[[h,0,270],[0,e,180],[h,c,90],[b,e,0]]},LeftRightArrow:function(a,b,c,f){var d=(c-a[0]*c)*0.5;a=this.getCoordinates(a[1],b,c,0.5,"x");var e=b-a,g=c-d,h=c*0.5;this.move(e,d);this.addLine(e,0);this.moveLine(b,h,e,c,e,g,a,g,a,c,0,h,a,0,a,d);this.closePath();f[Shape.handle]=[[e,d],[a,0]];var j=d*a/h,l=b*0.5;f[Shape.textbox]=[a-j,d,e+j,g];f[Shape.connector]=[[b,h,0],[e,c,90],[l,g,90],[a,c,90],[0,h,180],[a,0,270],[e,0,270],[l,d,270]]},UpDownArrow:function(a,b,c,f){var d=(b-a[0]*
b)*0.5;a=this.getCoordinates(a[1],b,c,0.5,"y");var e=c-a,g=b-d,h=b*0.5;this.move(d,a);this.addLine(d,e);this.moveLine(0,e,h,c,b,e,g,e,g,a,b,a,h,0,0,a);this.closePath();f[Shape.handle]=[[d,e],[0,a]];var j=d*a/h,l=c*0.5;f[Shape.textbox]=[d,a-j,g,e+j];f[Shape.connector]=[[h,0,270],[0,e,180],[d,l,180],[0,a,180],[h,c,90],[b,e,0],[g,l,0],[b,a,0]]},QuadArrow:function(a,b,c,f){var d=b*0.5,e=c*0.5,g=this.modifier.QuadArrow.call(this,a,b,c),h=d-g[0],j=d-g[1],l=d+g[1],n=d+g[0],o=e-g[0];a=e-g[1];var p=e+g[1],
r=e+g[0],q=g[2],s=b-q,t=c-q;this.move(h,q);this.addLine(d,0);this.moveLine(n,q,l,q,l,a,s,a,s,o,b,e);this.moveLine(s,r,s,p,l,p,l,t,n,t,d,c);this.moveLine(h,t,j,t,j,p,q,p,q,r,0,e);this.moveLine(q,o,q,a,j,a,j,q);this.closePath();f[Shape.handle]=[[j,q],[h,0],[b,q]];d=g[1]*g[2]/g[0];f[Shape.textbox]=[d,a,b-d,p];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},LeftRightUpArrow:function(a,b,c,f){var d=b*0.5,e=this.modifier.LeftRightUpArrow.call(this,a,b,c),g=d-e[0],h=d-e[1],j=d+e[1],l=
d+e[0];a=c-e[0];var n=a+e[1],o=c-2*e[0],p=a-e[1],r=e[2],q=b-r;this.move(g,r);this.addLine(d,0);this.moveLine(l,r,j,r,j,p,q,p,q,o,b,a);this.moveLine(q,c,q,n,r,n,r,c,0,a);this.moveLine(r,o,r,p,h,p,h,r);this.closePath();f[Shape.handle]=[[h,r],[g,0],[b,r]];c=e[1]*r/e[0];f[Shape.textbox]=[c,p,b-c,n];f[Shape.connector]=[[d,0,270],[0,a,180],[d,n,90],[b,a,0]]},BentArrow:function(a,b,c,f){var d=this.modifier.BentArrow.call(this,a,b,c);a=d[0];var e=d[1],g=d[3],h=e-a*0.5,j=a*0.5,l=Math.max(g-a,0),n=a+l;d=b-
d[2];var o=h+a,p=o+h,r=h+g;this.move(0,c);this.addLine(0,r);this.addYCurve(0,r,r-h,h);this.addLine(d,h);this.moveLine(d,0,b,e,d,p,d,o,n,o);this.addYCurve(n,o,n-l,o+l,true);this.addLine(a,c);this.closePath();f[Shape.textbox]=[0,0,b,c];f[Shape.handle]=[[a,c],[b,p],[d,0],[g,0]];f[Shape.connector]=[[d,0,270],[d,p,90],[j,c,90],[b,e,0]]},UTurnArrow:function(a,b,c,f){var d=this.modifier.UTurnArrow.call(this,a,b,c);a=d[0];var e=d[1],g=d[3],h=d[4];d=h-d[2];var j=(e*2-a)*0.5,l=b-j,n=l-g,o=b-e;e=o-e;j=e+j;this.move(0,
c);this.addLine(0,g);this.addYCurve(0,g,g,0);this.addLine(n,0);this.addXCurve(n,0,l,g);this.addLine(l,d);this.moveLine(b,d,o,h,e,d,j,d);if(g>a){this.moveLine(j,g);this.addXCurve(j,g,n,a,true);this.addLine(g,a);this.addYCurve(g,a,a,g,true);this.addLine(a,c)}else this.moveLine(j,a,a,a,a,c);this.closePath();f[Shape.handle]=[[a,c],[e,c],[e,d],[g,0],[b,h]];f[Shape.textbox]=[0,0,b,c];f[Shape.connector]=[[b,d,0],[o,h,90],[e,d,90],[a*0.5,c,90],[(a+j)*0.5,0,270]]},LeftUpArrow:function(a,b,c,f){var d=this.modifier.LeftUpArrow.call(this,
a,b,c);a=d[0];var e=d[1];d=d[2];a*=0.5;var g=b-e,h=b-e*2,j=e-a,l=b-j,n=c-j,o=c-e,p=c-e*2,r=p+j;j=h+j;this.move(h,d);this.addLine(g,0);this.moveLine(b,d,l,d,l,n,d,n,d,c,0,o,d,p,d,r,j,r,j,d);this.closePath();f[Shape.handle]=[[j,d],[h,0],[b,d]];f[Shape.connector]=[[g,0,270],[b,d,0],[l,(d+n)*0.5,0],[(l+d)*0.5,n,90],[d,c,90],[0,o,180],[d,p,270],[j,d,180]];f[Shape.textbox]=[e*2*l/a,r,g,n]},BentUpArrow:function(a,b,c,f){a=this.modifier.BentUpArrow.call(this,a,b,c);var d=a[0],e=a[1];a=a[2];var g=2*e,h=(g-
d)*0.5;d=c-d;g=b-g;var j=g+h;e=g+e;h=b-h;this.move(0,d);this.addLine(0,c);this.moveLine(h,c,h,a,b,a,e,0,g,a,j,a,j,d);this.closePath();f[Shape.handle]=[[0,d],[g,0],[b,a]];f[Shape.connector]=[[b,a,0],[h,(a+c)*0.5,0],[h*0.5,c,90],[0,(d+c)*0.5,180],[g,a,180],[e,0,270]];f[Shape.textbox]=[0,d,h,c]},CurvedRightArrow:function(a,b,c,f){var d=this.modifier.CurvedRightArrow.call(this,a,b,c);a=d[0];var e=d[1],g=d[2],h=d[3],j=h+a,l=Math.sqrt(b*b-g*g),n=b?l*h/b:0;l=h+n;n=j+n;var o=(e-a)*0.5,p=l-o;o=n+o;e=c-e*0.5;
g=b-g;var r=(h+j)*0.5;d=b-d[4];var q=j-h;this.move(0,h);this.addEllipseCurve(b,h,0,h,g,l,true);this.addLine(g,p);this.moveLine(b,e,g,o,g,n);this.addEllipseCurve(b,h,g,n,0,j,false,false,0,q);this.closePath();this.createNewPath();this.move(b,a);this.addEllipseCurve(b,h,b,a,d,r,true,false,0,q);this.addEllipseCurve(b,h,d,r,b,0);this.closePath();this.createNewPath();this.move(0,h);this.addEllipseCurve(b,h,0,h,g,l,true);this.addLine(g,p);this.moveLine(b,e,g,o,g,n);this.addEllipseCurve(b,h,g,n,0,j,false,
false,0,q);this.addLine(0,h);this.addEllipseCurve(b,h,0,h,b,0);this.addLine(b,a);this.addEllipseCurve(b,h,b,a,d,r,true,false,0,q);f[Shape.handle]=[[g,l],[b,p],[g,c]];f[Shape.textbox]=[0,0,b,c];f[Shape.connector]=[[0,r,180],[g,c,90],[b,e,0],[g,p,0],[b,a*0.5,0]]},CurvedLeftArrow:function(a,b,c,f){var d=this.modifier.CurvedLeftArrow.call(this,a,b,c);a=d[0];var e=d[1],g=d[2],h=d[3];d=d[4];var j=h+a,l=Math.sqrt(b*b-g*g),n=b?l*h/b:0;l=h+n;n=j+n;var o=(e-a)*0.5,p=l-o;o=n+o;e=c-e*0.5;var r=(h+j)*0.5,q=0-
b;this.move(0,e);this.addLine(g,p);this.moveLine(g,l);this.addEllipseCurve(b,h,g,l,d,r,true,false,q);this.addEllipseCurve(b,h,d,r,g,n,false,false,q,a);this.addLine(g,o);this.closePath();this.createNewPath();this.move(b,j);this.addEllipseCurve(b,h,b,j,0,a,true,false,q,a);this.addLine(0,0);this.addEllipseCurve(b,h,0,0,b,h,false,false,q);this.closePath();this.createNewPath();this.move(b,j);this.addEllipseCurve(b,h,b,j,0,a,true,false,q,a);this.addLine(0,0);this.addEllipseCurve(b,h,0,0,b,h,false,false,
q);this.addLine(b,j);this.addEllipseCurve(b,h,b,j,g,n,false,false,q,a);this.addLine(g,o);this.moveLine(0,e,g,p,g,l);this.addEllipseCurve(b,h,g,l,d,r,true,false,q);f[Shape.handle]=[[g,l],[0,p],[g,c]];f[Shape.textbox]=[0,0,b,c];f[Shape.connector]=[[0,a*0.5,180],[g,p,180],[0,e,120],[g,o,90],[b,r,0]]},CurvedUpArrow:function(a,b,c,f){var d=this.modifier.CurvedUpArrow.call(this,a,b,c);a=d[0];var e=d[1],g=d[2],h=d[3];d=d[4];var j=h+a,l=Math.sqrt(c*c-g*g),n=c?l*h/c:0;l=h+n;n=j+n;var o=(e-a)*0.5,p=l-o;o=n+
o;e=b-e*0.5;var r=(h+j)*0.5,q=0-c;this.move(e,0);this.addLine(o,g);this.moveLine(n,g);this.addEllipseCurve(h,c,n,g,r,d,false,false,a,q);this.addEllipseCurve(h,c,r,d,l,g,true,false,0,q);this.addLine(p,g);this.closePath();this.createNewPath();this.move(h,c);this.addEllipseCurve(h,c,h,c,0,0,false,false,0,q);this.addLine(a,0);this.addEllipseCurve(h,c,a,0,j,c,true,false,a,q);this.closePath();this.createNewPath();this.move(r,d);this.addEllipseCurve(h,c,r,d,l,g,true,false,0,q);this.addLine(p,g);this.moveLine(e,
0,o,g,n,g);this.addEllipseCurve(h,c,n,g,j,c,false,false,a,q);this.addLine(h,c);this.addEllipseCurve(h,c,h,c,0,0,false,false,0,q);this.addLine(a,0);this.addEllipseCurve(h,c,a,0,j,c,true,false,a,q);f[Shape.handle]=[[l,g],[p,0],[b,g]];f[Shape.textbox]=[0,0,b,c];f[Shape.connector]=[[e,0,270],[p,g,270],[a*0.5,0,270],[r,c,90],[o,g,0]]},CurvedDownArrow:function(a,b,c,f){var d=this.modifier.CurvedUpArrow.call(this,a,b,c);a=d[0];var e=d[1],g=d[2],h=d[3],j=h+a,l=Math.sqrt(c*c-g*g),n=c?l*h/c:0;l=h+n;n=j+n;var o=
(e-a)*0.5,p=l-o;o=n+o;e=b-e*0.5;g=c-g;d=c-d[4];var r=(h+j)*0.5;this.move(e,c);this.addLine(p,g);this.moveLine(l,g);this.addEllipseCurve(h,c,l,g,h,0,true);this.addLine(j,0);this.addEllipseCurve(h,c,j,0,n,g,false,false,a);this.addLine(o,g);this.closePath();this.createNewPath();this.move(0,c);this.addEllipseCurve(h,c,0,c,r,d);this.addEllipseCurve(h,c,r,d,a,c,true,false,a);this.closePath();this.createNewPath();this.move(r,d);this.addEllipseCurve(h,c,r,d,a,c,true,false,a);this.addLine(0,c);this.addEllipseCurve(h,
c,0,c,h,0);this.addLine(j,0);this.addEllipseCurve(h,c,j,0,n,g,false,false,a);this.addLine(o,g);this.moveLine(e,c,p,g,l,g);this.addEllipseCurve(h,c,l,g,h,0,true);f[Shape.handle]=[[l,g],[p,c],[b,g]];f[Shape.textbox]=[0,0,b,c];f[Shape.connector]=[[r,0,270],[a*0.5,c,90],[p,g,90],[e,c,90],[o,g,0]]},StripedRightArrow:function(a,b,c,f){var d=this.getCoordinates(a[1],b,c,0.84375,"x"),e=b-d;a=(c-a[0]*c)*0.5;var g=this.getCoordinates(0.03125,b,c),h=this.getCoordinates(0.0625,b,c),j=this.getCoordinates(0.125,
b,c),l=this.getCoordinates(0.15625,b,c),n=c*0.5,o=c-a;this.move(e,a);this.addLine(e,0);this.moveLine(b,n,e,c,e,o,l,o,l,a);this.closePath();this.move(0,a);this.addLine(g,a);this.moveLine(g,o,0,o);this.closePath();this.move(h,a);this.addLine(j,a);this.moveLine(j,o,h,o);this.closePath();f[Shape.handle]=[[0,a],[e,0]];f[Shape.textbox]=[l,a,b-(n-a)*d/n,o];f[Shape.connector]=[[e,0,270],[0,n,180],[e,c,90],[b,n,0]]},NotchedRightArrow:function(a,b,c,f){var d=c*0.5,e=this.getCoordinates(a[1],b,c,1,"x");a=a[0]*
c*0.5;var g=c-a,h=b-e,j=d?e-a/d*e:e;this.move(h,a);this.addLine(h,0);this.moveLine(b,d,h,c,h,g,0,g,j,d,0,a);this.closePath();f[Shape.handle]=[[b,a],[h,0]];e=d?(d-a)*e/d:0;f[Shape.textbox]=[e,a,b-e,g];f[Shape.connector]=[[h,0,270],[j,d,180],[h,c,90],[b,d,0]]},PentagonArrow:function(a,b,c,f){a=b-this.getCoordinates(a[0],b,c,1,"x");var d=c*0.5;this.move(a,0);this.addLine(b,d);this.moveLine(a,c,0,c,0,0);this.closePath();f[Shape.handle]=[[a,0]];var e=a*0.5;f[Shape.textbox]=[0,0,(a+b)*0.5,c];f[Shape.connector]=
[[e,0,270],[0,d,180],[e,c,90],[b,d,0]]},Chevron:function(a,b,c,f){a=this.getCoordinates(a[0],b,c,1,"x");var d=b-a,e=c*0.5;this.move(d,0);this.addLine(b,e);this.moveLine(d,c,0,c,a,e,0,0);this.closePath();f[Shape.handle]=[[d,0]];var g=d-a,h=zoho.math.ifElse(g,a,0);g=zoho.math.ifElse(g,d,b);d*=0.5;f[Shape.textbox]=[h,0,g,c];f[Shape.connector]=[[d,0,270],[a,e,180],[d,c,90],[b,e,0]]},RightArrowCallout:function(a,b,c,f){var d=this.modifier.RightArrowCallout.call(this,a,b,c);a=d[0];var e=d[1],g=d[2],h=d[3],
j=d[4],l=d[5];d=c*0.5;this.move(a,c);this.addLine(a,j);this.moveLine(e,j,e,l,b,d,e,g,e,h,a,h,a,0,0,0,0,c);this.closePath();f[Shape.handle]=[[e,h],[b,g],[e,0],[a,c]];e=a*0.5;f[Shape.textbox]=[0,0,a,c];f[Shape.connector]=[[e,0,270],[0,d,180],[e,c,90],[b,d,0]]},DownArrowCallout:function(a,b,c,f){var d=this.modifier.DownArrowCallout.call(this,a,b,c);a=d[0];var e=d[1],g=d[2],h=d[3],j=d[4],l=d[5];d=b*0.5;this.move(0,a);this.addLine(h,a);this.moveLine(h,e,g,e,d,c,l,e,j,e,j,a,b,a,b,0,0,0);this.closePath();
f[Shape.handle]=[[h,e],[g,c],[b,e],[0,a]];e=a*0.5;f[Shape.textbox]=[0,0,b,a];f[Shape.connector]=[[d,0,270],[0,e,180],[d,c,90],[b,e,0]]},LeftArrowCallout:function(a,b,c,f){var d=this.modifier.LeftArrowCallout.call(this,a,b,c);a=d[0];var e=d[1],g=d[2],h=d[3],j=d[4],l=d[5];d=c*0.5;this.move(a,c);this.addLine(a,j);this.moveLine(e,j,e,l,0,d,e,g,e,h,a,h,a,0,b,0,b,c);this.closePath();f[Shape.handle]=[[e,h],[0,g],[e,0],[a,c]];e=(a+b)*0.5;f[Shape.textbox]=[a,0,b,c];f[Shape.connector]=[[e,0,270],[0,d,180],
[e,c,90],[b,d,0]]},UpArrowCallout:function(a,b,c,f){var d=this.modifier.UpArrowCallout.call(this,a,b,c);a=d[0];var e=d[1],g=d[2],h=d[3],j=d[4];d=d[5];var l=b*0.5;this.move(0,a);this.addLine(h,a);this.moveLine(h,e,g,e,l,0,d,e,j,e,j,e,j,a,b,a,b,c,0,c);this.closePath();f[Shape.handle]=[[h,e],[g,0],[b,e],[0,a]];f[Shape.textbox]=[0,a,b,c];f[Shape.connector]=[[l,0,270],[0,a,180],[l,c,90],[b,a,0]]},LeftRightArrowCallout:function(a,b,c,f){var d=this.modifier.LeftRightArrowCallout.call(this,a,b,c);a=d[0]*
0.5;var e=d[1],g=d[2],h=d[3],j=d[4];d=d[5];var l=b-a,n=b-e,o=c*0.5;this.move(a,c);this.addLine(a,j);this.moveLine(e,j,e,d,0,o,e,g,e,h,a,h,a,0,l,0,l,h,n,h,n,g,b,o,n,d,n,j,l,j,l,c);this.closePath();f[Shape.handle]=[[e,h],[0,g],[e,0],[a,c]];f[Shape.textbox]=[a,0,l,c];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},QuadArrowCallout:function(a,b,c,f){var d=b*0.5,e=c*0.5,g=this.modifier.QuadArrowCallout.call(this,a,b,c);a=d-g[0];var h=d-g[1],j=d+g[1],l=d+g[0],n=e-g[0],o=e-g[1],p=e+g[1],
r=e+g[0],q=g[2],s=b-q,t=c-q,u=d-g[3],v=d+g[3],w=e-g[3];g=e+g[3];this.move(a,q);this.addLine(d,0);this.moveLine(l,q,j,q,j,w,v,w,v,o,s,o,s,n,b,e);this.moveLine(s,r,s,p,v,p,v,g,j,g,j,t,l,t,d,c);this.moveLine(a,t,h,t,h,g,u,g,u,p,q,p,q,r,0,e);this.moveLine(q,n,q,o,u,o,u,w,h,w,h,q);this.closePath();f[Shape.handle]=[[h,q],[a,0],[b,q],[0,w]];f[Shape.textbox]=[u,w,v,g];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},CircularArrow:function(){},Plus:function(a,b,c,f){var d=b*0.5,e=c*0.5,
g=b*0.36745,h=c*0.36745,j=this.getCoordinates(a[0],b,c,0.7349);j*=0.5;a=d-j;b=d+j;c=e-j;j=e+j;var l=d-g;g=d+g;var n=e-h;h=e+h;this.move(a,n);this.addLine(b,n);this.moveLine(b,c,g,c,g,j,b,j,b,h,a,h,a,j,l,j,l,c,a,c);this.closePath();f[Shape.handle]=[[0,c]];f[Shape.textbox]=[l,c,g,j];f[Shape.connector]=[[g,e,0],[d,h,90],[l,e,180],[d,n,270]]},Minus:function(a,b,c,f){var d=c*0.5,e=b*0.5;a=a[0]*c;a*=0.5;c=0.36745*b;b=e-c;c=e+c;var g=d-a;a=d+a;this.move(b,g);this.addLine(c,g);this.moveLine(c,a,b,a);this.closePath();
f[Shape.handle]=[[0,g]];f[Shape.textbox]=[b,g,c,a];f[Shape.connector]=[[c,d,0],[e,a,90],[b,d,180],[e,g,270]]},Multiply:function(a,b,c,f){var d=b*0.5,e=c*0.5;a=this.getCoordinates(a[0],b,c,0.51965);var g=Math.atan2(c,b),h=Math.sin(g),j=Math.cos(g),l=Math.tan(g);g=Math.sqrt(Math.pow(b,2)+Math.pow(c,2));var n=g-g*0.51965;g=j*(n/2);n=h*(n/2);var o=h*(a/2),p=j*(a/2);j=g-o;h=n+p;g+=o;n-=p;o=(d-g)*l+n;p=b-g;b-=j;l=(e-h)/l;var r=b-l,q=j+l,s=c-h;l=c-n;c-=o;this.move(j,h);this.addLine(g,n);this.moveLine(d,
o,p,n,b,h,r,e,b,s,p,l,d,c,g,l,j,s,q,e);this.closePath();f[Shape.handle]=[[0,a]];d=(b+p)*0.5;e=(s+l)*0.5;c=(g+j)*0.5;a=(h+n)*0.5;f[Shape.textbox]=[j,n,b,l];f[Shape.connector]=[[c,a,180],[d,a,270],[d,e,0],[c,e,90]]},Divide:function(a,b,c,f){var d=this.modifier.Divide.call(this,a,b,c),e=d[0]*c*0.5;a=d[2]*c;var g=b*0.36745,h=b*0.5,j=c*0.5,l=j-e;e=j+e;d=d[1]*c+a;d=l-d;var n=d-a;c-=n;var o=h-g;g=h+g;var p=h-a;this.move(h-a,n);this.addEllipse(a,a,h,n);this.move(h-a,c);this.addEllipse(a,a,h,c);this.move(o,
l);this.addLine(g,l);this.moveLine(g,e,o,e);this.closePath();f[Shape.handle]=[[0,l],[b,d],[p,0]];f[Shape.connector]=[[g,j,0],[h,c,90],[o,j,180],[h,n,270]];f[Shape.textbox]=[o,l,g,e]},Equal:function(a,b,c,f){var d=b*0.5,e=c*0.5;a=this.modifier.Equal.call(this,a,b,c);var g=a[0],h=a[1];c=0.36745*b;a=d-c;c=d+c;var j=e-h;h=e+h;e=j-g;g=h+g;this.move(a,e);this.addLine(c,e);this.moveLine(c,j,a,j);this.closePath();this.move(a,h);this.addLine(c,h);this.moveLine(c,g,a,g);this.closePath();f[Shape.handle]=[[0,
e],[b,j]];b=(e+j)*0.5;j=(h+g)*0.5;f[Shape.textbox]=[a,e,c,g];f[Shape.connector]=[[c,b,0],[c,j,0],[d,g,90],[a,b,180],[a,j,180],[d,e,270]]},NotEqual:function(a,b,c,f){var d=b*0.5,e=c*0.5,g=this.modifier.NotEqual.call(this,a,b,c),h=g[0],j=g[1],l=0.36745*b;g=d-l;l=d+l;var n=e-j,o=e+j;j=n-h;var p=o+h;a=a[1];var r=a-zoho.math.toRadians(90),q=e*Math.tan(r),s=Math.sqrt(Math.pow(q,2)+Math.pow(e,2)),t=e?s*h/e:0,u=d+q-t*0.5,v=u-(e?q*j/e:0),w=u-(e?q*n/e:0),x=u-(e?q*o/e:0),y=u-(e?q*p/e:0),A=u+t,E=v+t,D=w+t,C=
x+t;t=y+t;var F=s?h*e/s:0;e=r>0?u+F:A;u=r>0?u:A-F;q=s?h*q/s:0;h=r>0?q:0;r=r>0?0:0-q;q=b-e;s=b-u;A=c-h;F=c-r;this.move(g,j);this.addLine(v,j);this.moveLine(u,r,e,h,E,j,l,j,l,n,D,n,C,o,l,o,l,p,t,p,s,F,q,A,y,p,g,p,g,o,x,o,w,n,g,n);this.closePath();d+=(90-zoho.math.toDegrees(a))/80*E;f[Shape.handle]=[[0,j],[d,c],[b,n]];b=(o+p)*0.5;c=(j+n)*0.5;f[Shape.textbox]=[g,j,l,p];f[Shape.connector]=[[l,b,0],[l,c,0],[(s+q)*0.5,(F+A)*0.5,90],[g,b,180],[g,c,180],[(u+e)*0.5,(r+h)*0.5,270]]},Process:function(a,b,c,f){this.Rect(a,
b,c,f)},AlternateProcess:function(a,b,c,f){this.RoundRect([1/6],b,c,{});a=this.getCoordinates(1/6,b,c)*0.293;f[Shape.textbox]=[a,a,b-a,c-a];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},Decision:function(a,b,c,f){this.Diamond(a,b,c,f)},Data:function(a,b,c,f){a=0.2*b;var d=0.8*b;this.move(a,0);this.addLine(b,0);this.moveLine(d,c,0,c);this.closePath();var e=c*0.5,g=b*0.5;f[Shape.textbox]=[a,0,d,c];f[Shape.connector]=[[g,0,270],[0.6*b,0,270],[0.1*b,e,180],[0.4*b,c,90],[g,c,90],
[0.9*b,e,0]]},PredefinedProcess:function(a,b,c,f){this.Rect(a,b,c);this.closePath();a=0.125*b;var d=b-a;this.move(a,0);this.addLine(a,c);this.move(d,0);this.addLine(d,c);this.closePath();f[Shape.textbox]=[a,0,d,c];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},InternalStorage:function(a,b,c,f){this.Rect(a,b,c);this.closePath();a=0.125*b;var d=0.125*c;this.move(a,0);this.addLine(a,c);this.move(0,d);this.addLine(b,d);this.closePath();f[Shape.textbox]=[a,d,b,c];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,
b,c,f)},FlowchartDocument:function(a,b,c,f){a=b*0.5;var d=0.802*c;this.move(0,0);this.addLine(b,0);this.moveLine(b,d);this.addCubicCurve(a,d,a,1.1075*c,0,0.934*c);this.closePath();var e=c*0.5;f[Shape.textbox]=[0,0,b,d];f[Shape.connector]=[[a,0,270],[0,e,180],[a,0.933*c,90],[b,e,0]]},MultiDocument:function(a,b,c,f){a=9298/21600*b;var d=18595/21600*b,e=1532/21600*b,g=2E4/21600*b,h=19298/21600*b,j=2972/21600*b,l=20800/21600*b,n=20782/21600*c,o=23542/21600*c,p=18022/21600*c,r=3675/21600*c,q=1815/21600*
c,s=16252/21600*c,t=16352/21600*c,u=14392/21600*c,v=14467/21600*c;this.move(0,n);this.addCubicCurve(a,o,a,p,d,p);this.addLine(d,r);this.moveLine(0,r);this.closePath();this.move(e,r);this.addLine(e,q);this.moveLine(g,q,g,s);this.addCubicCurve(h,s,d,t,d,t);this.addLine(d,r);this.closePath();this.move(j,q);this.addLine(j,0);this.moveLine(b,0,b,u);this.addCubicCurve(l,u,g,v,g,v);this.addLine(g,q);this.closePath();e=c*0.5;f[Shape.textbox]=[0,r,d,n];f[Shape.connector]=[[12286/21600*c,0,270],[0,e,180],[a,
n,90],[b,e,0]]},Terminator:function(a,b,c,f){a=3475/21600*b;var d=18125/21600*b,e=c*0.5;this.move(a,0);this.addLine(d,0);this.addYEllipseCurve(a,e,0,c,d);this.addLine(a,c);this.addYEllipseCurve(a,e,c,0,a);this.closePath();f[Shape.textbox]=[1018/21600*b,3163/21600*c,20582/21600*b,18437/21600*c];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},Preparation:function(a,b,c,f){a=0.2*b;var d=b-a,e=c*0.5;this.move(a,0);this.addLine(d,0);this.moveLine(b,e,d,c,a,c,0,e);this.closePath();f[Shape.textbox]=
[a,0,d,c];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},ManualInput:function(a,b,c,f){a=0.2*c;this.move(0,a);this.addLine(b,0);this.moveLine(b,c,0,c);this.closePath();var d=b*0.5,e=c*0.5;f[Shape.textbox]=[0,a,b,c];f[Shape.connector]=[[d,0.1*c,270],[0,e,180],[d,c,90],[b,e,0]]},ManualOperation:function(a,b,c,f){a=0.2*b;var d=b-a;this.move(0,0);this.addLine(a,c);this.moveLine(d,c,b,0);this.closePath();var e=c*0.5,g=b*0.5;f[Shape.textbox]=[a,0,d,c];f[Shape.connector]=[[g,0,270],
[0.1*b,e,180],[g,c,90],[0.9*b,e,0]]},FlowchartConnector:function(a,b,c,f){this.Oval(a,b,c,f)},OffpageConnector:function(a,b,c,f){a=0.8*c;var d=b*0.5;this.move(0,0);this.addLine(0,a);this.moveLine(d,c,b,a,b,0);this.closePath();f[Shape.textbox]=[0,0,b,a];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},PunchedCard:function(a,b,c,f){a=0.2*c;this.move(0.2*b,0);this.addLine(0,a);this.moveLine(0,c,b,c,b,0);this.closePath();f[Shape.textbox]=[0,a,b,c];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,
b,c,f)},PunchedTape:function(a,b,c,f){a=0.1*c;var d=c-a,e=b*0.5,g=c*0.5,h=b*0.25;this.move(0,a);this.addXEllipseCurve(h,a,0,e,a,true);this.addXEllipseCurve(h,a,e,b,a);this.addLine(b,d);this.addXEllipseCurve(h,a,b,e,d,true);this.addXEllipseCurve(h,a,e,0,d);this.closePath();h=0.2*c;f[Shape.textbox]=[0,h,b,c-h];f[Shape.connector]=[[e,a,270],[0,g,180],[e,d,90],[b,g,0]]},SummingJunction:function(a,b,c,f){this.Oval(a,b,c,f);a=b*0.5;c*=0.5;b=zoho.math.toRadians(225);f=zoho.math.toRadians(45);c=this.getEllipseCoordinates(b,
f,a,c);this.move(c[0],c[1]);this.addLine(c[2],c[3]);this.move(c[2],c[1]);this.addLine(c[0],c[3])},Or:function(a,b,c,f){this.Oval(a,b,c,f);a=b*0.5;f=c*0.5;this.move(a,0);this.addLine(a,c);this.move(0,f);this.addLine(b,f)},Collate:function(a,b,c,f){this.move(0,0);this.addLine(b,0);this.moveLine(0,c,b,c);this.closePath();a=b*0.5;f[Shape.textbox]=[0.25*b,0.25*c,0.75*b,0.75*c];f[Shape.connector]=[[a,0,270],[a,c*0.5,270],[a,c,90]]},Sort:function(a,b,c,f){this.Diamond(a,b,c);this.closePath();a=c*0.5;this.move(0,
a);this.addLine(b,a);f[Shape.textbox]=[0.25*b,0.25*c,0.75*b,0.75*c];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},Extract:function(a,b,c,f){this.IsoscelesTriangle([[0.5]],b,c,{});a=0.25*b;var d=0.75*b,e=c*0.5;b*=0.5;f[Shape.textbox]=[a,e,d,c];f[Shape.connector]=[[b,0,270],[a,e,180],[b,c,90],[d,e,0]]},Merge:function(a,b,c,f){a=b*0.5;this.move(0,0);this.addLine(a,c);this.moveLine(b,0);this.closePath();var d=0.25*b;b*=0.75;var e=c*0.5;f[Shape.textbox]=[d,0,b,e];f[Shape.connector]=
[[a,0,270],[d,e,180],[a,c,90],[b,e,0]]},StoredData:function(a,b,c,f){a=1/6*b;var d=c*0.5;this.move(a,0);this.addYEllipseCurve(a,d,0,c,a,true);this.addLine(b,c);this.addYEllipseCurve(a,d,c,0,b);this.closePath();d=b-a;b*=0.5;var e=c*0.5;f[Shape.textbox]=[a,0,d,c];f[Shape.connector]=[[b,0,270],[0,e,180],[b,c,90],[d,e,0]]},Delay:function(a,b,c,f){a=b*0.5;var d=c*0.5;this.move(0,0);this.addLine(a,0);this.addYEllipseCurve(a,d,0,c,a);this.addLine(0,c);this.closePath();var e=zoho.math.toRadians(225),g=zoho.math.toRadians(45);
a=this.getEllipseCoordinates(e,g,a,d);f[Shape.textbox]=[0,a[1],a[2],a[3]];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},SequentialAccessStorage:function(a,b,c,f){a=b*0.5;var d=c*0.5,e=this.getEllipseCoordinates(zoho.math.toRadians(45),undefined,a,d);this.move(a,c);this.addEllipseCurve(a,d,a,c,e[0],e[1],false,true);this.addLine(b,e[1]);this.moveLine(b,c);this.closePath();this.setTextBox(m.ShapeConstants.PresetShapeGeometry.OVAL,a,d,f);this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,
b,c,f)},MagneticDisk:function(a,b,c,f){a=1/6*c;var d=c-a,e=b*0.5;this.move(0,a);this.addXEllipseCurve(e,a,0,b,a);this.addXEllipseCurve(e,a,b,0,a);this.addLine(0,d);this.addXEllipseCurve(e,a,0,b,d,true);this.addLine(b,a);this.addXEllipseCurve(e,a,b,0,a);a=1/3*c;d=b*0.5;f[Shape.textbox]=[0,a,b,5/6*c];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f);f[Shape.connector].push([d,a,270])},DirectAccessStorage:function(a,b,c,f){var d=5/6*b;a=b-d;var e=c*0.5;this.move(d,0);this.addYEllipseCurve(a,
e,0,c,d);this.addYEllipseCurve(a,e,c,0,d);this.addLine(a,0);this.addYEllipseCurve(a,e,0,c,a,true);this.addLine(d,c);this.addYEllipseCurve(a,e,c,0,d);d=2/3*b;e=c*0.5;f[Shape.textbox]=[a,0,d,c];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f);f[Shape.connector].push([d,e,270])},Display:function(a,b,c,f){a=1/6*b;var d=b-a,e=c*0.5;this.move(0,e);this.addLine(a,0);this.moveLine(d,0);this.addYEllipseCurve(a,e,0,c,d);this.addLine(a,c);this.closePath();f[Shape.textbox]=[a,0,d,c];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,
b,c,f)},Explosion1:function(a,b,c,f){a=b/21600;var d=c/21600,e=4627*a,g=6320*d,h=16702*a,j=13937*d,l=13290*d,n=8485*a,o=8615*d,p=14522*a;this.move(b*0.5,5800*d);this.addLine(p,0);this.moveLine(14155*a,5325*d,18380*a,4457*d,h,7315*d,21097*a,8137*d);this.moveLine(17607*a,10475*d,b,l,16837*a,12942*d,18145*a,18095*d);this.moveLine(14020*a,14457*d,13247*a,19737*d,10532*a,14935*d);this.moveLine(n,c,7715*a,15627*d,4762*a,17617*d,5667*a,j);this.moveLine(135*a,14587*d,3722*a,11775*d,0,o,e,7617*d);this.moveLine(370*
a,2295*d,7312*a,g,8352*a,2295*d);this.closePath();f[Shape.textbox]=[e,g,h,j];f[Shape.connector]=[[p,0,270],[0,o,180],[n,c,90],[b,l,0]]},Explosion2:function(a,b,c,f){a=b/21600;var d=c/21600,e=5372*a,g=6382*d,h=14640*a,j=15935*d,l=9722*a,n=1887*d,o=12877*d,p=11612*a,r=18842*d,q=6645*d;this.move(11462*a,4342*d);this.addLine(14790*a,0);this.moveLine(14525*a,5777*d,18007*a,3172*d,16380*a,6532*d,b,q,16985*a,9402*d);this.moveLine(18270*a,11290*d,16380*a,12310*d,18877*a,15632*d,h,14350*d,14942*a,17370*d);
this.moveLine(12180*a,j,p,r,9872*a,17370*d,8700*a,19712*d,7527*a,18125*d);this.moveLine(4917*a,c,4805*a,18240*d,1285*a,17825*d,3330*a,15370*d,0,o,3935*a,11592*d);this.moveLine(1172*a,8270*d,e,7817*d,4502*a,3625*d,8550*a,g,l,n);this.closePath();f[Shape.textbox]=[e,g,h,j];f[Shape.connector]=[[l,n,270],[0,o,180],[p,r,90],[b,q,0]]},FourPointStar:function(a,b,c,f){var d=a[0];a=b*0.5;var e=c*0.5,g=b*d;d*=c;var h=zoho.math.toRadians(45),j=g*Math.cos(h);h=d*Math.sin(h);g=a-j;j=a+j;var l=e-h;h=e+h;this.move(0,
e);this.addLine(g,l);this.moveLine(a,0,j,l,b,e,j,h,a,c,g,h);this.closePath();f[Shape.handle]=[[a,e-d]];f[Shape.textbox]=[g,l,j,h];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},FivePointStar:function(a,b,c,f){b*=0.5;c*=0.5;var d=a[0],e=b*1.05146,g=zoho.math.toRadians(18),h=zoho.math.toRadians(306),j=e*Math.cos(g),l=e*Math.cos(h);a=b-j;var n=b-l;l=b+l;j=b+j;g=c-c*Math.sin(g);h=c-c*Math.sin(h);e=e*d*2;d=c*d*2;var o=zoho.math.toRadians(342),p=zoho.math.toRadians(54),r=e*Math.cos(o),
q=e*Math.cos(p);e=b-r;var s=b-q;q=b+q;r=b+r;p=c-d*Math.sin(p);o=c-d*Math.sin(o);var t=c+d;c-=d;this.move(a,g);this.addLine(s,p);this.moveLine(b,0,q,p,j,g,r,o,l,h,b,t,n,h,e,o);this.closePath();f[Shape.handle]=[[b,c]];f[Shape.textbox]=[e,p,r,t];f[Shape.connector]=[[b,0,270],[a,g,180],[n,h,90],[l,h,90],[j,g,0]]},SixPointStar:function(a,b,c,f){var d=a[0];a=b*0.5;var e=c*0.5,g=zoho.math.toRadians(30),h=a*Math.cos(g);g=a-h;h=a+h;var j=c*0.25,l=e+j,n=b*d,o=c*d,p=n*0.5;b=a-n;d=a-p;p=a+p;n=a+n;var r=zoho.math.toRadians(60),
q=o*Math.sin(r);r=e-q;q=e+q;o=e-o;this.move(g,j);this.addLine(d,r);this.moveLine(a,0,p,r,h,j,n,e,h,l,p,q,a,c,d,q,g,l,b,e);this.closePath();f[Shape.handle]=[[a,o]];f[Shape.textbox]=[b,r,n,q];f[Shape.connector]=[[h,j,0],[h,l,0],[a,c,90],[g,l,180],[g,j,180],[a,0,270]]},SevenPointStar:function(a,b,c,f){var d=a[0];a=b*0.5;var e=c*0.5,g=a*0.97493,h=a*0.78183,j=a*0.43388,l=a-g,n=a-h,o=a-j;j=a+j;h=a+h;g=a+g;var p=e-e*0.62349,r=e+e*0.22252,q=e+e*0.90097;b*=d;c*=d;var s=b*0.97493,t=b*0.78183,u=b*0.43388;b=
a-s;d=a-t;var v=a-u;u=a+u;t=a+t;s=a+s;var w=e-c*0.90097,x=e-c*0.22252,y=e+c*0.62349,A=e+c;e-=c;this.move(l,r);this.addLine(b,x);this.moveLine(n,p,v,w,a,0,u,w,h,p,s,x,g,r,t,y,j,q);this.moveLine(a,A,o,q,d,y);this.closePath();f[Shape.handle]=[[a,e]];f[Shape.textbox]=[d,w,t,y];f[Shape.connector]=[[h,p,0],[g,r,0],[j,q,90],[o,q,90],[l,r,180],[n,p,180],[a,0,270]]},EightPointStar:function(a,b,c,f){var d=a[0];a=b*0.5;var e=c*0.5,g=zoho.math.toRadians(45),h=a*Math.cos(g),j=a-h;h=a+h;var l=e*Math.sin(g);g=e-
l;l=e+l;var n=b*d;d*=c;var o=n*0.92388,p=n*0.38268,r=d*0.92388,q=d*0.38268;n=a-o;var s=a-p;p=a+p;o=a+o;var t=e-r,u=e-q;q=e+q;r=e+r;d=e-d;this.move(0,e);this.addLine(n,u);this.moveLine(j,g,s,t,a,0);this.moveLine(p,t,h,g,o,u,b,e);this.moveLine(o,q,h,l,p,r,a,c);this.moveLine(s,r,j,l,n,q);this.closePath();f[Shape.handle]=[[a,d]];f[Shape.textbox]=[n,t,o,r];f[Shape.connector]=[[b,e,0],[h,l,90],[a,c,90],[j,l,90],[0,e,180],[j,g,270],[a,0,270],[h,g,270]]},TenPointStar:function(a,b,c,f){var d=a[0];a=b*0.5;
var e=c*0.5,g=a*0.95106,h=a*0.58779,j=a-g,l=a-h;h=a+h;g=a+g;var n=e*0.80902,o=e*0.30902,p=e-n,r=e-o;o=e+o;n=e+n;var q=b*d,s=c*d,t=0.80902*q,u=0.30902*q,v=0.95106*s,w=0.58779*s;b=a-q;d=a-t;var x=a-u;u=a+u;t=a+t;q=a+q;var y=e-v,A=e-w;w=e+w;v=e+v;s=e-s;this.move(j,r);this.addLine(d,A);this.moveLine(l,p,x,y,a,0,u,y,h,p,t,A,g,r,q,e);this.moveLine(g,o,t,w,h,n,u,v,a,c,x,v,l,n,d,w,j,o,b,e);this.closePath();f[Shape.handle]=[[a,s]];f[Shape.textbox]=[d,A,t,w];f[Shape.connector]=[[g,r,0],[g,o,0],[h,n,90],[a,
c,90],[l,n,90],[j,o,180],[j,r,180],[l,p,270],[a,0,270],[h,p,270]]},TwelvePointStar:function(a,b,c,f){var d=a[0];a=b*0.5;var e=c*0.5,g=zoho.math.toRadians(30),h=zoho.math.toRadians(60),j=a*Math.cos(g),l=e*Math.sin(h);h=a-j;g=b*0.75;j=a+j;var n=e-l,o=c*0.75;l=e+l;var p=b*d;d*=c;var r=zoho.math.toRadians(15),q=zoho.math.toRadians(45),s=zoho.math.toRadians(75),t=p*Math.cos(r),u=p*Math.cos(q),v=p*Math.cos(s);s=d*Math.sin(s);var w=d*Math.sin(q),x=d*Math.sin(r);r=a-t;q=a-u;p=a-v;v=a+v;u=a+u;t=a+t;var y=
e-s,A=e-w,E=e-x;x=e+x;w=e+w;s=e+s;d=e-d;var D=c*0.25,C=b*0.25;this.move(0,e);this.addLine(r,E);this.moveLine(h,D,q,A,C,n,p,y,a,0,v,y,g,n,u,A,j,D,t,E,b,e);this.moveLine(t,x,j,o,u,w,g,l,v,s,a,c,p,s,C,l,q,w,h,o,r,x);this.closePath();f[Shape.handle]=[[a,d]];f[Shape.textbox]=[q,A,u,w];f[Shape.connector]=[[j,D,0],[b,e,0],[j,o,0],[g,l,90],[a,c,90],[C,l,90],[h,o,180],[0,e,180],[h,D,180],[C,n,270],[a,0,270],[g,n,270]]},SixteenPointStar:function(a,b,c,f){var d=a[0];a=b*0.5;var e=c*0.5,g=a*0.92388,h=a*0.70711,
j=a*0.38268,l=e*0.92388,n=e*0.70711,o=e*0.38268,p=a-g,r=a-h,q=a-j;j=a+j;h=a+h;g=a+g;var s=e-l,t=e-n,u=e-o;o=e+o;n=e+n;l=e+l;var v=b*d;d*=c;var w=v*0.98079,x=v*0.83147,y=v*0.55557,A=v*0.19509,E=d*0.98079,D=d*0.83147,C=d*0.55557,F=d*0.19509,G=a-w,B=a-x,z=a-y,H=a-A;A=a+A;y=a+y;x=a+x;w=a+w;var J=e-E,K=e-D,L=e-C,M=e-F;F=e+F;C=e+C;D=e+D;E=e+E;var I=e-d;this.move(0,e);this.addLine(G,M);this.moveLine(p,u,B,L,r,t,z,K,q,s,H,J,a,0);this.moveLine(A,J,j,s,y,K,h,t,x,L,g,u,w,M,b,e);this.moveLine(w,F,g,o,x,C,h,n,
y,D,j,l,A,E,a,c);this.moveLine(H,E,q,l,z,D,r,n,B,C,p,o,G,F);this.closePath();f[Shape.handle]=[[a,I]];G=zoho.math.toRadians(45);v*=Math.cos(G);d*=Math.sin(G);f[Shape.textbox]=[a-v,e-d,a+v,e+d];f[Shape.connector]=[[h,t,0],[g,u,0],[b,e,0],[g,o,0],[h,n,0],[j,l,90],[a,c,90],[q,l,90],[r,n,180],[p,o,180],[0,e,180],[p,u,180],[r,t,180],[q,s,270],[a,0,270],[j,s,270]]},TwentyFourPointStar:function(a,b,c,f){var d=a[0];a=b*0.5;var e=c*0.5,g=zoho.math.toRadians(15),h=zoho.math.toRadians(30),j=zoho.math.toRadians(45),
l=zoho.math.toRadians(75),n=zoho.math.toRadians(60),o=a*Math.cos(g),p=a*Math.cos(h),r=a*Math.cos(j),q=b*0.25,s=a*Math.cos(l),t=e*Math.sin(l),u=e*Math.sin(n),v=e*Math.sin(j),w=c*0.25,x=e*Math.sin(g);g=a-o;j=a-p;n=a-r;l=a-q;h=a-s;s=a+s;q=a+q;r=a+r;p=a+p;o=a+o;var y=e-t,A=e-u,E=e-v,D=e-w,C=e-x;x=e+x;w=e+w;v=e+v;u=e+u;var F=e+t;t=b*d;d*=c;var G=t*0.99144,B=t*0.92388,z=t*0.79335,H=t*0.60876,J=t*0.38268,K=t*0.13053,L=d*0.99144,M=d*0.92388,I=d*0.79335,N=d*0.60876,O=d*0.38268,P=d*0.13053,Q=a-G,R=a-B,S=a-
z,T=a-H,U=a-J,V=a-K;K=a+K;J=a+J;H=a+H;z=a+z;B=a+B;G=a+G;var W=e-L,X=e-M,Y=e-I,Z=e-N,$=e-O,aa=e-P;P=e+P;O=e+O;N=e+N;I=e+I;M=e+M;L=e+L;var ba=e-d;this.move(0,e);this.addLine(Q,aa);this.moveLine(g,C,R,$,j,D,S,Z,n,E,T,Y,l,A,U,X,h,y,V,W,a,0);this.moveLine(K,W,s,y,J,X,q,A,H,Y,r,E,z,Z,p,D,B,$,o,C,G,aa,b,e);this.moveLine(G,P,o,x,B,O,p,w,z,N,r,v,H,I,q,u,J,M,s,F,K,L,a,c);this.moveLine(V,L,h,F,U,M,l,u,T,I,n,v,S,N,j,w,R,O,g,x,Q,P);this.closePath();f[Shape.handle]=[[a,ba]];g=zoho.math.toRadians(45);j=t*Math.cos(g);
g=d*Math.sin(g);f[Shape.textbox]=[a-j,e-g,a+j,e+g];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},ThirtyTwoPointStar:function(a,b,c,f){var d=a[0];a=b*0.5;var e=c*0.5,g=zoho.math.toRadians(45),h=a*0.98079,j=a*0.92388,l=a*0.83147,n=a*Math.cos(g),o=a*0.55557,p=a*0.38268,r=a*0.19509,q=e*0.98079,s=e*0.92388,t=e*0.83147,u=e*Math.sin(g),v=e*0.55557,w=e*0.38268,x=e*0.19509;g=a-h;var y=a-j,A=a-l,E=a-n,D=a-o,C=a-p,F=a-r;r=a+r;p=a+p;o=a+o;n=a+n;l=a+l;j=a+j;h=a+h;var G=e-q,B=e-s,z=e-t,H=
e-u,J=e-v,K=e-w,L=e-x;x=e+x;w=e+w;v=e+v;u=e+u;t=e+t;s=e+s;var M=e+q;q=b*d;d*=c;var I=q*0.99518,N=q*0.95694,O=q*0.88192,P=q*0.77301,Q=q*0.63439,R=q*0.4714,S=q*0.29028,T=q*0.09802,U=d*0.99518,V=d*0.95694,W=d*0.88192,X=d*0.77301,Y=d*0.63439,Z=d*0.4714,$=d*0.29028,aa=d*0.09802,ba=a-I,ca=a-N,da=a-O,ea=a-P,fa=a-Q,ga=a-R,ha=a-S,ia=a-T;T=a+T;S=a+S;R=a+R;Q=a+Q;P=a+P;O=a+O;N=a+N;I=a+I;var ja=e-U,ka=e-V,la=e-W,ma=e-X,na=e-Y,oa=e-Z,pa=e-$,qa=e-aa;aa=e+aa;$=e+$;Z=e+Z;Y=e+Y;X=e+X;W=e+W;V=e+V;U=e+U;var ra=e-d;this.move(0,
e);this.addLine(ba,qa);this.moveLine(g,L,ca,pa,y,K,da,oa,A,J,ea,na,E,H,fa,ma,D,z);this.moveLine(ga,la,C,B,ha,ka,F,G,ia,ja,a,0,T,ja,r,G,S,ka);this.moveLine(p,B,R,la,o,z,Q,ma,n,H,P,na,l,J,O,oa,j,K,N,pa);this.moveLine(h,L,I,qa,b,e,I,aa,h,x,N,$,j,w,O,Z,l,v,P,Y);this.moveLine(n,u,Q,X,o,t,R,W,p,s,S,V,r,M,T,U,a,c);this.moveLine(ia,U,F,M,ha,V,C,s,ga,W,D,t,fa,X,E,u,ea,Y,A,v);this.moveLine(da,Z,y,w,ca,$,g,x,ba,aa);this.closePath();f[Shape.handle]=[[a,ra]];g=zoho.math.toRadians(45);y=q*Math.cos(g);g=d*Math.sin(g);
f[Shape.textbox]=[a-y,e-g,a+y,e+g];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f)},UpRibbon:function(a,b,c,f){var d=b*0.5,e=b*0.125,g=b-e,h=b*a[1]*0.5,j=d-h;h=d+h;var l=b*0.03125,n=j+l,o=h-l,p=j+e,r=h-e,q=p-l,s=r+l;a=c*a[0];var t=c-a*0.5,u=c-a,v=(a+c)*0.5,w=a*0.25,x=c-w,y=t-w;this.move(0,c);this.addLine(q,c);this.addYEllipseCurve(l,w,c,t,q,true);this.addLine(n,t);this.addYEllipseCurve(l,w,t,u,n);this.addLine(o,u);this.addYEllipseCurve(l,w,u,t,o);this.addLine(s,t);this.addYEllipseCurve(l,
w,t,c,s,true);this.addLine(b,c);this.moveLine(g,v,b,a,h,a,h,w);this.addXCurve(h,w,h-l,0,true);this.addLine(n,0);this.addYCurve(n,0,n-l,w,true);this.addLine(j,a);this.moveLine(0,a,e,v);this.createNewPath();this.move(p,x);this.addXCurve(p,x,p-l,t,true);this.addLine(n,t);this.addYEllipseCurve(l,w,t,u,n);this.addLine(p,u);this.move(r,x);this.addYCurve(r,x,r+l,t);this.addLine(o,t);this.addYEllipseCurve(l,w,t,u,o,true);this.addLine(r,u);this.createNewPath();this.move(0,c);this.addLine(q,c);this.addYEllipseCurve(l,
w,c,t,q,true);this.addLine(n,t);this.addYEllipseCurve(l,w,t,u,n);this.addLine(o,u);this.addYEllipseCurve(l,w,u,t,o);this.addLine(s,t);this.addYEllipseCurve(l,w,t,c,s,true);this.addLine(b,c);this.moveLine(g,v,b,a,h,a,h,w);this.addXCurve(h,w,h-l,0,true);this.addLine(n,0);this.addYCurve(n,0,n-l,w,true);this.addLine(j,a);this.moveLine(0,a,e,v);this.closePath();this.move(p,x);this.addLine(p,u);this.move(r,x);this.addLine(r,u);this.move(j,y);this.addLine(j,a);this.move(h,a);this.addLine(h,y);f[Shape.handle]=
[[d,u],[j,c]];f[Shape.textbox]=[j,0,h,u];f[Shape.connector]=[[d,0,270],[e,v,180],[d,u,90],[g,v,0]]},DownRibbon:function(a,b,c,f){var d=b*0.5,e=b*0.125,g=b-e,h=b*a[1]*0.5,j=d-h;h=d+h;var l=b*0.03125,n=j+l,o=h-l,p=j+e,r=h-e,q=p-l,s=r+l;a=c*a[0];var t=a*0.5,u=c-a,v=u*0.5,w=a*0.25,x=c-w,y=a-w;this.move(0,0);this.addLine(q,0);this.addYEllipseCurve(l,w,0,t,q);this.addLine(n,t);this.addYEllipseCurve(l,w,t,a,n,true);this.addLine(o,a);this.addYEllipseCurve(l,w,a,t,o,true);this.addLine(s,t);this.addYEllipseCurve(l,
w,t,0,s);this.addLine(b,0);this.moveLine(g,v,b,u,h,u,h,x);this.addYCurve(h,x,h-l,c);this.addLine(n,c);this.addXCurve(n,c,n-l,x);this.addLine(j,u);this.moveLine(0,u,e,v);this.createNewPath();this.move(p,w);this.addYCurve(p,w,p-l,t);this.addLine(n,t);this.addYEllipseCurve(l,w,t,a,n,true);this.addLine(p,a);this.move(r,w);this.addXCurve(r,w,r+l,t,true);this.addLine(o,t);this.addYEllipseCurve(l,w,t,a,o);this.addLine(r,a);this.createNewPath();this.move(0,0);this.addLine(q,0);this.addYEllipseCurve(l,w,0,
t,q);this.addLine(n,t);this.addYEllipseCurve(l,w,t,a,n,true);this.addLine(o,a);this.addYEllipseCurve(l,w,a,t,o,true);this.addLine(s,t);this.addYEllipseCurve(l,w,t,0,s);this.addLine(b,0);this.moveLine(g,v,b,u,h,u,h,x);this.addYCurve(h,x,h-l,c);this.addLine(n,c);this.addXCurve(n,c,n-l,x);this.addLine(j,u);this.moveLine(0,u,e,v);this.closePath();this.move(p,w);this.addLine(p,a);this.move(r,w);this.addLine(r,a);this.move(j,u);this.addLine(j,y);this.move(h,y);this.addLine(h,u);f[Shape.handle]=[[d,a],[j,
0]];f[Shape.textbox]=[j,a,h,c];f[Shape.connector]=[[d,a,270],[e,v,180],[d,c,90],[g,v,0]]},CurvedUpRibbon:function(a,b,c,f){var d=a[0]*c,e=a[1]*b*0.5,g=a[2]*c,h=b*0.5,j=b*0.125,l=d-(1-a[0])*0.5*c,n=l;if(l<0)n=0;g=zoho.math.limit(g,n,d);if(Shape.selectedHandle==2)a[2]=g/c;a=h-e;e=a+j;l=b-e;n=b-a;var o=b-j,p=b?4*g/b:0,r=p*(e-(b?e*e/b:0)),q=c-r,s=e*0.5,t=c-p*s,u=b-s,v=d-g,w=p*(a-(b?a*a/b:0)),x=w+v,y=c-x,A=g+v-x+g+v,E=c-A,D=c-d,C=c-(g*0.875+D)/2;w=c-(w+D);x=c-(x+D);var F=a*0.5;p=c-(p*F+D);var G=b-F;A=
c-(A+D);v=r+v;r=c-v;v=c-(v?d*d/v:0);this.move(0,c);var B=zoho.math.toCubicControlPoints(0,c,s,t,e,q);this.addCubicCurve(B[0],B[1],B[2],B[3],e,q);this.addLine(a,y);B=zoho.math.toCubicControlPoints(a,y,h,E,n,y);this.addCubicCurve(B[0],B[1],B[2],B[3],n,y);this.addLine(l,q);B=zoho.math.toCubicControlPoints(l,q,u,t,b,c);this.addCubicCurve(B[0],B[1],B[2],B[3],b,c);this.addLine(o,C);this.moveLine(b,d);B=zoho.math.toCubicControlPoints(b,d,G,p,n,w);this.addCubicCurve(B[0],B[1],B[2],B[3],n,w);this.addLine(n,
x);B=zoho.math.toCubicControlPoints(n,x,h,A,a,x);this.addCubicCurve(B[0],B[1],B[2],B[3],a,x);this.addLine(a,w);B=zoho.math.toCubicControlPoints(a,w,F,p,0,d);this.addCubicCurve(B[0],B[1],B[2],B[3],0,d);this.addLine(j,C);this.createNewPath();this.move(e,r);this.addLine(e,q);this.moveLine(a,y);B=zoho.math.toCubicControlPoints(a,y,h,E,n,y);this.addCubicCurve(B[0],B[1],B[2],B[3],n,y);this.addLine(l,q);this.moveLine(l,r);B=zoho.math.toCubicControlPoints(l,r,h,v,e,r);this.addCubicCurve(B[0],B[1],B[2],B[3],
e,r);this.closePath();this.createNewPath();this.move(0,c);B=zoho.math.toCubicControlPoints(0,c,s,t,e,q);this.addCubicCurve(B[0],B[1],B[2],B[3],e,q);this.addLine(a,y);B=zoho.math.toCubicControlPoints(a,y,h,E,n,y);this.addCubicCurve(B[0],B[1],B[2],B[3],n,y);this.addLine(l,q);B=zoho.math.toCubicControlPoints(l,q,u,t,b,c);this.addCubicCurve(B[0],B[1],B[2],B[3],b,c);this.addLine(o,C);this.moveLine(b,d);B=zoho.math.toCubicControlPoints(b,d,G,p,n,w);this.addCubicCurve(B[0],B[1],B[2],B[3],n,w);this.addLine(n,
x);B=zoho.math.toCubicControlPoints(n,x,h,A,a,x);this.addCubicCurve(B[0],B[1],B[2],B[3],a,x);this.addLine(a,w);B=zoho.math.toCubicControlPoints(a,w,F,p,0,d);this.addCubicCurve(B[0],B[1],B[2],B[3],0,d);this.addLine(j,C);this.closePath();this.move(e,r);this.addLine(e,q);this.move(l,q);this.addLine(l,r);this.move(a,y);this.addLine(a,w);this.move(n,w);this.addLine(n,y);f[Shape.handle]=[[h,D],[a,0],[0,g]];f[Shape.textbox]=[a,x,n,D];f[Shape.connector]=[[h,0,270],[j,C,180],[h,D,90],[o,C,0]]},CurvedDownRibbon:function(a,
b,c,f){var d=a[0]*c,e=a[1]*b*0.5,g=a[2]*c,h=b*0.5,j=b*0.125,l=d-(1-a[0])*0.5*c,n=l;if(l<0)n=0;g=zoho.math.limit(g,n,d);if(Shape.selectedHandle==2)a[2]=g/c;a=h-e;e=a+j;l=b-e;n=b-a;var o=b-j,p=b?4*g/b:0,r=b?e*e/b:0,q=p*(e-r),s=e*0.5,t=p*s,u=b-s,v=d-g,w=p*(a-(b?a*a/b:0)),x=w+v,y=g+v-x+g+v,A=c-d,E=(g*0.875+A)/2;w+=A;var D=x+A,C=a*0.5;p=p*C+A;var F=b-C,G=y+A,B=(v=q+v)?d*d/v:0;g=c-g;this.move(0,0);var z=zoho.math.toCubicControlPoints(0,0,s,t,e,q);this.addCubicCurve(z[0],z[1],z[2],z[3],e,q);this.addLine(a,
x);z=zoho.math.toCubicControlPoints(a,x,h,y,n,x);this.addCubicCurve(z[0],z[1],z[2],z[3],n,x);this.addLine(l,q);z=zoho.math.toCubicControlPoints(l,q,u,t,b,0);this.addCubicCurve(z[0],z[1],z[2],z[3],b,0);this.addLine(o,E);this.moveLine(b,A);z=zoho.math.toCubicControlPoints(b,A,F,p,n,w);this.addCubicCurve(z[0],z[1],z[2],z[3],n,w);this.addLine(n,D);z=zoho.math.toCubicControlPoints(n,D,h,G,a,D);this.addCubicCurve(z[0],z[1],z[2],z[3],a,D);this.addLine(a,w);z=zoho.math.toCubicControlPoints(a,w,C,p,0,A);this.addCubicCurve(z[0],
z[1],z[2],z[3],0,A);this.addLine(j,E);this.createNewPath();this.move(e,v);this.addLine(e,q);this.moveLine(a,x);z=zoho.math.toCubicControlPoints(a,x,h,y,n,x);this.addCubicCurve(z[0],z[1],z[2],z[3],n,x);this.addLine(l,q);this.moveLine(l,v);z=zoho.math.toCubicControlPoints(l,v,h,B,e,v);this.addCubicCurve(z[0],z[1],z[2],z[3],e,v);this.closePath();this.createNewPath();this.move(0,0);z=zoho.math.toCubicControlPoints(0,0,s,t,e,q);this.addCubicCurve(z[0],z[1],z[2],z[3],e,q);this.addLine(a,x);z=zoho.math.toCubicControlPoints(a,
x,h,y,n,x);this.addCubicCurve(z[0],z[1],z[2],z[3],n,x);this.addLine(l,q);z=zoho.math.toCubicControlPoints(l,q,u,t,b,0);this.addCubicCurve(z[0],z[1],z[2],z[3],b,0);this.addLine(o,E);this.moveLine(b,A);z=zoho.math.toCubicControlPoints(b,A,F,p,n,w);this.addCubicCurve(z[0],z[1],z[2],z[3],n,w);this.addLine(n,D);z=zoho.math.toCubicControlPoints(n,D,h,G,a,D);this.addCubicCurve(z[0],z[1],z[2],z[3],a,D);this.addLine(a,w);z=zoho.math.toCubicControlPoints(a,w,C,p,0,A);this.addCubicCurve(z[0],z[1],z[2],z[3],
0,A);this.addLine(j,E);this.closePath();this.move(e,v);this.addLine(e,q);this.move(l,q);this.addLine(l,v);this.move(a,x);this.addLine(a,w);this.move(n,w);this.addLine(n,x);f[Shape.handle]=[[h,d],[a,c],[0,g]];f[Shape.textbox]=[a,r,n,D];f[Shape.connector]=[[h,r,270],[j,E,180],[h,c,90],[o,E,0]]},VerticalScroll:function(a,b,c,f){a=this.getCoordinates(a[0],b,c);var d=a*0.5,e=a*0.25,g=a+d,h=a+a,j=b-a,l=b-d,n=j-d,o=c-a,p=c-d;this.move(d,c);this.addYCurve(d,c,a,c-d,true);this.addLine(d,p);this.addYEllipseCurve(e,
e,p,o,d,true);this.addLine(a,o);this.moveLine(a,d);this.addYCurve(a,d,g,0);this.addLine(l,0);this.addYEllipseCurve(d,d,0,a,l);this.addLine(j,a);this.moveLine(j,p);this.addYCurve(j,p,n,c);this.closePath();this.createNewPath();this.move(h,d);this.addYCurve(h,d,h-d,a);this.addYEllipseCurve(e,e,a,d,h-d);this.closePath();this.move(a,p);this.addEllipseCurve(d,d,a,p,a-d,p-d,false,true,0,p-d);this.addYEllipseCurve(e,e,p-d,p,a-d);this.closePath();this.createNewPath();this.move(a,o);this.addLine(a,d);this.addYCurve(a,
d,g,0);this.addLine(l,0);this.addYEllipseCurve(d,d,0,a,l);this.addLine(j,a);this.moveLine(j,p);this.addYCurve(j,p,n,c);this.addLine(d,c);this.addYEllipseCurve(d,d,c,o,d);this.closePath();this.move(g,0);this.addYEllipseCurve(d,d,0,a,g);this.addYEllipseCurve(e,e,a,d,g);this.addLine(h,d);this.move(j,a);this.addLine(g,a);this.move(d,o);this.addYEllipseCurve(e,e,o,o+d,d);this.addLine(a,p);this.move(d,c);this.addYCurve(d,c,a,c-d,true);this.addLine(a,o);f[Shape.handle]=[[0,a]];b*=0.5;d=c*0.5;f[Shape.textbox]=
[a,a,j,p];f[Shape.connector]=[[b,0,270],[a,d,0],[b,c,90],[j,d,180]]},HorizontalScroll:function(a,b,c,f){a=this.getCoordinates(a[0],b,c);var d=a*0.5,e=a*0.25,g=a+d,h=a+a,j=c-a,l=c-d,n=j-d,o=b-a,p=b-d;this.move(b,d);this.addYCurve(b,d,p,a);this.addLine(p,d);this.addXEllipseCurve(e,e,p,o,d);this.addLine(o,a);this.moveLine(d,a);this.addYCurve(d,a,0,g,true);this.addLine(0,l);this.addXEllipseCurve(d,d,0,a,l,true);this.addLine(a,j);this.moveLine(p,j);this.addYCurve(p,j,b,n,true);this.closePath();this.createNewPath();
this.move(d,h);this.addYCurve(d,h,a,h-d,true);this.addXEllipseCurve(e,e,a,d,h-d,true);this.closePath();this.move(p,a);this.addEllipseCurve(d,d,p,a,p-d,d,true,true,p-d);this.addXEllipseCurve(e,e,p-d,p,d,true);this.closePath();this.createNewPath();this.move(0,g);this.addYCurve(0,g,d,a);this.addLine(o,a);this.moveLine(o,d);this.addXEllipseCurve(d,d,o,b,d);this.addLine(b,n);this.addYCurve(b,n,p,n+d);this.addLine(a,j);this.moveLine(a,l);this.addXEllipseCurve(d,d,a,0,l);this.closePath();this.move(o,a);
this.addLine(p,a);this.addYCurve(p,a,b,d,true);this.move(p,a);this.addLine(p,d);this.addXEllipseCurve(e,e,p,p-d,d);this.move(d,h);this.addLine(d,g);this.addXEllipseCurve(e,e,d,a,g);this.addXEllipseCurve(d,d,a,0,g);this.move(a,g);this.addLine(a,j);f[Shape.handle]=[[a,0]];d=b*0.5;c*=0.5;f[Shape.textbox]=[a,a,p,j];f[Shape.connector]=[[d,a,90],[0,c,180],[d,j,270],[b,c,0]]},Wave:function(a,b,c,f){var d=a[0]*c,e=d*10/3,g=d-e,h=d+e,j=c-d,l=j-e,n=j+e;e=b*0.5;a=a[1]*b;var o=a*2,p=Math.abs(a),r=zoho.math.ifElse(o,
0,o),q=0-r;o=zoho.math.ifElse(o,o,0);var s=b-o,t=(r+s)/3,u=q+t,v=(u+s)*0.5;r=b+r;var w=o+t,x=(w+r)*0.5;b-=p;t=e+a;this.move(q,d);this.addCubicCurve(u,g,v,h,s,d);this.addLine(r,j);this.addCubicCurve(x,n,w,l,o,j);this.closePath();f[Shape.handle]=[[0,d],[t,c]];g=d*2;h=c*0.5;f[Shape.textbox]=[q>o?q:o,g,s<r?s:r,c-g];f[Shape.connector]=[[e-a,d,90],[p,h,180],[t,j,270],[b,h,0]]},DoubleWave:function(a,b,c,f){var d=c*a[0],e=d*(10/3),g=d-e,h=d+e,j=c-d,l=j-e,n=j+e,o=b*0.5,p=a[1]*b,r=p*2;a=Math.abs(p);var q=zoho.math.ifElse(r,
0,r);e=0-q;r=zoho.math.ifElse(r,r,0);var s=b-r,t=(q+s)/6,u=e+t,v=(q+s)/3,w=e+v,x=(e+s)/2,y=x+t,A=(y+s)/2;q=b+q;var E=r+t,D=r+v;v=(r+q)/2;t=v+t;var C=(t+q)/2;b-=a;o+=p;this.move(e,d);this.addCubicCurve(u,g,w,h,x,d);this.addCubicCurve(y,g,A,h,s,d);this.addLine(q,j);this.addCubicCurve(C,n,t,l,v,j);this.addCubicCurve(D,n,E,l,r,j);this.closePath();f[Shape.handle]=[[0,d],[o,c]];g=d*2;h=c*0.5;f[Shape.textbox]=[e>r?e:r,g,s<q?s:q,c-g];f[Shape.connector]=[[v,d,90],[a,h,180],[x,j,270],[b,h,0]]},RectangularCallout:function(a,
b,c,f){var d=a[0]*b,e=a[1]*c;a=b*0.5+d;var g=c*0.5+e,h=Math.abs(e)-Math.abs(b?d*c/b:0),j=zoho.math.ifElse(d,7,2),l=zoho.math.ifElse(d,10,5);j=b*j/12;l=b*l/12;var n=zoho.math.ifElse(e,7,2),o=zoho.math.ifElse(e,10,5);n=c*n/12;o=c*o/12;var p=zoho.math.ifElse(d,0,a);p=zoho.math.ifElse(h,0,p);var r=zoho.math.ifElse(e,j,a);r=zoho.math.ifElse(h,r,j);var q=zoho.math.ifElse(d,a,b);q=zoho.math.ifElse(h,b,q);var s=zoho.math.ifElse(e,a,j);s=zoho.math.ifElse(h,s,j);var t=zoho.math.ifElse(d,n,g);t=zoho.math.ifElse(h,
n,t);var u=zoho.math.ifElse(e,0,g);u=zoho.math.ifElse(h,u,0);d=zoho.math.ifElse(d,g,n);d=zoho.math.ifElse(h,n,d);e=zoho.math.ifElse(e,g,c);h=zoho.math.ifElse(h,e,c);this.move(0,0);this.addLine(j,0);this.moveLine(r,u,l,0,b,0,b,n,q,d,b,o,b,c,l,c,s,h,j,c,0,c,0,o,p,t,0,n);this.closePath();f[Shape.handle]=[[a,g]];f[Shape.textbox]=[0,0,b,c];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f);f[Shape.connector].push([a,g,90])},RoundedRectangularCallout:function(a,b,c,f){var d=a[0]*b,e=a[1]*
c;a=b*0.5+d;var g=c*0.5+e,h=Math.abs(e)-Math.abs(b?d*c/b:0),j=zoho.math.ifElse(d,7,2),l=zoho.math.ifElse(d,10,5);j=b*j/12;l=b*l/12;var n=zoho.math.ifElse(e,7,2),o=zoho.math.ifElse(e,10,5);n=c*n/12;o=c*o/12;var p=zoho.math.ifElse(d,0,a);p=zoho.math.ifElse(h,0,p);var r=zoho.math.ifElse(e,j,a);r=zoho.math.ifElse(h,r,j);var q=zoho.math.ifElse(d,a,b);q=zoho.math.ifElse(h,b,q);var s=zoho.math.ifElse(e,a,j);s=zoho.math.ifElse(h,s,j);var t=zoho.math.ifElse(d,n,g);t=zoho.math.ifElse(h,n,t);var u=zoho.math.ifElse(e,
0,g);u=zoho.math.ifElse(h,u,0);d=zoho.math.ifElse(d,g,n);d=zoho.math.ifElse(h,n,d);e=zoho.math.ifElse(e,g,c);h=zoho.math.ifElse(h,e,c);e=this.getCoordinates(0.1667,b,c);var v=b-e,w=c-e;this.move(0,e);this.addYCurve(0,e,e,0);this.addLine(j,0);this.moveLine(r,u,l,0,v,0);this.addXCurve(v,0,b,e);this.addLine(b,n);this.moveLine(q,d,b,o,b,w);this.addYCurve(b,w,v,c);this.addLine(l,c);this.moveLine(s,h,j,c,e,c);this.addXCurve(e,c,0,w);this.addLine(0,o);this.moveLine(p,t,0,n);this.closePath();f[Shape.handle]=
[[a,g]];j=e*0.293;f[Shape.textbox]=[j,j,b-j,c-j];this.setConnector(m.ShapeConstants.PresetShapeGeometry.RECT,b,c,f);f[Shape.connector].push([a,g,90])},OvalCallout:function(a,b,c,f){var d=b*0.5,e=c*0.5,g=a[0]*b,h=a[1]*c;a=d+g;var j=e+h;g=Math.atan2(h*b,g*c);h=zoho.math.toRadians(11);h=this.getEllipseCoordinates(g+h,g-h,d,e);this.move(a,j);this.addLine(h[0],h[1]);this.addEllipseCurve(d,e,h[0],h[1],h[2],h[3],false,true);this.closePath();f[Shape.handle]=[[a,j]];this.setConnectorAndTextBox(m.ShapeConstants.PresetShapeGeometry.OVAL,
b,c,f);f[Shape.connector].push([a,j,g])},CloudCallout:function(a,b,c,f){this.Cloud(a,b,c,f);var d=b*0.5,e=c*0.5,g=b*a[0],h=c*a[1],j=d+g;a=e+h;var l=zoho.math.cosTan(e,g,h);h=zoho.math.sinTan(d,g,h);g=zoho.math.cosTan(d,l,h);l=zoho.math.sinTan(e,l,h);g=d+g-j;h=e+l-a;var n=Math.sqrt(Math.pow(g,2)+Math.pow(h,2));e=this.getCoordinates(6600/21600,b,c);var o=(n-e)*1/3;e=this.getCoordinates(1800/21600,b,c);d=o+e;l=(n?d*g/n:0)+j;d=(n?d*h/n:0)+a;o=this.getCoordinates(4800/21600,b,c)+o*2;g=(n?o*g/n:0)+j;h=
(n?o*h/n:0)+a;n=this.getCoordinates(1200/21600,b,c);b=this.getCoordinates(600/21600,b,c);c=j+b;j=l+n;l=g+e;this.createNewPath();this.move(c-b,a);this.addEllipse(b,b,c,a);this.endClosePath();this.move(j-n,d);this.addEllipse(n,n,j,d);this.endClosePath();this.move(l-e,h);this.addEllipse(e,e,l,h);this.endClosePath();f[Shape.handle]=[[c,a]];f.croppath=[0,2]},computeCallout:function(a,b,c,f,d,e){this.Rect(a,b,c,f);var g=b*a[1],h=c*a[0],j=b*a[3],l=c*a[2],n=[[g,h],[j,l]];this.createNewPath();this.move(g,
h);this.addLine(j,l);if(d==2||d==3){h=b*a[5];j=c*a[4];this.moveLine(h,j);n.push([h,j])}if(d==3){b*=a[7];a=c*a[6];this.moveLine(b,a);n.push([b,a])}if(e){this.move(g,0);this.addLine(g,c)}f[Shape.handle]=n},Callout1:function(a,b,c,f){this.computeCallout(a,b,c,f,1)},Callout2:function(a,b,c,f){this.computeCallout(a,b,c,f,2)},Callout3:function(a,b,c,f){this.computeCallout(a,b,c,f,3)},AccentCallout1:function(a,b,c,f){this.computeCallout(a,b,c,f,1,true)},AccentCallout2:function(a,b,c,f){this.computeCallout(a,
b,c,f,2,true)},AccentCallout3:function(a,b,c,f){this.computeCallout(a,b,c,f,3,true)},BorderCallout1:function(a,b,c,f){this.computeCallout(a,b,c,f,1)},BorderCallout2:function(a,b,c,f){this.computeCallout(a,b,c,f,2)},BorderCallout3:function(a,b,c,f){this.computeCallout(a,b,c,f,3)},AccentBorderCallout1:function(a,b,c,f){this.computeCallout(a,b,c,f,1,true)},AccentBorderCallout2:function(a,b,c,f){this.computeCallout(a,b,c,f,2,true)},AccentBorderCallout3:function(a,b,c,f){this.computeCallout(a,b,c,f,3,
true)},Line:function(a,b,c,f){this.move(0,0);this.addLine(b,c);f[Shape.IsAconnector]=true},zeroCheck:function(a,b,c){var f=b,d=c;if(b<1){m.each(a,function(e,g){if(e%2==0){g*=b;a[e]=g}});f=1}if(c<1){m.each(a,function(e,g){if(e%2!=0){g*=c;a[e]=g}});d=1}return{width:f,height:d,modifiers:a}},ElbowConnector2:function(a,b,c,f){this.move(0,0);this.addLine(b,0);this.moveLine(b,c);f[Shape.IsAconnector]=true},ElbowConnector3:function(a,b,c,f){var d=m.extend(true,{},a);d=this.zeroCheck(d,b,c);a=d.width;d=d.modifiers;
a*=d[0];this.move(0,0);this.addLine(a,0);this.moveLine(a,c,b,c);f[Shape.handle]=[[a,c*0.5]];f[Shape.IsAconnector]=true},ElbowConnector4:function(a,b,c,f){var d=m.extend(true,{},a);d=this.zeroCheck(d,b,c);var e=d.width;a=d.height;d=d.modifiers;e*=d[0];a*=d[1];this.move(0,0);this.addLine(e,0);this.moveLine(e,a,b,a,b,c);f[Shape.handle]=[[e,a*0.5],[(e+b)*0.5,a]];f[Shape.IsAconnector]=true},ElbowConnector5:function(a,b,c,f){var d=m.extend(true,{},a);a=this.zeroCheck(d,b,c);var e=a.width,g=a.height;d=a.modifiers;
a=d[0]*e;g*=d[1];e*=d[2];d=(a+e)*0.5;var h=g*0.5,j=(c+g)*0.5;this.move(0,0);this.addLine(a,0);this.moveLine(a,g,e,g,e,c,b,c);f[Shape.handle]=[[a,h],[d,g],[e,j]];f[Shape.IsAconnector]=true},CurvedConnector2:function(a,b,c,f){a=b*0.5;var d=c*0.5;this.move(0,0);this.addCubicCurve(a,0,b,d,b,c);f[Shape.IsAconnector]=true},CurvedConnector3:function(a,b,c,f){var d=m.extend(true,{},a);d=this.zeroCheck(d,b,c);a=d.width;d=d.modifiers;a*=d[0];d=a*0.5;var e=(a+b)*0.5,g=c*0.5,h=c*0.25,j=c*0.75;this.move(0,0);
this.addCubicCurve(d,0,a,h,a,g);this.moveCurve(a,j,e,c,b,c);f[Shape.handle]=[[a,g]];f[Shape.IsAconnector]=true},CurvedConnector4:function(a,b,c,f){var d=m.extend(true,{},a),e=this.zeroCheck(d,b,c);a=e.width;var g=e.height;d=e.modifiers;a*=d[0];e=a*0.5;var h=(b+a)*0.5,j=(a+h)*0.5,l=(h+b)*0.5;g*=d[1];d=g*0.5;var n=d*0.5,o=(d+g)*0.5,p=(c+g)*0.5;this.move(0,0);this.addCubicCurve(e,0,a,n,a,d);this.moveCurve(a,o,j,g,h,g,l,g,b,p,b,c);f[Shape.handle]=[[a,d],[h,g]];f[Shape.IsAconnector]=true},CurvedConnector5:function(a,
b,c,f){var d=m.extend(true,{},a);a=this.zeroCheck(d,b,c);var e=a.width,g=a.height;d=a.modifiers;a=d[0]*e;e*=d[2];var h=(a+e)*0.5,j=a*0.5,l=(a+h)*0.5,n=(e+h)*0.5,o=(e+b)*0.5;g*=d[1];d=g*0.5;var p=d*0.5,r=(d+g)*0.5,q=(c+g)*0.5,s=(q+g)*0.5,t=(q+c)*0.5;this.move(0,0);this.addCubicCurve(j,0,a,p,a,d);this.moveCurve(a,r,l,g,h,g,n,g,e,s,e,q,e,t,o,c,b,c);f[Shape.handle]=[[a,d],[h,g],[e,q]];f[Shape.IsAconnector]=true},SingleArrow:function(a,b,c,f){this.move(0,0);this.addLine(b,c);f[Shape.IsAconnector]=true},
DoubleArrow:function(a,b,c,f){this.move(0,0);this.addLine(b,c);f[Shape.IsAconnector]=true},ElbowArrowConnector:function(a,b,c,f){this.ElbowConnector3(a,b,c,f)},ElbowDoubleArrowConnector:function(a,b,c,f){this.ElbowConnector3(a,b,c,f)},CurvedArrowConnector:function(a,b,c,f){this.CurvedConnector3(a,b,c,f)},CurvedDoubleArrowConnector:function(a,b,c,f){this.CurvedConnector3(a,b,c,f)},Grid:function(a,b,c){var f=c*0.5,d=b>c?b:c,e=a[0]*d;a=a[1];d*=0.002;var g=e/a;this.DrawGridLine(b*0.5,c,e,d,g);this.DrawGridLine(f,
b,e,d,g,true,a)},DrawGridLine:function(a,b,c,f,d,e,g){var h=0,j=this;do{var l=a-h*c,n=a+h*c;if(l<=0)break;m.each(l==n?[l]:[l,n],function(o,p){var r=b*0.5,q=-1;do{q++;var s=f*0.5;internal=[r,b-r];m.each(internal,function(t,u){if(e){if(q%g!=0){j.move(u-s,p);j.addLine(u+s,p)}}else{j.move(p,u-s);j.addLine(p,u+s)}});r+=d}while(r<b)});h++}while(l>0)},LockSymbol:function(a,b,c){a=b*0.5;c*=0.5;this.move(0,c);this.addEllipse(a,c,a,c);b=zoho.math.toRadians(225);var f=zoho.math.toRadians(45);b=this.getEllipseCoordinates(b,
f,a,c);f=zoho.math.toRadians(135);var d=zoho.math.toRadians(315);a=this.getEllipseCoordinates(f,d,a,c);this.move(b[0],b[1]);this.addLine(b[2],b[3]);this.move(a[0],a[1]);this.addLine(a[2],a[3])},getPathPoints:function(a,b,c,f){this.pathArray=[[]];this.pathNumber=0;if(!b)b=m.Preset[a].modifiers;var d={};a=zoho.string.removeSpace(m.Preset[a].name);c=VectorUtil.getViewBoxDimensions(c,f);this[a].call(this,b,c[0],c[1],d);d.path=this.pathArray;d[Shape.modifier]=b;d[Shape.handle]||(d[Shape.handle]=undefined);
return d},m:function(a){this.move(a.x,a.y)},l:function(a){this.addLine(a.x,a.y)},cc:function(a){this.addCubicCurve(a[0].x,a[0].y,a[1].x,a[1].y,a[2].x,a[2].y)},qc:function(a){this.addQuadraticBezier(a[0].x,a[0].y,a[1].x,a[1].y)},c:function(){this.closePath()},move:function(a,b){this.addPath(["M",a,b])},addLine:function(a,b){this.addPath(["L",a,b])},moveLine:function(){var a=Array.prototype.slice.call(arguments);a.splice(0,0,"L");this.addPath(a)},addCubicCurve:function(a,b,c,f,d,e){this.addPath(["C",
a,b,c,f,d,e])},moveCurve:function(){var a=Array.prototype.slice.call(arguments);a.splice(0,0,"C");this.addPath(a)},addXCurve:function(a,b,c,f,d,e){this.addPath(this.pathutil.getXCurve(a,b,c,f,d,e))},addYCurve:function(a,b,c,f,d,e){this.addPath(this.pathutil.getYCurve(a,b,c,f,d,e))},addFiller:function(a,b){this.addPath(this.pathutil.getFiller(a,b))},addQuadraticBezier:function(a,b,c,f){this.addPath(this.pathutil.getQuadBezier(a,b,c,f))},addEllipseCurve:function(a,b,c,f,d,e,g,h,j,l,n){this.addPath(this.pathutil.getEllipseCurve(a,
b,c,f,d,e,g,h,j,l));n&&this.addPath(this.pathutil.getNoFill())},addXEllipseCurve:function(a,b,c,f,d,e,g){this.addPath(this.pathutil.getXEllipseCurve(a,b,c,f,d,e,g))},addYEllipseCurve:function(a,b,c,f,d,e,g,h,j){this.addPath(this.pathutil.getYEllipseCurve(a,b,c,f,d,e,g,h,j))},closePath:function(){this.addPath(this.pathutil.getClosePath())},endPath:function(){this.addPath(this.pathutil.getEndPath())},endClosePath:function(){this.addPath(this.pathutil.getEndClosePath())},addEllipse:function(a,b,c,f,
d){this.addPath(this.pathutil.getEllipse(a,b,c,f,d))},clearPathArray:function(){this.pathArray=[[]];this.pathNumber=0},addPath:function(a,b){b||(b=this.pathArray[this.pathNumber]);var c=[];m.each(a,function(f,d){c.push(d)});b.push(c)},createNewPath:function(){this.pathArray.push([]);this.pathNumber++},marker:{tailend:{open:function(a,b,c,f,d){c-=d;Shape.pathGenerator.marker.open(c,1,a,b,1,f)},block:function(a,b,c,f){this.marker.tailend.open(a,b,c,f,0);this.marker.block()},classic:function(a,b,c,f,
d,e){this.marker.tailend.open(a,b,c,f,0);this.marker.classic(0.4*e,b)},diamond:function(a,b,c,f){this.marker.diamond(a,b,c,f)}},headend:{open:function(a,b,c,f,d){Shape.pathGenerator.marker.open(1+d,1,a,b,c,f)},block:function(a,b,c,f){this.marker.headend.open(a,b,c,f,0);this.marker.block()},classic:function(a,b,c,f,d,e){this.marker.headend.open(a,b,c,f,0);this.marker.classic(0.6*e,b)},diamond:function(a,b,c,f){this.marker.diamond(a,b,c,f)}},open:function(a,b,c,f,d,e){Shape.pathGenerator.move(d,b);
Shape.pathGenerator.addLine(a,f);Shape.pathGenerator.moveLine(d,e)},block:function(){Shape.pathGenerator.closePath()},classic:function(a,b){Shape.pathGenerator.moveLine(a,b);Shape.pathGenerator.closePath()},diamond:function(a,b,c,f){Shape.pathGenerator.move(c,b);Shape.pathGenerator.addLine(a,1);Shape.pathGenerator.moveLine(1,b);Shape.pathGenerator.moveLine(a,f);Shape.pathGenerator.closePath()}},getMarkerPath:function(a,b,c,f,d){this.pathArray=[[]];this.pathNumber=0;c=parseFloat(c)+d;this.marker[a][b.toLowerCase()].call(this,
c*0.5,f*0.5,c-1,f-1,d,c);return this.convertToPath(this.pathArray)}}})(jQuery);(function(m){VectorUtil={attr:function(a,b,c){a.setAttributeNS(null,b,c)},getViewBoxDimensions:function(a,b){var c=a*Shape.viewboxConstant/Shape.boxConstant;if(typeof b=="undefined")return c;return[c,b*Shape.viewboxConstant/Shape.boxConstant]},getHTMLDimension:function(a){return a*Shape.boxConstant/Shape.viewboxConstant},set:function(a,b,c){if(c)this.attr(a,b,c);else{var f=this;m.each(b,function(d,e){f.attr(a,d,e)})}},get:function(a,b){if(typeof b=="string")return this.getAttr(a,b);else{var c=this,
f=[];m.each(b,function(d,e){f[e]=c.getAttr(a,e)});return f}},getAttr:function(a,b){return a.getAttributeNS(null,b)},getPathList:function(a){var b=a.props.geom,c;(c=b.type==m.ShapeConstants.ShapeGeometryType.PRESET?m.Preset[b.preset.type]?m.Preset[b.preset.type].pathList:undefined:b.custom.pathList)||(c=this.getDefaultPathList());if(!a.isStaticShape&&!a.noSelector)if((a.type==m.ShapeConstants.ShapeNodeType.SHAPE||a.type==m.ShapeConstants.ShapeNodeType.CONNECTOR)&&a.props.geom.preset){c=m.extend(true,
[],c);var f={fill:{fill:"NONE"},stroke:{type:"SELECTOR",fill:"SELECTOR"}};c[c.length]=f}else if(a.props.geom.custom){a=c;c=m.extend(true,[],c);f={fill:{fill:"NONE"},stroke:{type:"SELECTOR",fill:"SELECTOR"}};m.each(a,function(){c.push(f)})}return c},getDefaultPathList:function(){return[{fill:"NORMAL",stroke:{type:"SOLID"}}]},positionShape:function(a,b,c,f,d){var e=b[0]*0.5,g=b[1]*0.5,h=0;f=0;if(d==1){h=b[0];f=b[1]}else if(d==2)h=b[0];else if(d==3)f=b[1];a=zoho.math.getRotatedValue(a,h,f,e,g);h=c.x+
(h-a.x);c=c.y+(f-a.y);if(d==1){h-=b[0];c-=b[1]}else if(d==2)h-=b[0];else if(d==3)c-=b[1];return{left:h,top:c}},capitalise:function(a){return a.substr(0,1).toUpperCase()+a.substr(1)},getMinAndMax:function(a){var b=a[0].x,c=a[0].x,f=a[0].y,d=a[0].y;m.each(a,function(e,g){if(g.x>c)c=g.x;if(g.y>d)d=g.y;if(g.x<b)b=g.x;if(g.y<f)f=g.y});return{small:{x:b,y:f},big:{x:c,y:d}}},supportsSvg:function(){if(document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape","1.0"))return true;else if(document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure",
"1.1"))return true;return false},supportsColumn:function(){var a=document.body.style;if(a.MozColumnCount!==undefined||a.WebkitColumnCount!==undefined)return true;return false},convertRGBToString:function(a){return"rgb("+a[0]+","+a[1]+","+a[2]+")"},convertRGBStringToArray:function(a){a=a.split("(");a=a[1].split(")");return a=a[0].split(",")},isCalloutShape:function(a){var b=a.props.geom.type,c=[m.ShapeConstants.PresetShapeGeometry.CALLOUT,m.ShapeConstants.PresetShapeGeometry.RECTANGULAR_CALLOUT,m.ShapeConstants.PresetShapeGeometry.OVAL_CALLOUT,
m.ShapeConstants.PresetShapeGeometry.ROUNDED_RECTANGULAR_CALLOUT,m.ShapeConstants.PresetShapeGeometry.CLOUD_CALLOUT],f=false;if(b==m.ShapeConstants.ShapeGeometryType.PRESET){b=b.toLowerCase();m.each(c,function(d,e){if(a.props.geom[b].type==e){f=true;return false}})}return f},getShapeDimension:function(a){var b=VectorUtil.getViewBoxDimensions(a.props.transform.dim.width,a.props.transform.dim.height);if(a.props.geom&&VectorUtil.isCalloutShape(a)){a=m.extend(true,[],a.props.geom.preset.modifiers);a[0]=
a[0]*b[0]+b[0]*0.5;a[1]=a[1]*b[1]+b[1]*0.5;if(a[0]<0)b[0]+=-a[0];else if(a[0]>b[0])b[0]=a[0];if(a[1]<0)b[1]+=-a[1];else if(a[1]>b[1])b[1]=a[1]}return b},setScale:function(a,b,c,f){this.transform(a,c?c:"0% 0%",f?f:"scale("+b+")")},XOR:function(a,b){return(a||b)&&!(a&&b)},getImageURL:function(a){a=a.split("//");a=a[1]?a[1]:a[0];a=a.split("/");return a=a[a.length-1]},getImageDim:function(a,b,c){var f=VectorUtil,d=Math.uuid(),e=m("<img id="+d+" src="+a+' style="display:none;">');Shape.loadImageDiv.append(e);
e.one("load",function(){var g;if(c&&c.getOnlyImageStatus)c.imageLoaded=true;else{g=m(this);g={width:g.width(),height:g.height()};c&&c.box&&c.box.data("origImageDim",g)}b&&b(g,c,this);setTimeout(function(){f.removeImageEle(d)},100)}).each(function(){if(this.complete){var g=m(this);setTimeout(function(){g.trigger("load")},10)}}).one("error",function(){b&&b({width:0,height:0},c,this);if(!(typeof isOnLine==="undefined"?navigator.onLine:isOnLine)){this.src=m.Utils.OFFLINE_IMAGE_URL;if(typeof localStorage!==
"undefined"&&localStorage.getItem("OfflineSetupDone")==="true"&&typeof ZSOffline!=="undefined"){var g=m.Utils.getImageId(a);g&&ZSOffline.renderImage({image_id:g,url:a,rid:m.slideUtil.docInfo.RESOURCE_ID})}}})},removeImageEle:function(a){m("#"+a,Shape.loadImageDiv).remove()},isWingDingsSupported:function(){var a=false,b=m("<div style = 'position:absolute;left:-500px;top:-500px;z-index:10000;'></div>");a=m("<span style = 'font-size:18px;font-family:Wingdings;'></span>");b.append(a);a.html("&#97;&#97;&#97;&#97;");
m(document.body).append(b);a=b.width();a=a>=78&&a<=82;b.remove();return a},isTextRotateSupported:function(){var a=m("<div style='position:absolute;left:-1000px;top:-100px'></div>");m(document.body).append(a);var b=this.transform(a,"50% 50%","rotate(45deg) scale(0.7) translate(0px,0px)");a.remove();return b},rotateElement:function(a,b,c,f){if(a.length){if(typeof f=="object"){var d=f.rotate?f.rotate:0,e=f.dim;f=e.width*0.5-b.left;b=e.height*0.5-b.top;e=f+"px "+b+"px"}else{d=f?f:0;e=" 50% 50% ";f=0.5*
b.width;b=0.5*b.height}this.transform(a,e," rotate("+d+"deg) scale("+c+") translate("+-1*(f*(1-c)/c)+"px,"+-1*(b*(1-c)/c)+"px)")}},transform:function(a,b,c){var f=false,d=a[0];if(d){d=d.style;if(d.MozTransform!==undefined){a.css({MozTransformOrigin:b,MozTransform:c});f=true}else if(d.WebkitTransform!==undefined){a.css({WebkitTransformOrigin:b,WebkitTransform:c});f=true}else if(d["-ms-transform"]!==undefined){m.each(a,function(e,g){g.style["-ms-transform-origin"]=b;g.style["-ms-transform"]=c});f=true}else if(d.transform!==
undefined){a.css({"transform-origin":b,transform:c});f=true}return f}},selectAllText:function(a){if(document.body.createTextRange){var b=document.body.createTextRange();b.moveToElementText(a[0]);b.select()}else if(window.getSelection){var c=window.getSelection();if(c.setBaseAndExtent)c.setBaseAndExtent(a[0],0,a[0],1);else{b=document.createRange();b.selectNodeContents(a[0]);c.removeAllRanges();c.addRange(b)}}}}})(jQuery);(function(m){jQuery.fn.reverse=[].reverse;Shape={testing:false,iOSDevice:navigator.userAgent.indexOf("iPad")!=-1||navigator.userAgent.indexOf("iPhone")!=-1,touchDevice:navigator.userAgent.indexOf("iPad")!=-1||navigator.userAgent.indexOf("iPhone")!=-1||navigator.userAgent.indexOf("Android")!=-1,iOSSVGImageFillSupport:false,shapeClass:"shape_box",pathId:"path",shapeId:"shapegroup",reflectionShapeId:"reflectionshapegroup",shadowFilterId:"shadowfilter",imageFilterId:"imagefilter",groupDivId:"groupingDiv",
viewboxConstant:1E3,boxConstant:1E3,strokeWidth:2,groupShapeId:"groupShapeId",textbox:"tbox",textgroup:"textgroup",connector:"connector",handle:"handles",modifier:"modifiers",IsAconnector:"IsAconnector",isWingDingsSupported:undefined,isTextRotateSupported:undefined,isPointerEventSupported:undefined,selectorStrokeWidth:10,placeHolderIconId:"placeholderIcon",placeHolderVideoIconId:"placeholderVideoIcon",iconCapsuleId:"iconCapsule",webkit:navigator.userAgent.indexOf("Chrome")!=-1,placeHolderTwitterIconId:"placeholderTwitterIcon",
iconCapsuleEditIcon:"iconCapsuleEditIcon",ccImageIcon:"ccImageIcon",error:function(){if(Shape.testing)if(window.console){console.log(arguments);console.trace()}},log:function(){Shape.testing&&window.console&&console.log(arguments)},supportsPointerEvent:function(){var a=m("<div id='pointerEvent' style = 'position:absolute;left:0px;top:0px;width:50px;height:50px;z-index:10000000;'></div>"),b=m("<div id='pointerEvent' style = 'position:absolute;left:0px;top:0px;width:50px;height:50px;z-index:100000001;pointer-events:none;background-color:yellow;'></div>");
m(document.body).append(b);Shape.create.draw({nvOProps:{nvDProps:{id:"dummy"},nvODProps:{locks:{noMove:true,noSelect:true}}},props:{geom:{preset:{type:"RECT"},type:"PRESET"},fill:{solid:{color:{rgb:{0:192,1:80,2:77}}},type:"SOLID"},stroke:{fill:{solid:{color:{rgb:{0:192,1:80,2:77}}},type:"SOLID"},jointype:"ROUND",width:"1"},transform:{dim:{height:30,width:30},pos:{left:0,top:0,zindex:1},rotate:0}},type:"SHAPE"},a);m(document.body).append(a);var c=true,f=document.elementFromPoint(36,36);if(VectorUtil.supportsSvg()){if(f&&
f.nodeName.indexOf("path")==-1)c=false}else c=false;a.remove();b.remove();return c},init:function(a){if(VectorUtil.supportsSvg()){this.creator=SVGCreator;this.fillElement=SVGFill;this.strokeElement=SVGStroke;this.imageElement=SVGImage;this.effects=SVGEffects}else{document.namespaces.add("v","urn:schemas-microsoft-com:vml");document.createStyleSheet().addRule("v\\:*","behavior: url(#default#VML);");this.creator=VMLCreator;this.fillElement=VMLFill;this.strokeElement=VMLStroke;this.imageElement=VMLImage;
this.effects=VMLEffects}this.pathGenerator=new PathGenerator;if(this.touchDevice)this.selectorStrokeWidth=20;var b=m(document.body),c=m("<div></div>");c.css("display","table");b.append(c);this.displaySupport={};this.displaySupport.table=c.css("display")=="table"?true:false;c.css("display","table-cell");this.displaySupport.tableCell=c.css("display")=="table-cell"?true:false;c.remove();Shape.roughWork=m("<div id = 'roughWork' style='position:absolute;left:-1000px;top:-1000px'></div>");b.append(Shape.roughWork);
Shape.canvasArea=m('<canvas id="myCanvas" width="300" height="150"">');Shape.roughWork.append(Shape.canvasArea);c=m('<div id="clonetextbox" class = "prewrap" style="position:absolute;left:-10000px;top:-10000px;"></div>');b.append(c);Shape.cloneDiv=c;c=m("<div id=loadimage>");b.append(c);Shape.loadImageDiv=c;Shape.iOSSVGImageFillSupport=Shape.iOSDevice?!/OS [1-5](_[\d])+ like Mac OS X/i.test(navigator.userAgent):undefined;Shape.isTextRotateSupported=VectorUtil.isTextRotateSupported();Shape.isWingDingsSupported=
VectorUtil.isWingDingsSupported();Shape.isPointerEventSupported=Shape.supportsPointerEvent();a=a?a:[];m.each(a,function(f,d){if(!Shape.textBody.spaceSizeMap[d]){var e=String.fromCharCode(32),g=Shape.getFontSpaceSize(d,e);Shape.textBody.spaceSizeMap[d]={};Shape.textBody.spaceSizeMap[d][e]=g}})},getFontSpaceSize:function(a,b){var c=m("<span style='font-size:100px;'></span>");c.text(b);c.css("font-family",a);Shape.cloneDiv.append(c);var f=c.width();c.remove();return f/100},getFontHeight:function(a){var b=
m("<span style='font-size:100pt; display:inline-block; line-height:1.2em;'>M</span>");b.css("font-family",a);Shape.cloneDiv.append(b);a=b.height();b.remove();return a/100},createDiv:function(){return m("<div></div>")},createSpan:function(){return m("<span></span>")},create:{draw:function(a,b,c){var f=a.type;if(!a.nvOProps.nvDProps.hidden){var d=Shape.shapeClass;if(a.className)d=d+" "+a.className;var e=undefined,g=true;if(!c){var h=a.nvOProps.nvDProps.id;c=b.find("#"+h);if(c.length===0){g=false;c=
m("<div style= 'position:absolute;'></div>");c.attr({id:h,box_id:h});c.addClass(d)}else m.emptyBox(c);h=Shape.creator.getDefaultRoot();Shape.creator.set(h,{id:"root","class":"base_root"})}if(d=Shape.creator.createDefinitions(h)){e=m("<span id='svgcontainer' style='display:block;'>");e.append(h);c.append(e);m(h).append(d)}c.data("shapeType",f);a.editData?c.data("editData",true):c.data("editData",false);var j=Shape.creator.createGroup(c[0]);if(j){e=j;Shape.creator.set(j,{id:Shape.shapeId,"class":Shape.shapeId+
" group"});m(h).append(j);c.data("groupId",Shape.shapeId)}else{e=h;Shape.creator.set(e,{"class":Shape.shapeId+" group"});c.data("groupId","root")}Shape.create.addPath(a,c,e,d,"shape");Shape.props.transform.set(a,b,c);f&&f.toUpperCase()==m.ShapeConstants.ShapeNodeType.PICTURE?Shape.picture.set(a,b,c):Shape.props.fill.set(a,b,c);Shape.props.stroke.set(a,b,c);Shape.textBody.set(a,b,c);a.type!=m.ShapeConstants.ShapeNodeType.CONNECTOR&&Shape.props.effects.set(a,b,c);!g&&!a.doNotAppendToCont&&b.append(c);
a.nvOProps&&Shape.nvOProps.nvODProps.set(a,b,c);a.renderPlace&&c.data("parentType",a.renderPlace);c.data("shape_rendered",true);a.erasable==true&&c.data("erasable",true);Shape.create.placeHolder.icon.set(a,b,m(c));Shape.create.editData.icon.set(a,b,m(c));return m(c)}},editData:{icon:{set:function(a,b,c){var f=m("#"+Shape.iconCapsuleEditIcon,c),d=a.type==m.ShapeConstants.ShapeNodeType.PICTURE&&a.value&&a.value.license,e=a.props&&a.props.fill&&a.props.fill.type=="PICT"&&a.props.fill.pict.value&&a.props.fill.pict.value.license&&
(a.type==m.ShapeConstants.ShapeNodeType.SHAPE||a.type==m.ShapeConstants.ShapeNodeType.GROUPSHAPE);if(a.editData&&a.nvOProps.nvProps&&a.nvOProps.nvProps.embed||a.editData&&a.type==m.ShapeConstants.ShapeNodeType.PICTURE){var g=!!f.length;if(!m(c).hasClass("cropShape")){f.remove();g=false}if(g){g=a.editData;f.data("handler",g.handler);m(f).outerWidth();m(f).outerHeight(true);f[0].title=g.title}else this.handleImageIcon(a,b,c,Shape.iconCapsuleEditIcon,false);Shape.create.editData.icon.hide(a,b,c)}else this.remove(a,
b,c,c.find("#"+Shape.iconCapsuleEditIcon));if((d||e)&&a.ccData){this.handleImageIcon(a,b,c,Shape.ccImageIcon,true);Shape.create.editData.icon.hide(a,b,c)}else(a=c.find(".ccIconsShow"))&&a.length&&a.remove()},handleImageIcon:function(a,b,c,f,d){var e={width:0,height:0};b=a.props&&a.props.transform?a.props.transform:undefined;var g=m("<span id='"+f+"'></span>");if(f==Shape.iconCapsuleEditIcon){f=a.editData;iconClass=m(c).hasClass("cropShape")?f.iconDone:f.icon;g.data("handler",f.handler);g[0].title=
f.title}else if(d){g=m("#"+f,c);if(!g.length){g=m.i18n("show.editor.image.flickrlicensemsg",['<br/><span class="ui-cc-icon"></span>']);g=JSON.stringify({componentOptions:{content:g,contentType:"html"}});g=m("<span>").attr({title:g,id:f});iconClass="ccIconsShow"}}Shape.roughWork.append(g);g.addClass(iconClass);e.width=m(g).outerWidth();e.height=m(g).outerHeight(true);m(c).append(g);g.css({width:e.width,height:e.height});if(b){c=Shape.create.placeHolder.icon.position(b,g);f=g.hasClass("doneiconbutton")?
15:7;e=b&&b.rotate?b.rotate:0;if(b.rotate)g.css({"z-index":1E4,position:"absolute",left:c.left,top:c.top,"pointer-events":"auto",margin:"0px"});else d?g.css({"z-index":1E4,position:"absolute",left:"0px",top:"0px","pointer-events":"auto"}):g.css({"z-index":1E4,position:"absolute",left:c.left-f,top:"5px","pointer-events":"auto"});VectorUtil.rotateElement(g,{width:c.width,height:c.height},1,e)}},hide:function(a,b,c,f){c||(c=Shape.box(a,b));c.removeClass("showing");(a=c.find(".ccIconsShow"))&&a.length&&
a.hide();f&&f.length?f.hide():c.find("#"+Shape.iconCapsuleEditIcon).hide()},show:function(a,b,c,f){b.find(".placeholdereditbutton").stop().hide(0,function(){});c||(c=Shape.box(a,b));a=a.props.transform.dim;if(!(a.height<75||a.width<75)){c.addClass("showing");(a=c.find(".ccIconsShow"))&&a.length&&a.show();if(f&&f.length)f.fadeIn(500);else{c=c.find("#"+Shape.iconCapsuleEditIcon);c.hasClass("doneiconbutton")?c.show():c.fadeIn(500)}}},remove:function(a,b,c,f){(a=c.find(".ccIconsShow"))&&a.length&&a.remove();
f&&f.length?f.remove():c.find("#"+Shape.iconCapsuleEditIcon).remove()}}},placeHolder:{icon:{set:function(a,b,c){var f=a.nvOProps.nvODProps&&a.nvOProps.nvODProps.locks&&a.nvOProps.nvODProps.locks.noModify;if(a.placeHolder&&a.editable&&!f){var d=a.placeHolder.image,e=a.placeHolder.video,g=a.placeHolder.twitter,h=false;f=c.find("#"+Shape.iconCapsuleId);var j=!!f.length,l={width:0,height:0};if(!j){f=m("<div id='"+Shape.iconCapsuleId+"'></div>");Shape.roughWork.append(f)}var n=a.props.transform;if(d&&
d.render){var o=c.find("#"+Shape.placeHolderIconId),p=!!o.length;h=true;if(!p){o=m("<span id='"+Shape.placeHolderIconId+"'></span>");o.addClass(d.icon);f.append(o)}l.width=m(o).outerWidth(true);l.height=m(o).outerHeight(true);o.data("handler",d.handler);o[0].title=d.title}else this.remove(a,b,c,Shape.placeHolderIconId);if(e&&e.render){o=m("#"+Shape.placeHolderVideoIconId,c);p=!!o.length;h=true;if(!p){o=m("<span id='"+Shape.placeHolderVideoIconId+"'></span>");o.addClass(e.icon);f.append(o)}l.width+=
m(o).outerWidth(true);l.height=m(o).outerHeight(true);o.data("handler",e.handler);o[0].title=e.title}else this.remove(a,b,c,Shape.placeHolderVideoIconId);if(g&&g.render){o=c.find("#"+Shape.placeHolderTwitterIconId);p=!!o.length;h=true;if(!p){o=m("<span id='"+Shape.placeHolderTwitterIconId+"'></span>");o.addClass(g.icon);f.append(o)}l.width+=m(o).outerWidth(true);l.height=m(o).outerHeight(true);o.data("handler",g.handler);o[0].title=g.title}else this.remove(a,b,c,Shape.placeHolderTwitterIconId);if(h){j||
c.append(f);f.css({width:l.width,height:l.height});a=Shape.create.placeHolder.icon.position(n,f);f.css({"z-index":1E4,position:"absolute",left:a.left,top:a.top,"pointer-events":"auto"});VectorUtil.rotateElement(f,{width:a.width,height:a.height},1,n.rotate?n.rotate:0)}else this.remove(a,b,c)}else this.remove(a,b,c)},remove:function(a,b,c,f){if(f)(a=c.find("#"+f))&&a.length&&a.remove();else c.find("#"+Shape.iconCapsuleId).remove()},position:function(a,b){var c=m(b).height(),f=m(b).width(),d=a.dim.width,
e=d*0.5-f*0.5,g=a.dim.height*0.5-c*0.5,h=a.rotate?a.rotate:0,j=zoho.math.getRotatedValue(h,e,g,a.dim.width*0.5,a.dim.height*0.5);e=zoho.math.getRotatedValue(h,e+f*0.5,g+c*0.5,a.dim.width*0.5,a.dim.height*0.5);if(b.attr("id")=="iconCapsule")j=zoho.math.getRotatedValue(-1*h,j.x,j.y,e.x,e.y);else{j=b.attr("id")=="ccImageIcon"?0:d-f;j=zoho.math.getRotatedValue(h,j,0,e.x,e.y);h=zoho.math.getRotatedValue(1*h,0,0,f*0.5,c*0.5);j.x-=h.x;j.y-=h.y}return{left:j.x,top:j.y,width:f,height:c}}}},addPath:function(a,
b,c,f){a=VectorUtil.getPathList(a);var d=[],e=Shape;m.each(a,function(g,h){var j=Shape.pathId+g,l=Shape.props.stroke.selector(b,h),n=Shape.pathId;if(l)n=Shape.pathId+" selector";d.push(j);l=e.creator.createPath(b);e.creator.set(l,{id:j,"class":n});m(c).append(l);f||b.append(m(c))})}},box:function(a,b){return b.find("#"+a.nvOProps.nvDProps.id)},nvOProps:{nvDProps:{set:function(a,b){if(a.nvOProps.nvDProps.hidden){var c=Shape.box(a,b);c&&c.remove()}else Shape.create.draw(a,b)}},nvODProps:{set:function(a,
b,c){Shape.nvOProps.nvODProps.locks.set(a,b,c)},locks:{set:function(a,b,c){c=!c?Shape.box(a,b):c;var f=a.nvOProps.nvODProps;if(f&&f.locks){f.locks.noModify?c.data("lock",true):c.data("lock",false);b.trigger("shape_locked/unlocked",a)}},dependency:function(a,b,c){c=!c?Shape.box(a,b):c;if(a.nvOProps.nvODProps.locks&&a.nvOProps.nvODProps.locks.noModify&&a.nvOProps.nvODProps.locks.noModify){Shape.create.placeHolder.icon.remove(a,b,c);Shape.create.editData.icon.remove(a,b,c)}else{Shape.create.placeHolder.icon.set(a,
b,c);Shape.create.editData.icon.set(a,b,c)}},remove:function(a,b,c){c=!c?Shape.box(a,b):c;c.data("lock",false);a.nvOProps.nvODProps&&b.trigger("shape_locked/unlocked",a)}}},remove:function(){}},props:{set:function(a,b,c){Shape.props.transform.set(a,b,c);Shape.props.fill.set(a,b,c);Shape.props.stroke.set(a,b,c);Shape.props.effects.set(a,b,c)},dependency:function(a,b,c){a.type===m.ShapeConstants.ShapeNodeType.PICTURE&&Shape.picture.set(a,b,c);a.textBody&&Shape.textBody.textBodyDimensionChange(a,b,c)},
remove:function(a,b){Shape.props.set(a,b)},anim:{set:function(){},remove:function(){}},transform:{set:function(a,b,c,f){c=!c?Shape.box(a,b):c;if(c.length){var d=a.props.transform,e=this;m.each(d,function(g,h){typeof h=="object"&&e[g].set.call(e,a,b,c,f)});this.setAttr(d,c,f,a)}},dependency:function(a,b,c,f){c=!c?Shape.box(a,b):c;if(c.length){if(a.props.effects){Shape.props.effects.shadow.set(a,b,c);Shape.props.effects.reflection.set(a,b,c)}if(a.props.fill&&a.props.fill.type!==m.ShapeConstants.FillType.SOLID&&
a.props.fill.type!==m.ShapeConstants.FillType.NONE){Shape.props.fill.set(a,b,c);Shape.props.fill.dependency(a,b,c)}a.type===m.ShapeConstants.ShapeNodeType.PICTURE&&Shape.pictureProps.fill(a,b,c);a.type===m.ShapeConstants.ShapeNodeType.CONNECTOR&&Shape.creator.marker(a,b,c);a.textBody&&!f&&Shape.textBody.textBodyDimensionChange(a,b,c);Shape.create.placeHolder.icon.set(a,b,c);Shape.create.editData.icon.set(a,b,c)}},setAttr:function(a,b,c,f){this.rotate(a,b,c,f);this.flip(a,b,c)},rotate:function(a,b,
c){a.rotate=a.rotate?a.rotate:0;c=Shape.creator.pathContainer(b,c);Shape.creator.rotateShape(a.rotate,m(c),a.dim);Shape.props.transform.rotateText(b,a)},rotateText:function(a,b){if(Shape.isTextRotateSupported){var c=a.data(Shape.textbox);if(c){c=Shape.textBody.updateDimension(c,b);Shape.creator.rotateTextElement(a,c,b)}}},flip:function(a,b,c){val=a.fliph&&!a.flipv?"x":!a.fliph&&a.flipv?"y":a.fliph&&a.flipv?"both":"none";b=Shape.creator.pathContainer(b,c);Shape.creator.flipShape(b,val,a.dim,a.rotate)},
pos:{set:function(a,b,c){c=!c?Shape.box(a,b):c;if(c.length){a=a.props.transform.pos;typeof a.zindex!="undefined"&&c.css({"z-index":a.zindex});c.css({left:a.left,top:a.top})}}},dim:{set:function(a,b,c,f){c=!c?Shape.box(a,b):c;if(c.length){var d=a.props.transform.dim;if(f=Shape.creator.getRoot(c,f)){Shape.creator.setRoot(f,d.width,d.height,b,a);Shape.creator.setShapeDimension(c,d.width,d.height);Shape.props.geom.set(a,b,c)}}},dependency:function(a,b,c){c=!c?Shape.box(a,b):c;if(c.length){Shape.props.transform.dependency(a,
b,c);Shape.props.transform.rotate(a.props.transform,c,undefined,a)}}}},geom:{set:function(a,b,c){c=!c?Shape.box(a,b):c;this[a.props.geom.type.toLowerCase()].set.call(this,a,b,c)},dependency:function(a,b,c){Shape.props.transform.dependency(a,b,c)},preset:{set:function(a,b,c){c=!c?Shape.box(a,b):c;var f=Shape.props.geom.preset._set(a);Shape.props.geom.setPath(a,b,c,f)},_set:function(a){var b=a.props.geom.preset;a=a.props.transform.dim;return Shape.pathGenerator.getPath(b.type,a.width,a.height,b.modifiers&&
b.modifiers.length?b.modifiers:m.Preset[b.type].modifiers)},remove:function(a,b,c){Shape.props.geom.preset.set(a,b,c)}},custom:{set:function(a,b,c){c=!c?Shape.box(a,b):c;var f=a.props.transform.dim;f=Shape.pathGenerator.getCustomPath(a.props.geom.custom,f.width,f.height);Shape.props.geom.setPath(a,b,c,f)}},setPath:function(a,b,c,f){var d=Shape.creator.getAvailableGroups(c);m.each(d,function(e,g){m.each(f.path,function(h,j){var l=m(g).find("#"+Shape.pathId+h);l.length&&Shape.creator.setPath(l[0],j)})});
delete f.path;m.each(f,function(e,g){c.removeData(e);g&&c.data(e,g)});Shape.textBody.setDimension(a,b,c)}},fill:{type:undefined,set:function(a,b,c,f){c=!c?Shape.box(a,b):c;var d=f&&f.fillData?f.fillData:a.props.fill;d||(d={type:"NONE"});d=d.type.toLowerCase();Shape.props.fill[d].set.call(Shape.props.fill,a,b,c,f)},dependency:function(a,b,c){c=!c?Shape.box(a,b):c;if(a.props.effects){Shape.props.effects.shadow.set(a,b,c);Shape.props.effects.reflection.set(a,b,c)}Shape.create.editData.icon.set(a,b,m(c))},
_setfill:function(a,b,c,f){var d=f&&f.fillData?f.fillData:a.props.fill,e=f&&f.name?f.name:"fill";b=f&&f.pathId?f.pathId:undefined;var g=d.type.toLowerCase();d=d[g];var h=Shape,j="",l=VectorUtil.getPathList(a),n=b;b=Shape.creator.pathContainer(c,b);if(f&&f.type==="reflection"){j=f.type;n=f.groupId?f.groupId:Shape.reflectionShapeId;b=c.find("#"+n)}e||(e="fill");m.each(b,function(o,p){m.each(l,function(r,q){var s=m(p).find("#path"+r),t=m.extend(true,{},d);if(e==="stroke"&&q.stroke&&q.stroke.fill!=="SELECTOR"&&
q.stroke.fill!=="NONE"&&a.props.geom.preset.type=="TABLECELL"){q.stroke={};q.stroke.fill="CUSTOM";q.stroke.data=a.TableCellBorders[r-1]}q=q[e];var u={},v=m(p).find("#"+Shape.pathId+r);s=v;if(q)if(q.fill=="NONE"){h.props.fill.type="none";h.props.fill.none._none.call(h.props.fill,s,{none:"none"},e+"Element",v,c);return true}else if(q.fill=="SELECTOR"){h.props.fill.type="solid";h.props.fill.solid._solid.call(h.props.fill,s,{color:{tweaks:{alpha:1},rgb:"rgb(255, 255, 255)"}},e+"Element",v,c);return true}else if(q.fill==
"CUSTOM"){t={color:{tweaks:{alpha:0},rgb:"rgb(255, 255, 255)"}};if(q.data){t.color=q.data.fill.solid.color;h.converter.convert(g,t,u)}else t={none:"none"};h.props.fill.type="solid";h.props.fill.solid._solid.call(h.props.fill,s,t,e+"Element",v,c);return true}else if(q.tweaks&&!j.length)u=q.tweaks;h.converter.convert(g,t,u);h.props.fill.type=g;h.props.fill[g]["_"+g].call(h.props.fill,s,t,e+"Element",v,c,a)})})},grp:{set:function(){},_grp:function(){}},solid:{set:function(a,b,c,f){c=!c?Shape.box(a,b):
c;(f&&f.fillData?f.fillData:a.props.fill).type==="PICT"?Shape.props.fill.pict.set(a,b,c,f):Shape.props.fill._setfill(a,b,c,f)},_solid:function(a,b,c,f,d,e){var g=Shape,h=g.creator[c](a);b=m.extend(true,{},{color:{tweaks:{alpha:0}}},b);m.each(b.color,function(j,l){var n=Shape[c][g.props.fill.type][j];n&&n.call(Shape[c],h,l,a,f,d,e)})}},none:{set:function(a,b,c,f){c=!c?Shape.box(a,b):c;var d={};d.fillData={type:m.ShapeConstants.FillType.NONE};f=m.extend(true,f,d);Shape.props.fill._setfill(a,b,c,f)},
_none:function(a,b,c,f,d,e){b=Shape;var g=b.creator[c](a);b[c].none.call(b[c],g,a,f,d,e)}},gradient:{set:function(a,b,c,f){c=!c?Shape.box(a,b):c;(f&&f.fillData?f.fillData:a.props.fill).type==="PICT"?Shape.props.fill.pict.set(a,b,c,f):Shape.props.fill._setfill(a,b,c,f)},dependency:function(a,b,c){c=!c?Shape.box(a,b):c;if(a.props.effects){a.props.effects.shadow&&Shape.props.effects.shadow.color.set(a,b,c);Shape.props.effects.reflection.set(a,b,c)}},_gradient:function(a,b,c,f,d,e){var g=Shape,h=b.type.toLowerCase();
if(h!=="radial")h="linear";var j=m(a).data(g.creator.fillId);if(j){d.find("#"+j).remove();m(a).data(g.creator.fillId,null)}var l=g.creator.fillElement(a,d,g.props.fill.type,h);m.each(b,function(n,o){if(h!="radial"&&n=="radial")return true;var p=g[c][g.props.fill.type][n];if(p){var r=o;if(n==="stops")r=g.props.fill.gradient.sortStopArr(m.extend(true,[],o));p.call(g[c],l,r,a,f,e.props,h)}})},sortStopArr:function(a){var b=[],c={},f=[];m.each(a,function(d,e){c[e.position]=e;f[f.length]=e.position});zoho.array.sort(f);
m.each(f,function(d,e){b[b.length]=c[e]});return b}},pict:{set:function(a,b,c,f){var d=Shape,e=f&&f.fillData?f.fillData:a.props.fill;c=!c?Shape.box(a,b):c;if(e.pict&&e.pict.value){a={data:a,container:b,box:c,object:f};b=undefined;if(e.pict.value.type==="USERDEFINED")b=e.pict.value.dim;if(b){c.data().origImageDim=b;d.props.fill.pict._set(b,a)}else VectorUtil.getImageDim(e.pict.value.url,d.props.fill.pict._set,a)}},dependency:function(a,b,c){c=!c?Shape.box(a,b):c;Shape.props.effects.set(a,b,c)},_set:function(a,
b){var c=b.object&&b.object.fillData?b.object.fillData:b.data.props.fill;c.pict.value.width=a.width;c.pict.value.height=a.height;Shape.props.fill._setfill(b.data,b.container,b.box,b.object)},remove:function(){},_pict:function(a,b,c,f,d,e,g){var h=Shape,j=h.creator.fillElement(a,d,"pattern","pattern");b=m.extend(true,{props:{alpha:0}},b);m.each(b,function(l,n){if(l==="type"){h.props.fill.pict._setPictureType(j,n,b,c,a,e,g);return true}var o=h[c][h.props.fill.type][l];o&&o.call(h[c],j,n,a,f,e.props,
d)})},_setPictureType:function(a,b,c,f,d,e,g){var h=Shape,j=b.type.toLowerCase();b=b[j];b=h.props.fill.pict["_"+j+"Object"].call(h,b,c,e,g);h[f][h.props.fill.type][j].call(h[f],a,b,d,e.props)},_frameObject:function(a,b,c){a=m.extend(true,{left:0,right:0,top:0,bottom:0},a);this.props.fill.pict.updateFrameObj(c,a);return a},_tileObject:function(a,b){var c=m.extend(true,{offsetX:0,offsetY:0,scale:{x:1,y:1}},a),f=VectorUtil.getViewBoxDimensions(b.value.width,b.value.height);c.scale.x*=f[0];c.scale.y*=
f[1];return c},updateFrameObj:function(a,b){if(!VectorUtil.isCalloutShape(a))return b;var c=m.extend(true,[],a.props.geom.preset.modifiers),f=parseFloat(c[0]);c=parseFloat(c[1]);var d=1-(Math.abs(f)+0.5),e=1-(Math.abs(c)+0.5);if(f<-0.5)b.left+=d;else if(f>0.5)b.right+=d;if(c<-0.5)b.top+=e;else if(c>0.5)b.bottom+=e;return b}}},stroke:{defaultStroke:{type:m.ShapeConstants.StrokeType.SQUARE_DOT,width:2,fill:{type:m.ShapeConstants.FillType.SOLID,solid:{color:{rgb:[111,111,111]}}},captype:m.ShapeConstants.CapType.FLAT},
set:function(a,b,c,f){c=!c?Shape.box(a,b):c;if(a.props.stroke){if(a.editable&&a.placeHolder&&a.textBody&&a.textBody.paras.length===1&&!a.textBody.paras[0].portions[0].t||a.editable&&a.placeHolder&&a.placeHolder.image&&a.placeHolder.image.render)if(!a.props.stroke.fill||a.props.stroke.fill.type===m.ShapeConstants.FillType.NONE)f={data:m.extend(true,{},this.defaultStroke)};var d=f&&f.data?f.data:a.props.stroke;if(!d.jointype)d.jointype=m.ShapeConstants.JoinType.ROUND;d.width=d.width?d.width:0;var e=
this;m.each(d,function(g,h){typeof h=="object"&&e[g].set.call(e,a,b,c,f)});this.setAttr(a,c,d,f)}},dependency:function(a,b,c){c=!c?Shape.box(a,b):c;if(a.props.effects){Shape.props.effects.shadow.set(a,b,c);Shape.props.effects.reflection.set(a,b,c)}},tailend:{set:function(a,b,c){c=c?c:Shape.box(a,b);Shape.props.stroke.marker(a,c,"tailend")}},headend:{set:function(a,b,c){c=c?c:Shape.box(a,b);Shape.props.stroke.marker(a,c,"headend")}},marker:function(a,b,c){var f=a.props.stroke;if(!(a.type!==m.ShapeConstants.ShapeNodeType.CONNECTOR||
!f.fill||f.fill&&f.fill.type==m.ShapeConstants.FillType.NONE)){var d=a.props.stroke[c];if(d){var e=VectorUtil.getPathList(a);m.each(e,function(g){g=b.find("#"+Shape.pathId+g);Shape.strokeElement[c](d,g,f.width,a)})}}},setAttr:function(a,b,c,f){var d=VectorUtil.getPathList(a);if(f&&f.type=="text")d=VectorUtil.getDefaultPathList();var e=Shape.creator.pathContainer(b,f&&f.pathId?f.pathId:undefined);if(f&&f.type==="reflection")e=b.find("#"+(f.groupId?f.groupId:Shape.reflectionShapeId));var g=a.selectorStrokeWidth?
a.selectorStrokeWidth:Shape.selectorStrokeWidth;m.each(e,function(h,j){j=m(j);m.each(d,function(l,n){var o=j.find("#"+Shape.pathId+l);if(n.stroke&&n.stroke.fill!=="SELECTOR"&&n.stroke.fill!=="NONE"&&a.props.geom.preset.type=="TABLECELL"){c=a.TableCellBorders[l-1];if(!c){c=m.extend(true,{},Shape.props.stroke.defaultStroke);c.width=0;c.fill.type="NONE";delete c.fill.solid}}var p=c;if(Shape.props.stroke.selector(b,n)){p=m.extend(true,{},c);p.width=c.width+g;p.type=m.ShapeConstants.StrokeType.SOLID}var r=
Shape.creator.strokeElement(o);if(n.stroke&&n.stroke.fill=="NONE")return true;m.each(p,function(q,s){if(typeof s!="object")if(Shape.strokeElement[q]){var t=Shape.strokeElement[q].call(Shape.strokeElement,s,o,o,c.width,a);Shape.creator.set(r,t)}})})})},fill:{set:function(a,b,c,f){c=!c?Shape.box(a,b):c;var d=f&&f.type?f.type:a.type,e=(f&&f.data?f.data:a.props.stroke).fill;e||(e={type:"NONE"});f||(f={});f=m.extend({},f,{fillData:e,name:"stroke",type:d});Shape.props.fill.set(a,b,c,f)},dependency:function(a,
b,c){Shape.props.stroke.dependency(a,b,c)}},selector:function(a,b){if(b.stroke&&b.stroke.type=="SELECTOR")return true;return false}},effects:{set:function(a,b,c){if(a.props.effects){Shape.props.effects.shadow.set(a,b,c);a.pdfVariables&&a.pdfVariables.noReflection||Shape.props.effects.reflection.set(a,b,c)}},remove:function(a,b,c){Shape.props.effects.shadow.remove(a,b,c);Shape.props.effects.reflection.remove(a,b,c)},setPath:function(a,b,c,f){b=a.props.geom;a=a.props.transform.dim;a=b.type===m.ShapeConstants.ShapeGeometryType.PRESET?
Shape.pathGenerator.getPath(b.preset.type,a.width,a.height,b.preset.modifiers):Shape.pathGenerator.getCustomPath(b.custom,a.width,a.height);m.each(a.path,function(d,e){var g=m(f).find("#"+Shape.pathId+d);g.length&&Shape.creator.setPath(g[0],e)})},shadow:{remove:function(a,b,c){c=!c?Shape.box(a,b):c;Shape.creator.removeShadowFilter(c)},preset:{set:function(){},remove:function(){}},set:function(a,b,c){c=!c?Shape.box(a,b):c;var f=a.props.effects;f=f?f.shadow:undefined;var d=Shape.props.effects.shadow;
if(f){var e,g=c.data("shadowType"),h=typeof g!=="undefined";e=g===f.type;g=c.find("g");if(h&&e){h=c.data(Shape.shadowFilterId);e=c.find("#filter_"+h)}else{c.data("shadowType",f.type);if(h){h=c.data(Shape.shadowFilterId);e=c.find("#filter_"+h);e.empty()}else{h=Math.uuid();c.data(Shape.shadowFilterId,h);c.find("#"+Shape.shadowFilterId);e=Shape.creator.createFilterElement(c,Shape.shadowFilterId)}Shape.creator.createShadowFilter[f.type.toLowerCase()](c)}for(e=0;e<g.length;e++)m(g[e]).attr("filter","url(#filter_"+
h+")");Shape.props.transform.set(a,b,c,Shape.shapeId);m.each(f,function(j){d[j]&&d[j].set.call(d,a,b,c)})}else d.remove(a,b,c)},dependency:function(a,b,c){c=!c?Shape.box(a,b):c;Shape.props.effects.reflection.set(a,b,c)},distance:{_getTranslate:function(a){var b=a.props.transform,c=a.props.effects.shadow;a=c.type;c=c.distance;var f=c.angle?c.angle:0;c=c.radius?c.radius:0;c=VectorUtil.getViewBoxDimensions(c);b=f-(b.rotate?b.rotate:0);if(b<0)b=360+b;f=zoho.math.toRadians(b%360);b=Math.round(c*Math.cos(f));
c=Math.round(c*Math.sin(f));if(a===m.ShapeConstants.ShadowType.INNER){b=-b;c=-c}return{x:b,y:c}},set:function(a,b,c){c=!c?Shape.box(a,b):c;if(a.props.effects.shadow){a=Shape.props.effects.shadow.distance._getTranslate(a);b=c.data(Shape.shadowFilterId);c=c.find("#filter_"+b);Shape.creator.setTransformPosition(c,a)}},dependency:function(a,b,c){c=!c?Shape.box(a,b):c;Shape.props.effects.shadow.color.set(a,b,c);Shape.props.effects.shadow.dependency(a,b,c)}},color:{set:function(a,b,c){c=!c?Shape.box(a,
b):c;if(a.props.effects.shadow){a=a.props.effects.shadow.color;b=c.data(Shape.shadowFilterId);c=c.find("#filter_"+b);Shape.props.effects.shadow.color.transparency(c,a)}},dependency:function(a,b,c){Shape.props.effects.shadow.dependency(a,b,c)},transparency:function(a,b){Shape.creator.setShadowColor(a,b,b.tweaks?1-b.tweaks.alpha:1)}},blur:{set:function(a,b,c){c=!c?Shape.box(a,b):c;Shape.props.effects.shadow.blur.radius(a,b,c)},radius:function(a,b,c){c=!c?Shape.box(a,b):c;a=a.props.effects.shadow.blur.radius;
a=Math.round(0.2*(a?a:1));b=c.data(Shape.shadowFilterId);c=c.find("#filter_"+b);Shape.creator.setGaussianConvolution(c,a)}}},reflection:{remove:function(a,b,c){c=!c?Shape.box(a,b):c;a=c.find(".reflectiongroup");b=a.find(".path");var f=Shape;m.each(b,function(d,e){f.creator.deleteFillElement(c,e)});a.remove();c.data(Shape.reflectionShapeId+"Id","")},preset:{remove:function(){}},set:function(a,b,c){c=!c?Shape.box(a,b):c;var f,d;if(a.props.effects)if(a.props.effects.groupReflection){f=a.props.effects.groupReflection;
d=true}else f=a.props.effects.reflection;Shape.props.effects.reflection.remove(a,b,c);if(!(!f||m.isEmptyObject(f))){a.props.effects[d?"groupReflection":"reflection"]=m.extend(true,{distance:{radius:0},pos:{end:1},alpha:{st:1}},f);Shape.props.effects.reflection.applyProperty(a,b,c);b=typeof c.data("shadowType")!=="undefined";a=c.find("g");if(b)for(b=0;b<a.length;b++)m(a[b]).attr("filter","url(#filter_"+c.data(Shape.shadowFilterId)+")")}},getElement:function(a,b,c,f){var d=f.data(a+"Id");if(d&&d.length)return f.find("#"+
a);return Shape.props.effects.reflection.createElement(b,c,f,a)},createElement:function(a,b,c,f){var d=Shape.creator.pathContainer(c).attr("id");d=c.find("#"+d);d=Shape.props.effects.reflection.createGroup(a,b,c,m(d),f,"reflectiongroup");var e={},g=c.find("#defs");g=g.length?g:undefined;Shape.create.addPath(a,c,d,g,"reflection");Shape.props.effects.setPath(a,b,c,d);g=a.type;e.pathId=Shape.reflectionShapeId;e.type="reflection";e.groupId=Shape.reflectionShapeId;Shape.props.transform.set(a,b,c,Shape.reflectionShapeId);
g&&g.toUpperCase()==m.ShapeConstants.ShapeNodeType.PICTURE?Shape.picture.set(a,b,c,e):Shape.props.fill.set(a,b,c,e);Shape.props.stroke.set(a,b,c,e);c.data(f+"Id",f);return m(d)},createGroup:function(a,b,c,f,d,e){var g=Shape.creator.createGroup(c[0]);g||(g=Shape.creator.getDefaultRoot());Shape.creator.set(g,{id:d,"class":e+" group"});d=a.props.transform.dim;c=c.find("#defs");(c=c.length?c:undefined)||Shape.creator.setRoot(g,d.width,d.height,b,a);m(g).insertBefore(f);return g},applyProperty:function(a,
b,c,f,d){f=a.props.effects&&a.props.effects.groupReflection?a.props.effects.groupReflection:a.props.effects.reflection;d={};d.alpha=f.alpha.st;d.distance=f.distance.radius;d.strokeWidth=a.props.stroke&&a.props.stroke.width?a.props.stroke.width:0;d.angle=90;d.size=f.pos.end;d.mask=f.pos.mask;d.group=Shape.creator.pathContainer(c);d.reflectionGroup=Shape.props.effects.reflection.getElement(Shape.reflectionShapeId,a,b,c);m.each(["alpha","position","distance"],function(e,g){Shape.effects.reflection[g].call(this,
a,b,c,d)})}}}},picture:{set:function(a,b,c,f){c=!c?Shape.box(a,b):c;Shape.imageElement.set(a,c,f);Shape.imageElement.crop(a,c,f);Shape.imageElement.pictureProps(a,c,f)}},pictureProps:{set:function(a,b,c,f){c=!c?Shape.box(a,b):c;Shape.imageElement.pictureProps(a,c,f)},dependency:function(a,b,c){c=!c?Shape.box(a,b):c;Shape.props.effects.set(a,b,c)},luminance:{set:function(a,b,c){c=!c?Shape.box(a,b):c;Shape.pictureProps.set(a,b,c)},dependency:function(a,b,c){Shape.pictureProps.dependency(a,b,c)}},colorMode:{set:function(a,
b,c){c=!c?Shape.box(a,b):c;Shape.pictureProps.set(a,b,c)},dependency:function(a,b,c){Shape.pictureProps.dependency(a,b,c)}},colorChange:{set:function(a,b,c){c=!c?Shape.box(a,b):c;Shape.pictureProps.set(a,b,c)},dependency:function(a,b,c){Shape.pictureProps.dependency(a,b,c)}},getContrast:function(a){a<0||(a*=10);a+=1;return a},fill:function(a,b,c){var f=a.url;f?Shape.imageElement.fill(a,c,{url:f}):Shape.picture.set(a,b,c)},alpha:{set:function(a,b,c,f){c=!c?Shape.box(a,b):c;Shape.imageElement.alpha(a,
c,f)},dependency:function(a,b,c){Shape.pictureProps.dependency(a,b,c)}},remove:function(a,b,c){c=!c?Shape.box(a,b):c;Shape.picture.set(a,b,c)}},crop:{set:function(a,b,c,f){c=!c?Shape.box(a,b):c;Shape.imageElement.crop(a,c,f)},dependency:function(a,b,c){c=!c?Shape.box(a,b):c;Shape.props.effects.set(a,b,c)}},converter:{convert:function(a,b,c){this[a]&&this[a].call(this,b,c)},solid:function(a,b){a.color.rgb=zoho.color.tweak(a.color.rgb,b);a.color.rgb=VectorUtil.convertRGBToString(a.color.rgb)},gradient:function(a,
b){m.each(a.stops,function(c,f){f.color.rgb=zoho.color.tweak(f.color.rgb,b);f.color.rgb=VectorUtil.convertRGBToString(f.color.rgb)})}},textBody:{heightMap:{},getTextContainerHeight:function(a){a=Shape.props.geom.preset._set(a).tbox;return{left:a[0],top:a[1],width:a[2]-a[0],height:a[3]-a[1]}},getBulletWidth:function(a){var b=0,c=a.textBody.paras[a.textBody.paras.num].style.listStyle;if(c&&c.bullet&&c.bullet.type!==m.ShapeConstants.BulletType.NONE){b=Shape.textBody.paras.style.listStyle;var f=m('<span id="bullet" class="bullet"></span>');
b._setListStyleProps(a,f);b.bullet[c.bullet.type.toLowerCase()]._set.call(this,a,f);Shape.cloneDiv.append(f);b=f.width();f.remove()}return b},calculateTextSize:function(a,b,c){a.textBody.props.inset=m.extend(true,{left:9.6,right:9.6,top:4.8,bottom:4.8},a.textBody.props.inset);a.textBody.props.column=m.extend(true,{num:1,gap:0},a.textBody.props.column);var f=a.textBody.props.inset,d=a.textBody.props.column,e=this.getTextContainerHeight(a),g=Math.ceil(e.width-(f.left+f.right)-(d.num-1)*d.gap),h=[];
d=a.textBody.props.inset.top+a.textBody.props.inset.bottom;f=f.left+f.right;var j=0;m.each(a.textBody.paras,function(l,n){a.textBody.paras.num=l;var o=[],p={},r=n.style,q=r.margin&&r.margin.left?r.margin.left:0,s=Shape.textBody.getBulletWidth(a);paraWidth=g-q;r=Shape.textBody.paras.portions.t.line.getFirstLineWidth({lineWidth:paraWidth,paraStyle:r,bulletWidth:s,paraMargin:q});var t=g-r,u=g+1,v=false,w=false;n.style.spacing.line.type.toLowerCase();m.each(n.portions,function(x){n.portions.num=x;var y=
0,A=Shape.textBody.paras.portions.t.getWordObjectToRender(a,b,c),E=A.length,D;for(k=0;k<E;k++){word=A[k];if(word.type==="LINEBREAK"){w=true;var C=Shape.textBody.zeroWidthSpaceText;D=Shape.textBody.paras.portions.t.words.getDim(C,a,l,x);y=D.height}else{C=word.type==="SPACE"?Shape.textBody.zeroWidthSpaceText:word.text?word.text.trim():"";D=Shape.textBody.paras.portions.t.words.getDim(C,a,l,x);if(D.width+t>u){w=true;var F=m.extend(true,{},word);if(v){A.splice(k+1,0,F);E=A.length}else{C=Shape.textBody.paras.portions.t.splitWord(C,
u-t,{textCase:D.textCase,font:D.font});D=Shape.textBody.paras.portions.t.words.getDim(C.text1,a,l,x);y=D.height;t+=D.width;if(C.text2.length){F.text=C.text2;A.splice(k+1,0,F);E=A.length}}}else{t+=D.width;y=D.height;D=word.space?Shape.textBody.paras.portions.t.words.getSpaceDimension(word.space):0;if(t+D>u)w=true;else{t+=D;if(D>0||word.type===Shape.textBody.lang.EAST_ASIAN)v=true}}}p.height=!p.height||p.height<y?y:p.height;if(w){j=t>j?t:j;u=g+1;t=q;o.push(m.extend(true,{},p));y=0;p={};w=v=false}}if(x===
n.portions.length-1&&y){j=t>j?t:j;o.push(m.extend(true,{},p));p={}}else y||Shape.log("Impossible case..")});h.push(o)});e=this.applyStyleProps(h,a);e.totalHeight=Math.ceil(e.totalHeight+d);e.totalWidth=Math.ceil(j+f);return e},applyStyleProps:function(a,b){var c=0,f=b.textBody.props;m.each(a,function(d,e){var g=b.textBody.paras[d],h=g.style.spacing.line,j=h.type.toLowerCase(),l=h[j];if(f&&f.autoFit&&f.autoFit.type==="NORMAL"&&f.autoFit.normal.lineSpaceScale)l*=f.autoFit.normal.lineSpaceScale;var n=
g.style.spacing.before,o=g.style.spacing.after;m.each(e,function(p,r){var q=afterVal=0;if(r.height){r.height=j==="percent"?l*r.height:l;if(d&&!p)if(n){var s=n.type.toLowerCase();q=s==="percent"?n[s]*r.height:n[s]}if(p===e.length-1&&d!==a.length-1)if(o){s=o.type.toLowerCase();afterVal=o[s];afterVal=s==="percent"?o[s]*r.height:o[s]}r.height=Math.ceil(r.height+q+afterVal);c+=r.height}})});return{totalHeight:c,textBody:a}},_test:function(a,b){var c=this;b=b?b:ShapeEditor.select.shapes[0].box;var f=a.textBody.element;
f=f?f:b.find("#"+Shape.textBody.textContainer);var d=ShapeEditor.text.composer.position.length?ShapeEditor.text.composer.position:f.data("position"),e=c.sumOfArray(f.data(Shape.textBody.indexId));d=d[d.length-1][d[d.length-1].length-1];if(e!==d){Shape.log(e,d);Shape.log(a.nvOProps.nvDProps.id,"----\>",f.data(Shape.textBody.indexId),f.data("position"));f=m("."+Shape.textBody.paraId,f);m.each(f,function(g,h){h=m(h);Shape.log("paras ---------------------\>>>",h.data(Shape.textBody.indexId),c.sumOfArray(h.data(Shape.textBody.indexId)));
var j=m("."+Shape.textBody.lineId,h);m.each(j,function(l,n){n=m(n);Shape.log("      line-------------------\>>>",n.data(Shape.textBody.indexId),c.sumOfArray(n.data(Shape.textBody.indexId)));var o=m("."+Shape.textBody.wordId,n);m.each(o,function(p,r){r=m(r);m("."+Shape.textBody.subwordId,r).length&&Shape.log("            word----------------\>>>",r.data(Shape.textBody.indexId),c.sumOfArray(r.data(Shape.textBody.indexId)))})})})}},sumOfArray:function(a,b){var c=0;if(b&&b<0)return c;m.each(a,function(f,
d){if(f>b)return false;c+=d});return c},textContainer:"textcontainer",tbox:"textbox",innerbox:"innerbox",bullet:"bullet",bulletSplitterId:"bulletSplitter",paraId:"para",wordId:"word",subwordId:"subwords",lineId:"line",subportionId:"subportion",columnId:"text_column",dimensionId:"dimension",portionprops:{bold:{"font-weight":"bold"},italic:{"font-style":"italic"}},hyphenText:m("<span>&#8209;</span>").text(),zeroWidthSpaceText:m("<span>&#8203;</span>").text(),indexId:"chIndex",LineBreakId:"linebreak",
lang:{EAST_ASIAN:"EAST_ASIAN",OTHER:"OTHER"},spaceSizeMap:{Alegreya:{" ":0.25},Arial:{" ":0.28},"Arial Black":{" ":0.34},"Arial Narrow":{" ":0.23},Arvo:{" ":0.25},Bentham:{" ":0.25},"Book Antiqua":{" ":0.25},"Bree Serif":{" ":0.25},Cabin:{" ":0.25},"Cabin Sketch":{" ":0.25},Calibri:{" ":0.23},Cambria:{" ":0.23},ChunkFive:{" ":0.25},Colaborate:{" ":0.25},"Comic Sans MS":{" ":0.3},"Courier New":{" ":0.61},"Crimson Text":{" ":0.25},Days:{" ":0.25},"Droid Sans":{" ":0.25},"Droid Serif":{" ":0.25},Georgia:{" ":0.25},
"IPA Gothic":{" ":0.25},"IPA Mincho":{" ":0.25},Impact:{" ":0.18},"Latin Modern Roman":{" ":0.25},"League Gothic":{" ":0.25},"Lucida Console":{" ":0.61},"MS Gothic":{" ":0.5},"MS Mincho":{" ":0.5},"MS PGothic":{" ":0.31},"MS PMincho":{" ":0.31},Metrophobic:{" ":0.25},"OSP DIN":{" ":0.25},"Old Standard TT":{" ":0.25},"Open Sans":{" ":0.25},Oswald:{" ":0.25},"Otama ep":{" ":0.25},Oxygen:{" ":0.25},Pacifico:{" ":0.25},Quicksand:{" ":0.25},Raleway:{" ":0.25},Roboto:{" ":0.25},Rokkitt:{" ":0.25},"Source Sans Pro":{" ":0.25},
Tahoma:{" ":0.32},"TeX Gyre Heros":{" ":0.25},"TeX Gyre Heros Condensed":{" ":0.25},"Times New Roman":{" ":0.25},"Titillium Web":{" ":0.25},"Trebuchet MS":{" ":0.31},Ubuntu:{" ":0.25},Unna:{" ":0.25},Verdana:{" ":0.36}},set:function(a,b,c){c=!c?Shape.box(a,b):c;if(!m.isEmptyObject(a.textBody)&&c.length){this._createContainer(a,b,c);a.textBody.id=Shape.textBody.textContainer;a.textBody.element=a.textBody.element?a.textBody.element:c.find("#"+Shape.textBody.textContainer);a.textBody.element.html("");
a.textBody.element.data(Shape.textBody.indexId,[]);Shape.textBody.setProps(a,b,c);Shape.textBody._setData(a)}},element:function(a,b,c){c=!c?Shape.box(a,b):c;c.data("isTextBodyRendered")||Shape.textBody.set(a,b,c)},dependency:function(a,b,c){c=!c?Shape.box(a,b):c;Shape.create.placeHolder.icon.set(a,b,c);Shape.create.editData.icon.set(a,b,c)},setProps:function(a,b,c){Shape.textBody.props.set(a,b,c);var f=a.textBody.paras,d=undefined;f&&m.each(f,function(e,g){Shape.textBody.paras.get(a,e);Shape.textBody.paras.element(a,
b,c);g.listNum=Shape.textBody.paras.style.listStyle.getBulletNumber(a.textBody.paras,e);d=Shape.textBody.paras.set(a,b,c,g,d)})},_createContainer:function(a,b,c){this._setContainer(a,c,Shape.textBody.textContainer);Shape.textBody.setDimension(a,b,c);Shape.props.transform.rotateText(c,a.props.transform)},_setContainer:function(a,b,c){var f=a.textBody.element?a.textBody.element:b.find("#"+c);if(!f.length){f=Shape.createDiv();f.attr({id:c,"class":"prewrap"});b.append(f);a.textBody.element=f;b.data("isTextBodyRendered",
true)}},_setData:function(a){var b=[],c=0;m.each(a.textBody.paras,function(f,d){var e=[];c++;e.push(c);m.each(d.portions,function(g,h){var j=Shape.textBody.paras.portions.getPortionLength(h);c+=j;e.push(c)});b.push(e)});a.textBody.element.data("position",b)},index:{set:function(a,b,c,f){a=b.data(Shape.textBody.indexId);typeof c==="undefined"&&Shape.error("Value Set in ",b.attr("class"),"value",c,"index",f);a.splice(f,0,c)},get:function(a,b,c){return b.data(Shape.textBody.indexId)[c]},update:function(a,
b,c,f){a=b.data(Shape.textBody.indexId);typeof a[f]==="undefined"&&Shape.error("Value Update in ",b.attr("class"),"value",c,"index",f,"indexArray[index]",a[f]);a[f]+=c},remove:function(a,b,c){b.data(Shape.textBody.indexId).splice(c,1)}},setDimension:function(a,b,c){if(a.textBody){c=c?c:Shape.box(a,b);if(b=c.data(Shape.textbox)){b=this.updateDimension(b,a.props.transform);(a.textBody.element?a.textBody.element:c.find("#"+Shape.textBody.textContainer)).css(b);return b}}},textBodyDimensionChange:function(a,
b,c,f){c=!c?Shape.box(a,b):c;var d=a.textBody.element?a.textBody.element:c.find("#"+Shape.textBody.textContainer);if(d.length){var e=true,g=d.data("dim"),h=this.setDimension(a,b,c);d.data("dim",{width:h.width,height:h.height});if(g&&g.width===h.width)e=false;this.props.column.updateDimension(a,b,c,h,d);if(e||f)this.wrapShape(a,b,c)}},wrapShape:function(a,b,c){m.each(a.textBody.paras,function(f){a.textBody.paras.num=f;f=Shape.textBody.paras.getPara(c,f,a);a.textBody.paras.element=f;Shape.textBody.paras.wrapPara(a,
b,c)})},updateDimension:function(a,b){var c=b.dim.width,f=b.dim.height;return{left:b.fliph?c-a[2]:a[0],top:b.flipv?f-a[3]:a[1],width:a[2]-a[0],height:a[3]-a[1]}},getTextContainer:function(a,b){return b.find("#"+Shape.textBody.textContainer)},getPortionIndex:function(a){var b;b=a.data();if(b.subword)b=b.portion;else{var c=b.portions;b=c.start===c.end?c.start:b.hasSubword?b.space[0].portion:c.start}a=this._getIndexNo(a.closest(".para"),"para");return{portionIndex:b,paraIndex:a}},_getIndexNo:function(a,
b){return a.parent().find("."+b).index(a)},listStyles:{add:function(a,b,c){Shape.textBody.listStyles.setPara(a,b,c,["setStyle","setPortionProps"])},set:function(a,b,c){Shape.textBody.listStyles.setPara(a,b,c,["setStyle"])},get:function(a,b){if(a.oldValue&&a.oldValue.level)a.textBody.paras.level=a.oldValue.level;else{var c=a.textBody.listStyles;if(a.textBody.unmerged)c=a.textBody.unmerged.listStyles;a.textBody.paras.level=c[b].level}return a},setPara:function(a,b,c,f){var d=a.textBody.paras;if(d){var e=
d.level;m.each(d,function(g,h){if(h.style.level===e){Shape.textBody.paras.get(a,g);Shape.textBody.paras.element(a,b,c);m.each(f,function(j,l){Shape.textBody.listStyles[l].call(Shape.textBody.listStyles,a,b,c,h)})}})}},setStyle:function(a,b,c){Shape.textBody.paras.style.set(a,b,c)},setPortionProps:function(a,b,c,f){(f=f.portions)&&m.each(f,function(d){Shape.textBody.paras.portions.get(a,d);Shape.textBody.paras.portions.element(a,b,c);Shape.textBody.paras.portions.props.set(a,b,c);Shape.textBody.paras.portions.dependency(a,
b,c)})},defPrProps:{set:function(a,b,c){Shape.textBody.listStyles.setPara(a,b,c,["setPortionProps"])}}},props:{_element:function(a){return a.find("#"+Shape.textBody.tbox)},innerBox:function(a){return a.find("#"+Shape.textBody.innerbox)},set:function(a,b,c){c=!c?Shape.box(a,b):c;var f=a.textBody.element?a.textBody.element:c.find("#"+Shape.textBody.textContainer);Shape.textBody.props.column.set(a,b,c);var d=m(m("."+Shape.textBody.columnId,f)[0]);f=d.find("#"+Shape.textBody.tbox);if(!f.length){f=Shape.createDiv();
f.attr("id",Shape.textBody.tbox);d.append(f)}d=d.find("#"+Shape.textBody.innerbox);if(!d.length){d=Shape.createDiv();d.attr("id",Shape.textBody.innerbox);f.append(d);d.data("paras",[])}var e=Shape.textBody.props;m.each(a.textBody.props,function(g){if(e[g]&&g!=="column")(e[g].set?e[g].set:e[g]).call(e,a,b,c)})},inset:{set:function(a,b,c){c=!c?Shape.box(a,b):c;b=a.textBody.props;a=Shape.textBody.getTextContainer(a,c);a=Shape.textBody.props.innerBox(a);Shape.textBody.setMargin(b.inset,a,"padding")},
dependency:function(a,b,c){Shape.textBody.textBodyDimensionChange(a,b,c,true)}},valign:{set:function(a,b,c){c=!c?Shape.box(a,b):c;b=a.textBody.props.valign.toLowerCase();c=Shape.textBody.getTextContainer(a,c);a=Shape.textBody.props._element(c);c=Shape.textBody.props.innerBox(c);if(Shape.displaySupport.table&&Shape.displaySupport.tableCell)a.css({display:"table-cell","vertical-align":b});else{a={top:0};a=b==="middle"?{top:0,bottom:0}:{bottom:0};c.css(m.extend(true,{height:"100%"},a))}}},column:{set:function(a,
b,c){c=!c?Shape.box(a,b):c;a.textBody.props=m.extend(true,{column:{}},a.textBody.props);var f=Shape.textBody.getTextContainer(a,c),d=c.data(Shape.textbox);if(d){d=Shape.textBody.updateDimension(d,a.props.transform);this.updateDimension(a,b,c,d,f)}},updateDimension:function(a,b,c,f,d){if(!a.textBody.props||a.textBody.props&&!a.textBody.props.valign)a.textBody.props=m.extend(true,a.textBody.props,{valign:"top"});a.textBody.props.inset=m.extend(true,{left:9.6,right:9.6,top:4.8,bottom:4.8},a.textBody.props.inset);
a.textBody.props.column=m.extend(true,{num:1,gap:0},a.textBody.props.column);var e=a.textBody.props.inset,g=a.textBody.props.column,h=Math.floor(f.height);e=Math.abs(Math.floor(f.width-(e.left+e.right)-(g.num-1)*g.gap)/g.num);for(var j=0,l=[],n=Shape.textBody.paras.portions.t,o=0;o<g.num;o++){var p=c.find("#"+Shape.textBody.columnId+o);if(p.length){var r=p.data("width"),q=p.find("."+Shape.textBody.paraId);m.each(q,function(s,t){t=m(t);l[s]=t.children("."+Shape.textBody.lineId);l[s].paraDiv=t;m.each(l[s],
function(u,v){n.line.remainingWidth.decrease(m(v),r)})})}else{p=m("<div id ="+Shape.textBody.columnId+o+" class = "+Shape.textBody.columnId+"></div>");d.append(p)}q={position:"absolute",top:0,width:Math.abs(f.width/g.num)};q.height=h+"px";q.left=j;if(o){q["margin-left"]=g.gap;j+=g.gap}j+=e;p.css(q);p.data("remainingHeight",f.height);p.data("width",e);if(l.length){r=p.data("width");m.each(l,function(s,t){m.each(t,function(u,v){v=m(v);a.textBody.paras.num=s;a.textBody.paras.element=t.paraDiv;n.line.totalWidth.set(a,
b,c,v,t.paraDiv);n.line.remainingWidth.increase(m(v),r)})})}}},element:function(){}}},setMargin:function(a,b,c){c=!c?"margin":c;m.each(a,function(f,d){b.css(c+"-"+f,d+"px")})},paras:{wrapPara:function(a,b,c){var f=a.textBody.paras.element,d=f.find("."+Shape.textBody.lineId);m.each(d,function(e,g){Shape.textBody.paras.portions.t.line.setLineWidth(a,b,c,m(g),f)});m.each(d,function(e,g){g=m(g);g.parent("."+Shape.textBody.paraId).length&&Shape.textBody.paras.portions.t.breakLine({data:a,container:b,box:c},
m(g))})},createPara:function(a,b){var c=Shape.textBody.paraId;c=m('<div class="'+c+'" id="'+c+'"></div>');c.data(Shape.textBody.indexId,[]);Shape.textBody.index.set(a,a.textBody.element,0,b);return c},set:function(a,b,c,f,d){var e=a.textBody.paras.num;c=!c?Shape.box(a,b):c;f=f?f:a.textBody.paras[e];a.textBody.paras.fromPara=true;var g=this.createPara(a,e);if((d=d?d:Shape.textBody.paras.getPara(c,e-1,a))&&d.length)g.insertAfter(d);else{d=Shape.textBody.getTextContainer(a,c);d=Shape.textBody.props.innerBox(d);
m(d).prepend(g)}a.textBody.paras.element=g;a.textBody.paras.prevWord=undefined;a.textBody.paras.fromPara=false;g.data("changeStatus",true);d=Shape.textBody.paras.portions.t.line.create(a,b,c,g);e=m('<span id="bugfixer">&nbsp;</span>');d.prepend(e);d.append(this.getEOPSpan(a,b,c,f));Shape.textBody.paras.portions.t.words.index.set(a,d,1,0);d.trigger("line_modified",{create:true,element:d,para:g,box:c,data:a,container:b});this.style.set(a,b,c,true);f=f.portions;var h;f&&m.each(f,function(j){Shape.textBody.paras.portions.get(a,
j);h=Shape.textBody.paras.portions.set(a,b,c,h)});return g},getEOPSpan:function(a,b,c,f){var d=a.textBody.paras.element.find(".eop");if(!d.length){d=Shape.textBody.paras.portions.t.words.set({type:"EOP",portion:f.portions[0],portionNum:0},{data:a,container:b,box:c});d.addClass("eop");d.attr("id","dummyword");d.data("length",1);this.setEopHeight(d,a,a.textBody.paras.num)}return d},setEopHeight:function(a,b,c,f){a.text("|");f=f?f:b.textBody.paras[c].portions.length-1;b=Shape.textBody.paras.portions.t.words.getFontSize(b,
c,f);a.css({visibility:"hidden","font-size":b})},getEopHeight:function(a,b,c){c=c?c:a.textBody.paras[b].portions.length-1;a=Shape.textBody.paras.portions.t.words.getFont(a,b,c);return Shape.textBody.paras.portions.t.words.canvasDim(a,"|").width},get:function(a,b){a.textBody.paras.num=b;return a},element:function(a,b,c){c=!c?Shape.box(a,b):c;b=Shape.textBody.paras.getPara(c,a.textBody.paras.num,a);a.textBody.paras.element=b},remove:function(a,b,c){var f=a.textBody.paras.num,d=a.textBody.paras.element,
e=a.textBody.element?a.textBody.element:Shape.textBody.getTextContainer(a,b,c);Shape.textBody.index.remove(a,e,f);d.remove();e.trigger("line_modified",{"delete":true,para:d,box:c,data:a,container:b})},getPara:function(a,b,c){if(b>=0){a=Shape.textBody.getTextContainer(c,a);c.textBody.element=a;return a.find(".para").eq(b)}},dependency:function(a,b,c){Shape.textBody.paras.style.listStyle.reorderListNum(a,b,c)},animationDatas:{set:function(){},get:function(a){return a}},style:{set:function(a,b,c,f){var d=
a.textBody.paras.num;c=!c?Shape.box(a,b):c;var e=a.textBody.paras[d].style,g=this;e.listStyle=!e.listStyle?{bullet:{type:m.ShapeConstants.BulletType.NONE}}:e.listStyle;m.each(e,function(h){if(h=g[h]){h=h.set?h.set:h;h.call(g,a,b,c)}});f||m.each(a.textBody.paras[d].portions,function(h){a.textBody.paras[d].portions.num=h;Shape.textBody.paras.portions.element(a,b);Shape.textBody.paras.portions.props.set(a,b,c);Shape.textBody.paras.portions.props.dependency(a,b,c)})},halign:{set:function(a){var b=a.textBody.paras.element;
a=a.textBody.paras[a.textBody.paras.num].style.halign.toLowerCase();b.css({"text-align":a})}},indent:{set:function(a,b,c){c=!c?Shape.box(a,b):c;c.data("shape_rendered")&&Shape.textBody.paras.style.listStyle.setBulletPosition(a,b,c)}},spacing:{linespace:{line:"line-height",after:"padding-bottom",before:"padding-top"},set:function(a,b,c){var f=Shape.textBody.paras.style.spacing;m.each(a.textBody.paras[a.textBody.paras.num].style.spacing,function(d){f[d].set.call(f,a,b,c)})},line:{set:function(a,b,c){!c&&
Shape.box(a,b);Shape.textBody.paras.style.spacing.setValue(a,"line")},dependency:function(a){var b=Shape.textBody.paras.style.listStyle.getBullet(a.textBody.paras.element);b&&Shape.textBody.paras.style.spacing.setLineSpace(a.textBody.paras[a.textBody.paras.num].style,b,a)}},setValue:function(a,b){var c=a.textBody.paras[a.textBody.paras.num],f=c.style.spacing[b],d=a.textBody.paras.element,e=f.type.toLowerCase(),g=f[e];f=this.linespace[b];if(b==="line"){e=Shape.textBody.paras.style.spacing.getLineValue(g,
e,a);d.find("."+Shape.textBody.wordId).css(f,e);d.find("."+Shape.textBody.subwordId).css(f,e)}else{c=c.portions[0].props.size;c*=1.33;d.css(f,(e==="percent"?g*1.2*c:g)+"px")}},getLineValue:function(a,b,c){if((c=c.textBody.props)&&c.autoFit&&c.autoFit.type==="NORMAL"&&c.autoFit.normal.lineSpaceScale)a*=c.autoFit.normal.lineSpaceScale;return b==="percent"?a*1.2+"em":a+"px"},before:{set:function(a){a.textBody.paras.num&&Shape.textBody.paras.style.spacing.setValue(a,"before")}},after:{set:function(a){a.textBody.paras.num!==
a.textBody.paras.length-1&&Shape.textBody.paras.style.spacing.setValue(a,"after")}},setLineSpace:function(a,b,c){if(a=a.spacing.line){var f=a.type.toLowerCase(),d=Shape.textBody.paras.style.spacing;b.css(d.linespace.line,d.getLineValue(a[f],f,c))}}},margin:{set:function(a,b,c){var f=a.textBody.paras.num,d=a.textBody.paras.element;!c&&Shape.box(a,b);a=a.textBody.paras[f].style.margin;d.css("paddingLeft",a&&a.left?a.left:0)},dependency:function(a,b,c){a.textBody.paras[a.textBody.paras.num].style.listStyle&&
Shape.textBody.paras.style.listStyle.setBulletPosition(a,b,c)}},listStyle:{set:function(a,b,c){var f=a.textBody.paras.num;c=!c?Shape.box(a,b):c;var d=a.textBody.paras.element;if(f=a.textBody.paras[f].style.listStyle){if(!f.bullet)f.bullet={type:m.ShapeConstants.BulletType.NONE};f=Shape.textBody.paras.style.listStyle.getBullet(d);if(!f.length){f=m('<span id="bullet" class="bullet"></span>');d=m("#bugfixer",d);f.insertAfter(d)}d=Shape.textBody.paras.style.listStyle;d.bullet.set(a,b,c,f);d.setListStyleProps(a,
b,c,f)}},setListStyleProps:function(a,b,c,f){f=!f?Shape.textBody.paras.style.listStyle.getBullet(a.textBody.paras.element):f;this._setListStyleProps(a,f);this.setBulletPosition(a,b,c,f)},_setListStyleProps:function(a,b){var c=a.textBody.paras[a.textBody.paras.num],f=m.extend(true,{},c.style.listStyle),d=m.extend(true,{},c.portions[0]);f.size=!f.size?1:f.size;f.color=!f.color?d.props.fill.solid.color:f.color;Shape.textBody.paras.portions.props.size(b,f.size*d.props.size,a);Shape.textBody.paras.style.spacing.setLineSpace(c.style,
b,a);b.css("color",VectorUtil.convertRGBToString(f.color.rgb));if(!m.isEmptyObject(f.font)){c=f.font.fontFamily.name;!Shape.isWingDingsSupported&&c.toLowerCase()==="wingdings"&&a.pdfVariables&&a.pdfVariables.customFont?b.css("font-family",a.pdfVariables.customFont):b.css("font-family",c)}},setBulletPosition:function(a,b,c,f){var d=a.textBody.paras.num,e=a.textBody.paras.element;if(e.length){var g=e.find("."+Shape.textBody.lineId).first(),h=Shape.textBody.paras.portions.t,j=h.line.getBulletSplitter(g);
c=!c?Shape.box(a,b):c;f=!f?Shape.textBody.paras.style.listStyle.getBullet(e):f;var l=a.textBody.paras[d].style;if(!l.margin)l.margin={left:"0"};d=0;if(!l.listStyle.bullet)l.listStyle.bullet={type:m.ShapeConstants.BulletType.NONE};if(l.listStyle.bullet.type!==m.ShapeConstants.BulletType.NONE){var n=f.clone();Shape.cloneDiv.append(n);d=n.width();n.remove()}l=this.getBulletSplitterLeft(l,d);n=l.split;f.css({"margin-left":l.pos+"px"});e.data("bulletWidth",d);j.css({width:n+"px"});h.line.setLineWidth(a,
b,c,g,e,n*1+d*1)}},getBulletSplitterLeft:function(a,b){var c=a.indent?a.indent:0,f=0,d=0;if(c<0){d=a.margin&&a.margin.left?a.margin.left:0;f=c*-1;d=f<=d?c:d*-1;f=b>0?f-b:0}else f=c>b?c-b:0;return{split:f,pos:d}},bullet:{enabled:"enabled",disabled:"disabled",semiEnabled:"semi-enabled",set:function(a,b,c,f){var d=Shape.textBody.paras.style.listStyle.bullet,e=a.textBody.paras.element,g=a.textBody.paras[a.textBody.paras.num],h=g.style.listStyle.bullet,j=h.type.toLowerCase(),l=g.portions[0];g=l.t;l=(l=
l.type)&&l.toLowerCase()==="linebreak";h.status=h.status?h.status:g&&g.length||l?d.enabled:d.disabled;c=!c?Shape.box(a,b):c;f=!f?Shape.textBody.paras.style.listStyle.getBullet(e):f;d[j].set.call(this,a,b,c,f);Shape.textBody.paras.style.listStyle.setBulletPosition(a,b,c,f)},status:{set:function(a,b,c,f){b=Shape.textBody.paras.style.listStyle.bullet;c=a.textBody.paras[a.textBody.paras.num].style.listStyle.bullet.status;a=a.textBody.paras.element;f=!f?Shape.textBody.paras.style.listStyle.getBullet(a):
f;if(c===b.semiEnabled)f.removeClass("bullet-disabled").addClass("bullet-semi");else c===b.disabled?f.removeClass("bullet-semi").addClass("bullet-disabled"):f.removeClass("bullet-disabled bullet-semi")}},picture:{set:function(a,b,c,f){var d=a.textBody.paras.element,e=Shape.textBody.paras.style.listStyle.bullet.picture;f=!f?Shape.textBody.paras.style.listStyle.getBullet(d):f;var g="videobutton-embedmessage";if(a.nvOProps.nvProps&&a.nvOProps.nvProps.embed){if(a.nvOProps.nvProps.embed.twitter)g=a.nvOProps.nvProps.embed.twitter.type.toLowerCase()===
"live"?"ui-icon-twitter-live-embedded":"ui-icon-twitter-marked-embedded";m(d).css({"background-color":"black","pointer-events":"none"});f.removeClass("bullet bullet-disabled bullet-semi").addClass(g)}else{e._set(a,f);Shape.textBody.paras.style.listStyle.bullet.status.set(a,b,c,f)}},_set:function(a,b){var c=a.textBody.paras[a.textBody.paras.num].style,f=c.listStyle.bullet.picture.value;if(c.listStyle.bullet.picture){c=c.defPrProps.size*(c.listStyle.size?c.listStyle.size:1)+"px";f=m("<img/>",{src:f.url,
width:c,height:c});b.empty();b.append(f)}},dependency:function(a,b,c){Shape.textBody.paras.style.listStyle.reorderListNum(a,b,c)}},character:{set:function(a,b,c,f){var d=a.textBody.paras.element,e=Shape.textBody.paras.style.listStyle.bullet.character;f=!f?Shape.textBody.paras.style.listStyle.getBullet(d):f;e._set(a,f);Shape.textBody.paras.style.listStyle.bullet.status.set(a,b,c,f)},_set:function(a,b){var c=a.textBody.paras.num,f=a.textBody.paras[c].style;if(f.listStyle.bullet.character){f=f.listStyle.bullet.character.ch;
if(!Shape.isWingDingsSupported)if(c=a.textBody.paras[c].style.listStyle.font){c=c.fontFamily.name;if(c.toLowerCase()==="wingdings")f=(f=m.uniCode.font[c.toLowerCase()][f])?f:"128083"}f="&#"+f+";";b.empty();b.html(f)}},dependency:function(a,b,c){Shape.textBody.paras.style.listStyle.reorderListNum(a,b,c)}},number:{set:function(a,b,c,f){var d=a.textBody.paras.element,e=Shape.textBody.paras.style.listStyle.bullet.number;f=!f?Shape.textBody.paras.style.listStyle.getBullet(d):f;e._set(a,f);Shape.textBody.paras.style.listStyle.bullet.status.set(a,
b,c,f)},_set:function(a,b){var c=a.textBody.paras.num,f=a.textBody.paras[c].style;if(f.listStyle.bullet.number){var d=a.textBody.paras[c].listNum;if(d=d?d:Shape.textBody.paras.style.listStyle.getBulletNumber(a.textBody.paras,c)){c=m.NumericConversion.convert(f.listStyle.bullet.number,d);b.html(c)}}},dependency:function(a,b,c){Shape.textBody.paras.style.listStyle.reorderListNum(a,b,c)}},none:{set:function(a,b,c,f){f=!f?Shape.textBody.paras.style.listStyle.getBullet(paraDiv):f;f.html("")},dependency:function(a,
b,c){Shape.textBody.paras.style.listStyle.reorderListNum(a,b,c)}},dependency:function(a,b,c){Shape.textBody.paras.style.listStyle.reorderListNum(a,b,c)}},getBullet:function(a){return a.find("#bullet")},getBulletNumber:function(a,b){var c=a[b].style,f=c.level;if((c=c.listStyle)&&c.bullet&&c.bullet.number)return b=this.getParaListNum(a,f,b);return false},getParaListNum:function(a,b,c){var f=c,d=a[c],e=d.style?d.style:undefined,g=e&&e.listStyle.bullet?e.listStyle.bullet:{},h=g.number?g.number.type:undefined,
j=g.number?g.number.startat:0,l=g.type?g.type:m.ShapeConstants.BulletType.NONE;j=j?parseInt(j):j;c=c?1:j?j:1;for(var n=0;f;){d=a[f-1];g=(e=d.style?d.style:undefined)&&e.listStyle&&e.listStyle.bullet?e.listStyle.bullet:{};e=g.number?g.number.type:undefined;var o=g.number?g.number.startat:0;g=g.type?g.type:m.ShapeConstants.BulletType.NONE;var p=d.portions[0].t;p=p&&p.length;pLevel=d?d.style.level:0;if(pLevel===b){if(l!==g){c=j?j:c;break}if(j)if(o===j)n++;else{c=j?j:c;break}if(!p&&g!==m.ShapeConstants.BulletType.NONE||
h!==e)c--;if(g!==m.ShapeConstants.BulletType.NUMBER)break;c++}else if(pLevel<b&&g===m.ShapeConstants.BulletType.NUMBER){c=j?j:c;break}f--}return n?n+j:c},reorderListNum:function(a,b,c){c=!c?Shape.box(a,b):c;var f=a.textBody.paras.num,d=a.textBody.paras,e=a.textBody.paras.element;for(i=f;i<d.length;i++){var g=d[i];if((g.style&&g.style.listStyle&&g.style.listStyle.bullet?g.style.listStyle.bullet.type:undefined)===m.ShapeConstants.BulletType.NUMBER){g.listNum=Shape.textBody.paras.style.listStyle.getBulletNumber(d,
i);a.textBody.paras.num=i;a.textBody.paras.element=Shape.textBody.paras.getPara(c,i,a);g=d[i].portions[0].t||d[i].portions[0].type===m.ShapeConstants.PortionType.LINEBREAK;d[i].style.listStyle.bullet.status=d[i].style.listStyle.bullet.status?d[i].style.listStyle.bullet.status:!g?Shape.textBody.paras.style.listStyle.bullet.disabled:undefined;Shape.textBody.paras.style.listStyle.bullet.number.set(a,b,c);Shape.textBody.paras.style.listStyle.setBulletPosition(a,b,c)}}a.textBody.paras.num=f;a.textBody.paras.element=
e}},dependency:function(a,b,c){c=!c?Shape.box(a,b):c;Shape.textBody.paras.style.listStyle.reorderListNum(a,b,c);Shape.textBody.paras.wrapPara(a,b,c)}},portions:{set:function(a,b,c){c=!c?Shape.box(a,b):c;var f=a.textBody.paras,d=f.num,e=f[d].portions.num;d=f[d].portions[e];e&&!d.t&&!d.type&&Shape.log("Why do we have such case----\>>> portion",d);f.fromPara||this.updatePortionNum(a,b,c,e,true);Shape.textBody.paras.portions.t.set(a,b,c,true)},updateLinePortionNum:function(a,b,c){var f=Shape.textBody.paras.portions.t,
d=b.data();if(!c){c=b.find("."+Shape.textBody.wordId).first();if(c.length)d.portions.start+=a}for(b=c?c.data("subword")?f.words.getParentWord(c):c:undefined;c.length;)if(c.data("subword")){var e=c.data();e.portion+=a;nextword=c.next();if(!nextword.length){b=c.parent();var g=b.data("space"),h=undefined;m.each(g,function(j,l){l.portion+=a;h=l.portion});if(typeof h!="undefined")b.data("portions").end=h;else b.data("portions").end=e.portion;nextword=f.words.getNextWord(b)}c=nextword}else if(c.data("hasSubword")){e=
c.find("."+Shape.textBody.subwordId);c.data("portions").start+=a;c=e.first()}else{portions=c.data("portions");portions.start+=a;portions.end+=a;g=c.data("space");m.each(g,function(j,l){l.portion+=a});b=c;c=f.words.getNextWord(c)}if(b&&b.length){c=b.data();d.portions.end=c.portions.end}else Shape.error("somProblem")},updatePortionNum:function(a,b,c,f,d){a=a.textBody.paras;f=a[a.num].portions.num;f=d?f:f+1;a=this.getPortion(a.element,f);var e=d?1:-1;if(a.length){d=a[0];if(d.spaceObj.length&&d.spaceObj[0].at===
"before"||!d.portion.length&&d.spaceObj.length&&d.spaceObj[0].at==="after"){var g=d.spaceObj[0];a=g.word;m.each(a.data("space"),function(j,l){if(j>=g.index.start)l.portion+=e});b=a.data();c=b.portions.end;if(b.space.length)a.data("portions").end=b.space[b.space.length-1].portion;var h=d.line.data();h.portions.end=h.portions.end===c?b.portions.end:h.portions.end;a=a.next().not(".eop")}else a=d.portion.first();if(d.line.data("portions").start===f)d.line.data("portions").start+=e;if(a.data("subword")){b=
Shape.textBody.paras.portions.t.words.getParentWord(a);if(b.data("portions").start===f)b.data("portions").start+=e}a.length&&this.updateLinePortionNum(e,d.line,a);for(f=d.line.next();f.length;){this.updateLinePortionNum(e,f);f=f.next()}}},test:function(a,b,c){Shape.testing=true;var f=ShapeEditor.select.shapes[0],d=f.data;f=f.box;var e=ShapeEditor.config.get.shapeContainer();d.textBody.paras.num=a;Shape.textBody.paras.element(d,e,f);d.textBody.paras[a].portions.num=b;Shape.textBody.paras.portions.element(d,
e,f);d.textBody.paras[a].portions[b].t=c;Shape.textBody.paras.portions.t.set(d,e,f);Shape.textBody._test(d,f);Shape.testing=false},dependency:function(a,b,c){c=!c?Shape.box(a,b):c;Shape.textBody.paras.portions.props.dependency(a,b,c)},get:function(a,b){a.textBody.paras[a.textBody.paras.num].portions.num=b;return a},element:function(a){var b=a.textBody.paras.num,c=Shape.textBody.paras.portions.getPortion(a.textBody.paras.element,a.textBody.paras[b].portions.num);a.textBody.paras[b].portions.element=
c},remove:function(a,b,c){var f=a.textBody.paras,d=f[f.num].portions.num,e=f[f.num].portions.element.length;if(e)var g=f[f.num].portions.element[0].line,h=Shape.textBody.paras.portions.t.line.prev(g);this._remove(a,b,c);if(e){this.updatePortionNum(a,b,c,d,false);g=g.closest(".para").length?g:h;Shape.textBody.paras.portions.t.breakLine({data:a,box:c,container:b},g)}},_remove:function(a,b,c){var f=a.textBody.paras.num,d=a.textBody.paras[f].portions.num,e={data:a,container:b,box:c};b=a.textBody.paras[f].portions.element;
c=this.getAdjacentWords(b);if((f=c.next)&&f.type==="SPACE")if(f.index>0)for(var g=f.word.data(),h=f.index-1;h>=0;h--)g.space[h].portion===d&&f.index--;b&&m.each(b,function(j,l){var n=l.portion,o=l.line;for(j=n.length-1;j>=0;j--){portionEle=m(n[j]);(portionEle.data("subword")?Shape.textBody.paras.portions.t.subword:Shape.textBody.paras.portions.t.words).removePortion(e,portionEle,d,o)}(n=l.spaceObj)&&m.each(n,function(p,r){Shape.textBody.paras.portions.t.words.removeSpace(a,r,o)})});this.combineWords(e,
c)},convertSubwordToWord:function(a,b,c,f,d){b.length||Shape.error("No subword to be converted to word");b.first().data();var e=c.data(),g=e.space,h,j;if(d==="prev"){if(e.broken&&e.broken.before)h=e.broken.before}else if(d==="next")if(e.broken&&e.broken.after)j=e.broken.after;b=Shape.textBody.paras.portions.t.words.createWordFromSubwords(a,b,g);d=b.data();if(h)d.broken={before:h};else if(j)d.broken={after:j};Shape.textBody.paras.portions.t.words.insertnewWordAfter(a,c,b,f);Shape.textBody.paras.portions.t.words.remove(a,
c,f);return b},combineWords:function(a,b,c){var f=Shape.textBody.paras.portions.t,d=b.prev,e=b.next,g,h;if(!e.word||!e.word.length)if(d.word&&d.word.length){var j=d.word.data();if(j.subword||j.hasSubword){b=j.subword?f.words.getParentWord(d.word):d.word;g=f.line.getParentLine(b);f=f.subword.getSubwords(b);f.length<2&&this.convertSubwordToWord(a,f,b,g,"prev");return}}else return;if(!d.word||!d.word.length)if(e.word&&e.word.length){j=e.word.data();if(j.subword||j.hasSubword){b=j.subword?f.words.getParentWord(e.word):
e.word;h=f.line.getParentLine(b);f=f.subword.getSubwords(b);f.length<2&&this.convertSubwordToWord(a,f,b,h,"next");return}}else return;if(!(!e.word||!e.word.length||!d.word||!d.word.length))if(!e.word.hasClass("eop"))if(d.type==="NORMAL"&&d.word.data("lang")===Shape.textBody.lang.EAST_ASIAN&&e.type!=="SPACE"){g=e.word.data("subword")?f.words.getParentWord(e.word):e.word;b=g.data();if(b.hasSubword){f=f.subword.getSubwords(g);if(f.length<2)g=this.convertSubwordToWord(a,f,g,h,"next")}b=g.data();b.broken&&
b.broken.before&&delete b.broken.before}else if(e.type==="NORMAL"&&e.word.data("lang")===Shape.textBody.lang.EAST_ASIAN){h=d.word.data("subword")?f.words.getParentWord(d.word):d.word;b=h.data();if(b.hasSubword){f=f.subword.getSubwords(h);if(f.length<2)h=this.convertSubwordToWord(a,f,h,g,"prev")}b=h.data();b.broken&&b.broken.after&&delete b.broken.after}else{b.prevline=g;b.nextline=h;this._combineWords(a,b,c)}},_combineWords:function(a,b,c){var f=Shape.textBody.paras.portions.t,d=b.prev,e=b.next,g=
b.prevline,h=b.nextline;g=g?g:f.line.getParentLine(d.word);h=h?h:f.line.getParentLine(e.word);if(d.type==="NORMAL"){b=d.word;var j=b.data();if(j.subword){b=d.word;j=b.data();var l=f.words.getParentWord(b),n=f.subword.getSubWordIndex(b,l),o=l.find("."+Shape.textBody.subwordId).length;q=e.word.data();var p=l.data();if(p.broken&&p.broken.after)r=p.broken.before;if(e.type==="NORMAL")if(q.subword){h=f.words.getParentWord(e.word);d=m.extend(true,{},h.data());p=f.subword.getSubWordIndex(e.word,h);if(l[0]!==
h[0]){p!=0&&Shape.error("Prev and Next words are SUBWORDS- SO subwordIndex cannot be other than 0");e=m();if(c)if(n===o-1){c=j.text;q=q.text;f.subword.updateText(a,{text:c+q,subword:b,index:n},l,g);e=f.subword.getSubwords(h,{from:p+1})}else Shape.error("prev word.. It should be the last subword.. ");else e=f.subword.getSubwords(h,{from:p});p=m.extend(true,[],d.space);l=f.subword.insertSubWordInWord(a,e,l,n+1);f.words.addSpaceAfterWord(a,l,p);f.words.remove(a,h)}if(d.broken&&d.broken.after){b=l.data();
b.broken=m.extend(true,b.broken,{after:d.broken.after});f.connectBrokenWords(l,g,a)}}else if(n===o-1){d=m.extend(true,{},q);l.data().space.length&&Shape.error("som problem , there shouldnt be any space");p=m.extend(true,[],q.space);if(c){c=j.text;q=d.text;f.subword.updateText(a,{text:c+q,subword:b,index:n},l,g);f.words.updateSpaceAfter(a,p,l,g)}else{b=f.subword.createSubWordsFromWordData(q,e.word,a);l=f.subword.insertSubWordInWord(a,b,l,o);f.words.addSpaceAfterWord(a,l,p)}f.words.remove(a,e.word,
h);if(d.broken&&d.broken.after){b=l.data();b.broken=m.extend(true,b.broken,{after:d.broken.after});f.connectBrokenWords(l,g,a)}}else Shape.error("some problem",d,e);else if(e.type==="SPACE"){n!==o-1&&Shape.error("prevWord is a SUBWORD and nextWord is a space, so the prevWordIndex should be the last subwordIndex",d,e);c&&l[0]===e.word[0]&&Shape.error("It shouldn't come here.. same parent word.. ");p=m.extend(true,[],q.space);if(l[0]!==e.word[0]){f.words.addSpaceAfterWord(a,l,p);f.words.remove(a,e.word)}else if(o===
1)l=this.convertSubwordToWord(a,b,l,g,"prev");p=l.data();p.broken&&p.broken.after&&delete p.broken.after}else if(e.type==="LINEBREAK"){e=f.subword.getSubwords(l);if(e.length<2)l=this.convertSubwordToWord(a,e,l,g,"prev");p=l.data();p.broken&&p.broken.after&&delete p.broken.after}if(r){p=l.data();p.broken=m.extend(true,p.broken,{before:r})}}else{var r;if(j.broken&&j.broken.before)r=j.broken.before;var q=e.word.data();l=e.word;if(j.space.length){if(e.type==="NORMAL"){if(q.subword){n=f.words.getParentWord(l);
e=f.subword.getSubwords(n);if(e.length<2)l=this.convertSubwordToWord(a,e,n,h,"next")}}else if(e.type==="SPACE")if(!q.text||!q.text.length){p=q.space;f.words.addSpaceAfterWord(a,b,p);f.words.remove(a,e.word)}else Shape.error("THe next word should not be having text in it, But it has",q);l=l.data("subword")?f.words.getParentWord(l):l;q=l.data();q.broken&&q.broken.before&&delete q.broken.before}else{if(e.type==="NORMAL"){b.find("."+Shape.textBody.subwordId).length&&Shape.error("prevWord has subword...");
if(q.subword){n=f.words.getParentWord(l);e=f.subword.getSubWordIndex(l,n);d=m.extend(true,{},n.data());h=(h=b.find("."+Shape.textBody.subwordId).length)?h:1;if(c){c=j.text;q=q.text;f.words.updateText(a,{text:c+q,word:b},g);e+=1;h+=1}e=f.subword.getSubwords(n,{from:e});p=n.data("space");b=f.subword.insertSubWordInWord(a,e,b,h);f.words.addSpaceAfterWord(a,b,m.extend(true,[],p));f.words.remove(a,n)}else{p=m.extend(true,[],q.space);d=m.extend(true,{},q);if(c){c=j.text;q=d.text;f.words.updateText(a,{text:c+
q,word:b},g);f.words.updateSpaceAfter(a,p,b,g)}else{e=f.subword.createSubWordsFromWordData(q,l,a);h=b.find("."+Shape.textBody.subwordId).length;b=f.subword.insertSubWordInWord(a,e,b,h?h:1);f.words.addSpaceAfterWord(a,b,p)}f.words.remove(a,l)}if(d.broken&&d.broken.after){j=b.data();j.broken=m.extend(true,j.broken,{after:d.broken.after});f.connectBrokenWords(b,g,a)}}else if(e.type==="SPACE"){p=q.space;f.words.addSpaceAfterWord(a,b,p);f.words.remove(a,l);j.broken&&j.broken.after&&delete j.broken.after}else e.type===
"LINEBREAK"&&j.broken&&j.broken.after&&delete b.broken.after;j=b.data();if(r)j.broken={before:r}}}}else if(d.type==="SPACE"){b=d.word;g=d.index;r=d.word.data("space");g>r.length-1&&Shape.error("some problem",d,e);q=e.word.data();if(e.type==="NORMAL")if(g===-1){r=f.subword.getSubwords(d.word).length;g=e.word;if(q.subword)g=f.words.getParentWord(e.word);d=g.data();e=f.subword.createSubWordsFromWordData(d,g,a);if(r)Shape.error("prevWord : SPACE, nextWord : WORD/SUBWORD - Code flow,Shouldn't be here. If the prev word has subwords, adjacentwords() should have been returned with the previous subword");
else{b=f.subword.insertSubWordInWord(a,e,b,1);f.words.addSpaceAfterWord(a,b,d.space);if(d.broken&&d.broken.after){j=b.data();j.broken=m.extend(true,j.broken,{after:d.broken.after})}f.words.remove(a,g,h)}}else{l=e.word;if(q.subword){l=f.words.getParentWord(e.word);b=f.line.getParentLine(l);e=f.subword.getSubwords(l);if(e.length<2)l=this.convertSubwordToWord(a,e,l,b,"next")}q=l.data();q.broken&&q.broken.before&&delete q.broken.before}else if(e.type==="SPACE"){l=e.word;c&&b[0]===l[0]&&Shape.error("It shouldn't come here.. prev and next pointing the same word.. ");
if(b[0]!==l[0]){p=q.space;f.words.addSpaceAfterWord(a,b,p);f.words.remove(a,e.word,h)}}}else if(d.type==="LINEBREAK")if(e.type==="NORMAL"){l=e.word;q=l.data();if(q.subword){l=f.words.getParentWord(e.word);b=f.line.getParentLine(l);e=f.subword.getSubwords(l);if(e.length<2)l=this.convertSubwordToWord(a,e,l,b,"next")}q=l.data();q.broken&&q.broken.before&&delete q.broken.before}},getAdjacentWords:function(a){var b=Shape.textBody.paras.portions.t,c={},f={};if(!a.length)return{prev:c,next:f};var d=a[0];
a=a[a.length-1];if(d.spaceObj.length&&d.spaceObj[0].at==="before"||!d.portion.length&&d.spaceObj.length&&d.spaceObj[0].at==="after"){var e=d.spaceObj[0],g=e.word;if(e.index.start>0)c={type:"SPACE",word:g,index:e.index.start-1};else{e=g.find("."+Shape.textBody.subwordId);c=e.length?{type:"NORMAL",word:e.last()}:{type:"SPACE",word:g,index:-1}}}else{e=d.portion.first();if(e.data("subword")){g=b.subword.getPrevSubword(e);if(g.length)c={type:"NORMAL",word:g};else{g=b.words.getParentWord(e);g=b.words.getPrevWord(g);
if(g.length){c=g.data();c=!(c.text&&c.text.length)&&!c[Shape.textBody.indexId].length?{type:"SPACE",word:g,index:c.space.length-1}:{type:"NORMAL",word:g}}}}else{g=b.words.getPrevWord(e);if(g.length){c=g.data();c=!(c.text&&c.text.length)&&!c[Shape.textBody.indexId].length?{type:"SPACE",word:g,index:c.space.length-1}:{type:"NORMAL",word:g}}}}if(a.spaceObj.length&&a.spaceObj[a.spaceObj.length-1].at==="after"){e=a.spaceObj[a.spaceObj.length-1];g=e.word;var h=g.data();if(e.index.end===h.space.length-1){if(g=
b.words.getNextWord(g))if(g.data("hasSubword")){e=g.find("."+Shape.textBody.subwordId);f={type:"NORMAL",word:e.first()}}else{f=g.data("type")==="LINEBREAK"?"LINEBREAK":"NORMAL";f={type:f,word:g}}}else f={type:"SPACE",word:g,index:e.index.end+1}}else{e=a.portion.last();if(e.data("subword")){g=b.subword.getNextSubword(e);if(g.length)f={type:"NORMAL",word:g};else{g=b.words.getParentWord(e);var j=e.data("portion");h=g.data("space");m.each(h,function(n,o){if(o.portion!=j){l=n;return false}});if(typeof l!==
"undefined")f={type:"SPACE",word:g,index:l};else{g=b.words.getNextWord(g);if(g.length){f=g.data("type")==="LINEBREAK"?"LINEBREAK":"NORMAL";f={type:f,word:g}}}}}else if((g=e.data("portions"))&&g.start!==g.end){h=e.data("space");var l;m.each(h,function(n,o){if(o.portion!=j){l=n;return false}});if(typeof l!=="undefined")f={type:"SPACE",word:e,index:l};else Shape.error("some problem")}else{g=b.words.getNextWord(e);if(g.length){f=g.data("type")==="LINEBREAK"?"LINEBREAK":"NORMAL";f={type:f,word:g}}}}if(!c.word||
!c.word.length){d=m(d.line).prev();if(d.length){c.word=b.line.getWordsInLine(d).last();c.type=c.word.data("type")}}if(!f.word||!f.word.length){d=m(a.line).next();if(d.length){f.word=b.line.getWordsInLine(d).first();f.type=f.word.data("type")}}return{prev:c,next:f}},getPortionLength:function(a){return a.t?a.t.length:a.type&&a.type.toLowerCase()==="linebreak"?1:0},field:{set:function(a,b,c){Shape.textBody.paras.portions.t.set(a,b,c)},remove:function(){}},type:{set:function(){},remove:function(){}},
t:{dependency:function(a,b,c){c=!c?Shape.box(a,b):c;var f=a.textBody.paras[a.textBody.paras.num],d=f.portions.num;if(!d){var e=f.style.listStyle;if(e){e=e.bullet;var g=f.portions[d];d=g.t;f=a.textBody.paras.element;(d=!(d&&d.length))&&f.data("changeStatus",true);if(f.data("changeStatus")){g=(g=g.type)&&g.toLowerCase()==="linebreak";var h=Shape.textBody.paras.style.listStyle.bullet;if(e){e.status=!d||g?h.enabled:h.disabled;Shape.textBody.paras.style.listStyle.bullet.status.set(a,b,c)}Shape.textBody.paras.style.listStyle.reorderListNum(a,
b,c);f.data("changeStatus",d)}}}},getWord:function(a,b){var c=0,f=false,d,e,g,h=Shape.textBody.paras.portions.t,j;m.each(a,function(l,n){if(n.spaceObj[0]&&(n.spaceObj[0].at==="before"||n.spaceObj.length===1&&!n.portion.length&&n.spaceObj[0].at==="after")){c+=n.spaceObj[0].index.end-n.spaceObj[0].index.start+1;if(c>b){d=n.spaceObj[0].word;j=b+n.spaceObj[0].index.start;f=true;g=n.line;return false}}if(n.portion.length&&!f)for(var o=n.portion.first(),p=0;o.length;){var r=o.data("subword"),q=r?Shape.textBody.paras.portions.t.words.length(o):
Shape.textBody.paras.portions.t.words.lengthIncludingSpace(o);c+=q;if(c>b){f=true;break}if(r&&m(o[0].nextSibling).length===0){r=h.words.getParentWord(o);for(q=0;n.spaceObj[q];){var s=n.spaceObj[q];if(s.word[0]===r[0]){c+=s.word.data("space").length;o=r;if(c>b){f=true;break}}q++}if(f)break}p++;o=m(n.portion[p])}if(l===a.length-1&&!f)if(n.spaceObj&&n.spaceObj[n.spaceObj.length]&&n.spaceObj[n.spaceObj.length-1].at==="after"){c+=s.word.data("space").length;if(c>b){o=n.spaceObj[0].word;f=true}}if(f){p=
c-b;e=(o.data("subword")?Shape.textBody.paras.portions.t.words.length(o):Shape.textBody.paras.portions.t.words.lengthIncludingSpace(o))-p;d=o;g=n.line;j=e-Shape.textBody.paras.portions.t.words.length(o);j=j>=0?j:undefined;return false}});if(d)return d.data("type")==="SPACE"&&e==-1?{lineDiv:g}:{word:d,index:e,spaceIndex:j,lineDiv:g}},addText:function(a,b,c,f,d){var e=a.textBody.paras.num,g=this.getWord(a.textBody.paras[e].portions.element,d-1);d={data:a,container:b,box:c};if(g){f=this.getWordList(d,
f,a.textBody.paras[e].portions.num);var h,j;if(typeof g.spaceIndex!=="undefined"){j="SPACE";h=g.spaceIndex}else if(typeof g.index!=="undefined"){j=g.word.data("type")?g.word.data("type"):"NORMAL";h=g.index}h={word:g.word,index:h,type:j,lineDiv:g.lineDiv};this.placeWordsInline({words:f.reverse(),prevWord:h,shapeObj:d})}Shape.textBody.paras.portions.element(a,b,c)},removeText:function(a,b,c,f,d,e,g){var h=Shape.textBody.paras.portions.t,j={data:a,container:b,box:c};f=this.getRemovalWords(d,e-1,g-1);
var l,n,o,p,r=undefined;if(f.length){m.each(f,function(q,s){var t=m(),u=m(),v=m();if(s.prev||s.next){var w,x,y=m(),A="",E=[],D=s.prev,C=s.next;if(D&&C){l=D.word;n=D.line;p=C.word;o=C.line;t=n;var F=l.data(),G=p.data(),B=false,z=false;if(typeof D.spaceIndex!=="undefined"){E=m.extend(true,[],F.space);u=E.splice(C.spaceIndex+1);E=E.splice(0,D.spaceIndex);E=m.merge(E,u);u=l;if(E.length===0)if(!F.hasSubword&&!(F.text&&F.text.length)){h.words.remove(j,l);l=m();p=m()}else{h.words.updateSpaceAfter(j,E,u,
t);C=h.words.getNextWordOrSubwordInPara(p,o);p=C.word;o=p.length?C.line:o;if(F.hasSubword)l=h.subword.getSubwords(l,l.data(Shape.textBody.indexId).length-1)}else{z=true;p=m();o=m()}}else{if(w=F.subword){y=h.words.getParentWord(l);x=h.subword.getSubWordIndex(l)}B=true;A=F.text?F.text:"";var H=v="";v=A.substring(0,D.index);if(typeof C.spaceIndex!=="undefined"){z=true;u=p;E=m.extend(true,[],G.space);E=E.splice(C.spaceIndex+1)}else H=G.text.substring(C.index+1);A=v+H;v=l;if(A.length===0||z&&E.length===
0){B=false;if(A.length===0&&(z&&E.length===0||w&&y.data("space").length===0||!w&&F.space.length===0))if(w){if(z){h.words.updateSpaceAfter(j,E,u,t);z=false}C=h.words.getNextWordOrSubwordInPara(p,o);h.subword.removePortion(j,l,F.portion,n);l=h.subword.getSubwords(y,x-1);p=C.word;o=p.length?C.line:o}else{z=false;r=F.broken?F.broken.before:undefined;C=h.words.getPrevWordOrSubwordInPara(l,n);F=h.words.getNextWordOrSubwordInPara(p,o);h.words.remove(j,l);l=C.word;p=F.word;n=l.length?C.line:n;o=p.length?
F.line:o}else if(A.length===0){if(z){h.words.updateSpaceAfter(j,E,u,t);p=u;z=false}if(w){h.subword.removePortion(j,l,F.portion,n);if(x){l=h.subword.getSubwords(y,x-1);p=m()}else{l=m();p=h.subword.getSubwords(y,x)}}else{h.words.updateText(j,{text:A,word:v},t);C=h.words.getPrevWordOrSubwordInPara(l,n);l=C.word;n=l.length?C.line:n}}else if(z&&E.length===0){w?h.subword.updateText(j,{text:A,subword:v,index:x},y,t):h.words.updateText(j,{text:A,word:v},t);h.words.updateSpaceAfter(j,E,u,t);z=false;C=h.words.getNextWordOrSubwordInPara(p,
o);p=C.word;o=p.length?C.line:o}}else p=m()}}else if(D){l=D.word;t=n=D.line;F=l.data();w=F.subword;z=true;u=l;if(w){y=h.words.getParentWord(l);x=h.subword.getSubWordIndex(l);u=y}if(typeof D.spaceIndex!=="undefined"){E=m.extend(true,[],F.space);E=E.splice(0,D.spaceIndex);if(E.length===0){h.words.updateSpaceAfter(j,E,u,t);z=false;if(F.hasSubword)l=h.subword.getSubwords(l,F[Shape.textBody.indexId].length-1)}}else{A=F.text?F.text:"";A=A.substring(0,D.index);v=l;E=[];z=false;if(A.length===0){B=false;if(w){h.subword.removePortion(j,
l,F.portion,n);l=h.subword.getSubwords(y,x-1);h.words.updateSpaceAfter(j,E,u,t)}else{r=F.broken?F.broken.before:undefined;C=h.words.getPrevWordOrSubwordInPara(l,n);h.words.remove(j,l);l=C.word;n=l.length?C.line:n;z=false}}else{w?h.subword.updateText(j,{text:A,subword:v,index:x},y,t):h.words.updateText(j,{text:A,word:v},t);h.words.updateSpaceAfter(j,E,u,t)}}}else if(C){p=C.word;t=o=C.line;G=p.data();B=true;A="";w=G.subword;F={};if(r)F={broken:{before:r}};if(w){y=h.words.getParentWord(p);x=h.subword.getSubWordIndex(p);
v=y.data();m.extend(true,v,F)}else G=m.extend(true,G,F);v=p;if(typeof C.spaceIndex!=="undefined"){z=true;E=m.extend(true,[],G.space);E=E.splice(C.spaceIndex+1);u=p;if(E.length===0){C=h.words.getNextWordOrSubwordInPara(p,o);h.words.remove(j,p);p=C.word;if(p.length&&r){D=G=p.data();if(G.subword){G=h.words.getParentWord(p);D=G.data()}m.extend(true,D,F)}o=p.length?C.line:o;B=z=false}}else{A=G.text?G.text:"";A=A.substring(C.index+1);if(A.length===0){B=false;if(w){C=h.subword.getNextSubword(p);h.subword.removePortion(j,
p,G.portion,o);p=C}else if(G.space.length===0){C=h.words.getNextWordOrSubwordInPara(p,o);h.words.remove(j,p);p=C.word;if(p.length&&r){D=G=p.data();if(G.subword){G=h.words.getParentWord(p);D=G.data()}m.extend(true,D,F)}o=p.length?C.line:o}else h.words.updateText(j,{text:A,word:v},t)}}}if(B)w?h.subword.updateText(j,{text:A,subword:v,index:x},y,t):h.words.updateText(j,{text:A,word:v},t);z&&h.words.updateSpaceAfter(j,E,u,t)}else{r=s.word.data().broken?s.word.data().broken.before:undefined;h.words.remove(j,
s.word)}});f=this.getAdjcentWordObject({prevWord:l,prevline:n,nextWord:p,nextline:o},j);Shape.textBody.paras.portions.combineWords(j,f,f.samePortion);h.breakLine(j,n);Shape.textBody.paras.portions.element(a,b,c)}},getAdjcentWordObject:function(a,b){var c=a.prevWord,f=a.nextWord,d={},e={};if(c.length){c=this.checkSubwordToWord(c,b,true);d=c.data();if(d.subword)d={type:"NORMAL",word:c};else if(!(d.text&&d.text.length)&&d.space&&d.space.length)d={type:"SPACE",word:c,index:d.space.length-1};else{var g=
d.type==="LINEBREAK"?"LINEBREAK":"NORMAL";d={type:g,word:c}}}if(f.length){f=this.checkSubwordToWord(f,b);e=f.data();if(e.subword)e={type:"NORMAL",word:f};else if(!(e.text&&e.text.length)&&e.space&&e.space.length)e={type:"SPACE",word:f,index:0};else{g=e.type==="LINEBREAK"?"LINEBREAK":"NORMAL";e={type:g,word:f}}}f=true;if(d.word&&e.word){f=d.word.data("subword")?d.word.data("portion"):d.word.data("portions").end;c=e.word.data("subword")?e.word.data("portion"):e.word.data("portions").start;f=f===c?true:
false}return{prev:d,next:e,samePortion:f}},checkSubwordToWord:function(a,b,c){var f=a,d=Shape.textBody.paras.portions;if(a&&a.length){c=c?"prev":"next";var e=a.data();if(e.subword||e.hasSubword){a=e.subword?d.t.words.getParentWord(a):a;e=d.t.line.getParentLine(a);var g=d.t.subword.getSubwords(a);if(g.length<2)f=d.convertSubwordToWord(b,g,a,e,c)}}return f},_checkLastSubword:function(a,b,c,f){var d=false;if(b&&m(a[0].nextSibling).length===0){a=Shape.textBody.paras.portions.t.words.getParentWord(a);
c+=a.data("space").length;if(c>f)d=true}return{count:c,wordSpan:a,broke:d}},getRemovalWords:function(a,b,c){var f=0,d=false,e=false,g=false,h,j,l,n=Shape.textBody.paras.portions.t,o;b=b<0?0:b;var p=[];m();m();m();m();for(var r=a.length,q=0;q<r;){var s=a[q],t=s.spaceObj[0]&&(s.spaceObj[0].at==="before"||s.spaceObj.length===1&&!s.portion.length&&s.spaceObj[0].at==="after");l=s.line;if(t){f+=s.spaceObj[0].index.end-s.spaceObj[0].index.start+1;var u={},v={};h=s.spaceObj[0].word;if(f>b&&!e){o=b+s.spaceObj[0].index.start;
d=true;u={prev:{word:h,index:j,spaceIndex:o,line:l}};e=true}if(f>c&&e){o=c+s.spaceObj[0].index.start;v={next:{word:h,index:j,spaceIndex:o,line:l}};g=true}t=m.extend(true,{},u,v);m.isEmptyObject(t)||p.push(t);if(g)break}if(s.portion.length){t=s.portion.first();for(var w=0;t.length;){u={};o=(v=t.data("subword"))?Shape.textBody.paras.portions.t.words.length(t):Shape.textBody.paras.portions.t.words.lengthIncludingSpace(t);f+=o;if(e)if(f>c)g=true;else{if(e){u={word:t,line:l};p.push(u)}}else if(f>b)d=true;
if(!d){h=this._checkLastSubword(t,v,f,b);f=h.count;if(d=h.broke)t=h.wordSpan}if(d&&!e){j=f-b;j=(t.data("subword")?Shape.textBody.paras.portions.t.words.length(t):Shape.textBody.paras.portions.t.words.lengthIncludingSpace(t))-j;l=s.line;o=j-Shape.textBody.paras.portions.t.words.length(t);o=o>=0?o:undefined;h=t;v={};u={prev:{word:h,index:j,spaceIndex:o,line:l}};if(f>c)g=true;if(!g&&t.data("subword")){h=this._checkLastSubword(t,true,f,c);g=h.broke;f=h.count;t=h.wordSpan}if(g){j=f-c;j=(t.data("subword")?
Shape.textBody.paras.portions.t.words.length(t):Shape.textBody.paras.portions.t.words.lengthIncludingSpace(t))-j;o=j-Shape.textBody.paras.portions.t.words.length(t);o=o>=0?o:undefined;h=t;v={next:{word:h,index:j,spaceIndex:o,line:l}}}e=true;u=m.extend(true,{},u,v);p.push(u)}else if(g){j=f-c;j=o-j;l=s.line;o=j-Shape.textBody.paras.portions.t.words.length(t);o=o>=0?o:undefined;h=t;if(typeof o!=="undefined"&&v)h=n.words.getParentWord(t);v={next:{word:h,index:j,spaceIndex:o,line:l}};u=m.extend(true,{},
u,v);p.push(u)}if(g)break;w++;t=m(s.portion[w])}}if(q===r-1&&!g)if(s.spaceObj&&s.spaceObj[s.spaceObj.length]&&s.spaceObj[s.spaceObj.length-1].at==="after"){f+=space.word.data("space").length;l=s.line;u={};t=s.spaceObj[0].word;if(f>b&&!e){j=f-b;j=(t.data("subword")?Shape.textBody.paras.portions.t.words.length(t):Shape.textBody.paras.portions.t.words.lengthIncludingSpace(t))-j;h=t;o=j-Shape.textBody.paras.portions.t.words.length(t);o=o>=0?o:undefined;u={prev:{word:h,index:j,spaceIndex:o,line:l}};e=
d=true}v={};if(d&&f>c){t.data("subword")?Shape.textBody.paras.portions.t.words.length(t):Shape.textBody.paras.portions.t.words.lengthIncludingSpace(t);Shape.textBody.paras.portions.t.words.length(t);break}u=m.extend(true,{},u,v);m.isEmptyObject(u)||p.push(u)}if(g)break;q++}return p},set:function(a,b,c,f,d){c=!c?Shape.box(a,b):c;this.count=0;var e=a.textBody.paras,g=e.num,h=e[g].portions.num,j=e.element,l=Shape.textBody.paras.portions.t;if(!(h>e[g].portions.length-1)){d=l.getWordObjectToRender(a,b,
c,d);f||Shape.textBody.paras.portions._remove(a,b,c);f=l.getPrevWord(a,j,h);h={data:a,container:b,box:c};this.placeWordsInline({words:d.reverse(),prevWord:f,shapeObj:h});c.data("shape_rendered")&&Shape.textBody.paras.portions.element(a,b,c)}},getPrevWord:function(a,b,c,f){var d=Shape.textBody.paras.portions.t;if(a.textBody.paras.prevWord)return a.textBody.paras.prevWord;f=Shape.textBody.paras.portions.getPortion(b,c-1);if(!f.length){c&&Shape.error("-----",c);return{lineDiv:d.line.getLine(b,0)}}a=
f[f.length-1];f=a.portion;var e=a.spaceObj,g;if(e.length&&e[e.length-1]&&e[e.length-1].at==="after"){g=e[e.length-1];g={type:"SPACE",word:g.word,index:g.index.end}}else if(e.length&&e[e.length-1]&&!f.length){g=e[e.length-1];g={type:"SPACE",word:g.word,index:g.index.end}}else if(f&&f.length){g=f.last();f=g.data();e=f.type==="LINEBREAK"?"LINEBREAK":"NORMAL";if(f.portions&&f.portions.end>c-1){var h=-1;m.each(f.space,function(j,l){if(l.portion>c-1)return false;h=j});g={type:"SPACE",word:g,index:h}}else g=
{type:e,word:g}}a=a.line;a.length||(a=d.line.getLine(b,0));g.lineDiv=a;return g},getWordList:function(a,b,c,f){words=[];var d={};if(b&&b.length)Shape.textBody.paras.portions.t.words.split(b,d,f);else d.next={content:"",type:"word"};for(var e;d.next;){obj=d.next;if(obj.type==="word"){e={type:"NORMAL",text:obj.content,portionNum:c,space:[],lang:obj.lang};words.push(e)}else{b=0;if(a)b=Shape.textBody.paras.portions.t.words.getSpaceWidth(a.data,a.data.textBody.paras.num,c,obj.content);if(e){if(!e.space)e.space=
[];e.space.push({afterSpaceWidth:b,portion:c,content:obj.content})}else{e={type:"SPACE",portionNum:c,space:[{afterSpaceWidth:b,portion:c,content:obj.content}]};words.push(e)}}d=obj}return words},getWordObjectToRender:function(a,b,c,f){var d=a.textBody.paras,e=d.num,g=d[e].portions.num;d=d[e].portions[g];b={data:a,container:b,bx:c};if(d.type)a=[{type:"LINEBREAK",portionNum:g,portion:d,text:d.t?d.t:undefined}];else{f=typeof f!=="undefined"?f:d.t?d.t:!e&&!g&&a.placeHolder&&!a.placeHolder.doNotUpdate&&
a.textBody.paras.length===1&&a.textBody.paras[0].portions.length===1?a.placeHolder.text:"";a=this.getWordList(b,f,g)}return a},placeWordsInline:function(a){var b=a.shapeObj,c=a.prevWord,f=a.prevWord.lineDiv,d=a.words,e=Shape.textBody.paras.portions.t;c.type==="NORMAL"&&e.words.getNextWord(l,f);if(d&&d.length){var g,h=d.pop();if(c.type==="SPACE"){var j=c.word.data("space");if(j&&c.index===j.length-1){c.index=undefined;c.type="NORMAL"}}if(c.type==="NORMAL"&&c.word.length){var l=c.word;if((l.data("subword")?
"subWord":"word")==="word"){var n=l.data();n.space||Shape.error("prevWord",c,h,d,f);if(c.index!==-1&&n.lang===Shape.textBody.lang.EAST_ASIAN&&h.type==="NORMAL"&&!h.space.length)c.index=undefined;if(typeof c.index!=="undefined")if(h.type==="NORMAL"||h.type==="SPACE"){var o=n.length;if(c.index>o)Shape.error("prevIndex---"+c.index+"---Leng--"+o);else{o=n.text;g=o.substring(0,c.index+1);var p=o.substring(c.index+1);if(h.lang===Shape.textBody.lang.EAST_ASIAN||n.lang===Shape.textBody.lang.EAST_ASIAN&&h.type!==
"SPACE"){e.removeBreakWord_AfterData(b,l,f);c=h.space.length;j=m.extend(true,[],n.space);d=e.words.set(h,b);if(p.length){n=e.words.set({text:p,lang:n.lang,type:"NORMAL",portionNum:n.portions.start},b);o=m.merge(m.extend(true,m(),d),n);e.words.insertnewWordAfter(b,l,o);e.words.updateSpaceAfter(b,j,n,f)}else{o=d;p=m.extend(true,[],h.space);j=m.merge(j,p);e.words.insertnewWordAfter(b,l,o);e.words.updateSpaceAfter(b,j,o,f)}if(g.length){e.words.updateText(b,{text:g,word:l},f);e.words.updateSpaceAfter(b,
[],l,f)}else e.words.remove(b,l,f);g=c?{type:"SPACE",word:d,index:h.space.length-1}:{type:"WORD",word:d}}else{o="";if(h.text)o=h.text;else h.lang=n.lang;if(h.space.length){h.text=g+o;o=e.words.set(h,b);e.words.insertnewWordBefore(b,l,o,f);if(n.broken&&n.broken.before){c=o.data();c.broken={before:n.broken.before};delete n.broken.before}if(p.length){e.words.updateText(b,{text:p,word:l},f);g={type:"WORD",word:o}}else{c=h.space.length;e.words.addSpaceAfterWord(b,o,m.extend(true,[],l.data("space")),f);
if(n.broken&&n.broken.after){n=e.words.getNextWordInPara(l,f,b.data.textBody.paras.element).word;(j=n.data())&&j.broken&&delete j.broken.before}e.words.remove(b,l);g={type:"SPACE",word:o,index:c-1}}}else{newText=g+o+p;e.words.updateText(b,{text:newText,word:l},f);g={type:"WORD",word:l,index:g.length+o.length-1}}}}}else if(h.type==="LINEBREAK"){o=n.length;if(c.index>o)Shape.error("prevIndex---"+c.index+"---Leng--"+o);else{o=n.text;g=o.substring(0,c.index+1);p=o.substring(c.index+1);e.words.updateText(b,
{text:g,word:l},f);o=e.words.set(h,b);g=e.words.set({text:p,lang:n.lang,type:"NORMAL",portionNum:n.portions.start},b);c=m.merge(m.extend(true,m(),o),g);if(n.broken&&n.broken.after){h=n.broken.after;delete n.broken.after;g.data().broken={after:h}}e.words.insertnewWordAfter(b,l,c,f);g={type:"WORD",word:o}}}else Shape.error("Wrong type",h.type);else if(n.space.length)if(h.type==="NORMAL"){o=e.words.getNextWordInPara(l,f,b.data.textBody.paras.element);n=o.word;if(h.space.length||!n.length||h.lang===Shape.textBody.lang.EAST_ASIAN||
n.length&&n.data("lang")===Shape.textBody.lang.EAST_ASIAN){o=e.words.set(h,b);e.words.insertnewWordAfter(b,l,o);g={type:"WORD",word:o}}else{g=n.data();if(g.type==="LINEBREAK"){o=e.words.set(h,b);e.words.insertnewWordAfter(b,l,o);g={type:"WORD",word:o}}else if(h.portionNum===g.portions.start)if(g.hasSubword){l=e.subword.getSubwords(n,0);j=h.text+l.data("text");e.subword.updateText(b,{text:j,subword:l,index:0},n,o.line);g={type:"SUBWORD",word:l,index:h.text.length-1}}else{j=h.text+g.text;e.words.updateText(b,
{text:j,word:n},o.line);g={type:"WORD",word:n,index:h.text.length-1}}else{l=e.subword.set(h,b);j=n.data();h=j.broken&&!j.hasSubword?j.broken.after:undefined;n=e.subword.insertSubWordInWord(b,m.extend(true,{},l),n,0);h&&n.data("broken",{after:h});f=o.line;g={type:"SUBWORD",word:l}}}}else if(h.type==="LINEBREAK"){o=e.words.set(h,b);j=e.words.insertnewWordAfter(b,l,o)}else{h.space||Shape.error("BUG...!!!!");e.words.addSpaceAfterWord(b,l,h.space,f);g={type:"WORD",word:l}}else if(h.type==="NORMAL")if(h.lang===
Shape.textBody.lang.EAST_ASIAN){o=e.words.set(h,b);e.removeBreakWord_AfterData(b,l,f);e.words.insertnewWordAfter(b,l,o);g={type:"WORD",word:o}}else if(n.lang===Shape.textBody.lang.EAST_ASIAN){o=e.words.getNextWordInPara(l,f,b.data.textBody.paras.element);n=o.word;if((j=n.data())&&j.type==="NORMAL"&&j.lang!==Shape.textBody.lang.EAST_ASIAN&&!h.space.length)if(j.portions.start!==h.portionNum){p=e.subword.set(h,b);h=j.broken&&j.broken.after?j.broken.after:undefined;n=e.subword.insertSubWordInWord(b,p,
n,0);if(h){n=n.data();n.broken={after:h}}g={type:"SUBWORD",word:p}}else if(j.hasSubword){l=e.subword.getSubwords(n,0);j=h.text+l.data("text");e.subword.updateText(b,{text:j,subword:l,index:0},n,o.line)}else{j=h.text+j.text;e.words.updateText(b,{text:j,word:n},o.line)}else if(j&&j.type==="SPACE"){j=m.extend(true,[],j.space);c=h.space.length;m.merge(h.space,j);o=e.words.set(h,b);e.words.insertnewWordAfter(b,l,o);e.words.remove(b,n);g=j.length?{type:"SPACE",word:o,index:c-1}:{type:"WORD",word:o}}else{o=
e.words.set(h,b);e.words.insertnewWordAfter(b,l,o);g={type:"WORD",word:o}}}else{p=e.subword.set(h,b);o=(j=n[Shape.textBody.indexId].length)&&n.broken&&n.broken.before?n.broken.before:undefined;c.word=e.subword.insertSubWordInWord(b,p,l,j?j:1);l=c.word;e.words.addSpaceAfterWord(b,l,h.space,f);n=l.data();if(o)n.broken={before:o};g={type:"WORD",word:l}}else if(h.type==="LINEBREAK"){o=e.words.set(h,b);e.removeBreakWord_AfterData(b,l,f);e.words.insertnewWordAfter(b,l,o);g={type:"LINEBREAK",word:o}}else{e.words.addSpaceAfterWord(b,
l,h.space,f);g={type:"WORD",word:l};e.removeBreakWord_AfterData(b,l,f)}}else{n=e.words.getParentWord(l);n[0]||Shape.error("Some problem with the previous word");d=e.subword.getSubWordIndex(l);o=n.find("."+Shape.textBody.subwordId);if(h.type==="LINEBREAK"){if(typeof c.index==="undefined"){if(d===o.length-1){o=n.data();if(o.space.length){l=m.extend(true,[],o.space);e.words.updateSpaceAfter(b,[],n,f);o=e.words.set(h,b);h=e.words.set({type:"SPACE",lang:"OTHER",space:l,portionNum:l[0].portion},b);d=m.merge(m.extend(true,
{},o),h);e.words.insertnewWordAfter(b,n,d)}else{o=e.words.set(h,b);e.removeBreakWord_AfterData(b,n,f);e.words.insertnewWordAfter(b,n,o)}}else{o=e.words.set(h,b);l=e.subword.getSubwords(n,{till:d});g=e.subword.getSubwords(n,{from:d+1});l=e.words.createWordFromSubwords(b,l);c=e.words.createWordFromSubwords(b,g,n.data("space"));e.splitBrokenWord(n,l,c);h=m.merge(l,o);h=m.merge(h,c);e.words.insertnewWordAfter(b,n,h);e.words.remove(b,n,f)}g={type:"LINEBREAK",word:o}}}else if(typeof c.index!=="undefined"){p=
l;j=l.data();if(h.lang===Shape.textBody.lang.EAST_ASIAN){o=m.extend(true,[],n.data("space"));l=e.subword.getSubwords(n,{till:d-1});g=e.subword.getSubwords(n,{from:d+1});p=j.text.substring(0,c.index+1);p=e.subword.set({text:p,type:"NORMAL",portionNum:j.portion,fontData:{font:j.font,textCase:j.textCase}},b);l=m.merge(l,p);if(c=j.text.substring(c.index+1)){c=e.subword.set({text:c,type:"NORMAL",portionNum:j.portion,fontData:{font:j.font,textCase:j.textCase}},b);g=m.merge(c,g)}if(g.length){l=e.words.createWordFromSubwords(b,
l,[]);c=e.words.createWordFromSubwords(b,g,o);p=e.words.set(h,b);e.splitBrokenWord(n,l,c);g={type:"WORD",word:p};h=m.merge(l,m.extend(true,m(),p));h=m.merge(h,c)}else{c=h.space.length;m.merge(h.space,o);p=e.words.set(h,b);l=e.words.createWordFromSubwords(b,l,[]);h=m.merge(m.extend(true,m(),l),p);g=o.length?{type:"SPACE",word:p,index:c-1}:{type:"WORD",word:p};o=n.data();if(o.broken){if(o.broken.before){l=l.data();l.broken={before:o.broken.before}}if(o.broken.after){o=e.words.getNextWordInPara(n,f,
b.data.textBody.paras.element);(o=o.word.data())&&o.broken&&o.broken.before&&delete o.broken.before}}}e.words.insertnewWordAfter(b,n,h);e.words.remove(b,n,f)}else if(h.type==="NORMAL"&&!h.space.length){j=j.text;j=j.substring(0,c.index+1)+h.text+j.substring(c.index+1);o=e.subword.getSubWordIndex(p,n);e.subword.updateText(b,{text:j,subword:p,index:o},n,f);g={type:"NORMAL",word:l,index:c.index+h.text.length}}else if(h.space.length){o=m.extend(true,[],n.data("space"));l=e.subword.getSubwords(n,{till:d-
1});g=e.subword.getSubwords(n,{from:d+1});p=j.text.substring(0,c.index+1);p=h.text?p+h.text:p;p=e.subword.set({text:p,type:"NORMAL",portionNum:j.portion,fontData:{font:j.font,textCase:j.textCase}},b);l=m.merge(l,p);if(c=j.text.substring(c.index+1)){c=e.subword.set({text:c,type:"NORMAL",portionNum:j.portion,fontData:{font:j.font,textCase:j.textCase}},b);g=m.merge(c,g)}if(g.length){l=e.words.createWordFromSubwords(b,l,h.space);c=e.words.createWordFromSubwords(b,g,o);e.splitBrokenWord(n,l,c);g={type:"WORD",
word:l};h=m.merge(m.extend(true,m(),l),c)}else{c=h.space.length;h=m.merge(h.space,o);h=e.words.createWordFromSubwords(b,l,h);g=o.length?{type:"SPACE",word:h,index:c-1}:{type:"WORD",word:h};o=n.data();if(o.broken){if(o.broken.before){l=h.data();l.broken={before:o.broken.before}}if(o.broken.after){o=e.words.getNextWordInPara(n,f,b.data.textBody.paras.element);(o=o.word.data())&&o.broken&&o.broken.before&&delete o.broken.before}}}e.words.insertnewWordAfter(b,n,h);e.words.remove(b,n,f)}}else if(d===o.length-
1)if(h.lang===Shape.textBody.lang.EAST_ASIAN){c=h.space.length;if((j=m.extend(true,[],n.data().space))&&j.length){h.space=m.extend(true,h.space,j);e.words.updateSpaceAfter(b,[],n,f)}o=e.words.set(h,b);e.words.insertnewWordAfter(b,n,o,f);g=j.length?{type:"SPACE",word:o,index:c-1}:{type:"WORD",word:o}}else{o=n.data();if(c=h.space.length)if(o.space.length){if(h.text){p=e.subword.set(h,b);n=e.subword.insertSubWordInWord(b,p,n,d+1)}e.words.addSpaceAfterWord(b,n,h.space,f,true);g={type:"SPACE",word:n,index:c-
1}}else{e.removeBreakWord_AfterData(b,n,f);if(h.text){p=e.subword.set(h,b);n=e.subword.insertSubWordInWord(b,p,n,d+1)}e.words.addSpaceAfterWord(b,n,h.space,f);g={type:"WORD",word:n}}else if(h.text){p=e.subword.set(h,b);e.subword.insertSubWordInWord(b,p,n,d+1);g={type:"SUBWORD",word:p}}}else if(h.lang===Shape.textBody.lang.EAST_ASIAN){l=e.subword.getSubwords(n,{till:d});g=e.subword.getSubwords(n,{from:d+1});l=e.words.createWordFromSubwords(b,l,[]);o=e.words.set(h,b);c=e.words.createWordFromSubwords(b,
g,n.data("space"));e.splitBrokenWord(n,l,c);h=m.merge(l,m.extend(true,m(),o));h=m.merge(h,c);e.words.insertnewWordAfter(b,n,h);e.words.remove(b,n,f);g={type:"WORD",word:o}}else if(h.space.length){j=m.extend(true,[],n.data("space"));if(h.type!=="SPACE")p=e.subword.set(h,b);l=e.subword.getSubwords(n,{till:d});o=p?m.merge(l,p):l;g=e.subword.getSubwords(n,{from:d+1});l=e.words.createWordFromSubwords(b,o,h.space);o=m.extend(true,{},l);c=e.words.createWordFromSubwords(b,g,j);h=m.merge(l,c);e.splitBrokenWord(n,
l,c);e.words.insertnewWordAfter(b,n,h);e.words.remove(b,n,f);g={type:"WORD",word:o}}else{p=e.subword.set(h,b);e.subword.insertSubWordInWord(b,p,n,d+1);g={type:"SUBWORD",word:p}}}}else if(c.type==="LINEBREAK"){o=e.words.getNextWordInPara(c.word,f,b.data.textBody.paras.element);n=o.word;if(!n.length||h.lang===Shape.textBody.lang.EAST_ASIAN||n.length&&n.data("lang")===Shape.textBody.lang.EAST_ASIAN){l=c.word;o=e.words.set(h,b);e.words.insertnewWordAfter(b,l,o);g={type:"WORD",word:o}}else{j=n.data();
l=j.type;if(h.type==="NORMAL")if(h.space.length&&j.type!=="SPACE"){l=c.word;o=e.words.set(h,b);e.words.insertnewWordAfter(b,l,o);g={type:"WORD",word:o}}else if(l==="NORMAL")if(j.portions.start!==h.portionNum){p=e.subword.set(h,b);h=j.broken&&j.broken.after?j.broken.after:undefined;n=e.subword.insertSubWordInWord(b,p,n,0);if(h){n=n.data();n.broken={after:h}}g={type:"SUBWORD",word:p}}else{Shape.log("case[25, 26]: pW: LB, cW: word without space, nW: word/SW with portion start as that of current word");
if(j.hasSubword){l=e.subword.getSubwords(n,{till:0});o=l.data();e.subword.updateText(b,{text:h.text+o.text,subword:l,index:0},n);g={type:"SUBWORD",word:l,index:h.text.length-1}}else{e.words.updateText(b,{text:h.text+j.text,word:n});g={type:"WORD",word:n,index:h.text.length-1}}}else if(l==="SPACE")if(h.portionNum!==j.portions.start){c=h.space.length;m.merge(h.space,j.space);o=e.words.set(h,b);e.words.insertnewWordAfter(b,n,o);e.words.remove(b,n);g={type:"SPACE",word:o,index:c-1}}else{e.words.updateText(b,
{text:h.text,word:n});g={type:"WORD",word:n,index:h.space.length-1}}else{if(l==="LINEBREAK"){l=c.word;o=e.words.set(h,b);e.words.insertnewWordAfter(b,l,o);g={type:"WORD",word:o}}}else if(h.type==="SPACE")if(l==="NORMAL"||l==="LINEBREAK"){l=c.word;o=e.words.set(h,b);e.words.insertnewWordAfter(b,l,o);g={type:"WORD",word:o}}else{if(l==="SPACE"){e.words.addSpaceAfterWord(b,n,m.extend(true,[],h.space),o.line,true);g={type:"SPACE",word:n,index:h.space.length-1}}}else if(h.type==="LINEBREAK"){o=e.words.set(h,
b);e.words.insertnewWordAfter(b,c.word,o);g={type:"WORD",word:o}}}}else if(c.type==="SPACE"){n=c.word;j=c.index;if(h.type==="NORMAL"){o=n.data();if(o.space.length!==j+1){l=n.data();if(j===-1)if(h.lang===Shape.textBody.lang.EAST_ASIAN||o.lang===Shape.textBody.lang.EAST_ASIAN){j=m.extend(true,[],l.space);c=h.space.length;m.merge(h.space,j);o=e.words.set(h,b);e.words.updateSpaceAfter(b,[],n,f);e.words.insertnewWordAfter(b,n,o,f);g=j.length?{type:"SPACE",word:o,index:c-1}:{type:"WORD",word:o}}else{p=
e.subword.set(h,b);o=h.space.length;j=l[Shape.textBody.indexId].length;n=e.subword.insertSubWordInWord(b,p,n,j?j:1);e.words.addSpaceAfterWord(b,n,h.space,f,true);g=l.space.length?{type:"SPACE",index:o-1,word:n}:{type:"WORD",word:n}}else{l.space.length<1&&Shape.error("Multiple space case but the word has only one space");l=o.space.slice(0,j+1);o=o.space.slice(j+1,o.space.length);e.words.updateSpaceAfter(b,l,n,f);j=h.space.length-1;m.merge(h.space,o);o=e.words.set(h,b);e.words.insertnewWordAfter(b,
n,o,f);g={type:"SPACE",word:o,index:j}}}}else if(h.type==="LINEBREAK"){o=n.data();l=o.space.slice(0,j+1);o=o.space.slice(j+1,o.space.length);e.words.updateSpaceAfter(b,l,n,f);h=e.words.set(h,b);l=m.extend(true,{},h);if(o.length){g=e.words.set({type:"SPACE",lang:"OTHER",space:o,portionNum:o[0].portion},b);l=m.merge(l,g);e.words.insertnewWordAfter(b,n,l,f);e.words.updateSpaceAfter(b,o,g,f)}else e.words.insertnewWordAfter(b,n,l,f);g={type:"LINEBREAK",word:h}}else{o=n.data();l=o.space.slice(0,j+1);o=
o.space.slice(j+1,o.space.length);p=h.space;j=l.length+p.length-1;m.merge(p,o);m.merge(l,p);e.words.updateSpaceAfter(b,l,n,f);g={type:"SPACE",word:n,index:j}}}else{o=e.words.getNextWordInPara(undefined,f,b.data.textBody.paras.element);n=o.word;l=o.line;if(h.type==="NORMAL")if(!n.length||h.lang===Shape.textBody.lang.EAST_ASIAN||n.length&&n.data("lang")===Shape.textBody.lang.EAST_ASIAN){o=e.words.set(h,b);e.words.prependNewWord(b,o,f);g={type:"WORD",word:o}}else{g=n.data();if(g.type==="SPACE"){j=h.space.length-
1;m.merge(h.space,g.space);o=e.words.set(h,b);e.words.prependNewWord(b,o,f);e.words.remove(b,n,l);g={type:"SPACE",word:o,index:j}}else if(h.space&&h.space.length||g.type==="LINEBREAK"){o=e.words.set(h,b);e.words.prependNewWord(b,o,f);g={type:"WORD",word:o}}else{p=e.subword.set(h,b);j=m.extend(true,[],n.data("space"));o=e.subword.createSubWordsFromWordData(n.data(),n,b);o=m.merge(m.extend(true,{},p),o);o=e.words.createWordFromSubwords(b,o,j);if(g.broken){c=o.data();c.broken=m.extend(true,{},g.broken)}e.words.prependNewWord(b,
o,f);e.words.remove(b,n);g={type:"SUBWORD",word:p}}}else if(h.type==="LINEBREAK"){n=e.line.getWordsInLine(f).first().not(".eop");l=n.data();o=e.words.set(h,b);if(n.length&&!(l.text&&l.text.length)&&!l[Shape.textBody.indexId].length&&!l.space.length&&l.type==="NORMAL"){e.words.insertnewWordAfter(b,n,o,f);e.words.remove(b,n)}else e.words.prependNewWord(b,o,f);g={type:"LINEBREAK",word:o}}else if(!n||!n.length){o=e.words.set(h,b);e.words.prependNewWord(b,o,f);g={type:"WORD",word:o}}else{g=n.data();if(g.type===
"SPACE"){c=h.space.length-1;e.words.addSpaceAfterWord(b,n,h.space,f,true);g={type:"SPACE",word:n,index:c}}else{o=e.words.set(h,b);e.words.prependNewWord(b,o,f);g={type:"WORD",word:o}}}}}this.count1=0;this.breakLine(b,f,g);if(g&&a.words.length){if(!g.word||!g.word.length)Shape.error("SOME PROBLEM---- CHECK THE ADDED WORD IS EMPTY",g);f={};if(g.type==="WORD"||g.type==="SUBWORD"){f.type="NORMAL";f.index=g.index;if(g.word.data("broken")){f.word=g.word;f.lineDiv=e.line.getParentLine(g.word)}else f.word=
g.word}else if(g.type==="LINEBREAK"){f.type="LINEBREAK";f.word=g.word}else{f.type="SPACE";f.word=g.word;f.index=g.index}a.prevWord=f;if(!f.lineDiv)a.prevWord.lineDiv=e.line.getParentLine(f.word);this.count++;if(b.data.textBody.paras.fromPara)b.data.textBody.paras.prevWord=m.extend(true,{},a.prevWord);this.placeWordsInline(a)}},printLineWords:function(a){m.each(a.children(),function(b,c){c=m(c);Shape.log("----------\>>>",c.text(),c.data("type"),c.data())})},breakLine:function(a,b,c,f){var d=a.data.textBody.paras.element;
if(d&&d.length){var e=d.data("chIndex").length;c=c?c:{};var g=Shape.textBody.paras.portions.t,h=b;do{b=h;h=b.prev();if(h.length){var j=h.data(),l=g.line.getWordsInLine(b).first(),n=g.line.getWordsInLine(h).last();l=l.length?g.words.width(l):0;if(n.length)if(n.data().type==="LINEBREAK")break}}while(h.length&&(j.remainingWidth-l>-1||n&&!n.length));this._breakLine(a,b,c,f);c=d.data("chIndex").length;e!==c&&b.trigger("line_modified",{create:true,element:b,para:d,box:a.box,data:a.data,container:a.container})}},
_breakLine:function(a,b,c,f){f||(f=1);f++;if(f>200)Shape.log("looping..");else if(b&&b.length){var d=b.data(),e=d.remainingWidth,g=Shape.textBody.paras.portions.t;if(isNaN(d.remainingWidth))Shape.error();else{var h=g.line.getWordsInLine(b).last(),j=h.data();if(j&&j.broken&&j.broken.after){this.connectBrokenWords(h,b,a);e=d.remainingWidth}var l,n=g.line.getWordsInLine(b);d=this.getWordsAfterLinebreak(n);if(d.length)l={words:d};if(e<0||l){h=g.line.getLastWord(n,b);d=0;if(h.length)d=g.words.getTotalSpaceWidth(h);
if(e+d<0||l){l=l?l:this.getExtraWords(b);e=l.words;if(e.not(".eop").length||e.length===1&&e.data("type")==="EOP"&&h.data("type")==="LINEBREAK"){d=g.line.next(b);d=!d.length?g.line.create(a.data,a.container,a.box,a.data.textBody.paras.element):d;if(e.length===n.length)this.breakWord(a,l,b,d,c,f);else{g.words.removeWordDataFromLine(a,e,b);g.words.prependNewWord(a,e,d);e=b.data("remainingWidth");h=g.line.getLastWord(g.line.getWordsInLine(b),b);if(h.length)e+=g.words.getTotalSpaceWidth(h);e<-1?this._breakLine(a,
b,c,f):this._breakLine(a,d,c,f)}}else{d=g.line.next(b);this._breakLine(a,d,c,f)}}else{d=g.line.next(b);if(d.length){e=g.line.getWordsInLine(d);e=g.line.getFirstWordFromLine(d,e);g=[];if(e.data("type")==="EOP"||e.data("type")==="LINEBREAK")g.push({line:d,words:e});this._breakLineShrinkCase(a,b,c,f,g,d)}}}else{d=g.line.next(b);if(j&&j.type==="LINEBREAK")d.length&&this._breakLine(a,d,c,f);else{g=[];this.getNecessaryWords(b,e,g);this._breakLineShrinkCase(a,b,c,f,g,d)}}}}},_breakLineShrinkCase:function(a,
b,c,f,d,e){var g=Shape.textBody.paras.portions.t;if(d.length){var h=m();m.each(d,function(j,l){if(l.words.length){g.words.removeWordDataFromLine(a,l.words,l.line);h=m.merge(h,l.words)}});h.length&&g.words.appendNewWord(a,h,b);g.line.detectEmptyLineAndDelete(a,g.line.next(b));e=g.line.next(b);this._breakLine(a,e,c,f)}for(b=b.next();b.length;){if(b.data(Shape.textBody.indexId).length)break;else g.line.remove(a,b);b=b.next()}},combineTwoWords:function(a,b,c){var f=Shape.textBody.paras.portions.t,d=c.data("broken");
d=d?d.after:undefined;var e=f.line.getParentLine(b),g=m.extend(true,[],c.data("space"));if(b.data("hasSubword")){var h=b.find("."+Shape.textBody.subwordId),j=h.last();if(c.data("hasSubword")){var l=c.find("."+Shape.textBody.subwordId).first();if(j.data("portion")===l.data("portion")){var n=j.data("text");l=l.data("text");n+=l;j.data("actualText",n);f.subword.updateText(a,{text:n,subword:j,index:h.length-1},b,e);j=f.subword.getSubwords(c,{from:1})}else j=f.subword.getSubwords(c);b=f.subword.insertSubWordInWord(a,
j,b,h.length)}else if(j.data("portion")===c.data("portions").start){n=j.data("text");l=c.data("text");n+=l;j.data("actualText",n);f.subword.updateText(a,{text:n,subword:j,index:h.length-1},b,e)}else{j=f.subword.createSubWordsFromWordData(c.data(),c,a);b=f.subword.insertSubWordInWord(a,j,b,h.length)}}else if(c.data("hasSubword")){l=c.find("."+Shape.textBody.subwordId).first();if(b.data("portions").start===l.data("portion")){n=b.data("text");l=l.data("text");f.words.updateText(a,{text:n+l,word:b},e);
j=f.subword.getSubwords(c,{from:1})}else j=f.subword.getSubwords(c);b=f.subword.insertSubWordInWord(a,j,b,1)}else if(b.data("portions").start===c.data("portions").start){n=b.data("text");l=c.data("text");n+=l;f.words.updateText(a,{text:n,word:b},e);b.data("actualText",n)}else{j=f.subword.createSubWordsFromWordData(c.data(),c,a);b=f.subword.insertSubWordInWord(a,j,b,1)}f.words.updateSpaceAfter(a,g,b,e);f.words.remove(a,c);if(d){a=b.data();a.broken=a.broken?a.broken:{};a.broken.after=d}return b},connectBrokenWords:function(a,
b,c){var f=Shape.textBody.paras.portions.t,d=a.data("broken");d=d?d.after:undefined;b=f.words.getNextWordInPara(a,b,c.data.textBody.paras.element);b=b.word;if(b.length)for(var e=b.data();e.broken&&e.broken.before&&e.broken.before===d;){a=this.combineTwoWords(c,a,b);b=f.line.getParentLine(a);d=a.data();d=d.broken?d.broken.after:undefined;b=f.words.getNextWordInPara(a,b,c.data.textBody.paras.element);b=b.word;if(!b.length)break;e=b.data()}c=a.data();c.broken=m.extend(true,c.broken,{after:false});return a},
splitBrokenWord:function(a,b,c){a=a.data();if(a.broken){if(a.broken.before)b.data().broken={before:a.broken.before};if(a.broken.after)c.data().broken={after:a.broken.after}}},removeBreakWord_AfterData:function(a,b,c){var f=b.data();if(f.broken&&f.broken.after){var d=Shape.textBody.paras.portions.t;delete f.broken.after;(a=d.words.getNextWordInPara(b,c,a.data.textBody.paras.element).word.data())&&a.broken&&delete a.broken.before}},breakWord:function(a,b,c,f,d,e){var g=c.data().remainingWidth,h=Shape.textBody.paras.portions.t,
j=b.words.filter(".eop"),l=m(b.words.not(".eop")[0]);b.words.splice(0,1);l=this.connectBrokenWords(l,c,a);g=c.data("remainingWidth");var n=m.extend(true,[],b.words);m.each(n,function(p,r){r=m(r);g+=h.words.widthIncludingSpace(r)});var o=this.getBrokenWord(a,l,g,c);if(o&&o.length||n.not(".eop").length){n=n.reverse();m.each(n,function(p,r){r=m(r);h.words.removeWordDataFromLine(a,r,c)});b.words.filter(".eop").length||m.merge(b.words,j);o=m.merge(o,b.words);f=h.line.next(c);h.words.prependNewWord(a,o,
f);if(l.filter(d.word).length){d.word=m(o.not(".eop")[0]);d.type="WORD";delete d.index}this.breakLine(a,f,d,e)}else h.line.detectEmptyLineAndDelete(a,f)},splitWord:function(a,b,c,f){var d=Shape.textBody.paras.portions.t,e="",g="",h;for(g=a.length;g>=0;g--)if(!f&&!g)break;else{e=a.substring(0,g);h=d.words._beforeCanvasDim(e,c.textCase,c.font);if(h.width<b)break}f||(g=g?g:1);g=a.substring(g);return{text1:e,text2:g}},getBrokenWord:function(a,b,c,f){var d=Shape.textBody.paras.portions.t,e=a.data,g=b.data();
if(g[Shape.textBody.indexId].length){f.data();s=m.extend(true,[],b.data("space"));var h=d.subword.getSubwords(b),j,l=0,n=0;r=0;var o=f.data("totalWidth");m.each(h,function(u,v){v=m(v);n=d.subword.width(v);l+=n;j=v;r=u;if(l>o)return false});l-=n;c=o-l;var p=j.data();h=p.text;q=e.textBody.paras.num;g=p.portion;q=p.spellCheckId;c=this.splitWord(h,c,p,!!r);p=c.text1;c=c.text2;if(p.length){d.subword.updateText(a,{text:p,subword:j,index:r},b,f);p=m();if(c.length){p=d.subword.clone({text:c,portionNum:g},
j,e);p.data("actualText",h)}j.data("actualText",h);p.data("actualText",h);q&&p.data("spellCheckId",q);h=d.subword.getSubwords(b,{from:r+1});h=m.merge(p,h);e=d.subword.getSubwords(b,{till:r})}else{e=d.subword.getSubwords(b,{till:r-1});h=d.subword.getSubwords(b,{from:r})}if(h.length){s=d.words.createWordFromSubwords(a,h,s);e=d.words.createWordFromSubwords(a,e);d.words.addSpellCheckSpan(s);d.words.addSpellCheckSpan(e);p=Math.uuid();t=m.extend(true,{},b.data("broken"));e.data("broken",m.extend(true,t,
{after:p}));d.words.insertnewWordBefore(a,b,e,f);d.words.remove(a,b);s.data("broken",{before:p});return s}}else{d.words.lengthIncludingSpace(b);var r=d.words.getWordIndex(b);s=d.words.widthIncludingSpace(b);c+=s;h=g.text?g.text:"";var q=e.textBody.paras.num;q=e.textBody.paras[q].portions[g.portions.start];c=this.splitWord(h,c,g);p=c.text1;c=c.text2;f.data();d.words.updateText(a,{text:p,word:b,index:r},f);var s=m.extend(true,[],g.space);p=Math.uuid();var t=m.extend(true,{},b.data("broken"));b.data("broken",
m.extend(true,t,{after:p}));b.data("actualText",h);if(c.length){d.words.updateSpaceAfter(a,[],b,f);a=d.words.clone({text:c,type:"NORMAL",portionNum:g.portions.start,portion:q,space:s},b,e);t=m.extend(true,{},a.data("broken"));a.data("broken",m.extend(true,t,{before:p}));a.data("actualText",h);if(g.spellCheckId){a.data("spellCheckId",Math.uuid());d.words.addSpellCheckSpan(b);d.words.addSpellCheckSpan(a)}return a}}return m()},getNecessaryWords:function(a,b,c){var f=Shape.textBody.paras.portions.t,d=
f.line.next(a);if(d.length){var e=f.line.getWordsInLine(d),g=f.line.getFirstWordFromLine(d,e);if(g.data("type")==="EOP")if(f.line.getLastWord(undefined,a).data("type")==="LINEBREAK")return;var h=false;a=g.length?f.words.width(g):0;if(b-a>-1){var j=m();m.each(e,function(l,n){n=m(n);var o=f.words.width(n),p=f.words.getTotalSpaceWidth(n);b-=o;if(b<=-1){h=true;return false}b-=p;j=m.merge(j,n);if(n.data("type")==="LINEBREAK"){h=true;return false}});c.push({line:d,words:j});h||this.getNecessaryWords(d,
b,c)}}},getWordsAfterLinebreak:function(a){var b=m();flag=false;m.each(a,function(c,f){f=m(f);if(flag)b=m.merge(b,f);else flag=f.hasClass("LINEBREAK")});return b},getExtraWords:function(a){var b=Shape.textBody.paras.portions.t,c=a.data().remainingWidth;a=b.line.getWordsInLine(a);var f=m();a=a.reverse();var d;m.each(a,function(e,g){g=m(g);var h=b.words.widthIncludingSpace(g);c+=h;if(c>-1){d=e;var j=b.words.width(g);if(c-h+(h-j)>-1){d=e-1;return false}f=m.merge(f,g);return false}else f=m.merge(f,g)});
a=m(a[d+1]);f=f.reverse();return{words:f,lastWord:a}},createLineBreak:function(){return m("<span id = "+Shape.textBody.LineBreakId+"></span>")},subword:{id:"subwords",index:{set:function(a,b,c,f,d,e){Shape.textBody.index.set(a,b,c,f);if(!e){f=Shape.textBody.paras.portions.t.words;e=f.getWordIndex(b);d||(d=Shape.textBody.paras.portions.t.line.getParentLine(b));f.index.update(a,d,c,e)}},get:function(a,b,c){return Shape.textBody.index.get(a,b,c)},update:function(a,b,c,f,d){Shape.textBody.index.update(a,
b,c,f);f=Shape.textBody.paras.portions.t.words;b=f.getWordIndex(b);f.index.update(a,d,c,b)},remove:function(a,b,c,f){var d=Shape.textBody.index.get(a,b,c);Shape.textBody.index.remove(a,b,c);c=Shape.textBody.paras.portions.t.words;b=c.getWordIndex(b);c.index.update(a,f,-1*d,b)}},getParentWord:function(a){return a.closest("."+Shape.textBody.wordId)},getPrevSubword:function(a){return a.prev().not("#spellcheckspan")},getNextSubword:function(a){return a.next()},width:function(a){return a.data("wordWidth")},
length:function(a){return a.data("text").length},setDim:function(a,b,c){Shape.textBody.paras.portions.t.words.setDim(a,b,c)},clone:function(a,b,c){var f=b.data();b=b.clone();var d=b.data();d.text=a.text;d.length=a.text.length;var e=b.children("#"+Shape.textBody.subportionId);e.length?e.text(a.text):b.text(a.text);d.portion=a.portionNum;d.subword=true;this.setDim(b,c,{font:f.font,textCase:f.textCase});return b},updateText:function(a,b,c,f){a=a.data;var d=Shape.textBody.paras.portions.t,e=b.subword,
g=e.data();f||(f=d.line.getParentLine(c));var h=this.length(e);this.width(e);b.text=b.text?b.text:"";var j=e.find("#"+Shape.textBody.subportionId);if(j&&j.length)j.text(b.text);else{j=e.contents().filter(function(){return this.nodeType===3});if(j.length)j[0].nodeValue=b.text;else b.text&&e.text(b.text)}g.text=b.text;g.length=b.text.length;j=d.subword.width(e);this.setDim(e,a,{font:g.font,textCase:g.textCase});var l=d.subword.width(e),n=d.words.width(c);g=c.data();g.wordWidth=g.wordWidth-j+l;e=this.length(e)-
h;d=d.words.width(c)-n;b=b.index;c.data("length",c.data("length")+e);g.errorword&&Shape.textBody.paras.portions.t.words.addSpellCheckSpan(c);this.index.update(a,c,e,b,f);f.data().remainingWidth-=d},getSubWordIndex:function(a,b){b||(b=a.closest("."+Shape.textBody.wordId));return b.children("."+Shape.textBody.subwordId).index(a)},removePortion:function(a,b,c,f){this._remove(b,a.data,f,a)},_remove:function(a,b,c){var f=Shape.textBody.paras.portions.t.words.getParentWord(a);c||(c=Shape.textBody.paras.portions.t.line.getParentLine(f));
var d=a.data(),e=a.data("text").length,g=d.wordWidth,h=this.getSubWordIndex(a,f);this.index.remove(b,f,h,c);b=f.data();c=c.data();b.length-=e;d.spellCheckId&&Shape.textBody.paras.portions.t.words.removeSpellCheckSpan(a);b.wordWidth-=d.wordWidth;a.remove();e=a=false;if(d.portion===b.portions.start){a=c.portions.start===b.portions.start&&!f.prev().length;b.portions.start+=1}if(d.portion===b.portions.end&&!b.space.length){e=c.portions.end===b.portions.end&&!f.next().not(".eop").length;b.portions.end-=
1}c.portions.start=a?b.portions.start:c.portions.start;c.portions.end=e?b.portions.end:c.portions.end;c.remainingWidth+=g},set:function(a,b,c){if(!a.portion)a.portion=b.data.textBody.paras[b.data.textBody.paras.num].portions[a.portionNum];return this._set(a.text,{fontData:a.fontData,portion:a.portion,portionNum:a.portionNum,shapeObj:b},c)},_set:function(a,b,c){c&&c.length||(c=m('<span class="'+Shape.textBody.subwordId+'" id="'+Shape.textBody.subwordId+'"></span>'));var f=a.length;c.text(a);c.data("length",
f);c.data("subword",true);f=b.portionNum;c.data("portion",f);c.data("text",a);a=b.shapeObj.data;var d=a.textBody.paras[a.textBody.paras.num].portions[f];Shape.textBody.paras.portions.t.subword.setDim(c,a,b.fontData);Shape.textBody.paras.portions.props.setPropsForWord(c,d,b.shapeObj,f);Shape.textBody.paras.portions.t.words.setLineProp(b.shapeObj.data,c);return c},getSubwords:function(a,b){if(typeof b==="number")return m(a.find("."+Shape.textBody.subwordId)[b]);else{var c=a.children("."+Shape.textBody.subwordId);
if(!b)return c;var f=b.from?b.from:0,d=typeof b.till!=="undefined"?b.till:c.length-1;c.length<f&&Shape.error("some problem word",a,"start",f,"end",d,"last",c.length-1);var e=m();m.each(c,function(g,h){h=m(h);if(g>=f&g<=d)e=m.merge(e,h)});return e}},insertSubWordInWord:function(a,b,c,f){var d=a.data,e=Shape.textBody.paras.portions.t,g=e.line.getParentLine(c),h=c.data();g.data();if(h[Shape.textBody.indexId].length){e.words.removeWordDataFromLine(a,c,g);c.find("."+Shape.textBody.subwordId).length||Shape.error("some problem");
var j=this.getSubwords(c,f),l;if(j&&j.length){if(!f){l=b.first();if(!e.subword.getPrevSubword(l).length){l=e.words.getParentWord(l);if(l.length){l=l.data();if(l.broken){h=c.data();h.broken=m.extend(true,h.broken,{before:l.broken.before})}}}}b.insertBefore(j)}else{j=b.last();if(!j.next().length){l=e.words.getParentWord(j);if(l.length){l=l.data();if(l.broken){h=c.data();h.broken=m.extend(true,h.broken,{after:l.broken.after})}}}c.append(b)}var n=this,o=false;m.each(b,function(p,r){r=m(r);var q=r.data();
n.index.set(d,c,r.data("length"),f,g,true);h.length+=r.data("length");o=o?o:q.errorword;h.portions.start=h.portions.start>q.portion?q.portion:h.portions.start;h.portions.end=h.portions.end<q.portion?q.portion:h.portions.end;f++});h.errorword=h.errorword?h.errorword:o;e.words.setDim(c,a.data);a=e.words.getWordIndex(c);e.words.updateLineData(d,c,g,a)}else{c.find("."+Shape.textBody.subwordId).length&&Shape.error("some problem");j=e.subword.createSubWordsFromWordData(h,c,a);j=!f?m.merge(b,j):m.merge(j,
b);b=e.words.createWordFromSubwords(a,j,h.space);b.data().broken=m.extend(true,{},h.broken);e.words.insertnewWordBefore(a,c,b,g);e.words.remove(a,c);c=b}Shape.textBody.paras.portions.t.words.addSpellCheckSpan(c);return c},createSubWordsFromWordData:function(a,b,c){var f=b.children("."+Shape.textBody.subwordId);if(!f.length){a=b.data();if(a.text){var d=a.spellCheckId;d&&Shape.textBody.paras.portions.t.words.removeSpellCheckSpan(b);b=b.clone();b.removeClass(Shape.textBody.wordId).addClass(Shape.textBody.subwordId).attr("id",
Shape.textBody.subwordId);b.css("paddingRight",0);var e=b.data();e.text=a.text;e.portion=a.portions.start;e.length=e.text.length;e.subword=true;this.setDim(b,c.data,{font:a.font,textCase:a.textCase});f=m.merge(f,b);e.spellCheckId=d}else Shape.error("check Why..???",a,b)}return f},get:function(a,b){var c;m.each(a.find("."+this.id),function(f,d){d=m(d);if(d.data("portion").num===b){c=d;return false}});return c}},words:{id:"word",KATAKANA_CHARCODE_START:12448,KATAKANA_CHARCODE_END:12543,KATAKANA_PHONETIC_EXTENSIONS_START:12784,
KATAKANA_PHONETIC_EXTENSIONS_END:12799,KANA_SUPPLEMENT_START:110592,KANA_SUPPLEMENT_END:110847,KATAKANA_HALF_FULL_WIDTH_FORMS_START:65280,KATAKANA_HALF_FULL_WIDTH_FORMS_END:65519,HIRAGANA_START:12352,HIRAGANA_END:12447,CJK_UNIFIED_IDEOGRAPHS_START:19968,CJK_UNIFIED_IDEOGRAPHS_END:40908,CJK_UNIFIED_IDEOGRAPHS_EXTENSION_A_START:13312,CJK_UNIFIED_IDEOGRAPHS_EXTENSION_A_END:19893,CJK_UNIFIED_IDEOGRAPHS_EXTENSION_B_START:131072,CJK_UNIFIED_IDEOGRAPHS_EXTENSION_B_END:173782,CJK_UNIFIED_IDEOGRAPHS_EXTENSION_C_START:173824,
CJK_UNIFIED_IDEOGRAPHS_EXTENSION_C_END:177972,CJK_UNIFIED_IDEOGRAPHS_EXTENSION_D_START:177984,CJK_UNIFIED_IDEOGRAPHS_EXTENSION_D_END:178205,CJK_COMPATIBILITY_IDEOGRAPHS_START:63744,CJK_COMPATIBILITY_IDEOGRAPHS_END:64255,CJK_KANGXI_RADICALS_START:12032,CJK_KANGXI_RADICALS_END:12255,CJK_SYMBOLS_PUNCTUATION_START:12288,CJK_SYMBOLS_PUNCTUATION_END:12351,CJK_COMPATIBILITY_START:13056,CJK_COMPATIBILITY_END:13311,CJK_COMPATIBILITY_FORMS_START:65072,CJK_COMPATIBILITY_FORMS_END:65103,CJK_VERTICAL_FORMS_START:65040,
CJK_VERTICAL_FORMS_END:65055,CJK_ENCLOSED_LETTERS_MONTHS_START:12800,CJK_ENCLOSED_LETTERS_MONTHS_END:13055,ENCLOSED_IDEOGRAPHIC_SUPPLEMENT_START:127488,ENCLOSED_IDEOGRAPHIC_SUPPLEMENT_END:127743,BOPOMOFO_START:12544,BOPOMOFO_END:12591,BOPOMOFO_EXTENDED_START:12704,BOPOMOFO_EXTENDED_END:12735,KANBUN_START:12688,KANBUN_END:12703,MIAO_START:93952,MIAO_END:94111,YI_SYLLABLES_START:40960,YI_SYLLABLES_END:42127,YI_RADICALS_START:42128,YI_RADICALS_END:42191,CJK_RADICALS_SUPPLEMENT_START:11904,CJK_RADICALS_SUPPLEMENT_END:12031,
CJK_STROKES_START:12736,CJK_STROKES_END:12783,IDEOGRAPHIC_DESCRIPTION_CHARACTERS_START:12272,IDEOGRAPHIC_DESCRIPTION_CHARACTERS_END:12287,HANGUL_JAMO_START:4352,HANGUL_JAMO_END:4607,HANGUL_JAMO_EXTENDED_A_START:43360,HANGUL_JAMO_EXTENDED_A_END:43391,HANGUL_JAMO_EXTENDED_B_START:55216,HANGUL_JAMO_EXTENDED_B_END:55295,HANGUL_COMPATIBILITY_JAMO_START:12592,HANGUL_COMPATIBILITY_JAMO_END:12687,HANGUL_HALF_FULL_WIDTH_FORMS_START:65280,HANGUL_HALF_FULL_WIDTH_FORMS_END:65519,HANGUL_SYLLABLES_START:44032,
HANGUL_SYLLABLES_END:55215,eastAsianRange:function(a){a=a.charCodeAt(0);if(a>=this.KATAKANA_CHARCODE_START&&a<=this.KATAKANA_CHARCODE_END||a>=this.KATAKANA_PHONETIC_EXTENSIONS_START&&a<=this.KATAKANA_PHONETIC_EXTENSIONS_END||a>=this.KANA_SUPPLEMENT_START&&a<=this.KANA_SUPPLEMENT_END||a>=this.KATAKANA_HALF_FULL_WIDTH_FORMS_START&&a<=this.KATAKANA_HALF_FULL_WIDTH_FORMS_END||a>=this.HIRAGANA_START&&a<=this.HIRAGANA_END||a>=this.CJK_UNIFIED_IDEOGRAPHS_START&&a<=this.CJK_UNIFIED_IDEOGRAPHS_END||a>=this.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_A_START&&
a<=this.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_A_END||a>=this.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_B_START&&a<=this.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_B_END||a>=this.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_C_START&&a<=this.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_C_END||a>=this.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_D_START&&a<=this.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_D_END||a>=this.CJK_COMPATIBILITY_IDEOGRAPHS_START&&a<=this.CJK_COMPATIBILITY_IDEOGRAPHS_END||a>=this.CJK_KANGXI_RADICALS_START&&a<=this.CJK_KANGXI_RADICALS_END||a>=this.CJK_SYMBOLS_PUNCTUATION_START&&
a<=this.CJK_SYMBOLS_PUNCTUATION_END||a>=this.CJK_COMPATIBILITY_START&&a<=this.CJK_COMPATIBILITY_END||a>=this.CJK_COMPATIBILITY_FORMS_START&&a<=this.CJK_COMPATIBILITY_FORMS_END||a>=this.CJK_VERTICAL_FORMS_START&&a<=this.CJK_VERTICAL_FORMS_END||a>=this.CJK_ENCLOSED_LETTERS_MONTHS_START&&a<=this.CJK_ENCLOSED_LETTERS_MONTHS_END||a>=this.ENCLOSED_IDEOGRAPHIC_SUPPLEMENT_START&&a<=this.ENCLOSED_IDEOGRAPHIC_SUPPLEMENT_END||a>=this.BOPOMOFO_START&&a<=this.BOPOMOFO_END||a>=this.BOPOMOFO_EXTENDED_START&&a<=
this.BOPOMOFO_EXTENDED_END||a>=this.KANBUN_START&&a<=this.KANBUN_END||a>=this.MIAO_START&&a<=this.MIAO_END||a>=this.YI_SYLLABLES_START&&a<=this.YI_SYLLABLES_END||a>=this.YI_RADICALS_START&&a<=this.YI_RADICALS_END||a>=this.CJK_RADICALS_SUPPLEMENT_START&&a<=this.CJK_RADICALS_SUPPLEMENT_END||a>=this.CJK_STROKES_START&&a<=this.CJK_STROKES_END||a>=this.IDEOGRAPHIC_DESCRIPTION_CHARACTERS_START&&a<=this.IDEOGRAPHIC_DESCRIPTION_CHARACTERS_END||a>=this.HANGUL_JAMO_START&&a<=this.HANGUL_JAMO_END||a>=this.HANGUL_JAMO_EXTENDED_A_START&&
a<=this.HANGUL_JAMO_EXTENDED_A_END||a>=this.HANGUL_JAMO_EXTENDED_B_START&&a<=this.HANGUL_JAMO_EXTENDED_B_END||a>=this.HANGUL_COMPATIBILITY_JAMO_START&&a<=this.HANGUL_COMPATIBILITY_JAMO_END||a>=this.HANGUL_SYLLABLES_START&&a<=this.HANGUL_SYLLABLES_END)return true;return false},splitter:[" ","\u00a0","\u3000","\u1680","\u2000","\u2001","\u2002","\u2003","\u2004","\u2005","\u2006","\u2007","\u2008","\u2009","\u200a","\u202f","\u205f"],splitterSpecialChars:["!","@","#","$","%","^","&","*","(",")","+",
"=","-","[","]","\\",";",",",".","/","{","}","|",'"',":","<",">","?"],splitterChar:function(a,b){var c=false,f=[];m.merge(f,this.splitter);b&&m.merge(f,this.splitterSpecialChars);m.each(f,function(d,e){if(a.indexOf(e)!==-1){c=true;return false}});return c},split:function(a,b,c){var f=a.split(""),d="",e=this;m.each(f,function(g,h){if(e.splitterChar(h,c)){if(d.length){wObj={content:d,type:"word",lang:Shape.textBody.lang.OTHER};b.next=wObj;b=b.next}b.next={content:h,type:"splitter"};a=a.substring(g+
1);d="";return false}else if(e.eastAsianRange(h)){if(d.length){wObj={content:d,type:"word",lang:Shape.textBody.lang.OTHER};b.next=wObj;b=b.next}d=h;a=a.substring(g+1);wObj={content:d,type:"word",lang:Shape.textBody.lang.EAST_ASIAN};b.next=wObj;d="";return false}else d+=h});if(d.length){wObj={content:d,type:"word",lang:Shape.textBody.lang.OTHER};b.next=wObj}else b.next&&this.split(a,b.next,c)},insertnewWordBefore:function(a,b,c,f){f||(f=Shape.textBody.paras.portions.t.line.getParentLine(b));a=a.data;
var d=this.getWordIndex(b,f);m.each(c,function(e,g){g=m(g);g.insertBefore(b)});this.updateLineData(a,c,f,d);return d},updateLineData:function(a,b,c,f){if(c.length){var d=c.data(),e=b.not(".eop").first().data(),g=b.not(".eop").last().data();if(e)d.portions.start=d.portions.start>e.portions.start?e.portions.start:d.portions.start;if(g)d.portions.end=d.portions.end<g.portions.end?g.portions.end:d.portions.end;var h=this;m.each(b,function(j,l){l=m(l);d.remainingWidth-=h.widthIncludingSpace(l)});m.each(b,
function(j,l){l=m(l);var n=l.data();if(n.hasSubword){var o=Shape.textBody.sumOfArray(n[Shape.textBody.indexId]);o+=n.space.length}else o=h.lengthIncludingSpace(l);Shape.textBody.paras.portions.t.words.index.set(a,c,o,f);f++})}else Shape.error("No line to be updated",a,b,c,f)},insertnewWordAfter:function(a,b,c,f){a=a.data;var d=b;if(!f){f=Shape.textBody.paras.portions.t.line.getParentLine(b);f.length||(f=a.textBody.paras.element.find("."+Shape.textBody.lineId).first())}m.each(c,function(e,g){g=m(g);
g.insertAfter(d);d=g});b=this.getWordIndex(b,f);this.updateLineData(a,c,f,b+1)},appendNewWord:function(a,b,c){var f=Shape.textBody.paras.portions.t,d=f.line.getLastWord(undefined,c);if(d.length){m.each(b,function(e,g){g=m(g);f.words.resetSpace(g)});this.insertnewWordAfter(a,d,b,c)}else this.prependNewWord(a,b,c)},prependNewWord:function(a,b,c){a=a.data;var f=Shape.textBody.paras.portions.t.line.getBulletSplitter(c);b.insertAfter(f);this.updateLineData(a,b,c,0)},getPrevWord:function(a){return a.prev("."+
Shape.textBody.wordId)},getNextWord:function(a,b){var c=m();c=a?a.next():Shape.textBody.paras.portions.t.line.getWordsInLine(b).first();if(c.data("type")==="EOP")return m();return c},getNextWordInPara:function(a,b){for(var c=Shape.textBody.paras.portions.t,f=c.words.getNextWord(a,b),d=b;!f.length&&b.length;){d=b.next();f=c.line.getWordsInLine(d).first().not(".eop");b=d}return{word:f,line:d}},getPrevWordInPara:function(a,b){for(var c=Shape.textBody.paras.portions.t,f=c.words.getPrevWord(a,b),d=b;!f.length&&
b.length;){d=b.prev();f=c.line.getWordsInLine(d).last().not(".eop");b=d}return{word:f,line:d}},getPrevWordOrSubwordInPara:function(a,b){var c=this.getPrevWordInPara(a,b),f=c.word;if(f.length&&f.data("hasSubword")&&!f.data("space").length)f=Shape.textBody.paras.portions.t.subword.getSubwords(f,f.data(Shape.textBody.indexId).length-1);return{word:f,line:c.line}},getNextWordOrSubwordInPara:function(a,b){var c=this.getNextWordInPara(a,b),f=c.word;if(f.length&&f.data("hasSubword"))f=Shape.textBody.paras.portions.t.subword.getSubwords(f,
0);return{word:f,line:c.line}},getParentWord:function(a){return a.closest("."+Shape.textBody.wordId)},removeSpace:function(a,b,c){var f=Shape.textBody.paras.portions.t,d=b.index;b=b.word;var e=b.data();if(!m.isEmptyObject(e)){var g=e.space;c||(c=f.line.getParentLine(b));f=this.getTotalSpaceWidth(b);e=e.portions.end;var h=d.end-d.start+1;g.splice(d.start,h);d=f-this.getTotalSpaceWidth(b);this.updateSpaceDataInWordAndLine(a,b,c,e,h,d,true);this.resetSpace(b)}},updateSpaceDataInWordAndLine:function(a,
b,c,f,d,e,g){var h=b.data(),j=h.space;c||(c=Shape.textBody.paras.portions.t.line.getParentLine(b));if(j.length)h.portions.end=j[j.length-1].portion;else if(h.hasSubword){var l=b.find("."+Shape.textBody.subwordId).last();h.portions.end=l.data("portion")}else h.portions.end=h.portions.start;l=c.data();if(g){if(!(h.text&&h.text.length)&&!h.hasSubword&&j.length){h.type!=="SPACE"&&Shape.error("Not a Space");h.portions.start=h.space[0].portion}if(l.portions.start>h.portions.start||!b.prev().hasClass(Shape.textBody.wordId))l.portions.start=
h.portions.start}l.portions.end=l.portions.end===f?h.portions.end:l.portions.end;l.remainingWidth+=e;if(d){b=this.getWordIndex(b,c);this.index.update(a,c,-1*d,b)}},updateSpaceAfter:function(a,b,c,f){a=a.data;var d=c.data(),e=d.space.length,g=b.length,h=d.portions.end,j=this.getTotalSpaceWidth(c);d.space=b;b=e-g;j-=this.getTotalSpaceWidth(c);this.updateSpaceDataInWordAndLine(a,c,f,h,b,j);this.resetSpace(c)},addSpaceAfterWord:function(a,b,c,f,d){a=a.data;var e=b.data(),g=e.space.length,h=e.portions.end,
j=this.getTotalSpaceWidth(b);this._addSpace(b,c,d);c=g-e.space.length;j-=this.getTotalSpaceWidth(b);this.updateSpaceDataInWordAndLine(a,b,f,h,c,j,d)},_addSpace:function(a,b,c,f){var d=a.data();d.space=f?b:c?m.merge(b,d.space):m.merge(d.space,b);if(d.space.length)d.portions.end=d.space[d.space.length-1].portion;this.resetSpace(a)},resetSpace:function(a){var b=this.getTotalSpaceWidth(a);this.setSpace(a,b)},setSpace:function(a,b){a.css("paddingRight",b+"px")},getWordIndex:function(a,b){b||(b=Shape.textBody.paras.portions.t.line.getParentLine(a));
return b.children("."+Shape.textBody.wordId).index(a)},length:function(a){a=a.data();var b=a.type;if(b==="LINEBREAK"||b==="EOP")return 1;return wordLength=(a=a.text)?a.length:0},lengthIncludingSpace:function(a){var b=this.length(a);a=a.data("space").length;return b+a},getSpaceDimension:function(a){var b=0;m.each(a,function(c,f){b+=f.afterSpaceWidth});return b},getTotalSpaceWidth:function(a){a=a.data();var b=0;if(a.space&&a.space.length)b=this.getSpaceDimension(a.space);return b},widthIncludingSpace:function(a){var b=
this.width(a)+this.getTotalSpaceWidth(a);isNaN(b)&&Shape.error(b,a,a.data());return b},width:function(a){var b=a.data("wordWidth");isNaN(b)&&Shape.error(b,a,a.data());return b},index:{set:function(a,b,c,f){Shape.textBody.index.set(a,b,c,f);f=Shape.textBody.paras.portions.t.line;f.index.update(a,a.textBody.paras.element,c,f.getLineIndex(b))},get:function(a,b,c){return Shape.textBody.index.get(a,b,c)},update:function(a,b,c,f){Shape.textBody.index.update(a,b,c,f);f=Shape.textBody.paras.portions.t.line;
f.index.update(a,a.textBody.paras.element,c,f.getLineIndex(b))},remove:function(a,b,c){var f=Shape.textBody.index.get(a,b,c);Shape.textBody.index.remove(a,b,c);c=Shape.textBody.paras.portions.t.line;c.index.update(a,a.textBody.paras.element,-1*f,c.getLineIndex(b))}},updateText:function(a,b,c){a=a.data;var f=b.word,d=f.data();c||(c=Shape.textBody.paras.portions.t.line.getParentLine(f));var e=this.lengthIncludingSpace(f),g=this.widthIncludingSpace(f);b.text=b.text?b.text:"";var h=f.find("#"+Shape.textBody.subportionId);
if(h&&h.length)h.text(b.text);else{h=f.contents().filter(function(){return this.nodeType===3});if(h.length)h[0].nodeValue=b.text;else f.text(b.text)}f.data("text",b.text);f.data("length",b.text.length);this.setDim(f,a,{font:f.data("font"),textCase:f.data("textCase")});var j=this.lengthIncludingSpace(f);h=this.widthIncludingSpace(f);e=j-e;g=h-g;if(!d.text&&d.space.length){d.portions.start=d.space[0].portion;d.type="SPACE"}if(!b.index)b.index=Shape.textBody.paras.portions.t.words.getWordIndex(f,c);
this.index.update(a,c,e,b.index);if(d.text.length)d.type="NORMAL";d.spellCheckId&&Shape.textBody.paras.portions.t.words.addSpellCheckSpan(f);c.data().remainingWidth-=g},removePortion:function(a,b,c,f){var d=b.data();if(d.portions.start===d.portions.end&&d.portions.start===c)this.remove(a,b,f);else{c=Shape.textBody.paras.portions.t;f||(f=c.line.getParentLine(b));c.words.updateText(a,{text:"",word:b},f);d.type="SPACE";d.wordWidth=0}},remove:function(a,b,c,f){var d=Shape.textBody.paras.portions.t;c||
(c=Shape.textBody.paras.portions.t.line.getParentLine(b));this.removeWordDataFromLine(a,b,c,f);b.remove();d.line.detectEmptyLineAndDelete(a,c)},removeWordDataFromLine:function(a,b,c,f){var d=a.data;c||(c=Shape.textBody.paras.portions.t.line.getParentLine(b));a=c.data();b||Shape.error("some problem no word");f=typeof f!=="undefined"?f:this.getWordIndex(b.last(),c);for(var e=b.length-1;e>=0;e--){this.index.remove(d,c,f);f--;a.remainingWidth+=this.widthIncludingSpace(m(b[e]))}d=b.not(".eop").first();
f=b.not(".eop").last();d=d.data();f=f.data();if(d||f){var g;if(d)if(a.portions.start===d.portions.start){g=Shape.textBody.paras.portions.t.line.getWordsInLine(c).not(b);if(d=g.not(".eop").first().data())a.portions.start=d.portions.start}if(f)if(a.portions.end===f.portions.end){g=g?g:Shape.textBody.paras.portions.t.line.getWordsInLine(c).not(b);if(b=g.not(".eop").last().data())a.portions.end=b.portions.end}}},set:function(a,b,c,f){return this._set(a.text,{lang:a.lang,type:a.type,portionNum:a.portionNum,
space:a.space,shapeObj:b},c,f)},_createDummyWord:function(a,b){var c=this.id;b||(b=m('<span class="'+c+'" id="'+c+'"></span>'));b.data("length",0);if(a==="LINEBREAK"){b.addClass("LINEBREAK");b.text(Shape.textBody.zeroWidthSpaceText);b.data("length",1)}b.data("portions",{start:-1,end:-1});b.data("space",[]);b.data(Shape.textBody.indexId,[]);b.data("type",a);return b},setLineProp:function(a,b){var c=a.textBody.paras[a.textBody.paras.num].style.spacing.line,f=c.type.toLowerCase();c=Shape.textBody.paras.style.spacing.getLineValue(c[f],
f,a);b.css(Shape.textBody.paras.style.spacing.linespace.line,c)},_set:function(a,b,c){c||(c=this._createDummyWord(b.type));var f=c.data();if(a){var d=a.length;f.text=a;f.length=d;f.lang=b.lang;c.text(a)}f.portions.start=b.portionNum;f.portions.end=b.portionNum;this.setDim(c,b.shapeObj.data);b.space?this._addSpace(c,b.space,undefined,true):this.setSpace(c,0);a=b.shapeObj.data;if((d=a.textBody.paras[a.textBody.paras.num].portions[b.portionNum])&&d.props){Shape.textBody.paras.portions.props.setPropsForWord(c,
d,b.shapeObj,b.portionNum);Shape.textBody.paras.portions.props.setPropsForSpace(c,b.shapeObj)}this.setLineProp(a,c);if(f.text&&f.text.length)f.type="NORMAL";return c},clone:function(a,b,c){var f=b.data();b=b.clone();var d=b.data();d[Shape.textBody.indexId]=[];d.text=a.text;var e=b.children("#"+Shape.textBody.subportionId);e.length?e.text(a.text):b.text(a.text);d.space=a.space;d.lang=f.lang;d.length=a.text.length;d.type=a.type;d.portions={start:a.portionNum,end:a.portionNum};this.resetSpace(b);this.setDim(b,
c,{font:f.font,textCase:f.textCase});return b},createWordFromSubwords:function(a,b,c){var f=0,d=false;if(b.length>1){var e=this._createDummyWord("NORMAL"),g=e.data(),h=b.first(),j=b.last();m.each(b,function(l,n){n=m(n);e.append(n);var o=n.data();f+=o.text.length;g[Shape.textBody.indexId].push(o.length);if(o.spellCheckId)d=true});h.data("portion")>j.data("portion")&&Shape.error("some problem first",h.data("portion"),"last",j.data("portion"),m.extend(true,{},a.data.textBody.paras[a.data.textBody.paras.num]),
a.data.textBody.paras.num);g.portions.start=h.data("portion");g.portions.end=c&&c.length?c[c.length-1].portion:j.data("portion");e.data("hasSubword",true);this.setDim(e,a.data)}else if(b.length){e=b.clone();e.removeClass(Shape.textBody.subwordId).addClass(Shape.textBody.wordId).attr("id",Shape.textBody.wordId);b=b.data();h=b.portion;e=this._createDummyWord("NORMAL",e);g=e.data();g.subword=false;if(b.spellCheckId){d=true;g.spellCheckId=b.spellCheckId;delete b.spellCheckId}g.text=b.text;f=g.text.length;
j=e.children("#"+Shape.textBody.subportionId);j.length?j.text(g.text):e.text(g.text);g.portions.start=h;g.portions.end=h;g[Shape.textBody.indexId]=[];this.setDim(e,a.data,{font:b.font,textCase:b.textCase})}else Shape.error("cannot create a word without a subword");g.length=f;c&&this._addSpace(e,c);e.data("errorword",d);d&&Shape.textBody.paras.portions.t.words.addSpellCheckSpan(e);return e},_addSpellCheckSpan:function(a,b,c){var f=a.find("#spellcheckspan."+c),d=b.width,e=b.left;if(f.length)b=f.find(".spellcheck-white-line");
else{b=m("<span></span>").addClass("spellcheck-white-line");f=m('<span id="spellcheckspan"></span>').addClass("spellcheck-red-line").append(b);f.addClass(c);a.prepend(f)}f.css("left",e);f.width(d);b.width(d);m.SpellCheck&&!m.SpellCheck.showSpellCheckFeature&&f.hide()},addSpellCheckSpan:function(a){var b=a.data(),c=this,f=Shape.textBody.paras.portions.t,d=false;if(b&&b.hasSubword){f=f.subword.getSubwords(a);var e=0;m.each(f,function(g,h){h=m(h);var j=h.data(),l=j.wordWidth;if(j.spellCheckId){d=true;
c._addSpellCheckSpan(a,{left:e+1.5,width:l-1.5},j.spellCheckId)}e+=l});b.errorword=d}else if(b&&b.spellCheckId){d=true;c._addSpellCheckSpan(a,{left:0,width:b.wordWidth},b.spellCheckId);b.errorword=d}},removeSpellCheckSpan:function(a){var b=a.data();a=b.subword?a.parent():a;var c=b.spellCheckId;if(c){b.spellCheckId=false;a.find("#spellcheckspan."+c).remove()}},_beforeCanvasDim:function(a,b,c){var f=a;if(b===m.ShapeConstants.FontVariant.ALLCAPS)f=a.toUpperCase();else if(b===m.ShapeConstants.FontVariant.SMALLCAPS)f=
a.toLowerCase();return this.canvasDim(c,f)},canvasDim:function(a,b){var c=Shape.canvasArea[0].getContext("2d");c.font=a;c=c.measureText(b);return{width:c.width,height:c.height}},getFont:function(a,b,c){var f=a.textBody.paras[b].portions[c].props,d="";if(f.italic)d+="italic ";if(f.fontweight)d+=m.ShapeDefault.FontWeight[f.fontweight]+" ";else if(f.bold)d+="bold ";a=this.getFontSize(a,b,c);d+=a+" ";d+='"'+f.font.fontFamily.name+'" ';return d},getFontSize:function(a,b,c){var f=a.textBody.paras[b].portions[c].props;
a=Shape.textBody.paras.portions.props.getSize(a,b,c);return a=f.baseline?a*Shape.textBody.paras.portions.props.subPortionRatio+"pt ":a+"pt"},getHeight:function(a){var b=a.size;a=a.font.fontFamily.name;Shape.textBody.heightMap[a]||(Shape.textBody.heightMap[a]=Shape.getFontHeight(a));return Shape.textBody.heightMap[a]*b},getDim:function(a,b,c,f){var d={};if(a){var e,g="";d=b.textBody.paras[c].portions[f];var h=0;if(d&&d.props){h=d.props;g=this.getFont(b,c,f);e=h.cap;h=this.getHeight(h)}d=this._beforeCanvasDim(a,
e,g);d.font=g;d.textCase=e;d.height=h}return d},setDim:function(a,b,c){var f=a.data(),d=Shape.textBody.paras.portions.t,e=a.data("type");if(e==="EOP"||e==="LINEBREAK")a.data("wordWidth",0);else{e={};a.data("portions");var g=a.data("hasSubword"),h=0;if(g){b=a.find("."+Shape.textBody.subwordId);m.each(b,function(l,n){n=m(n);var o=n.data("wordWidth");typeof o==="undefined"&&Shape.error("now subword dim");h+=o});e.width=h}else{var j=a.data("text");h=0;e={width:h};if(j){if(c){e=d.words._beforeCanvasDim(j,
c.textCase,c.font);e.font=c.font?c.font:"";e.textCase=c.textCase?c.textCase:""}else e=this.getDim(j,b,b.textBody.paras.num,f.portions?f.portions.start:f.portion);h=e.width}}a.data("wordWidth",e.width);a.data("wordHeight",e.height);if(!g){a.data("font",e.font);a.data("textCase",e.textCase)}}},getSpaceWidth:function(a,b,c,f){b=a.textBody.paras.num;c=a.textBody.paras[b].portions[c];if(!c)return 0;b=c.props.size;c=c.props.font.fontFamily.name;var d=Shape.textBody.spaceSizeMap[c];if(d){if(!d[f]){d=Shape.getFontSpaceSize(c,
f);Shape.textBody.spaceSizeMap[c][f]=d}}else{d=Shape.getFontSpaceSize(c,f);Shape.textBody.spaceSizeMap[c]={};Shape.textBody.spaceSizeMap[c][f]=d}d=Shape.textBody.spaceSizeMap[c][f];b=Shape.textBody.paras.portions.props.autoFitManipulation(b,a);return d*b*1.333}},line:{lineId:"line",index:{set:function(a,b,c,f){Shape.textBody.index.set(a,b,c,f);Shape.textBody.index.update(a,a.textBody.element,c,a.textBody.paras.num)},get:function(a,b,c){return Shape.textBody.index.get(a,b,c)},update:function(a,b,c,
f){Shape.textBody.index.update(a,b,c,f);Shape.textBody.index.update(a,a.textBody.element,c,a.textBody.paras.num)},remove:function(a,b,c){var f=Shape.textBody.index.get(a,b,c);Shape.textBody.index.remove(a,b,c);Shape.textBody.index.update(a,a.textBody.element,-1*f,a.textBody.paras.num)}},detectEmptyLineAndDelete:function(a,b){var c=Shape.textBody.paras.portions.t;b.length&&!c.line.getWordsInLine(b).length&&!c.line.isFirstLine(b)&&c.line.remove(a,b)},isFirstLine:function(a){return m(a).is(":first-child")===
true},setMargin:function(a){var b=Shape.textBody.paras.portions.t,c=b.line.getWordsInLine(a).last();if(c.data().space){b=b.words.getTotalSpaceWidth(c);a.css("margin-left",b+"px")}},remove:function(a,b,c){c=c?c:a.data.textBody.paras.element;this.removeData(a,b,c);b.remove();c.trigger("line_modified",{"delete":true,element:b,para:c,box:a.box,data:a.data,container:a.container})},removeData:function(a,b,c){c.data();for(var f=b.length-1;f>=0;f--){var d=this.getLineIndex(m(b[f]));this.index.remove(a.data,
c,d)}},getParentLine:function(a){if(a)return a.closest("."+Shape.textBody.lineId);return m()},getWordsInLine:function(a){return a.children("."+Shape.textBody.wordId)},getFirstWordFromLine:function(a,b){b||(b=this.getWordsInLine(a));return b.first()},getLastWord:function(a,b){a||(a=this.getWordsInLine(b));var c=a.last();if(c.data("type")==="EOP")c=m(a[a.length-2]);return c},totalWidth:{set:function(a,b,c,f,d){d=d?d:f.parent();f.data("totalWidth",Shape.textBody.paras.portions.t.line.getLineWidth(a,
b,c,f,d))}},remainingWidth:{increase:function(a,b){var c=b;if(typeof b==="object")c=Shape.textBody.paras.portions.t.words.width(b);lineData=a.data();lineData.remainingWidth+=c},decrease:function(a,b){var c=b;if(typeof b==="object")c=Shape.textBody.paras.portions.t.words.width(b);lineData=a.data();lineData.remainingWidth-=c},set:function(a,b){lineData=a.data();lineData.remainingWidth=b},get:function(a){return a.data("remainingWidth")}},getLineIndex:function(a){return a.index()},next:function(a){return a.next("."+
Shape.textBody.lineId)},prev:function(a){return a.prev("."+Shape.textBody.lineId)},get:function(a,b,c){c=!c?Shape.box(a,b):c;var f=a.textBody.paras[a.textBody.paras.num].portions.num,d=a.textBody.paras.element.find("."+Shape.textBody.lineId),e=undefined,g=f-1;if(g>=0)m.each(d,function(h,j){var l=m(j).data("portions");if(g>=l.start&&g<=l.end){e=m(j);return true}});else if(d.length)e=m(d[0]);e||(e=this.create(a,b,c,d.length));return e},getLine:function(a,b){return m(a.children("."+Shape.textBody.lineId).get(b))},
getBulletSplitter:function(a){return a.find("#bulletSplitter")},create:function(a,b,c){c=!c?Shape.box(a,b):c;var f=a.textBody.paras.element,d;if(typeof d==="undefined")d=f.find("."+Shape.textBody.lineId).length;var e=Shape.textBody.lineId;line=m('<div class="'+e+'" id="'+e+'"></div>');e=m('<span class="'+Shape.textBody.bulletSplitterId+'" id = "'+Shape.textBody.bulletSplitterId+'"></span>');line.append(e);this.index.set(a,f,0,d);f.append(line);line.data("index",d);line.data("portions",{start:1E3,
end:-1});this.setLineWidth(a,b,c,line,f);line.data(Shape.textBody.indexId,[]);return line},setLineWidth:function(a,b,c,f,d){a=this.getLineWidth(a,b,c,f,d);f=f.data();if(typeof a!=="undefined"){if(typeof f.remainingWidth==="undefined")f.remainingWidth=a;else f.remainingWidth+=a-f.totalWidth;f.totalWidth=a;f.height=0}return a},getLineWidth:function(a,b,c,f,d){a=a.textBody.paras;a=a[a.num].style;b=0;if(c.data(Shape.textbox)){c=d.closest("."+Shape.textBody.columnId).data("width");var e=a.margin&&a.margin.left?
a.margin.left:0;b=c-e}if(!f.prev().length){f=d.data("bulletWidth");b=this.getFirstLineWidth({lineWidth:b,paraStyle:a,bulletWidth:f?f:0,paraMargin:e})}return b},getFirstLineWidth:function(a){var b=a.lineWidth,c=a.paraStyle,f=a.bulletWidth;a=a.paraMargin;var d=c.indent?c.indent:0;if(d<0){d*=-1;var e=Shape.textBody.paras.style.listStyle.getBulletSplitterLeft(c,f);c=e.split;e=e.pos;if(f>0)if(d<a){if(e<0&&c<0)b+=f<a?-1*(f+e):c}else b-=e<0&&c>=0?d-a:f-a;else b+=d<a?d:a}else if(d>=0)b=f<d?b-d:b-f;return b}}},
props:{subPortionRatio:0.63,resetPropsForPortion:function(a,b,c,f,d){a.textBody.paras.num=f;var e=Shape.textBody.paras.getPara(c,f,a);a.textBody.paras.element=e;a.textBody.paras[f].portions.num=d;Shape.textBody.paras.portions.element(a,b,c);Shape.textBody.paras.portions.props.set(a,b,c);c.trigger("props_reset",{paraNum:f,portionNum:d})},_checkUnderLine:function(a,b){var c;if(b&&b.props){c=m.extend(true,{},b);if(b.props.click&&b.props.click.type!=="NONE")m.extend(true,c.props,b.props.click.props?b.props.click.props:
a.textBody.linkProps);c=c.props}return c},setPropsForWord:function(a,b,c,f,d){var e=c.data,g=c.container,h=c.box;if(b&&b.props){b=this._checkUnderLine(e,b);var j={};b.bold?j["font-weight"]="bold":j["font-weight"]="";b.italic?j["font-style"]="italic":j["font-style"]="";if(b.cap)j["text-transform"]=m.ShapeDefault.FontVariants[b.cap];else if(d)j["text-transform"]="";if(b.fontweight)j["font-weight"]=m.ShapeDefault.FontWeight[b.fontweight];var l=b.font,n=l.fontFamily.name;if(n==="TeX Gyre Heros")n+=", Arial";
if(b.font.loader){if(b.font.loader({fontName:l.fontFamily.name,portionSpan:a,shapeObj:c,paraNum:c.data.textBody.paras.num,portionNum:f}))j["font-family"]=n}else j["font-family"]=n;j.color=VectorUtil.convertRGBToString(b.fill.solid.color.rgb);a.data("style",j);a.css(j);this.size(a,b.size,e);if(a.data("type")!=="LINEBREAK")if(b&&typeof b.baseline!=="undefined")this.baseline(e,g,h,a,b);else d&&this.removeBaseLine(e,g,h,a,b);this.setTextDecoration(e,g,h,a,b);if(e.editable&&m.SpellCheck&&m.SpellCheck.processSpellCheck)if(b.chk&&
b.chk.state&&b.chk.state==="ERROR")this.setSpellCheckSpan(a);else h.data("shape_rendered")&&Shape.textBody.paras.portions.t.words.removeSpellCheckSpan(a)}},setPropsForSpace:function(a,b){var c=a.data("space");c&&c.length&&m.each(c,function(f,d){var e=Shape.textBody.paras.portions.t.words.getSpaceWidth(b.data,b.data.textBody.paras.num,d.portion,d.content);d.afterSpaceWidth=e});Shape.textBody.paras.portions.t.words.resetSpace(a)},set:function(a,b,c){var f=Shape.textBody.paras.portions;c=!c?Shape.box(a,
b):c;var d=a.textBody.paras.num,e=a.textBody.paras[d].portions.num,g=a.textBody.paras[d].portions[e];d=a.textBody.paras[d].portions.element;var h={data:a,container:b,box:c};m.each(d,function(l,n){var o=n.portion,p=n.line.data();m.each(o,function(r,q){q=m(q);var s=q.data();p.remainingWidth+=s.wordWidth;if(s.space)p.remainingWidth+=f.t.words.getTotalSpaceWidth(q)});m.each(n.spaceObj,function(r,q){for(var s=q.index.start,t=q.word.data();s<=q.index.end;s++)p.remainingWidth+=t.space[s].afterSpaceWidth})});
var j=f.props;m.each(d,function(l,n){var o=n.portion;n.line.data();var p=m(),r=m();m.each(o,function(q,s){s=m(s);var t=s.data();j.setPropsForWord(s,g,h,e,true);if(t.subword){f.t.words.setDim(s,h.data);t=f.t.words.getParentWord(s);m.merge(r,t)}else{m.merge(p,s);m.merge(r,s)}});m.unique(r);m.each(r,function(q,s){s=m(s);f.t.words.setDim(s,h.data);s.data("errorword")&&f.t.words.addSpellCheckSpan(s)});m.each(n.spaceObj,function(q,s){m.merge(p,s.word)});m.unique(p);m.each(p,function(q,s){s=m(s);j.setPropsForSpace(s,
h,true)})});m.each(d,function(l,n){var o=n.portion,p=n.line.data();m.each(o,function(r,q){q=m(q);var s=q.data();p.remainingWidth-=s.wordWidth;if(s.space)p.remainingWidth-=f.t.words.getTotalSpaceWidth(q)});m.each(n.spaceObj,function(r,q){for(var s=q.index.start,t=q.word.data();s<=q.index.end;s++)p.remainingWidth-=t.space[s].afterSpaceWidth})});m.each(d,function(l,n){m.isEmptyObject(n.line.data())||f.t.breakLine(h,n.line)})},removeBaseLine:function(a,b,c,f){c.data("shape_rendered")&&m.each(f,function(d,
e){e=m(e);e.html("");e.text(e.data("text"))})},baseline:function(a,b,c,f,d){d.baseline!==0?m.each(f,function(e,g){g=m(g);g.html("");var h=d.size*d.baseline*-1+"px",j=m('<span id = "'+Shape.textBody.subportionId+'" style="font-size:'+Shape.textBody.paras.portions.props.subPortionRatio+'em;position:relative;display:inline-block;"></span>');j.data("subPortion",true);j.text(g.data("text"));j.css("top",h);g.append(j)}):m.each(f,function(e,g){g=m(g);g.html("");g.text(g.data("text"))})},dependency:function(a,
b,c){c=!c?Shape.box(a,b):c;var f=a.textBody.paras.num,d=a.textBody.paras[f].portions,e=d.num;d.num===0&&a.textBody.paras[f].style.listStyle&&Shape.textBody.paras.style.listStyle.setListStyleProps(a,b,c);if(e>=d.length-1){d=Shape.textBody.paras.getEOPSpan(a,b,c,a.textBody.paras[f]);Shape.textBody.paras.setEopHeight(d,a,f)}b.trigger("line_modified",{box:c,data:a,container:b})},autoFitManipulation:function(a,b){var c=b.textBody.props;if(c&&c.autoFit&&c.autoFit.type==="NORMAL"&&c.autoFit.normal.fontScale)a*=
c.autoFit.normal.fontScale;return a},_size:function(a,b){a.css("font-size",b+"pt")},getSize:function(a,b,c){b=typeof b!=="undefined"?b:a.textBody.paras.num;c=typeof c!=="undefined"?c:a.textBody.paras[b].portions.num;b=a.textBody.paras[b].portions[c].props.size;return b=this.autoFitManipulation(b,a)},size:function(a,b,c){b=b?this.autoFitManipulation(b,c):this.getSize(c);a.css("font-size",b+"pt")},setTextDecoration:function(a,b,c,f,d){a=d.underline===m.ShapeConstants.LineType.SINGLE?"underline":"";
b=d.strike===m.ShapeConstants.LineType.SINGLE?"line-through":"";a=a.length?a+" "+b:b.length?a+" "+b:"none";d.baseline?f.find("#"+Shape.textBody.subportionId).css("text-decoration",a):f.css("text-decoration",a)},setSpellCheckSpan:function(a){var b=a.data();if(!b.subword&&b.type!=="EOP"){b.spellCheckId=b.spellCheckId?b.spellCheckId:Math.uuid();Shape.textBody.paras.portions.t.words.addSpellCheckSpan(a)}else if(b.subword){b.spellCheckId=b.spellCheckId?b.spellCheckId:Math.uuid();a=a.parent();Shape.textBody.paras.portions.t.words.addSpellCheckSpan(a)}},
_getOuterSpan:function(a){a=a==="strike"?m('<span id = "strike" class = "noclick"></span>'):a==="underline"?m('<span id = "underline" class = "noclick"></span>'):undefined;a.css({display:"inline-block",position:"absolute",left:0,top:0,width:"100%",height:"100%"});return a},_getInnerSpan:function(a,b){var c=a==="strike"?m('<hr class = "noclick">'):a==="underline"?m('<span class = "noclick"></span>'):undefined;c.css({"background-color":b,height:"2px",border:"none",display:"inline-block",position:"absolute",
bottom:"2px",width:"100%",left:"0px"});return c},_decorWordWithMultiPortions:function(a,b,c){var f=b.data(),d=a.textBody.paras,e=d.num,g=this._getOuterSpan(c);if(!f.hasSubword)if((a=this._checkUnderLine(a,d[e].portions[f.portions.start]))&&a[c]===m.ShapeConstants.LineType.SINGLE){a=VectorUtil.convertRGBToString(a.fill.solid.color.rgb);c=this._getInnerSpan(c,a);c.css({left:0,width:f.wordWidth});g.append(c);b.append(g)}},decor:function(a,b,c,f,d,e,g){c=c?c:Shape.box(a,b);b=f.data();if(!(!b||b&&(b.type===
"EOP"||b.subPortion)||g&&!c.data("shape_rendered")))if(b.subword)if(g)f.children("#"+e).remove();else{a=f.children("#"+e);if(!(a&&a.length)&&d&&d.fill){d=VectorUtil.convertRGBToString(d.fill.solid.color.rgb);a=this._getOuterSpan(e);e=this._getInnerSpan(e,d);a.append(e);f.append(a)}}else{(d=f.children("#"+e))&&d.length&&d.remove();this._decorWordWithMultiPortions(a,f,e)}}},getPortion:function(a,b){if(b<0)return[];var c=a.find("."+Shape.textBody.lineId);m();var f=m();m.each(c,function(g,h){h=m(h);var j=
h.data();if(!(j.portions&&typeof j.portions.start!=="undefined"))return[];var l=j.portions.end;if(b>=j.portions.start&&b<=l)f=m.merge(f,h)});var d=[];m.each(f,function(g,h){d.push({line:m(h),words:m(h).find("."+Shape.textBody.wordId)})});var e=[];m.each(d,function(g,h){var j=h.words,l={line:h.line};l.portion=m();l.spaceObj=[];m.each(j,function(n,o){o=m(o);var p=o.data(),r=p.portions.start;p=p.portions.end;if(b>=r&&b<=p)if(o.data("type")==="EOP")return true;else if(r===p){l.portion=m.merge(l.portion,
o);if(l.spaceObj.length)if(l.spaceObj[l.spaceObj.length-1].at!=="before")l.spaceObj[l.spaceObj.length-1].at="inbetween"}else{p=o.find("."+Shape.textBody.subwordId);if(p.length)m.each(p,function(u,v){v=m(v);if(b===v.data("portion")){l.portion=m.merge(l.portion,v);if(l.spaceObj.length)if(l.spaceObj[l.spaceObj.length-1].at!=="before")l.spaceObj[l.spaceObj.length-1].at="inbetween"}});else if(b===r){l.portion=m.merge(l.portion,o);if(l.spaceObj.length)if(l.spaceObj[l.spaceObj.length-1].at!=="before")l.spaceObj[l.spaceObj.length-
1].at="inbetween"}r=o.data("space");if(r.length){var q=false,s,t;m.each(r,function(u,v){if(v.portion===b){if(!q){s=u;q=true}t=u}else if(v.portion>b)return false});if(typeof s!=="undefined"){p=m(l.portion).length||l.spaceObj.length?"after":"before";l.spaceObj.push({type:"SPACE",word:o,index:{start:s,end:typeof t!=="undefined"?t:r.length-1},at:p})}}}});if(!l.portion.length)if(l.spaceObj.length==1)l.spaceObj[0].at="after";if(l.portion.length||l.spaceObj.length)e.push(l);else return false});e.num=b;return e}}}}}})(jQuery);(function(m){m.GroupShape={create:{draw:function(a,b){var c=m.extend(true,{},a);m.GroupShape.props.setData(c,b);m.GroupShape.props.effects.reflection.updateReflectionData(c,b);var f=this.createGroupBox(c);this.drawing(c,f);c.doNotAppendToCont||b.append(f);c.nvOProps&&m.GroupShape.nvOProps.nvODProps.set(a,b,f);return f},createGroupBox:function(a){a=a.groupshape?a.groupshape:a;var b=a.nvOProps.nvDProps.id;b=m("<span id='"+b+"' box_id='"+b+"'class='"+(Shape.shapeClass+" "+a.className)+"'  ></span>");
b.css({left:a.props.transform.pos.left,top:a.props.transform.pos.top,position:"absolute"});return b},drawing:function(a,b){var c=document.createDocumentFragment(),f=a.nvOProps.nvDProps.id;m.eachAsync(a.shapes,{delay:20,loop:function(d,e){if(e.type===m.ShapeConstants.ShapeNodeType.GROUPSHAPE){var g=e.groupshape?e.groupshape:e;g.className+=" grouped";var h=m.GroupShape.create.createGroupBox(g);m.GroupShape.create.drawing(g,h);h.data(Shape.groupShapeId,f);c.appendChild(h[0]);return true}try{e.doNotAppendToCont=
true;e.className+=" grouped";g=Shape.create.draw(e,b);g.data(Shape.groupShapeId,f);e.doNotAppendToCont=false;g&&c.appendChild(g[0])}catch(j){}},end:function(){c.hasChildNodes()&&b.append(c)}})}},shapes:{set:function(){},get:function(a,b){a.shapeObject=a.shapes[b];a.shapeIndex=b;return a},groupshape:{get:function(a){var b=m.Slide.shapes.groupshape.get(a);b.parData=m.extend(true,{},a.parData?a.parData:b);return b},set:function(){}},shape:{get:function(a){this.updateData(a);return m.Slide.shapes.shape.get(a)},
updateData:function(a){var b=m.extend(true,{},a.parData?a.parData:undefined);m.GroupShape.props.setData(b);m.GroupShape.props.effects.reflection.updateReflectionData(b);var c=a.shapeObject.type.toLowerCase();c=a.shapeObject[c];b=m.GroupShape.getShape(c.nvOProps.nvDProps.id,b);c.props=b.props;delete a.parData},set:function(){},convert:function(a,b){m.Slide.shapes.shape.convert(a,b)}}},nvOProps:{nvDProps:{},nvODProps:{set:function(a,b,c){m.GroupShape.nvOProps.nvODProps.locks.set(a,b,c)},locks:{set:function(a,
b,c){c=!c?Shape.box(a,b):c;var f=a.nvOProps.nvODProps;if(f&&f.locks){f=f.locks;f.noModify?c.data("groupshapelock",true):c.data("groupshapelock",false);this.updateInnerBoxes(a,c,f.noModify)}b.trigger("shape_locked/unlocked",a)},updateInnerBoxes:function(a,b,c){m.each(a.shapes,function(f,d){if(d.type===m.ShapeConstants.ShapeNodeType.GROUPSHAPE)m.GroupShape.nvOProps.nvODProps.locks.updateInnerBoxes(d,b,c);else{var e=m.GroupShape.getBox(d,b);c?e.data("lock",true):e.data("lock",false)}})},remove:function(a,
b,c){c=m.GroupShape.getBox(a,b);this.updateInnerBoxes(a,c,false);b.trigger("shape_locked/unlocked",a)}}}},props:{setData:function(a,b){m.GroupShape.updateShapeData(m.GroupShape.props,a,b)},_setData:function(a,b,c){var f=m.GroupShape.props;m.each(a,function(d){f[d]&&f[d]._setData.call(f,a,b,c)})},set:function(a,b){var c=m.GroupShape.props;c.setData(a,b);m.GroupShape.props.effects.reflection.updateReflectionData(a,b);m.GroupShape.call_setMethod(a,b,c)},_set:function(a,b,c){Shape.props.set(a,b,c);Shape.props.dependency(a,
b,c)},remove:function(a,b){m.GroupShape.props.set(a,b)},anim:{set:function(){},setData:function(){},_setData:function(){},_set:function(){},remove:function(){}},animData:{set:function(){},setData:function(){},_setData:function(){},_set:function(){},remove:function(){}},transform:{set:function(a,b){var c=m.extend(true,{},a),f=m("#"+c.nvOProps.nvDProps.id,b),d=m.GroupShape.props.transform;d.setData(c,b);m.GroupShape.props.effects.reflection.updateReflectionData(c,b);f.css({left:c.props.transform.pos.left,
top:c.props.transform.pos.top});m.GroupShape.call_setMethod(c,b,d)},setData:function(a,b){m.GroupShape.updateShapeData(m.GroupShape.props,a,b)},_setData:function(a,b,c){b=b.groupshape?b.groupshape:b;m.GroupShape.props.transform.dim._setData(a,b,c);m.GroupShape.props.transform.pos._setData(a,b,c);m.GroupShape.props.transform.flip(a,b,c);m.GroupShape.props.transform.rotate(a,b,c)},_set:function(a,b,c){Shape.props.transform.set(a,b,c);Shape.props.transform.dependency(a,b,c)},pos:{setData:function(a,
b){m.GroupShape.updateShapeData(m.GroupShape.props,a,b)},_setData:function(a,b,c){a=a.transform;var f=a.dim.width/a.chDim.width,d=a.dim.height/a.chDim.height;b=b.props.transform;var e=b.rotate?b.rotate:0,g=f;g=d;g={x:0,y:0};var h={x:0,y:0};if(b.rotate>44&&b.rotate<135||b.rotate>224&&b.rotate<315){h=b.dim.width/d;var j=b.dim.height/f;g=zoho.math.getRotatedValue(-1*e,0,0,b.dim.width*0.5,b.dim.height*0.5);h=zoho.math.getRotatedValue(-1*e,0,0,h*0.5,j*0.5)}e=c?a.pos.top:0;b.pos.left=(c?a.pos.left:0)+((b.pos.left+
h.x-a.chPos.left)*f-g.x);b.pos.top=e+((b.pos.top+h.y-a.chPos.top)*d-g.y);b.pos.zindex=a.pos.zindex},set:function(a,b){var c=m.extend(true,{},a),f=m("#"+c.nvOProps.nvDProps.id,b),d=m.GroupShape.props.transform;d.setData(c,b);m.GroupShape.props.effects.reflection.updateReflectionData(c,b);f.css({left:c.props.transform.pos.left,top:c.props.transform.pos.top});m.GroupShape.call_setMethod(c,b,d)},_set:function(a,b,c){Shape.props.transform.pos.set(a,b,c)}},dependency:function(){},dim:{setData:function(a,
b){m.GroupShape.updateShapeData(m.GroupShape.props.transform,a,b)},_setData:function(a,b){var c=a.transform,f=b.props.transform,d=c.dim.width/c.chDim.width;c=c.dim.height/c.chDim.height;if(f.rotate>44&&f.rotate<135||f.rotate>224&&f.rotate<315){var e=d;d=c;c=e}f.dim.width*=d;f.dim.height*=c},set:function(a,b){var c=m.extend(true,{},a),f=m.GroupShape.props.transform;f.setData(c,b);m.GroupShape.props.effects.reflection.updateReflectionData(c,b);m.GroupShape.call_setMethod(c,b,f)},_set:function(a,b,c){Shape.props.transform.dim.set(a,
b,c);Shape.props.transform.dim.dependency(a,b,c)}},flip:function(a,b,c){a=a.transform;b=b.props.transform;var f=c?a.pos.left:0;c=c?a.pos.top:0;if(a.fliph){b.pos.left=f+a.dim.width-(b.pos.left+b.dim.width-f);b.fliph=b.fliph?false:true}if(a.flipv){b.pos.top=c+a.dim.height-(b.pos.top+b.dim.height-c);b.flipv=b.flipv?false:true}},rotate:function(a,b,c){a=a.transform;b=b.props.transform;var f=a.rotate?a.rotate:0;c=zoho.math.getRotatedValue(f,b.pos.left,b.pos.top,(c?a.pos.left:0)+a.dim.width*0.5,(c?a.pos.top:
0)+a.dim.height*0.5);var d=zoho.math.getRotatedValue(f,0,0,b.dim.width*0.5,b.dim.height*0.5);b.pos.left=zoho.math.roundDecimal(c.x,4)-zoho.math.roundDecimal(d.x,4);b.pos.top=zoho.math.roundDecimal(c.y,4)-zoho.math.roundDecimal(d.y,4);b.rotate=b.rotate?b.rotate:0;if(a.fliph&&!a.flipv||a.flipv&&!a.fliph)b.rotate=f-b.rotate;else b.rotate+=f;b.rotate%=360}},fill:{set:function(a,b){a=m.extend(true,{},a);var c=m.GroupShape.props.fill;c.setData(a,b);m.GroupShape.props.effects.reflection.updateReflectionData(a,
b);m.GroupShape.call_setMethod(a,b,c)},setData:function(a,b){m.GroupShape.updateShapeData(m.GroupShape.props,a,b)},_setData:function(a,b,c){var f=m.GroupShape.props.fill,d=a.fill.type.toLowerCase();f[d]._setData(a,b,c)},_set:function(a,b,c){if(a.type!=m.ShapeConstants.ShapeNodeType.PICTURE){Shape.props.fill.set(a,b,c);Shape.props.fill.dependency(a,b,c)}},remove:function(a,b){m.GroupShape.props.fill.set(a,b)},grp:{setData:function(){},_setData:function(){},set:function(){},_set:function(){}},solid:{set:function(a,
b){a=m.extend(true,{},a);var c=m.GroupShape.props.fill;c.setData(a,b);m.GroupShape.props.effects.reflection.updateReflectionData(a,b);m.GroupShape.call_setMethod(a,b,c)},setData:function(a,b){m.GroupShape.updateShapeData(m.GroupShape.props,a,b)},_setData:function(a,b){var c=a.fill,f=b.props.fill?b.props.fill:undefined;if(f&&f.grp)b.props.fill=c},_set:function(a,b,c){a.type!=m.ShapeConstants.ShapeNodeType.PICTURE&&Shape.props.fill.solid.set(a,b,c)}},pict:{set:function(a,b){a=m.extend(true,{},a);var c=
m.GroupShape.props.fill;c.setData(a,b);m.GroupShape.props.effects.reflection.updateReflectionData(a,b);m.GroupShape.call_setMethod(a,b,c)},setData:function(a,b){m.GroupShape.updateShapeData(m.GroupShape.props,a,b)},_setData:function(a,b,c){var f=m.extend(true,{},a).fill,d=f[f.type.toLowerCase()],e=a.fill.pict?a.fill.pict.type[d.type.type.toLowerCase()]:undefined,g=0,h=0,j=0,l=0,n,o,p,r=a.transform.dim.width,q=a.transform.dim.height;if(e){e.left=m.isNumeric(e.left)?e.left:0;e.right=m.isNumeric(e.right)?
e.right:0;e.top=m.isNumeric(e.top)?e.top:0;e.bottom=m.isNumeric(e.bottom)?e.bottom:0;e.offsetX=m.isNumeric(e.offsetX)?e.offsetX:0;e.offsetY=m.isNumeric(e.offsetY)?e.offsetY:0;g=e.left*-1*r;h=e.right*-1*r;j=e.top*-1*q;l=e.bottom*-1*q;n=e.fliph;o=e.flipv;p=e.rotate}var s=a.transform,t=b.props.transform,u=s.rotate?s.rotate:0;t=t.rotate?t.rotate:0;t=p?p+(u-t):u-t;p=p?p+u:u;u=b.props.transform.dim.width;var v=b.props.transform.dim.height;r=zoho.math.getRotatedValue(-p,b.props.transform.pos.left,b.props.transform.pos.top,
r*0.5,q*0.5);p=zoho.math.getRotatedValue(-p,0,0,u*0.5,v*0.5);q=zoho.math.roundDecimal(r.x,4)-zoho.math.roundDecimal(p.x,4);p=zoho.math.roundDecimal(r.y,4)-zoho.math.roundDecimal(p.y,4);r=parseFloat(q.toFixed(3));q=parseFloat(p.toFixed(3));u=a.transform.dim.height;p=b.props.transform.dim;a=a.transform.dim.width-p.width-r;a=parseFloat(a.toFixed(3));u=u-p.height-q;u=parseFloat(u.toFixed(3));v=p.width.toFixed(4)==0?1:p.width.toFixed(4);p=p.height.toFixed(4)==0?1:p.height.toFixed(4);n=n!==undefined?n:
s.fliph!==undefined?s.fliph:false;o=o!==undefined?o:s.flipv!==undefined?s.flipv:false;e={left:-1*(r+g)/v,top:-1*(q+j)/p,right:-1*(a+h)/v,bottom:-1*(u+l)/p,offsetX:e?e.offsetX:0,offsetY:e?e.offsetY:0,rotate:t,fliph:n?n:false,flipv:o?o:false,isGroupshape:true};if(b.type===m.ShapeConstants.ShapeNodeType.SHAPE&&n){n=e.left;e.left=e.right;e.right=n;e.rotate=-e.rotate}if(b.type===m.ShapeConstants.ShapeNodeType.SHAPE&&o){n=e.top;e.top=e.bottom;e.bottom=n;e.rotate=-e.rotate}if(d)if(c){delete d.type.tile;
delete d.type.frame;delete d.value.serverUrl;delete d.value.dim}else d.type[d.type.type.toLowerCase()]=e;if((c=b.props.fill?b.props.fill:undefined)&&c.grp)b.props.fill=f},_set:function(a,b,c){if(a.type!=m.ShapeConstants.ShapeNodeType.PICTURE){Shape.props.fill.pict.set(a,b,c);Shape.props.fill.pict.dependency(a,b,c)}},remove:function(){}},none:{set:function(a,b){a=m.extend(true,{},a);var c=m.GroupShape.props.fill;c.setData(a,b);m.GroupShape.props.effects.reflection.updateReflectionData(a,b);m.GroupShape.call_setMethod(a,
b,c)},setData:function(a,b){m.GroupShape.updateShapeData(m.GroupShape.props,a,b)},_setData:function(a,b){var c=a.fill,f=b.props.fill?b.props.fill:undefined;if(f&&f.grp)b.props.fill=c},_set:function(a,b,c){a.type!=m.ShapeConstants.ShapeNodeType.PICTURE&&Shape.props.fill.none.set(a,b,c)}},gradient:{set:function(a,b){a=m.extend(true,{},a);var c=m.GroupShape.props.fill;c.setData(a,b);m.GroupShape.props.effects.reflection.updateReflectionData(a,b);m.GroupShape.call_setMethod(a,b,c)},setData:function(a,
b){m.GroupShape.updateShapeData(m.GroupShape.props,a,b)},_setData:function(a,b,c){var f=m.extend(true,{},a).fill,d=f[f.type.toLowerCase()],e=d.type.toLowerCase(),g=a.fill.gradient[e]?a.fill.gradient[e].offset:a.fill.gradient.offset,h=0,j=0,l=0,n=0,o,p,r,q=a.transform.dim.width,s=a.transform.dim.height;if(g){h=g.left*-1*q;j=g.right*-1*q;l=g.top*-1*s;n=g.bottom*-1*s;p=g.fliph;o=g.flipv;r=g.rotate}g=a.transform;var t=b.props.transform,u=g.rotate?g.rotate:0;t=t.rotate?t.rotate:0;t=r!==undefined?r+(u-
t):u-t;r=r!==undefined?r+u:u;u=b.props.transform.dim.width;var v=b.props.transform.dim.height;q=zoho.math.getRotatedValue(-r,b.props.transform.pos.left,b.props.transform.pos.top,q*0.5,s*0.5);r=zoho.math.getRotatedValue(-r,0,0,u*0.5,v*0.5);s=zoho.math.roundDecimal(q.x,4)-zoho.math.roundDecimal(r.x,4);r=zoho.math.roundDecimal(q.y,4)-zoho.math.roundDecimal(r.y,4);q=parseFloat(s.toFixed(3));s=parseFloat(r.toFixed(3));u=a.transform.dim.height;r=b.props.transform.dim;a=a.transform.dim.width-r.width-q;a=
parseFloat(a.toFixed(3));u=u-r.height-s;u=parseFloat(u.toFixed(3));v=r.width.toFixed(4)==0?1:r.width.toFixed(4);r=r.height.toFixed(4)==0?1:r.height.toFixed(4);p=p!==undefined?p:g.fliph!==undefined?g.fliph:false;o=o!==undefined?o:g.flipv!==undefined?g.flipv:false;h={left:-1*(q+h)/v,top:-1*(s+l)/r,right:-1*(a+j)/v,bottom:-1*(u+n)/r,rotate:t,fliph:p?p:false,flipv:o?o:false,isGroupshape:true};if(b.type===m.ShapeConstants.ShapeNodeType.SHAPE&&p){p=h.left;h.left=h.right;h.right=p;h.rotate=-h.rotate}if(b.type===
m.ShapeConstants.ShapeNodeType.SHAPE&&o){p=h.top;h.top=h.bottom;h.bottom=p;h.rotate=-h.rotate}if(!c)d[e]?d[e].offset=h:d.offset=h;if((c=b.props.fill?b.props.fill:undefined)&&c.grp)b.props.fill=f},_set:function(a,b,c){if(a.type!=m.ShapeConstants.ShapeNodeType.PICTURE){Shape.props.fill.gradient.set(a,b,c);Shape.props.fill.gradient.dependency(a,b,c)}}}},effects:{set:function(a,b){m.GroupShape.props.effects.reflection.set(a,b)},setData:function(a,b){m.GroupShape.props.effects.reflection.setData(a,b)},
_setData:function(a,b,c){m.GroupShape.props.effects.reflection._setData(a,b,c)},_set:function(a,b,c){m.GroupShape.props.effects.reflection._set(a,b,c)},remove:function(a,b){m.GroupShape.props.effects.reflection.remove(a,b)},shadow:{},reflection:{set:function(a,b){var c=m.extend(true,{},a),f=m.GroupShape.props.effects.reflection;f.setData(c,b);m.GroupShape.props.effects.reflection.updateReflectionData(c,b);m.GroupShape.call_setMethod(c,b,f)},updateReflectionData:function(a,b){if(a.type===m.ShapeConstants.ShapeNodeType.GROUPSHAPE){if(a.props.effects&&
a.props.effects.reflection){var c=m.GroupShape.props.effects.reflection.getMaxPoint(a);a.props.effects.reflection.maxPoint=c;m.GroupShape.updateShapeData(m.GroupShape.props.effects.reflection,a,b)}m.each(a.shapes,function(f,d){var e=d.type;d=d[e.toLowerCase()]?d[e.toLowerCase()]:d;d.type=e;m.GroupShape.props.effects.reflection.updateReflectionData(d,b)})}},setData:function(a,b){m.GroupShape.updateShapeData(m.GroupShape.props,a,b)},getMaxPoints:function(a){var b=a.props.transform.dim;b=[b.width,b.height];
return m.GroupShape.props.effects.reflection.getRotatedMaxPoints(b,a.props.transform.rotate?a.props.transform.rotate:0,b[0]/2,b[1]/2)},getMaxPoint:function(a){a=a.groupshape?a.groupshape:a;a=m.GroupShape.props.effects.reflection.getMaxPoints(a,a.props.transform.rotate);return m.GroupShape.props.effects.reflection.getDimension(a)},getRotatedMaxVal:function(a,b,c,f){a=a.transform.rotate?a.transform.rotate:0;var d=b.props.transform.dim.width,e=b.props.transform.dim.height;c=c.maxPoint?c.maxPoint:[{x:0,
y:0},{x:0,y:0}];var g=f.top*-1*e;b=m.GroupShape.props.effects.reflection.getRotatedPoints([d,e],(b.props.transform.rotate?b.props.transform.rotate:0)-a,a,((f.left+f.right)*-1+1)*d*0.5-f.left*-1*d,((f.top+f.bottom)*-1+1)*e*0.5-g)[0].y+g;return c[0].y-b},getRotatedPoints:function(a,b,c,f,d){var e=zoho.math.getRotatedValue(b,0,0,a[0]*0.5,a[1]*0.5);e=zoho.math.getRotatedValue(c,e.x,e.y,f,d);var g=zoho.math.getRotatedValue(b,a[0],0,a[0]*0.5,a[1]*0.5);g=zoho.math.getRotatedValue(c,g.x,g.y,f,d);var h=zoho.math.getRotatedValue(b,
0,a[1],a[0]*0.5,a[1]*0.5);h=zoho.math.getRotatedValue(c,h.x,h.y,f,d);a=zoho.math.getRotatedValue(b,a[0],a[1],a[0]*0.5,a[1]*0.5);c=zoho.math.getRotatedValue(c,a.x,a.y,f,d);return m.GroupShape.props.effects.reflection.getDimension([e,g,h,c])},getRotatedMaxPoints:function(a,b,c,f){var d=zoho.math.getRotatedValue(b,0,0,c,f),e=zoho.math.getRotatedValue(b,a[0],0,c,f),g=zoho.math.getRotatedValue(b,0,a[1],c,f);a=zoho.math.getRotatedValue(b,a[0],a[1],c,f);return m.GroupShape.props.effects.reflection.getDimension([d,
e,g,a])},getDimension:function(a){a=VectorUtil.getMinAndMax(a);return[a.big,a.small]},_setData:function(a,b,c){var f=a.effects?m.extend(true,{},a.effects.groupReflection?a.effects.groupReflection:a.effects.reflection):undefined;if(m.isEmptyObject(f))return false;var d=a.transform,e=b.props.transform,g=d.rotate?d.rotate:0,h=e.rotate?e.rotate:0,j=a.transform.dim.width,l=a.transform.dim.height,n=e=0,o=0,p=0,r,q=m.extend(true,{},f.offset);if(!m.isEmptyObject(q)){e=q.left*-1*j;n=q.right*-1*j;o=q.top*-1*
l;p=q.bottom*-1*l;j*=(q.left+q.right)*-1+1;l*=(q.top+q.bottom)*-1+1;r=q.rotate}h=r!==undefined?r+(g-h):g-h;g=r!==undefined?r+g:g;r=b.props.transform.dim.width;q=b.props.transform.dim.height;j=zoho.math.getRotatedValue(-g,b.props.transform.pos.left,b.props.transform.pos.top,j*0.5,l*0.5);g=zoho.math.getRotatedValue(-g,0,0,r*0.5,q*0.5);l=zoho.math.roundDecimal(j.x,4)-zoho.math.roundDecimal(g.x,4);g=zoho.math.roundDecimal(j.y,4)-zoho.math.roundDecimal(g.y,4);j=parseFloat(l.toFixed(3));l=parseFloat(g.toFixed(3));
q=a.transform.dim.height;r=b.props.transform.dim;g=a.transform.dim.width-r.width-j;g=parseFloat(g.toFixed(3));q=q-r.height-l;q=parseFloat(q.toFixed(3));var s=r.width.toFixed(4)===0?1:r.width.toFixed(4);r=r.height.toFixed(4)===0?1:r.height.toFixed(4);d={left:-1*(j+e)/s,top:-1*(l+o)/r,right:-1*(g+n)/s,bottom:-1*(q+p)/r,rotate:h,fliph:d.fliph?d.fliph:false,flipv:d.flipv?d.flipv:false,isGroupshapeRef:true};if(!c&&f.distance){if(b.type!==m.ShapeConstants.ShapeNodeType.GROUPSHAPE){a=m.GroupShape.props.effects.reflection.getRotatedMaxVal(a,
b,f,d);f.distance.radius=(f.distance.radius?f.distance.radius:0)+2*a}a=b.props.effects?b.props.effects:{};f.offset=d;a.groupReflection=f;b.props.effects=a}},_set:function(a,b,c){Shape.props.effects.reflection.set(a,b,c)},remove:function(a,b){m.each((a.groupshape?a.groupshape:a).shapes,function(c,f){if(f.type===m.ShapeConstants.ShapeNodeType.GROUPSHAPE)m.GroupShape.props.effects.reflection.remove(f,b);else{var d=m.GroupShape.getBox(f,b);Shape.props.effects.reflection.remove(f,b,d)}});m.GroupShape.props.effects.reflection.set(a,
b)}}}},getShape:function(a,b){var c;m.each(b.shapes,function(f,d){var e=d.type;d=d[e.toLowerCase()]?d[e.toLowerCase()]:d;if(e===m.ShapeConstants.ShapeNodeType.GROUPSHAPE){if(c=m.GroupShape.getShape(a,d))return false}else if(d.nvOProps.nvDProps.id===a){c=d;return false}});return c},updateInnerShapeData:function(a,b,c,f){a._setData(b,c,f)},getBox:function(a,b){return m("#"+(a.groupshape?a.groupshape:a).nvOProps.nvDProps.id,b)},call_setMethod:function(a,b,c){var f=m.GroupShape;m.each((a.groupshape?a.groupshape:
a).shapes,function(d,e){if(e.type===m.ShapeConstants.ShapeNodeType.GROUPSHAPE){f.getBox(e,b).css({left:e.props.transform.pos.left,top:e.props.transform.pos.top});f.call_setMethod(e,b,c)}else{var g=f.getBox(e,b);c._set(e,b,g)}})},updateShapeData:function(a,b,c,f,d){if(!a)a=m.GroupShape.props;var e=m.GroupShape;b=b.groupshape?b.groupshape:b;if(!f)f=b.props;b.shapes&&m.each(b.shapes,function(g,h){if(h.type===m.ShapeConstants.ShapeNodeType.GROUPSHAPE){type=h.type;h=h.groupshape?h.groupshape:h;h.type=
type;e.updateInnerShapeData(a,f,h,d);e.updateShapeData(a,h,c,undefined,d)}else{h=h.type&&h[h.type.toLowerCase()]?h[h.type.toLowerCase()]:h;e.updateInnerShapeData(a,f,h,d)}})},modifydata:function(a){var b;b=ShapeEditor.config.get.shapeContainer();b=this.getBox(a,b);if(b.data().groupShapeId){b=b.data().groupShapeId;b=this.modifydata(ShapeEditor.config.get.shape(b),a);a=this.modifingData(a,b)}return a},modifingData:function(a,b){var c=m.GroupShape.props,f,d,e;b=b.groupshape?b.groupshape:b;a=a.groupshape?
a.groupshape:a;f=b.props;d=ShapeEditor.config.get.shapeContainer();e=this.getBox(a,d);this.updateInnerShapeData(c,f,a,d,e);return a},getInnerShapeData:function(a,b){var c=false,f=this;b=b.groupshape?b.groupshape:b;b.type==m.ShapeConstants.ShapeNodeType.GROUPSHAPE&&m.each(b.shapes,function(d,e){var g=e.groupshape?e.groupshape:e;if(a==g.nvOProps.nvDProps.id){c=g;return false}else if(c=f.getInnerShapeData(a,g))return false});return c},getParentShapeId:function(a){a=m("#"+a.nvOProps.nvDProps.id);if(a.data()&&
a.data().groupShapeId)return a.data().groupShapeId},mData:function(a,b){var c;b=b.groupshape?b.groupshape:b;var f=this.getParentShapeId(a);if(f)if(f==b.nvOProps.nvDProps.id)c=this.modifingData(a,b);else{c=this.getInnerShapeData(f,b);c=this.mData(m.extend(true,{},c),b);c=this.modifingData(a,c)}return c}};m.extend(true,m.GroupShape.shapes.shape,{props:Shape.props});m.extend(true,m.GroupShape.shapes,{picture:m.GroupShape.shapes.shape,connector:m.GroupShape.shapes.shape});m.extend(true,m.GroupShape.shapes.groupshape,
m.GroupShape)})(jQuery);(function(m){m.ShapeObject={props:{set:function(a,b){if(a.type==m.ShapeConstants.ShapeNodeType.GROUPSHAPE)m.GroupShape.props.set(a,b);else{Shape.props.set(a,b);Shape.props.dependency(a,b)}},transform:{set:function(a,b){if(a.type==m.ShapeConstants.ShapeNodeType.GROUPSHAPE)m.GroupShape.props.transform.set(a,b);else{Shape.props.transform.set(a,b);Shape.props.transform.dependency(a,b)}},pos:{set:function(a,b){a.type==m.ShapeConstants.ShapeNodeType.GROUPSHAPE?m.GroupShape.props.transform.pos.set(a,b):
Shape.props.transform.pos.set(a,b)}},dim:{set:function(a,b){if(a.type==m.ShapeConstants.ShapeNodeType.GROUPSHAPE)m.GroupShape.props.transform.dim.set(a,b);else{Shape.props.transform.dim.set(a,b);Shape.props.transform.dim.dependency(a,b)}}}}}}})(jQuery);(function(m){DateTimeField={date:function(a){return m.i18n("show.calender.date."+a.getDate())},monthnum:function(a){return a.getMonth()+1},year:function(a){return a.getFullYear()},halfyear:function(a){return String(this.year(a)).substring(2,4)},daynum:function(a){return a.getDay()+1},day:function(a){return m.i18n("show.calender.day."+this.daynum(a))},halfday:function(a){return m.i18n("show.calender.day.half."+this.daynum(a))},month:function(a){return m.i18n("show.calender.month."+this.monthnum(a))},
halfmonth:function(a){return m.i18n("show.calender.month.half."+this.monthnum(a))},hour:function(a){return(a=a.getHours()%12)?a:12},min:function(a){a=a.getMinutes()%60;if(a<10)a="0"+a;return a},sec:function(a){return a.getSeconds()},ampm:function(a){return a.getHours()<12?m.i18n("show.calender.am"):m.i18n("show.calender.pm")},set:function(a,b){var c=m.ShowConstants.DateTimeField[a];b||(b=new Date);c=c.split("-");var f=this,d=[];m.each(c,function(e,g){d.push(f[g].call(f,b))});a=a.toLowerCase();return m.i18n("show.calender.date."+
a,d)}}})(jQuery);(function(m){m.uniCode={font:{wingdings:{"32":"32","33":"9999","34":"9986","35":"9985","36":"128083","37":"128276","38":"128214","39":"","40":"9742","41":"9990","42":"9993","43":"","44":"128234","45":"128235","46":"128236","47":"128237","48":"128193","49":"128194","50":"128196","51":"","52":"","53":"","54":"8987","55":"9000","56":"","57":"","58":"128187","59":"","60":"128190","61":"","62":"9991","63":"9997","64":"","65":"9996","66":"128076","67":"128077","68":"128078","69":"9756","70":"9758","71":"9757",
"72":"9759","73":"","74":"9786","75":"128528","76":"9785","77":"128163","78":"9760","79":"9872","80":"","81":"9992","82":"9788","83":"128167","84":"10052","85":"","86":"10014","87":"","88":"10016","89":"10017","90":"9770","91":"9775","92":"2384","93":"9784","94":"9800","95":"9801","96":"9802","97":"9803","98":"9804","99":"9805","100":"9806","101":"9807","102":"9808","103":"9809","104":"9810","105":"9811","106":"38","107":"38","108":"9679","109":"10061","110":"9632","111":"9633","112":"","113":"10065",
"114":"10066","115":"11047","116":"10731","117":"9670","118":"10070","119":"11045","120":"8999","121":"9043","122":"8984","123":"10048","124":"10047","125":"10077","126":"10078","127":"9647","128":"9450","129":"9312","130":"9313","131":"9314","132":"9315","133":"9316","134":"9317","135":"9318","136":"9319","137":"9320","138":"9321","139":"9471","140":"10102","141":"10103","142":"10104","143":"10105","144":"10106","145":"10107","146":"10108","147":"10109","148":"10110","149":"10111","150":"","151":"",
"152":"","153":"","154":"","155":"","156":"","157":"","158":"183","159":"8226","160":"9642","161":"9675","162":"","163":"","164":"9673","165":"9678","166":"","167":"9642","168":"9723","169":"","170":"10022","171":"9733","172":"10038","173":"10036","174":"10041","175":"10037","176":"","177":"8982","178":"10209","179":"8977","180":"","181":"10026","182":"10032","183":"128336","184":"128337","185":"128338","186":"128339","187":"128340","188":"128341","189":"128342","190":"128343","191":"128344","192":"128345",
"193":"128346","194":"128347","195":"","196":"","197":"","198":"","199":"","200":"","201":"","202":"","203":"","204":"","205":"","206":"","207":"","208":"","209":"","210":"","211":"","212":"","213":"9003","214":"8998","215":"","216":"10146","217":"","218":"","219":"","220":"10162","221":"","222":"","223":"","224":"","225":"","226":"","227":"","228":"","229":"","230":"","231":"","232":"10132","233":"","234":"","235":"","236":"","237":"","238":"","239":"8678","240":"8680","241":"8679","242":"8681",
"243":"11012","244":"8691","245":"11008","246":"11009","247":"11011","248":"11010","249":"9645","250":"9643","251":"10007","252":"10003","253":"9746","254":"9745","255":""}}}})(jQuery);(function(m){m.NumericConversion={NumberedBulletType:{NUMERIC:[1,5,10,50,100,500,1E3],LCALPHABET:["z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],UCALPHABET:["Z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],UCROMAN:["I","V","X","L","C","D","M"],LCROMAN:["i","v","x","l","c","d","m"]},convert:function(a,b){var c=a.type,f=a.suffix?a.suffix:"",d=a.prefix?a.prefix:"";c=this[c].call(this,
b,c);return d+c+f},NUMERIC:function(a){return a},UCROMAN:function(a,b){return this.convertToRoman(a,b)},LCROMAN:function(a,b){return this.convertToRoman(a,b)},convertToRoman:function(a,b){if(a>32E3)return this.NumberedBulletType[b][0];var c="",f=this.NumberedBulletType.NUMERIC.length;c="";for(f-=1;f>=0;f--){for(var d=Math.floor(a/this.NumberedBulletType.NUMERIC[f]);d>0;){c+=this.NumberedBulletType[b][f];d--}a%=this.NumberedBulletType.NUMERIC[f]}return this.convertToModernRoman(c,b)},convertToModernRoman:function(a,
b){return this["modern"+b].call(this,a)},modernUCROMAN:function(a){a=a.replace(/DCCCC/g,"CM");a=a.replace(/CCCC/g,"CD");a=a.replace(/LXXXX/g,"XC");a=a.replace(/XXXX/g,"XL");a=a.replace(/VIIII/g,"IX");return a=a.replace(/IIII/g,"IV")},modernLCROMAN:function(a){a=a.replace(/dcccc/g,"cm");a=a.replace(/cccc/g,"cd");a=a.replace(/lxxxx/g,"xc");a=a.replace(/xxxx/g,"xl");a=a.replace(/viiii/g,"ix");return a=a.replace(/iiii/g,"iv")},LCALPHABET:function(a,b){return this.convertToAlphabets(a,b)},UCALPHABET:function(a,
b){return this.convertToAlphabets(a,b)},convertToAlphabets:function(a,b){var c=parseInt(a/26),f=parseInt(a%26);f!=0&&c++;for(var d="";c>0;){d+=this.NumberedBulletType[b][f];c--}return d}}})(jQuery);
(function(a){var b=a(window),e=b.width(),c=b.height(),f=parseInt(a.browser.version);if(a.browser.msie&&f<9)a.event.special.resize={setup:function(){a(window).bind("resize",a.event.special.resize.handler);return false},handler:function(){var d=b.width(),g=b.height();if(e!==d||c!==g){e=d;c=g}else return false}};else if(a.browser.webkit||a.browser.msie&&f>=9){a.event.special.click={setup:function(){a(this).bind("click",a.event.special.click.handler);return false},handler:function(d){if(d.target.correspondingElement)d.target=
a("#"+d.target.correspondingElement.id)}};a.event.special.mousedown={setup:function(){a(this).bind("mousedown",a.event.special.click.handler);return false}};a.event.special.contextmenu={setup:function(){a(this).bind("contextmenu",a.event.special.click.handler);return false}};a.event.special.mouseover={setup:function(){a(this).bind("mouseover",a.event.special.click.handler);return false}};a.event.special.mouseout={setup:function(){a(this).bind("mouseout",a.event.special.click.handler);return false}};
a.event.special.mousemove={setup:function(){a(this).bind("mousemove",a.event.special.click.handler);return false}};a.event.special.mouseup={setup:function(){a(this).bind("mouseup",a.event.special.click.handler);return false}};a.event.special.dblclick={setup:function(){a(this).bind("dblclick",a.event.special.click.handler);return false}}}})(jQuery);(function(a){ShapeEventHandler={getTarget:function(b){if(b.target.correspondingElement)c=a("#"+b.target.correspondingElement.id);else{for(var e=[],c=b.target;c.nodeName=="svg";){e.push(c);a(c).css("display","none");c=document.elementFromPoint(b.clientX,b.clientY)}a.each(e,function(f,d){a(d).css("display","block")})}return a(c)},getTargetWithElement:function(b,e,c){b=a(b)[0];if(b.correspondingElement)b=a("#"+b.correspondingElement.id);else{for(var f=[];b.nodeName==="svg";){f.push(b);a(b).css("display",
"none");b=document.elementFromPoint(e,c)}a.each(f,function(d,g){a(g).css("display","block")})}return a(b)}}})(jQuery);
(function(){SVGPathUtil={arcCurve:"A",getEndPathString:function(){return"z"},getEndPath:function(){return[this.getEndPathString()]},getClosePath:function(){return this.getEndPath()},getEndClosePath:function(){return this.getEndPath()},getNoFill:function(){return""},getNumber:function(g){return g},getQuadBezier:function(g,a,c,d){return["Q",g,a,c,d]},getXCurve:function(g,a,c,d,e,f){return this.getArcCurve(Math.abs(c-g),Math.abs(d-a),c,d,e,f)},getYCurve:function(g,a,c,d,e,f){return this.getXCurve(g,
a,c,d,e,f)},getFiller:function(g,a){return["M",g,a]},getEllipse:function(g,a,c,d,e){var f=this.getArcCurve(g,a,c+g,d,e,true);return f.concat(this.getArcCurve(g,a,c-g,d,e,true))},getEllipseCurve:function(g,a,c,d,e,f,j,i){return this.getArcCurve(g,a,e,f,j,i)},getXEllipseCurve:function(g,a,c,d,e,f,j){return this.getEllipseCurve(g,a,c,e,d,e,f,j)},getYEllipseCurve:function(g,a,c,d,e,f,j){return this.getEllipseCurve(g,a,e,c,e,d,f,j)},getArcCurve:function(g,a,c,d,e,f){var j=[0,0,1];if(e)j[2]=0;if(f)j[1]=
1;return[this.arcCurve,g,a,j[0],j[1],j[2],c,d]}}})(jQuery);(function(g){SVGCreator={SvgString:'<svg overflow="auto" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"   preserveAspectRatio="none" style="position: absolute; top: 0pt; left: 0pt;"></svg>',SvgNamespace:"http://www.w3.org/2000/svg",RotationConstant:4,ScaleConstant:3,TranslateConstant:2,DefaultConstant:1,TextLineSpacing:1.2,Xlink:"http://www.w3.org/1999/xlink",fillId:"fillId",markerId:"markerId",maskId:"maskId",init:function(){},getDefaultRoot:function(a){if(!a)a=SVGCreator.SvgString;
return this.adoptNode((new DOMParser).parseFromString(a,"text/xml").documentElement)},adoptNode:function(a){return document.adoptNode(a)},setRoot:function(a,c,d,e,f){var j,i,k=undefined;if(f.isStaticShape){e=g.extend(true,{},f.props);c=e.transform;k=c.pos;i=c.dim;if(e.stroke)if(e=e.stroke.width){k.left-=e/2;k.top-=e/2;i.width+=e;i.height+=e;if(f.viewBoxScaling){i.width*=f.viewBoxScaling;i.height*=f.viewBoxScaling}}e=VectorUtil.getViewBoxDimensions(k.left,k.top);b=VectorUtil.getViewBoxDimensions(i.width,
i.height);f=b[0]+e[0];d=b[1]+e[1];c=i.width+k.left;j=i.height+k.top;i=-k.left;k=-k.top}else if(f.fitModeData){i=f.fitModeData.left;k=f.fitModeData.top;e=[-i,-k];c=f.fitModeData.width;j=f.fitModeData.height;f=c;d=j}else{k=i=undefined;if(f.containerDim){i=f.containerDim.width;k=f.containerDim.height}else{i=e.width();k=e.height()}e=VectorUtil.getViewBoxDimensions(i,k);b=VectorUtil.getViewBoxDimensions(c,d);f=b[0]+2*e[0];d=b[1]+2*e[1];c=VectorUtil.getHTMLDimension(f);j=VectorUtil.getHTMLDimension(d);
i=-i;k=-k}f={version:1.1,viewBox:-e[0]+", "+-e[1]+", "+f+","+d,width:c,height:j,"z-index":0};a.nodeType||(a=a[0]);this.set(a,f);a.style.left=i+"px";a.style.top=k+"px"},getRoot:function(a){return a.find("#root")},createParentGroup:function(a){a=this.createElement(a,"g");a.setAttribute("transform","rotate(0) translate(0 0) scale(1 1) ");return a},createGroup:function(a){a=this.createElement(a,"g");a.setAttribute("transform","rotate(0) translate(0 0) scale(1 1) ");return a},getAvailableGroups:function(a){return g("g",
a)},createPath:function(a){return this.createElement(a,"path")},createText:function(a){return this.createElement(a,"text")},createTSpan:function(a){return this.createElement(a,"tspan")},createAnchor:function(a){return this.createElement(a,"a")},setPath:function(a,c){a.nodeType||(a=a[0]);this.set(a,"d",c);this.set(a,"fill-rule","evenodd")},setFill:function(a,c,d){c=="none"?this.set(a,{fill:"none"}):this.set(a,{fill:c,"fill-opacity":d})},setShapeDimension:function(){},setStroke:function(a,c,d){var e=
{stroke:c};if(c!="none"){e["stroke-width"]=d;e["stroke-linejoin"]="miter";e["stroke-linecap"]="square"}this.set(a,e)},createRectangle:function(a,c,d,e,f,j){a||(a=Shape.selectedShapeBox[0][0]);a=this.createElement(a,"rect");j=VectorUtil.getViewBoxDimensions(j);e+=j;f+=j;this.set(a,{x:"0",y:"0",width:e,height:f});return a},createCircle:function(a,c,d,e,f){a||(a=Shape.selectedShapeBox[0][0]);a=this.createElement(a,"circle");if(f){f=VectorUtil.getViewBoxDimensions(f);c+=f;d+=f}this.set(a,{cx:c,cy:d,r:e});
return a},setRectangle:function(a,c,d,e,f){var j={};if(typeof c!="undefined")j.x=c;if(typeof d!="undefined")j.y=d;if(typeof e!="undefined")j.width=e;if(typeof f!="undefined")j.height=f;this.set(a,j)},getRect:function(a,c){return this.get(a,c)},createElement:function(a,c){a.nodeType||(a=a[0]);return a.ownerDocument.createElementNS(SVGCreator.SvgNamespace,c)},get:function(a,c){a.nodeType||(a=a[0]);return VectorUtil.get(a,c)},set:function(a,c,d){a.nodeType||(a=a[0]);VectorUtil.set(a,c,d)},getRotationAngle:function(a){if(!a)a=
Shape.selectedShape;a.nodeType||(a=a[0]);return this.getTransform(a,SVGCreator.RotationConstant)},getTransform:function(a,c){for(var d=a.transform.baseVal,e=d.numberOfItems,f=undefined,j=0;j<e;++j){var i=d.getItem(j);if(i.type==c){f=i;break}}if(!f)return null;if(c==SVGCreator.RotationConstant)return f.angle;if(c==SVGCreator.ScaleConstant){d={};d.sw=f.matrix.a;d.sh=f.matrix.d;return d}if(c==SVGCreator.TranslateConstant){d={};d.x=f.matrix.e;d.y=f.matrix.f;return d}},rotateShape:function(a,c,d){if(c.length>
0){c=c[0];d=this.getCenter(d);d.angle=a;this.setTransform(c,SVGCreator.RotationConstant,d)}},flipShape:function(a,c,d,e){a=a?a[0]:g("#reflectionshapegroup",bx);e||this.rotateShape(0,a,d);d=VectorUtil.getViewBoxDimensions(d.width,d.height);if(c=="x"){c={sw:"-1",sh:"1"};d={x:d[0],y:0}}else if(c=="y"){c={sw:"1",sh:"-1"};d={x:0,y:d[1]}}else if(c=="both"){c={sw:"-1",sh:"-1"};d={x:d[0],y:d[1]}}else{c={sw:"1",sh:"1"};d={x:0,y:0}}this.setTransform(a,SVGCreator.TranslateConstant,d);this.setTransform(a,SVGCreator.ScaleConstant,
c)},rotateTextElement:function(a,c,d){a||(a=Shape.selectedShapeBox[0]);a=g("#textcontainer",a);c=g.extend(true,{},c);a&&VectorUtil.rotateElement(a,c,1,d)},rotateElement:function(a,c){a.css({MozTransform:"rotate("+c+"deg)"})},setViewBox:function(a,c,d,e,f,j,i,k,n){a.nodeType||(a=a[0]);this.set(a,{viewBox:c+", "+d+", "+e+","+f,width:k,height:n});a.style.left=j+"px";a.style.top=i+"px"},getCenter:function(a){a=VectorUtil.getViewBoxDimensions(a.width,a.height);return{cx:a[0]*0.5,cy:a[1]*0.5}},getTransformObject:function(a,
c,d,e){if(c==SVGCreator.RotationConstant){a=this.getCenter(e);a.angle=d;return a}},getDimension:function(a){a.nodeType||(a=a[0]);a=a.getBBox();return{width:parseFloat(a.width),height:parseFloat(a.height)}},convertTransformMatrixToText:function(a){return"matrix("+[a.a,a.b,a.c,a.d,a.e,a.f].join(" ")+")"},setTransform:function(a,c,d,e){for(var f=a.transform.baseVal,j=f.numberOfItems,i=undefined,k=0;k<j;++k){var n=f.getItem(k);if(n.type==c){i=n;break}}j=false;if(!i||e){i=a.ownerSVGElement.createSVGTransform();
j=true}if(c==SVGCreator.RotationConstant){a=d.angle;if(typeof d.cx!="undefined"&&typeof d.cy!="undefined"){if(a===180)if((e=window.navigator.appVersion.match(/Chrome\/(\d+)\./))&&parseInt(e[1],10)===40)a=179.99;i.setRotate(a,d.cx,d.cy)}}c==SVGCreator.ScaleConstant&&i.setScale(parseInt(d.sw),parseInt(d.sh));c==SVGCreator.TranslateConstant&&i.setTranslate(d.x,d.y);j&&f.appendItem(i)},changeShapeDimension:function(a,c,d,e,f){e={};e.width=d[0];e.height=d[1];a=a.find("#"+Shape.shapeId);this.rotateShape(c,
a,e);this.flipShape(a,f,e,c)},getGroup:function(a){return g("#"+Shape.shapeId,a)},getDefinitions:function(a){var c=a.find("#defs");if(c.length>0)return c[0];return this.createDefinitions(a)},createDefinitions:function(a){a=this.createElement(a,"defs");this.set(a,{id:"defs"});return a},getElement:function(a,c,d,e,f){d=VectorUtil.capitalise(d);if(f){if(g.isObject(f))f=f[e];if(f&&f.indexOf(e)!=-1)return g("#"+f,g(a))[0]}return this["create"+d].call(this,a,c,e)},createMarker:function(a,c,d){var e={};
a=this.getDefinitions(a);var f=this.createElement(a,"marker"),j="marker_"+d+"_"+Math.uuid();this.set(f,{id:j,markerUnits:"strokeWidth",orient:"auto",preserveAspectRatio:"none"});e[d=="headend"?"marker-start":"marker-end"]="url(#"+j+")";this.set(c,e);var i=g(c).data(this.markerId);e={};e[d]=j;e=g.extend(true,i,e);g(c).data(this.markerId,e);g(a).append(f);return f},createGradient:function(a,c,d){var e=this.getDefinitions(a),f=this.createElement(e,d+"Gradient");if(d!=="radial")d="linear";d=d+"_"+Math.uuid();
this.set(f,{id:d,"class":"gradient",gradientUnits:"userSpaceOnUse"});g(e).append(f);this.set(c,{fill:"url(#"+d+")"});if(e=g(c).data("pathId")){e=g("#"+e,a);this.set(e,{"fill-rule":"nonzero"});this.set(e,{"fill-rule":"evenodd"})}this.updateFillId(a,c,d);return f},getStopElement:function(a,c){var d=g("#"+c,a);if(d.length>0)return d;d=this.createStop(a);this.set(d,{id:c,"class":"stop"});return d},createStop:function(a){var c=this.createElement(a,"stop");g(a).append(c);return c},removeStops:function(a,
c){g(".stop:gt("+(c.length-1)+")",g(a)).remove()},createPattern:function(a,c,d){var e=this.getDefinitions(a);d=this.createElement(e,d);var f="pattern_"+Math.uuid();this.set(d,{id:f,"class":"pattern",patternUnits:"userSpaceOnUse"});g(e).append(d);this.set(c,{fill:"url(#"+f+")"});if(e=g(c).data("pathId")){e=g("#"+e,a);this.set(e,{"fill-rule":"nonzero"});this.set(e,{"fill-rule":"evenodd"})}this.updateFillId(a,c,f);return d},getImageElement:function(a){var c=g("#image",a);if(c.length>0)return c[0];return this.createImage(a)},
createImage:function(a){var c=this.createElement(a,"image");this.set(c,{preserveAspectRatio:"none",id:"image",x:0,y:0});g(a).append(c);return c},updateFillId:function(a,c,d){var e=g(c).data(this.fillId);e&&g("#"+e,a).remove();g(c).data(this.fillId,d?d:null)},deleteFillElement:function(a,c){var d=g(c).data(this.fillId);g("#"+d,a).remove()},removeElementByClass:function(a,c){g.each(c,function(d,e){var f=g(e,a);g.each(f,function(){g(f,a).remove()})})},fillElement:function(a,c,d,e){if(!d)return a;var f=
g(a).data(this.fillId);return this.getElement(c,a,d,e,f)},markerElement:function(a,c){var d=a.closest("div"),e=g(a).data(this.markerId);return this.getElement(d,a,"marker",c,e)},maskElement:function(a,c,d,e){if(!d)return a;var f=c.data(this.maskId);return this.getElement(c,a,d,e,f)},strokeElement:function(a){return a},getTextElement:function(a){var c=a.find("#textpath0");if(c[0])c=c[0];else{var d=a.data(Shape.textbox);c=this.createText(a);this.set(c,{width:d[2],height:d[3],x:d[0]+d[2]*0.5,id:"textpath0",
"class":"textbox"})}return c},marker:function(a,c,d){if(a.props.stroke&&a.props.stroke.tailend)Shape.props.stroke.tailend.set(a,c,d);else a.props.stroke&&a.props.stroke.headend&&Shape.props.stroke.headend.set(a,c,d)},pathContainer:function(a,c){c=!c?Shape.shapeId:c;return g("#"+c,a)},createShapeElement:function(a){this.get(a,"id");return this.createElement(a,"use")},createTemplate:function(a){return this.createElement(a,"path")},getTemplate:function(a,c){var d=g(a).attr("id").split("path")[1];d=g(c).data("pathIds")[d];
return g("#"+d,c)},getFilterElement:function(a,c){g.find("#defs",a[0]);var d=a.data(c);d=g.find("#filter_"+d,a[0]);d.length||(d=this.createFilterElement(a,c));return d},createFilterElement:function(a,c,d){var e=g.find("#defs",a[0]);a=a.data(c);c=Shape.creator.createElement(e,"filter");d?Shape.creator.set(c,{id:"filter_"+a,filterUnits:"userSpaceOnUse",width:d.width,height:d.height}):Shape.creator.set(c,{id:"filter_"+a,filterUnits:"userSpaceOnUse",width:"100%",height:"100%"});g(e).append(c);return c},
createMask:function(a,c,d){var e=this.getDefinitions(a);c=this.createElement(e,"mask");d=d+"_"+Math.uuid();this.set(c,{id:d,maskUnits:"userSpaceOnUse",x:0,y:0,width:"100%",height:"100%"});g(e).append(c);(e=a.data(this.maskId))&&g("#"+e,a).remove();a.data(this.maskId,d);a=Shape.creator.createElement(c,"rect");Shape.creator.set(a,{id:"reflection",x:0,y:0,width:"100%",height:"100%"});g(c).append(a);return c},setGaussianConvolution:function(a,c){this.set(g(".blurClass",a),{stdDeviation:c})},setTransformPosition:function(a,
c){this.set(g(".shadowPosition",a),{dx:c.x,dy:c.y})},setShadowColor:function(a,c,d){a=g(".shadowColor",a);c=this.getColorMatrixValue(c,d);this.set(a,c)},getColorMatrixValue:function(a,c){var d=a.rgb;return{values:"0 0 0 0 "+Math.round(d[0]/255*10)/10+" 0 0 0 0 "+Math.round(d[1]/255*10)/10+" 0 0 0 0 "+Math.round(d[2]/255*10)/10+" 0 0 0 "+c+" 0"}},createShadowFilter:{inner:function(a){var c=SVGCreator,d=a.data(Shape.shadowFilterId);a=g("#filter_"+d,a);d=c.createElement(a,"feOffset");c.set(d,{"in":"SourceAlpha",
result:"offOut",dx:"0",dy:"0","class":"shadowPosition"});var e=c.createElement(a,"feColorMatrix");c.set(e,{"in":"SourceGraphic",result:"matrixOut",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0","class":"shadowColor"});var f=c.createElement(a,"feComposite");c.set(f,{"in":"matrixOut",in2:"offOut",result:"compOut",operator:"out"});var j=c.createElement(a,"feGaussianBlur");c.set(j,{"in":"compOut",result:"blurOut",stdDeviation:"0","class":"blurClass"});var i=c.createElement(a,"feComposite");
c.set(i,{"in":"blurOut",in2:"SourceGraphic",operator:"atop"});a.append(d,e,f,j,i);return a},outer:function(a){var c=SVGCreator,d=a.data(Shape.shadowFilterId);a=g("#filter_"+d,a);d=c.createElement(a,"feOffset");c.set(d,{"in":"SourceAlpha",result:"offOut",dx:"0",dy:"0","class":"shadowPosition"});var e=c.createElement(a,"feColorMatrix");c.set(e,{"in":"offOut",result:"matrixOut",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0","class":"shadowColor"});var f=c.createElement(a,"feGaussianBlur");
c.set(f,{"in":"matrixOut",result:"blurOut",stdDeviation:"0","class":"blurClass"});var j=c.createElement(a,"feBlend");c.set(j,{"in":"SourceGraphic",in2:"blurOut",result:"blendOut",mode:"normal"});a.append(d,e,f,j);return a}},createBlurElement:function(a){var c=a.data(Shape.shadowFilterId);a=g("#filter_"+c,a[0]);var d=this.createElement(a,"feGaussianBlur");this.set(d,{"class":"shadowblurfilter",id:"feBlur_"+c,"in":"SourceGraphic"});g(a).append(d);return d},_createFilterElement:function(a,c,d,e){c=this.createElement(a,
c);this.set(c,d);e?g(e).append(c):g(a).append(c);return c},createImageFilterElement:function(a){var c=a.data(Shape.imageFilterId);a=g("#filter_"+c,a[0]);this._createFilterElement(a,"feColorMatrix",{"in":"SourceGraphic","class":"imageRecolorIn",result:"gray",type:"matrix","color-interpolation-filters":"sRGB",values:"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 1 0"});this._createFilterElement(a,"feColorMatrix",{"in":"gray","class":"imageRecolorOut",result:"result_recolor",type:"matrix","color-interpolation-filters":"sRGB",
values:"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 1 0"})},createFilter_Bilevel:function(a){var c=a.data(Shape.imageFilterId);a=g("#filter_"+c,a[0]);this.createElement(a,"feColorMatrix");this._createFilterElement(a,"feColorMatrix",{"in":"SourceGraphic","class":"bilevelIn",result:"bright",type:"matrix",values:"0.299 0.587 0.114 0 0 0.299 0.587 0.114 0 0 0.299 0.587 0.114 0 0 0 0 0 1 0 "});c=this._createFilterElement(a,"feComponentTransfer",{"in":"bright","class":"imageRecolorOut","color-interpolation-filters":"sRGB",
result:"result_recolor"});this._createFilterElement(a,"feFuncR",{"class":"bilevelFunction",type:"discrete"},c);this._createFilterElement(a,"feFuncG",{"class":"bilevelFunction",type:"discrete"},c);this._createFilterElement(a,"feFuncB",{"class":"bilevelFunction",type:"discrete"},c)},createFilter_brightness:function(a,c){this._createFilterElement(a,"feColorMatrix",{"in":c,"class":"brightnessFilter",result:"brightnessOut",type:"matrix","color-interpolation-filters":"sRGB",values:"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 1 0"})},
createFilter_contrast:function(a,c){var d=this._createFilterElement(a,"feComponentTransfer",{"in":c,"color-interpolation-filters":"sRGB",result:"contrastOut"});this._createFilterElement(a,"feFuncR",{"class":"colorFunction",type:"table"},d);this._createFilterElement(a,"feFuncG",{"class":"colorFunction",type:"table"},d);this._createFilterElement(a,"feFuncB",{"class":"colorFunction",type:"table"},d)},removeFilterEffects:function(a){g(a).empty()},_removeFilter:function(a,c,d){d=c.data(d);c=g("#filter_"+
d,c[0]);for(d=0;d<a.length;d++)g(a[d]).removeAttr("filter");c.remove()},removeShadowFilter:function(a){this._removeFilter(g("g",a),a,Shape.shadowFilterId);a.removeData("shadowType")},removeImageFilter:function(a){var c=Shape.creator.getDefinitions(a);this._removeFilter(g("image",c),a,Shape.imageFilterId);a.data("imageFilterCreated",false)},setBlurDeviation:function(a,c){this.set(a,{stdDeviation:c})},setFilter:function(a,c){if(a.length){var d=g(a).find(".path").not(".selector");g.each(d,function(e,
f){Shape.creator.set(f,{filter:"url(#filter_"+c+")"})})}}}})(jQuery);(function(g){SVGImage={set:function(a,c,d){d=g("#"+(d&&d.groupId?d.groupId:Shape.shapeId),c);var e=a.value.url,f=a.props,j=SVGImage.getPictureTransform(a,c);g.each(d,function(i,k){var n=g(k).find("."+Shape.pathId);g.each(n,function(o,r){r=g(r);SVGFill.pict.image(c,r,e,f,k,j)})});if(a.value.dim)c.data().origImageDim=a.value.dim;else VectorUtil.getImageDim(e,undefined,{box:c})},alpha:function(a,c,d){var e=a.pictureProps?a.pictureProps.alpha?a.pictureProps.alpha:0:0;a=g("#"+(d&&d.groupId?d.groupId:Shape.shapeId),
c);g.each(a,function(f,j){var i=g(j).find("."+Shape.pathId);g.each(i,function(k,n){SVGImage.setAlpha(c,e,undefined,n)})})},setAlpha:function(a,c,d,e){SVGCreator.set(e,{"fill-opacity":1-c})},crop:function(a,c){if(!g.isEmptyObject(a.crop)){var d=SVGImage.getPictureTransform(a,c),e=g(".pattern",c),f=g("#image",e);f.length&&g.each(f,function(j,i){SVGFill.pict.transform(g(i),undefined,d)});if(e.length){d=g.extend(true,{},a.props.transform);d.dim.width+=15;d.dim.height+=15;g.each(e,function(j,i){SVGFill.pict.transform(undefined,
g(i),d)})}}},getPictureTransform:function(a){var c=a.props.transform.dim,d={pos:{left:0,top:0},dim:c};if(a.crop&&!g.isEmptyObject(a.crop)){a=g.extend(true,{left:0,top:0,bottom:0,right:0},a.crop);d=Math.round(c.width/(1-(a.left+a.right)));c=Math.round(c.height/(1-(a.top+a.bottom)));d={pos:{left:-(a.left*d),top:-(a.top*c)},dim:{width:d,height:c}}}return d},getCanvasElement:function(){var a=g("#myCanvas");if(a.length==0){a=g("<CANVAS>");a.attr({id:"myCanvas"});a.css({position:"absolute",left:"-1000px",
top:"-1000px"});g(document.body).append(a)}return a[0]},getUrl:function(){return this.getCanvasElement().toDataURL()},setImage:function(a,c){c.putImageData(a,0,0,0,0,a.width,a.height);return SVGImage.getUrl()},getImageURL:function(a,c,d,e,f){this.pictureProps({props:d,value:{url:c}},f,undefined,a,e)},isEmptyPictureProps:function(a){(a=g.extend(true,{},a))&&typeof a.alpha!="undefined"&&delete a.alpha;if(!a||g.isEmptyObject(a))return true;if(!g.isEmptyObject(a)){if(a.colorMode&&a.colorMode.mode!=="NONE")return false;
if(a.luminance&&a.luminance.brightness===0&&a.luminance.contrast===0)return true}return false},pictureProps:function(a,c,d,e,f,j){var i=d&&d.groupId?d.groupId:Shape.shapeId;e=e?e:a.pictureProps;SVGImage.alpha(a,c,d);if(SVGImage.isEmptyPictureProps(e))Shape.creator.removeImageFilter(c);else{var k=a.imageData?a.imageData.url:a.value.serverUrl?a.value.serverUrl:a.value.url;a={data:a,box:c,pictureProps:e,callback:f,groupId:i,container:j,object:d};if(e&&e.colorChange)VectorUtil.getImageDim(k,this._pictureProps,
a);else e&&this._pictureProps(undefined,a)}},_pictureProps:function(a,c,d){var e=SVGImage,f=e.getCanvasElement();f.getContext("2d");a=c.data;d=e.modifyProps(d,f,a,c.pictureProps,c);a.imageData&&delete a.imageData;if(c.box){if(d){SVGImage.updateImageData(a,c.box,{url:d},c.groupId);g(document).trigger("SVG_pictureprops_modified",a)}a.props.effects&&a.props.effects.shadow&&Shape.props.effects.shadow.set(a,c.container,c.box)}else d&&c.callback.fn.call(Shape.fillElement,d,c.callback.ele)},modifyProps:function(a,
c,d,e,f){var j;e=e?e:d.pictureProps;var i=e.colorMode;f=f.box;if(a&&(d.colorChange||e.colorChange)){j=d.props.transform.dim;var k=j.width,n=j.height;c.width=k;c.height=n;c.width=c.width==0?1:c.width;c.height=c.height==0?1:c.height;j=c.getContext("2d");j.drawImage(a,0,0,k,n);a=j.getImageData(0,0,c.width,c.height);c=a.data;var o;k=[];if(d.colorChange)o=j.getImageData(d.pictureProps.colorChange.posx,d.pictureProps.colorChange.posy,1,1);n=0;for(var r=c.length;n<r;n+=4){var s=c[n],t=c[n+1],p=c[n+2];if(e.colorChange){var q=
d.colorChange?o.data:e.colorChange.from.rgb;if(s>=q[0]-16&&s<=q[0]+16&&t>=q[1]-16&&t<=q[1]+16&&p>=q[2]-16&&p<=q[2]+16){s=this.colorChange.call(this,c,n,e,k);c[n]=s[0];c[n+1]=s[1];c[n+2]=s[2];c[n+3]=s[3]}}}j=this.setImage(a,j);if(d.colorChange){o=[];a=q.length;for(c=0;c<a-1;c++)o[c]=q[c];ShapeEditor.pictureProps.modifyPictureData(d,e,o)}q={url:j};if(d.storeCanvas)d.url=q}q=g();if(i)if(i.mode===g.ShapeConstants.Mode.NONE)Shape.creator.removeImageFilter(f);else{o=i.mode.toLowerCase();q=Shape.imageElement._createImageFilter(f,
d,q);if(i.mode==g.ShapeConstants.Mode.BILEVEL){Shape.creator.createFilter_Bilevel(f);a=0.5;if(i[o])a=i[o];Shape.imageElement.setBilevel(q,a)}else{Shape.creator.createImageFilterElement(f);if(i.mode==g.ShapeConstants.Mode.DUOTONE){o=i[o];i=o[0].rgb;o=o[1].rgb;Shape.imageElement.setDuotone(q,i,o)}else if(i.mode==g.ShapeConstants.Mode.GRAYSCALE)Shape.imageElement.setGrayScale(q);else if(i.mode==g.ShapeConstants.Mode.SEPIA){i=[0,0,0];o=zoho.color.tweak([217,195,165],{hsl:{saturation:[{mode:"MODIFY",value:1.8}]},
tint:0.5});Shape.imageElement.setDuotone(q,i,o)}}}if((e=e.luminance)&&(e.brightness||e.contrast)){q=Shape.imageElement._createImageFilter(f,d,q);Shape.imageElement.setLuminance(q,e.brightness?e.brightness:0,e.contrast?e.contrast:0,f)}return j},_createImageFilter:function(a,c,d){var e=a.data("imageFilterCreated")!==null?a.data("imageFilterCreated"):false,f=Shape.creator.getDefinitions(a);f=g("image",f);if(e){c=a.data(Shape.imageFilterId);c=g("#filter_"+c,a[0]);d.length||Shape.creator.removeFilterEffects(c);
for(d=0;d<f.length;d++)g(f[d]).attr("filter","url(#filter_"+a.data(Shape.imageFilterId)+")")}else{e=Math.uuid();a.data(Shape.imageFilterId,e);a.data("imageFilterCreated",true);c.isStaticShape?Shape.creator.createFilterElement(a,Shape.imageFilterId,{width:"120%",height:"120%"}):Shape.creator.createFilterElement(a,Shape.imageFilterId);for(d=0;d<f.length;d++)g(f[d]).attr("filter","url(#filter_"+e+")");c=g("#filter_"+e,a[0])}return c},setBilevel:function(a,c){var d=g(".bilevelFunction",a),e={tableValues:"0 0 1 1"};
if(c===0.75)e={tableValues:"0 0 0 1"};else if(c===0.25)e={tableValues:"0 1 1 1"};g.each(d,function(f,j){Shape.creator.set(g(j),e)})},setGrayScale:function(a){var c=g(".imageRecolorIn",a);Shape.creator.set(c,{values:"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 1 0"});a=g(".imageRecolorOut",a);Shape.creator.set(a,{values:"0.33 0.33 0.33 0 0  0.33 0.33 0.33 0 0  0.33 0.33 0.33 0 0  0 0 0 1 0"})},setLuminance:function(a,c,d){var e;e=g(".imageRecolorOut",a).length?"result_recolor":"SourceGraphic";var f;if(c!==
0){Shape.creator.createFilter_brightness(a,e);e="brightnessOut";f=g(".brightnessFilter",a);if(c===1)c={values:"0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 1 0"};else{if(c<0)c=1+c;else{c*=100;c=1.81739*Math.pow(10,-21)*Math.pow(c,13)-1.08005*Math.pow(10,-18)*Math.pow(c,12)+2.89312*Math.pow(10,-16)*Math.pow(c,11)-4.61016*Math.pow(10,-14)*Math.pow(c,10)+4.85753*Math.pow(10,-12)*Math.pow(c,9)-3.55736*Math.pow(10,-10)*Math.pow(c,8)+1.85191*Math.pow(10,-8)*Math.pow(c,7)-6.88383*Math.pow(10,-7)*Math.pow(c,6)+1.80646E-5*
Math.pow(c,5)-3.24773E-4*Math.pow(c,4)+0.0037737*Math.pow(c,3)-0.0250879*Math.pow(c,2)+0.0820697*c+1}c={values:c+" 0 0 0 0  0 "+c+" 0 0 0  0 0 "+c+" 0 0  0 0 0 1 0"}}Shape.creator.set(f,c)}if(d!==0){Shape.creator.createFilter_contrast(a,e);var j;if(d>=0){e=0.01/(1-d);d*=50;f=100-d;for(var i=[],k=0;k<=100;k+=1)if(k<=d)i.push(0);else if(k>=f)i.push(1);else{c=((k-d)*e).toFixed(2);i.push(c)}}else{d*=-1;d*=0.5;i=[];i.push(d);i.push(0.5);i.push(1-d)}j=i.join(" ");a=g(".colorFunction",a);g.each(a,function(n,
o){o.setAttribute("tableValues",j)})}},setDuotone:function(a,c,d,e){var f=g(".imageRecolorIn",a);Shape.creator.set(f,{values:"0.33 0.33 0.33 0 0  0.33 0.33 0.33 0 0  0.33 0.33 0.33 0 0  0 0 0 1 0"});a=g(".imageRecolorOut",a);c=Shape.imageElement.getDuotone(c,d,e);Shape.creator.set(a,c)},getDuotone:function(a,c,d){return{values:Math.round((c[0]/255-a[0]/255)*100)/100+" 0 0 0 "+Math.round(a[0]/255*100)/100+"  0 "+Math.round((c[1]/255-a[1]/255)*100)/100+" 0 0 "+Math.round(a[1]/255*100)/100+"  0 0 "+
Math.round((c[2]/255-a[2]/255)*100)/100+" 0 "+Math.round(a[2]/255*100)/100+"  0 0 0 "+(d?d:1)+" 0"}},none:function(a,c){return[a[c],a[c+1],a[c+2]]},colorChange:function(a,c){a[c+3]=0;return[a[c],a[c+1],a[c+2],a[c+3]]},fill:function(a,c,d,e){var f=d&&d.url?d.url:a.value.url;if(a.storeCanvas)f=a.url?a.url.url:f;d=g("#"+(e?e:"shapegroup"),c);g.each(d,function(j,i){var k=g("path",i);g.each(k,function(n,o){o=g(o);SVGFill.pict.image(c,o,f,a.props,i)})})},updateImageData:function(a,c,d,e){var f=d&&d.url?
d.url:a.value.url;if(a.storeCanvas)f=a.url?a.url.url:f;g("#"+e,c);a=g(".pattern",c);a=g("#image",a);a.length&&g.each(a,function(j,i){SVGFill.pict.href(i,f,true)})}}})(jQuery);(function(g){SVGFill={solid:{rgb:function(a,c,d,e,f){SVGCreator.updateFillId(f,d);SVGCreator.set(d,{fill:c})},tweaks:function(a,c,d){a={"fill-opacity":1};if(!c.alpha)c.alpha=0;a["fill-opacity"]=1-c.alpha;SVGCreator.set(d,a)}},none:function(a,c,d,e){SVGCreator.updateFillId(e,a);SVGCreator.set(a,{fill:"none"})},gradient:{stops:function(a,c,d,e){this.solid.tweaks.call(this,d,{alpha:0},d,e);g.each(c,function(f,j){var i=SVGCreator.getStopElement(a,f);SVGCreator.set(i,{"stop-color":j.color.rgb,offset:j.position});
SVGCreator.set(i,{"stop-opacity":1-(j.color.tweaks?j.color.tweaks.alpha?j.color.tweaks.alpha:0:0)})});d=g(a).find("*");c.length<d.length&&SVGCreator.removeStops(a,c)},rotate:function(a,c,d,e,f,j,i){d=this.gradient[j];d.rotate&&d.rotate(a,c,f,i)},linear:{rotate:function(a,c,d,e){var f=d.transform.dim,j={left:0,right:0,top:0,bottom:0},i=d.fill&&d.fill.gradient?d.fill.gradient:undefined,k=j;if(i)k=i.offset?i.offset:j;if(d.offset&&e)k=d.offset;var n=VectorUtil.getViewBoxDimensions(f.width,f.height);f=
n;var o=k.left*n[0]*-1,r=k.top*n[1]*-1;n=[((k.left+k.right)*-1+1)*n[0],((k.top+k.bottom)*-1+1)*n[1]];j=n[0]*0.5-o;i=n[1]*0.5-r;var s=0,t=0,p=0,q=0;if(n[0]>n[1])if(c>=0&&c<=45||c>315&&c<=360){q=Math.abs((c-360)*(i/45));s=0;t=n[0];p=q}else if(c>45&&c<=135){q=Math.abs((c-90)*((j-i)/45));t=s=0;p=-q;q=n[1]+q;c-=90}else if(c>135&&c<=225){q=Math.abs((c-180)*(j/45));s=0;t=n[0];p=q}else{if(c>225&&c<=315){q=Math.abs((c-270)*((j-i)/45));s=t=0;p=n[1]+q;q=-q;c-=270}}else if(c>=0&&c<=45){q=Math.abs(c*((j-i)/45));
s=-q;t=n[0]+q;p=q=0}else if(c>315&&c<=360){q=Math.abs((c-360)*((j-i)/45));s=-q;t=n[0]+q;p=q=0}else if(c>45&&c<=135){q=Math.abs((c-90)*(j/45));s=n[0]+q;t=-q;q=p=0;c-=180}else if(c>135&&c<=225){q=Math.abs((c-180)*(j/45));s=-q;t=n[0]+q;p=q=0;c-=360}else if(c>225&&c<=315){q=Math.abs((c-270)*(j-i)/45);s=-q;t=n[0]+q;p=q=0}s-=o;p-=r;t-=o;q-=r;n=k.rotate?k.rotate:0;o=f[0]*0.5;r=f[1]*0.5;var y=d.transform.fliph,z=d.transform.flipv,B=1;B=1;var u=B=0;if(k.isGroupshape){if(k.fliph)y=y?false:true;if(k.flipv)z=
z?false:true;if(y&&!z||!y&&z)n=-n}if(d.offset&&e){c-=n;if(y&&!z||!y&&z)n=-n}B=y?f[0]:0;u=z?f[1]:0;SVGCreator.set(a,{x1:s,y1:p,x2:t,y2:q,gradientTransform:"rotate("+n+","+o+","+r+")translate("+B+" "+u+") scale("+(y?-1:1)+" "+(z?-1:1)+")rotate("+c+","+j+","+i+")"})}},radial:function(a,c,d,e,f){d={left:0,right:0,top:0,bottom:0};var j=c.fillToRect,i=c.tileRect;c=c.offset?c.offset:d;j=g.extend(true,{},d,j);i=g.extend(true,{},d,i);d=c.rotate?c.rotate:0;e=VectorUtil.getViewBoxDimensions(f.transform.dim.width,
f.transform.dim.height);var k=((c.left+c.right)*-1+1)*e[0],n=((c.top+c.bottom)*-1+1)*e[1],o=Math.abs(k*i.left*-1+k+k*i.right*-1);i=Math.abs(n*i.top*-1+n+n*i.bottom*-1);k=j.left*k-c.left*-1*e[0];j=j.top*n-c.top*-1*e[1];n=f.transform.fliph;f=f.transform.flipv;var r=1,s=1,t=0,p=0;if(c.isGroupshape){if(c.fliph)n=n?false:true;if(c.flipv)f=f?false:true;r=n?-1:1;s=f?-1:1;t=n?e[0]:0;p=f?e[1]:0;if(n&&!f||!n&&f)d=-d}radius=Math.sqrt(Math.pow(o*0.5,2)+Math.pow(i*0.5,2));SVGCreator.set(a,{cx:k,cy:j,r:radius,
gradientTransform:"rotate("+d+","+e[0]*0.5+","+e[1]*0.5+")translate("+t+" "+p+")scale("+r+" "+s+")"})}},pict:{value:function(a,c){this.pict.href(SVGCreator.getImageElement(a),c.url)},props:function(a,c,d,e,f,j){a=SVGCreator.getImageElement(a);e=f.fill.pict.value;SVGImage.getImageURL(c,e.serverUrl?e.serverUrl:e.url,f,{ele:a,fn:this.pict._props},j);typeof c.alpha!="undefined"&&SVGImage.setAlpha(undefined,c.alpha,undefined,d)},_props:function(a,c){this.pict.href(c,a)},frame:function(a,c,d,e){d=SVGCreator.getImageElement(a);
var f=VectorUtil.getViewBoxDimensions(e.transform.dim.width,e.transform.dim.height),j=f[0]*(1-(c.left+c.right)),i=f[1]*(1-(c.top+c.bottom)),k=c.left*f[0],n=c.top*f[1],o=e.transform.fliph;e=e.transform.flipv;var r=1,s=1,t=0,p=0,q=c.rotate?c.rotate:0;if(c.isGroupshape){if(c.fliph)o=o?false:true;if(c.flipv)e=e?false:true;r=o?-1:1;s=e?-1:1;t=o?f[0]:0;p=e?f[1]:0;if(o&&!e||!o&&e)q=-q}SVGCreator.set(a,{width:(j>f[0]?j:f[0])+Math.abs(k),height:(i>f[1]?i:f[1])+Math.abs(n),x:k,y:n,patternTransform:"rotate("+
q+","+f[0]*0.5+","+f[1]*0.5+")translate("+t+" "+p+")scale("+r+" "+s+")"});SVGCreator.set(d,{width:j,height:i})},tile:function(a,c,d,e){d=VectorUtil.getViewBoxDimensions(e.transform.dim.width,e.transform.dim.height);var f=(c.left?c.left:0)*d[0]+c.offsetX,j=(c.top?c.top:0)*d[1]+c.offsetY,i=c.rotate?c.rotate:0,k=e.transform.fliph,n=e.transform.flipv,o=e=1,r=0,s=0;if(c.isGroupshape){if(c.fliph)k=k?false:true;if(c.flipv)n=n?false:true;e=k?-1:1;o=n?-1:1;r=k?d[0]:0;s=n?d[1]:0;if(k&&!n||!k&&n)i=-i}k=SVGCreator.getImageElement(a);
SVGCreator.set(a,{x:VectorUtil.getViewBoxDimensions(f),y:VectorUtil.getViewBoxDimensions(j),width:c.scale.x,height:c.scale.y,patternTransform:"rotate("+i+","+d[0]*0.5+","+d[1]*0.5+")translate("+r+" "+s+")scale("+e+" "+o+")"});SVGCreator.set(k,{width:c.scale.x,height:c.scale.y})},image:function(a,c,d,e,f,j){j=j?j:{pos:{left:0,top:0},dim:e.transform.dim};e=undefined;if(Shape.iOSDevice&&!Shape.iOSSVGImageFillSupport){a=SVGCreator.getImageElement(f);this.href(a,d);g(a).insertAfter(c)}else{e=SVGCreator.fillElement(c,
a,"pattern","pattern");a=SVGCreator.getImageElement(e);e=g(e);this.href(a,d)}this.transform(g(a),e,j)},href:function(a,c){VectorUtil.getImageDim(c,this.retryFn,{retries:0,getOnlyImageStatus:true,srcUrl:c,imageEle:a})},retryFn:function(a,c){var d=SVGFill.pict;c.retries+=1;if(c&&c.imageLoaded)c.imageEle.setAttributeNS(SVGCreator.Xlink,"href",c.srcUrl);else c&&c.retries<3&&VectorUtil.getImageDim(c.srcUrl,d.retryFn,c)},transform:function(a,c,d){var e=d.pos;d=d.dim;d=VectorUtil.getViewBoxDimensions(d.width,
d.height);c&&c.length&&SVGCreator.set(c,{x:0,y:0,width:d[0],height:d[1]});a&&a.length&&SVGCreator.set(a,{x:e.left,y:e.top,width:d[0],height:d[1]})}}}})(jQuery);(function(g){SVGStroke={type:function(a,c,d,e){c=g.Stroke.type[0][a].split(",");d="";d=c=g.map(c,function(f){v=f*e;return v=VectorUtil.getViewBoxDimensions(v)});if(a==g.ShapeConstants.StrokeType.SOLID)d="none";return{"stroke-dasharray":d}},captype:function(a){a=g.Stroke.captype[a];if(a=="FLAT")a="BUTT";return{"stroke-linecap":a}},jointype:function(a){return{"stroke-linejoin":a}},width:function(a){a=VectorUtil.getViewBoxDimensions(a);return{"stroke-width":a}},solid:{rgb:function(a,c,d,e,f,j){c={stroke:c};
Shape.creator.set(a,c);j&&j.type==g.ShapeConstants.ShapeNodeType.CONNECTOR&&this.marker.colour(a,c,f,j)},tweaks:function(a,c,d,e,f,j){d={"stroke-opacity":1};if(c.alpha)d["stroke-opacity"]=1-c.alpha;if(j&&j.type==g.ShapeConstants.ShapeNodeType.CONNECTOR){a=a.closest("#root");Shape.creator.set(a,{opacity:d["stroke-opacity"]})}else Shape.creator.set(e,d)}},none:function(a,c,d,e){c={stroke:"none"};Shape.creator.set(a,c);e&&e.type==g.ShapeConstants.ShapeNodeType.CONNECTOR&&this.marker.colour(a,c,d,e)},
headend:function(a,c,d,e){if(Shape.creator.get(c,"class").indexOf("selector")==-1){d=e.props.geom.type;var f,j,i;if(d=="CUSTOM"){j=e.props.geom.custom;f="CUSTOM"}else i=e.props.geom.preset.modifiers;d=e.props.geom[d.toLowerCase()].type;e=e.props;var k=VectorUtil.convertRGBToString(e.stroke.fill.solid.color.rgb),n=VectorUtil.getViewBoxDimensions(e.stroke.width);this.marker.changeMarker("headend",a,c,{dim:[e.transform.dim.width,e.transform.dim.height],captype:e.stroke.captype,tailend:e.stroke.tailend,
headend:a,path:c,color:k,modifier:i,shapeType:d,strokeWidth:n,custom:j,geom:f})}},tailend:function(a,c,d,e){if(Shape.creator.get(c,"class").indexOf("selector")==-1){d=e.props.geom.type;var f,j,i;if(d=="CUSTOM"){j=e.props.geom.custom;f="CUSTOM"}else i=e.props.geom.preset.modifiers;d=e.props.geom[d.toLowerCase()].type;e=e.props;var k=VectorUtil.convertRGBToString(e.stroke.fill.solid.color.rgb),n=VectorUtil.getViewBoxDimensions(e.stroke.width);this.marker.changeMarker("tailend",a,c,{dim:[e.transform.dim.width,
e.transform.dim.height],captype:e.stroke.captype,tailend:a,headend:e.stroke.headend,path:c,color:k,modifier:i,shapeType:d,strokeWidth:n,custom:j,geom:f})}},marker:{tailend:{id:"marker-end"},headend:{id:"marker-start"},M:{dividend:2,name:"M"},L:{dividend:2,name:"L"},C:{dividend:6,name:"C"},colour:function(a,c,d,e){if(Shape.creator.get(a,"class").indexOf("selector")==-1)(a=a.data(Shape.creator.markerId))&&g.each(a,function(f,j){if(e.props.stroke[f]){var i=g("#"+j,d),k=g("path",i),n=e.props.stroke[f].type;
if(n!=g.ShapeConstants.MarkerType.OPEN)c={fill:c.stroke};if(n==g.ShapeConstants.MarkerType.OVAL)k=g("ellipse",i);k.length&&Shape.creator.set(k,c)}})},createMarkerPath:function(a){var c=Shape.creator.createElement(a,"path");Shape.creator.set(g(c),{id:"path",stroke:"none"});g(a).append(c);return g(c)},changeMarker:function(a,c,d,e){var f=c.type,j=Shape.creator.markerElement(d,a);if(j.length!=0){if(f!=g.ShapeConstants.MarkerType.NONE){var i=g.Stroke.marker[0][c.width],k=g.Stroke.marker[0][c.height],
n=f!=g.ShapeConstants.MarkerType.OPEN?0:this.getMiterLength(k,i);c=g("path",j);if(f!=g.ShapeConstants.MarkerType.OVAL){var o=g("ellipse",j);o.length&&o.remove();if(c.length==0)c=this.createMarkerPath(j);a=Shape.pathGenerator.getMarkerPath(a,f,k,i,n);Shape.creator.set(c,f!=g.ShapeConstants.MarkerType.OPEN?{d:a,fill:e.color,stroke:"none"}:{d:a,stroke:e.color,fill:"none","stroke-linecap":"round","stroke-miterlimit":50})}else{o=Shape.creator.createElement(j,"ellipse");g(j).append(o);c.remove();Shape.creator.set(o,
{cx:k*0.5,cy:i*0.5,rx:(k-2)*0.5,ry:(i-2)*0.5,fill:e.color,stroke:"none"})}}else g(j).remove();this.changeLinePath(d,e)}},getMiterLength:function(a,c){return 1/(2*Math.sin(Math.atan2((c-2)*0.5,a-2)))},changeLinePath:function(a,c){var d=c.dim;if(c.geom!="CUSTOM")var e=Shape.pathGenerator.getPathPoints(c.shapeType,c.modifier,d[0],d[1]);else{e={};e.path=[];val1=Shape.pathGenerator.getCustomPathPoints(c.custom,d[0],d[1])[0];e.path.push(val1)}var f=this;g.each({m1:"headend",m2:"tailend"},function(j,i){var k=
c[i]?c[i].type:g.ShapeConstants.MarkerType.NONE,n=Shape.pathGenerator.convertToPath(e.path);if(k==g.ShapeConstants.MarkerType.NONE){Shape.creator.set(a,{d:n});g(a).removeAttr(f[i].id);k=g(a).data(Shape.creator.markerId);k[i]=undefined;g(a).data(Shape.creator.markerId,k)}else f.getChangedPoints(g.Stroke.marker[0][c[i].height],g.Stroke.marker[0][c[i].width],e,c.strokeWidth,i,a,k,c)})},lineStart:function(a,c,d,e){for(l=0;l<=a;l++)for(m=1;m<d[l].length;m+=2){if(m==c&&l==a)break;d[l][m]=e.x;d[l][m+1]=
e.y}return d},lineEnd:function(a,c,d,e){var f=false;for(l=d.length-1;l>=0;l--){for(m=d[l].length-2;m>0;m-=2){if(m==c&&l==a){f=true;if(d.length-1<2){d[l][m]=e.x;d[l][m+1]=e.y}break}d[l][m]=e.x;d[l][m+1]=e.y}if(f)break}return d},curveStart:function(a,c,d,e){d[a][1]=e.x;d[a][2]=e.y;d[0][1]=e.x;d[0][2]=e.y;return d},curveEnd:function(a,c,d,e){d[a][d[a].length-2]=e.x;d[a][d[a].length-1]=e.y;d[a][d[a].length-4]=e.x;d[a][d[a].length-3]=e.y;return d},changePath:function(a,c){var d=a.markEle,e=c.reduction,
f=a.marker;if(g(d).length){var j=c.d,i=j.path[0],k=0,n,o,r,s,t,p=f==1?i.length-1:0,q=f==1?i[p][i[p].length-2]:i[p][1],y=f==1?i[p][i[p].length-1]:i[p][2];do{var z=this[i[p][0]].dividend,B=i[p].length;o=r!=undefined?r:f==1?i[p][B-2]:i[p][1];s=t!=undefined?t:f==1?i[p][B-1]:i[p][2];var u=f==1?B-2:1;do{r=i[p][u];t=i[p][u+1];if(i[p][0]=="M")z=this[i[p+1][0]].dividend;else if(i[p][0]=="L"){if(f==1&&u-2<0&&i.length<3){t=i[p-1].length;r=f==1?i[p-1][t-2]:i[p+1][1];t=f==1?i[p-1][t-1]:i[p+1][2]}var G=zoho.math.length(o,
s,r,t),C=Math.sqrt(Math.pow(e,2)-Math.pow(k,2));k+=G;if(k>e){n=zoho.math.getPointAtDistance({start:{x:o,y:s},end:{x:r,y:t}},C);i=f==-1?this.lineStart(p,u,i,n):this.lineEnd(p,u,i,n);break}}else if(i[p][0]=="C"){C=f==1?i[p][u-4]:i[p][u];var D=f==1?i[p][u-3]:i[p][u+1],E=f==1?i[p][u-2]:i[p][u+2],F=f==1?i[p][u-1]:i[p][u+3];r=f==1?i[p][u+1]:i[p][u+4];t=f==1?i[p][u]:i[p][u+5];if(f==1&&u-6<0){t=i[p-1].length;r=i[p-1][t-2];t=i[p-1][t-1]}var A=f==1?1:0,H=f==1?zoho.math.bezierPoint(r,E,C,o,A):zoho.math.bezierPoint(o,
C,E,r,A),I=f==1?zoho.math.bezierPoint(t,F,D,s,A):zoho.math.bezierPoint(s,D,F,t,A);do{Bx=f==1?zoho.math.bezierPoint(r,E,C,o,A):zoho.math.bezierPoint(o,C,E,r,A);By=f==1?zoho.math.bezierPoint(t,F,D,s,A):zoho.math.bezierPoint(s,D,F,t,A);G=zoho.math.length(H,I,Bx,By);k+=G;if(k>e){n=zoho.math.getPointAtDistance({start:{x:Bx,y:By},end:{x:H,y:I}},k-e);i=f==-1?this.curveStart(p,u,i,n):this.curveEnd(p,u,i,n);break}H=Bx;I=By;A-=0.1*f;cond=f==1?A>0:A<1}while(cond)}u-=z*f;o=r;s=t;if(n)break;cnd=f==1?u>0:u<B}while(cnd);
p-=1*f;if(n)break;condition=f==1?p>=0:p<i.length}while(condition);if(k<=e)n={x:0,y:0};w=q-n.x;h=y-n.y;e=Math.atan2(w,h);e=-1*(zoho.math.toDegrees(e)-90);if(f==-1)e-=180;if(e<0)e=360+e;Shape.creator.set(d,{orient:e});return j}},getReducedValue:function(a,c,d,e,f,j,i){c*=0.5;a=parseFloat(a)+i;e=e.toLowerCase();x=this[e].getX(j,d,a,i,f);return{reduction:this[e].reduction(d,a,i,f),refernce:{X:x,Y:c}}},block:{getX:function(a,c,d){return a=="tailend"?1.3:1+(d-0.3-2)},reduction:function(a,c){return a*(c-
2-0.3)}},open:{getX:function(a,c,d,e){return a=="tailend"?d-(e+1):e+1},reduction:function(a,c,d){return a*d}},classic:{getX:function(a,c,d,e,f){return f!=g.ShapeConstants.CapType.FLAT?a=="tailend"?d*0.5-0.5:d*0.5+0.5:d*0.5},reduction:function(a,c,d,e){return e!=g.ShapeConstants.CapType.FLAT?a*(0.5*(c-2)-0.5):a*0.5*(c-2)}},diamond:{getX:function(a,c,d){return a=="tailend"?d*0.5-1:d*0.5+1},reduction:function(a){return a}},oval:{getX:function(a,c,d){return a=="tailend"?d*0.5-1:d*0.5+1},reduction:function(a){return a}},
getChangedPoints:function(a,c,d,e,f,j,i,k){var n={w:a,h:c,type:i},o={};o.d=d;d=i!=g.ShapeConstants.MarkerType.OPEN?0:this.getMiterLength(a,c);RefRed=this.getReducedValue(a,c,e,i,k.captype,f,d);o.reduction=RefRed.reduction;e=RefRed.refernce;o.path=j;if(i=Shape.creator.markerElement(j,f)){Shape.creator.set(i,{refX:e.X,refY:e.Y,markerWidth:a+d,markerHeight:c});n.markEle=i;n.marker=f=="tailend"?1:-1;this.changePath(n,o)}a=Shape.pathGenerator.convertToPath(o.d.path);Shape.creator.set(j,{d:a})}}}})(jQuery);(function(g){SVGEffects={shadow:{position:function(a,c,d,e,f){f=f?f:Shape.shapeId;a=Shape.creator.getTransform(g("#"+f,e)[0],SVGCreator.TranslateConstant);parseInt(a.x);parseInt(c[0]);parseInt(a.y);parseInt(c[1])}},reflection:{alpha:function(a,c,d,e){e.reflectionGroup.css({opacity:e.alpha})},_getReflectionData:function(a,c){var d=c.group,e=c.reflectionGroup,f=c.angle,j=VectorUtil.getShapeDimension(a),i=VectorUtil.getViewBoxDimensions(c.distance),k=VectorUtil.getViewBoxDimensions(c.strokeWidth),n=
0,o=0,r=a.props.transform.rotate?a.props.transform.rotate:0;i+=k/2;o=zoho.math.toRadians(r);n=i*Math.sin(o);o=i*Math.cos(o);zoho.math.toRadians(f);i=zoho.math.getRotatedValue(r,0,0,j[0]/2,j[1]/2);k=zoho.math.getRotatedValue(r,j[0],0,j[0]/2,j[1]/2);var s=zoho.math.getRotatedValue(r,0,j[1],j[0]/2,j[1]/2),t=zoho.math.getRotatedValue(r,j[0],j[1],j[0]/2,j[1]/2);k=SVGEffects.reflection._getDimension([i,k,s,t]);i=k[0].y-k[1].y;j[1]=k[0].y;k={"0":{constant:2*j[0],val:"x"},"90":{constant:2*j[1],val:"y"},"180":{constant:0,
val:"x"},"270":{constant:0,val:"y"}};n=-n;o=k[f].constant+o;val=k[f].val;d=Shape.creator.getTransform(d[0],SVGCreator.TranslateConstant);f=g.extend(true,{},a).props.transform;if(val=="x")f.fliph=!f.fliph;else if(val=="y")f.flipv=!f.flipv;value=f.fliph&&!f.flipv?"x":!f.fliph&&f.flipv?"y":f.fliph&&f.flipv?"both":"none";if(value=="x")flip={sw:"-1",sh:"1"};else if(value=="y")flip={sw:"1",sh:"-1"};else if(value=="both"){flip={sw:"-1",sh:"-1"};translate={x:j[0],y:j[1]}}else{flip={sw:"1",sh:"1"};translate=
{x:0,y:0}}translate={x:n+d.x,y:o-d.y};j=Shape.creator.getCenter(a.props.transform.dim);j.cy+=i;j.angle=360-r;return{reflectionGroup:e,translate:translate,o:j,flip:flip}},distance:function(a,c,d,e){a=SVGEffects.reflection._getReflectionData(a,e,c,d);Shape.creator.setTransform(a.reflectionGroup[0],SVGCreator.RotationConstant,a.o);Shape.creator.setTransform(a.reflectionGroup[0],SVGCreator.TranslateConstant,a.translate);Shape.creator.setTransform(a.reflectionGroup[0],SVGCreator.ScaleConstant,a.flip)},
_getDimension:function(a){a=VectorUtil.getMinAndMax(a);return[a.big,a.small]},position:function(a,c,d,e){c=e.reflectionGroup;var f=e.size,j=e.angle;e=g("#"+Shape.pathId+"0",c);e=Shape.creator.maskElement(e,d,"mask","mask");var i=Shape.creator.get(e,"id");c=g(c).find(".path");g.each(c,function(p,q){Shape.creator.set(q,{mask:"url(#"+i+")"})});c=g.extend(true,{},a);if(c.props.fill&&c.props.fill.gradient)delete c.props.fill.gradient.stops;else{c.props.fill={};c.props.fill.gradient={}}c.props.fill.gradient=
{rotate:(360+(j-(a.props.transform.rotate?a.props.transform.rotate:0)))%360,stops:[{color:{rgb:[255,255,255],tweaks:{alpha:1},type:"CUSTOM"},position:1-f},{color:{rgb:[255,255,255],type:"CUSTOM"},position:0.95}]};f={left:0,right:0,top:0,bottom:0};a.props.offset=a.props.effects&&a.props.effects.groupReflection?a.props.effects.groupReflection.offset:f;f=c.props.fill.gradient;var k=Shape,n=g(e).children(),o=Shape.creator.fillElement(g(n),d,"gradient","linear"),r=VectorUtil.getViewBoxDimensions(a.containerDim.width),
s=VectorUtil.getViewBoxDimensions(a.containerDim.height),t=VectorUtil.getViewBoxDimensions(r,s);j=-1*s;d=t[0]+2*r;s=t[1]+2*s;r=VectorUtil.getHTMLDimension(-1*r);j=VectorUtil.getHTMLDimension(j);Shape.creator.set(g(n),{width:d,height:s,x:r,y:j});Shape.creator.set(g(e),{width:d,height:s,x:r,y:j});k.converter.convert("gradient",c.props.fill.gradient,{});g.each(f,function(p,q){var y=Shape.fillElement.gradient[p];y&&y.call(k.fillElement,o,q,n,n,a.props,"linear",true)})},scale:function(){},blur:function(){}},
blur:{}}})(jQuery);
(function(){VMLPathUtil={clockwiseArc:"wa",anticlockwiseArc:"at",getEndPathString:function(){return"xe"},getEndPath:function(){return["e"]},getClosePath:function(){return["x"]},getEndClosePath:function(){return[this.getEndPathString()]},getNoFill:function(){return["nf"]},getNumber:function(e){if(typeof e=="number")return Math.round(e);return e},getQuadBezier:function(e,a,b,c){return["qb",e,a,b,c,b,c]},getXCurve:function(e,a,b,c,d){var f,g,h,i;if(d){if(c==a){g=a;h=b}else{g=a-(c-a);h=b+(b-e)}f=e;i=
c}else{f=c==a?e:e-(b-e);g=a;h=b;i=c+(c-a)}return this.getCurve(f,g,h,i,e,a,b,c,d)},getYCurve:function(e,a,b,c,d){var f,g,h,i;if(d){if(c==a){f=e;g=c}else{f=e-(b-e);g=c-(a-c)}h=b;i=a}else{if(c==a){f=b;g=a}else{f=b-(e-b);g=a-(c-a)}h=e;i=c}return this.getCurve(f,g,h,i,e,a,b,c,d)},getFiller:function(e,a){return["M",0,0,"L",e,a,"ns","e"]},getEllipseCurve:function(e,a,b,c,d,f,g,h,i,j){h=0;var k=2*e;if(typeof i!="undefined"){h=i;k=i+2*e}e=0;i=2*a;if(typeof j!="undefined"){e=j;i=j+2*a}return this.getCurve(h,
e,k,i,b,c,d,f,g)},getXEllipseCurve:function(e,a,b,c,d,f){return this.getCurve(b,d-a,c,d+a,b,d,c,d,f)},getYEllipseCurve:function(e,a,b,c,d,f,g,h,i){g=d-e;var j=d+e;if(typeof h!="undefined"){g=h;j=g+2*e}e=b;h=c;if(typeof i!="undefined"){e=i;h=i+2*a}return this.getCurve(g,e,j,h,d,b,d,c,f)},getCurve:function(e,a,b,c,d,f,g,h,i){return i?[this.anticlockwiseArc,e,a,b,c,d,f,g,h]:[this.clockwiseArc,e,a,b,c,d,f,g,h]},getEllipse:function(e,a,b,c){return this.getAngleEllipseCurve(e,a,b,c,0,360)},getAngleEllipseCurve:function(e,
a,b,c,d,f){d*=65535;f*=65535;return["al",b,c,e,a,d,f]}}})(jQuery);(function(e){VMLCreator={TextLineSpacing:1.2,getDefaultRoot:function(a){if(a){a=document.createElement("div");a.innerHTML=vectorContent;return a.getElementsByTagName("group")[0]}return document.createElement("v:group")},setRoot:function(a,b,c){if(!b||b<1)b=1;if(!c||c<1)c=1;var d=VectorUtil.getViewBoxDimensions(b,c);d={coordorigin:"0,0",coordsize:d[0]+","+d[1]};e(a).attr(d);e(a).css({width:b,height:c,position:"absolute"});e(a).css({left:0,top:0})},getRoot:function(a,b){return a.find("#"+(!b?"root":
b))},createGroup:function(){},createTextPath:function(){var a=document.createElement("v:textpath");this.set(a,{id:"textpath"});return a},setShapeDimension:function(a,b,c){if(!b||b<1)b=1;if(!c||c<1)c=1;a=a.find("."+Shape.pathId);b=VectorUtil.getViewBoxDimensions(b,c);a.css({width:b[0],height:b[1],position:"relative"});a.attr({coordorigin:"0,0",coordsize:b[0]+","+b[1]})},getAvailableGroups:function(a){return e(".group",a)},createPath:function(){return document.createElement("v:shape")},setPath:function(a,
b){e(a)[0].setAttribute("path",b)},setFill:function(a,b,c){if(b=="none")e(a).attr("filled","false");else{a=this.fillElement(a);b={filled:"true",color:b,opacity:c};e(a).attr(b)}},createFillElement:function(a){var b=document.createElement("v:fill");b.id="fillelement";b.type="solid";b.rotate="t";b.size="1,1";b.position="0,0";e(a).append(b);return e(b)},fillElement:function(a){var b=e(a).find("#fillelement");if(b.length==0)b=this.createFillElement(a);return b},deleteFillElement:function(){},createImageElement:function(a){var b=
document.createElement("v:imagedata");b.id="imageelement";e(a).append(b);return b},getImageElement:function(a){var b=e(a).find("#imageelement");if(b.length==0)b=this.createImageElement(a);return b},createStrokeElement:function(a){var b=document.createElement("v:stroke");b.id="strokeelement";b.type="solid";e(a).append(b);return b},strokeElement:function(a){var b=e(a).find("#strokeelement");if(b.length==0)b=this.createStrokeElement(a);return b},setStroke:function(a,b,c){var d={stroked:"false"},f={joinstyle:"bevel"};
if(b!="none"){c=VectorUtil.getHTMLDimension(c)+"px";d={stroked:"true",strokecolor:b,strokeweight:c};b=this.strokeElement(a);e(b).attr(f)}e(a).attr(d)},createRectangle:function(a,b,c,d,f){a=document.createElement("v:rect");a.style.left=b;a.style.top=c;a.style.width=d;a.style.height=f;return a},createCircle:function(a,b,c,d){a=document.createElement("v:oval");a.style.left=b-d;a.style.top=c-d;a.style.width=d*2;a.style.height=d*2;return a},createLineElement:function(a,b,c,d){var f=document.createElement("v:line");
a={from:a+","+b,to:c+","+d};e(f).attr(a);return f},setRectangle:function(a,b,c,d,f){var g={};if(typeof b!="undefined")g.left=b;if(typeof c!="undefined")g.top=c;if(typeof d!="undefined")g.width=d;if(typeof f!="undefined")g.height=f;a.nodeType||(val=a.css(g))},getRect:function(a,b){var c;if(a.nodeType){if(b=="x")b="left";else if(b=="y")b="top";c=a.style[b]}else c=a.css(b);return c.split("px")[0]},set:function(a,b){e(a).attr(b)},get:function(a,b){return e(a).attr(b)},rotateShape:function(a,b){b.css({rotation:a})},
rotateTextElement:function(a,b){b||(b=Shape.selectedShapeBox[0]);var c=b.find("#textbox");c.length>0&&this.rotateElement(c,a)},rotateElement:function(a,b){a.css({filter:""});a.css({filter:"progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand')"});var c=Shape.convertAngleToRadian(b),d=Math.cos(c);c=Math.sin(c);a.nodeType||(a=a[0]);a.filters.item(0).M11=d;a.filters.item(0).M12=-c;a.filters.item(0).M21=c;a.filters.item(0).M22=d},getRotationAngle:function(a){if(!a)a=Shape.selectedShape;
if(a[0].tagName!="group")a=a.parent();(a=a.css("rotation"))||(a=0);if(typeof a=="string")a=a.split("px")[0];return a},flipShape:function(a,b){a=a.find("."+Shape.pathId);if(b=="none")a.css("flip","");else b=="both"?a.css("flip","x y"):a.css("flip",b)},changeShapeDimension:function(a,b,c,d){this.setRoot(d,c[0],c[1]);this.setShapeDimension(a,c[0],c[1])},adjustViewBox:function(){},createActualPathElement:function(){return document.createElement("v:path")},Marker:function(){},getTextElement:function(a,
b){var c=a.find("#textpath0");if(c[0])c=c[0];else{a.data(Shape.textbox);var d=b.props.dimension;c=this.createShapeElement(a,d.width,d.height);var f=this.createActualPathElement();d="M 0 0 L "+d.width+" 0";e(f).attr({v:d,textpathok:"true"});e(c).append(f);this.set(c,{id:"textpath0","class":"textbox"})}return c},marker:function(){},pathContainer:function(a,b){return a.find("#"+(!b?"root":b))},createShapeElement:function(a,b,c){a=document.createElement("v:shape");b=VectorUtil.getViewBoxDimensions(b,
c);e(a).css({width:b[0],height:b[1],position:"absolute"});return a},createTemplate:function(){return document.createElement("v:shapetype")},getTemplate:function(a,b){var c=e(a).attr("id").split("path")[1];c=e(b).data("pathIds")[c];return e("#"+c,b)},createDefinitions:function(){},createFilterElement:function(){},createGaussianElement:function(){ele.css({filter:"progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand')"})},setShadowOpacity:function(a,b){b*=100;e(a).css({filter:"alpha(opacity="+
b+")"})}}})(jQuery);(function(e){VMLImage={picture:function(a,b,c){var d=a.value,f=d.url,g=a.pictureProps;if(g){g=this.getDuotoneURL(g,d);d.url=g}c=c&&c.groupId?c.groupId:"root";g=e("#"+c,b);e.each(g,function(h,i){var j=e("#path0",i);j[0].filled=false;j=VMLCreator.getImageElement(j);VMLCreator.set(j,{src:a.value.url})});VMLImage.crop(b,a,c);VMLImage.pictureProps(b,a,undefined,c);VectorUtil.getImageDim(a.value.url,undefined,{box:b});d.url=f},getDuotoneURL:function(a,b){var c=b.url;if(b.type===e.ShapeConstants.PictureType.USERDEFINED){var d=
a.colorMode;if(d&&(d.mode===e.ShapeConstants.Mode.DUOTONE||d.mode===e.ShapeConstants.Mode.SEPIA)){var f=[0,0,0],g=[247,229,209];if(d.duotone){f=d.duotone[0].rgb;g=d.duotone[1].rgb}f=f.toString();g=g.toString();c=c+"&applyDuotone=true&color1="+f+"&color2="+g}}return c},crop:function(a,b,c){if(b.crop){b.crop=e.extend(true,{left:0,top:0,bottom:0,right:0},b.crop);var d=a.find("#root")[0];e(d).css({width:b.props.transform.dim.width,height:b.props.transform.dim.height});a=e("#"+c,a);e.each(a,function(f,
g){var h=e("#path0",g);h=VMLCreator.getImageElement(h);VMLCreator.set(h,{cropleft:b.crop.left,croptop:b.crop.top,cropright:b.crop.right,cropbottom:b.crop.bottom})})}},luminance:function(a,b){var c=(b?b:a.pictureProps).luminance,d=c.brightness?c.brightness:0;c=c.contrast?c.contrast:0;c=Shape.pictureProps.getContrast(c);d/=2;return{blacklevel:d,gain:c}},resetImage:function(a,b){this.setImage(b,a,{blacklevel:"0",gain:"1",grayscale:"false",bilevel:"false"})},grayscale:function(){return{grayscale:"true"}},
bilevel:function(){return{bilevel:"true"}},duotone:function(){},sepia:function(){},none:function(){},setImage:function(a,b,c,d){a=e("#"+d,b);e.each(a,function(f,g){var h=e("#path0",g);h=VMLCreator.getImageElement(h);VMLCreator.set(h,c)})},pictureProps:function(a,b,c,d){c=c?c:b.pictureProps;if(!jQuery.isEmptyObject(c)){c=VMLImage.recolorImage(b,c);if(a&&!e.isEmptyObject(c))this.setImage(b,a,c,d);else return c}},recolorImage:function(a){var b=a.pictureProps,c=b.colorMode,d=undefined,f=undefined;if(c){c=
c.mode.toLowerCase();d=this[c].call(this,a)}if(b.luminance)f=this.luminance.call(this,a);return e.extend(true,{},d,f)},fill:function(){}}})(jQuery);(function(e){VMLFill={creator:VMLCreator,image:VMLImage,solid:{rgb:function(a,b,c,d){d[0].filled=true;d[0].fillcolor=b;this.creator.set(a,{type:"solid"})},tweaks:function(a,b,c,d){if(a=this.creator.fillElement(d)){c={opacity:1};if(!b.alpha)b.alpha=0;c.opacity=1-b.alpha;this.creator.set(a,c)}}},none:function(a,b,c){c[0].filled=false;this.creator.set(a,{type:"solid",color:"none"})},gradient:{stops:function(a,b,c,d){this.solid.tweaks.call(this,a,{alpha:0},a,d);d[0].filled=true;this.creator.set(a,{type:"gradient",
color:b[0].color.rgb,color2:b[b.length-1].color.rgb});this.creator.set(a,{opacity:1-(b[0].color.tweaks?b[0].color.tweaks.alpha?b[0].color.tweaks.alpha:0:0)});var f="";e.each(b,function(g,h){if(g!=0&&g!=b.length-1)f=f+h.position*100+"% "+h.color.rgb+","});if(f.length>0){a=a[0];if(typeof a.colors!=="undefined")a.colors.value=f;else a.colors=f}},rotate:function(a,b){this.creator.set(a,{type:"gradient",angle:b<=270?270-b:360-b+270})}},pict:{value:function(a,b,c,d){d[0].filled=true;this.pict.setValue(a,
b.url)},setValue:function(a,b){VMLCreator.set(a,{src:b,angle:0})},props:function(a,b,c,d,f){b=this.image.getDuotoneURL(b,f.fill.pict.value);this.pict.setValue(a,b)},frame:function(a,b,c,d){VectorUtil.getViewBoxDimensions(d.transform.dim.width);VectorUtil.getViewBoxDimensions(d.transform.dim.height);c=b.left*100;d=b.right*100;var f=b.top*100;b=b.bottom*100;this.creator.set(a,{type:"frame",size:"'"+(100-(c+d))/100+","+(100-(f+b))/100+"'",position:"'"+(c-(c+d)/2)/100+","+(f-(f+b)/2)/100+"'"})},tile:function(a,
b,c,d){c=b.scale.x/VectorUtil.getViewBoxDimensions(d.transform.dim.width);var f=b.scale.y/VectorUtil.getViewBoxDimensions(d.transform.dim.height);this.creator.set(a,{type:"tile",size:"'"+c+","+f+"'",position:"'"+b.offsetX/d.transform.dim.width+","+b.offsetY/d.transform.dim.height+"'"})},transparency:function(a,b,c,d){this.solid.tweaks.call(this,a,{alpha:b},a,d)}}}})(jQuery);(function(e){VMLStroke={type:function(a){a=e.Stroke.type[1][a];return{dashstyle:a}},captype:function(a){captype=(captype=e.Stroke.captype)[a];return{endcap:a}},jointype:function(a){return{joinstyle:a}},width:function(a,b){a==0&&Shape.creator.set(b,{stroked:false});a+="px";return{weight:a}},solid:{rgb:function(a,b){Shape.creator.set(a,{stroked:true});Shape.creator.set(a,{color:b})},tweaks:function(a,b,c,d){if(a=Shape.creator.strokeElement(d)){c={opacity:1};if(b.alpha)c.opacity=1-b.alpha;Shape.creator.set(a,
c)}}},none:function(a){Shape.creator.set(a,{stroked:"false"});Shape.creator.set(a,{color:"none"})},headend:function(a,b){var c=this.markerSize("headend",a.width,a.height),d=this.markerType("headend",a.type);e.extend(c,d);d=Shape.creator.strokeElement(b);Shape.creator.set(d,c)},tailend:function(a,b){var c=this.markerSize("tailend",a.width,a.height),d=this.markerType("tailend",a.type);e.extend(c,d);d=Shape.creator.strokeElement(b);Shape.creator.set(d,c)},markerSize:function(a,b,c){if(c==e.ShapeConstants.Size.NARROW)c=
e.Stroke.marker[1][c];else if(c==e.ShapeConstants.Size.WIDE)c=e.Stroke.marker[1][c];return a=="headend"?{startarrowwidth:b,startarrowlength:c}:{endarrowwidth:b,endarrowlength:c}},markerType:function(a,b){return a=="headend"?{startarrow:b}:{endarrow:b}}}})(jQuery);(function(e){VMLEffects={shadow:{position:function(a,b,c,d,f){f=f?f==Shape.shapeId?"root":f:"root";c=parseInt(b[0]);b=parseInt(b[1]);d=e("#"+f,d).position();f=parseInt(d.left)+c;d=parseInt(d.top)+b;a.css({left:f,top:d})}},reflection:{applyFilter:function(a){a.css({filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=100, FinishOpacity=0, Style=1, StartX=0, StartY=0, FinishX=0,  FinishY=100)"})},alpha:function(a,b,c,d){d.reflectionGroup.css({filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity="+
d.alpha*100+" FinishOpacity=0, Style=1, StartX=0, StartY=0, FinishX=0,  FinishY=100)"})},distance:function(a,b,c,d){b=d.reflectionGroup;c=d.angle;var f=d.strokeWidth,g=VectorUtil.getShapeDimension(a),h=0,i=0;i=d.distance+f;f=g[0]*0.5;var j=g[1]*0.5;a=a.props.transform.rotate?a.props.transform.rotate:0;var k=zoho.math.getRotatedValue(a,0,0,f,j),l=zoho.math.getRotatedValue(a,g[0],0,f,j),m=zoho.math.getRotatedValue(a,0,g[1],f,j);g=zoho.math.getRotatedValue(a,g[0],g[1],f,j);g=VMLEffects.reflection._getDimension([k,
l,m,g]);i=g[0].y-g[1].y+i;if(d.shadowTranslate){g=d.shadowTranslate.x;d=d.shadowTranslate.y;if(c==90||c==270)d*=-1;else g*=-1;h+=g;i+=d}b.css({left:h,top:i});b.css({rotation:a})},_getDimension:function(a){a=VectorUtil.getMinAndMax(a);return[a.big,a.small]},position:function(a,b,c,d){b=d.reflectionGroup;c=d.size;d=d.angle;var f="y";if(c<=1)c*=100;b.css({filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity ="+(a.props.effects.reflection.alpha?a.props.effects.reflection.alpha.st*100:100)+" ,FinishOpacity=0, Style=1, StartX=0, StartY=0, FinishX=0,  FinishY="+
c+")"});f={"0":{val:"FinishX",flip:"x"},"90":{val:"FinishY",flip:"y"},"180":{val:"StartX",flip:"x"},"270":{val:"StartY",flip:"y"}}[d].flip;b.css("flip",f)},blur:function(){},scale:function(){}},blur:{}}})(jQuery);
(function(f){ShapeEvent={enableKey:true,IMESupport:true,leftKey:37,rightKey:39,upKey:38,downKey:40,delKey:46,backSpaceKey:46,escKey:27,keyEvent:{},isMac:navigator.userAgent.indexOf("Macintosh")!==-1,isIE:navigator.userAgent.indexOf("MSIE")!==-1||navigator.userAgent.indexOf("Trident")!==-1,isSafari:navigator.userAgent.indexOf("Safari")!==-1&&navigator.userAgent.indexOf("Chrome")===-1,externalShapeObjects:["ph","grid","guide_vertical1","guide_horizontal1"],isValueScaled:undefined,shapeInfo:undefined,
setCustomCursor:function(a){ShapeEvent.cursorTypes.DEFAULT=a;f("body").css("cursor",a)},removeCustomCursor:function(){ShapeEvent.cursorTypes.DEFAULT="default";f("body").css("cursor","default")},EVENTS:{MOUSEDOWN:"mousedown",MOUSEMOVE:"mousemove",MOUSEUP:"mouseup"},enableKeyEvent:function(a){ShapeEvent.enableKey=a},checkIfShapeBBoxes:function(a){var b=undefined;if(a.indexOf(ShapeEditor.idContains.handle)!==-1)b="handle";else if(a.indexOf(ShapeEditor.idContains.rotate)!==-1)b="rotate";else if(a.indexOf(ShapeEditor.idContains.bbox)!==
-1)b="resize";else if(a.indexOf("border")!==-1)b="move";return b},checkLockStatus:function(a,b){var c=false;b="no"+b;if(!f.isEmptyObject(a))c=(c=(c=(c=a.data)?c.nvOProps:false)&&c.nvODProps?c.nvODProps:false)&&c.locks&&c.locks[b]?true:false;return c},setShapeTarget:function(a,b,c){c=c?c:ShapeEventHandler.getTarget(a);b=b?b:ShapeEditor.config.get.shapeContainerId();b=c.closest("#"+b);b=b.closest(ShapeEditor.config.container).length?b:f();var d=c.closest("."+Shape.shapeClass).attr("id");a.isChart=d&&
d.indexOf("chart")!==-1?true:false;if(b.length){d=c.closest("."+Shape.shapeClass,b);var e=c.closest("."+Shape.textBody.paraId,d),g=c.closest("."+Shape.textBody.wordId,e);if(d.length){var i=d.attr("id");if(ShapeEvent.checkIfShapeBBoxes(i)){i=ShapeEditor.bbox.getShapeId(i);d=f("#"+i,b)}}a.shape=d.length?d:undefined;a.para=e.length?e:undefined;a.portion=g.length?g:undefined;a.targetType=a.portion?"portion":a.para?"para":a.shape?"shape":undefined;if(!a.targetType)if(c=c.closest("div").attr("id"))if(ShapeEditor.text&&
c===ShapeEditor.text.editor.textEditingDivId){a.targetType="para";a.para=ShapeEvent.text.to.element.para;a.shape=ShapeEditor.select.shapes[0].box}else if(c==="cursor"){a.targetType="portion";a.portion=ShapeEvent.text.to.element.word;a.para=ShapeEvent.text.to.element.para;a.shape=ShapeEditor.select.shapes[0].box}else if(c.indexOf("crop")!==-1)a.targetType="crop";if(a.para)a.paraNum=ShapeEvent.indexNo(a.para,"para")}},indexNo:function(a,b){var c=a.parent();return(b?c.children("."+b):c.children()).index(a)},
destroy:function(){ShapeEditor.draw.clear();var a=ShapeEditor.config.drawcontainer;ShapeEditor.config.isSupported.text&&ShapeEvent.text.destroy();ShapeEvent.shapeInfo&&ShapeEvent.shapeInfo.remove();ShapeEditor.bbox.shape={bbox:{},handles:{crop:[],shape:[]}};a.unbind(".Shape")},init:function(){ShapeConfig.init();ShapeEvent.isScaled();ShapeEvent.isPosRotated();ShapeEvent.isOffsetParent();ShapeEvent.createToolTipInfo();var a=Shape.isPointerEventSupported,b=ShapeEditor.config.drawcontainer,c=ShapeEditor.config.isSupported.text,
d=ShapeEditor.config.isSupported.shapeEdit;c&&ShapeEvent.text.init();var e=ShapeEditor.config.get.showContextPath();this.cursorTypes={DEFAULTMOVE:"move",CROSSHAIR:"crosshair",DEFAULT:"default",TEXT:"text",HELP:"help",POINTER:"pointer",MOVE:"url("+e+"styles/images/move.cur) 9 9, move",ROTATE:f.browser.msie?"crosshair":"url("+e+"styles/images/rotate1.cur) 9 9, crosshair",ROTATE2:"crosshair",HANDLE:f.browser.msie&&parseInt(f.browser.version)<9?"crosshair":"url("+e+"styles/images/handle.cur), crosshair",
NOTALLOWED:"not-allowed",ERASER:"url("+e+"styles/images/eraser.cur) 9 9, move"};f(document).bind("operations_rendered",function(){if(Shape.testing&&ShapeEditor.select.shapes.length){var j=Test.text.checkThumbnailAndEditor();Shape.log(j)}});f(b)[0].onselectstart=function(){return false};b.attr("tabIndex",-1);if(!Shape.touchDevice){f(b).bind("_bboxremove.Shape",function(j,m){if(ShapeEvent.isMouseDown)setTimeout(function(){ShapeEditor.config.drawcontainer.trigger("_bboxremove",m)},100);else m&&m.bboxes&&
m.bboxes.remove()});f(b).bind("bboxcreate.Shape",function(j,m){var o=ShapeEditor.select.shapes,n=ShapeEvent.checkLockStatus(o[0],"Modify"),q;if(o.length===1&&!n)q=1;q||ShapeEditor.bbox.remove("handle");m.isHandle=q;ShapeEditor.bbox._create(m.data,m.box,m.isHandle)});f(b).bind("bboxmove.Shape",function(j,m){ShapeEditor.bbox._bboxmove(m.data,m.box,m.updateHandleAlone)});f(b).bind("bboxremove.Shape",function(j,m){ShapeEditor.bbox._remove(m.shapeId)})}var g=undefined,i=undefined;b.bind("touchend",function(j){startX=
null;var m=(new Date).getTime(),o=f(this).data("previousTouch")||m+1;o=m-o;clearTimeout(g);clearTimeout(i);i=undefined;j.clientX=j.originalEvent.changedTouches[0].pageX;j.clientY=j.originalEvent.changedTouches[0].pageY;if(o<500&&o>0){ShapeEvent.setShapeTarget(j);if((o=j.word?j.word:j.para?j.para:j.shape?j.shape:undefined)&&o.attr("id")!=="bgshape"){f(b).trigger("doubletap",{ev:j,target:o});j.preventDefault()}}else{f(this).data("previousTouch",m);g=setTimeout(function(n){b.trigger("ztouchend",n);clearTimeout(g)},
500,[j])}f(this).data("previousTouch",m)});f(b).bind("doubletap",function(j,m){ShapeEvent.doubleClick(j,m)});f(b).bind("dblclick.Shape",function(j,m){ShapeEvent.doubleClick(j,m)});f(b).bind("swipeleft",function(){!ShapeEditor.select.shapes.length&&!ShapeEvent.draw.ready()&&f(b).trigger("Shape_swipeleft")});f(b).bind("swiperight",function(){!ShapeEditor.select.shapes.length&&!ShapeEvent.draw.ready()&&f(b).trigger("Shape_swiperight")});var k=0,l=undefined;f(b).bind(ShapeEvent.EVENTS.MOUSEDOWN+".Shape",
function(j,m){if(ShapeEditor.config.isSlideLocked())return false;k++;if(m&&m.tripleClick)j.tripleClick=true;else if(k===1)l=setTimeout(function(){k=0},500);else if(k===3){j.tripleClick=true;clearTimeout(l);k=0}var o=ShapeEventHandler.getTarget(j),n=o.closest("div"),q=n.attr("id"),p=o.attr("id"),r=n.closest("."+Shape.shapeClass),s=ShapeEditor.config.mouse.down(j,o),v=typeof s==="undefined"?false:!s;s=r.data("lock")?true:false;var t=r.hasClass("grouped"),u=ShapeEditor.config.isSupported.text,w=ShapeEditor.config.isSupported.shapeEdit;
ShapeEvent.isMouseDown=true;var E=j.ctrlKey||j.metaKey||j.shiftKey;if(!j.data)j.data={};!s&&ShapeEditor.select.shapes.length&&ShapeEditor.focusEditor();var G=ShapeEditor.config.get.shapeContainerId(),x=o.closest("#"+G);q=q?q:"";j.targetId=p;if(ShapeEvent.image.mouse.isCropFrame(r))ShapeEvent.isMouseDown=false;else if(v=(v=v?v:ShapeEvent.image.mouse.init(j,q,r,n))?v:ShapeEvent.placeHolder.mouse.init(j,p,r,o))ShapeEvent.isMouseDown=false;else{r=ShapeEditor.config.isSupported.draw;v=ShapeEditor.config.isSupported.selection;
if(ShapeEditor.config.isSupported.erase&&ShapeEditor.erase.ready){if(j.which===1||j.which===0)ShapeEditor.erase.shape(o)}else if(r&&ShapeEvent.draw.ready()){if(j.which===1||j.which===0)ShapeEvent.draw.mouse.down(j)}else if(ShapeEditor.config.allowMouseEvent()||x.length)if(u&&ShapeEvent.text.isSameShapeEditable(j,n)){j.data.paraTarget=true;n=ShapeEditor.select.getShapesOfZero();ShapeEvent.text.selectText(n.data,j,o,n.box)}else{var A=false;if(r)if(w)A=p===G||!x.length;else{if(!w&&!u)A=true}else A=false;
if(f.inArray(q,ShapeEvent.externalShapeObjects)!==-1)ShapeEvent.externalShapes.action(j,q,n);else if(A){if(!v){ShapeEvent.isMouseDown=false;return}if(j.which===1||j.which===0){var y;if(v)y=f.extend(true,{},f.ShapeDefault.groupselect);ShapeEditor.draw.preset.down(j,y)}}else if(w||u)if(w&&(mthdName=ShapeEvent.checkIfShapeBBoxes(q))){q=n.data("shapeId");x=ShapeEditor.select.check(q);if(!x&&!n.hasClass("handle")){G=f("#"+q,ShapeEditor.config.container);ShapeEvent.shapeEdit.select(j,G);ShapeEditor.triggerEvent("shape_selected")}else if(x&&
x.shape&&x.shape.parentIds.length){ShapeEvent.isMouseDown=false;return}ShapeEditor[mthdName].down.call(ShapeEditor[mthdName],j,n);u&&!s&&ShapeEditor.text.editor.clear()}else{r=false;G=n=o.closest("."+Shape.shapeClass);v=n.hasClass("cell");A=n.attr("id").indexOf("chart")!==-1?true:false;if(v&&E){ShapeEvent.isMouseDown=false;return}var F=v&&o.attr("id")!=="path0",H;if(A)n=n.closest("."+GraphicFrame.className);else if(p.indexOf(Shape.pathId)!==-1||s||v){if(n.length&&n.data().groupShapeId)for(;n.data().groupShapeId;)n=
f("#"+n.data().groupShapeId,x)}else if(n.length&&n.data().groupShapeId)H=true;if(!n.length){ShapeEvent.isMouseDown=false;return}q=n.attr("id");var z,B;if(ShapeEditor.select.shapes[0]&&ShapeEditor.select.shapes[0].parentIds.length){x=ShapeEditor.select.shapes[0].parentIds;if(x[x.length-1]===q){n=G;q=n.attr("id");z=true}else B=true}x=ShapeEditor.select.check(q,true);if(u&&!s)if(v)r=true;else if(!A&&!Shape.touchDevice&&f("#"+Shape.textBody.textContainer,n).length)r=ShapeEvent.text.edit(j,p);p=(x||z)&&
(E||r);B=B&&E;if(!A&&j.which!==3&&t&&x||z){j.isInnerShape=true;j.isInnerShapeSelected=z}if(!x&&!z){y=ShapeEvent.shapeEdit.select(j,n,H);if(!y){ShapeEvent.isMouseDown=false;return}ShapeEditor.triggerEvent("shape_selected")}if(r&&!s&&!(ShapeEditor.select.shapes.length>1&&E)){y=y?y:x.shape.data;if(ShapeEditor.select.shapes.length>1){f.each(ShapeEditor.select.shapes,function(C,D){var I=D.data.nvOProps.nvDProps.id;I!==q&&ShapeEditor.bbox.remove(I)});ShapeEditor.select.clear("wait");ShapeEditor.select.init(n,
y);ShapeEditor.triggerEvent("shape_selected")}if(v){if(x.isTableCell){ShapeEditor.text.editor.clear();F&&n.data("cellData",{})}ShapeEvent.editTableCell(G,n,y,j,o)}else ShapeEvent.text.selectText(y,j,o,n)}else if(ShapeEditor.pictureProps.setTransparentColor)ShapeEditor.pictureProps.transparentColor(j);else if(w){j.data.unSelectShape=p;j.data.unSelectInnerShape=B;ShapeEditor.move.down(j,n)}}}ShapeEvent.isMouseDown=false;o.closest("embed")||j.preventDefault()}});if(a){f(b).bind("mouseover.Shape",ShapeEvent.mouseOp);
f(b).bind("mouseout.Shape",ShapeEvent.mouseOut)}else f(b).bind("mousemove.Shape",ShapeEvent.mouseOp);f(b).bind("contextmenu.Shape",ShapeEvent.contextMenu);f(b).bind("focus.Shape",function(j){ShapeEditor.config.drawcontainer.trigger("editorFocused",{id:ShapeEditor.config.drawcontainer.attr("id")});ShapeEditor.editorOnFocus();j.stopPropagation()});ShapeEvent.IMESupport||f(b).bind("blur.Shape",function(){ShapeEditor.editorOnBlur()});VectorUtil.supportsSvg()||f(document).bind("selectstart.Shape",ShapeEvent.stop);
f(b).bind("keypress.Shape",function(j){c&&ShapeEvent.text.key.press(j)});f(b).bind("keydown.Shape",function(j){var m=j.keyCode?j.keyCode:j.charCode,o=ShapeEditor.config.isSlideLocked();if(ShapeEditor.editing&&(m===27||m===13))ShapeEvent.shapeEdit.key.down(j,m);else if(ShapeEvent.enableKey&&ShapeEditor.select.shapes.length){var n;if(c&&!o){ShapeEvent.text.key.IMEKeyDown(j,m);(n=ShapeEvent.text.editing())&&ShapeEvent.text.key.down(j,m)}if(d&&!n){ShapeEvent.keyEvent=f.extend(true,{},j);ShapeEvent.shapeEdit.key.down(j,
m)}}});f(b).bind("keyup.Shape",function(){ShapeEvent.keyEvent={}})},mouseOut:function(){if(!ShapeEditor.editing){ShapeEditor.cursorType=ShapeEvent.cursorTypes.DEFAULT;f("body").css({cursor:ShapeEditor.cursorType})}},contextMenu:function(a){var b=ShapeEventHandler.getTarget(a);ShapeEditor.config.eventTrigger.rightClick(a,b)},stop:function(a){if(ShapeEditor.isEditorOnFocus()){a.stopPropagation();a.preventDefault()}},mouseOp:function(a){var b=ShapeEditor.config.isSlideLocked(),c=ShapeEvent.cursorTypes.DEFAULT,
d=ShapeEventHandler.getTarget(a),e=Shape.creator.get(d,"class"),g=d.closest("div"),i=g.closest("."+Shape.shapeClass),k=g.attr("id"),l=ShapeEditor.config.container,j=i.attr("id");if(j&&i.data("editData")){var m=ShapeEditor.config.get.shape(j),o=i.hasClass("showing");m&&!b&&!o&&Shape.create.editData.icon.show(m,l,i)}else{f(".placeholdereditbutton",l).stop().hide(0,function(){});f(".showing",l).removeClass("showing")}if(j&&f("#ccImageIcon",g).length){f(".ccIconsShow",l).stop().hide();f("#ccImageIcon",
g).show()}else f(".ccIconsShow",l).stop().hide();l=ShapeEditor.config.isSupported;j=l.draw;m=l.connector;var n;if(l.erase&&ShapeEditor.erase.ready)c=ShapeEvent.cursorTypes.ERASER;else if(j&&(n=ShapeEvent.draw.ready())&&!i.data("lock")&&!b){c=ShapeEditor.draw.cursor?ShapeEditor.draw.cursor:ShapeEvent.cursorTypes.CROSSHAIR;m&&n.shapeType===f.ShapeConstants.ShapeNodeType.CONNECTOR&&ShapeEvent.connector.mouse.move(a,k,g)}else if(ShapeEditor.pictureProps.setTransparentColor&&!b){c=ShapeEvent.cursorTypes.HANDLE;
if(i.attr("id")===ShapeEditor.select.shapes[0].data.nvOProps.nvDProps.id)c=ShapeEvent.cursorTypes.POINTER}else if(!b){b=d.closest("#"+ShapeEditor.config.get.shapeContainerId());if(f.inArray(k,ShapeEvent.externalShapeObjects)!==-1)c=ShapeEvent.externalShapes.cursor(a,k);else if(b.length)c=ShapeEvent.getCursorType(a,d,e,k,i,g)}f("body").css({cursor:c});ShapeEditor.cursorType=c},getCursorType:function(a,b,c,d,e,g){var i;b=ShapeEventHandler.getTarget(a);c||(c=Shape.creator.get(b,"class"));var k=ShapeEditor.select.shapes[0],
l=ShapeEditor.config.isSupported.text;if(k&&k.parentIds.length)if(l&&ShapeEvent.text.textTarget(a,d))return e.data("lock")?ShapeEvent.cursorTypes.DEFAULT:ShapeEvent.cursorTypes.TEXT;else if(g.data("shapeId")===k.data.nvOProps.nvDProps.id)return ShapeEvent.cursorTypes.NOTALLOWED;if(j&&c&&c.indexOf("cell")!==-1)return ShapeEvent.cursorTypes.TEXT;if(k&&k.data.nvOProps.nvDProps.id==="groupselect")return(e=f.isFunction(ShapeEditor.config.checkGroupShapeLockStatus)?ShapeEditor.config.checkGroupShapeLockStatus(e.data(Shape.groupShapeId),
"Modify"):false)?ShapeEvent.cursorTypes.NOTALLOWED:ShapeEvent.cursorTypes.DEFAULT;else if(ShapeEditor.editing)return e.data("lock")?ShapeEvent.cursorTypes.NOTALLOWED:ShapeEvent.cursorTypes.CROSSHAIR;var j=ShapeEditor.config.isSupported.shapeEdit;g=ShapeEditor.config.isSupported.connector;b=b.attr("id");if(l&&b===Shape.textBody.bullet)i=(e=f.isFunction(ShapeEditor.config.checkGroupShapeLockStatus)?ShapeEditor.config.checkGroupShapeLockStatus(e.data(Shape.groupShapeId),"Modify"):false)?ShapeEvent.cursorTypes.DEFAULT:
ShapeEvent.cursorTypes.DEFAULTMOVE;else if(l&&ShapeEvent.text.textTarget(a,d))i=e.data("lock")?ShapeEvent.cursorTypes.DEFAULT:ShapeEvent.cursorTypes.TEXT;else if(j&&c&&c.indexOf(Shape.pathId)!==-1){if(d.indexOf("_")==-1&&e.data("lock"))i=ShapeEvent.cursorTypes.DEFAULT;if(d.indexOf("li")!=-1)i=e.data("lock")?ShapeEvent.cursorTypes.NOTALLOWED:ShapeEvent.cursorTypes.DEFAULT;else if(d.indexOf("handle")!=-1)i=d.indexOf("crop")!==-1&&d.indexOf("handle1")!==-1?e.data("lock")?ShapeEvent.cursorTypes.NOTALLOWED:
ShapeEvent.cursorTypes.DEFAULTMOVE:e.data("lock")?ShapeEvent.cursorTypes.NOTALLOWED:ShapeEvent.cursorTypes.HANDLE;else if(d.indexOf("rotate")!=-1)i=e.data("lock")?ShapeEvent.cursorTypes.NOTALLOWED:ShapeEvent.cursorTypes.ROTATE;else if(d.indexOf("box")!=-1){l=e.data("shapeId");if(l.indexOf("crop"))l=l.split("crop")[0];a=d.split("_")[0];d=ShapeEditor.config.get.shape(l);if(g)if(a.indexOf("connected"))a=a.split("connected")[0];if(d){d=d.props?d:d.groupshape;i=d.props.transform.rotate?d.props.transform.rotate:
0;i=e.data("lock")?ShapeEvent.cursorTypes.NOTALLOWED:ShapeEditor.bbox.cursor(a,i)}}else if(d.indexOf("shape")===-1)if(d.indexOf("border")!==-1){g=f(d,ShapeEditor.config.get.shapeContainer());i=g.data(Shape.groupShapeId)?ShapeEvent.cursorTypes.HELP:e.data("lock")?ShapeEvent.cursorTypes.NOTALLOWED:ShapeEvent.cursorTypes.DEFAULTMOVE}else{i=e.data("lock");i=l&&(ShapeEvent.text.isSameShapeEditable(a)||e.hasClass("cell"))?e.data("lock")?ShapeEvent.cursorTypes.DEFAULT:ShapeEvent.cursorTypes.TEXT:e.length?
i?ShapeEvent.cursorTypes.DEFAULT:ShapeEvent.cursorTypes.DEFAULTMOVE:ShapeEvent.cursorTypes.DEFAULT}}else i=ShapeEvent.cursorTypes.DEFAULT;return i},isScaled:function(){var a=f("<div style = 'position:absolute;left:-100px;top:-100px;width:50px;height:50px;'></div>"),b=f("<div style = 'position:absolute;left:50px;top:50px'>ZohoShow3.o</div>");a.append(b);f(document.body).append(a);VectorUtil.setScale(a,0.5);a.width();var c=b.offset();b.position();a.position();ShapeEvent.isValueScaled=c.left===-75?true:
false;a.remove()},isPosRotated:function(){var a=f("<div style = 'position:absolute;left:-100px;top:-100px;width:50px;height:50px;'></div>"),b=f("<div style = 'position:absolute;left:50px;top:50px'>ZohoShow3.o</div>");a.append(b);f(document.body).append(a);var c=b.offset();VectorUtil.rotateElement(a,{width:50,height:50},1,60);b=b.offset();ShapeEvent.posRotated=true;if(c.left===b.left&&c.top===b.top)ShapeEvent.posRotated=false;a.remove()},isOffsetParent:function(){var a=f("<div class='line'>"),b=f("<span class='word'></span>"),
c=f("<span class='subwords'>Ra</span>"),d=f("<span class='subwords'>m</span>");b.append(c,d);a.append(b);f(document.body).append(a);c=f(d[0].offsetParent);ShapeEvent.offsetParent=true;if(b[0]===c[0])ShapeEvent.offsetParent=false;a.remove()},createToolTipInfo:function(){var a=f("<div id = 'shapeinfo' style='z-index:10000;'></div>");a.css({position:"absolute",left:-1E3,top:-1E3});f(document.body).append(a);ShapeEvent.shapeInfo=a},shapeEdit:{select:function(a,b,c){if(!((a.ctrlKey||a.metaKey||a.shiftKey)&&
!c)||b.hasClass("graphicframe")||ShapeEditor.select.shapes[0]&&ShapeEditor.select.shapes[0].data.type===f.ShapeConstants.ShapeNodeType.GRAPHICFRAME)ShapeEditor.clear("wait");b.data(Shape.groupShapeId);b=ShapeEditor.select.init(b,undefined,c);a=ShapeEditor.select.shapes[b];if(b>0){ShapeEditor.bbox.remove("handle");ShapeEditor.config.isSupported.text&&ShapeEvent.text.editing()&&ShapeEditor.text.editor.clear()}if(ShapeEditor.config.isSupported.shapeEdit){ShapeEditor.bbox.create(a.data,a.box);if(a.parentIds.length){c=
a.parentIds[a.parentIds.length-1];b=ShapeEditor.config.get.shape(c);c=f("#"+c,ShapeEditor.config.container);ShapeEditor.bbox.create(b,c)}}return a.data},key:{down:function(a,b){var c=a.ctrlKey||a.metaKey;if(b===ShapeEvent.leftKey||b===ShapeEvent.rightKey||b===ShapeEvent.upKey||b===ShapeEvent.downKey){var d,e,g=ShapeEditor.select.shapes;if(!(g.length&&g[0].parentIds.length)){var i=ShapeEditor.config.isSlideLocked();f.each(g,function(k,l){var j=ShapeEvent.checkLockStatus(l,"Modify"),m=l.data.type===
f.ShapeConstants.ShapeNodeType.GRAPHICFRAME&&l.data.obj.type==="CHART";if(!a.altKey&&!a.shiftKey&&!j&&!i){e=c?2:4;d=ShapeEditor.move}else if(!a.shiftKey&&a.altKey&&!j&&!i&&!m){e=c?1:15;d=ShapeEditor.rotate}else if(!a.altKey&&a.shiftKey&&!j&&!i&&!m){e=c?0.01:0.09;d=ShapeEditor.resize}d&&!ShapeEditor.crop.cropBox&&ShapeEditor.event.keyEvent(b,e,d);a.stopPropagation();a.preventDefault()})}}else if(b===27){if(ShapeEditor.editing)if(ShapeEditor.draw.genre===f.ShapeConstants.ShapeGeometryType.PRESET)ShapeEditor.draw.escapeDrawing();
else if(ShapeEditor.draw.genre===f.ShapeConstants.ShapeGeometryType.CUSTOM)if(ShapeEditor.draw.custom.shapeType===ShapeEditor.draw.custom.SCRIBBLE)ShapeEditor.draw.escapeDrawing();else{a.data={unbind:"true"};ShapeEditor.draw.custom.stop(a)}else ShapeEditor.clone.remove();else if(ShapeEditor.crop.cropBox){ShapeEditor.crop.refresh();ShapeEditor.crop.cropImage()}else{if(ShapeEditor.select.shapes.length){ShapeEditor.select.init();ShapeEditor.triggerEvent("shape_unselected",[{action:"all"}]);ShapeEditor.bbox.remove()}ShapeEditor.draw.clear()}a.stopPropagation();
a.preventDefault()}else if(b===13){if(ShapeEditor.editing){if(ShapeEditor.draw.genre===f.ShapeConstants.ShapeGeometryType.CUSTOM)if(ShapeEditor.draw.custom.shapeType===ShapeEditor.draw.custom.SCRIBBLE)ShapeEditor.draw.escapeDrawing();else{a.data={unbind:"true"};ShapeEditor.draw.custom.stop(a)}}else ShapeEditor.crop.cropBox&&ShapeEditor.crop.cropImage();a.stopPropagation();a.preventDefault()}}}},draw:{ready:function(){var a=false,b=ShapeEditor.draw.genre;if(b){a=ShapeEditor.draw[b.toLowerCase()].shapeType;
a={genre:b,shapeType:a}}return a},mouse:{down:function(a){var b=ShapeEditor.config.get.shape();b.nvOProps.nvDProps.id=Math.uuid();if(ShapeEditor.draw.genre===f.ShapeConstants.ShapeGeometryType.PRESET){if(ShapeEditor.draw.preset.placeHolderType){b.nvOProps.nvProps={placeHolder:{type:ShapeEditor.draw.preset.placeHolderType}};var c=f.extend(false,{},b.props.fill);if(c.type===f.ShapeConstants.FillType.GRADIENT)f.each(c[c.type.toLowerCase()].stops,function(d,e){e.color.tweaks={alpha:0.6}});else if(c.type===
f.ShapeConstants.FillType.SOLID)c[c.type.toLowerCase()].color.tweaks={alpha:0.6}}ShapeEditor.draw.preset.down(a,b)}else ShapeEditor.draw.genre===f.ShapeConstants.ShapeGeometryType.CUSTOM&&ShapeEditor.draw.custom.down.set(a,b)}}},groupShape:{mouse:{down:{}}},image:{mouse:{init:function(a,b,c,d){var e,g=c.data("shapeId")?c.data("shapeId"):b;if(ShapeEditor.crop.cropBox)if(g.indexOf("crop")===-1){g!==ShapeEditor.crop.instance.actualImage.data.nvOProps.nvDProps.id?ShapeEditor.crop.cropImage():ShapeEvent.image.mouse.crop(a,
b,c,d,"cropImage");e=true}else if(g.indexOf("cropFrame")!==-1){ShapeEvent.image.mouse.crop(a,b,c,d,"cropFrame");e=true}else if(g.indexOf("cropImage")!==-1){ShapeEvent.image.mouse.crop(a,b,c,d,"cropImage");e=true}if(ShapeEditor.pictureProps.setTransparentColor)if(c.attr("id")!==ShapeEditor.select.shapes[0].data.nvOProps.nvDProps.id)ShapeEditor.pictureProps.setTransparentColor=false;return e},isCropFrame:function(a){return a.hasClass(ShapeEditor.crop.CROPFRAME)},crop:function(a,b,c,d,e){c=ShapeEditor.crop.instance;
ShapeEditor.select.init();ShapeEditor.select.init(c[e].box,c[e].data);var g=f.extend(true,{},c[e].data);g.noClone=true;c[e].box.data("shapeData",g);e=[{box:c[e].box,data:g,connector:[]}];e.method={down:ShapeEditor.crop.edit.down,move:ShapeEditor.crop.crop,up:ShapeEditor.crop.edit.up};(mthdName=ShapeEvent.checkIfShapeBBoxes(b))?ShapeEditor[mthdName].down.call(ShapeEditor[mthdName],a,d,e):ShapeEditor.move.down(a,undefined,e)}}},placeHolder:{mouse:{init:function(a,b,c,d){if(b==="placeholderIcon"||b===
"placeholderVideoIcon"||b==="placeholderTwitterIcon"||b==="iconCapsuleEditIcon"){var e=d.data("handler");e&&setTimeout(function(){e.call()})}return false}}},externalShapes:{action:function(a,b,c){if(!(b.indexOf("ph")!==-1||b.indexOf("grid")!==-1))if(b.indexOf("guide")!==-1){b=f.extend(true,{},c.data("shapeData"));b.noClone=true;b=[{box:c,data:b,connector:[]}];b.axis=c.data("axis");ShapeEditor.move.down(a,undefined,b)}},cursor:function(a,b){var c=ShapeEvent.cursorTypes.DEFAULT;if(b.indexOf("guide")!==
-1)c=ShapeEvent.externalShapes.getGuideCursor(b);return c},getGuideCursor:function(a){var b=ShapeEvent.cursorTypes.DEFAULT;if(a.indexOf("horizontal")!==-1)b="s-resize";else if(a.indexOf("vertical")!==-1)b="e-resize";return b}},editTableCell:function(a,b,c,d,e){Table.updateTableStyle(c);c=Table.row.cell._getCell(a,b,c,true);c.isTable=true;b.data("cellData",c);ShapeEditor.triggerEvent("shape_selected");ShapeEditor.text.editor.selection.clear();ShapeEvent.text.selectText(c,d,e,a)},doubleClick:function(a,
b){var c=ShapeEditor.config.isSupported.text,d=ShapeEditor.config.isSlideLocked();if(c&&!d){d=b?b.target?b.target:ShapeEventHandler.getTarget(a):ShapeEventHandler.getTarget(a);var e=d.closest("div"),g=e.closest("."+Shape.shapeClass);if((c=ShapeEditor.select.getShapesOfZero())&&g.length&&!g.data("lock"))if(d.closest("#"+Shape.textBody.textContainer).length&&c&&!(c.data.nvOProps.nvProps&&c.data.nvOProps.nvProps.embed)){d=ShapeEvent.text;if(d._checkEmptyText(a)&&Shape.touchDevice)ShapeEditor.text.editor.select.placeCursor(c);
else{d.setTextTarget(a);if((d=a.targetObj)&&d.word&&d.word.length){e=c.box;d=ShapeEditor.text;g=d.editor.select;g.init(e,c.data);d.composer.init(c.data);c=g.getTargetIndex(a);c=g.getTargetElementFromIndex(c.index);c=g.getCurrentStartEnd(c);ShapeEvent.flipFromTo=false;d.editor.navigation.move(c.word.start,c.word.end,true)}}}else ShapeEditor.config.mouse.doubleClick(c)}},tripleClick:function(){f(ShapeEditor.config.drawcontainer).trigger(ShapeEvent.EVENTS.MOUSEDOWN+".Shape",[{tripleClick:true}])}}})(jQuery);(function(f){ShapeEditor={rad180:3.14159,degree360:360,zeroAngle:0,idContains:{handle:"handle",rotate:"rotate",bgshape:"bgshape",clone:"clone",bbox:"box",crop:"crop",bgshape:"bgshape"},snapWidth:undefined,selectedGroupShape:undefined,cropped:"cropped",textEditing:"textEditing",shapeSelected:"shapeSelected",transparent:"transparent",showSmartGuides:false,containerScaled:function(a){var b=ShapeEditor.config.get.shapeContainer(),c=f(".bbox",b);f.each(ShapeEditor.select.shapes,function(d,e){e.data.scale=
a;c.length?ShapeEditor.bbox.move(e.data,e.box,!ShapeEditor.select.shapes.length):ShapeEditor.bbox.create(e.data,e.box,!ShapeEditor.select.shapes.length)})},triggerEvent:function(a,b,c){if((a==="shape_selected"||a==="shape_unselected")&&ShapeEditor.config.isSupported.shapeEdit)ShapeEditor.config.container.trigger(a,b);else if(a==="shape_created"&&ShapeEditor.config.isSupported.draw)c?f(c).trigger(a,b):ShapeEditor.config.container.trigger(a,b)},containerMoved:function(){ShapeEditor.config.isSupported.text&&
ShapeEditor.text.containerMoved();ShapeEditor.focusEditor()},clear:function(a){a=a?a:"all";var b=ShapeEditor.config.isSupported;ShapeEditor.crop.cropBox&&ShapeEditor.crop.removeCropFrame();ShapeEditor.bbox.remove();ShapeEditor.select.clear(a);b.text&&ShapeEditor.text.editor.clear();b.draw&&ShapeEditor.draw.clear();ShapeEditor.crop.cropBox=false;ShapeEditor.pictureProps.setTransparentColor=false;ShapeEditor.config.container.trigger("shapeeditor_cleared")},selectShape:function(a,b,c){ShapeEditor.focusEditor();
b&&ShapeEditor.clear();a=typeof a==="string"?a:a.nvOProps.nvDProps.id;b=ShapeEditor.config.container;c=c?c:f("#"+a,b);a=ShapeEditor.config.get.shape(a);var d;if(c.length&&c.data().groupShapeId)d=true;if(a){if(a.groupshape)a=a.groupshape;ShapeEditor.select.init(c,a,d);ShapeEditor.triggerEvent("shape_selected");ShapeEditor.bbox.create(a,c)}},unselectShape:function(a){if(a){a=typeof a==="string"?a:a.nvOProps.nvDProps.id;ShapeEditor.bbox.remove(a);ShapeEditor.select.remove(a)}},updateShapeData:function(a){var b=
a.nvOProps.nvDProps.id;f.each(ShapeEditor.select.shapes,function(c,d){if(b===d.data.nvOProps.nvDProps.id)ShapeEditor.select.shapes[c].data=a})},selectAll:function(){ShapeEditor.focusEditor();ShapeEditor.select.init();ShapeEditor.select.clear("wait");ShapeEditor.bbox.remove();var a=ShapeEditor.config.get.shapes.visible();f.each(a,function(b,c){var d=ShapeEditor.config.get.shape(c);if(d.type!==f.ShapeConstants.ShapeNodeType.GRAPHICFRAME){var e=f("#"+c,ShapeEditor.config.get.shapeContainer());ShapeEditor.select.init(e,
d);ShapeEditor.bbox.create(d,e)}});ShapeEditor.select.shapes.length&&ShapeEditor.triggerEvent("shape_selected")},select:{shapes:[],getShapes:function(a,b,c){var d=[];f.each(a,function(e,g){ShapeEvent.checkLockStatus(g,"Modify")||d.push(g)});if((a=b?d:ShapeEditor.select.shapes)&&a.length&&c&&a[0].data.type==="GRAPHICFRAME"){b=ShapeEditor.select.getShapesOfZero();a=[];a[0]=b}return a},getShapesOfZero:function(){var a=ShapeEditor.select.shapes[0];if(a&&a.data.type=="GRAPHICFRAME"){var b=f("#"+a.data.nvOProps.nvDProps.id,
ShapeEditor.config.container),c=b.data("cellData");if(!f.isEmptyObject(c)){b=f("#"+c.nvOProps.nvDProps.id,b);var d={};c.scale=a.data.scale;d.data=c;d.box=b;a=d}}return a},clear:function(a){if(ShapeEditor.select.shapes.length){ShapeEditor.select.init();ShapeEditor.triggerEvent("shape_unselected",[{action:a}])}},init:function(a,b,c){if(a){var d=a.attr("id"),e=[];if(!this.check(d)){b||(b=ShapeEditor.config.get.shape(d));if(c){b=a;if(b.length&&b.data().groupShapeId)for(;b.data().groupShapeId;){b=b.data().groupShapeId;
e.push(b);b=f("#"+b,ShapeEditor.config.container)}b=this.updateInnerShapeData(d,e);b.isInnerShape=true}if(b.type===f.ShapeConstants.ShapeNodeType.GROUPSHAPE)b=b.groupshape?b.groupshape:b;if(b.type===f.ShapeConstants.ShapeNodeType.GRAPHICFRAME&&b.obj.type==="TABLE"){Table.updateTableDimensionData(b,a);b.scale=ShapeEditor.config.get.scale()}d=ShapeEditor.config.isSupported.connector?ShapeEditor.connector.get(a,b):[];this.shapes.push({box:a,data:b,connector:d,parentIds:e})}return this.shapes.length-
1}else if(this.shapes.length){ShapeEditor.config.isSupported.text&&ShapeEditor.text.editor.clear();this.shapes=[]}},updateInnerShapeData:function(a,b){var c=ShapeEditor.config.get.shape(b[b.length-1]);f.GroupShape.updateShapeData(f.GroupShape.props.transform,c,ShapeEditor.config.container,undefined,true);return f.GroupShape.getShape(a,c)},update:function(a,b,c){if(!f.isEmptyObject(a)){var d=a.data.nvOProps.nvDProps.id;b=b?b:ShapeEditor.config.get.shape(d);b=b.groupshape?b.groupshape:b;if(a.parentIds&&
a.parentIds.length)b=this.updateInnerShapeData(d,a.parentIds);var e=f("#"+d,ShapeEditor.config.container);b.type===f.ShapeConstants.ShapeNodeType.GRAPHICFRAME&&b.obj.type==="TABLE"&&Table.updateTableDimensionData(b,e);a.box=e;if(c&&c!==d)ShapeEditor.select.updateGrpShape(a.data,c,b);else{a.data=b;if(b.type===f.ShapeConstants.ShapeNodeType.GRAPHICFRAME&&b.obj.type==="TABLE"&&ShapeEditor.select.getShapesOfZero()&&ShapeEditor.select.getShapesOfZero().data){a=b.obj.table.row.index!==undefined?b.obj.table.row.index:
0;c=b.obj.table.row[a].cell.index!==undefined?b.obj.table.row[a].cell.index:0;Table.updateTableStyle(b);TableEditor.triggerEvent(b,a,c)}}}},updateGrpShape:function(a,b,c){a=a.groupshape?a.groupshape:a;f.each(a.shapes,function(d,e){if(e.nvOProps.nvDProps.id===b){var g=f.extend(true,{},a.shapes[d].props.transform);a.shapes[d]=c;a.shapes[d].props.transform=g;return false}else e.type===f.ShapeConstants.ShapeNodeType.GROUPSHAPE&&ShapeEditor.select.updateGrpShape(e,b,c)})},checkGroupshape:function(a,b,
c){var d=this,e=false;c=c.data?c.data:c;if(c.type===f.ShapeConstants.ShapeNodeType.GROUPSHAPE)if(c.nvOProps.nvDProps.id===b)e={shape:ShapeEditor.select.shapes[a],index:a,grpShape:true};else f.each(c.shapes,function(g,i){i=i.groupshape?i.groupshape:i;if(i.type===f.ShapeConstants.ShapeNodeType.GROUPSHAPE){if(e=d.checkGroupshape(a,b,i))return false}else if(i.nvOProps.nvDProps.id===b){e={shape:ShapeEditor.select.shapes[a],index:a,grpShape:true};return false}});return e},check:function(a,b){var c=this,
d=false;f.each(ShapeEditor.select.shapes,function(e,g){if(g.data.type===f.ShapeConstants.ShapeNodeType.GROUPSHAPE&&!b){if(d=c.checkGroupshape(e,a,g))return false}else if(b&&e==0&&g.data.type===f.ShapeConstants.ShapeNodeType.GRAPHICFRAME&&g.data.obj.type==="TABLE"){var i=ShapeEditor.select.getShapesOfZero();if(i.data.nvOProps.nvDProps.id===a){d={shape:i,index:e,isTableCell:true};return false}}else if(g.data.nvOProps.nvDProps.id===a){d={shape:ShapeEditor.select.shapes[e],index:e};return false}});return d},
remove:function(a){if(a=this.check(a)){var b=ShapeEditor.select.shapes,c=f.extend(true,{},b[a.index].data);b.splice(a.index,1);ShapeEditor.triggerEvent("shape_unselected",[{action:"continue",data:c}]);ShapeEditor.config.isSupported.text&&ShapeEditor.text.editor.clear({remove:true})}}},groupselect:{selectShapes:function(a,b){var c=ShapeEditor.config.get.shapes.all(),d,e,g=a.left+b.width,i=a.top+b.height;f.each(c,function(k,l){var j=ShapeEditor.config.get.shape(l);if(j.groupshape)j=j.groupshape;var m=
j.scale?j.scale:1;f.each(f.BBoxConstant.value,function(n,q){if(q==="corner"){d=ShapeEditor.bbox.getBBoxData(q,j);ShapeEditor.bbox.position(d,j,n);var p=d.props.transform.pos.left*m,r=d.props.transform.pos.top*m;if(p>a.left&&r>a.top&&p<g&&r<i)e=true;else return e=false}});if(j.nvOProps.nvDProps.hidden)e=false;if(e){var o=ShapeEditor.config.get.shapeContainer().find("#"+l);ShapeEditor.select.init(o,j)}});f.each(ShapeEditor.select.shapes,function(k,l){ShapeEditor.bbox.create(l.data,l.box)})}},bbox:{rhandle:20,
handledata:"handledata",handleName:"handle",bboxDim:8,handleDim:9,strokeWidth:1,shape:{bbox:{},handles:{crop:[],shape:[]}},minWidth:27,minHeight:27,clearBBoxes:function(){ShapeEditor.bbox.shape={bbox:{},handles:{crop:[],shape:[]}}},getId:function(a){return a.nvOProps.nvDProps.id},getBBoxType:function(a,b){var c="normal";if(ShapeEditor.select.check(a))c=f("#"+a,ShapeEditor.config.container).data("lock")?"lock":"normal";else if(b)c=ShapeEvent.checkLockStatus({data:b},"Modify")?"lock":"normal";return c},
getLockData:function(a){return ShapeEvent.checkLockStatus({data:a},"Modify")},getConnectorData:function(a,b){return ShapeEditor.connector.updateBBoxId(a,b)},getBBoxByType:function(a,b,c){return ShapeEditor.config.get.shapeContainer().children(".bbox"+a+c).filter("."+b)},getShapeId:function(a){if(typeof a!=="object")a=f("#"+a);return a.data("shapeId")},getBBoxes:function(a){var b=f.extend(true,{},f.BBoxConstant.value),c=f("#"+a.nvOProps.nvDProps.id,ShapeEditor.config.container);if(a.nvOProps.nvODProps&&
a.nvOProps.nvODProps.locks){var d=a.nvOProps.nvODProps.locks;d.noRotation&&f.extend(b,{rotate:"lock"});d.noResize&&f.extend(b,{nbox:"lock",sbox:"lock",ebox:"lock",wbox:"lock",nebox:"lock",nwbox:"lock",sebox:"lock",swbox:"lock"});d.noSelect&&f.extend(b,{nbox:"none",sbox:"none",ebox:"none",wbox:"none",nebox:"none",nwbox:"none",sebox:"none",swbox:"none",rotate:"none",li:"none",border:"lock_border"});d.noModify&&f.extend(b,{rotate:"lock",nbox:"lock",sbox:"lock",ebox:"lock",wbox:"lock",nebox:"lock",nwbox:"lock",
sebox:"lock",swbox:"lock"})}if(c.hasClass("crop")){c.hasClass("crop Frame")&&f.extend(b,{nbox:"cropcenter",sbox:"cropcenter",ebox:"cropmiddle",wbox:"cropmiddle",nebox:"cropcorner",nwbox:"cropcorner",sebox:"cropcorner",swbox:"cropcorner"});delete b.rotate;delete b.border;delete b.li}if(a.isInnerShape)b={border:"lock_border"};if(a.type===f.ShapeConstants.ShapeNodeType.GRAPHICFRAME)b={borderframe:"borderframe"};else{delete b.borderframe;delete b.resizerbox}return b},getBBoxData:function(a,b){var c=f.BBoxConstant[a];
if(c){c=f.extend(true,{},c[c.type.toLowerCase()]);if(a==="lock_border")c.props.stroke.width=3;if(b.fitModeData&&a==="border")c.fitModeData=f.extend(true,{},b.fitModeData);else if(b.fitModeData)c.fitModeData={left:-1*(ShapeEditor.bbox.bboxDim+ShapeEditor.bbox.minWidth),top:-1*(ShapeEditor.bbox.bboxDim+ShapeEditor.bbox.minHeight),width:ShapeEditor.bbox.minWidth+ShapeEditor.bbox.minWidth,height:ShapeEditor.bbox.minHeight+ShapeEditor.bbox.minHeight};c.editable=true;if(c.value){a.indexOf("resizerbox")!==
-1&&this.updateResizerUrl(c);c.type=f.ShapeConstants.ShapeNodeType.PICTURE}else{c.type=f.ShapeConstants.ShapeNodeType.SHAPE;c.selectorStrokeWidth=14}return c}},updateResizerUrl:function(a){a.value.url=serverURL+"/styles/images/resizer.png"},getClassName:function(a){return a!=="border"&&a!=="li"?a+" "+Shape.shapeClass+" scalable":a+" "+Shape.shapeClass},time:undefined,lastSelected:undefined,create:function(a,b){var c=new Date,d=a.nvOProps.nvDProps.id;if(!(this.time&&c-this.time<500&&d===this.lastSelected)){this.time=
c;this.lastSelected=d;f(ShapeEditor.config.drawcontainer).trigger("bboxcreate",{data:a,box:b})}},_create:function(a,b,c){var d=this;d.time=undefined;var e=ShapeEditor.config.get.shapeContainer(),g=this.getBBoxes(a),i=e.children().filter(".bbox"),k=false;if(!i.length){d.clearBBoxes();k=true}var l=ShapeEditor.select.shapes.length>1||ShapeEditor.select.shapes[0]&&ShapeEditor.select.shapes[0].parentIds.length?true:false,j=a.nvOProps.nvDProps.id.indexOf("cropFrame")!==-1?true:false;l=j?true:l;f.each(g,
function(o,n){var q=o,p=d.getClassName(o),r=d.getBBoxData(n,a);if(!r)return true;var s="",v=false,t;t=n.search("lock")!==-1?"lock":"normal";j&&d.transformCropBox(r,o,a);if(ShapeEditor.config.isSupported.connector){if(s=ShapeEditor.bbox.getConnectorData(a,o)){r=s.bboxData;p=p+" "+s.cname;q=o+s.idName}t=(v=ShapeEditor.connector.isBBoxConnected(p))?"connected":t}if(!(d.shape.bbox[o]&&d.shape.bbox[o][t])||l||k){d.update(r,a,q,p,undefined,t);q=Shape.create.draw(r,e);d.updateBBoxData(q,s,a,t);ShapeEditor.bbox.showVisibleBBox(o,
a,q);if(!l){q.data("primaryBBox",true);d.shape.bbox[o]=d.shape.bbox[o]?d.shape.bbox[o]:{};d.shape.bbox[o][t]={data:r,box:q}}}else d._move(o,p,t,a)});c=a.isInnerShape?false:c;if(b&&c){if(!b.data("lock"))var m=b.data(Shape.handle);m&&f.each(m,function(o,n){var q=d.getHandleName(a);if(d.shape.handles.shape[o]){var p=d.shape.handles.shape[o],r=p.box;p=p.data;d.update(p,a,d.handleName+o,d.handleName,undefined,d.handleName);r.attr("id",p.nvOProps.nvDProps.id);r.attr("class",p.className);d.position(p,a,
d.handleName,n);Shape.props.transform.set(p,ShapeEditor.config.container,r);ShapeEditor.bbox.showVisibleBBox(o,a,r);r.data(d.handledata,o)}else{p=d.getBBoxData(q,a);d.update(p,a,d.handleName+o,d.handleName,n,d.handleName);p.editable=true;p.type=f.ShapeConstants.ShapeNodeType.SHAPE;r=Shape.create.draw(p,e);r.addClass("scalable");q==="lock"&&r.data("lock",true);r.data(d.handledata,o);r.data("primaryBBox",true);d.shape.handles.shape[o]={data:p,box:r}}p=a.props.transform.dim;(p.width<d.minWidth||p.height<
d.minHeight)&&a.type!==f.ShapeConstants.ShapeNodeType.CONNECTOR?d.changeAppearance(r,"hide"):d.changeAppearance(r,"visible")})}j&&ShapeEditor.config.container.trigger("cropbox_created");i.show()},_move:function(a,b,c,d){var e=c==="lock"?"normal":"lock",g=this.shape.bbox[a][c],i=g.box;(e=this.shape.bbox[a][e]?this.shape.bbox[a][e]:undefined)&&this.changeAppearance(e.box,"hide");g=g.data;this.update(g,d,a,b,undefined,c);this.updateBBoxData(i,undefined,d,c);i.attr("id",g.nvOProps.nvDProps.id);i.attr("class",
g.className);ShapeEditor.bbox.showVisibleBBox(a,d,i);Shape.props.transform.set(g,ShapeEditor.config.get.shapeContainer(),i)},getHandleName:function(a){var b=this.handleName;if(a.nvOProps.nvODProps&&a.nvOProps.nvODProps.locks&&a.nvOProps.nvODProps.locks.noHandles)b="lock";return b},borderSize:function(a,b){var c=f.extend(true,{},b.props.transform.dim);a.props.transform.dim=c},showVisibleBBox:function(a,b,c){var d={nbox:true,nebox:true,ebox:true,sebox:true,sbox:true,swbox:true,wbox:true,nwbox:true,
rotate:true,li:true,resizerbox:true,borderframe:true,border:true},e=b.props.transform.dim;if(e.width*b.scale<this.minWidth){d.nbox=false;d.sbox=false;d.li=false;d.rotate=false}if(e.height*b.scale<this.minHeight){d.ebox=false;d.wbox=false}if(b.type===f.ShapeConstants.ShapeNodeType.CONNECTOR){var g,i;if(b.props.transform){g=b.props.transform.fliph;i=b.props.transform.flipv}d=g&&i?{nbox:false,nebox:false,ebox:false,sebox:true,sbox:false,swbox:false,wbox:false,nwbox:true}:g||i?{nbox:false,nebox:true,
ebox:false,sebox:false,sbox:false,swbox:true,wbox:false,nwbox:false}:{nbox:false,nebox:false,ebox:false,sebox:true,sbox:false,swbox:false,wbox:false,nwbox:true};d.li=false;d.rotate=false;d.border=false}d[a]?this.changeAppearance(c,"visible"):this.changeAppearance(c,"hide")},changeAppearance:function(a,b){var c={hide:function(d){d.css({visibility:"hidden"});f("path",d).css({"pointer-events":"none"})},visible:function(d){d.css({visibility:"visible"});f("path",d).css({"pointer-events":"visiblePainted"})}};
c[b]&&c[b].call(this,a)},move:function(a,b,c){f(ShapeEditor.config.drawcontainer).trigger("bboxmove",{data:a,box:b,updateHandleAlone:c})},_bboxmove:function(a,b,c){var d=this.getBBoxes(a),e=this,g=b.hasClass("crop Frame")?true:false,i=ShapeEditor.bbox.getId(a),k=e.getBBoxType(undefined,a);c||f.each(d,function(j,m){var o=f.BBoxConstant[m],n=k==="lock"?"normal":"lock";if(!o)return true;var q=e.getBBoxData(m,a);g&&e.transformCropBox(q,j,a);e.position(q,a,j);if(g&&(j==="li"||j==="rotate"||j==="border"))return true;
hideBBox=ShapeEditor.bbox.getBBoxByType(i,j,n);hideBBox.css({left:"-10000px",top:"-10000px"});o=ShapeEditor.bbox.getBBoxByType(i,j,k);ShapeEditor.bbox.showVisibleBBox(j,a,o);Shape.props.transform.set(q,ShapeEditor.config.container,o)});if(b){var l;b.data("lock")||(l=b.data(Shape.handle));l&&f.each(l,function(j,m){var o=e.getHandleName(a),n=ShapeEditor.config.get.shapeContainer().children("#handle"+j);if(n.length>0&&ShapeEditor.select.shapes.length===1){o=e.getBBoxData(o,a);e.position(o,a,e.handleName,
m);Shape.props.transform.set(o,ShapeEditor.config.container,n);n.data(e.handledata,j);o=a.props.transform.dim;(o.width<e.minWidth||o.height<e.minHeight)&&a.type!==f.ShapeConstants.ShapeNodeType.CONNECTOR?e.changeAppearance(n,"hide"):e.changeAppearance(n,"visible")}})}},remove:function(a){f(ShapeEditor.config.drawcontainer).trigger("bboxremove",{shapeId:a})},_remove:function(a){var b=a?a===this.handleName?a:"bbox"+a:"bbox",c=ShapeEditor.bbox.getBBoxType(a);a=c==="lock"?"normal":"lock";var d;if(b===
"bbox"||b==="handle")c=f("."+b,ShapeEditor.config.container);else{c=f("."+b+c,ShapeEditor.config.container);d=f("."+b+a,ShapeEditor.config.container)}var e=undefined,g=undefined;f.each(c,function(i,k){k=f(k);if(k.data("primaryBBox"))e=e?e.add(k):k;else g=g?g.add(k):k});e&&e.css({left:"-10000px",top:"-10000px"});g&&ShapeEditor.config.drawcontainer.trigger("_bboxremove",{bboxes:g});e&&e.hide();d&&d.css({left:"-10000px",top:"-10000px"})},transformCropBox:function(a,b,c){var d={nwbox:{flip:{fliph:false,
flipv:true},dim:{width:10,height:10}},sebox:{flip:{fliph:true,flipv:false},dim:{width:10,height:10}},nebox:{flip:{fliph:true,flipv:true},dim:{width:10,height:10}},swbox:{flip:{flipv:false,flipv:false},dim:{width:10,height:10}},sbox:{dim:{width:15,height:5}},nbox:{dim:{width:15,height:5}},ebox:{dim:{width:5,height:15}},wbox:{dim:{width:5,height:15}},cropframe:{flip:{fliph:false,flipv:false}}};if(b=b?d[b]:undefined){if(b.dim){a.props.transform.dim.width=b.dim.width/c.scale;a.props.transform.dim.height=
b.dim.height/c.scale}if(b.flip){a.props.transform.fliph=b.flip.fliph;a.props.transform.flipv=b.flip.flipv}}},updateFrameData:function(a){var b=[];a.props.geom.preset.modifiers=b;a.props.stroke.jointype=f.ShapeConstants.JoinType.BEVEL;var c=a.props.transform;c.dim.width+=8;c.dim.height+=8;c.pos.left-=4;c.pos.top-=4;a=c.dim.width;c=c.dim.height;b.push(8/(a>c?c:a))},update:function(a,b,c,d,e,g){this.position(a,b,c,e);e=ShapeEvent.checkLockStatus({data:b},"Modify");a.className="bbox "+d+" bbox"+b.nvOProps.nvDProps.id+
(b?e?"lock":"normal":"normal");a.nvOProps.nvDProps.id=c.indexOf("handle")!==-1?c:c+"_"+Math.uuid();if(b.fitModeData&&c==="border")a.fitModeData=f.extend(true,{},b.fitModeData)},updateBBoxData:function(a,b,c,d){a.data("shapeId",ShapeEditor.bbox.getId(c));b&&d==="connected"&&a.data("connectedTo",b.connectedTo);a.data("lock",ShapeEditor.bbox.getLockData(c));a.data("lock")&&a.data("lockerDetails",c.nvOProps.nvODProps.locks.lockers)},position:function(a,b,c,d){var e=b.props.transform,g=e.dim,i=e.pos,k=
e.rotate?e.rotate:0,l=b.scale?b.scale:1,j=f("#"+b.nvOProps.nvDProps.id,ShapeEditor.config.container).hasClass("crop Frame")?true:false;g=f.extend(true,{},g);i=f.extend(true,{},i);var m=g.width*0.5,o=i.left+m,n=i.top+g.height*0.5,q=o,p=n;if(d){m=VectorUtil.getViewBoxDimensions(g.width,g.height);q=d[0];d=d[1];if(e&&e.fliph)q=m[0]-q;if(e&&e.flipv)d=m[1]-d;q=i.left+q/m[0]*g.width;p=i.top+d/m[1]*g.height}else{if(c.indexOf("ebox")!==-1)q=i.left+g.width;else if(c.indexOf("wbox")!==-1)q=i.left;if(c.indexOf("nbox")!==
-1||c.indexOf("nebox")!==-1||c.indexOf("nwbox")!==-1)p=i.top;else if(c.indexOf("sbox")!==-1||c.indexOf("sebox")!==-1||c.indexOf("swbox")!==-1)p=i.top+g.height;else if(c.indexOf("resizerbox")!==-1){q=i.left+g.width-2;p=i.top+g.height-2}else if(c==="rotate")p=i.top-this.rhandle/l;else if(c==="li"){q=i.left+m;p=i.top-this.rhandle/l+this.bboxDim/l}}q=Math.round(q);p=Math.round(p);e=zoho.math.getRotatedValue(k,q,p,o,n);g=a.props.transform.dim;if(c==="border"||c==="borderframe")ShapeEditor.bbox.borderSize(a,
b);else if(c==="li")a.props.transform.dim.height=this.rhandle/l;else if(c==="resizerbox"){a.props.transform.dim.height=12;a.props.transform.dim.width=12}else{b=this.bboxDim;if(c.indexOf("handle")!==-1)b=this.handleDim;if(!j){g.width=b/l;g.height=b/l}a.props.stroke.width=this.strokeWidth/l}a.props.transform.pos.left=c==="border"||c==="borderframe"?i.left:e.x-g.width*0.5;a.props.transform.pos.top=c==="border"||c==="borderframe"?i.top:e.y-g.height*0.5;a.props.transform.rotate=k;a.nvOProps.nvDProps.id.indexOf("borderframe")!=
-1&&this.updateFrameData(a);return e},cursor:function(a,b){var c;b+={nbox:0,nebox:45,ebox:90,resizerbox:135,sebox:135,sbox:180,swbox:225,wbox:270,nwbox:325}[a];if(b>=360)b%=360;var d=["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"];if(b>=337.5&&b<=360||b>=0&&b<=22.5)c=d[0];else if(b>=22.6&&b<=67.5)c=d[1];else if(b>=67.6&&b<=112.5)c=d[2];else if(b>=112.6&&b<=157.5)c=d[3];else if(b>=157.6&&b<=202.5)c=d[4];else if(b>=202.6&&b<=247.5)c=d[5];else if(b>=247.6&&
b<=292.5)c=d[6];else if(b>=292.6&&b<=337.5)c=d[7];return c}},clone:{cloneid:"clonebox_",stroke:{type:f.ShapeConstants.StrokeType.SOLID,width:2,fill:{type:f.ShapeConstants.FillType.SOLID,solid:{color:{rgb:[64,64,64]}}},captype:f.ShapeConstants.CapType.FLAT},fill:{type:f.ShapeConstants.StrokeType.SOLID,solid:{color:{rgb:[200,200,200]}}},strokeOpacity:0.6,fillOpacity:0.4,create:function(a){if(ShapeEditor.select.shapes[0]&&ShapeEditor.select.shapes[0].box.attr("id").indexOf("crop")!==-1)a.data.cloneshape=
[{box:ShapeEditor.select.shapes[0].box,data:ShapeEditor.select.shapes[0].data,connector:[]}];if(!a.data.cloneshape)if(a.data.externalShapes)a.data.cloneshape=f.extend(true,{},a.data.externalShapes);else{a.data.cloneshape=[];var b=ShapeEditor.select.shapes,c=this;f.each(b,function(d,e){if(ShapeEvent.checkLockStatus(e,"Modify"))return true;e.data.type===f.ShapeConstants.ShapeNodeType.GRAPHICFRAME&&e.data.obj.type===f.ShapeConstants.GraphicObjectType.TABLE&&Table.updateTableDimensionData(e.data,e.box);
var g=f.extend(true,{},e.data);if(g.type==f.ShapeConstants.ShapeNodeType.GRAPHICFRAME){var i=f.extend(true,{},f.ShapeDefault.bgshape);i.nvOProps.nvDProps.id=g.nvOProps.nvDProps.id;i.props.transform.pos=g.props.transform.pos;i.props.transform.dim=g.props.transform.dim;i.props.stroke=c.stroke;i.type="SHAPE";g=i}g.editData=false;if(g.type===f.ShapeConstants.ShapeNodeType.CONNECTOR){var k=false,l=g.nvOProps.nvDProps.id;if(g.nvOProps.nvODProps){f.each(b,function(o,n){f.each(n.connector,function(q,p){if(l===
p.data.nvOProps.nvDProps.id){k=true;return false}});return!k});if(k)return true}}g.nvOProps.nvDProps.id=c.cloneid+g.nvOProps.nvDProps.id;var j=[],m=ShapeEditor.config.get.shapeContainer();g.type===f.ShapeConstants.ShapeNodeType.GROUPSHAPE?ShapeEditor.clone.getModifyData(g):ShapeEditor.clone.modify.data(g);if(Shape.isPointerEventSupported)if(g.type===f.ShapeConstants.ShapeNodeType.GROUPSHAPE){i=f.GroupShape.create.draw(g,m);f(i).find("path").css("pointer-events","none")}else{i=Shape.create.draw(g,
m);f("path",i).css("pointer-events","none")}else{if(g.type===f.ShapeConstants.ShapeNodeType.CONNECTOR)g.props.transform.pos.zindex=0;i=g.type===f.ShapeConstants.ShapeNodeType.GROUPSHAPE?f.GroupShape.create.draw(g,m):Shape.create.draw(g,m)}g.type===f.ShapeConstants.ShapeNodeType.PICTURE&&f("g",i).css("opacity",0.6);f.each(e.connector,function(o,n){var q=f.extend(true,{},n.data),p=c.cloneid+n.shapeId;q.nvOProps.nvDProps.id=c.cloneid+q.nvOProps.nvDProps.id;ShapeEditor.clone.modify.data(q);var r=Shape.create.draw(q,
m);Shape.isPointerEventSupported&&f("g",r).css("pointer-event","none");r.data("dependent",true);j.push({data:q,box:r,shapeId:p,pos:n.pos,point:n.point})});a.data.cloneshape[d]={data:g,box:i,connector:j}})}},getModifyData:function(a){var b=this;a=a.groupshape?a.groupshape:a;ShapeEditor.clone.modify.data(a);f.each(a.shapes,function(c,d){d=d.groupshape?d.groupshape:d;d.nvOProps.nvDProps.id=b.cloneid+d.nvOProps.nvDProps.id;d.type===f.ShapeConstants.ShapeNodeType.GROUPSHAPE?ShapeEditor.clone.getModifyData(d):
ShapeEditor.clone.modify.data(d)})},modify:{data:function(a){a.storeCanvas=true;delete a.props.effects;delete a.textBody;delete a.placeHolder;if(a.props.stroke){a.props.stroke=a.props.stroke.type=="NONE"?f.extend(true,{},ShapeEditor.clone.stroke):a.props.stroke;a.props.stroke=a.props.stroke.fill&&a.props.stroke.fill.type=="NONE"?f.extend(true,{},ShapeEditor.clone.stroke):a.props.stroke}if(a.props.fill){a.props.fill=!a.props.fill?{type:"NONE"}:a.props.fill;this.fill(a.props.fill,ShapeEditor.clone.fillOpacity)}if(a.props.geom&&
a.props.geom.type!=f.ShapeConstants.ShapeGeometryType.CUSTOM)a.props.fill=a.props.fill&&a.props.fill.type=="NONE"?f.extend(true,{},ShapeEditor.clone.fill):a.props.fill;this.fill(a.props.fill,ShapeEditor.clone.fillOpacity)},fill:function(a,b){if(a){var c=this;if(a.type===f.ShapeConstants.FillType.SOLID)this.color(a.solid.color,b);else if(a.type===f.ShapeConstants.FillType.GRADIENT)f.each(a.gradient.stops,function(d,e){c.color(e.color,b)});else if(a.type===f.ShapeConstants.FillType.PICT)a.pict.transparency=
ShapeEditor.clone.fillOpacity}},color:function(a,b){if(a&&a.tweaks){a.tweaks.alpha=a.tweaks.alpha?a.tweaks.alpha:0;a.tweaks.alpha=1-(1-a.tweaks.alpha)*b}else a.tweaks={alpha:1-b}}},check:function(a,b){var c=false;f.each(a,function(d,e){if(!e)return true;f.each(e.connector,function(g,i){if(i.data&&i.data.nvOProps.nvDProps.id===b){c=true;return false}})});return c},get:function(a){a=a.groupshape?a.groupshape:a;return f("#"+this.cloneid+a.nvOProps.nvDProps.id,ShapeEditor.config.get.shapeContainer())},
remove:function(){var a=f("#groupselect",ShapeEditor.config.get.shapeContainer());if(a.length){ShapeEditor.select.init();a.remove()}else f.each(ShapeEditor.select.shapes,function(b,c){var d=ShapeEditor.clone.get(c.data);d.remove();f.each(c.connector,function(e,g){d=ShapeEditor.clone.get(g.data);d.length>0&&d.remove()})});f(document).unbind(ShapeEvent.EVENTS.MOUSEMOVE+".Shape",ShapeEditor.event.move);f(document).unbind(ShapeEvent.EVENTS.MOUSEUP+".Shape",ShapeEditor.event.up);ShapeEditor.editing=false;
f("body").css({cursor:"default"});ShapeEditor.config.isSupported.connector&&ShapeEditor.connector.removeConnectorPoints()}},event:{bind:function(a,b,c){ShapeEditor.editing=true;b.element=a;f(document).bind(ShapeEvent.EVENTS.MOUSEMOVE+".Shape",b,this.move);b.moveHandle=c;f(document).bind(ShapeEvent.EVENTS.MOUSEUP+".Shape",b,this.up);b.externalShapes&&b.externalShapes.method&&b.externalShapes.method.down&&b.externalShapes.method.down.call()},move:function(a){if(!a.data.isInnerShapeSelected){a.data.createShape||
ShapeEditor.clone.create(a);a.data.isInnerShape=false;var b=a.data.element;ShapeEditor.cursorType&&f("body").css({cursor:ShapeEditor.cursorType});b.get.call(b,a);var c=a.data.currentShape;if(c){var d=a.data.cloneshape[c.index];d&&b.move.call(b,a,c.index,d)}f.each(a.data.cloneshape,function(g,i){i&&!(c&&g===c.index)&&b.move.call(b,a,g,i)});ShapeEditor.event.dependency(a.data.cloneshape,true,a);var e;d=false;if(c)e=a.data.cloneshape[c.index];else if(a.data.externalShapes){e=a.data.cloneshape[0];d=true}if(e&&
e.data.nvOProps.nvDProps.id!=="groupselect"&&!e.data.noEventShapeInfo){e=b.updateInfo.call(b,e,d);ShapeEditor.event.shapeInfo({left:a.pageX+15,top:a.pageY+15},e)}a.data.externalShapes&&a.data.externalShapes.method&&a.data.externalShapes.method.move&&a.data.externalShapes.method.move.call();a.preventDefault()}},shapeInfo:function(a,b){var c=ShapeEvent.shapeInfo;if(!a||!(b&&b.length)){c.html("");c.css({left:-1E3,top:-1E3})}else{f.each(b,function(d,e){var g=f("#info"+d,c);if(!g.length){g=f("<div id = 'info"+
d+"'></div>");c.append(g)}g.html(e)});c.css(a)}},removeClone:function(a){f.each(a,function(b,c){if(c.type===f.ShapeConstants.ShapeNodeType.GROUPSHAPE){c=c.groupshape?c.groupshape:c;ShapeEditor.event.removeClone(c.shapes)}else{var d=ShapeEditor.clone.get(c);d.length>0&&d.remove()}})},up:function(a){var b=ShapeEventHandler.getTarget(a).closest("."+Shape.shapeClass),c;c=a.data.isInnerShape;var d=ShapeEditor.config.get.shapeContainer();if(c&&!a.data.unSelectShape&&a.which!==3&&!b.data("lock")&&b.hasClass("grouped")){ShapeEvent.shapeEdit.select(a,
b,true);ShapeEditor.triggerEvent("shape_selected")}if(a.data.unSelectInnerShape){var e=ShapeEditor.select.shapes[0];c=e.data.nvOProps.nvDProps.id;ShapeEditor.unselectShape(c);c=e.parentIds[e.parentIds.length-1];c=ShapeEditor.config.get.shape(c);ShapeEditor.select.init(d,c);ShapeEditor.triggerEvent("shape_selected")}if(a.data.unSelectShape){d=b;if(b.data("groupShapeId"))for(;b.data("groupShapeId");)b=f("#"+b.data("groupShapeId"));if(a.data.isInnerShapeSelected){c=d.attr("id");ShapeEditor.unselectShape(c);
c=b.attr("id");c=ShapeEditor.config.get.shape(c);ShapeEditor.select.init(b,c);ShapeEditor.triggerEvent("shape_selected")}else{c=b.attr("id");ShapeEditor.unselectShape(c)}}var g=a.data.element;f(document).unbind(ShapeEvent.EVENTS.MOUSEMOVE+".Shape",ShapeEditor.event.move);f(document).unbind(ShapeEvent.EVENTS.MOUSEUP+".Shape",ShapeEditor.event.up);f(ShapeEditor.v_Div).length&&ShapeEditor.v_Div.css("visibility","hidden").removeClass("smartGuideSlide");f(ShapeEditor.h_Div).length&&ShapeEditor.h_Div.css("visibility",
"hidden").removeClass("smartGuideSlide");ShapeEditor.showSmartGuides=false;if(a.data.createShape)ShapeEditor.draw.preset.up(a);else{var i=[],k=[];f.each(a.data.externalShapes?a.data.externalShapes:ShapeEditor.select.shapes,function(l,j){var m=ShapeEditor.clone.get(j.data);if(m.length>0){var o=m.data("dependent")?ShapeEditor.resize:g;o=o.set.call(o,j.data,m,j.box);m.remove();j.data.type===f.ShapeConstants.ShapeNodeType.GROUPSHAPE&&ShapeEditor.event.removeClone(j.data.shapes);if(j.box.attr("id").indexOf("crop")===
-1)i=f.merge(i,o)}else if(a.data.externalShapes){o=j.box.data(g.key);o=[{data:o,id:j.data.nvOProps.nvDProps.id}];k=f.merge(k,o)}else j.box.data("shapeData",j.data)});if(i.length){f.each(ShapeEditor.select.getShapes(ShapeEditor.select.shapes,true),function(l,j){f.each(j.connector,function(m,o){var n=ShapeEditor.clone.get(o.data);if(n.length>0){var q=ShapeEditor.resize.set(o.data,n,o.box);i=f.merge(i,q);n.remove()}});if(j.data.type===f.ShapeConstants.ShapeNodeType.CONNECTOR){ShapeEditor.bbox.remove(j.data.nvOProps.nvDProps.id);
ShapeEditor.bbox.create(j.data,j.box)}else ShapeEditor.bbox.move(j.data,j.box,a.data.moveHandle)});ShapeEditor.config.container.trigger("modified",{shapeData:i,appData:{action:"Editor"}})}k.length&&ShapeEditor.config.container.trigger("externalShape_modified",{data:k});ShapeEditor.config.isSupported.text&&ShapeEditor.text.editor.mouse.up()}ShapeEditor.event.shapeInfo();ShapeEditor.editing=false;f("body").css({cursor:"default"});ShapeEditor.config.isSupported.connector&&ShapeEditor.connector.removeConnectorPoints();
a.data.externalShapes&&a.data.externalShapes.method&&a.data.externalShapes.method.up&&a.data.externalShapes.method.up.call();ShapeEditor.select.shapes.length&&ShapeEditor.focusEditor();f.FloatingMenu&&f.FloatingMenu.picture.set()},dependency:function(a,b,c){var d=[];if(ShapeEditor.config.isSupported.connector){a=ShapeEditor.connector.editingDependency(a,b,c);f.merge(d,a)}return d},keyEvent:function(a,b,c){var d=[];f.each(ShapeEditor.select.shapes,function(g,i){var k;switch(a){case ShapeEvent.leftKey:var l=
[-1*b,0];k=true;break;case ShapeEvent.rightKey:l=[b,0];k=true;break;case ShapeEvent.upKey:l=[0,-1*b];k=false;break;case ShapeEvent.downKey:l=[0,b];k=false}k=c.keyEvent.call(c,i,l,k);d=f.merge(d,k)});var e=ShapeEditor.event.dependency(ShapeEditor.select.shapes,true);f.each(e,function(g,i){var k=ShapeEditor.select.check(i.id);if(k){f.extend(true,k.shape.data,i.data.data);k.shape.data.props.geom.preset.modifiers=f.extend(true,[],i.data.data.props.geom.preset.modifiers)}});ShapeEvent.keyEventId&&clearTimeout(ShapeEvent.keyEventId);
ShapeEvent.keyEventId=setTimeout(function(){f.each(ShapeEditor.select.shapes,function(g,i){if(i.data.type===f.ShapeConstants.ShapeNodeType.CONNECTOR){ShapeEditor.bbox.remove(i.data.nvOProps.nvDProps.id);ShapeEditor.bbox.create(i.data,i.box)}else ShapeEditor.bbox.move(i.data,i.box,!ShapeEditor.select.shapes.length)});d=f.merge(d,e);d.length&&ShapeEditor.config.container.trigger("modified",{shapeData:d,appData:{action:"Editor"}})},600)},transform:function(a,b){var c=[],d=ShapeEditor.select.getShapes(ShapeEditor.select.shapes,
true);f.each(d,function(e,g){var i={},k=g.data.props.transform;if(b==="rotate"){var l=g.data.props.transform.rotate;l=parseInt(a)+(l?l:0);if(l>360)l%=360;g.data.props.transform.rotate=l;i.rotate=l}else if(b==="flip"){l=g.data.props.transform.rotate;if(a=="x"){k.fliph=!k.fliph;i.fliph=k.fliph}if(a=="y"){k.flipv=!k.flipv;i.flipv=k.flipv}if(l&&(a==="x"||a==="y")){g.data.props.transform.rotate=360-l;i.rotate=360-l}}f.ShapeObject.props.transform.set(g.data,ShapeEditor.config.get.shapeContainer(),g.box);
ShapeEditor.bbox.move(g.data,g.box);i=f.extend(true,k,i);c[c.length]={id:g.data.nvOProps.nvDProps.id,data:{action:"modify",data:{props:{transform:i}}}}});c.length&&ShapeEditor.config.container.trigger("modified",{shapeData:c,appData:{action:"Editor"}})}},triggerData:function(a,b,c,d,e,g,i){var k=[];b=i?{pos:f.extend(true,{},b)}:{pos:f.extend(true,{},b),dim:f.extend(true,{},c),rotate:d,fliph:e,flipv:g};k.push({id:a.nvOProps.nvDProps.id,data:{action:"modify",data:{props:{transform:b}}}});if(a.type===
f.ShapeConstants.ShapeNodeType.CONNECTOR&&a.nvOProps.nvODProps){delete a.nvOProps.nvODProps;k.push({id:a.nvOProps.nvDProps.id,data:{action:"removeData",data:["nvOProps.nvODProps"]}})}return k},move:{key:"pos",down:function(a,b,c){var d=[a.pageX,a.pageY],e=ShapeEditor.config.get.scale(),g=a.data&&a.data.unSelectShape?a.data.unSelectShape:false,i=a.data&&a.data.unSelectInnerShape?a.data.unSelectInnerShape:false;e=c?c:ShapeEditor.select.shapes;if(e.length){e=e[0].data;var k;if(!c){b=b.attr("id");if(b.indexOf("border")!==
-1)b=ShapeEditor.bbox.getShapeId(b);k=ShapeEditor.select.check(b)}e=e.scale?e.scale:1;ShapeEditor.event.bind(this,{currentShape:k,cursorposition:d,scaleFactor:e,unSelectShape:g,externalShapes:c,isInnerShape:a.isInnerShape,isInnerShapeSelected:a.isInnerShapeSelected,unSelectInnerShape:i})}},get:function(a){var b=a.data.cursorposition;a.data.x=a.pageX-b[0];a.data.y=a.pageY-b[1];a.data.x/=a.data.scaleFactor;a.data.y/=a.data.scaleFactor},getSnapDiff:function(a,b,c){var d=ShapeEditor.config.get.slideSize();
return{dx:(d.width*0.5-c.left*a)%b,dy:(d.height*0.5-c.top*a)%b}},snap:function(a){var b=a.data.snap.width,c=a.data.snap.initDiff,d=a.data.x%b,e=a.data.y%b;if(c.dx||c.dy){a.data.x=a.data.x>0?a.data.x-d+c.dx:a.data.x-d+b-c.dx;a.data.y=a.data.y>0?a.data.y-e+c.dy:a.data.y-e+b-c.dy;c.dx=0;c.dy=0}else{a.data.x=d<b*0.5?a.data.x-d:b+(a.data.x-d);a.data.y=e<b*0.5?a.data.y-e:b+(a.data.y-e)}},move:function(a,b,c){var d=a.data.externalShapes?a.data.externalShapes[b].data:ShapeEditor.select.shapes[b].data,e=d.props.transform.pos,
g=d.movingAxis;d=g==="x"?0:a.data.y;g=g==="y"?0:a.data.x;if(ShapeEvent.keyEvent.shiftKey)if(Math.abs(g)<Math.abs(d))g=0;else d=0;d={left:g+e.left,top:d+e.top};if(ShapeEditor.smartguide&&(Math.abs(d.top-e.top)>=ShapeEditor.smartguide.smartGuideProximity||Math.abs(d.left-e.left)>=ShapeEditor.smartguide.smartGuideProximity))ShapeEditor.showSmartGuides=true;if(!a.data.externalShapes&&ShapeEditor.showSmartGuides){e=ShapeEditor.smartguide;if((g=a.data.currentShape)&&g.index===b){g=d.left;var i=d.top;a.data.smartGuideChange=
e.set(d,c.data,a.data);if(a.data.smartGuideChange){a.data.snapDiff_left=d.left-g;a.data.snapDiff_top=d.top-i}}else if(a.data.smartGuideChange){d.left+=a.data.snapDiff_left;d.top+=a.data.snapDiff_top}}ShapeEditor.move.setData(c.data,c.box,d);c.box.data("pos",d);a.data.externalShapes&&a.data.externalShapes[b].box.data("shapeData",c.data)},set:function(a,b,c){b=b.data("pos");return this.setData(a,c,b)},setData:function(a,b,c){var d=[],e=a.nvOProps.nvODProps&&a.nvOProps.nvODProps.locks?a.nvOProps.nvODProps.locks:
undefined,g;if(!(e&&(e.noMove||e.noModify))){d=a.range;e=a.movingAxis;if(e==="x"){c.left=c.left<d.left.from?d.left.from:c.left;c.left=c.left>d.left.to?d.left.to:c.left}if(e==="y"){c.top=c.top<d.top.from?d.top.from:c.top;c.top=c.top>d.top.to?d.top.to:c.top}a.props.transform.pos.left=c.left;a.props.transform.pos.top=c.top;if(a.type===f.ShapeConstants.ShapeNodeType.GROUPSHAPE)f.GroupShape.props.transform.set(a,ShapeEditor.config.get.shapeContainer(),b);else if(a.type==f.ShapeConstants.ShapeNodeType.GRAPHICFRAME){GraphicFrame.props.transform.pos.set(a,
ShapeEditor.config.get.shapeContainer(),b);g=true}else Shape.props.transform.pos.set(a,ShapeEditor.config.get.shapeContainer(),b);b=a.props.transform;d=ShapeEditor.triggerData(a,c,b.dim,b.rotate,b.fliph,b.flipv,g)}return d},updateInfo:function(a,b){var c=[];if(b){var d=a.data,e=b?ShapeEditor.config.get.scale():1,g=d.props.transform.pos,i=a.data.movingAxis,k=ShapeEditor.config.get.label("left"),l=ShapeEditor.config.get.label("top");if(i)if(i==="x"){d=Math.round((g.left-d.range.left.from)/e);c.push(k+
" : "+d+"px")}else{if(i==="y"){d=Math.round((g.top-d.range.top.from)/e);c.push(l+" : "+d+"px")}}else{c.push(k+" : "+Math.round(g.left/e)+"px");c.push(l+" : "+Math.round(g.top/e)+"px")}}return c},keyEvent:function(a,b){pos=a.data.props.transform.pos;var c=ShapeEditor.config.isSlideLocked();if(!ShapeEvent.checkLockStatus(a,"Modify")&&!c){pos.left+=b[0];pos.top+=b[1]}return ShapeEditor.move.setData(a.data,a.box,pos)}},rotate:{angle:"angle",down:function(a,b){if(!(b&&b.data("lock"))){var c=ShapeEditor.config.container.offset(),
d=b.data("shapeId");d=ShapeEditor.select.check(d);var e=d.shape.data.props.transform,g=e.dim,i=e.rotate?e.rotate:0;e=e.pos;g=[g.width*0.5,g.height*0.5];g=[e.left+g[0],e.top+g[1]];e=ShapeEditor.config.get.scale();ShapeEditor.event.bind(this,{currentShape:d,mid:g,offset:c,initAngle:i,scaleFactor:e})}},get:function(a){var b=a.data.offset,c=a.pageX-b.left;b=a.pageY-b.top;var d=a.data.scaleFactor;c/=d;b/=d;c=Math.atan2(c-a.data.mid[0],b-a.data.mid[1]);c=zoho.math.toDegrees(c);c=Math.round(180-c);a.data.angle=
c-a.data.initAngle},move:function(a,b,c){b=ShapeEditor.select.shapes[b].data.props;angle=b.transform.rotate?b.transform.rotate:ShapeEditor.zeroAngle;a=(angle+a.data.angle)%ShapeEditor.degree360;ShapeEditor.rotate.setData(c.data,c.box,a);c.box.data(ShapeEditor.rotate.angle,a)},set:function(a,b,c){b=b.data(this.angle);return this.setData(a,c,b)},setData:function(a,b,c){var d=[],e=a.nvOProps.nvODProps&&a.nvOProps.nvODProps.locks?a.nvOProps.nvODProps.locks:undefined;if(!(e&&(e.noRotation||e.noModify))){c=
Math.round(c);a.props.transform.rotate=c;if(a.type===f.ShapeConstants.ShapeNodeType.GROUPSHAPE)f.GroupShape.props.transform.set(a,ShapeEditor.config.get.shapeContainer(),b);else{Shape.props.transform.set(a,ShapeEditor.config.get.shapeContainer(),b);Shape.props.transform.dependency(a,ShapeEditor.config.get.shapeContainer(),b)}b=a.props.transform;d=ShapeEditor.triggerData(a,b.pos,b.dim,c,b.fliph,b.flipv)}return d},updateInfo:function(a){var b=[],c=ShapeEditor.config.isSlideLocked();if(!ShapeEvent.checkLockStatus(a,
"Modify")&&!c){c=ShapeEditor.config.get.label("rotate");b.push(c+" : "+a.data.props.transform.rotate+"&#176;")}return b},keyEvent:function(a,b,c){if(c){c=(c=a.data.props.transform.rotate)?c:0;c+=b[0];c=c<0?360-Math.abs(c):c%360;return ShapeEditor.rotate.setData(a.data,a.box,c)}}},handle:{down:function(a,b){var c=ShapeEditor.select.shapes[0],d=c.data,e=b.data(ShapeEditor.bbox.handledata);Shape.selectedHandle=e;var g=d.props.geom.preset,i=g.type;b=f.Preset[i].handles[e].values;d=d.props.transform;var k=
d.dim,l=k.width*0.5,j=k.height*0.5,m=d.rotate?d.rotate:0,o=g.modifiers&&g.modifiers.length?g.modifiers:f.Preset[i].modifiers;o=f.extend(true,[],o);g=ShapeEditor.config.container.offset();var n=d.pos,q={left:g.left+n.left,top:g.top+n.top};n=ShapeEditor.config.get.scale();var p=[],r=[],s=[],v=[],t=[],u=[];a.pageX=g.left+(a.pageX-g.left)/n;a.pageY=g.top+(a.pageY-g.top)/n;var w=d.fliph,E=d.flipv;f.each(b,function(G,x){var A={},y={},F=0,H=0,z=k.width,B=k.height;h=c.box.data(Shape.handle)[e];var C=VectorUtil.getHTMLDimension(h[0]),
D=VectorUtil.getHTMLDimension(h[1]),I=x.modifier;if(I.type==="X"||I.type==="Y"){var J=I.origin;if(I.type==="X"){F=w?z=k.width-C:z=C;if(J==="END"&&!w||J!=="END"&&w){H=B;B=0}}else{H=E?B=k.height-D:B=D;if(J!=="END"&&!E||J==="END"&&E){F=z;z=0}}}else{A=k.width;z=C=y=D=0;if(w){F=z=k.width;H=k.height;B=0}if(E){D=C=k.height;y=k.width;A=0}A=zoho.math.getRotatedValue(m,A,D,l,j);y=zoho.math.getRotatedValue(m,y,C,l,j)}D=zoho.string.removeSpace(f.Preset[i].name);if(Shape.pathGenerator.modifier[D]){C=VectorUtil.getViewBoxDimensions(k.width,
k.height);Shape.pathGenerator.modifier[D].call(Shape.pathGenerator,o,C[0],C[1])}F=zoho.math.getRotatedValue(m,F,H,l,j);z=zoho.math.getRotatedValue(m,z,B,l,j);C=zoho.math.distanceOf(F,z,a.pageX-q.left,a.pageY-q.top);u.push(C);p.push(F);r.push(z);s.push(A);v.push(y);t.push(o[x.num])});ShapeEditor.event.bind(this,{offset:q,p1:p,p2:r,p3:s,p4:v,number:e,modifiers:o,point:t,diff:u,containerOffset:g,scaleFactor:n},true)},get:function(a){a.data.modifiers=ShapeEditor.handle.getModifier(a)},move:function(a,
b,c){ShapeEditor.handle.setData(c.data,c.box,a.data.modifiers)},set:function(a,b,c){Shape.selectedHandle=undefined;return this.setData(a,c,b.data(Shape.modifier))},setData:function(a,b,c){var d=[],e=a.nvOProps.nvODProps&&a.nvOProps.nvODProps.locks?a.nvOProps.nvODProps.locks:undefined;if(!(e&&(e.noHandles||e.noModify))){a.props.geom.preset.modifiers=c;e=ShapeEditor.config.get.shapeContainer();Shape.props.geom.set(a,e,b);Shape.props.geom.dependency(a,e,b);b.hasClass("crop")&&ShapeEditor.bbox.move(a,
b,true);d.push({id:a.nvOProps.nvDProps.id,data:{action:"modify",data:{props:{geom:{preset:{modifiers:c,type:a.props.geom.preset.type},type:a.props.geom.type}}}}})}return d},getModifier:function(a){var b=ShapeEditor.select.shapes[0].data,c=b.props.geom.preset.type,d=a.data.modifiers;if(d){c=f.Preset[c].handles[a.data.number].values;var e=b.props.transform.dim;b=a.data.offset;var g=a.data.scaleFactor,i=a.data.containerOffset;a.pageX=i.left+(a.pageX-i.left)/g;a.pageY=i.top+(a.pageY-i.top)/g;var k=a.pageX-
b.left,l=a.pageY-b.top;f.each(c,function(j,m){var o=m.modifier,n=zoho.math.distanceOf(a.data.p1[j],a.data.p2[j],k,l),q=Math.min(e.width,e.height),p;if(o.type==="ANGLE"||o.type==="RADIUS"){var r=zoho.math.distanceOf(a.data.p3[j],a.data.p4[j],k,l);p=e.width*0.5;var s=e.height*0.5;r=zoho.math.getAngle(n,r,p,s);if(o.type==="RADIUS"){n=zoho.math.length(p,s,k,l);r=Shape.pathGenerator.getEllipseCoordinates(r,undefined,p,s,p,s);s=zoho.math.length(p,s,r[0],r[1]);n=zoho.math.limit(n,0,s);p=s-n;p/=q}else p=
r}else{n-=a.data.diff[j];p=q;if(o.type==="X"&&!m.ssDependent)p=e.width;else if(o.type==="Y"&&!m.ssDependent)p=e.height;p=n/p;if(o.multiplier)p*=o.multiplier;p+=a.data.point[j]}if(m.max){s=m.max;n=s.val;if(s.compute)if(o.type==="X"&&m.ssDependent)n*=e.width/q;else if(o.type==="Y"&&m.ssDependent)n*=e.height/q;p=zoho.math.maxLimit(p,n)}if(m.min){s=m.min;n=s.val;if(s.compute)if(o.type==="X"&&m.ssDependent)n*=e.width/q;else if(o.type==="Y"&&m.ssDependent)n*=e.height/q;p=zoho.math.minLimit(p,n)}d[m.num]=
p})}return d}},erase:{ready:undefined,clear:function(){this.ready=false},all:function(a){var b=(a?a:ShapeEditor.config.get.shapeContainer()).children("."+Shape.shapeClass);f.each(b,function(c,d){d=f(d);var e=d.data();e&&e.erasable&&d.remove()});if(!a){ShapeEditor.config.container.trigger("erase_all");ShapeEditor.config.container.trigger("Erased_all_drawing")}},set:function(){this.ready=true},shape:function(a){var b=a.closest("."+Shape.shapeClass);if(b.length)if((a=b.data())&&a.erasable){a=b.attr("id");
setTimeout(function(){b.remove()},50);ShapeEditor.config.container.trigger("shape_deleted",{id:a})}}},draw:{genre:undefined,cursor:undefined,continueDrawing:undefined,shape:undefined,setDrawingMode:function(a,b,c){this.genre=a;this.continueDrawing=b;this.cursor=c?c:ShapeEvent.cursorTypes.CROSSHAIR;f("body").css({cursor:this.cursor})},clear:function(){this.genre&&ShapeEditor.draw[this.genre.toLowerCase()].clear();this.shape=this.genre=undefined;this.continueDrawing=false;this.cursor=undefined},escapeDrawing:function(){this.shape.remove();
this.clear();f(document).unbind(ShapeEvent.EVENTS.MOUSEMOVE+".Shape",ShapeEditor.draw.preset.move);f(document).unbind(ShapeEvent.EVENTS.MOUSEUP+".Shape",ShapeEditor.draw.preset.up);ShapeEditor.editing=false},preset:{shapeType:undefined,placeHolderType:undefined,clear:function(){ShapeEditor.draw.preset.placeHolderType=undefined;ShapeEditor.draw.preset.shapeType=undefined;ShapeEditor.draw.shape=undefined;ShapeEditor.cursorType&&f("body").css({cursor:"default"})},setPresetData:function(a){this.shapeType=
a;ShapeEditor.config.isSupported.text&&ShapeEditor.text.editor.clear()},setPlaceHolderData:function(a){this.placeHolderType=a},down:function(a,b){ShapeEditor.select.clear("wait");ShapeEditor.bbox.remove();if(b&&a.which!==3){var c=ShapeEditor.config.container.offset(),d=ShapeEditor.config.get.scale(),e=(a.pageY-c.top)/d;b.props.transform.pos.left=(a.pageX-c.left)/d;b.props.transform.pos.top=e;a.data.createShape={data:b,bbox:"sebox"};ShapeEditor.config.isSupported.connector&&ShapeEditor.connector.draw.updateData(a,
b);ShapeEditor.resize.down(a)}},create:function(a){if(!a.data.cloneshape){var b=a.data.createShape.data,c;c=b;if(b.nvOProps.nvODProps&&b.nvOProps.nvODProps.textbox){c=f.extend(true,{},b);b.props.stroke.fill.type===f.ShapeConstants.FillType.NONE&&f.extend(true,c.props.stroke,Shape.props.stroke.defaultStroke)}if(Shape.isPointerEventSupported){c=Shape.create.draw(c,ShapeEditor.config.get.shapeContainer());f("g",c).css("pointer-events","none")}else{if(b.type===f.ShapeConstants.ShapeNodeType.CONNECTOR){b.zindex=
b.props.transform.zindex;b.props.transform.zindex=0}c=Shape.create.draw(c,ShapeEditor.config.get.shapeContainer())}ShapeEditor.select.init(c,b);a.data.cloneshape=[{box:c,data:f.extend(true,{},b),connector:[]}]}},up:function(a){var b=a.data.element,c=ShapeEditor.config.get.shapeContainer(),d=a.data.createShape.data.nvOProps.nvDProps.id,e=f("#"+d,c);d=d==="groupselect";if(e.length>0){e=ShapeEditor.select.shapes[0].box;i=ShapeEditor.select.shapes[0].data;b.set.call(b,i,e,e);if(d)if(ShapeEditor.config.isSupported.shapeEdit){a=
i.props.transform.pos;b=ShapeEditor.config.get.scale();a.left*=b;a.top*=b;var g=i.props.transform.dim;g.width*=b;g.height*=b;ShapeEditor.select.init();ShapeEditor.groupselect.selectShapes(a,g);e.remove()}}else if(!d&&ShapeEditor.config.drawOnMouseDown.preset){var i=a.data.createShape.data;e=Shape.create.draw(i,c);ShapeEditor.select.init(e,i)}if(d){ShapeEditor.select.shapes.length?ShapeEditor.triggerEvent("shape_selected"):ShapeEditor.triggerEvent("shape_unselected",[{action:"all"}]);f(e).trigger("groupselect",
i)}else{if(Shape.isPointerEventSupported)f("g",e).css("pointer-events","auto");else{i.props.transform.zindex=i.zindex?i.zindex:i.props.transform.zindex;Shape.props.transform.set(i,c,e)}ShapeEditor.config.isSupported.shapeEdit&&ShapeEditor.bbox.create(i,e);ShapeEditor.draw.continueDrawing||ShapeEditor.draw.clear();ShapeEditor.triggerEvent("shape_created",i,e);ShapeEditor.triggerEvent("shape_selected");ShapeEditor.config.isSupported.text&&i.nvOProps.nvODProps&&i.nvOProps.nvODProps.textbox&&ShapeEditor.text.editor.edit(ShapeEditor.select.shapes[0])}}},
custom:{shapeType:undefined,bind:undefined,freeform:"FREEFORM",scribble:"SCRIBBLE",pen:"PEN",curve:"CURVE",tempObj:undefined,prePoints:[],ffPoints:undefined,point:undefined,joinOffset:5,effects:undefined,setCustomData:function(a,b){ShapeEditor.draw.custom.clear();ShapeEditor.draw.genre=a;this.shapeType=b;ShapeEditor.draw.preset.shapeType=undefined},down:{set:function(a,b){ShapeEditor.select.clear("wait");ShapeEditor.bbox.remove();if(b.props.effects){ShapeEditor.draw.custom.effects=f.extend(true,{},
b.props.effects);delete b.props.effects}var c=ShapeEditor.config.container,d=ShapeEditor.draw.custom,e=d.shapeType,g=c.offset(),i=ShapeEditor.config.get.scale();if(ShapeEditor.draw.custom.bind){b=d.tempObj.shape.data;var k=d.tempObj.shape.bx}else{var l=c.height()/i;c=c.width()/i;b.props.transform.dim={height:l,width:c};b.props.transform.pos.left=0;b.props.transform.pos.top=0;b.props.fill.type="none";b.props.geom.custom.pathList=[]}d.bind=undefined;b.nvOProps.nvDProps.name=e;l=(a.pageX-g.left)/i;c=
(a.pageY-g.top)/i;var j={path:[{m:{x:l,y:c},type:f.ShapeConstants.PathType[f.ShapeConstants.PathType.M]},{l:{x:l+b.props.stroke.width/i*0.5,y:c},type:f.ShapeConstants.PathType[f.ShapeConstants.PathType.L]}],height:b.props.transform.dim.height,width:b.props.transform.dim.width},m=b.props.geom.custom.pathList;if(!d.tempObj)d.tempObj={sx:l,sy:c,bx:l,by:c,recal:false,shape:undefined};d.point=d.down[e.toLowerCase()].call(this,m,j,{x:l,y:c});f.extend(true,{},b);e=ShapeEditor.config.get.shapeContainer();
d.ffPoints={x:l,y:c};if(!ShapeEditor.editing){f(document).bind(ShapeEvent.EVENTS.MOUSEMOVE+".Shape",{shapedata:b,offset:g,bx:k,cubic:[],counter:0,shapeContainer:e,scaleFactor:i},ShapeEditor.draw.custom.move.set);d={shapeContainer:e};if(ShapeEditor.draw.custom.shapeType===ShapeEditor.draw.custom.scribble)d.unbind="true";f(document).bind(ShapeEvent.EVENTS.MOUSEUP+".Shape",d,ShapeEditor.draw.custom.stop)}ShapeEditor.editing=true},freeform:function(a,b,c){var d;if(a.length===1)d=b.path[1];else a.push(b);
ShapeEditor.draw.custom.move.dimension(c);return d},scribble:function(a,b){a.push(b)},pen:function(a,b){a.push(b)},curve:function(a,b,c){var d;if(a.length===1)d=b.path[1];else a.push(b);a=b.path[1].l;b=ShapeEditor.draw.custom;if(b.prePoints[2])b.prePoints[0]=b.prePoints[2];b.prePoints[1]=a;ShapeEditor.draw.custom.move.dimension(c);return d}},move:{set:function(a){var b=ShapeEditor.draw.custom,c=a.data.shapedata.props.geom.custom.pathList;if(b.point){c[c.length-1].path.push(b.point);b.point=undefined}c=
a.data.scaleFactor;a.data.x=(a.pageX-a.data.offset.left)/c;a.data.y=(a.pageY-a.data.offset.top)/c;c=ShapeEditor.draw.custom.shapeType.toLowerCase();ShapeEditor.draw.custom.move[c].call(this,a);if(a.data.bx)Shape.props.geom.set(a.data.shapedata,a.data.shapeContainer,a.data.bx);else{a.data.bx=Shape.create.draw(a.data.shapedata,a.data.shapeContainer);b.tempObj.shape={bx:a.data.bx,data:a.data.shapedata}}},freeform:function(a){var b=a.data.shapedata.props.geom.custom.pathList;b=b[b.length-1].path;if(ShapeEditor.draw.custom.bind){var c=
ShapeEditor.draw.custom;if(c.ffPoints){b[b.length-1]={m:{x:c.ffPoints.x,y:c.ffPoints.y},type:f.ShapeConstants.PathType[f.ShapeConstants.PathType.M]};Shape.props.geom.set(a.data.shapedata,a.data.shapeContainer,a.data.bx,true);c.ffPoints=undefined}b[b.length-1]={l:{x:a.data.x,y:a.data.y},type:f.ShapeConstants.PathType[f.ShapeConstants.PathType.L]}}else ShapeEditor.draw.custom.move.scribblepen(a)},scribble:function(a){ShapeEditor.draw.custom.move.scribblepen(a)},pen:function(a){ShapeEditor.draw.custom.move.scribblepen(a)},
scribblepen:function(a){var b=a.data.counter,c=a.data.cubic?a.data.cubic:[],d=a.data.shapedata.props.geom.custom.pathList;d=d[d.length-1].path;var e={x:a.data.x,y:a.data.y};b++;d.push({l:e,type:f.ShapeConstants.PathType[f.ShapeConstants.PathType.L]});c.push(e);ShapeEditor.draw.custom.move.dimension(e);if(b>2){c={cc:c,type:f.ShapeConstants.PathType[f.ShapeConstants.PathType.CC]};a.data.cubic=[];b=0;d.splice(d.length-3,3);d.push(c)}a.data.counter=b},curve:function(a){var b=[],c=a.data.shapedata.props.geom.custom.pathList,
d=c[c.length-1].path,e=a.data.cubic?a.data.cubic:[];c=ShapeEditor.draw.custom;var g=f.ShapeConstants.PathType[f.ShapeConstants.PathType.L],i=f.ShapeConstants.PathType[f.ShapeConstants.PathType.CC];if(d.length===2)d[d.length-1]={l:{x:a.data.x,y:a.data.y},type:g};else{if(d.length===3){var k=d[d.length-1].type;if(k===g){b=[d[0].m,d[1].l,d[2].l];c.prePoints=[d[1].l,d[2].l]}else if(k=i){b=[d[0].m,c.prePoints[0],{x:a.data.x,y:a.data.y}];c.prePoints[1]={x:a.data.x,y:a.data.y}}d.splice(d.length-2,2);g=c.controlPoints(b);
a=[[b[0].x+(g.c1.x-b[0].x)*0.5,b[0].y+(g.c1.y-b[0].y)*0.5,g.c1.x,g.c1.y,b[1].x,b[1].y],[g.c2.x,g.c2.y,b[2].x+(g.c2.x-b[2].x)*0.5,b[2].y+(g.c2.y-b[2].y)*0.5,b[2].x,b[2].y]]}else{b=[c.prePoints[0],c.prePoints[1],{x:a.data.x,y:a.data.y},true];d.splice(d.length-1,1);k=d[d.length-1].cc;g=c.controlPoints(b);c.prePoints[2]=g.c2;if(k)k[1]={x:g.c1.x,y:g.c1.y};a=[[g.c2.x,g.c2.y,(g.c2.x+a.data.x)*0.5,(g.c2.y+a.data.y)*0.5,a.data.x,a.data.y]]}f.each(a,function(l,j){e=[];e.push({x:j[0],y:j[1]});e.push({x:j[2],
y:j[3]});e.push({x:j[4],y:j[5]});d.push({cc:e,type:i})})}},dimension:function(a){var b=ShapeEditor.draw.custom.tempObj,c=a.x;a=a.y;b.sx=c<b.sx?c:b.sx;b.bx=c>b.bx?c:b.bx;b.sy=a<b.sy?a:b.sy;b.by=a>b.by?a:b.by}},controlPoints:function(a){var b=zoho.math.midPoint(a[0],a[1]),c=zoho.math.midPoint(a[1],a[2]),d=zoho.math.midPoint(b,c);b=zoho.math.getDiff(d,b,0.5);c=zoho.math.getDiff(d,c,0.5);d=zoho.math.getDiff(a[1],b);a=zoho.math.getDiff(a[1],c);return{c1:{x:d.x,y:d.y},c2:{x:a.x,y:a.y}}},stopCurveShape:function(a){f(document).unbind(ShapeEvent.EVENTS.MOUSEMOVE+
".Shape",ShapeEditor.draw.custom.move.set);f(document).unbind(ShapeEvent.EVENTS.MOUSEUP+".Shape",ShapeEditor.draw.custom.stop);var b=true,c=ShapeEditor.draw.custom,d=c.tempObj.shape;if(d){c.tempObj.recal||(b=c.reCalculate(d.data,d.bx));b&&ShapeEditor.draw.custom.shapeType!==c.pen&&c.joinPath(d.data,d.bx)}c.clearTempData();ShapeEditor.draw.continueDrawing||c.clearDrawData();if(b&&d){Shape.props.geom.set(d.data,a.data.shapeContainer,d.bx);ShapeEditor.config.isSupported.shapeEdit&&ShapeEditor.bbox.create(d.data,
d.bx);ShapeEditor.select.init(d.bx,d.data);ShapeEditor.triggerEvent("shape_created",d.data,d.bx);ShapeEditor.triggerEvent("shape_selected")}else!b&&d&&d.bx.remove();ShapeEditor.draw.custom.bind=false},stop:function(a){var b=301,c=new Date;if(a.data.lastCall)b=c-a.data.lastCall;var d=undefined;if(a.data.lastOffset){var e=a.data.lastOffset.y,g=a.pageY;if(Math.abs(a.data.lastOffset.x-a.pageX)<=9&&Math.abs(e-g)<=9)d=true}a.data.lastOffset={};a.data.lastOffset.x=a.pageX;a.data.lastOffset.y=a.pageY;a.data.lastCall=
c;if(a.data.unbind||b<300&&d)ShapeEditor.draw.custom.stopCurveShape(a);else ShapeEditor.draw.custom.bind=true},clear:function(){this.clearTempData();this.clearDrawData()},clearTempData:function(){ShapeEditor.draw.custom.tempObj=undefined;ShapeEditor.editing=false},clearDrawData:function(){self.shapeType=undefined;self.bind=undefined;ShapeEditor.cursorType&&f("body").css({cursor:"default"});ShapeEditor.draw.genre=undefined},reCalculate:function(a,b){var c=true,d=ShapeEditor.draw.custom;tempObj=d.tempObj;
tempObj.recal=true;var e=tempObj.bx-tempObj.sx?tempObj.bx-tempObj.sx:1,g=tempObj.by-tempObj.sy?tempObj.by-tempObj.sy:1,i=a.props.geom.custom.pathList;a.props.transform.dim={height:g,width:e};a.props.transform.pos.left=tempObj.sx;a.props.transform.pos.top=tempObj.sy;f.each(i,function(j,m){f.each(m.path,function(o,n){f.each(n,function(q,p){if(q!=="type")if(p.length)f.each(p,function(r,s){s.x-=tempObj.sx;s.y-=tempObj.sy});else if(p.x&&p.y){p.x-=tempObj.sx;p.y-=tempObj.sy}})});m.height=g;m.width=e});
if(!ShapeEditor.config.drawOnMouseDown.custom&&i.length===1)if(i.length===1)if(i[0].path.length===1){b.remove();c=false}else if(i[0].path.length<4){var k=i[0].path;if(k[0].m&&k[1].l){var l=Math.abs(k[0].m.y-k[1].l.y);if(Math.abs(k[0].m.x-k[1].l.x)<4&&l<4){b.remove();c=false}}}d.point||i[0].path.pop();if(i[0].path.length===1)c=false;c&&Shape.props.transform.set(a,ShapeEditor.config.get.shapeContainer(),b);return c},joinPath:function(a,b){var c=a.nvOProps.nvDProps.name,d=ShapeEditor.draw.custom.joinOffset;
f.each(a.props.geom.custom.pathList,function(g,i){var k=i.path[0].m,l;f.each(i.path[i.path.length-1],function(m,o){if(m!=="type")l=o[o.length-1]?o[o.length-1]:o});if(Math.abs(k.x-l.x)<=d&&Math.abs(k.y-l.y)<=d){if(i.path.length>1){if(c===ShapeEditor.draw.custom.curve){var j=ShapeEditor.draw.custom.controlPoints([i.path[i.path.length-1].cc[0],k,i.path[1].cc[0]]);i.path[1].cc[0]=j.c2;i.path[i.path.length-1].cc[1]=j.c1}l.x=k.x;l.y=k.y}i.path.push({c:true,type:f.ShapeConstants.PathType.C});a.props.fill.type=
a.props.fill.solid?f.ShapeConstants.FillType.SOLID:a.props.fill.gradient?f.ShapeConstants.FillType.GRADIENT:a.props.fill.pict?f.ShapeConstants.FillType.PICT:f.ShapeConstants.FillType.NONE}else a.props.fill.type="NONE"});if(ShapeEditor.draw.custom.effects){a.props.effects=f.extend(true,{},ShapeEditor.draw.custom.effects);ShapeEditor.draw.custom.effects=undefined}var e=ShapeEditor.config.get.shapeContainer();Shape.props.fill.set(a,e,b);Shape.props.fill.dependency(a,e,b)}}},resize:{tangentialAnchorMap:{ebox:{quadrant1:{angle0:{x:-1,
y:-1},angle1:{x:1,y:-1}},quadrant2:{angle0:{x:1,y:1},angle1:{x:1,y:-1}},quadrant3:{angle0:{x:1,y:-1},angle1:{x:1,y:-1}},quadrant4:{angle0:{x:1,y:1},angle1:{x:1,y:-1}}},sbox:{quadrant1:{angle0:{x:-1,y:-1},angle1:{x:-1,y:-1}},quadrant2:{angle0:{x:1,y:-1},angle1:{x:-1,y:-1}},quadrant3:{angle0:{x:-1,y:-1},angle1:{x:-1,y:-1}},quadrant4:{angle0:{x:1,y:-1},angle1:{x:-1,y:-1}}},wbox:{quadrant1:{angle0:{x:-1,y:-1},angle1:{x:1,y:-1}},quadrant2:{angle0:{x:1,y:1},angle1:{x:1,y:-1}},quadrant3:{angle0:{x:1,y:-1},
angle1:{x:1,y:-1}},quadrant4:{angle0:{x:1,y:1},angle1:{x:1,y:-1}}},nbox:{quadrant1:{angle0:{x:-1,y:-1},angle1:{x:-1,y:-1}},quadrant2:{angle0:{x:1,y:-1},angle1:{x:-1,y:-1}},quadrant3:{angle0:{x:-1,y:-1},angle1:{x:-1,y:-1}},quadrant4:{angle0:{x:1,y:-1},angle1:{x:-1,y:-1}}}},getTangentialAnchor:function(a,b,c,d,e){var g={};if(b==="nbox"||b==="ebox"||b==="sbox"||b==="wbox"){var i=zoho.math.toRadians,k=ShapeEditor.resize.getQuadrant(a),l=ShapeEditor.resize.tangentialAnchorMap[b][k.quadrant][k.angleVal].x;
k=ShapeEditor.resize.tangentialAnchorMap[b][k.quadrant][k.angleVal].y;if(b==="ebox"||b==="wbox"){g.x=c.x-l*Math.sin(i(a))*(e/2);g.y=c.y-k*Math.cos(i(a))*(e/2)}else if(b==="sbox"||b==="nbox"){g.x=c.x-l*Math.cos(i(a))*(d/2);g.y=c.y-k*Math.sin(i(a))*(d/2)}}else g=c;return g},getQuadrant:function(a){var b;a%=360;if(a%90){a="quadrant"+Math.ceil(a/90);b="angle1"}else{a="quadrant"+(Math.ceil(a/90)+1);b="angle0"}return{quadrant:a,angleVal:b}},bbox:{nbox:{p3:"c1",p4:"c2",anchor:"c3",signX:0,signY:-1,constant:"x",
isNeg:3,flipy:"sbox"},sbox:{p3:"c3",p4:"c4",anchor:"c1",signX:0,signY:1,constant:"x",isNeg:0,flipy:"nbox"},ebox:{p1:"c2",p2:"c4",anchor:"c1",signX:1,signY:0,constant:"y",isNeg:0,flipx:"wbox"},wbox:{p1:"c1",p2:"c3",anchor:"c2",signX:-1,signY:0,constant:"y",isNeg:2,flipx:"ebox"},nebox:{p1:"c2",p2:"c4",p3:"c1",p4:"c2",anchor:"c3",signX:1,signY:-1,isNeg:3,flipx:"nwbox",flipy:"sebox",flipxy:"swbox"},nwbox:{p1:"c1",p2:"c3",p3:"c1",p4:"c2",anchor:"c4",signX:-1,signY:-1,isNeg:1,flipx:"nebox",flipy:"swbox",
flipxy:"sebox"},sebox:{p1:"c2",p2:"c4",p3:"c3",p4:"c4",anchor:"c1",signX:1,signY:1,isNeg:0,flipx:"swbox",flipy:"nebox",flipxy:"nwbox"},resizerbox:{p1:"c2",p2:"c4",p3:"c3",p4:"c4",anchor:"c1",signX:1,signY:1,isNeg:0,flipx:"swbox",flipy:"nebox",flipxy:"nwbox"},swbox:{p1:"c1",p2:"c3",p3:"c3",p4:"c4",anchor:"c2",signX:-1,signY:1,isNeg:2,flipx:"sebox",flipy:"nwbox",flipxy:"nebox"}},degree44:44,degree45:45,degree134:134,degree224:224,degree314:314,degree135:135,degree225:225,degree315:315,down:function(a,
b,c){if(!(b&&b.data("lock"))){var d,e,g;if(a.data.createShape){e=a.data.createShape.data;d=a.data.createShape.bbox;g=a.data.createShape;b=[{data:e}];a={shape:{data:e},index:0}}else{d=b.attr("id").split("_")[0].split("connect")[0];a=b.data("shapeId");a=ShapeEditor.select.check(a);b=c?c:ShapeEditor.select.shapes;e=c?c[0].box.data("shapeData"):a.shape.data}e=e.props.transform;var i=e.rotate?e.rotate:0,k=ShapeEditor.resize.getCornerPoints(e.pos,e.dim,i),l=ShapeEditor.resize.bbox,j=k[l[d].p1],m=k[l[d].p2],
o=k[l[d].p3];k=k[l[d].p4];var n=l[d].signX,q=l[d].signY,p=[],r=[];f.each(b,function(s,v){var t=v.data.props.transform,u=t.rotate?t.rotate:0,w=t.dim;r[s]=ShapeEditor.resize.getDirectionBox(d,i-u);t=ShapeEditor.resize.getCornerPoints(t.pos,w,u);p[s]=t[l[r[s]].anchor]});b=ShapeEditor.config.get.scale();ShapeEditor.event.bind(this,{currentShape:a,bbox:r,angle:i,p1:j,p2:m,p3:o,p4:k,signX:n,signY:q,anchor:p,constant:l[d].constant,dim:e.dim,offset:ShapeEditor.config.container.offset(),scaleFactor:b,createShape:g,
externalShapes:c})}},get:function(a){a.data.createShape&&ShapeEditor.draw.preset.create(a);var b=(a.pageX-a.data.offset.left)/a.data.scaleFactor,c=(a.pageY-a.data.offset.top)/a.data.scaleFactor;a.data.position={x:b,y:c};a.data.x=a.data.constant!=="x"&&a.data.dim.width?zoho.math.distanceOf(a.data.p1,a.data.p2,b,c)/a.data.dim.width:0;a.data.y=a.data.constant!=="y"&&a.data.dim.height?zoho.math.distanceOf(a.data.p3,a.data.p4,b,c,true)/a.data.dim.height:0},move:function(a,b,c){if(typeof c.data.flipx===
"undefined"){c.data.flipx=false;c.data.flipy=false}var d=c.data.props.transform,e=d.rotate?d.rotate:0,g=a.data.externalShapes?a.data.externalShapes[b].data:ShapeEditor.select.shapes[b].data,i=g.props.transform.dim,k=g.props.transform.pos,l=a.data.bbox[b],j=a.data.angle-e,m=ShapeEditor.smartguide,o=a.data.currentShape;if(ShapeEditor.showSmartGuides&&a.data.smartGuideChange)if(!(o&&b===o.index)){a.data.x=a.data.smartGuide_event_x;a.data.y=a.data.smartGuide_event_y}var n=a.data.x,q=a.data.y;n*=a.data.signX;
q*=a.data.signY;j=Math.abs(j);if(j>this.degree44&&j<this.degree135||j>this.degree225&&j<this.degree315){j=q;q=n;n=j}j=i.width+i.width*n;var p=i.height+i.height*q;q=j<0?-1:1;n=p<0?-1:1;var r=f.extend(true,{},a.data.anchor[b]);if(a.data.createShape&&a.data.createShape.data.type!==f.ShapeConstants.ShapeNodeType.CONNECTOR){var s={};r=f.extend(true,{},a.data.anchor[b]);if(j<0){r.x=(a.pageX-a.data.offset.left)/a.data.scaleFactor;s.x=true}if(p<0){r.y=(a.pageY-a.data.offset.top)/a.data.scaleFactor;s.y=true}}else{r=
a.data.anchor[b];if(j<0&&!c.data.flipx){d.fliph=!d.fliph;c.data.flipx=true}if(j>0&&c.data.flipx){d.fliph=!d.fliph;c.data.flipx=false}if(p<0&&!c.data.flipy){d.flipv=!d.flipv;c.data.flipy=true}if(p>0&&c.data.flipy){d.flipv=!d.flipv;c.data.flipy=false}}var v=l;if(c.data.flipx&&!c.data.flipy){v=this.bbox[l].flipx;isNeg=this.bbox[this.bbox[l].flipx].isNeg}else if(!c.data.flipx&&c.data.flipy){v=this.bbox[l].flipy;isNeg=this.bbox[this.bbox[l].flipy].isNeg}else if(c.data.flipx&&c.data.flipy){v=this.bbox[l].flipxy;
isNeg=this.bbox[this.bbox[l].flipxy].isNeg}else isNeg=this.bbox[l].isNeg;j=Math.abs(j);p=Math.abs(p);d={width:j,height:p,fliph:d.fliph,flipv:d.flipv};var t,u=false;if(ShapeEditor.config.isSupported.connector&&c.data.type===f.ShapeConstants.ShapeNodeType.CONNECTOR&&ShapeEditor.select.shapes.length===1){r=(t=ShapeEditor.connector.dragConnector(a,c,b,l,r))&&t.anchor?t.anchor:r;e=t&&typeof t.rotate!=="undefined"?t.rotate:e;isNeg=typeof c.data.isNeg!=="undefined"?c.data.isNeg:isNeg;j=t&&t.width?t.width:
j;p=t&&t.height?t.height:p;u=t&&t.connectorData&&(t.connectorData.start&&t.connectorData.start.id||t.connectorData.end&&t.connectorData.end.id);d=f.extend(true,d,t)}g=(g=g.nvOProps.nvODProps?g.nvOProps.nvODProps.locks:undefined)&&g.noAspectChange;g=ShapeEvent.keyEvent.shiftKey?!g:g;t=false;if(!u&&g){var w;if(c.data.type===f.ShapeConstants.ShapeNodeType.CONNECTOR)if(Math.abs(p)>Math.abs(j)){u=0;w=p}else{w=0;u=j}else{u=i.height?i.width/i.height:1;if(t=(t=l==="ebox"||l==="wbox")?true:!(t||l==="nbox"||
l==="sbox")?j>p*u:false){w=j/u;u=j}else{u*=p;w=p}if(a.data.createShape){if(s.x)r.x=k.left-u;if(s.y)r.y=k.top-w}}j=u;p=w;d.width=u;d.height=w}k=i.width-j;s=i.height-p;u=f.extend(true,{},r);if(g)u=ShapeEditor.resize.getTangentialAnchor(e,l,r,k,s);e=VectorUtil.positionShape(e,[j,p],u,c.box,isNeg);d.left=e.left;d.top=e.top;c.box.data("dim",d);if(m&&Math.abs(k)>=m.smartGuideProximity||Math.abs(s)>=m.smartGuideProximity)ShapeEditor.showSmartGuides=true;if(c.data.type!==f.ShapeConstants.ShapeNodeType.CONNECTOR&&
ShapeEditor.showSmartGuides)if(o&&o.index===b){a.data.smartGuideChange=m.set(d,c.data,a.data,r,isNeg,v,g,i);if(a.data.smartGuideChange){m=a.data.x<0?-1:1;o=a.data.y<0?-1:1;if(g)if(t){a.data.smartGuide_event_x=Math.abs(d.width*q/i.width-1)*m;a.data.smartGuide_event_y=a.data.y}else{a.data.smartGuide_event_x=a.data.x;a.data.smartGuide_event_y=Math.abs(d.height*n/i.height-1)*o}else{a.data.smartGuide_event_x=Math.abs(d.width*q/i.width-1)*m;a.data.smartGuide_event_y=Math.abs(d.height*n/i.height-1)*o}}}ShapeEditor.resize.setData(c.data,
c.box,d);a.data.externalShapes&&a.data.externalShapes[b].box.data("shapeData",c.data)},set:function(a,b,c){b=b.data("dim");return this.setData(a,c,b)},setData:function(a,b,c){var d=[],e=a.nvOProps.nvODProps&&a.nvOProps.nvODProps.locks?a.nvOProps.nvODProps.locks:undefined;if(!(e&&(e.noResize||e.noModify))){d=a.props.transform;e=d.dim;var g=d.pos;e.width=c.width;e.height=c.height;g.left=c.left;g.top=c.top;if(typeof c.fliph!=="undefined")d.fliph=c.fliph;if(typeof c.flipv!=="undefined")d.flipv=c.flipv;
e={};e.props={};d=ShapeEditor.resize.setConnectorData(a,b,c,e);g=ShapeEditor.config.get.shapeContainer();e.props.transform={dim:{width:c.width,height:c.height},pos:{left:c.left,top:c.top}};e.props.transform.fliph=typeof c.fliph!=="undefined"?c.fliph:undefined;e.props.transform.flipv=typeof c.flipv!=="undefined"?c.flipv:undefined;e.props.transform.rotate=typeof c.rotate!=="undefined"?c.rotate:undefined;e.props.geom=typeof c.geom!=="undefined"?c.geom:undefined;a.type===f.ShapeConstants.ShapeNodeType.GRAPHICFRAME&&
a.obj.type==="TABLE"&&this.getModDataForGraphicFrame(e,a,b);if(a.type===f.ShapeConstants.ShapeNodeType.GROUPSHAPE)f.GroupShape.props.transform.set(a,g,b);else if(a.type==f.ShapeConstants.ShapeNodeType.GRAPHICFRAME)GraphicFrame.props.transform.set(a,g,b);else{Shape.props.transform.set(a,g,b);Shape.props.transform.dependency(a,g,b)}if(a.type!==f.ShapeConstants.ShapeNodeType.CONNECTOR){if(!c.width)c.width=1;if(!c.height)c.height=1}d.push({id:a.nvOProps.nvDProps.id,data:{action:"modify",data:f.extend(true,
{},e)}})}return d},getDimOfTable:function(a){var b=a.obj.table.row,c=0,d=0;f.each(a.obj.table.grid.col,function(e,g){c+=g.width});f.each(b,function(e,g){d+=g.height});a={};a.height=d;a.width=c;return a},getModDataForGraphicFrame:function(a,b){f.extend(true,{},ShapeEditor.config.get.shape(b.nvOProps.nvDProps.id));var c=this.getDimOfTable(b),d=a.props.transform.dim,e=[],g=[],i=b.obj.table.grid.col,k=b.obj.table.row,l=d.width/c.width,j=d.height/c.height;f.each(i,function(m,o){var n=o.width*l;n={width:n?
n:15};i[m].width=n.width;e.push(n)});a.obj={};a.obj.table={};a.obj.table.grid={};a.obj.table.grid.col=e;f.each(k,function(m,o){var n=o.height*j;n={height:n?n:39};k[m].height=n.height;g.push(n)});a.obj.table.row=g},setConnectorData:function(a,b,c,d){var e=[];if(a.type===f.ShapeConstants.ShapeNodeType.CONNECTOR&&ShapeEditor.select.shapes.length===1){a.props.transform.rotate=c.rotate;if(c.geom){a.props.geom=c.geom;Shape.props.geom.set(a,ShapeEditor.config.container.element,b);Shape.props.geom.dependency(a,
ShapeEditor.config.container.element,b);d.props.geom={preset:{modifiers:c.geom.preset.modifiers,type:c.geom.preset.type},type:f.ShapeConstants.ShapeGeometryType.PRESET}}if(c.connectorData){a.nvOProps.nvODProps=a.nvOProps.nvODProps?a.nvOProps.nvODProps:{};b=c.connectorData;if(b.start)if(c=b.start!==a.nvOProps.nvODProps.start?true:b.start.id!==a.nvOProps.nvODProps.start.id?true:false)if(b.start.id){a.nvOProps.nvODProps.start=b.start;d.nvOProps={nvODProps:{start:{id:b.start.id,index:b.start.index}}}}else if(a.nvOProps.nvODProps.start){delete a.nvOProps.nvODProps.start;
e.push({id:a.nvOProps.nvDProps.id,data:{action:"removeData",data:["nvOProps.nvODProps.start"]}})}if(b.end)if(c=b.end!==a.nvOProps.nvODProps.end?true:b.end.id!==a.nvOProps.nvODProps.end.id?true:false)if(b.end.id){a.nvOProps.nvODProps.end=b.end;d.nvOProps={nvODProps:{end:{id:b.end.id,index:b.end.index}}}}else if(a.nvOProps.nvODProps.end){delete a.nvOProps.nvODProps.end;e.push({id:a.nvOProps.nvDProps.id,data:{action:"removeData",data:["nvOProps.nvODProps.end"]}})}}}return e},updateInfo:function(a){var b=
[],c=ShapeEvent.checkLockStatus(a,"Modify"),d=ShapeEditor.config.isSlideLocked();if(!c&&!d){a=a.data.props.transform.dim;c=ShapeEditor.config.get.label("width");d=ShapeEditor.config.get.label("height");b.push(c+" : "+Math.round(a.width)+"px");b.push(d+" : "+Math.round(a.height)+"px")}return b},keyEvent:function(a,b){var c=a.data.props.transform.dim,d=a.data.props.transform.pos,e=c.width,g=c.height,i=d.left,k=d.top;e=c.width+b[0]*c.width;g=c.height+-1*b[1]*c.height;if((i=a.data.nvOProps.nvODProps?
a.data.nvOProps.nvODProps.locks:undefined)&&i.noAspectChange){i=c.height?c.width/c.height:1;if(b[0])g=e/i;else e=g*i}i=d.left-(e-c.width)*0.5;k=d.top-(g-c.height)*0.5;return ShapeEditor.resize.setData(a.data,a.box,{width:e,height:g,left:i,top:k})},getCornerPoints:function(a,b,c,d){c=c?c:0;if(d){e=d.cx;d=d.cy}else{var e=a.left+b.width*0.5;d=a.top+b.height*0.5}var g=a.left+b.width,i=a.top+b.height;b=zoho.math.getRotatedValue(c,a.left,a.top,e,d);var k=zoho.math.getRotatedValue(c,g,a.top,e,d);a=zoho.math.getRotatedValue(c,
a.left,i,e,d);c=zoho.math.getRotatedValue(c,g,i,e,d);return{c1:b,c2:k,c3:a,c4:c}},getDirectionBox:function(a,b){if(a==="resizerbox")return a;var c=["nwbox","nbox","nebox","ebox","sebox","sbox","swbox","wbox"],d=-1;if(b<0)d=1;b=Math.abs(b);var e;f.each(c,function(g,i){if(i===a)e=g});if(b>this.degree44&&b<this.degree135)e-=2*d;else if(b>this.degree134&&b<this.degree225)e-=4*d;else if(b>this.degree224&&b<this.degree315)e-=6*d;if(e<0)e=8+e;e%=8;return c[e]}},crop:{CROPFRAME:"crop Frame",CROP_EDIT:"cropEdit",
cropBox:false,instance:{cropFrame:undefined,cropImage:undefined,actualImage:undefined,alreadyCroppped:undefined,initialTransform:undefined},removeCropFrame:function(){var a=ShapeEditor.crop;if(a.instance.cropImage){ShapeEditor.select.init();ShapeEditor.bbox.remove();ShapeEditor.config.get.shapeContainer();a.instance.cropFrame.box.remove();a.instance.cropImage.box.remove();var b=a.instance.actualImage;ShapeEditor.config.container.trigger("cropbox_removed");ShapeEditor.select.init(b.box);ShapeEditor.bbox.create(ShapeEditor.select.shapes[0].data,
b.box);ShapeEditor.crop.cropBox=false;a.instance={cropFrame:undefined,cropImage:undefined,actualImage:undefined,alreadyCroppped:undefined,initialTransform:undefined}}},refresh:function(){ShapeEditor.crop.removeCropFrame();var a=ShapeEditor.select.shapes[0];Shape.props.transform.set(a.data,ShapeEditor.config.get.shapeContainer(),a.box);ShapeEditor.crop.setCropBox()},edit:{down:function(){ShapeEditor.config.get.shapeContainer().children().filter(".bbox").addClass("croppingbbox");ShapeEditor.config.container.trigger("crop_editing")},
up:function(){var a=ShapeEditor.crop,b=a.instance.cropFrame,c=a.instance.cropImage;a=a.instance.actualImage;ShapeEditor.bbox.move(b.data,b.box);ShapeEditor.bbox.move(c.data,c.box);ShapeEditor.config.get.shapeContainer().children().filter(".bbox").removeClass("croppingbbox");b=a.data.nvOProps.nvProps&&a.data.nvOProps.nvProps.placeHolder;Shape.create.editData.icon.show(a.data,ShapeEditor.config.container);ShapeEditor.config.container.trigger("crop_edited",{placeHolder:b});ShapeEditor.select.init();
ShapeEditor.select.init(a.box,a.data)}},setCropBox:function(){var a=ShapeEditor.crop;if(!ShapeEditor.crop.cropBox){var b=ShapeEditor.select.shapes;if(!(b==undefined||b.length>1)){b=b[0];if(b.data.type==f.ShapeConstants.ShapeNodeType.PICTURE){var c=ShapeEditor.config.get.shapeContainer(),d=b.data;bx=f("#"+d.nvOProps.nvDProps.id,c);var e=f("#"+Shape.iconCapsuleEditIcon,bx);e.css("display","block");Shape.create.placeHolder.icon.position(d.props.transform,e);if(e.hasClass("placeholdereditbutton")){e.removeClass("placeholdereditbutton").addClass("doneiconbutton");
e.attr("title",f.i18n("show.editor.clicktocrop")).text(f.i18n("show.editor.picturecropdone"));e.attr("onclick","ShapeEditor.crop.cropImage()")}e=b.box;e.addClass("cropShape");a.instance.alreadyCroppped=d.crop?f.extend(true,{},d.crop):false;a.instance.initialTransform=f.extend(true,{},d.props.transform);var g={};g.data=f.extend(true,{},d);a.modify.cropImageData(g.data,d);delete g.data.editData;g.box=Shape.create.draw(g.data,c);g.box.insertBefore(e);a.modify.cropImageBox(g.box,g.data);var i={};i.data=
f.extend(true,{},ShowDefault.getCropShape("cropBox"));a.modify.cropFrameData(i.data,d);i.box=Shape.create.draw(i.data,c);i.box.insertAfter(e);a.modify.cropFrameBox(i.box,i.data);ShapeEditor.select.init();ShapeEditor.bbox.remove();ShapeEditor.select.init(i.box,i.data);ShapeEditor.select.init(g.box,g.data);ShapeEditor.bbox.create(g.data,g.box);ShapeEditor.bbox.create(i.data,i.box);ShapeEditor.bbox.remove("handle");a.instance.cropImage=g;a.instance.cropFrame=i;a.instance.actualImage=b;ShapeEditor.select.init();
ShapeEditor.select.init(b.box,b.data);ShapeEditor.crop.cropBox=true}}}},modify:{cropImageData:function(a,b){delete a.props.effects;delete a.textBody;delete a.crop;a.nvOProps.nvDProps.id+="cropImage";if(a.props.stroke&&a.props.stroke.fill)a.props.stroke.fill.type="NONE";var c=b.crop?f.extend(true,{left:0,top:0,bottom:0,right:0},b.crop):{left:0,top:0,bottom:0,right:0};if(b.props.transform.fliph){var d=c.left;c.left=c.right;c.right=d}if(b.props.transform.flipv){d=c.top;c.top=c.bottom;c.bottom=d}d=b.props.transform;
var e={cx:d.pos.left+d.dim.width*0.5,cy:d.pos.top+d.dim.height*0.5};d={dim:{},pos:{}};d.dim.width=b.props.transform.dim.width/(1-(c.left+c.right));d.dim.height=b.props.transform.dim.height/(1-(c.top+c.bottom));d.pos.left=b.props.transform.pos.left-c.left*d.dim.width;d.pos.top=b.props.transform.pos.top-c.top*d.dim.height;c=b.props.transform.rotate?b.props.transform.rotate:0;e=ShapeEditor.resize.getCornerPoints(d.pos,d.dim,c,e);var g={cx:(e.c1.x+e.c4.x)*0.5,cy:(e.c1.y+e.c4.y)*0.5};c=zoho.math.getRotatedValue(-1*
c,e.c1.x,e.c1.y,g.cx,g.cy);d.pos.left=c.x;d.pos.top=c.y;d.rotate=b.props.transform.rotate?b.props.transform.rotate:0;d.flipH=b.props.transform.flipH;d.flipV=b.props.transform.flipV;a.cropBox=true;f.extend(true,a.props.geom,{type:f.ShapeConstants.ShapeGeometryType.PRESET,preset:{type:f.ShapeConstants.PresetShapeGeometry.RECT}});f.extend(true,a.props.transform,d);a.noEventShapeInfo=true},cropImageBox:function(a,b){var c=a.data("greymask");if(!c){c=f("<div></div>");c.addClass("greymask");a.append(c);
a.data("greymask",c)}c.css({width:b.props.transform.dim.width,height:b.props.transform.dim.height});VectorUtil.rotateElement(c,{width:b.props.transform.dim.width,height:b.props.transform.dim.height},1,b.props.transform.rotate);a.addClass("crop Image")},cropFrameData:function(a,b){a.nvOProps.nvDProps.id=b.nvOProps.nvDProps.id+"cropFrame";a.props.geom=f.extend(true,{},b.props.geom);f.extend(true,a.props.transform,b.props.transform);a.scale=b.scale;a.cropBox=true;a.noEventShapeInfo=true},cropFrameBox:function(a){a.addClass("crop Frame")}},
revert:function(a){delete a.crop;ShapeEditor.crop.crop()},cropImage:function(){ShapeEditor.crop.instance.actualImage.box.removeClass("cropShape");var a=this.crop();a.length&&ShapeEditor.config.container.trigger("modified",{shapeData:a,appData:{action:"Editor"}});ShapeEditor.crop.removeCropFrame()},crop:function(){var a=ShapeEditor.crop,b=[],c=a.instance.cropImage,d=a.instance.actualImage,e=c.data.props.transform,g=a.instance.cropFrame.data.props.transform,i=ShapeEditor.resize.getCornerPoints(e.pos,
e.dim,e.rotate),k=ShapeEditor.resize.getCornerPoints(g.pos,g.dim,g.rotate),l=zoho.math.distanceOf(i.c1,i.c3,k.c1.x,k.c1.y)/e.dim.width,j=zoho.math.distanceOf(i.c1,i.c2,k.c1.x,k.c1.y,true)/e.dim.height,m=-1*zoho.math.distanceOf(i.c2,i.c4,k.c2.x,k.c2.y)/e.dim.width;i=-1*zoho.math.distanceOf(i.c3,i.c4,k.c3.x,k.c3.y,true)/e.dim.height;e=d.data;if(e.props.transform.fliph){k=l;l=m;m=k}if(e.props.transform.flipv){k=j;j=i;i=k}l={left:zoho.math.roundDecimal(l,4),top:zoho.math.roundDecimal(j,4),bottom:zoho.math.roundDecimal(i,
4),right:zoho.math.roundDecimal(m,4)};j=e.props.transform.dim;m=e.props.transform.pos;e.crop=l;j.width=g.dim.width;j.height=g.dim.height;m.left=g.pos.left;m.top=g.pos.top;g=d.box;Shape.picture.set(e,ShapeEditor.config.container,d.box);Shape.props.transform.set(e,ShapeEditor.config.container,g);Shape.props.transform.dependency(e,ShapeEditor.config.container,g);d={};g=a.instance.initialTransform.dim;i=a.instance.initialTransform.pos;j.height===g.height&&j.width===g.width&&m.left===i.left&&m.top===i.top||
f.extend(true,d,{props:{transform:{dim:{height:j.height,width:j.width},pos:{left:m.left,top:m.top}}}});g=a.instance.alreadyCroppped;if(!l.left&&!l.top&&!l.right&&!l.bottom){f.isEmptyObject(d)||b.push({id:e.nvOProps.nvDProps.id,data:{action:"modify",data:d}});a.instance.alreadyCroppped&&b.push({id:e.nvOProps.nvDProps.id,data:{action:"removeData",data:["crop"]}})}else{if(!(g.left===l.left&&g.top===l.top&&g.bottom===l.bottom&&g.right===l.right))d.crop=f.extend(true,{},l);f.isEmptyObject(d)||b.push({id:e.nvOProps.nvDProps.id,
data:{action:"modify",data:d}})}a.modify.cropImageBox(c.box,c.data);return b}},pictureProps:{transparency:function(){ShapeEditor.pictureProps.setTransparentColor=true},modifyPictureData:function(a,b,c){b={from:{rgb:c,type:"CUSTOM"},to:{rgb:c,tweaks:{alpha:1},type:"CUSTOM"}};a.pictureProps.colorChange=b;c=[];c.push({id:a.nvOProps.nvDProps.id,data:{action:"modify",data:{pictureProps:{colorChange:b}}}});ShapeEditor.config.container.trigger("modified",{shapeData:c,appData:{action:"Editor"}})},transparentColor:function(a){var b=
f(a.target).closest("."+Shape.shapeClass).offset();this.setTransparent({left:a.pageX,top:a.pageY},b)},setTransparent:function(a,b){var c=ShapeEditor.config.get.shapeContainer().offset(),d={left:b.left-c.left,top:b.top-c.top},e={left:a.left-c.left,top:a.top-c.top};c=ShapeEditor.select.shapes[0].data;var g=(e.left-d.left)/c.scale;d=(e.top-d.top)/c.scale;c.colorChange=true;d={posx:g,posy:d};if(!c.pictureProps)c.pictureProps={};c.pictureProps.colorChange=f.extend(true,c.pictureProps.colorChange,d);Shape.pictureProps.set(c,
ShapeEditor.config.container);f(document).one("SVG_pictureprops_modified",function(i,k){f("body").css({cursor:"default"});k.colorChange=false;Shape.props.effects.reflection.set(k,ShapeEditor.config.container);ShapeEditor.pictureProps.setTransparentColor=false})}},remove:function(a){var b=ShapeEditor.config.get.shapeContainer();a=f("#"+a,b);f(a).remove();ShapeEditor.bbox.remove()},setSnapWidth:function(a){this.snapWidth=a},updateConnector:function(a){var b=a.nvOProps.nvODProps;if(b){if(b.start){var c=
ShapeEditor.select.check(b.start.id);if(c){c=ShapeEditor.select.shapes[c.index].connector;this.insertConnectorData(a,c,"start")}}if(b.end)if(b=ShapeEditor.select.check(b.end.id)){c=ShapeEditor.select.shapes[b.index].connector;this.insertConnectorData(a,c,"end")}}},insertConnectorData:function(a,b,c){var d=true,e=ShapeEditor.config.get.shapeContainer();f.each(b,function(g,i){if(i.data.nvOProps.nvDProps.id===a.nvOProps.nvDProps.id)return d=false});if(d){c={data:a,box:f("#"+a.nvOProps.nvDProps.id,e),
pos:c};b.push(c)}},refreshEditor:function(a,b){var c=ShapeEditor.getEditorState(),d=ShapeEditor.config.get.shapeContainer();if(c){var e=ShapeEditor.select.shapes;if(a){a=a.groupshape?a.groupshape:a;var g=a.nvOProps.nvDProps.id,i=ShapeEditor.select.check(g);if(i&&!i.grpShape){if(a.type===f.ShapeConstants.ShapeNodeType.GRAPHICFRAME)c=c===ShapeEditor.textEditing?ShapeEditor.shapeSelected:c;e=[ShapeEditor.select.shapes[i.index]];ShapeEditor.select.update(e[0],a)}else if(i&&i.grpShape){e=[ShapeEditor.select.shapes[i.index]];
ShapeEditor.select.update(e[0],a,g)}else if(c!==ShapeEditor.cropped)e=[];a.type===f.ShapeConstants.ShapeNodeType.CONNECTOR&&i&&!i.grpShape&&ShapeEditor.updateConnector(a)}var k=ShapeEditor.select.shapes,l;if(k&&k[0]&&k[0].parentIds.length&&!(a&&a.nvOProps))l=true;if(!l){b&&b.NoCursorModify||ShapeEditor.config.isSupported.text&&c===ShapeEditor.textEditing&&ShapeEditor.text.refresh(i);if(!(b&&b.NoSelection)){ShapeEditor.bbox.remove(g);if(!e.length&&k&&k[0]&&k[0].parentIds.length)l=true;f.each(e,function(j,
m){!a&&c!==ShapeEditor.cropped&&ShapeEditor.select.update(m);ShapeEditor.refreshShape(m,c)})}}if(l){g=k[0].parentIds[k[0].parentIds.length-1];d=f("#"+g,d);a=a?a:ShapeEditor.config.get.shape(g);ShapeEditor.select.init(d,a);ShapeEditor.bbox.create(a,d);ShapeEditor.unselectShape(ShapeEditor.select.shapes[0].data.nvOProps.nvDProps.id);ShapeEditor.text.editor.clear()}ShapeEditor.config.container.trigger("selectedShape_modified")}},refreshShape:function(a,b){if(!f.isEmptyObject(a)){var c=ShapeEditor.config.container,
d=a.data;d=d.groupshape?d.groupshape:d;c=f("#"+d.nvOProps.nvDProps.id,c);switch(b){case ShapeEditor.cropped:ShapeEditor.crop.cropBox&&ShapeEditor.crop.removeCropFrame();break;case ShapeEditor.textEditing:ShapeEditor.config.isSupported.text&&ShapeEditor.text.refresh();break;case ShapeEditor.shapeSelected:if(!Shape.touchDevice){d.type===f.ShapeConstants.ShapeNodeType.GRAPHICFRAME&&d.obj.type==="TABLE"&&Table.updateTableDimensionData(d,c);ShapeEditor.bbox.create(d,c)}break;case ShapeEditor.transparent:if(!Shape.touchDevice){ShapeEditor.bbox.create(d,
c);f("body").css({cursor:"pointer"})}}}},getEditorState:function(){var a=undefined;if(ShapeEditor.crop.cropBox)a=ShapeEditor.cropped;else if(ShapeEditor.config.isSupported.text&&!isNaN(ShapeEvent.text.from.num.para))a=ShapeEditor.textEditing;else if(ShapeEditor.pictureProps.setTransparentColor)a=ShapeEditor.transparent;else if(ShapeEditor.select.shapes.length>0)a=ShapeEditor.shapeSelected;return a},isEditorOnFocus:function(){var a=f(document.activeElement),b=ShapeEditor.config.drawcontainer.attr("id");
return!!a.closest("#"+b).length},suspendEditor:function(){ShapeEditor.config.drawcontainer.blur()},focusEditor:function(){var a=ShapeEditor.config.container.data("lock")?true:false;ShapeEditor.config.isSupported.text&&ShapeEvent.IMESupport&&ShapeEvent.text.editing()&&!a?ShapeEditor.text.editor.focusEditor():ShapeEditor.focusShape()},focusShape:function(){var a=ShapeEditor.config.container.data("lock")?true:false;if(ShapeEditor.config.isSupported.text&&ShapeEvent.IMESupport)a||ShapeEditor.text.editor.focusEditor();
else ShapeEditor.config.focusDrawContainer();ShapeEditor.config.container.trigger("focused")},cursorIndexOnBlur:undefined,editorOnBlur:function(){ShapeEditor.config.isSupported.text&&ShapeEditor.text.editor.editorOnBlur()},editorOnFocus:function(){ShapeEditor.config.isSupported.text&&ShapeEditor.text.editor.editorOnFocus()},noSelect:function(a,b){ShapeEditor.bbox.create(b);ShapeEditor.showNotify(a,b)},showNotify:function(a,b){var c;if(b.type===f.ShapeConstants.ShapeNodeType.GROUPSHAPE)c=ShapeEditor.config.get.label("cannotedit"+
b.type.toLowerCase());else if(b.nvOProps.nvODProps&&b.nvOProps.nvODProps.locks&&b.nvOProps.nvODProps.locks.noSelect)c=ShapeEditor.config.get.label("cannoteditnoselect");var d=f("<div class='ui-status-wrapper'><div id = 'shapeNotify' class = 'ui-state-info ui-corner-all ui-znotifier'><span class = 'ui-znotifier-message'>"+c+"</span></div></div>");d.css({position:"absolute",left:a.pageX+30+"px",top:a.pageY-30+"px","z-index":1E4});f(document.body).append(d);setTimeout(function(){d.fadeOut(1500,function(){d.remove();
ShapeEditor.bbox.remove(b.nvOProps.nvDProps.id)})},500)},outerBBox:function(a){a=typeof a==="object"?a:ShapeEditor.config.get.shape(a);var b=a.props.transform,c=b.rotate?b.rotate:0,d=ShapeEditor.resize.getCornerPoints(b.pos,b.dim,c),e=ShapeEditor.config?ShapeEditor.config.get.shapeContainer():f("body"),g=f("#"+a.nvOProps.nvDProps.id,e);e=g.data("handles");var i=[];f.each(d,function(n,q){i.push({x:q.x,y:q.y})});var k=[];e&&f.each(e,function(n,q){xval=b&&b.fliph?b.dim.width-q[0]:q[0];yval=b&&b.flipv?
b.dim.height-q[1]:q[1];hval=zoho.math.getRotatedValue(c,xval,yval,b.dim.width*0.5,b.dim.height*0.5);var p={x:hval.x+b.pos.left,y:hval.y+b.pos.top};k.push(p);i.push(p)});if(a.props.effects){d=a.props.effects;var l=(d=d.shadow?d.shadow.distance:d.reflection?d.reflection.distance:undefined)&&d.angle?d.angle:0,j=d&&d.radius?d.radius:0;if(a.props.effects.shadow){d=zoho.math.toRadians(l);var m=j*Math.cos(d),o=j*Math.sin(d);d=ShapeEditor.resize.getCornerPoints({left:m+b.pos.left,top:o+b.pos.top},b.dim,c);
f.each(d,function(n,q){i.push({x:q.x,y:q.y})});e&&f.each(k,function(n,q){i.push({x:m+q.x,y:o+q.y})})}f.isEmptyObject(a.props.effects.reflection)||f.each([Shape.shapeId,Shape.reflectionShapeId],function(n,q){Shape.creator.pathContainer(g,q);var p=a.props.effects.reflection.pos,r=VectorUtil.getMinAndMax(i),s=r.big;i.push({x:s.x,y:s.y+((r.big.y-r.small.y)*p.end+j)})})}d=this.getMarkerDim(a);e=VectorUtil.getMinAndMax(i);l=a.props.stroke.width?a.props.stroke.width:0;d=10+l*0.5+d*l;return[{x:e.small.x-
d,y:e.small.y-d},{x:e.big.x+d,y:e.big.y+d}]},getMarkerDim:function(a){var b=a.props.stroke.headend,c=a.props.stroke.tailend,d=a=0;if(b){d=f.Stroke.marker[0][b.width];a=f.Stroke.marker[0][b.height]}if(c){b=f.Stroke.marker[0][c.width];c=f.Stroke.marker[0][c.height];a=a>c?a:c;d=d>b?d:b}return marker=a>d?a:d}}})(jQuery);
(function(p){p.BBoxConstant={border:{type:"SHAPE",shape:{nvOProps:{nvDProps:{id:"border"}},props:{transform:{fliph:false,flipv:false,dim:{width:8,height:8},pos:{left:10,top:10,zindex:9999}},stroke:{type:"DASH",width:1,jointype:"ROUND",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[111,111,111]}}},captype:"FLAT"},geom:{type:"PRESET",preset:{type:"RECT"}}}}},rotate:{type:"SHAPE",shape:{nvOProps:{nvDProps:{id:"rotate"}},props:{transform:{fliph:false,flipv:false,dim:{width:8,height:8},pos:{left:10,
top:10,zindex:1E4}},fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[195,234,115]}}},stroke:{type:"SOLID",width:1,jointype:"MITER",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[64,64,64]}}}},geom:{type:"PRESET",preset:{type:"OVAL"}}}}},borderframe:{type:"SHAPE",shape:{nvOProps:{nvDProps:{id:"borderframe"}},props:{transform:{fliph:false,flipv:false,dim:{width:8,height:8},pos:{left:10,top:10,zindex:1E4}},fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[198,224,253]}}},stroke:{type:"SOLID",
width:1,jointype:"MITER",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[158,196,237]}}}},geom:{type:"PRESET",preset:{type:"FRAME"}}}}},other:{type:"SHAPE",shape:{nvOProps:{nvDProps:{id:"other"}},props:{transform:{fliph:false,flipv:false,dim:{width:8,height:8},pos:{left:10,top:10,zindex:1E4}},fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[193,227,232]}}},stroke:{type:"SOLID",width:1,jointype:"MITER",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[127,127,127]}}}},geom:{type:"PRESET",
preset:{type:"RECT"}}}}},lock_border:{type:"SHAPE",shape:{nvOProps:{nvDProps:{id:"border"}},props:{transform:{fliph:false,flipv:false,dim:{width:8,height:8},pos:{left:10,top:10,zindex:9999}},stroke:{type:"SOLID",width:1,jointype:"ROUND",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[111,111,111]}}},captype:"FLAT"},geom:{type:"PRESET",preset:{type:"RECT"}}}}},cropcenter:{type:"SHAPE",shape:{nvOProps:{nvDProps:{id:"cropcenter"}},props:{transform:{fliph:false,flipv:false,dim:{width:15,height:5},
pos:{left:10,top:10,zindex:1E4}},fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[252,240,23]}}},stroke:{type:"SOLID",width:1,jointype:"MITER",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[0,0,0]}}}},geom:{type:"PRESET",preset:{type:"RECT"}}}}},handle:{type:"SHAPE",shape:{nvOProps:{nvDProps:{id:"handle"}},props:{transform:{fliph:false,flipv:false,dim:{width:9,height:9},pos:{left:10,top:10,zindex:1E4}},fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[252,240,23]}}},stroke:{type:"SOLID",
width:1,jointype:"MITER",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[64,64,64]}}}},geom:{type:"PRESET",preset:{type:"DIAMOND"}}}}},resizerbox:{type:"PICTURE",picture:{nvOProps:{nvDProps:{id:"resizerbox"}},value:{id:"resizerbox",type:"EXTERNAL",url:"url"},props:{transform:{fliph:false,flipv:false,dim:{width:8,height:8},pos:{left:10,top:10,zindex:1E4}},geom:{type:"PRESET",preset:{type:"RECT"}}}}},corner:{type:"SHAPE",shape:{nvOProps:{nvDProps:{id:"corner"}},props:{transform:{fliph:false,flipv:false,
dim:{width:8,height:8},pos:{left:10,top:10,zindex:1E4}},fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[193,227,232]}}},stroke:{type:"SOLID",width:1,jointype:"MITER",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[127,127,127]}}}},geom:{type:"PRESET",preset:{type:"OVAL"}}}}},connector:{type:"SHAPE",shape:{nvOProps:{nvDProps:{id:"connector"}},props:{transform:{fliph:false,flipv:false,dim:{width:8,height:8},pos:{left:10,top:10,zindex:1E4}},fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[240,
110,100],tweaks:{alpha:0}}}},stroke:{type:"SOLID",width:1,jointype:"ROUND",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[245,245,245],tweaks:{alpha:0.5}}}}},geom:{type:"PRESET",preset:{type:"BEVEL"}}}}},cropmiddle:{type:"SHAPE",shape:{nvOProps:{nvDProps:{id:"cropmiddle"}},props:{transform:{fliph:false,flipv:false,dim:{width:5,height:15},pos:{left:10,top:10,zindex:1E4}},fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[252,240,23]}}},stroke:{type:"SOLID",width:1,jointype:"MITER",fill:{type:"SOLID",
solid:{color:{type:"CUSTOM",rgb:[0,0,0]}}}},geom:{type:"PRESET",preset:{type:"RECT"}}}}},lock:{type:"SHAPE",shape:{nvOProps:{nvDProps:{id:"lock"}},props:{transform:{fliph:false,flipv:false,dim:{width:8,height:8},pos:{left:10,top:10,zindex:1E4}},fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[124,124,124]}}},stroke:{type:"SOLID",width:1,jointype:"MITER",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[0,0,0]}}}},geom:{type:"PRESET",preset:{type:"LOCK_SYMBOL"}}}}},cropcorner:{type:"SHAPE",shape:{nvOProps:{nvDProps:{id:"cropcorner"}},
props:{transform:{fliph:false,flipv:false,dim:{width:10,height:10},pos:{left:10,top:10,zindex:1E4}},fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[252,240,23]}}},stroke:{type:"SOLID",width:1,jointype:"MITER",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[0,0,0]}}}},geom:{type:"PRESET",preset:{type:"LSHAPE"}}}}},li:{type:"SHAPE",shape:{nvOProps:{nvDProps:{id:"li"}},props:{transform:{fliph:false,flipv:false,dim:{width:0,height:25},pos:{left:10,top:10,zindex:1E4}},fill:{type:"SOLID",solid:{color:{type:"CUSTOM",
rgb:[252,240,23]}}},stroke:{type:"SOLID",width:1,jointype:"MITER",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[64,64,64]}}}},geom:{type:"PRESET",preset:{type:"LINE"}}}}},value:{li:"li",nwbox:"corner",nbox:"other",nebox:"corner",ebox:"other",sebox:"corner",sbox:"other",swbox:"corner",wbox:"other",rotate:"rotate",border:"border",borderframe:"borderframe",resizerbox:"resizerbox"},crop:{type:"SHAPE",shape:{nvOProps:{nvDProps:{id:"handle"}},props:{transform:{fliph:false,flipv:false,dim:{width:9,
height:9},pos:{left:10,top:10,zindex:1E4}},fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[252,240,23]}}},stroke:{type:"SOLID",width:1,jointype:"MITER",fill:{type:"SOLID",solid:{color:{type:"CUSTOM",rgb:[64,64,64]}}}},geom:{type:"PRESET",preset:{type:"RECT"}}}}}}})(jQuery);(function(p){ShapeEvent.connector={mouse:{move:function(b,c,d){if(!b.data)b.data={};var f=true;p.each(ShapeEditor.idContains,function(g,h){if(c.indexOf(h)!=-1)return f=false});if(b.data.targetId!=c){b.data.targetId=c;if(f)if(c.indexOf("connect")==-1&&c.indexOf("box")==-1&&c.indexOf("border")==-1){ShapeEditor.connector.removeConnectorPoints();ShapeEditor.connector.showConnectorPoints(d)}else{if(c.indexOf("connected")!=-1&&c.indexOf("box")!=-1&&c.indexOf("border")==-1){b=c.split("_")[0].split("connected")[1];
d=p("#"+b,ShapeEditor.config.container.element);ShapeEditor.connector.removeConnectorPoints();ShapeEditor.connector.showConnectorPoints(d)}}else ShapeEditor.connector.removeConnectorPoints()}}},key:{}}})(jQuery);(function(p){ShapeEvent.text={bx:undefined,current:undefined,offset:undefined,clonebox:undefined,roughSpace:undefined,textArea:undefined,flipFromTo:undefined,textContainer:undefined,isLineEnd:undefined,from:{num:{para:undefined,portion:undefined,ch:undefined,index:undefined,pos:undefined},element:{para:undefined,line:undefined,word:undefined,subword:undefined,charCount:undefined},pos:{para:undefined,line:undefined,word:undefined,subword:undefined},cursorPosLeft:undefined,height:undefined},to:{num:{para:undefined,
portion:undefined,ch:undefined,index:undefined,pos:undefined},element:{para:undefined,line:undefined,word:undefined,subword:undefined,charCount:undefined},pos:{para:undefined,line:undefined,word:undefined,subword:undefined},cursorPosLeft:undefined,height:undefined},IME:{contentEditable:undefined,defaultText:"&#8203",editing:undefined,destroy:function(){this.contentEditable&&this.contentEditable.length&&this.contentEditable.remove()},init:function(){this._textElementInit();this._bindEvents()},_textElementInit:function(){var b=
p('<span id="texteditable" contenteditable=true autocapitalize="none"></span>'),c=p('<div id = "scaleSpan"></div>'),d=p('<div id = "textContainerSpan"></div>');this.contentEditable=b;d.append(b);c.append(d);ShapeEditor.config.drawcontainer.append(c);ShapeEditor.text.editor.IMEHandler.init()},_bindEvents:function(){this._textElementBind();this.contentEditable.bind("cursorPositioned.Text",function(){var b=ShapeEvent.text.IME;if(ShapeEvent.text.IME.editing){if(b.contentEditable.closest("body").length==
0){var c=b.contentEditable.text();b._textElementInit();b._textElementBind();ShapeEditor.text.editor.addText(c);ShapeEditor.text.editor.focusEditor();b.contentEditable.html("<span>"+ShapeEvent.text.IME.defaultText+"</span>")}ShapeEditor.text.editor.focusEditor()}})},_textElementBind:function(){this.contentEditable.bind("focus.Text",function(b){var c=ShapeEvent.text.IME;c.contentEditable.trigger("textFocused",{id:c.contentEditable.attr("id")});ShapeEditor.text.editor.editorOnFocus();b.stopPropagation()});
this.contentEditable.bind("blur.Text",function(){ShapeEditor.text.editor.editorOnBlur()});ShapeEvent.isIE||this.contentEditable.bind("compositionstart.Text",function(){ShapeEditor.text.editor.IMEHandler.composition.start()});this.contentEditable.bind("compositionend.Text",function(){ShapeEvent.text.composing||ShapeEditor.text.editor.IMEHandler.composition.end()});this.contentEditable.bind("DOMCharacterDataModified.Text",function(b){if((b=b.newValue?b.newValue:ShapeEvent.text.IME.contentEditable.text())&&
b.indexOf("\u3000")!=-1){ShapeEditor.text.editor.IMEHandler.composition.end(" ");return false}if(ShapeEvent.text.IME.editing){b=ShapeEditor.text.editor.IMEHandler.shape;b.dummySpan.css({width:ShapeEvent.text.IME.contentEditable.width()});b.setPosition()}})}},operationKeys:{39:{m:["navigation","right"],eventKeys:{mac:{altKey:"word",metaKey:"line",shiftKey:"select"},other:{ctrlKey:"word",shiftKey:"select"}}},37:{m:["navigation","left"],eventKeys:{mac:{altKey:"word",metaKey:"line",shiftKey:"select"},
other:{ctrlKey:"word",shiftKey:"select"}}},40:{m:["navigation","down"],eventKeys:{mac:{altKey:"para",metaKey:"para",shiftKey:"select"},other:{ctrlKey:"para",shiftKey:"select"}}},38:{m:["navigation","up"],eventKeys:{mac:{altKey:"para",metaKey:"para",shiftKey:"select"},other:{ctrlKey:"para",shiftKey:"select"}}},35:{m:["navigation","end"],eventKeys:{mac:{shiftKey:"select",metaKey:"text"},other:{shiftKey:"select",ctrlKey:"text"}}},36:{m:["navigation","home"],eventKeys:{mac:{shiftKey:"select",metaKey:"text"},
other:{shiftKey:"select",ctrlKey:"text"}}},8:{m:["backspace"]},46:{m:["del"]},13:{m:["enter"]},27:{m:["clear"]},65:{m:["select","all"],eventKeys:{mandatory:true,mac:{metaKey:true},other:{ctrlKey:true}}}},isCompositionEventSupported:function(){},destroy:function(){ShapeEvent.IMESupport&&ShapeEvent.text.IME.destroy();this.roughSpace&&this.roughSpace.length&&this.roughSpace.remove();this.textArea&&this.textArea.length&&this.textArea.remove()},init:function(){ShapeEvent.text.isCompositionEventSupported();
var b=p('<div id="clonetextbox" class = "prewrap" style="z-index:-100;position:absolute;left:-1000px;top:-1000px;"></div>');this.roughSpace=b;ShapeEditor.config.drawcontainer.append(b);ShapeEvent.text.initClipBoard();ShapeEvent.IMESupport&&ShapeEvent.text.IME.init();var c;ShapeEditor.config.container.bind("props_reset",function(){clearTimeout(c);c=setTimeout(function(){ShapeEvent.text.editing()&&ShapeEditor.text.editor.cursor.refresh(ShapeEvent.text.from,ShapeEvent.text.to)},200)})},getTextContent:function(){var b=
this.textArea,c=b.val();b.val("");if(c){c=c.replace(/(\r\n|\n|\r|\t|\v)/gm," ");ShapeEditor.text.editor.addText(c,ShapeEvent.text)}setTimeout(function(){ShapeEditor.text.editor.focusEditor()},100)},pasteTextContent:function(){var b=this.textArea;b.val("");b.focus()},copyTextContent:function(){ShapeEvent.isCopying=true;var b=this.textArea,c=ShapeEditor.text.editor.selectedText();if(c){b.val(c);b.select();setTimeout(function(){ShapeEditor.text.editor.focusEditor()},100)}ShapeEvent.isCopying=false},
initClipBoard:function(){var b=document.body;ShapeEditor.config.drawcontainer.offset();var c=this.textArea=p('<textarea name="textclipboard"  style="position:absolute;left:-100px;top:-100px;z-index:-100;font-size:11px;" cols="" rows="" id="textclipboard"> Copy Paste Text Content </textarea>');p(b).append(c);if(document.documentElement.onpropertychange!==null&&typeof document.documentElement.onpropertychange=="object"&&p.support.animation)c[0].onpropertychange=function(d){ShapeEvent.isCopying||ShapeEvent.text.getTextContent(d)};
else c.bind("input.Text",function(d){ShapeEvent.text.getTextContent(d)})},editing:function(){return!isNaN(ShapeEvent.text.from.num.para)},edit:function(b,c,d){var f=false,g=b.ctrlKey||b.metaKey||b.shiftKey;if(!c){d||(d=ShapeEventHandler.getTarget(b));b=d.closest("."+Shape.textBody.wordId);if(b.length)c=d.closest("."+Shape.textBody.subwordId,b).length?Shape.textBody.subwordId:Shape.textBody.wordId}!this.editing()&&g||(f=c===Shape.textBody.wordId||c===Shape.textBody.subwordId||c===Shape.textBody.subportionId||
c===Shape.textBody.bullet);return f},textTarget:function(b,c){c||(c=ShapeEventHandler.getTarget(b).attr("id"));return c&&(c.indexOf("para")!==-1||c.indexOf("line")!==-1||c.indexOf("textEditingDiv")!==-1)},isSameShapeEditable:function(b,c){var d,f=ShapeEventHandler.getTarget(b);c=!c?f.closest("div"):c;if(typeof ShapeEvent.text.from.num.para!="undefined"){f=ShapeEditor.select.getShapesOfZero();d=c.attr("id")==ShapeEditor.text.editor.textEditingDivId;if(!d){shapeBox=c.closest("."+Shape.shapeClass);if(shapeBox.length){shapeId=
shapeBox.attr("id");d=shapeId==f.data.nvOProps.nvDProps.id}}}return d},mouse:{},key:{press:function(b){var c=ShapeEditor.select.getShapesOfZero(),d=ShapeEditor.config.isSlideLocked();c=ShapeEvent.checkLockStatus(c,"Modify");var f=b.ctrlKey||b.metaKey;if(ShapeEvent.enableKey&&!f&&!c&&!d)if(ShapeEditor.select.shapes.length===1)if(b.which&&b.which!=13&&b.which!=8){c=ShapeEditor.select.getShapesOfZero();if(!(c.data.type===p.ShapeConstants.ShapeNodeType.GROUPSHAPE||c.data.type===p.ShapeConstants.ShapeNodeType.GRAPHICFRAME))if(c.data.type!=
p.ShapeConstants.ShapeNodeType.PICTURE){ShapeEditor.text.isEditable(c.data.nvOProps.nvDProps.id)||ShapeEditor.text.editor.edit(c);d=String.fromCharCode(b.which);ShapeEditor.text.editor.addText(d);b.preventDefault()}}},IMEKeyDown:function(b,c){var d=ShapeEditor.select.shapes[0],f=ShapeEditor.config.isSlideLocked();d=ShapeEvent.checkLockStatus(d,"Modify");if(ShapeEvent.isIE&&!d&&!f)if(c==229){if(ShapeEditor.select.shapes.length)if(ShapeEvent.isIE&&ShapeEvent.IMESupport)ShapeEvent.text.IME.editing||
ShapeEditor.text.editor.IMEHandler.composition.start()}else if(ShapeEvent.text.IME.editing)ShapeEvent.text.composing||ShapeEditor.text.editor.IMEHandler.composition.end()},down:function(b,c){if(!ShapeEvent.text.IME.editing){var d=ShapeEvent.text.operationKeys[c],f;if(d){f=true;if(d.eventKeys&&d.eventKeys.mandatory)p.each(ShapeEvent.isMac?d.eventKeys.mac:d.eventKeys.other,function(n){f=f&&b[n]})}if(f){var g=d.eventKeys;d=d.m;var h=method=ShapeEditor.text.editor,m=d.length-1;p.each(d,function(n,o){method=
method[o];if(m!=n)h=h[o]});method.call(h,b,g);b.stopPropagation();b.preventDefault()}}}},_checkEmptyText:function(b,c){var d=ShapeEditor.select.getShapesOfZero();if(!c)c=d.data;var f=c.textBody&&c.textBody.paras.length==1&&c.textBody.paras[0].portions.length==1&&!c.textBody.paras[0].portions[0].t&&!d.data.textBody.paras[0].portions[0].type;if(f&&!ShapeEvent.text.editing()){var g=ShapeEditor.config.get.shapeContainer();d=d.box;if(c.placeHolder)c.placeHolder.doNotUpdate=true;var h=ShapeEventHandler.getTarget(b).closest(".para"),
m=p(p("."+Shape.textBody.lineId,h)[0]);ShapeEditor.text.editor.setText(c,g,{paraNum:0,portionNum:0},d);b.data={atStart:true,element:{line:m,para:h}}}return f},selectText:function(b,c,d,f){if(this._checkEmptyText(c,b))d||(d=ShapeEventHandler.getTarget(c));else ShapeEvent.text.setTextTarget(c);ShapeEditor.text.editor.select.down(c,d,f)},setTextTarget:function(b){var c=ShapeEventHandler.getTarget(b),d=p(),f=p(),g=p(),h=p();p();var m=p();h=p("#"+Shape.textBody.textContainer,ShapeEditor.select.getShapesOfZero().box);
h=c.closest("."+Shape.textBody.paraId,h);m=h.closest("."+Shape.shapeClass);if(m.attr("id")===ShapeEditor.select.getShapesOfZero().data.nvOProps.nvDProps.id){g=c.closest("."+Shape.textBody.lineId,h);f=c.closest("."+Shape.textBody.wordId,g);d=c.closest("."+Shape.textBody.subwordId,f)}else h=p();b.targetObj={para:h,line:g,word:f,subword:d}}}})(jQuery);(function(p){ShapeEvent.mouse={init:function(){ShapeEvent.mouse._bindEvents()},_bindEvents:function(){var b=ShapeEditor.config.drawcontainer,c=0,d=undefined;p(b).bind("mousedown",function(f,g){c++;if(c===1){d=setTimeout(function(){c=0},400);ShapeEvent.mouse.down(f,g)}else if(c===3){ShapeEvent.tripleClick(f,g);clearTimeout(d);c=0}});p(b).bind("dblclick.Shape",function(f,g){ShapeEvent.doubleClick(f,g)});if(Shape.isPointerEventSupported){p(b).bind("mouseover.Shape",ShapeEvent.mouse.mouseOp);p(b).bind("mouseout.Shape",
ShapeEvent.mouse.mouseOut)}else p(b).bind("mousemove.Shape",ShapeEvent.mouse.mouseOp);p(b).bind("contextmenu.Shape",ShapeEvent.mouse.contextMenu)},down:function(b,c){if(ShapeEditor.config.isSlideLocked())return false;var d=ShapeEventHandler.getTarget(b),f=d.closest("div"),g=f.attr("id"),h=d.attr("id"),m=f.closest("."+Shape.shapeClass),n=ShapeEditor.config.mouse.down(b,d),o=typeof n==="undefined"?false:!n;n=m.data("lock")?true:false;var q=m.hasClass("grouped")?false:ShapeEditor.config.isSupported.text,
r=ShapeEditor.config.isSupported.shapeEdit;ShapeEvent.isMouseDown=true;var u=b.ctrlKey||b.metaKey||b.shiftKey;if(!b.data)b.data={};!n&&ShapeEditor.select.shapes.length&&ShapeEditor.focusEditor();var v=ShapeEditor.config.get.shapeContainerId(),C=d.closest("#"+v);g=g?g:"";b.targetId=h;if(ShapeEvent.image.mouse.isCropFrame(m))ShapeEvent.isMouseDown=false;else if(o=(o=o?o:ShapeEvent.image.mouse.init(b,g,m,f))?o:ShapeEvent.placeHolder.mouse.init(b,h,m,d))ShapeEvent.isMouseDown=false;else{m=ShapeEditor.config.isSupported.draw;
o=ShapeEditor.config.isSupported.selection;if(ShapeEditor.config.isSupported.erase&&ShapeEditor.erase.ready){if(b.which===1||b.which===0)ShapeEditor.erase.shape(d)}else if(m&&ShapeEvent.draw.ready()){if(b.which===1||b.which===0)ShapeEvent.draw.mouse.down(b)}else if(ShapeEditor.config.allowMouseEvent()||C.length)if(q&&ShapeEvent.text.isSameShapeEditable(b,f)){b.data.paraTarget=true;f=ShapeEditor.select.shapes[0];ShapeEvent.text.selectText(f.data,b,d,f.box)}else{var y=false;if(m)if(r)y=h===v||!C.length;
else{if(!r&&!q)y=true}else y=false;if(p.inArray(g,ShapeEvent.externalShapeObjects)!==-1)ShapeEvent.externalShapes.action(b,g,f);else if(y){if(!o){ShapeEvent.isMouseDown=false;return}if(b.which===1||b.which===0){if(o)c=p.extend(true,{},p.ShapeDefault.groupselect);ShapeEditor.draw.preset.down(b,c)}}else if(r||q)if(r&&(mthdName=ShapeEvent.checkIfShapeBBoxes(g))){ShapeEditor[mthdName].down.call(ShapeEditor[mthdName],b,f);q&&!n&&ShapeEditor.text.editor.clear(true)}else{v=false;f=d.closest("."+Shape.shapeClass);
if(f.length&&f.data().groupShapeId)for(;f.data().groupShapeId;)f=p("#"+f.data().groupShapeId,C);if(!f.length){ShapeEvent.isMouseDown=false;return}g=f.attr("id");if(q&&!n)if(p("#"+Shape.textBody.textContainer,f).length)v=ShapeEvent.text.edit(b,h);u=(h=ShapeEditor.select.check(g))&&u;if(!h){c=ShapeEvent.shapeEdit.select(b,f);if(!c){ShapeEvent.isMouseDown=false;return}ShapeEditor.triggerEvent("shape_selected")}if(v&&!n){c=c?c:h.shape.data;if(ShapeEditor.select.shapes.length>1){p.each(ShapeEditor.select.shapes,
function(x,w){var D=w.data.nvOProps.nvDProps.id;D!==g&&ShapeEditor.bbox.remove(D)});ShapeEditor.select.clear("wait");ShapeEditor.select.init(f,c);ShapeEditor.triggerEvent("shape_selected")}ShapeEvent.text.selectText(c,b,d,f)}else if(ShapeEditor.pictureProps.setTransparentColor)ShapeEditor.pictureProps.transparentColor(b);else if(r){b.data.unSelectShape=u;ShapeEditor.move.down(b,f)}}}ShapeEvent.isMouseDown=false;d.closest("embed")||b.preventDefault()}},drag:function(b){b.data.createShape||ShapeEditor.clone.create(b);
var c=b.data.element;ShapeEditor.cursorType&&p("body").css({cursor:ShapeEditor.cursorType});c.get.call(c,b);var d=b.data.currentShape;if(d){var f=b.data.cloneshape[d.index];f&&c.move.call(c,b,d.index,f)}p.each(b.data.cloneshape,function(h,m){m&&!(d&&h===d.index)&&c.move.call(c,b,h,m)});ShapeEditor.event.dependency(b.data.cloneshape,true,b);var g;f=false;if(d)g=b.data.cloneshape[d.index];else if(b.data.externalShapes){g=b.data.cloneshape[0];f=true}if(g&&g.data.nvOProps.nvDProps.id!=="groupselect"&&
!g.data.noEventShapeInfo){g=c.updateInfo.call(c,g,f);ShapeEditor.event.shapeInfo({left:b.pageX+15,top:b.pageY+15},g)}b.data.externalShapes&&b.data.externalShapes.method&&b.data.externalShapes.method.move&&b.data.externalShapes.method.move.call();b.preventDefault()},dragEnd:function(b){if(b.data.unSelectShape){var c=ShapeEventHandler.getTarget(b).closest("."+Shape.shapeClass);if(c.data("groupShapeId"))for(;c.data("groupShapeId");)c=p("#"+c.data("groupShapeId"));c=c.attr("id");ShapeEditor.unselectShape(c)}var d=
b.data.element;ShapeEditor.config.get.shapeContainer();ShapeEvent.unbindDrag(ShapeEditor.event.move,ShapeEditor.event.up);p(ShapeEditor.v_Div).length&&ShapeEditor.v_Div.css("visibility","hidden").removeClass("smartGuideSlide");p(ShapeEditor.h_Div).length&&ShapeEditor.h_Div.css("visibility","hidden").removeClass("smartGuideSlide");ShapeEditor.showSmartGuides=false;if(b.data.createShape)ShapeEditor.draw.preset.up(b);else{var f=[],g=[];p.each(b.data.externalShapes?b.data.externalShapes:ShapeEditor.select.shapes,
function(h,m){var n=ShapeEditor.clone.get(m.data);if(n.length>0){var o=n.data("dependent")?ShapeEditor.resize:d;o=o.set.call(o,m.data,n,m.box);n.remove();m.data.type===p.ShapeConstants.ShapeNodeType.GROUPSHAPE&&ShapeEditor.event.removeClone(m.data.shapes);if(m.box.attr("id").indexOf("crop")===-1)f=p.merge(f,o)}else if(b.data.externalShapes){o=m.box.data(d.key);o=[{data:o,id:m.data.nvOProps.nvDProps.id}];g=p.merge(g,o)}else m.box.data("shapeData",m.data)});if(f.length){p.each(ShapeEditor.select.shapes,
function(h,m){p.each(m.connector,function(n,o){var q=ShapeEditor.clone.get(o.data);if(q.length>0){var r=ShapeEditor.resize.set(o.data,q,o.box);f=p.merge(f,r);q.remove()}});if(m.data.type===p.ShapeConstants.ShapeNodeType.CONNECTOR){ShapeEditor.bbox.remove(m.data.nvOProps.nvDProps.id);ShapeEditor.bbox.create(m.data,m.box)}else ShapeEditor.bbox.move(m.data,m.box,b.data.moveHandle)});ShapeEditor.config.container.trigger("modified",{shapeData:f,appData:{action:"Editor"}})}g.length&&ShapeEditor.config.container.trigger("externalShape_modified",
{data:g});ShapeEditor.config.isSupported.text&&ShapeEditor.text.editor.mouse.up()}ShapeEditor.event.shapeInfo();ShapeEditor.editing=false;p("body").css({cursor:"default"});ShapeEditor.config.isSupported.connector&&ShapeEditor.connector.removeConnectorPoints();b.data.externalShapes&&b.data.externalShapes.method&&b.data.externalShapes.method.up&&b.data.externalShapes.method.up.call();ShapeEditor.select.shapes.length&&ShapeEditor.focusEditor();p.FloatingMenu.picture.set()},bindDrag:function(b,c,d){p(document).bind("mousemove.Shape",
b,c);p(document).bind("mouseup.Shape",b,d)},unbindDrag:function(b,c){p(document).unbind("mousemove.Shape",b);p(document).unbind("mouseup.Shape",c);ShapeEvent.longPress=false;p(document).unbind("longpress.Shape")},mouseOut:function(){if(!ShapeEditor.editing){ShapeEditor.cursorType=ShapeEvent.cursorTypes.DEFAULT;p("body").css({cursor:ShapeEditor.cursorType})}},contextMenu:function(b){var c=ShapeEventHandler.getTarget(b);ShapeEditor.config.eventTrigger.rightClick(b,c)},mouseOp:function(b){var c=ShapeEditor.config.isSlideLocked(),
d=ShapeEvent.cursorTypes.DEFAULT,f=ShapeEventHandler.getTarget(b),g=Shape.creator.get(f,"class"),h=f.closest("div"),m=h.closest("."+Shape.shapeClass),n=h.attr("id"),o=ShapeEditor.config.container,q=m.attr("id");if(q&&m.data("editData")){q=ShapeEditor.config.get.shape(q);var r=m.hasClass("showing");q&&!c&&!r&&Shape.create.editData.icon.show(q,o,m)}else{p(".placeholdereditbutton",o).stop().hide(0,function(){});p(".showing",o).removeClass("showing")}o=ShapeEditor.config.isSupported;q=o.draw;r=o.connector;
var u;if(o.erase&&ShapeEditor.erase.ready)d=ShapeEvent.cursorTypes.ERASER;else if(q&&(u=ShapeEvent.draw.ready())&&!m.data("lock")&&!c){d=ShapeEditor.draw.cursor?ShapeEditor.draw.cursor:ShapeEvent.cursorTypes.CROSSHAIR;r&&u.shapeType===p.ShapeConstants.ShapeNodeType.CONNECTOR&&ShapeEvent.connector.mouse.move(b,n,h)}else if(ShapeEditor.pictureProps.setTransparentColor&&!c){d=ShapeEvent.cursorTypes.HANDLE;if(m.attr("id")===ShapeEditor.select.shapes[0].data.nvOProps.nvDProps.id)d=ShapeEvent.cursorTypes.POINTER}else if(!c){c=
f.closest("#"+ShapeEditor.config.get.shapeContainerId());if(p.inArray(n,ShapeEvent.externalShapeObjects)!==-1)d=ShapeEvent.externalShapes.cursor(b,n);else if(c.length)d=ShapeEvent.mouse.getCursorType(b,f,g,n,m,h)}p("body").css({cursor:d});ShapeEditor.cursorType=d},getCursorType:function(b,c,d,f,g,h){var m;c=ShapeEventHandler.getTarget(b);d||(d=Shape.creator.get(c,"class"));if((h=ShapeEditor.select.shapes[0])&&h.data.nvOProps.nvDProps.id==="groupselect")return(g=p.isFunction(ShapeEditor.config.checkGroupShapeLockStatus)?
ShapeEditor.config.checkGroupShapeLockStatus(g.data(Shape.groupShapeId),"Modify"):false)?ShapeEvent.cursorTypes.NOTALLOWED:ShapeEvent.cursorTypes.DEFAULT;else if(ShapeEditor.editing)return g.data("lock")?ShapeEvent.cursorTypes.NOTALLOWED:ShapeEvent.cursorTypes.CROSSHAIR;var n=ShapeEditor.config.isSupported.shapeEdit,o=ShapeEditor.config.isSupported.text;h=ShapeEditor.config.isSupported.connector;c=c.attr("id");if(g.data(Shape.groupShapeId)||o&&c===Shape.textBody.bullet)m=(g=p.isFunction(ShapeEditor.config.checkGroupShapeLockStatus)?
ShapeEditor.config.checkGroupShapeLockStatus(g.data(Shape.groupShapeId),"Modify"):false)?ShapeEvent.cursorTypes.DEFAULT:ShapeEvent.cursorTypes.DEFAULTMOVE;else if(o&&ShapeEvent.text.textTarget(b,f))m=g.data("lock")?ShapeEvent.cursorTypes.DEFAULT:ShapeEvent.cursorTypes.TEXT;else if(n&&d.indexOf(Shape.pathId)!==-1){if(f.indexOf("_")===-1&&g.data("lock"))m=ShapeEvent.cursorTypes.DEFAULT;if(f.indexOf("li")!==-1)m=g.data("lock")?ShapeEvent.cursorTypes.NOTALLOWED:ShapeEvent.cursorTypes.DEFAULT;else if(f.indexOf("handle")!==
-1)m=f.indexOf("crop")!==-1&&f.indexOf("handle1")!==-1?g.data("lock")?ShapeEvent.cursorTypes.NOTALLOWED:ShapeEvent.cursorTypes.DEFAULTMOVE:g.data("lock")?ShapeEvent.cursorTypes.NOTALLOWED:ShapeEvent.cursorTypes.HANDLE;else if(f.indexOf("rotate")!==-1)m=g.data("lock")?ShapeEvent.cursorTypes.NOTALLOWED:ShapeEvent.cursorTypes.ROTATE;else if(f.indexOf("box")!==-1){d=g.data("shapeId");if(d.indexOf("crop"))d=d.split("crop")[0];b=f.split("_")[0];f=ShapeEditor.config.get.shape(d);if(h)if(b.indexOf("connected"))b=
b.split("connected")[0];if(f){f=f.props?f:f.groupshape;m=f.props.transform.rotate?f.props.transform.rotate:0;m=g.data("lock")?ShapeEvent.cursorTypes.NOTALLOWED:ShapeEditor.bbox.cursor(b,m)}}else if(f.indexOf("border")!==-1){h=p(f,ShapeEditor.config.get.shapeContainer());m=h.data(Shape.groupShapeId)?ShapeEvent.cursorTypes.HELP:g.data("lock")?ShapeEvent.cursorTypes.NOTALLOWED:ShapeEvent.cursorTypes.DEFAULTMOVE}else{m=g.data("lock");m=o&&ShapeEvent.text.isSameShapeEditable(b)?g.data("lock")?ShapeEvent.cursorTypes.DEFAULT:
ShapeEvent.cursorTypes.TEXT:g.length?m?ShapeEvent.cursorTypes.DEFAULT:ShapeEvent.cursorTypes.DEFAULTMOVE:ShapeEvent.cursorTypes.DEFAULT}}else m=ShapeEvent.cursorTypes.DEFAULT;return m}}})(jQuery);(function(p){ShapeEditor.connector={connector:"connector",connectedBBox:"connected",connectorData:"connectorPoint",ELBOW:"Elbow",CURVED:"Curved",LINE:"Line",ck:15,defaultPos:{"0":{x:true,y:true},"90":{x:false,y:true},"180":{x:false,y:false},"270":{x:true,y:false}},conGenre:{Elbow:{parallel:{type1:p.ShapeConstants.PresetShapeGeometry.ELBOW_CONNECTOR3,type2:p.ShapeConstants.PresetShapeGeometry.ELBOW_CONNECTOR5},perpendicular:{type1:p.ShapeConstants.PresetShapeGeometry.ELBOW_CONNECTOR2,type2:p.ShapeConstants.PresetShapeGeometry.ELBOW_CONNECTOR4},
"default":p.ShapeConstants.PresetShapeGeometry.ELBOW_CONNECTOR3},Curved:{parallel:{type1:p.ShapeConstants.PresetShapeGeometry.CURVED_CONNECTOR3,type2:p.ShapeConstants.PresetShapeGeometry.CURVED_CONNECTOR5},perpendicular:{type1:p.ShapeConstants.PresetShapeGeometry.CURVED_CONNECTOR2,type2:p.ShapeConstants.PresetShapeGeometry.CURVED_CONNECTOR4},"default":p.ShapeConstants.PresetShapeGeometry.CURVED_CONNECTOR3},Line:{"default":p.ShapeConstants.PresetShapeGeometry.LINE}},getShapeData:function(b,c){var d,
f=ShapeEditor.config.get.shape(b);if(p("#"+b).data(Shape.groupShapeId)&&f)d=c?p.GroupShape.mData(f,c):p.GroupShape.modifydata(f);else p.each(ShapeEditor.select.shapes,function(g,h){if(b==h.data.nvOProps.nvDProps.id){d=h.data;return false}});d||(d=ShapeEditor.config.get.shape(b));return d},removeConnectorPoints:function(){p("."+ShapeEditor.connector.connector).remove()},showConnectorPoints:function(b){var c=b.data()[Shape.connector];if(c){var d=b.attr("id"),f=ShapeEditor.connector.getShapeData(d);
if(f){var g=ShapeEditor.bbox.getBBoxData(ShapeEditor.connector.connector,f);g.selectorStrokeWidth=18;var h=g.props.transform,m=f.props.transform.pos;g.type=p.ShapeConstants.ShapeNodeType.SHAPE;g.className=ShapeEditor.connector.connector+" "+Shape.shapeClass;g.props.geom.preset.modifiers=[0.3];var n=this,o=ShapeEditor.config.get.scale(),q=f.props.transform.rotate?f.props.transform.rotate:0;p.each(c,function(r,u){g.nvOProps.nvDProps.id=ShapeEditor.connector.connector+r;var v=n.rotatedValue(u,f);h.pos.left=
(m.left+v.x)*o-h.dim.width*0.5;h.pos.top=(m.top+v.y)*o-h.dim.height*0.5;h.rotate=q;Shape.create.draw(g,ShapeEditor.config.container).data(ShapeEditor.connector.connectorData,{point:u,box:b,shapeData:f})})}}},_get:function(b,c,d,f){d=ShapeEditor.config.get.shape(d);var g=d.nvOProps.nvODProps;b=b.data(Shape.connector);var h=c.nvOProps.nvDProps.id;if(h.split("_")[0]=="clonebox")h=h.split("_")[1];if(g&&g.start&&g.start.id==h){var m=this.getData(d,c,b[g.start.index]);m.pos="start";f.push(m)}if(g&&g.end&&
g.end.id==h){m=this.getData(d,c,b[g.end.index]);m.pos="end";f.push(m)}return f},getInnerShapeData:function(b,c,d,f){var g=this;p.each(c.shapes,function(h,m){if(m.type==p.ShapeConstants.ShapeNodeType.GROUPSHAPE){m=m.groupshape?m.groupshape:m;g.getInnerShapeData(b,m,d,f)}else{box=p("#"+m.nvOProps.nvDProps.id,ShapeEditor.config.get.shapeContainer());g._get(box,m,d,f)}})},get:function(b,c){var d=[],f=ShapeEditor.config.get.shapes.all(p.ShapeConstants.ShapeNodeType.CONNECTOR),g=this;p.each(f,function(h,
m){c.type==p.ShapeConstants.ShapeNodeType.GROUPSHAPE?g.getInnerShapeData(b,c,m,d):g._get(b,c,m,d)});return d},getData:function(b,c){var d={id:c.nvOProps.nvDProps.id};return{data:b,box:p("#"+b.nvOProps.nvDProps.id,ShapeEditor.config.container),shapeId:d.id}},reactToTarget:function(b){var c=true;p.each(ShapeEditor.idContains,function(d,f){if(b&&b.indexOf(f)!=-1)return c=false});return c},refreshConnectorPoints:function(b,c){if(b.indexOf(ShapeEditor.connector.connectedBBox)==-1&&b.indexOf(ShapeEditor.connector.connector)==
-1&&b.indexOf("box")==-1&&b.indexOf("border")==-1){ShapeEditor.connector.removeConnectorPoints();ShapeEditor.connector.showConnectorPoints(c)}else if(b.indexOf(ShapeEditor.connector.connectedBBox)!=-1&&b.indexOf("box")!=-1&&b.indexOf("border")==-1){c=p("#"+c.shapeData.nvOProps.nvDProps.id,shapeContainer);ShapeEditor.connector.removeConnectorPoints();ShapeEditor.connector.showConnectorPoints(c)}},dragConnector:function(b,c,d,f,g){ShapeEditor.config.get.shapeContainer();var h=ShapeEventHandler.getTarget(b).closest("."+
Shape.shapeClass),m=h.attr("id"),n=this.reactToTarget(m);if(b.data.targetId!=m){b.data.targetId=m;n&&m?ShapeEditor.connector.refreshConnectorPoints(m,h):ShapeEditor.connector.removeConnectorPoints()}h=ShapeEditor.connector.terminal(f,b.data.flip?b.data.flip:ShapeEditor.select.shapes[d].data.props.transform);m=ShapeEditor.connector.coordinates(b,b.data.targetId,h);return val=ShapeEditor.connector.change(b,c,h,f,ShapeEditor.select.shapes[d].data.props.transform,m,ShapeEditor.select.shapes[d].data.nvOProps.nvODProps,
g)},getConnectorAngle:function(b,c){var d;c=c<0?c+360:c;d=c>ShapeEditor.resize.degree44&&c<ShapeEditor.resize.degree135?b+90:c>ShapeEditor.resize.degree134&&c<ShapeEditor.resize.degree225?b+180:c>ShapeEditor.resize.degree224&&c<ShapeEditor.resize.degree315?b+270:b;d%=360;return d},getBBox:function(b){var c=undefined,d=undefined;if(!b.fliph&&!b.flipv){c="nwbox";d="sebox"}else if(b.fliph&&!b.flipv){c="nebox";d="swbox"}else if(!b.fliph&&b.flipv){c="swbox";d="nebox"}else if(b.fliph&&b.flipv){c="sebox";
d="nwbox"}return{start:c,end:d}},terminal:function(b,c){var d=this.getBBox(c);if(b==d.start)return"start";else if(b==d.end)return"end"},curvedOrElbow:function(b){return b==p.ShapeConstants.PresetShapeGeometry.ELBOW_CONNECTOR2||b==p.ShapeConstants.PresetShapeGeometry.ELBOW_CONNECTOR3||b==p.ShapeConstants.PresetShapeGeometry.ELBOW_CONNECTOR4||b==p.ShapeConstants.PresetShapeGeometry.ELBOW_CONNECTOR5?ShapeEditor.connector.ELBOW:b==p.ShapeConstants.PresetShapeGeometry.CURVED_CONNECTOR2||b==p.ShapeConstants.PresetShapeGeometry.CURVED_CONNECTOR3||
b==p.ShapeConstants.PresetShapeGeometry.CURVED_CONNECTOR4||b==p.ShapeConstants.PresetShapeGeometry.CURVED_CONNECTOR5?ShapeEditor.connector.CURVED:ShapeEditor.connector.LINE},oppositeAngle:{270:90,90:270,180:0,0:180},rotatedValue:function(b,c){var d=c.props.transform,f=d.dim.width*0.5,g=d.dim.height*0.5,h=d.rotate?d.rotate:0,m=VectorUtil.getHTMLDimension(b[0]),n=VectorUtil.getHTMLDimension(b[1]);m=d.fliph?d.dim.width-m:m;n=d.flipv?d.dim.height-n:n;f=zoho.math.getRotatedValue(h,m,n,f,g);f.angle=this.getConnectorAngle(0,
b[2]);f.angle=d.fliph?f.angle==0||f.angle==180?this.oppositeAngle[f.angle]:f.angle:f.angle;f.angle=d.flipv?f.angle==90||f.angle==270?this.oppositeAngle[f.angle]:f.angle:f.angle;f.angle=this.getConnectorAngle(f.angle,h);return f},coordinates:function(b,c,d){if(c&&c.indexOf(ShapeEditor.connector.connector)!=-1){var f=p("#"+c,ShapeEditor.config.container).data(ShapeEditor.connector.connectorData);b=f.point;f=f.box.attr("id");var g=ShapeEditor.connector.getShapeData(f),h=g.props.transform.pos,m=this.rotatedValue(b,
g),n={};n[d]={id:f,index:c.split(ShapeEditor.connector.connector)[1]};c={coord:{x:m.x+h.left,y:m.y+h.top},angle:m.angle,boxData:g,connectorData:n,cpoints:b}}else c={coord:{x:b.data.position.x,y:b.data.position.y}};return c},update:function(b){if(b.boxData){var c=VectorUtil.getHTMLDimension(b.cpoints[0]),d=VectorUtil.getHTMLDimension(b.cpoints[1]),f=b.boxData.props.transform.dim.width,g=b.boxData.props.transform.dim.height,h=b.boxData.props.transform.rotate?b.boxData.props.transform.rotate:0;if(h>
45&&h<135||h>225&&h<315){h=f;f=g;g=h;h=c;c=d;d=h}}else g=f=d=c=0;b.bx=c;b.by=d;b.dim={width:f,height:g}},getFlipVal:function(b,c,d){var f;if(d==90||d==270){f=ShapeEditor.connector.XOR(c,ShapeEditor.connector.defaultPos[d].y);b=ShapeEditor.connector.XOR(b,ShapeEditor.connector.defaultPos[d].x)}else{f=ShapeEditor.connector.XOR(b,ShapeEditor.connector.defaultPos[d].x);b=ShapeEditor.connector.XOR(c,ShapeEditor.connector.defaultPos[d].y)}return{flipx:f,flipy:b}},changeFlipVal:function(b,c,d,f,g){var h=
f.fliph;f=f.flipv;c=this.getFlipVal(b>=0,c>=0,g);b=c.flipx;c=c.flipy;var m;h=ShapeEditor.connector.XOR(b,h);f=ShapeEditor.connector.XOR(c,f);if(!h&&!f)m=d;else if(h&&!f)m=ShapeEditor.resize.bbox[d].flipx;else if(!h&&f)m=ShapeEditor.resize.bbox[d].flipy;else if(h&&f)m=ShapeEditor.resize.bbox[d].flipxy;return{isNeg:ShapeEditor.resize.bbox[m].isNeg,fliph:b,flipv:c}},changeDimension:function(b,c,d){if(b==90||b==270){b=c;c=d;d=b}return{w:c,h:d}},otherEnd:{start:"end",end:"start"},getConnectorData:function(b,
c,d,f,g,h){var m,n,o,q=this.otherEnd[c];if(g&&g[q]){g=f[q].id;m=ShapeEditor.select.check(g);if(b&&m){n=b.data.cloneshape[m.index].box;m=b.data.cloneshape[m.index].data;g="clonebox_"+g;if(m.type==p.ShapeConstants.ShapeNodeType.GROUPSHAPE){g=p.GroupShape.getInnerShapeData(g,m);g=p.extend(true,{},g);m=p.GroupShape.mData(g,m);n=p.GroupShape.getBox(m,ShapeEditor.config.container)}}else{n=p("#"+g,ShapeEditor.config.container);m=ShapeEditor.connector.getShapeData(g)}g=n.data(Shape.connector)[f[q].index];
pointval=this.rotatedValue(g,m);n=m.props.transform.pos;f=pointval.x+n.left;h=pointval.y+n.top;n=pointval.angle}else{n=c=="start"?0:b&&b.data.angle?b.data.angle:180;g=[0,0,n];f=h.x;h=h.y}if(d.cpoints){b=d.angle;o=d.cpoints}else{b=c=="start"?b&&b.data.angle?b.data.angle:180:n;o=[0,0,b]}var r={};r[q]={x:f,y:h,angle:n,boxData:m,cpoints:g};r[c]={x:d.coord.x,y:d.coord.y,angle:b,boxData:d.boxData,cpoints:o};r.anchor={x:r[q].x,y:r[q].y};return r},change:function(b,c,d,f,g,h,m,n){this.ck=ShapeEditor.config.get.convertUnit(40);
c=c.data;var o=this.curvedOrElbow(c.props.geom.preset.type),q,r;n=this.getConnectorData(b,d,h,c.nvOProps.nvODProps,m,n);q=n.start;r=n.end;n=n.anchor;q.angle=this.getConnectorAngle(0,q.angle);r.angle=this.getConnectorAngle(0,r.angle);b=q.angle;var u=Math.abs(q.angle-r.angle);u=this.getConnectorAngle(0,u);this.update(q);this.update(r);m=typeof m!="undefined"&&typeof m[this.otherEnd[d]]!="undefined"&&typeof m[this.otherEnd[d]].id!="undefined"||typeof h.connectorData!="undefined";var v=this.connectorType(q,
r,u,o,m);o=v.connector;var C=v.objectAvoidance;v=r.x-q.x;var y=r.y-q.y,x=this.changeFlipVal(v,y,f,g,b);f=x.fliph;g=x.flipv;c.isNeg=x.isNeg;v||(v=1);y||(y=1);y=this.changeDimension(b,v,y);v=Math.abs(y.w);y=Math.abs(y.h);x={width:v,height:y,fliph:f,flipv:g};q=m?this.getModifiers(o,x,u,b,q,r,C):[0.5];c.props.geom.preset.type=o;c.props.geom.preset.modifiers=q;n={width:v,height:y,rotate:b,fliph:f,flipv:g,geom:c.props.geom,anchor:n};if(h.connectorData)n.connectorData=h.connectorData;else{n.connectorData=
{};n.connectorData[d]={}}return n},internalDistance:function(b){if(!b.boxData)return 0;var c=b.boxData.props.transform;a=b.cpoints[2];c=c.dim;var d;if(a==0)d=c.width-VectorUtil.getHTMLDimension(b.cpoints[0]);else if(a==90)d=c.height-VectorUtil.getHTMLDimension(b.cpoints[1]);else if(a==180)d=VectorUtil.getHTMLDimension(b.cpoints[0]);else if(a==270)d=VectorUtil.getHTMLDimension(b.cpoints[1]);return Math.abs(d)},threeWayModifier:function(b,c,d){if(Math.abs(c.angle-d.angle)){d=this.internalDistance(d);
c=this.internalDistance(c);b=(c+(b.width-(c+d))*0.5)/b.width}else b=b.fliph?-1*(this.ck+this.internalDistance(c))/b.width:(this.ck+this.internalDistance(d))/b.width+1;return modifiers=[b]},fourWayModifier:function(b,c,d){var f=c.angle,g=-1*this.ck/b.width,h=1+this.ck/b.height,m=d.x>=c.x,n=d.y>=c.y;if(c.condition){constanty=this.internalDistance(d);constantx=this.internalDistance(c);h=1+(constanty+this.ck)/b.height;if(f==90||f==270){e=n?d.by:d.dim.height-d.by;s=n?c.dim.height-c.by:c.by;o=s+e;g=b.width-
o>0?(s+(b.width-o)*0.5)/b.width:1+(constantx+this.ck+(d.dim.height-e))/b.width}else{e=m?d.bx:d.dim.width-d.bx;s=constantx;o=s+e;g=b.width-o>0?(s+(b.width-o)*0.5)/b.width:1+(constantx+this.ck+(d.dim.width-e))/b.width}}if(d.condition){constanty=this.internalDistance(d);constantx=this.internalDistance(c);g=-1*(constantx+this.ck)/b.width;if(f==90||f==270){s=m?c.dim.width-c.bx:c.bx;e=m?d.bx:d.dim.width-d.bx;o=s+e;h=b.height-o>0?(s+(b.height-o)*0.5)/b.height:-1*(constanty+this.ck+c.dim.width-s)/b.height}else{s=
n?c.dim.height-c.by:c.by;e=n?d.by:d.dim.height-d.by;var o=s+e;h=b.height-o>0?(s+(b.height-o)*0.5)/b.height:-1*(constanty+this.ck+c.dim.height-s)/b.height}}if(!c.condition&&!d.condition){constanty=this.internalDistance(d);constantx=this.internalDistance(c);h=1+(constanty+this.ck)/b.height;if(f==90||f==270){e=n?d.by:d.dim.height-d.by;s=m?c.bx:c.dim.width-c.bx}else{e=m?d.bx:d.dim.width-d.bx;s=n?c.by:c.dim.height-c.by}g=b.width-(s+e)<0?-1*(Math.abs(b.width-e)+constantx+this.ck)/b.width:-1*(this.ck+constantx)/
b.width}return modifiers=[g,h]},fiveWayModifier:function(b,c,d,f){var g=c.angle,h=this.internalDistance(c),m=this.internalDistance(d),n=(h+this.ck)/b.width,o;if(f){f=d.x>c.x;r=d.y>c.y;if(c.condition){o=1+(m+this.ck)/b.width;if(g==90||g==270){diff=f?d.bx:d.dim.width-d.bx;q=-1*(Math.abs(b.height-diff)+this.ck)/b.height;n=(b.width-d.dim.height)*0.5/b.width}else{diff=r?d.by:d.dim.height-d.by;q=-1*(Math.abs(b.height-diff)+this.ck)/b.height;n=(b.width-d.dim.width)*0.5/b.width}}if(d.condition){n=-1*(h+this.ck)/
b.width;if(g==90||g==270){diff=f?c.bx:c.dim.width-c.bx;q=-1*(Math.abs(c.dim.width-diff)+this.ck)/b.height;o=(c.dim.height+(b.width-c.dim.height)*0.5)/b.width}else{diff=r?c.by:c.dim.height-c.by;q=-1*(Math.abs(c.dim.height-diff)+this.ck)/b.height;o=(c.dim.width+(b.width-c.dim.width)*0.5)/b.width}}}else{n=b.fliph?-1*n:n+1;o=(m+this.ck)/b.width+1;var q;f=d.x>c.x;var r=d.y>c.y;if(g==90||g==270){s=f?c.dim.width-c.bx:c.bx;e=f?d.bx:d.dim.width-d.bx;q=b.height-(s+e)>0?(s+(b.height-(s+e))*0.5)/b.height:1+(this.ck+
(d.dim.width-e))/b.height}else{s=r?c.dim.height-c.by:c.by;e=r?d.by:d.dim.height-d.by;q=b.height-(s+e)>0?(s+(b.height-(s+e))*0.5)/b.height:1+(this.ck+d.dim.height-e)/b.height}}return modifiers=[n,q,o]},getModifiers:function(b,c,d,f,g,h,m){var n;if(b==p.ShapeConstants.PresetShapeGeometry.ELBOW_CONNECTOR3||b==p.ShapeConstants.PresetShapeGeometry.CURVED_CONNECTOR3)n=this.threeWayModifier(c,g,h);else if(b==p.ShapeConstants.PresetShapeGeometry.ELBOW_CONNECTOR4||b==p.ShapeConstants.PresetShapeGeometry.CURVED_CONNECTOR4)n=
this.fourWayModifier(c,g,h);else if(b==p.ShapeConstants.PresetShapeGeometry.ELBOW_CONNECTOR5||b==p.ShapeConstants.PresetShapeGeometry.CURVED_CONNECTOR5)n=this.fiveWayModifier(c,g,h,m);return n},objectAvoidance3To5:function(b,c,d){var f,g=b.angle;if(b.boxData&&c.boxData&&!d){d=b.boxData.props.transform.pos.left;var h=b.boxData.props.transform.pos.top,m=c.boxData.props.transform.pos.left,n=c.boxData.props.transform.pos.top;if(g==90||g==270){if(b.x>m&&b.x<m+c.dim.width||c.x>d&&c.x<d+b.dim.width)f=true}else if(c.y>
h&&c.y<h+b.dim.height||b.y>n&&b.y<n+c.dim.height)f=true}return f},connectorType:function(b,c,d,f,g){var h,m,n,o=this.lineMeet(b,c),q=this.lineMeet(c,b);if(d==0||d==180){h="parallel";m=this.objectAvoidance3To5(b,c,d);n=(o||q)&&!m?"type1":"type2"}else if(d==90||d==270){h="perpendicular";n=o&&q?"type1":"type2"}d=f==ShapeEditor.connector.LINE?ShapeEditor.connector.conGenre[f]["default"]:ShapeEditor.connector.conGenre[f][h][n];if(!g){d=ShapeEditor.connector.conGenre[f]["default"];m=false}b.condition=o;
c.condition=q;return{connector:d,objectAvoidance:m}},lineMeet:function(b,c){var d,f=b.angle;if(f==0)d=b.x<c.x;else if(f==90)d=b.y<c.y;else if(f==180)d=b.x>c.x;else if(f==270)d=b.y>c.y;return d},XOR:function(b,c){return(b||c)&&!(b&&c)},connectShapes:function(b,c){b||(b=ShapeEditor.select.shapes[0]);c||(c="Elbow");var d=b.data.nvOProps.nvDProps.id,f=this;p.each(ShapeEditor.select.shapes,function(g,h){if(d!=h.data.nvOProps.nvDProps.id){var m=f.isConnected(h.connector,b.connector);if(m)ShapeEditor.connector.reRoute(m.box,
m.data);else{m=ShapeEditor.connector.add(h,b,c);var n=p.extend(true,{},m);m.pos="start";n.pos="end";h.connector.push(m);b.connector.push(n)}}})},isConnected:function(b,c){var d;p.each(b,function(f,g){p.each(c,function(h,m){if(g&&m&&g.data.nvOProps.nvDProps.id==m.data.nvOProps.nvDProps.id){d=g;return false}})});return d},disConnect:function(){var b=[];p.each(ShapeEditor.select.shapes,function(c,d){p.each(d.conector,function(f,g){b.push({id:g.data.nvOProps.nvDProps.id,data:{action:"removeData",data:["nvOProps.nvODProps"]}})});
delete d.connectors});return b},reRoute:function(b,c){var d=ShapeEditor.connector.shortestPath(b,c);ShapeEditor.config.container.trigger("modified",{shapeData:d,appData:{action:"Editor"}})},reRouteConnector:function(b,c){this.reRoute(b,c);ShapeEditor.bbox.remove();ShapeEditor.bbox.create(c,b)},changeType:function(b){var c=ShapeEditor.select.shapes[0];box=c.box;data=c.data;c=data.nvOProps.nvODProps;start=c.start;end=c.end;var d=p("#"+start.id,ShapeEditor.config.container),f=p("#"+end.id,ShapeEditor.config.container);
c=start.index;var g=end.index,h=ShapeEditor.connector.getShapeData(start.id),m=ShapeEditor.connector.getShapeData(end.id);d=d.data(Shape.connector);f=f.data(Shape.connector);b=ShapeEditor.connector.route(box,data,h,m,d[c],f[g],b);ShapeEditor.config.container.trigger("modified",{shapeData:b,appData:{action:"Editor"}});ShapeEditor.bbox.remove();ShapeEditor.bbox.create(data,box)},add:function(b,c,d){var f=p.extend(true,{},p.ShapeDefault.connector);f=ShapeEditor.config.get.mergeShape(f);f.type=p.ShapeConstants.ShapeNodeType.CONNECTOR;
f.shapeGeoType="PRESET";f.shapeType=this.conGenre[d]["default"];f.nvOProps.nvDProps.id=Math.uuid();f.props.geom={preset:{type:f.shapeType},type:"PRESET"};f.nvOProps.nvODProps={start:{id:b.data.nvOProps.nvDProps.id},end:{id:c.data.nvOProps.nvDProps.id}};b=Shape.create.draw(f,ShapeEditor.config.get.shapeContainer());ShapeEditor.connector.shortestPath(b,f);ShapeEditor.triggerEvent("shape_created",f,b);return{box:b,data:f}},del:function(b,c){var d=[];b.connector&&c.connector&&p.each(b.connector,function(f,
g){p.each(c.connector,function(h,m){g.data.nvOProps.nvDProps.id==m.data.nvOProps.nvDProps.id&&d.push(g)})});d.length&&p.each(d,function(f,g){g.box.remove()})},route:function(b,c,d,f,g,h,m){var n=ShapeEditor.connector.rotatedValue(g,d),o=ShapeEditor.connector.rotatedValue(h,f),q=d.props.transform.pos,r=f.props.transform.pos;n.x+=q.left;n.y+=q.top;o.x+=r.left;o.y+=r.top;n.cpoints=g;o.cpoints=h;n.boxData=d;o.boxData=f;this.update(n);this.update(o);d=Math.abs(n.angle-o.angle);m=this.connectorType(n,o,
d,m,true).connector;f=o.x-n.x;q=o.y-n.y;g=f>=0;h=q>=0;f=f?Math.abs(f):1;q=q?Math.abs(q):1;f=this.changeDimension(n.angle,f,q);g=this.getFlipVal(g,h,n.angle);o=this.getModifiers(m,{width:f.w,height:f.h,fliph:g.flipx,flipv:g.flipy},d,n.angle,n,o);var u;if(!g.flipx&&!g.flipy)u=0;else if(g.flipx&&!g.flipy)u=2;else if(g.flipx&&g.flipy)u=1;else if(!g.flipx&&g.flipy)u=3;d=VectorUtil.positionShape(n.angle,[f.w,f.h],n,b,u);u=c.props.transform;u.rotate=n.angle;u.dim={width:f.w,height:f.h};u.pos.left=d.left;
u.pos.top=d.top;u.fliph=g.flipx;u.flipv=g.flipy;c.props.geom.preset.type=m;c.props.geom.preset.modifiers=o;Shape.props.geom.set(c,ShapeEditor.config.container,b);Shape.props.geom.dependency(c,ShapeEditor.config.container,b);Shape.props.transform.set(c,ShapeEditor.config.container,b);Shape.creator.marker(c,ShapeEditor.config.container,b);b={};b.props={};b.props.transform=u;b.props.geom=c.props.geom;b.nvOProps={nvODProps:{start:{index:c.nvOProps.nvODProps.start.index},end:{index:c.nvOProps.nvODProps.end.index}}};
n=[];n.push({id:c.nvOProps.nvDProps.id,data:{action:"modify",data:p.extend(true,{},b)}});return n},shortestPath:function(b,c){if(c.type==p.ShapeConstants.ShapeNodeType.CONNECTOR){var d=c.nvOProps.nvODProps;if(d){start=d.start;end=d.end;if(start&&end){var f=p("#"+start.id,ShapeEditor.config.container);d=p("#"+end.id,ShapeEditor.config.container);var g=ShapeEditor.connector.getShapeData(start.id),h=ShapeEditor.connector.getShapeData(end.id),m=g.props.transform.pos,n=h.props.transform.pos,o=this.curvedOrElbow(c.props.geom.preset.type);
f=f.data(Shape.connector);var q=d.data(Shape.connector),r,u,v;p.each(f,function(C,y){p.each(q,function(x,w){var D=ShapeEditor.connector.rotatedValue(y,g),z=ShapeEditor.connector.rotatedValue(w,h);D.x+=m.left;D.y+=m.top;z.x+=n.left;z.y+=n.top;D=zoho.math.length(D.x,D.y,z.x,z.y);r||(r=D);if(D<r){r=D;u=C;v=x}})});c.nvOProps.nvODProps.start.index=u;c.nvOProps.nvODProps.end.index=v;return this.route(b,c,g,h,f[u],q[v],o)}}}},_editingDependency:function(b,c,d,f,g,h){if(!c)return true;var m;p.each(c.connector,
function(n,o){var q;if(c.data.type==p.ShapeConstants.ShapeNodeType.GROUPSHAPE){q=p.GroupShape.getInnerShapeData(o.shapeId,c.data);q=p.extend(true,{},q);q=p.GroupShape.mData(q,c.data);m=c.data}else q=c.data;q={box:p.GroupShape.getBox(q,ShapeEditor.config.get.shapeContainer()),data:q,gsData:m};var r;if(d)r=q.box.data();else{var u=q.data,v=u.props.transform.dim,C=u.props.geom.preset;r=C?Shape.pathGenerator.getPath(C.type,v.width,v.height,C.modifiers&&C.modifiers.length?C.modifiers:p.Preset[C.type].modifiers):
Shape.pathGenerator.getCustomPath(u.props.geom.custom,v.width,v.height)}u=ShapeEditor.select.shapes[b].connector[n];v=ShapeEditor.connector.getBBox(u.data.props.transform);C=o.pos;bb=v[C];r=r[Shape.connector][u.data.nvOProps.nvODProps[C].index];var y=ShapeEditor.connector.rotatedValue(r,q.data);pos1=q.data.props.transform.pos;obj={coord:{x:y.x+pos1.left,y:y.y+pos1.top},angle:y.angle,boxData:q.data,cpoints:r,connectorData:u.data.nvOProps.nvODProps};r=u.data.props.transform;y=r.rotate?r.rotate:0;r=
ShapeEditor.resize.getCornerPoints(p.extend(true,{},r.pos),p.extend(true,{},r.dim),y)[ShapeEditor.resize.bbox[bb].anchor];q=ShapeEditor.connector.change(f,o,C,v[C],u.data.props.transform,obj,u.data.nvOProps.nvODProps,r,q.gsData);u=VectorUtil.positionShape(q.rotate,[q.width,q.height],q.anchor,o.box,o.data.isNeg);q.left=u.left;q.top=u.top;u=ShapeEditor.resize.setData(o.data,o.box,q);p.merge(g,u);f&&o.box.data("dim",q);h.push({id:o.data.nvOProps.nvDProps.id,data:o.data})})},searchShape:function(b,c,
d,f,g,h){var m=this;b=b.groupshape?b.groupshape:b;p.each(b.shapes,function(n,o){o.type==p.ShapeConstants.ShapeNodeType.GROUPSHAPE?m.searchShape(o,c,d,f,g,h):m._editingDependency(n,s1,c,d,f,g)})},editingDependency:function(b,c,d){var f=this,g=[],h=[];p.each(b,function(m,n){f._editingDependency(m,n,c,d,g,h)});p.each(ShapeEditor.select.shapes,function(m,n){p.each(h,function(o,q){q.id==n.data.nvOProps.nvDProps.id&&p.extend(true,n.data,q.data)})});return g},isBBoxConnected:function(b){return b.indexOf(ShapeEditor.connector.connectedBBox)!=
-1},updateBBoxId:function(b,c){if(b.type==p.ShapeConstants.ShapeNodeType.CONNECTOR){var d=b.nvOProps.nvODProps,f="",g="",h="",m,n=ShapeEditor.connector.getBBox(b.props.transform);if(d&&d.start&&d.start.id)if(c==n.start){m=ShapeEditor.bbox.getBBoxData(ShapeEditor.connector.connector,b);f=ShapeEditor.connector.connectedBBox;g=ShapeEditor.connector.connectedBBox+Math.uuid();h=d.start.id}if(d&&d.end&&d.end.id)if(c==n.end){m=ShapeEditor.bbox.getBBoxData(ShapeEditor.connector.connector,b);f=ShapeEditor.connector.connectedBBox;
g=ShapeEditor.connector.connectedBBox+Math.uuid();h=d.end.id}if(m)return{bboxData:m,cname:f,idName:g,connectedTo:h}}},draw:{updateData:function(b,c){if(ShapeEditor.draw.preset.shapeType==p.ShapeConstants.ShapeNodeType.CONNECTOR){var d=ShapeEventHandler.getTarget(b).closest("div"),f=d.attr("id");if(f.indexOf(ShapeEditor.connector.connector)!=-1){c.nvOProps.nvODProps={};var g=c.nvOProps.nvODProps;d=d.data(ShapeEditor.connector.connectorData);var h=parseInt(f.split(ShapeEditor.connector.connector)[1]);
f=d.shapeData.nvOProps.nvDProps.id;g.start={id:f,index:h};f=d.shapeData;g=ShapeEditor.connector.rotatedValue(d.point,f);c.props.transform.rotate=g.angle;d=ShapeEditor.bbox.getBBoxData(ShapeEditor.connector.connector,c).props.transform.dim;h=f.props.transform.pos.top+g.y+d.height*0.5;c.props.transform.pos.left=f.props.transform.pos.left+g.x+d.width*0.5;c.props.transform.pos.top=h}}}}}})(jQuery);(function(p){ShapeEditor.text={containerMoved:function(){if(ShapeEditor.select.shapes.length){var b=ShapeEditor.select.getShapesOfZero();if(this.isEditable(b.data.nvOProps.nvDProps.id)){var c=ShapeEditor.text.editor.get,d=ShapeEvent.text,f=ShapeEditor.config.get.shapeContainer();d.shapeContainer=f;d.shapeContainerOffset=f.offset();d.containerOffset=c.offset(d.textContainer,undefined,undefined,f);d.shapeOffset=c.offset(b.box)}}},refresh:function(b){var c=p.extend(true,{},ShapeEvent.text.from),d=p.extend(true,
{},ShapeEvent.text.to);if(!b){ShapeEditor.text.editor.clear();b=ShapeEditor.select.shapes[0];ShapeEditor.bbox.create(b.data,b.box)}ShapeEditor.text.editor.cursor.refresh(c,d)},composer:{insert:"insert",update:"update",del:"delete",merge:"merge",position:[],init:function(b){var c=ShapeEditor.text.composer;c.position=c.getPosition(b.textBody.paras)},getPosition:function(b){var c=[],d=0;p.each(b,function(f,g){var h=[];d++;h.push(d);p.each(g.portions,function(m,n){var o=n.t?n.t.length:n.type&&n.type.toLowerCase()==
"linebreak"?1:0;d+=o;h.push(d)});c.push(h)});return c},compose:function(b,c,d){ShapeEvent.text.composing=true;!d&&ShapeEvent.text.IME.editing&&b.si<=ShapeEvent.text.from.index&&b.ei>=ShapeEvent.text.to.index&&ShapeEvent.text.IME.contentEditable.blur();c=c?c:ShapeEditor.select.getShapesOfZero();var f=ShapeEditor.text.composer;if(b.ut)b.ut=b.ut.toLowerCase();var g=[{insert:[],"delete":[]},{update:[],insert:[],"delete":[]},{update:[],merge:[],insert:[],"delete":[]}],h=f.get.object(b.si);if(b.at==f.insert){if(b.value.value!=
"\n"&&h.ch<=0){var m=true,n=c.data.textBody.paras[h.para];if(n)n=n.portions[h.portion-1];var o=n=false;if(h.portion){n=true;h.portion--}else if(h.ch==-1){h.para--;h.portion=c.data.textBody.paras[h.para].portions.length-1;o=true}else m=false;if(m){m=c.data.textBody.paras[h.para].portions[h.portion];h.ch=m.t?m.t.length:0}var q=false,r=false,u=c.data.textBody.paras[h.para];m=u.portions[h.portion+1];if((u=u.portions[h.portion].type)&&u.toLowerCase()==="linebreak")if(m){o=m.type;if(!(o&&o.toLowerCase()===
"linebreak")&&b.value.value!="\u2028")if(!n&&!h.portion&&h.ch==0)r=q=true;else{h.portion+=1;m=c.data.textBody.paras[h.para].portions[h.portion];h.ch=0}else{q=true;if(!n&&h.portion===0&&h.ch===0)r=true}}else{q=true;if((n||!o)&&h.portion===0&&h.ch===0)r=true}}var v=h}else{v=f.get.object(b.ei);if(!(b.ut&&b.ut=="para")&&b.at==f.update){if(h.ch==-1){o=h.para-1;n=c.data.textBody.paras[o];n=n.portions;n.length==1&&!n[0].t&&f.createObject(f.update,"portion",[o,0],{props:b.value.value,deleteData:b.value.deleteData},
g);h.ch=0}if(v.ch==-1){v.para--;n=c.data.textBody.paras[v.para].portions;v.portion=n.length-1;m=c.data.textBody.paras[v.para].portions[v.portion];n.length==1&&!n[0].t&&h.index!=v.index&&f.createObject(f.update,"portion",[v.para,0],{props:b.value.value,deleteData:b.value.deleteData},g);v.ch=m.t?m.t.length-1:-1}}else if(!(b.ut&&b.ut=="para")&&b.at==f.del){n=ShapeEditor.text.composer.get.lastIndex();if(v.ch==-1&&v.index==n){v.para--;v.portion=c.data.textBody.paras[v.para].portions.length-1;m=c.data.textBody.paras[v.para].portions[v.portion];
v.index-=1;v.ch=m.t?m.t.length-1:-1}if(h.ch==-1&&h.index==n){h.para--;h.portion=c.data.textBody.paras[h.para].portions.length-1;m=c.data.textBody.paras[h.para].portions[v.portion];h.index-=1;h.ch=m.t?m.t.length-1:-1}}}if(b.at==f.del)if(h.portion==0&&v.portion==0&&h.ch==-1&&v.ch==-1&&h.para==v.para){n=c.data.textBody.paras[h.para].portions[0];o=n.type;if((n=n.t)&&n.length||o==p.ShapeConstants.PortionType.LINEBREAK)f.createObject(f.merge,"para",[h.para],{para:h.para-1},g);f.createObject(f.del,"para",
[h.para],{},g);v.para=-1}var C=h.para*1E4+h.portion,y=v.para*1E4+v.portion,x=c.data.textBody.paras;if(b.at==f.insert)if(h.para==x.length&&b.value.value==="\n"){n=h.para-1;f.createObject(f.insert,"para",[n],{portion:x[n].portions.length},g);v.para=-1}p.each(x,function(w,D){if(w>v.para)return false;if(w>=h.para&&w<=v.para){if(b.ut&&b.ut=="para"&&b.at==f.update){b.value.value.animationDatas?f.createObject(f.update,"para",[w],{animationDatas:b.value.value.animationDatas,deleteData:b.value.deleteData},
g):f.createObject(f.update,"para",[w],{style:b.value.value,deleteData:b.value.deleteData},g);return true}if(b.at==f.del){if(w==h.para&&h.portion==0&&h.ch==-1&&w!=v.para){f.createObject(f.del,"para",[w],{},g);return true}if(w>h.para&&w<v.para){f.createObject(f.del,"para",[w],{},g);return true}}p.each(D.portions,function(z,A){var E=A.t?A.t:"",H=E?E.length-1:0,F=w*1E4+z;if(F>y)return false;if(b.at==f.insert&&F==C){var G=E.substring(0,h.ch),L=E.substring(h.ch);if(b.value.value!="\n"&&b.value.value!="\u2028"){F=
"";F=h.ch==H+1?E+b.value.value:G+b.value.value+L;q?f.createObject(f.insert,"portion",[w,r?z:z+1,z],{replace:b.value.replace,t:b.value.value},g):f.createObject(f.insert,"text",[w,z],{t:F,addedText:b.value.value,start:h.ch},g)}else{F=z;H=w;var B=false;if(h.ch==-1&&!h.portion)if(w){H=w-1;F=x[H].portions.length}else F=0;else if(h.ch==0){if(b.value.value==="\u2028"){f.createObject(f.insert,"portion",[w,z,z],{replace:b.value.replace,type:"LINEBREAK"},g);B=true}}else{f.createObject(f.del,"text",[w,z],{t:G,
start:h.ch+1,end:E.length},g);if(b.value.value==="\u2028"){B=true;f.createObject(f.insert,"portion",[w,z+1,z],{replace:b.value.replace,type:"LINEBREAK"},g)}if(L.length){f.createObject(f.insert,"portion",[w,z+1,z],{replace:b.value.replace,t:L},g);F=z+1}}B||f.createObject(f.insert,"para",[H],{portion:F},g)}return false}G=F>C&&F<y;if(!G)if(F==C&&F==y)G=h.ch==0&&v.ch==H;else{G=F==C?h.ch==0:G;G=F==y?v.ch==H:G}if(G)if(b.at==f.update)f.createObject(f.update,"portion",[w,z],{props:b.value.value,deleteData:b.value.deleteData},
g);else b.at==f.del&&f.createObject(f.del,"portion",[w,z],{},g);else if(E){G=E.substring(0,h.ch);B=v.ch+1;L=E.substring(B);if(F==C&&F==y&&h.ch!=0&&v.ch!=H)if(b.at==f.update){f.createObject(f.del,"text",[w,z],{t:G,start:h.ch+1,end:E.length},g);f.createObject(f.insert,"portion",[w,z+1,z],{replace:b.value.replace,props:b.value.value,t:E.substring(h.ch,B)},g);f.createObject(f.insert,"portion",[w,z+1,z],{t:L},g)}else b.at==f.del&&f.createObject(f.del,"text",[w,z],{t:G+L,start:h.ch+1,end:B},g);else if(F==
C&&h.ch!=0){f.createObject(f.del,"text",[w,z],{t:G,start:h.ch+1,end:E.length},g);b.at==f.update&&f.createObject(f.insert,"portion",[w,z+1,z],{replace:b.value.replace,props:b.value.value,t:E.substring(h.ch)},g)}else if(F==y){f.createObject(f.del,"text",[w,z],{t:L,start:0,end:B},g);b.at==f.update&&f.createObject(f.insert,"portion",[w,z,z],{replace:b.value.replace,props:b.value.value,t:E.substring(0,B)},g)}}if(F==y)if(b.at==f.del&&(h.para!=v.para||h.para==v.para&&h.ch==-1)){E=h.para;if(h.portion==0&&
h.ch==-1)E=h.para-1;f.createObject(f.merge,"para",[w],{para:E},g);f.createObject(f.del,"para",[w],{},g)}})}});d&&this.triggerCollabObject(b,g,c);f.operate(g,c,b);ShapeEvent.text.composing=false},triggerCollabObject:function(b,c,d){var f=d.data;c=c[2];var g=[];if(c.insert.length)if(d=p.extend(true,{},f.textBody.paras[c.insert[0].num.para]).animationDatas){for(var h=d.length,m=[],n=0;n<h;n++){m[m.length]=d[n].id;g[g.length]=Math.uuid()}b.value.prevParaIds=m}d=c["delete"];d.length&&p.each(d,function(o,
q){var r=f.textBody.paras[q.num.para].animationDatas;if(r)for(o=0;o<r.length;o++)g[g.length]=r[o].id});if(c.update.length){c=c.update[0];if(c.actionData&&c.actionData.style&&typeof c.actionData.style.level!=="undefined"){if(d=p.extend(true,{},f.textBody.paras[c.num.para]).animationDatas)for(n=0;n<d.length;n++)g[g.length]=d[n].id;b.value.paraLevel=c.actionData.style.level}}if(g.length){if(!b.value)b.value={};b.value.ids=g}},createObject:function(b,c,d,f,g){var h={num:{},actionData:{}};h.num.para=d[0];
h.num.portion=typeof d[1]!="undefined"?d[1]:-1;h.num.portionData=typeof d[2]!="undefined"?d[2]:-1;h.actionData=f;c=c=="portion"?1:c=="para"?2:0;b==this.update?g[c][this.update].push(h):g[c][b].splice(0,0,h);return h},operate:function(b,c,d){var f=ShapeEditor.config.get.shapeContainer(),g=c.data,h=ShapeEditor.text.composer;g.textBody.id=Shape.textBody.textContainer;var m=[g];Shape.textBody.element(g,f,c.box);p.each(m,function(n,o){p.each(b,function(q,r){p.each(r,function(u,v){p.each(v,function(C,y){var x=
y.actionData,w=typeof x.para!="undefined"?x.para:y.num.para;o.textBody.paras.num=w;Shape.textBody.paras.element(o,f,c.box);var D=h.get.listStyle(o.textBody.listStyles,o.textBody.paras[w].style.level);if(q==2)if(u==h.del){Shape.textBody.paras.remove(o,f,c.box);h.sync(o,o.textBody.paras,w);Shape.textBody.paras.dependency(o,f,c.box)}else if(u==h.insert){var z=d.value?d.value.ids:undefined,A=o.textBody.paras[w],E=x.portion;x=p.extend(true,{},A);if(z){var H=x.animationDatas;if(H)for(var F=0;F<H.length;F++){var G=
H[F],L=z[F];if(L)G.id=L;else x.animationDatas.splice(F,1)}}else delete x.animationDatas;delete x.animData;x.style=p.extend(true,{},D,A.unmerged.style);x.portions=[];for(z=A.portions.length;z>E;){var B=A.portions[E];B=p.extend(true,{},B);h.sync(o,x.portions,x.portions.length,B);A.portions.num=E;Shape.textBody.paras.portions.element(o,f,c.box);if(z==1){A.portions[0].t=undefined;A.portions[0].type=undefined;if(o.placeHolder)o.placeHolder.doNotUpdate=true;A.portions[0].props=p.extend(true,{},x.portions[0].props);
Shape.textBody.paras.portions.t.set(o,f,c.box);Shape.textBody.paras.portions.t.dependency(o,f,c.box);Shape.textBody.paras.portions.props.set(o,f,c.box)}else{Shape.textBody.paras.portions.remove(o,f,c.box);h.sync(o,A.portions,E);Shape.textBody.paras.portions.dependency(o,f,c.box)}z--}if(!x.portions.length){E=p.extend(true,{},A.portions[A.portions.length-1]);E.t=undefined;E.type=undefined;x.portions.push(E);ShapeEditor.text.composer.deletePortionProps(E)}E=w+1;h.sync(o,o.textBody.paras,E,x);o.textBody.paras.num=
E;Shape.textBody.paras.set(o,f,c.box);Shape.textBody.paras.dependency(o,f,c.box)}else if(u==h.merge){var I=o.textBody.paras[y.num.para],M=o.textBody.paras[w],P=M.portions.length;if(M.portions.length==1&&!M.portions[0].t&&M.portions[0].type!=p.ShapeConstants.PortionType.LINEBREAK){M.portions=[];P=0}p.each(I.portions,function(Q,J){J=p.extend(true,{},J);M.portions.num=P+Q;var S=M.portions;if(I.style.level!=M.style.level)J.props=p.extend(true,{},D.defPrProps,J.unmerged.props);var T=J.t;if(!(T&&T.length)&&
M.portions.num!=0&&J.type!=p.ShapeConstants.PortionType.LINEBREAK)return true;h.sync(o,S,S.length,J);if(M.portions.num){Shape.textBody.paras.portions.set(o,f,c.box);Shape.textBody.paras.portions.dependency(o,f,c.box)}else{o.textBody.paras[w].portions.num=0;Shape.textBody.paras.portions.element(o,f,c.box);Shape.textBody.paras.portions.t.set(o,f,c.box);Shape.textBody.paras.portions.t.dependency(o,f,c.box);Shape.textBody.paras.portions.props.set(o,f,c.box);Shape.textBody.paras.portions.props.dependency(o,
f,c.box)}})}else{A=o.textBody.paras[y.num.para];x.deleteData&&h.updateParaStyle(A.style,A.unmerged.style,D,x.deleteData,x);if(x.animationDatas)A.animationDatas=x.animationDatas;else if(x.style){if(x.style.level){var U=h.get.listStyle(o.textBody.listStyles,x.style.level);A.style=p.extend(true,{},U,A.unmerged.style);p.each(A.portions,function(Q,J){J.props=p.extend(true,{},U.defPrProps,J.unmerged.props)})}p.extend(true,A.style,x.style);p.extend(true,A.unmerged.style,x.style);if(A.style.listStyle&&A.style.listStyle.bullet)A.style.listStyle.bullet.status=
o.textBody.paras.length==1&&o.textBody.paras[0].portions.length==1&&!o.textBody.paras[0].portions[0].t&&!o.textBody.paras[0].portions[0].type?Shape.textBody.paras.style.listStyle.bullet.enabled:undefined;Shape.textBody.paras.style.set(o,f,c.box);Shape.textBody.paras.style.dependency(o,f,c.box)}}else{E=y.num.portion;A=o.textBody.paras[w];A.portions.num=E;B=A.portions[E];x=y.actionData;if(x.props)z=p.extend(true,{},x.props);if(u==h.update){x.deleteData&&p.each(x.deleteData,function(Q,J){J=J=="click"?
"fill":J;B.props[J]=D.defPrProps[J];B.unmerged.props[J]=p.extend(true,{},D.defPrProps[J])});p.extend(true,B.props,z);p.extend(true,B.unmerged.props,z);Shape.textBody.paras.portions.element(o,f,c.box);Shape.textBody.paras.portions.props.set(o,f,c.box);Shape.textBody.paras.portions.props.dependency(o,f,c.box)}else if(u==h.insert)if(q){B=p.extend(true,{},o.textBody.paras[w].portions[y.num.portionData]);B.t=x.t;B.type=x.type;if(x.replace){A=A.style.level;B.unmerged.props=z;B.props=p.extend(true,{},o.textBody.listStyles[A-
1].defPrProps);p.extend(true,B.props,z)}else{p.extend(true,B.props,z);p.extend(true,B.unmerged.props,z)}B.type===p.ShapeConstants.PortionType.LINEBREAK&&ShapeEditor.text.composer.deletePortionProps(B);h.sync(o,o.textBody.paras[w].portions,E,B);Shape.textBody.paras.portions.set(o,f,c.box);Shape.textBody.paras.portions.dependency(o,f,c.box)}else{Shape.textBody.paras.portions.element(o,f,c.box);E=o.textBody.paras[w].portions.element;if(!B.t||B.t===""){B.t=x.t;Shape.textBody.paras.portions.t.set(o,f,
c.box)}else{B.t=x.t;Shape.textBody.paras.portions.t.addText(o,f,c.box,x.addedText,x.start)}Shape.textBody.paras.portions.t.dependency(o,f,c.box)}else if(u==h.del){Shape.textBody.paras.portions.element(o,f,c.box);if(q)if(o.textBody.paras[w].portions.length==1){B.t=undefined;B.type=undefined;if(o.placeHolder&&o.textBody.paras.length==1)o.placeHolder.doNotUpdate=true;Shape.textBody.paras.portions.t.set(o,f,c.box);Shape.textBody.paras.portions.t.dependency(o,f,c.box)}else{Shape.textBody.paras.portions.remove(o,
f,c.box);h.sync(o,o.textBody.paras[w].portions,E);Shape.textBody.paras.portions.dependency(o,f,c.box)}else{E=o.textBody.paras[w].portions.element;B.t=x.t;B.t&&B.t!==""?Shape.textBody.paras.portions.t.removeText(o,f,c.box,B,E,x.start,x.end):Shape.textBody.paras.portions.t.set(o,f,c.box);Shape.textBody.paras.portions.t.dependency(o,f,c.box)}}}})})})});c.data=g;ShapeEditor.text.composer.init(c.data);if(Shape.testing)Test.text.automationVerification()||Shape.log("CHARACTER COUNT MISMATCH")},deletePortionProps:function(b){p.each(["baseline",
"click"],function(c,d){if(b.unmerged.props[d]){delete b.unmerged.props[d];delete b.props[d]}})},updateParaStyle:function(b,c,d,f,g){var h=this;p.each(f,function(m,n){if(n=="level")g.style.level=1;if(typeof n=="object"||typeof n=="array")c[m]&&d&&h.updateParaStyle(b[m],c[m],d[m],n,g);else if(d){var o=typeof d[m]=="object"?p.extend(true,{},d[m]):d[m];b[m]=o;c[m]=o}else{b[m]=undefined;c[m]=undefined}})},sync:function(b,c,d,f){f?c.splice(d,0,f):c.splice(d,1)},get:{index:function(b){return ShapeEditor.text.composer.position[b.para][b.portion]+
b.ch},lastIndex:function(){var b=ShapeEditor.text.composer.position;return b[b.length-1][b[b.length-1].length-1]},object:function(b,c){var d={para:-1,portion:-1,ch:-1},f=ShapeEditor.text.composer;if(!b){d.para=0;d.portion=0;d.index=0;return d}c=c?c:f.position;p.each(c,function(g,h){var m=h[h.length-1];if(b>=h[0]-1&&b<=m){if(b==m){d.para=g+1;d.portion=0}else{d.para=g;p.each(h,function(n,o){var q=h[n+1];if(b>=o&&b<=q){if(b==q){d.portion=n+1;d.ch=0}else{d.portion=n;d.ch=b-o}return false}})}return false}});
d.index=b;return d},listStyle:function(b,c){var d=undefined;if(!b)return{};p.each(b,function(f,g){if(g.level==c){d=g;return false}});return p.extend(true,{},d)}}},getObject:function(){var b=ShapeEditor.text.editor,c=b.isSelected(),d,f=b._getFromTo(),g=f.to;b=c?b.select.getTargetElementFromIndex(f.from.num.index+1):f.from;f=b.num.para;var h=g.num.para,m=g.num.portion,n=g.num.ch;if(b.num.ch==-1&&g.num.ch==b.num.ch&&b.num.para==g.num.para&&c){d=true;h=f=b.num.para?b.num.para-1:b.num.para}if(!d&&c&&g.num.ch==
-1){c=ShapeEditor.select.getShapesOfZero().data;h=g.num.para?g.num.para-1:g.num.para;g=c.textBody.paras[h];m=g.portions.length-1;n=(g=g.portions[m].t)?g.length-1:-1}return{from:{para:f,portion:b.num.portion,ch:b.num.ch},to:{para:h,portion:m,ch:n},EOPSelected:d}},isEditable:function(b){var c=false;if(b){var d=ShapeEditor.select.getShapesOfZero();if(d)c=b==d.data.nvOProps.nvDProps.id&&!isNaN(ShapeEvent.text.from.num.para)}else c=!isNaN(ShapeEvent.text.from.num.para);return c},editor:{textselection:"textselection",
textEditingDivId:"textEditingDiv",textEditingDiv:undefined,property:undefined,clear:function(b){var c=ShapeEditor.text.editor,d=ShapeEvent.text;ShapeEditor.config.container.trigger("text_clear");d.IME.editing&&ShapeEditor.config.focusDrawContainer();if(d.from.element.word&&!(b&&b.remove)&&c._isEditable()){b=d.from.num.index;d=c.select.getTargetElementFromIndex(b);var f=c.select.getCurrentStartEnd(d);if(b===f.word.end&&f.spaceLength!==0&&b+1<ShapeEditor.text.composer.get.lastIndex())d=c.select.getTargetElementFromIndex(b+
1);c.navigation.triggerCursorTransit(undefined,undefined,{wordObj:d})}c.property=undefined;c.withdrawEditing();c.selection.clear();c.clearTextObject();c.textEditingDiv&&c.textEditingDiv.remove()},clearCopiedContent:function(b){if(ShapeEvent.isSafari||b)ShapeEvent.text.IME.contentEditable.text("")},setCopiedContent:function(){if(ShapeEvent.isSafari){var b=ShapeEditor.text.editor.selectedText(),c=ShapeEvent.text.IME.contentEditable;c.text(b?b:"");VectorUtil.selectAllText(c)}},_getFromTo:function(){var b=
ShapeEvent.text;return b.from.num.index<=b.to.num.index?{from:b.from,to:b.to}:{from:b.to,to:b.from}},getSelectedPortionProperty:function(){var b=[],c=this._getFromTo(),d=c.from;c=c.to;if(ShapeEditor.text.isEditable()){if(d.num.ch!==-1)d=this.select.getTargetElementFromIndex(d.num.index+1);for(var f=ShapeEditor.select.getShapesOfZero().data,g=d.num.para,h=d.num.portion;g<=c.num.para;g++){h=g==d.num.para?h:0;for(var m=g==c.num.para?c.num.portion:f.textBody.paras[g].portions.length-1;h<=m;h++)b.push(f.textBody.paras[g].portions[h].props)}}return b},
clearTextObject:function(){ShapeEvent.text.bx=undefined;ShapeEvent.text.current=undefined;ShapeEvent.text.offset=undefined;ShapeEvent.text.clonebox=undefined;ShapeEvent.text.flipFromTo=undefined;ShapeEvent.text.isLineEnd=undefined;ShapeEvent.text.from={num:{para:undefined,portion:undefined,ch:undefined,index:undefined,pos:undefined},element:{para:undefined,line:undefined,word:undefined,subword:undefined,charCount:undefined},pos:{para:undefined,line:undefined,word:undefined,subword:undefined},cursorPosLeft:undefined,
height:undefined};ShapeEvent.text.to={num:{para:undefined,portion:undefined,ch:undefined,index:undefined,pos:undefined},element:{para:undefined,line:undefined,word:undefined,subword:undefined,charCount:undefined},pos:{para:undefined,line:undefined,word:undefined,subword:undefined},cursorPosLeft:undefined,height:undefined};ShapeEditor.config.container.trigger("text_unselected")},init:function(b){var c=ShapeEvent.text,d=ShapeEditor.text.editor.get,f=ShapeEditor.config.get.shapeContainer();b=p("#"+b,
f);c.textContainer=p("#"+Shape.textBody.textContainer,b);c.shapeContainer=f;c.shapeContainerOffset=f.offset();c.shapeOffset=d.offset(b);c.containerOffset=d.offset(c.textContainer,undefined,undefined,f)},withdrawEditing:function(){var b=ShapeEditor.select.shapes[0];if(b&&b.data.type!==p.ShapeConstants.ShapeNodeType.GRAPHICFRAME){var c=b.data;ShapeEditor.text.editor.bullet.check();if((c.placeHolder||c.nvOProps.nvODProps&&c.nvOProps.nvODProps.textbox)&&b.data.textBody){if(c.textBody.paras.length==1&&
c.textBody.paras[0].portions.length==1&&!c.textBody.paras[0].portions[0].t&&!c.textBody.paras[0].portions[0].type){var d=ShapeEditor.config.get.shapeContainer();c={text:b.data.placeHolder?b.data.placeHolder.text:undefined,paraNum:0,portionNum:0};if(b.data.placeHolder){if(b.data.placeHolder.image)b.data.placeHolder.image.render=true;if(b.data.placeHolder.video)b.data.placeHolder.video.render=true;if(b.data.placeHolder.twitter)b.data.placeHolder.twitter.render=true}this.setText(b.data,d,c,b.box)}else if(b.data.placeHolder){if(b.data.placeHolder.image)b.data.placeHolder.image.render=
false;if(b.data.placeHolder.video)b.data.placeHolder.video.render=false;if(b.data.placeHolder.twitter)b.data.placeHolder.twitter.render=false}Shape.props.stroke.set(b.data,d,b.box)}p(document.activeElement).closest("#slideparent").length&&ShapeEditor.focusShape()}},select:{selection:"selection",init:function(b){var c=ShapeEvent.text,d=ShapeEditor.select.getShapesOfZero(),f=ShapeEditor.text.editor,g=f.get;f.clearCopiedContent(true);c.textContainer=p("#"+Shape.textBody.textContainer,b);var h=ShapeEditor.config.get.shapeContainer();
c.shapeContainer=h;c.shapeContainerOffset=h.offset();c.shapeOffset=g.offset(b);c.containerOffset=g.offset(c.textContainer,undefined,undefined,h);f.addBackGroundDiv(d.data,b.parent(),b)},createDiv:function(b,c,d){var f=ShapeEvent.text,g=f.textContainer,h=g.children(".selectedArea");p.each(b,function(o,q){p.each(q,function(r,u){var v=p("#selection"+o+""+r,g);if(v&&v.length){v.css(u);v=p.inArray(v[0],h);h.splice(v,1)}else{v=p("<div>").attr("id","selection"+o+""+r).addClass("selectedArea").css(u);g.append(v)}})});
h.remove();b=g.children(".selectedArea");var m=f.from.num.index===f.to.num.index,n=ShapeEditor.text.editor.cursor;f.isLineEnd=m&&c;n.cursorElement=b;if(!m||d){b.css({border:"","z-index":"-1000"});n.remove(p(b))}else{b.css({border:"1px solid black","z-index":"10000"});n.set(p(b))}},placeCursor:function(b){var c=ShapeEditor.text;b||(b=ShapeEditor.select.getShapesOfZero());this.init(b.box,b.data);ShapeEditor.text.composer.init(b.data);b=c.composer.get.lastIndex()-1;this.select(b,b)},_getLineEnd:function(){var b=
ShapeEvent.text;return b.from.num.index===b.to.num.index&&b.isLineEnd?true:false},getCurrentLineForDown:function(b,c,d){var f=ShapeEvent.text,g=ShapeEditor.text,h=b.pos.para,m=b.pos.line,n=b.cursorPosLeft;b=b.num.index;var o=m,q=h;o=f.textContainer.data(Shape.textBody.indexId);var r=p(p("."+Shape.textBody.paraId,f.textContainer)[h]).data(Shape.textBody.indexId),u=0;f=false;for(i=0;i<h;i++)u+=o[i];for(i=0;i<=m;i++)u+=r[i];if(b===u&&!g.editor.select._getLineEnd()){m+=1;f=d?false:true}if(!f&&m+1<r.length){o=
m+1;q=h;f=true}else if(!f&&h+1<o.length){q=h+1;o=0;f=true}else o=m;if(!f&&c)return{index:g.composer.get.lastIndex()};return{pos:{para:q,line:o},left:n,isKeyEvent:true}},getCurrentLineForUp:function(b,c,d){var f=ShapeEvent.text,g=ShapeEditor.text,h=b.pos.para,m=b.pos.line,n=b.num.index,o=m,q=h,r=p(p("."+Shape.textBody.paraId,f.textContainer)[h]),u=f.textContainer.data(Shape.textBody.indexId),v=r.data(Shape.textBody.indexId);r=0;var C=false,y=b.num.ch;b=b.cursorPosLeft;var x,w,D=false;for(i=0;i<h;i++)r+=
u[i];for(i=0;i<=m;i++)r+=v[i];g=g.editor.select._getLineEnd();if(y!==-1&&n===r&&!g&&!d)w=x=C=true;if(C){c={para:h,line:m};return{pos:c,left:b,isKeyEvent:true,notALineEnd:x,cursorWrap:w}}if(m){o=m-1;q=h;D=true}else if(h){q=h-1;o=p(p("."+Shape.textBody.paraId,f.textContainer)[q]).data(Shape.textBody.indexId).length-1;D=true}if(!D&&c)return{index:0};c={para:q,line:o};return{pos:c,left:b,isKeyEvent:true,notALineEnd:x,cursorWrap:w}},getLineStart:function(b,c){var d=ShapeEvent.text,f=ShapeEditor.text,g=
b.num.index,h=g;if(g!==0){h=0;var m=Shape.textBody.indexId,n=b.pos.para,o=b.pos.line,q=b.element.para,r=b.element.line;d=d.textContainer.data(m);q=q.data(m);m=r.data(m);f.composer.get.lastIndex();for(i=0;i<n;i++)h+=d[i];for(i=0;i<o;i++)h+=q[i];i=n=0;for(l=m.length;i<l;i++)n+=m[i];if(h+n===g&&!f.editor.select._getLineEnd()&&!c)h=g}return{index:h}},getLineEnd:function(b,c){var d=ShapeEvent.text,f=ShapeEditor.text,g=f.composer.get.lastIndex(),h=b.num.index,m=d.from.num.index===d.to.num.index,n=h,o=true;
if(h!==g-1){n=0;var q=Shape.textBody.indexId,r=b.pos.para,u=b.pos.line,v=b.element.para,C=b.element.line;d=d.textContainer.data(q);v=v.data(q);q=C.data(q);C=f.composer.position[r];C=C[C.length-1];for(i=0;i<r;i++)n+=d[i];for(i=0;i<u;i++)n+=v[i];i=0;for(l=q.length;i<l;i++)n+=q[i];if(n===h&&(c||m)&&!f.editor.select._getLineEnd())n+=v[u+1];n=n===g?n-1:n;n===C&&n--;f=f.composer.get.object(n);if(ShapeEditor.select.getShapesOfZero().data.textBody.paras[f.para].portions[f.portion].type===p.ShapeConstants.PortionType.LINEBREAK){n--;
o=false}}return{index:n,stopCursorWrap:o,isLineEnd:o}},getPreviousParaForUp:function(b){var c=b.pos.para,d=b.num.index;b=ShapeEvent.text.textContainer.data(Shape.textBody.indexId);var f=0;p.each(b,function(g,h){f+=h;c=g;if(f>d-1){f-=h;return false}});return{para:c,index:f}},getPreviousParaForDown:function(b){var c=b.pos.para,d=b.num.index;b=ShapeEvent.text.textContainer.data(Shape.textBody.indexId);var f=0,g=ShapeEditor.text.composer.get.lastIndex();p.each(b,function(h,m){f+=m;c=h;if(f>d+1)return false});
f=f===g?f-1:f;return{para:c,index:f}},getIndexForWord:function(b,c){var d=Shape.textBody.paras.portions.t;if(b.data("subword"))b=d.words.getParentWord(b);d=d.line.getParentLine(b);var f=d.closest("."+Shape.textBody.paraId),g=f.closest("#"+Shape.textBody.textContainer),h=Shape.textBody._getIndexNo(b,"word"),m=Shape.textBody._getIndexNo(d,"line");return this.getCurrentStartEnd({pos:{para:Shape.textBody._getIndexNo(f,"para"),line:m,word:h},element:{para:f,line:d,word:b}},g,c)},getCurrentStartEnd:function(b,
c,d){var f=ShapeEvent.text,g=b.pos.para,h=b.pos.line,m=b.pos.word,n=b.pos.word,o=ShapeEditor.text.composer.get.lastIndex(),q=0,r=0,u=0,v=0,C=b.element.para,y=b.element.line;b=b.element.word;c=c&&c.length?c:f.textContainer;c=c.data(Shape.textBody.indexId);f=C.data(Shape.textBody.indexId);var x=y.data(Shape.textBody.indexId),w=[],D=[];w.push(x);D.push({start:m,end:n});if(n=b.data("broken")){var z=Shape.textBody.paras.portions.t;m=n.before;for(var A=b,E=y;m;){x=z.words.getPrevWordInPara(A,E,C);A=x.word;
m=false;if(A.length){E=x.line;h=E.index();x=E.data(Shape.textBody.indexId);w.splice(0,0,x);m=Shape.textBody._getIndexNo(A,"word");D.push({start:m,end:0});m=A.data("broken")}m=m&&m.before?true:false}for(m=n.after;m;){n=z.words.getNextWordInPara(b,y,C);m=false;if(n.word.length){b=n.word;y=n.line;y.index();x=y.data(Shape.textBody.indexId);w.push(x);n=Shape.textBody._getIndexNo(b,"word");D.push({start:0,end:n});m=b.data("broken")}m=m&&m.after?true:false}}p.each(c,function(H,F){q+=F;if(H>=g){q-=F;return false}});
r=q;p.each(f,function(H,F){if(H<h)r+=F});v=u=r;p.each(w,function(H,F){var G=D[H].start,L=D[H].end;p.each(F,function(B,I){if(B<G){u+=I;v=u}else if(B<=L)v+=I})});v=v>=o?o-1:v;o=b.data("space").length;if(d)v-=o;return{word:{start:u,end:v},spaceLength:o}},getNextWord:function(b){var c=ShapeEvent.text,d=ShapeEditor.text.editor.select.getCurrentStartEnd(b),f=b.num.index,g=f,h=ShapeEditor.text.composer.get.lastIndex()-1;if(g!==h){g=d.word.end;if(g===f&&g!==h){d=b.pos.para;f=b.pos.line;var m=b.pos.word,n=
b.element.para;b=b.element.line;var o=c.textContainer.data(Shape.textBody.indexId),q=n.data(Shape.textBody.indexId),r=b.data(Shape.textBody.indexId);do{var u=false;if(m+1<=r.length-1)m++;else if(f+1<=q.length-1){f++;b=p(p("."+Shape.textBody.lineId,n)[f]);r=b.data(Shape.textBody.indexId);m=0}else if(d+1<=o.length-1){d++;n=p(p("."+Shape.textBody.paraId,c.textContainer)[d]);q=n.data(Shape.textBody.indexId);f=0;b=p(p("."+Shape.textBody.lineId,n)[f]);r=b.data(Shape.textBody.indexId);m=0}else break;g+=
r[m];if(p(p("."+Shape.textBody.wordId,b)[m]).data().type!=="SPACE")u=true}while(!u&&g!==h)}}return g},getPrevWord:function(b){var c=ShapeEvent.text,d=ShapeEditor.text.editor.select.getCurrentStartEnd(b),f=b.num.index;if(f!==0){f=d.word.start;if(b.num.ch===-1&&f!==0){d=false;do{var g=b.pos.word;g=b.pos.para;var h=b.element.line,m=h.data(Shape.textBody.indexId);if(g-1>=0){g--;h=p(p("."+Shape.textBody.paraId,c.textContainer)[g]);m=h.data(Shape.textBody.indexId).length-1;h=p(p("."+Shape.textBody.lineId,
h)[m]);m=h.data(Shape.textBody.indexId);g=m.length-1}else break;f-=m[g];if(p(p("."+Shape.textBody.wordId,h)[g]).data().type!=="SPACE")d=true}while(!d&&f!==0)}}return f},getTargetElementFromPosition:function(b,c){var d=ShapeEditor.text.editor,f=ShapeEvent.text.textContainer;c||(c=d.select.getDistanceFromTarget(b));var g=c.left,h=c.top,m=f.data(Shape.textBody.indexId),n=0;p.each(m,function(r){var u=p(p("."+Shape.textBody.paraId,f)[r]);if(d.get.offset(u).top>h){n=r===0?0:r-1;return false}n=r});var o=
p(p("."+Shape.textBody.paraId,f)[n]);m=o.data(Shape.textBody.indexId);var q=0;p.each(m,function(r){var u=p(p("."+Shape.textBody.lineId,o)[r]);if(d.get.offset(u).top>h){q=r===0?0:r-1;return false}q=r});return{pos:{para:n,line:q},left:g}},_getTotalWordWidth:function(b,c){b||(b=c.data());var d=b.wordWidth;b.space&&b.space.length&&p.each(b.space,function(f,g){d+=g.afterSpaceWidth});return d},getIndexFromPosition:function(b,c,d,f,g,h,m){if(d){d=this.getTargetElementFromPosition(d);b=d.pos;c=d.left}g=ShapeEvent.text;
d=ShapeEditor.text.editor;var n=d.select,o=0,q=b.para,r=b.line;b=g.textContainer.data(Shape.textBody.indexId);p.each(b,function(z,A){if(z<q)o+=A});b=p(p("."+Shape.textBody.paraId,g.textContainer)[q]);g=b.data(Shape.textBody.indexId);p.each(g,function(z,A){if(z<r)o+=A});var u=p(p("."+Shape.textBody.lineId,b)[r]),v=u.data(Shape.textBody.indexId),C=undefined,y=-1;g=b=false;if(v&&v.length){C=p("."+Shape.textBody.wordId,u);var x=d.get.offset(p(C[0])).left;if(x>=c)return{index:o,stopCursorWrap:false,isLineEnd:false};
else p.each(C,function(z,A){var E=p(A).data();x+=n._getTotalWordWidth(E);if(x>c){x-=E.wordWidth;y=z;return false}});if(y===-1||y===C.length-1){b=h?false:true;g=m?false:true;y=C.length-1}p.each(v,function(z,A){if(z<y)o+=A});h=C=p(p("."+Shape.textBody.wordId,u).get(y));m=false;u=C.data();if(u.type==="LINEBREAK"||u.type==="EOP"&&y===0)g=b=false;u=u[Shape.textBody.indexId];var w=-1;if(u&&u.length){h=p("."+Shape.textBody.subwordId,C);var D=d.get.offset(p(h[0]),undefined,true).left;p.each(h,function(z,
A){D+=p(A).width();if(D>c){D-=p(A).width();w=z;return false}});if(w===-1)w=h.length-1;p.each(u,function(z,A){if(z<w)o+=A});h=p(p("."+Shape.textBody.subwordId,C).get(w));m=true}m=d.get.offset(h,undefined,m).left;charIndex=d.select.getCharIndex({left:c-m},h,C,q);o+=charIndex.index;d=ShapeEditor.text.composer.get.lastIndex();if(charIndex.lastIndex&&o===d-1)o=f?d:o;return{index:o,stopCursorWrap:b,isLineEnd:g}}return false},updateElementDataForLineBreak:function(b,c){var d=ShapeEditor.text,f=b.pos.line,
g=p(p("."+Shape.textBody.lineId,b.element.para)[f+1]),h=p(p("."+Shape.textBody.wordId,g)[0]);h=d.editor.get.offset(h);d=h.left;h=h.top;g=g.height();b.num.pos={left:d,top:h,height:g};if(c)b.pos.line=f+1},getTargetElementFromIndex:function(b,c,d,f){var g=ShapeEvent.text;ShapeEditor.select.getShapesOfZero();var h=ShapeEditor.text,m=h.composer,n=m.get.object(b);m=m.get.lastIndex();if(!(b>m)){if(b===m){h=this.getTargetElementFromIndex(m-1);h.num.lastIndex=true;return h}m={};var o=p(p("."+Shape.textBody.paraId,
g.textContainer)[n.para]);m.para=o;g=g.textContainer.data(Shape.textBody.indexId);var q=0;p.each(g,function(B,I){if(B===n.para)return false;q+=I});g=o.data(Shape.textBody.indexId);var r=0,u=q;p.each(g,function(B,I){u+=I;if(u>=b){u-=I;r=B;return false}});g={para:n.para};g.line=r;var v=p(p("."+Shape.textBody.lineId,o)[r]);m.line=v;o=v.data(Shape.textBody.indexId);var C=0,y=u,x=false,w=y,D=undefined,z=undefined;if(o&&o.length){p.each(o,function(B,I){y+=I;if(y>=b){y-=I;C=B;return false}});g.word=C;var A=
p(p("."+Shape.textBody.wordId,v)[C]);o=m.word=A;x=false;w=y;var E=false;if((z=A.data(Shape.textBody.indexId))&&z.length){E=true;var H;p.each(z,function(B,I){w+=I;if(w>=b){w-=I;H=B;return E=false}});if(E){o=z=p(p("."+Shape.textBody.subwordId,A)[z.length-1]);x=true;w=y}else{g.subword=H;D=p(p("."+Shape.textBody.subwordId,A)[H+1]);o=z=p(p("."+Shape.textBody.subwordId,A)[H]);m.subword=z;x=true}}}else{o=p("#dummyword",v);g.word=0;Shape.log("dummyword==",q,u,y);x=false;w=y}if(c)return g;z=h.editor.select._checkSubPortion({paraNum:n.para,
portionNum:n.portion,element:o});var F=b-w;m.charCount=b-y-1;x=h.editor.get.offset(o,undefined,x);c=x.left;if(!d){if(!(o&&o.data())){Shape.log("===issue: added for testing====");Shape.log("subele",o,o&&o.data()?o.data():"nothiing no data");Shape.log("ind===",b,"wordIndex",C,"wordEle",A,"lineIndex",r,"lineEle",v);return}A=o.data().text?o.data().text:"";v=E?F-m.word.data().length+A.length:F;d=A.substring(0,v);var G=0,L=v-d.length;if(L)p.each(m.word.data("space"),function(B,I){G+=I.afterSpaceWidth;L--;
if(L===0)return false});else{A={targetText:A,offsetIndex:v,substr:d,nextSubword:D};D=0;if(f){A=this._checkDiacritic.prev(A);D=A.indexChange;if(D<0)return h.editor.select.getTargetElementFromIndex(n.index+D,undefined,undefined,f)}else{A=this._checkDiacritic.next(A);D=A.indexChange;n.index+=D;n.ch+=D;m.charCount+=D}}f=this.getStringWidth(o,d,undefined,g.para);c=c+f+G}if(z){f=z.height;d=z.top}else{f=o.height();d=x.top}if(!f){f=m.line.height();d=h.editor.get.offset(m.line).top}n.pos={left:c,top:d,height:f};
return{num:n,element:m,pos:g}}},range:{diacritic:{start:768,end:879},highSurrogate:{start:55296,end:56319},lowSurrogate:{start:56320,end:57343}},_checkDiacritic:{next:function(b){var c=ShapeEditor.text.editor.select,d=b.targetText,f=b.offsetIndex;b=0;var g=d.substring(f,d.length),h=g.length;if(h){var m=false;d=d.substr(f?f-1:f,1).charCodeAt(0);if(d>=c.range.highSurrogate.start&&d<=c.range.highSurrogate.end)m=true;for(j=0;j<h;j++){d=g.substring(j,j+1).charCodeAt(0);if(m){d>=c.range.lowSurrogate.start&&
d<=c.range.lowSurrogate.end||Shape.error("== only highSurrogate value is present. there is NO lowSurrogate. ");m=false}else if(!(d>=c.range.diacritic.start&&d<=c.range.diacritic.end))break;b=j+1}}return{indexChange:b}},prev:function(b){var c=ShapeEditor.text.editor.select,d=b.substr,f=b.nextSubword,g=0,h=false;b=b.targetText.substring(0,b.offsetIndex+1);if(b.length===d.length&&f&&f.length)b+=f.data().text.substring(0,1);j=b.length-1;for(k=1;j>=0;j--,k++){f=b.substring(j,j+1).charCodeAt(0);if(f>=c.range.lowSurrogate.start&&
f<=c.range.lowSurrogate.end)h=true;else if(h){f>=c.range.highSurrogate.start&&f<=c.range.highSurrogate.end||Shape.error("== only lowSurrogate value is present. there is NO highSurrogate ");h=false}if(!(f>=c.range.diacritic.start&&f<=c.range.diacritic.end)&&!h)break;g=-k}d=d.substring(0,d.length+g);return{indexChange:g,substr:d}}},_checkSubPortion:function(b){var c=b.paraNum,d=b.element;b=b.portionNum;c=(c=ShapeEditor.select.getShapesOfZero().data.textBody.paras[c].portions[b])?c.props:undefined;b=
undefined;if(c&&c.baseline)b=this._getSubPortionData(d);return b},_getSubPortionData:function(b){var c=undefined;if((b=b.children("#"+Shape.textBody.subportionId))&&b.length){c=ShapeEditor.text.editor.get.offset(b,undefined,true);b=b.height();var d=b*Shape.textBody.paras.portions.props.subPortionRatio;c.top=(b-d)/2+c.top;c.height=d}return c},_getTotalSubwordText:function(b){var c="",d=b.data();if(d.hasSubword){b=p("."+Shape.textBody.subwordId,b);p.each(b,function(f,g){var h=p(g).data();c+=h.text?
h.text:""})}else c=d.text?d.text:"";return c},checkLastWord:function(b,c){var d=b.pos.para,f=p.extend(true,{},b),g=ShapeEditor.text,h=g.composer.position[d];d=b.num.index;if(d!==h[h.length-1]-1){var m=b.element.line,n=b.element.word,o=b.pos.word;h=n.data();if((m=m.data(Shape.textBody.indexId))&&o===m.length-1){o=-1;m=h.space?h.space.length:0;var q=b.element.subword?b.element.subword:b.element.word;q=q.data();n=this._getTotalSubwordText(n);var r=b.element.charCount;if(q.type==="LINEBREAK"||(h.broken&&
h.broken.after||!(h.space&&h.space.length!==0))&&n.length===r+1)o=d+1;else if(!(h.broken&&h.broken.after))if(r+1===n.length+m)o=d+1;if(o>-1)if(g=g.editor.select.getTargetElementFromIndex(o,undefined,true))f=g}}else if(d==h[h.length-1]-1){q=f.element.word;(q=q.data())&&q.type==="LINEBREAK"&&g.editor.select.updateElementDataForLineBreak(f,c)}return f},_checkFlipFromTo:function(b,c,d,f){if(b){if(ShapeEvent.text.flipFromTo)b=b==="from"?"to":"from";if(c<=d)if(b==="from")if(f>d){b=d;ShapeEvent.text.flipFromTo=
!ShapeEvent.text.flipFromTo}else{b=f;f=d}else if(f<c){b=f;f=c;ShapeEvent.text.flipFromTo=!ShapeEvent.text.flipFromTo}else b=c;else if(b==="from")if(f<=c){b=f;f=c}else{b=c;ShapeEvent.text.flipFromTo=!ShapeEvent.text.flipFromTo}else if(f<=d)b=d;else{b=f;f=d;ShapeEvent.text.flipFromTo=!ShapeEvent.text.flipFromTo}}else{b=f;ShapeEvent.text.flipFromTo=false}return{fromIndex:b,toIndex:f}},_checkCursorType:function(b,c){return b===c?"cursor":"selection"},selectFromTablet:function(b,c,d){var f=ShapeEditor.text.editor,
g=f.select,h=ShapeEvent.text;b={pageX:b,pageY:c};c=g.getDistanceFromTarget(b);var m=h.textContainer?h.textContainer.height():undefined,n=h.textContainer?h.textContainer.width():undefined;if(!(!m||!n||!d&&!c)){b=g.getTargetElementFromPosition(b,c);c=b.pos;b=b.left;m=h.from.num.index;h=h.to.num.index;g=g.getIndexFromPosition(c,b,undefined,d);d=this._checkFlipFromTo(d,m,h,g.index);g=g.stopCursorWrap;f.navigation.move(d.fromIndex,d.toIndex,g,g)}},select:function(b,c,d,f,g,h){var m=ShapeEvent.text,n,o,
q=ShapeEditor.select.getShapesOfZero().data,r=m.textContainer,u=ShapeEditor.text.composer,v=ShapeEditor.text.editor;g=v.select;var C=u.position;if(typeof b==="undefined")b=m.from.num.index;else{n=this.getTargetElementFromIndex(b);if(!n)return;b=n.num.index;m.from=n}if(typeof c==="undefined")c=m.to.num.index;else{n=this.getTargetElementFromIndex(c);if(!n)return;c=n.num.index;m.to=n}var y=b,x=c,w=false;if(b>c){var D=b;b=c;c=D;n=p.extend(true,{},m.to);o=p.extend(true,{},m.from);w=true}else{n=p.extend(true,
{},m.from);o=p.extend(true,{},m.to)}var z=false,A=m.to.num.lastIndex&&m.to.num.ch===-1;if(b===c&&!d){D=(D=o.element.word.data())&&D.type==="LINEBREAK"?true:false;n=p.extend(true,{},this.checkLastWord(n));o=p.extend(true,{},n);b=n.num.index;c=o.num.index;if(D&&m.to.num.lastIndex)return}else if(b!==c){b=o.pos.para-1;D=(D=o.element.word.data())&&D.type==="LINEBREAK"?true:false;if(b!==-1&&c===C[b][C[b].length-1]&&!A)if(D)v.select.updateElementDataForLineBreak(o,true);else{D=v.select.getTargetElementFromIndex(o.num.index-
1);o=p.extend(true,{},D);(b=o.element.word.data())&&b.type==="LINEBREAK"&&v.select.updateElementDataForLineBreak(o,true)}else if(D)z=true;n=p.extend(true,{},this.checkLastWord(n,true));b=n.num.index}if(!h)if(w){m.from.cursorPosLeft=o.num.pos.left;m.to.cursorPosLeft=n.num.pos.left}else{m.from.cursorPosLeft=n.num.pos.left;m.to.cursorPosLeft=o.num.pos.left}D=ShapeEditor.select.getShapesOfZero().box.data(Shape.textbox);Shape.textBody.updateDimension(D,q.props.transform);h={};r.data(Shape.textBody.indexId);
q=n.pos.para;m=o.pos.para;w=n.pos.line;d=o.pos.line;var E=u.get.lastIndex();u={};for(i=q;i<=m;i++){var H=p(p("."+Shape.textBody.paraId,r)[i]),F=H.data(Shape.textBody.indexId).length-1,G=i===q?n.pos.line:0,L=i===m?o.pos.line:F;h[i]={};D=h[i];for(j=G;j<=L;j++){var B=p(p("."+Shape.textBody.lineId,H).get(j)),I=p(p("."+Shape.textBody.wordId,B).get(0));G=p(p("."+Shape.textBody.wordId,B).get(-1));var M=v.get.offset(B).top;I=v.get.offset(I);var P=v.get.offset(G);D[j]={left:0,width:0,top:M,height:p(B).outerHeight()};
B=D[j];if(i===q&&j===w){B.left=n.num.pos.left;B.width=P.left+g._getTotalWordWidth(undefined,G)-n.num.pos.left;u.start={left:B.left,top:B.top,width:0,height:B.height}}else{B.left=I.left;B.width=P.left+g._getTotalWordWidth(undefined,G)-I.left}if(i===m&&j===d){B.width=q===m&&w===d?o.num.pos.left-n.num.pos.left:o.num.pos.left-I.left;u.end={left:B.left+B.width,top:B.top,width:0,height:B.height}}if(j!==F&&(i!==m||i===m&&j!==d)){if((G=G.data())&&G.type==="LINEBREAK"){B.width+=9;u&&u.end&&(u.end.left+=9)}}else if(j===
F&&b!==c&&c>=C[i][C[i].length-1]&&c!==E){B.width+=9;u&&u.end&&(u.end.left+=9)}}}if(b===c){h[q][w].height=n.num.pos.height;h[q][w].top=n.num.pos.top}r=false;if(A||z){h[o.pos.para][o.pos.line].width+=9;u.end.left+=9;r=true}v.bullet.changeStatus(n,o);if(Shape.touchDevice){c=g._checkCursorType(y,x);g._triggerEventForTablet({selectionData:h,dragPoints:u,type:c})}else{this.createDiv(h,f,r);b!==c&&v.setCopiedContent()}},_triggerEventForTablet:function(b){ShapeEditor.config.container.trigger("cursorData",
b)},count:function(b,c){var d=0;do{b=prev=b.prev("."+c);d++}while(prev.length);return d-1},getDistanceFromTarget:function(b,c){var d=ShapeEvent.text,f=ShapeEditor.select.getShapesOfZero();if(f){var g=f.box,h=f.data,m=h.scale?h.scale:1;f=(b.pageX-d.shapeContainerOffset.left)/m;m=(b.pageY-d.shapeContainerOffset.top)/m;var n=h.props.transform.rotate;n=n?n:0;var o={left:f,top:m};if(n){g=g.data(Shape.textbox);var q=h.props.transform.dim;o=h.props.transform.pos;var r=q.width*0.5;q=q.height*0.5;Shape.textBody.updateDimension(g,
h.props.transform);h={x:o.left+r,y:o.top+q};h=zoho.math.getRotatedValue(-1*n,f,m,h.x,h.y);f=h.x;m=h.y;o={left:f,top:m}}o.left-=d.containerOffset.left;o.top-=d.containerOffset.top;if(c&&c.left)return{left:o.left-c.left,top:o.top-c.top};return o}},getStringWidth:function(b,c,d,f){var g=Shape.textBody.paras.portions.t;d||(d=b.clone(true,true));d.data("text",c);b=ShapeEditor.select.getShapesOfZero().data;b.textBody.paras.num=f;g.words.setDim(d,b);return g.words.width(d)},getCharIndex:function(b,c,d,f){var g=
c.data()&&c.data().text?c.data().text:"",h=c.clone(true,true);ShapeEditor.select.getShapesOfZero();var m=g.length,n=true;d=d.data();var o=0,q=0,r,u=c.data()?c.data(Shape.textBody.indexId):[];if(u&&u.length){var v=p("."+Shape.textBody.subwordId,c);p.each(u,function(C,y){o+=y;var x=p(v.get(C)).data();q+=x.wordWidth})}else for(i=1;i<=m;i++){r=q;u=g.substring(0,i);o=i;q=this.getStringWidth(c,u,h,f);if(q>b.left){n=false;break}}c=false;if(n&&d&&d.space&&d.space.length){r=q;p.each(d.space,function(C,y){q+=
y.afterSpaceWidth;o++;if(q>b.left)return false})}else if(n)c=true;f=q;if(Math.abs(q-b.left)>Math.abs(r-b.left)){o--;f=r}if(!n){g=this._checkDiacritic.next({targetText:g,offsetIndex:o}).indexChange;o+=g}h.remove();return{index:o,pos:f,height:undefined,lastIndex:c}},getTargetChar:function(b,c,d,f,g){f=ShapeEditor.text.editor.get.offset(c,undefined,f);ShapeEvent.text.targetOffset=f;b=this.getDistanceFromTarget(b,f);c=this.getCharIndex(b,c,d,g);c.pos+=f.left;c.pos={left:c.pos,top:f.top,height:c.height};
c.charOffset=b;return c},addIndex:function(b,c){for(var d=0,f=b.data(Shape.textBody.indexId),g=0;g<c;g++)d+=f[g];return d},getTargetIndex:function(b){var c=b.targetObj,d=ShapeEditor.text.composer,f=ShapeEvent.text.textContainer,g=c.para,h=c.line,m=c.word,n=c.subword.length?c.subword:undefined,o=this.count(m,Shape.textBody.wordId,h),q=this.count(h,Shape.textBody.lineId,g),r=this.count(g,Shape.textBody.paraId);c=0;c+=this.addIndex(f,r);c+=this.addIndex(g,q);c+=this.addIndex(h,o);h=false;f=m;g=0;if(n){f=
this.count(n,Shape.textBody.subwordId,m);c+=this.addIndex(m,f);f=n;h=true}b=this.getTargetChar(b,f,m,h,r);if(b.index===0)return{index:c,newIndex:true};else g=b.index-1;c+=b.index;m=d.get.lastIndex();if(b.lastIndex&&c===m-1)return{index:m,newIndex:true};d=d.get.object(c);if(m=this._checkSubPortion({paraNum:d.para,portionNum:d.portion,element:f})){b.pos.height=m.height;b.pos.top=m.top}else if(!b.pos.height)b.pos.height=f.height();b.pos.width=1;return{index:c,indexPos:b,charCount:g,object:d}},down:function(b,
c,d){c=ShapeEditor.text.editor;var f=ShapeEditor.text.composer,g=b.which===3,h=ShapeEditor.select.getShapesOfZero().data,m=b.targetObj,n=b.shiftKey,o=ShapeEvent.text;o.current="to";c.property=undefined;ShapeEditor.config.container.trigger("shape_selected",["text_Editable"]);f.init(h);c.select.init(d);c.bullet.check();if(!(g&&o.from.num.index!==o.to.num.index)){var q;if(o.from.element.word)q=p.extend(true,{},o.from);d=true;f=false;if(!n||n&&typeof o.from.num.index==="undefined")if(b.data&&b.data.atStart){m=
c.select.getTargetElementFromIndex(0);if(!m)return;o.from.num=m.num;o.from.element=m.element;o.from.pos=m.pos}else if(m&&m.para&&m.para.length){g=c.select.getTargetIndex(b);if(g.newIndex){m=c.select.getTargetElementFromIndex(g.index);if(!m)return;o.from.num=m.num;o.from.element=m.element;o.from.pos=m.pos;d=false}else{h=c.select.getTargetElementFromIndex(g.index,true);if(!h)return;var r=g.object,u=g.indexPos.pos;o.from.num.para=r.para;o.from.num.portion=r.portion;o.from.num.ch=r.ch;o.from.num.index=
r.index;o.from.num.pos=u;o.from.element.para=m.para;o.from.element.line=m.line;o.from.element.word=m.word;o.from.element.subword=m.subword.length?m.subword:undefined;o.from.element.charCount=g.charCount;o.from.pos.para=h.para;o.from.pos.line=h.line;o.from.pos.word=h.word;o.from.pos.subword=h.subword?h.subword:undefined}}else{d=c.select.getIndexFromPosition(undefined,undefined,b);m=c.select.getTargetElementFromIndex(d.index);if(!m)return;c.navigation.preMove(o.from,o.to);o.from.num=m.num;o.from.element=
m.element;o.from.pos=m.pos;f=d=d.stopCursorWrap}if(q&&q.element.word[0]!==o.from.element.word[0]&&c._isEditable())(q=ShapeEditor.text.editor.navigation._spellCheckSameIndex(o.from,q))&&ShapeEditor.text.editor.navigation.triggerCursorTransit(undefined,undefined,{wordObj:q.wordObj});o.textContainer.data("from",o.from);o.textContainer.removeData("to");p(document).bind(ShapeEvent.EVENTS.MOUSEMOVE+".Shape",{},c.select.move);p(document).bind(ShapeEvent.EVENTS.MOUSEUP+".Shape",{targetId:b.targetId,stopCursorWrap:d,
isLineEnd:f,tripleClick:b.tripleClick,shiftKey:n},c.select.up)}},move:function(b){var c=ShapeEvent.text,d=ShapeEditor.text.editor;ShapeEventHandler.getTarget(b);ShapeEditor.select.getShapesOfZero();ShapeEvent.text.setTextTarget(b);var f=b.targetObj,g=false;if(f.para&&f.para.length){b=d.select.getTargetIndex(b);if(b.newIndex){f=d.select.getTargetElementFromIndex(b.index);if(!f)return;c.to.num=f.num;c.to.element=f.element;c.to.pos=f.pos}else{var h=d.select.getTargetElementFromIndex(b.index,true);if(!h)return;
var m=b.object,n=b.indexPos.pos;c.to.num.para=m.para;c.to.num.portion=m.portion;c.to.num.ch=m.ch;c.to.num.index=m.index;c.to.num.pos=n;c.to.element.para=f.para;c.to.element.line=f.line;c.to.element.word=f.word;c.to.element.subword=f.subword.length?f.subword:undefined;c.to.element.charCount=b.charCount;c.to.pos.para=h.para;c.to.pos.line=h.line;c.to.pos.word=h.word;c.to.pos.subword=h.subword?h.subword:undefined}}else{g=d.select.getIndexFromPosition(undefined,undefined,b,true);f=d.select.getTargetElementFromIndex(g.index);
if(!f)return;c.to.num=f.num;c.to.element=f.element;c.to.pos=f.pos;g=g.stopCursorWrap}c.textContainer.data("to",c.to);d.select.select(undefined,undefined,true,g)},up:function(b){var c=ShapeEvent.text,d=ShapeEditor.text.editor,f=b.data,g=ShapeEditor.config,h=f.isLineEnd,m=f.stopCursorWrap;if(f.shiftKey){b=d.select.getIndexFromPosition(undefined,undefined,b,true);var n=d.select.getTargetElementFromIndex(b.index);if(n){c.to.num=n.num;c.to.element=n.element;c.to.pos=n.pos;m=h=b.stopCursorWrap;c.textContainer.data("to",
c.to)}}if(!c.textContainer.data("to"))c.to=p.extend(true,{},c.from);f.targetId===Shape.textBody.bullet||f.tripleClick||!d._isEditable()?d.navigation.selectPara(c.from.num.para,c.to.num.para):d.select.select(undefined,undefined,m,h);d.focusEditor();g.container.trigger("cursor_transit",[{type:"acrossPortions"}]);g.container.trigger("cursor_transit",[{type:"acrossParas"}]);p(document).unbind(ShapeEvent.EVENTS.MOUSEMOVE+".Shape",d.select.move);p(document).unbind(ShapeEvent.EVENTS.MOUSEUP+".Shape",d.select.up)},
para:function(b,c){var d;c=!c?ShapeEventHandler.getTarget(b).closest("div"):c;if(typeof ShapeEvent.text.from.num.para!="undefined"){var f=ShapeEditor.select.getShapesOfZero();d=c.attr("id")==ShapeEditor.text.editor.textEditingDivId;if(!d){shapeBox=c.closest("."+Shape.shapeClass);if(shapeBox.length)d=shapeBox.attr("id")==f.data.nvOProps.nvDProps.id}}return d},all:function(){var b=ShapeEditor.text,c=b.editor;b=b.composer.get.lastIndex();c.navigation.move(0,b,undefined,undefined,undefined,true)}},get:{offset:function(b,
c,d,f){f=f?f:ShapeEvent.text.textContainer;c={};if(ShapeEvent.posRotated){var g=c=0;f=b.closest(f);var h={top:0,left:0};if(f.length)for(;!b[0].isEqualNode(f[0]);){c+=b[0].offsetLeft;g+=b[0].offsetTop;b=p(b[0].offsetParent);if(d&&(ShapeEvent.offsetParent||Shape.touchDevice)){b=p(b[0].offsetParent);d=false}}c+=h.left;g+=h.top;c={left:c,top:g}}else{c=b.offset();b=ShapeEvent.text.contOffset;return{left:c.left-b.left,top:c.top-b.top}}return c},charOffset:function(b){var c=ShapeEvent.text,d=c.textContainer;
d={};if(ShapeEvent.posRotated){var f=0,g=0;d=b.closest("#"+Shape.textBody.textContainer);if(d.length){for(;b[0]&&!b[0].isEqualNode(d[0]);){f+=b[0].offsetLeft;g+=b[0].offsetTop;b=p(b[0].offsetParent)}f+=c.offset.left;g+=c.offset.top}d={left:f,top:g}}else{d=b.offset();b=ShapeEvent.text.contOffset;return{left:d.left-b.left,top:d.top-b.top}}return d}},cursor:{currentPosition:undefined,blinkId:undefined,blinkTime:600,cursorElement:undefined,selectionStart:undefined,prev:{from:undefined,to:undefined},desiredPos:{horizontal:undefined,
vertical:undefined},containerOffset:undefined,cursorAppearence:["visible","hidden"],set:function(b){this.show(b);this.cursorAppearence[0]=="visible"?this.show(b):this.hide(b);this.blinkId&&clearTimeout(this.blinkId);this.blinkId=setTimeout(function(){ShapeEditor.text.editor.cursor.blink(b)},this.blinkTime)},show:function(b){b=b?b:ShapeEditor.text.editor.cursor.cursorElement;b.css({visibility:"visible",display:"inline"})},hide:function(b){b=b?b:ShapeEditor.text.editor.cursor.cursorElement;b.css({visibility:"hidden",
display:"none"})},blink:function(b){if(b.css("visibility")==this.cursorAppearence[0])this.cursorAppearence[1]=="visible"?this.show(b):this.hide(b);else this.cursorAppearence[0]=="visible"?this.show(b):this.hide(b);this.blinkId=setTimeout(function(){ShapeEditor.text.editor.cursor.blink(b)},this.blinkTime)},getIndex:function(){var b=ShapeEditor.text.editor._getFromTo();return{si:b.from.num.index,ei:b.to.num.index,at:"update"}},remove:function(b){clearTimeout(this.blinkId);this.blinkId=undefined;b&&
this.show(b)},position:function(b){ShapeEditor.text.editor.navigation.move(b.si,b.ei,undefined,undefined,undefined,undefined,undefined,undefined,undefined,true)},refresh:function(b,c){if(typeof b.num.index!=="undefined"&&typeof c.num.index!=="undefined"){ShapeEditor.text.editor.select.select(b.num.index,c.num.index);ShapeEditor.text.editor.navigation.checkCursorTransit(true)}}},addBackGroundDiv:function(b,c,d){var f,g=ShapeEditor.text.editor;f=p("#"+g.textEditingDivId,c);if(!f.length){f=p("<div id ="+
g.textEditingDivId+"></div>");g.textEditingDiv=f;c.append(f)}b=b.props.transform;c={position:"absolute",width:b.dim.width,height:b.dim.height,left:b.pos.left,top:b.pos.top};if(d.hasClass("grouped")||d.hasClass("cell")){c.left=d.css("left");c.top=d.css("top")}f.css(c);VectorUtil.rotateElement(f,c,1,b.rotate?b.rotate:0);f.insertBefore(d)},setText:function(b,c,d,f){var g=p.extend(true,{},b);g.textBody.paras.num=d.paraNum;g.textBody.paras[d.paraNum].portions.num=d.portionNum;g.textBody.paras[d.paraNum].portions[d.portionNum].t=
d.text;c=c?c:ShapeEditor.config.get.shapeContainer();var h=[Shape.textBody.textContainer];d.text=d.text?d.text:"";p.each(h,function(m,n){g.textBody.id=n;Shape.textBody.paras.element(g,c,f);Shape.textBody.paras.portions.element(g,c,f);Shape.textBody.paras.portions.t.set(g,c,f,undefined,d.text);if(!d.doNotSetBullet&&g.textBody.paras[d.paraNum].style.listStyle&&g.textBody.paras[d.paraNum].style.listStyle.bullet){g.textBody.paras[0].style.listStyle.bullet.status=Shape.textBody.paras.style.listStyle.bullet.enabled;
Shape.textBody.paras.style.listStyle.bullet.set(g,c,f)}});d.text?Shape.create.placeHolder.icon.set(b,c,f):Shape.create.placeHolder.icon.remove(b,c,f)},border:function(b,c,d){Shape.props.stroke.set(b,c,d)},navigation:{horizontalNavigation:function(b,c){var d={line:false,word:false,select:false};p.each(ShapeEvent.isMac?c.mac:c.other,function(f,g){d[g]=d[g]?d[g]:b[f]});return d},right:function(b,c){var d=this.horizontalNavigation(b,c);d.line?this._end(d.select):this._right(d.select,d.word)},_right:function(b,
c){var d=ShapeEvent.text;ShapeEditor.select.getShapesOfZero();var f=ShapeEditor.select.shapes[0].data,g=ShapeEditor.text.editor;if(g._isEditable()){var h;if(g.isSelected()&&!b)h=d=Math.max(d.from.num.index,d.to.num.index);else{h=d.from.num.index;var m=d.to.num.index;if(c){d=g.select.getNextWord(d.to);b||(h=d)}else{d=d.to.num.index;g=ShapeEditor.text.composer.get.lastIndex();if(b)d=d<g?d+1:g;else h=d=d<g-1?d+1:g-1}}f.obj&&f.obj.type==="TABLE"&&m===d?this.triggerCursorTransit(false,false,false,"right"):
this.move(h,d,undefined,undefined,undefined,undefined,undefined,true)}},left:function(b,c){var d=this.horizontalNavigation(b,c);d.line?this._home(d.select):this._left(d.select,d.word)},_left:function(b,c){var d=ShapeEvent.text,f=ShapeEditor.select.shapes[0].data;ShapeEditor.select.getShapesOfZero();var g=ShapeEditor.text.editor;if(g._isEditable()){var h,m;if(g.isSelected()&&!b)h=d=Math.min(d.from.num.index,d.to.num.index);else{h=d.from.num.index;m=d.to.num.index;if(c)d=g.select.getPrevWord(d.to);
else{d=d.to.num.index;d=d<1?0:d-1}h=b?h:d}f.obj&&f.obj.type==="TABLE"&&m===d?this.triggerCursorTransit(false,false,false,"left"):this.move(h,d,undefined,undefined,undefined,!b,true,true)}},verticalNavigation:function(b,c){var d={line:false,select:false};p.each(ShapeEvent.isMac?c.mac:c.other,function(f,g){d[g]=d[g]?d[g]:b[f]});return d},up:function(b,c){var d=this.verticalNavigation(b,c);this._up(d.select,d.para)},_up:function(b,c){var d=ShapeEvent.text,f=ShapeEditor.select.shapes[0].data;ShapeEditor.select.getShapesOfZero();
var g=ShapeEditor.text.editor,h,m;if(g._isEditable()){var n=false;h=d.from.num.index;var o=d.to.num.index;if(c){d=g.select.getPreviousParaForUp(d.to).index;b||(h=d)}else{d=d.to.num.index;m={select:b,doNotSkip:false,methodName:"getCurrentLineForUp"};n=this._getCurrentLine(m);if(n.toIndex===d){m.doNotSkip=true;n=this._getCurrentLine(m)}h=typeof n.fromIndex!=="undefined"?n.fromIndex:h;d=n.toIndex;m=n.stopCursorWrap;n=n.isLineEnd}g=undefined;if(f.obj&&f.obj.type==="TABLE")if(c)g="left";else if(o===d)g=
"up";g?this.triggerCursorTransit(false,false,false,g):this.move(h,d,m,n,true,undefined,undefined,true)}else this._swapParaValues(-1,b)},_getCurrentLine:function(b){var c=ShapeEditor.text.editor,d=ShapeEvent.text,f=b.select,g,h,m;b=c.select[b.methodName](d.to,f,b.doNotSkip);if(typeof b.index==="undefined"){d=c.select.getIndexFromPosition(b.pos,d.to.cursorPosLeft,undefined,f,b.isKeyEvent);c=d.index;if(!f){g=c;h=d.stopCursorWrap;m=d.isLineEnd}}else c=b.index;return{fromIndex:g,toIndex:c,stopCursorWrap:h,
isLineEnd:m}},down:function(b,c){var d=this.verticalNavigation(b,c);this._down(d.select,d.para)},_down:function(b,c){var d=ShapeEvent.text,f=ShapeEditor.select.shapes[0].data;ShapeEditor.select.getShapesOfZero();var g=ShapeEditor.text.editor,h,m;if(g._isEditable()){var n=false;h=d.from.num.index;var o=d.to.num.index;if(c){d=g.select.getPreviousParaForDown(d.to).index;b||(h=d)}else{d=d.to.num.index;m={select:b,doNotSkip:false,methodName:"getCurrentLineForDown"};n=this._getCurrentLine(m);if(n.toIndex===
d){m.doNotSkip=true;n=this._getCurrentLine(m)}h=typeof n.fromIndex!=="undefined"?n.fromIndex:h;d=n.toIndex;m=n.stopCursorWrap;n=n.isLineEnd}g=undefined;if(f.obj&&f.obj.type==="TABLE")if(c)g="right";else if(o===d)g="down";g?this.triggerCursorTransit(false,false,false,g):this.move(h,d,m,n,true,undefined,undefined,true)}else this._swapParaValues(1,b)},home:function(b,c){var d={text:false,select:false};p.each(ShapeEvent.isMac?c.mac:c.other,function(f,g){d[g]=d[g]?d[g]:b[f]});this._home(d.select,d.text)},
_home:function(b,c){var d=ShapeEvent.text,f=ShapeEditor.text.editor;if(c)this.startOf.text();else{var g=d.from;d=d.to;var h=false;if(g.num.index<d.num.index)if(b){temp=d;h=true}else temp=g;else temp=d;f=f.select.getLineStart(temp,h).index;this.move(b?g.num.index:f,f,false,false,undefined,!b,true,true)}},end:function(b,c){var d={text:false,select:false};p.each(ShapeEvent.isMac?c.mac:c.other,function(f,g){d[g]=d[g]?d[g]:b[f]});this._end(d.select,d.text)},_end:function(b,c){var d=ShapeEvent.text,f=ShapeEditor.text.editor;
if(c)f=this.endOf.text();else{var g=d.from,h=d.to;d=false;if(g.num.index>h.num.index)if(b)d=true;else h=g;f=f.select.getLineEnd(h,d);d=f.index;this.move(b?g.num.index:d,d,f.stopCursorWrap&&true,f.isLineEnd&&true,undefined,undefined,undefined,true)}},swapSelect:function(){return ShapeEvent.text.current==="from"?"to":"from"},_spellCheckSameIndex:function(b,c){var d=ShapeEditor.text.editor.select,f=false,g=c.num.index,h=d.getTargetElementFromIndex(g),m=h.element.word,n=h.element.charCount,o=b.element.word,
q=b.num.index,r=b.element.charCount,u=d._getTotalSubwordText(m).length,v=m.data("space")?m.data("space").length:0,C=d._getTotalSubwordText(o).length,y=d.getCurrentStartEnd(b),x=y.word.start;y=y.word.end;if(m[0]!==o[0]){f=m.data();o=o.data();r=h.pos.line!==b.pos.line&&f.broken&&o.broken&&(f.broken.after&&f.broken.after===o.broken.before||f.broken.before&&f.broken.before===o.broken.after)&&!(r>C-1);if(f.type!=="LINEBREAK"&&(v!==0&&g===x||q===g-n-1&&n===0)||r)f=false;else if(f.type==="LINEBREAK"&&(g>
q||q-g>1)||u<u+v){d=d.getTargetElementFromIndex(g+1);f={wordObj:d}}else f={wordObj:h}}else if(g===y&&n>r&&n>u-1){d=d.getTargetElementFromIndex(g+1);f={wordObj:d}}else if(n==u-1&&r>u-1)f={wordObj:h};return f},checkCursorTransit:function(b,c,d,f,g,h){var m=ShapeEditor.text.editor,n=false,o=false,q=false;if(b){o=n=true;m.property=undefined}else{if(c.num.para!==d.num.para||c.num.para!==f.num.para||d.num.para!==g.num.para){o=n=true;m.property=undefined}else if(c.num.portion!==d.num.portion||c.num.portion!==
f.num.portion||d.num.portion!==g.num.portion||m.property){o=true;m.property=undefined}if(h||!p.SpellCheck||!p.SpellCheck.processSpellCheck||!m._isEditable())q=false;else if(c.num.index===d.num.index)q=this._spellCheckSameIndex(d,g);else{b=f.num.index;c=m.select.getCurrentStartEnd(f);if(b===c.word.end&&c.spaceLength!==0&&b+1<ShapeEditor.text.composer.get.lastIndex())f=m.select.getTargetElementFromIndex(b+1);q={wordObj:f}}}if(q&&q.wordObj)if(q.wordObj.element.word.data("type")==="LINEBREAK")q=false;
this.triggerCursorTransit(n,o,q)},move:function(b,c,d,f,g,h,m,n,o,q){var r=ShapeEvent.text,u=ShapeEditor.text.editor,v=p.extend(true,{},r.from),C=p.extend(true,{},r.to),y=undefined;if(y=n&&v.num.index===b?p.extend(true,{},v):u.select.getTargetElementFromIndex(b,undefined,undefined,h)){this.preMove(r.from,r.to);r.from.num=y.num;r.from.element=y.element;r.from.pos=y.pos;if(b===c){m=p.extend(true,{},r.to);r.to=p.extend(true,{},r.from);if(g)r.to.cursorPosLeft=m.cursorPosLeft}else{h=undefined;h=n&&C.num.index===
c?p.extend(true,{},C):u.select.getTargetElementFromIndex(c,undefined,undefined,m);if(!h)return;r.to.num=h.num;r.to.element=h.element;r.to.pos=h.pos}v.num.index!==C.num.index&&b===c&&u.clearCopiedContent();this.checkCursorTransit(o,r.from,r.to,v,C,q);u.select.select(undefined,undefined,d,f,v,g)}},preMove:function(b,c){var d=ShapeEditor.text.editor;!d.isSelected()&&typeof b.num.para!=="undefined"&&d.bullet.changeStatus(b,c,true)},triggerCursorTransit:function(b,c,d,f){if(b||c)ShapeEditor.config.container.trigger("cursor_transit",
[{type:"acrossPortions"}]);b&&ShapeEditor.config.container.trigger("cursor_transit",[{type:"acrossParas"}]);d&&ShapeEditor.config.container.trigger("cursor_transit",[{type:"spellCheckWord",wordObj:d.wordObj}]);f&&TableEditor.navigation.navigate(f)},onewordRight:function(b){return b},onewordleft:function(b){return this.startOf.word(b)},getEndOfLine:function(b){return this.endOf.line(b)},getStartOfLine:function(b){return this.startOf.line(b)},wordStart:function(b){return this.startOf.word(b)},wordEnd:function(b){return this.endOf.word(b)},
getNextChar:function(b,c){return this.next.character(b,c)},getPrevChar:function(b){return this.prev.character(b)},getPrevSpan:function(b){return this.prev.span(b)},getNextSpan:function(b){return this.next.span(b)},startOf:{text:function(){ShapeEditor.text.editor.navigation.move(0,0)}},endOf:{text:function(){var b=ShapeEditor.text.composer.get.lastIndex();ShapeEditor.text.editor.navigation.move(b-1,b-1)}},_swapParaValues:function(b,c){var d=ShapeEvent.text,f=d.from.num.para;d=d.to.num.para;if(c)d+=
b;else d=f=b<0?Math.min(f,d)+b:Math.max(f,d)+b;this.selectPara(f,d)},selectPara:function(b,c){var d=ShapeEditor.select.getShapesOfZero().data;if(d.textBody.paras[b]&&d.textBody.paras[c]){d=Math.min(b,c);var f=Math.max(b,c),g=b>c?true:false,h=ShapeEvent.text.textContainer.data(Shape.textBody.indexId),m=0,n=0;i=0;for(l=d;i<l;i++)m+=h[i];n=m;j=d;for(k=f;j<=k;j++)n+=h[j];n-=1;if(g){m+=n;n=m-n;m-=n}ShapeEditor.text.editor.navigation.move(m,n);return true}}},isSelected:function(){var b=ShapeEvent.text;
return!this.isSameChar(b.from,b.to)},isSameChar:function(b,c){return b.num.index===c.num.index},selection:{clear:function(){var b=ShapeEvent.text.textContainer;ShapeEditor.select.shapes.length&&b&&b.length&&b.children(".selectedArea").remove();ShapeEditor.text.editor.cursor.remove()}},bullet:{changeStatus:function(b,c,d){var f=ShapeEditor.select.getShapesOfZero(),g=f.data;if(b.num.index===c.num.index&&b.num.ch===-1){b=b.num.para;if(c=ShapeEditor.text.composer.position[b]){isEmpty=c[0]===c[c.length-
1];if((c=g.textBody.paras[b].style.listStyle)&&c.bullet&&c.bullet.type!==p.ShapeConstants.BulletType.NONE){c.bullet.status=isEmpty?d?"disabled":"semi-enabled":"enabled";ShapeEditor.text.editor.bullet.setStatus(g,f.box,b)}}}},setStatus:function(b,c,d){b.textBody.id=Shape.textBody.textContainer;b.textBody.paras.num=d;b.textBody.paras.element=Shape.textBody.paras.getPara(c,d,b);Shape.textBody.paras.style.listStyle.bullet.status.set(b,ShapeEvent.text.shapeContainer,c)},check:function(b){b=b?b:ShapeEvent.text;
b=b.from.num;var c=ShapeEditor.select.getShapesOfZero();if(c){var d=c.data,f=b.para?d.textBody.paras[b.para]:undefined;if(f){f=f.portions;if(f.length==1&&!(f[0].t||f[0].type&&f[0].type.toLowerCase()=="linebreak")&&!ShapeEditor.text.editor.isSelected())if(d.textBody.paras[b.para].style.listStyle&&d.textBody.paras[b.para].style.listStyle.bullet.type!=p.ShapeConstants.BulletType.NONE){d.textBody.paras[b.para].style.listStyle.bullet.status="disabled";ShapeEditor.text.editor.bullet.setStatus(d,c.box,b.para)}}}}},
_isEditable:function(b){var c=true;b=ShapeEditor.select.getShapesOfZero().data;if(b.masterPlaceholder)c=false;return c},addText:function(b){if(b){var c=ShapeEditor.text,d=ShapeEvent.text,f=ShapeEditor.select.getShapesOfZero().data;if(c.editor._isEditable()){var g=d.from.num,h=d.to.num;d=Math.min(g.index,h.index);var m=Math.max(g.index,h.index);h=[];g=[];var n;if(d!==m){n=this.checkIfFirstPortionAndGetProps(d,f);(m=this.remove(d,m))&&h.push(m)}h.push(c.editor.modulateData.compose(c.composer.insert,
d+1,d+1,{value:b}));if(c.editor.property){ShapeEditor.config.container.trigger("property_before_change");h.push(c.editor.modulateData.compose(c.composer.update,d+1,d+1,{value:p.extend(true,{},c.editor.property)}));ShapeEditor.config.container.trigger("property_changed");c.editor.property=undefined}if(c.editor.langproperty){h.push(c.editor.modulateData.compose(c.composer.update,d+1,d+1,{value:p.extend(true,{},c.editor.langproperty)}));c.editor.langproperty=undefined}b=d+b.length;if(n&&!p.isEmptyObject(n))(n=
c.editor.modulateData.compose(c.composer.update,d+1,b,{value:n}))&&h.push(n);if(p.SpellCheck){d=c.editor.spellCheck.getWords(d,b);n=[];n=p.SpellCheck.checkSpelling(d);p.merge(h,n)}d=c.editor.modulateData.getTextObject(h);(f=c.editor.modulateData.getShapeObject(d,f,"Editor"))&&g.push(f);c.editor.modulateData.triggerEvent(g);c.editor.navigation.move(b,b,true,undefined,undefined,undefined,undefined,undefined,undefined,true)}}},checkIfFirstPortionAndGetProps:function(b,c,d){b=ShapeEditor.text.composer.get.object(b+
1,d);if(b.ch===0)return this.getPortionProps(b,c)},getPortionProps:function(b,c){var d=p.extend(true,{},c.textBody.paras[b.para].portions[b.portion]);(d=d.unmerged?d.unmerged.props:d.props)&&d.chk&&delete d.chk.state;return d},replaceText:function(b,c,d,f){var g=ShapeEditor.text,h=[],m=ShapeEditor.text.composer.getPosition(f.textBody.paras);f=ShapeEditor.text.editor.checkIfFirstPortionAndGetProps(b,f,m);(t=g.editor.modulateData.getComposeObj(g.composer.del,b+1,c))&&h.push(t);if(d&&d.length){(t=g.editor.modulateData.getComposeObj(g.composer.insert,
b+1,b+1,{value:d}))&&h.push(t);c=b+d.length;if(f&&!p.isEmptyObject(f))(t=g.editor.modulateData.getComposeObj(g.composer.update,b+1,c,{value:f}))&&h.push(t)}return h},spellCheck:{getWordList:function(b,c,d){var f=ShapeEditor.text.editor,g=f.selectedText({from:b,to:c},"range");g=Shape.textBody.paras.portions.t.getWordList(false,g,0);var h=[];if(g[g.length-1].space.length===0&&g[g.length-1].lang===Shape.textBody.lang.EAST_ASIAN){var m=f.select.getTargetElementFromIndex(c);m=f.select.getNextWord(m);if(m!==
c){c=f.selectedText({from:c,to:m},"range");c=Shape.textBody.paras.portions.t.getWordList(false,c,0);c[c.length-1].lang!==Shape.textBody.lang.EAST_ASIAN&&p.merge(g,c)}}var n=g.length;p.each(g,function(o,q){var r=b+(q.text?q.text.length:0);if(q.type!=="SPACE"&&q.lang!==Shape.textBody.lang.EAST_ASIAN)if(q.space.length||q.space.length===0&&o<n-1)h.push({text:q.text,si:b,ei:r,curIndex:d});else{b!==r&&h.push({text:q.text,si:b,ei:r,curIndex:d,typed:true});if(b===r&&b===0){h.push({si:b,ei:r,cleared:true});
Shape.error("Word Without Space and Text Content......",b)}}b=r+q.space.length});return h},getWords:function(b,c){var d=[],f=this.getWordsRange(b);wordStartIndex=f.index>f.endIndexWithoutSpace?f.index:f.wordStartIndex;d=c>f.endIndexWithoutSpace?c:f.endIndexWithoutSpace;if(f.wordEndIndex<c){d=this.getWordsRange(c);d=c>d.endIndexWithoutSpace?c:d.endIndexWithoutSpace}if(c===d)if(f=this.getLastWord(c))d=f.endIndexWithoutSpace;return d=this.getWordList(wordStartIndex,d,c)},getWordsForTextRemoved:function(b){var c=
[],d=this.getWordsRange(b);if(b>=d.wordStartIndex&&b<=d.endIndexWithoutSpace)c=this.getWordList(d.wordStartIndex,d.endIndexWithoutSpace,b);else if(d=this.getLastWord(b))c=this.getWordList(d.wordStartIndex,d.endIndexWithoutSpace,b);return c},getWordsRange:function(b){b=ShapeEditor.text.editor.select.getTargetElementFromIndex(b);var c=ShapeEditor.text.editor.select.getCurrentStartEnd(b);return{wordStartIndex:c.word.start,wordEndIndex:c.word.end,endIndexWithoutSpace:c.word.end-c.spaceLength,index:b.num.index}},
getLastWord:function(b){var c=ShapeEditor.text.composer.get.lastIndex();if(b+1<c)return this.getWordsRange(b+1)}},backspace:function(){var b=ShapeEditor.text.editor,c=b._getFromTo(),d=c.from,f=d.num.index,g=c.to.num.index;c=ShapeEditor.select.getShapesOfZero().data;if(b._isEditable()){if(f==g&&d.num.ch==-1&&d.num.portion==0&&c.textBody.paras[d.num.para].style.listStyle&&c.textBody.paras[d.num.para].style.listStyle.bullet.type!=p.ShapeConstants.BulletType.NONE){c.textBody.paras[d.num.para].style.listStyle.bullet.type=
p.ShapeConstants.BulletType.NONE;container=ShapeEvent.text.shapeContainer;c.textBody.paras.num=d.num.para;p.TextModifier.update({listStyle:{bullet:{type:p.ShapeConstants.BulletType.NONE}}},"para","liststyle");b.navigation.move(f,f)}else{if(f===g){d=d.element;var h=d.subword&&d.subword.data().text?d.subword.data().text:d.word.data().text?d.word.data().text:"";h={targetText:h,offsetIndex:d.charCount,substr:h};d=b.select._checkDiacritic.prev(h);f=f+d.indexChange-1}if(f===g?f>0:f>=0){d=[];h=this.remove(f,
g,"backspace");f=f===g?f-1:f;if(h){h=[h];if(p.SpellCheck){g=b.spellCheck.getWordsForTextRemoved(f);var m=[];m=p.SpellCheck.checkSpelling(g);p.merge(h,m)}g=b.modulateData.getTextObject(h);(c=b.modulateData.getShapeObject(g,c,"Editor"))&&d.push(c);b.modulateData.triggerEvent(d)}b.navigation.move(f,f,undefined,undefined,undefined,undefined,undefined,undefined,undefined,true)}}ShapeEditor.config.container.trigger("spell_after")}},del:function(){var b=ShapeEditor.text.editor,c=ShapeEditor.select.getShapesOfZero().data;
if(b._isEditable()){var d=b._getFromTo(),f=[],g=d.to;d=d.from.num.index;var h=g.num.index,m=ShapeEditor.text.composer.get.lastIndex();if(d+1<m||d===m-1&&h!==d&&d!==0){if(d===h)h=b.select.getTargetElementFromIndex(h+1).num.index;if(g=this.remove(d,h,"delete")){d=h===m?d-1:d;d=d<0?0:d;g=[g];if(p.SpellCheck){h=b.spellCheck.getWordsForTextRemoved(d);m=[];m=p.SpellCheck.checkSpelling(h);p.merge(g,m)}g=b.modulateData.getTextObject(g);(c=b.modulateData.getShapeObject(g,c,"Editor"))&&f.push(c);b.modulateData.triggerEvent(f)}b.navigation.move(d,
d,undefined,undefined,undefined,undefined,undefined,undefined,undefined,true)}else d===m-1&&h===d&&g.num.lastIndex&&b.navigation.move(d,d);ShapeEditor.config.container.trigger("spell_after")}},remove:function(b,c,d){var f=ShapeEditor.text.composer,g;if(b==c){b=d=="backspace"?b:b+1;g=ShapeEditor.text.editor.modulateData.compose(f.del,b,b)}else{ShapeEditor.text.editor.selection.clear();if(b+1!=ShapeEditor.text.composer.get.lastIndex())g=ShapeEditor.text.editor.modulateData.compose(f.del,b+1,c)}return g},
enter:function(b){var c=ShapeEditor.text.editor,d=ShapeEditor.select.getShapesOfZero().data;if(c._isEditable()){var f=c._getFromTo(),g=ShapeEditor.text.composer,h=f.from.num.index,m=f.to.num.index,n=[],o=ShapeEditor.text.composer.get.lastIndex(),q=false;if(h==o-1&&m===o-1&&f.to.num.lastIndex)q=true;f=false;if(h!=m)if(m=this.remove(h,m)){n.push(m);f=true}if(!q){h++;n.push(c.modulateData.compose(g.insert,h,h,{value:b.shiftKey?"\u2028":"\n"}));if(p.SpellCheck){b=c.spellCheck.getWords(h-1,h);g=[];g=p.SpellCheck.checkSpelling(b);
p.merge(n,g)}n=c.modulateData.getTextObject(n);d=c.modulateData.getShapeObject(n,d,"Editor");if(f){d.appData.handleOp={};d.appData.handleOp.type="break"}n=[];d&&n.push(d);c.modulateData.triggerEvent(n)}c.navigation.move(h,h,undefined,undefined,undefined,undefined,undefined,undefined,undefined,true);ShapeEditor.config.container.trigger("spell_after")}},tab:function(b){var c=ShapeEvent.text;ShapeEditor.select.getShapesOfZero();ShapeEditor.text.editor._isEditable()&&c.from.ch!=-1&&b.preventDefault()},
changeStyle:function(b){var c=ShapeEditor.text.editor,d=c.modulateData,f=ShapeEditor.text.composer;p.each(b,function(h,m){f.compose(m,ShapeEditor.select.getShapesOfZero(),true)});b=d.getTextObject(b);b=d.getShapeObject(b,ShapeEditor.select.getShapesOfZero().data,"Editor");var g=[];b&&g.push(b);ShapeEditor.config.container.trigger("property_before_change");d.triggerEvent(g);d=ShapeEvent.text;c.navigation.move(d.from.num.index,d.to.num.index,undefined,undefined,undefined,undefined,undefined,undefined,
true);ShapeEditor.config.container.trigger("property_changed")},_getNextCharData:function(b){var c=ShapeEditor.text.editor,d=b.num.index,f;if(b.num.ch!==-1){d=c.select.getTargetElementFromIndex(d-1);b=p.extend(true,{},b)}else{f=d+1;d=p.extend(true,{},b);b=c.select.getTargetElementFromIndex(f)}return{from:d,to:b}},changeProperty:function(b){var c=ShapeEditor.text.editor,d=ShapeEditor.text.composer,f=this._getFromTo(),g=f.from;f=f.to;var h=g.num.index,m=f.num.index;if(h==m){var n=this._getNextCharData(g);
h=true;if(n.from&&n.to&&!(g.num.ch===-1&&f.num.ch===-1)){h=false;m=c.selectedText({from:n.from,to:n.to},"object");if(m!=" "&&m.length){var o=n.to;n=c.select.getTargetElementFromIndex(n.to.num.index+1);if(!n||n&&g.num.para!==n.num.para)h=true;else m=c.selectedText({from:o,to:n},"object")}if(m===" "||m.length===0)h=true}if(h){c.property=b.value;ShapeEditor.config.container.trigger("Property_Applied_In_Space",{props:b.value});return}else{m=c.select.getCurrentStartEnd(g,undefined,true);h=m.word.start;
m=m.word.end}}o=h+1;n=m;h=g.num.index;m=f.num.index;if(n==o){g=g.num.para;f=d.position[g];if(f[f.length-1]==n){g=ShapeEditor.select.getShapesOfZero().data.textBody.paras[g].portions;if(!(g.length==1&&!g[0].t))return}}else{g=f.num;if(g.ch===-1&&g.lastIndex){n++;m++}}ShapeEditor.config.container.trigger("property_before_change");c.modulateData.editorCompose(d.update,o,n,b);c.navigation.move(h,m,undefined,undefined,undefined,undefined,undefined,undefined,true);ShapeEditor.config.container.trigger("property_changed")},
modulateData:{editorCompose:function(b,c,d,f,g){var h=[];g=g?g:"Editor";h.push(ShapeEditor.text.editor.modulateData.compose(b,c,d,f));if(!f.doNotTrigger){b=ShapeEditor.text.editor.modulateData.getTextObject(h);g=ShapeEditor.text.editor.modulateData.getShapeObject(b,ShapeEditor.select.getShapesOfZero().data,g);b=[];g&&b.push(g);ShapeEditor.text.editor.modulateData.triggerEvent(b)}return h},compose:function(b,c,d,f){b=ShapeEditor.text.editor.modulateData.getComposeObj(b,c,d,f);ShapeEditor.text.composer.compose(b,
ShapeEditor.select.getShapesOfZero(),true);return b},getComposeObj:function(b,c,d,f){var g={at:b,si:c,ei:d};if(f){g.value=f.value?{value:f.value}:undefined;g.ut=f.ut?f.ut:undefined;g.unmerged=f.unmerged?f.unmerged:undefined}f=ShapeEditor.text.composer;b==f.del&&c==d&&p.each(f.position,function(h,m){if(c==m[m.length-1]){g.value={value:"\n"};return false}});return g},getTextObject:function(b){var c=[],d=this;p.each(b,function(f,g){var h=p.extend(true,{},g);h.at=h.at.toUpperCase();if(h.unmerged){h.value=
{value:p.extend(true,{},h.unmerged.value)};if(h.unmerged.deleteData)h.value.deleteData=h.unmerged.deleteData;delete h.unmerged}if(h.value){h.value.value&&h.value.value.click&&h.value.value.click.props&&delete h.value.value.click.props;h.value.value&&h.value.value.font&&h.value.value.loader&&delete h.value.value.font.loader;d.stringifyContent(h.value,"value");d.stringifyContent(h.value,"deleteData")}h.ut=h.ut?h.ut.toUpperCase():undefined;c.push(h)});return c},stringifyContent:function(b,c){if(b&&b[c]){if(typeof b[c]===
"object")b[c]=JSON.stringify(b[c]);b[c]=b[c]}},getShapeObject:function(b,c,d,f){if(c.isTable){f=c.nvOProps.nvDProps.id;c=ShapeEditor.select.shapes[0].data}if(!c.doNotSaveText){b={shapeData:{id:c.nvOProps.nvDProps.id,texts:b},appData:{action:d}};if(f)b.shapeData.cellId=f;return b}},triggerEvent:function(b){b.length&&ShapeEditor.config.container.trigger("text_modified",{textData:b})}},getCursorIndex:function(){var b=ShapeEditor.text.composer,c=ShapeEvent.text,d=c.to;c=b.get.index(c.from.num);b=b.get.index(d.num);
return{si:c,ei:b,at:"update"}},selectedText:function(b,c){var d;if(c==="range"){d={};var f=ShapeEditor.text.composer.get;d.from={num:f.object(b.from)};d.to={num:f.object(b.to)}}else if(c==="object")d=b;else if(!b){if(!ShapeEditor.text.editor.isSelected())return;d=this._getFromTo()}f=d.from;d=d.to;for(var g=ShapeEditor.select.getShapesOfZero().data,h=f.num.para,m=f.num.portion,n="";h<=d.num.para;h++){m=h==f.num.para?m:0;for(var o=h==d.num.para?d.num.portion:g.textBody.paras[h].portions.length-1;m<=
o;m++){var q=h==f.num.para&&m==f.num.portion,r=h==d.num.para&&m==d.num.portion,u=g.textBody.paras[h].portions[m],v=u.t;if(!v){v="";if(u.type==p.ShapeConstants.PortionType.LINEBREAK)v=" "}if(q&&r)return v.substring(f.num.ch+1,d.num.ch+1);else if(q)v=v.substring(f.num.ch+1);else if(r)v=v.substring(0,d.num.ch+1);n+=v}if(h!=d.num.para)n+=" "}return n},edit:function(b,c,d){var f=b.box,g=b.data,h=ShapeEditor.text.editor,m=ShapeEditor.text.composer;if(h._isEditable()){var n=ShapeEditor.config.get.shapeContainer();
if(g.textBody)g.textBody&&g.textBody.paras.length==1&&g.textBody.paras[0].portions.length==1&&!g.textBody.paras[0].portions[0].t&&!b.data.textBody.paras[0].portions[0].type&&g.nvOProps.nvProps&&g.nvOProps.nvProps.placeHolder&&h.setText(g,n,{paraNum:0,portionNum:0},f);else{b=[];b.push({});var o=[];o.push({portions:b});textBody={paras:o};g.textBody=textBody;Shape.textBody.set(g,n,f)}ShapeEditor.text.composer.init(g);h.select.init(f);h.addBackGroundDiv(g,f.parent(),f);h.bullet.check();var q,r;if(c){q=
c.fromIndex;r=c.toIndex}else if(d){q=0;r=m.get.lastIndex()}if(q===undefined||r===undefined)q=r=m.get.lastIndex()-1;h.navigation.move(q,r,undefined,undefined,undefined,undefined,undefined,undefined,undefined,true);h.focusEditor();Shape.create.placeHolder.icon.remove(g,n,f)}},mouse:{up:function(){var b=ShapeEditor.select.shapes;if(b.length==1){var c=b[0].data;c.nvOProps.nvODProps&&c.nvOProps.nvODProps.textbox&&!c.textBody.paras[0].portions[0].t&&c.textBody.paras.length===1&&c.textBody.paras[0].portions.length===
1&&!c.textBody.paras[0].portions[0].type&&ShapeEditor.text.editor.edit(b[0])}}},focusEditor:function(){ShapeEvent.IMESupport?ShapeEditor.text.editor.IMEHandler.focusEditor():ShapeEditor.focusShape()},editorOnBlur:function(){ShapeEditor.text.editor.cursor.cursorAppearence[0]="hidden"},editorOnFocus:function(){ShapeEditor.text.editor.cursor.cursorAppearence[0]=ShapeEvent.text.IME.editing?"hidden":"visible"},IMEHandler:{focusEditor:function(){var b=ShapeEvent.text.IME.contentEditable;Shape.touchDevice||
b.focus()},select:function(){VectorUtil.selectAllText(ShapeEvent.text.IME.contentEditable)},init:function(b){ShapeEvent.text.IME.contentEditable.text(b?b:"")},initIMEEditableSpan:function(b){var c=b.parent(),d=c.parent();b.removeAttr("style");c.removeAttr("style");d.removeAttr("style")},shape:{dummySpan:undefined,init:function(){var b=ShapeEditor.select.getShapesOfZero(),c=b.box,d=ShapeEditor.text.editor;b=p.extend(true,{},b.data);var f=d._getFromTo().from,g=f.num.para,h=f.num.portion,m=f.element;
f=m.subword?m.subword:m.word;m=m.charCount;var n=f.text(),o=n.substring(0,m+1),q=n.substring(m+1);n=f.data();if(!n.hasSubword){f.empty();f.append(o)}o=ShapeEvent.text.IME.contentEditable;o.removeAttr("style");var r=f.data("type"),u=f.clone();u.removeAttr("class").attr("id","tempcEspan").empty().text(Shape.textBody.zeroWidthSpaceText);var v={data:b,container:ShapeEditor.config.get.shapeContainer(),box:c};b.textBody.paras.num=g;Shape.textBody.paras.portions.props.setPropsForWord(o,b.textBody.paras[g].portions[h],
v,h);if(q.length||f.data("subword")||r==="SPACE"&&m===-1){f.append(u);f.append(q)}else{if(m>n.length-1){g=n.space;h=g.length;q=0;for(m=m-n.length+1;m<h;m++)q+=g[m].afterSpaceWidth;q*=-1;o.css({"text-indent":q,"padding-right":q*-1})}o.data();u.insertAfter(f)}d.IMEHandler.shape.dummySpan=u;u.css({width:o.width()});o.focus();this.dummySpan_init(b,c);d.IMEHandler.init()},dummySpan_init:function(b){b=b.props.transform;var c=ShapeEvent.text.IME.contentEditable,d=ShapeEditor.config.get.scale();c=c.parent();
var f=c.parent();VectorUtil.setScale(f,d);d={left:b.pos.left*d+ShapeEditor.config.container[0].offsetLeft,top:b.pos.top*d+ShapeEditor.config.container[0].offsetTop};c.css({width:b.dim.width,height:b.dim.height});f.css(d);VectorUtil.transform(c,"50% 50%"," rotate("+(b.rotate?b.rotate:0)+"deg) scale(1) translate(0px, 0px)");this.setPosition()},setPosition:function(){var b=ShapeEvent.text.IME.contentEditable,c=ShapeEditor.select.getShapesOfZero(),d=c.box;p.extend(true,{},c.data);c=ShapeEditor.text.editor.get.offset(this.dummySpan,
undefined,undefined,d);b.css(c)},finalize:function(b){var c=ShapeEditor.text.editor,d=c.IMEHandler;if(ShapeEditor.select.shapes.length&&c._isEditable()){var f=ShapeEvent.text.IME.contentEditable;b=b?b:f.text();d.initIMEEditableSpan(f);if(d.shape.dummySpan){d.shape.dummySpan.remove();d.shape.dummySpan=undefined}f=c._getFromTo();f=f.from.element.subword?f.from.element.subword:f.from.element.word;if(b){var g=f.contents().filter(function(){return this.nodeType===3});g.length&&f.text(g[0].nodeValue);c.addText(b)}c.focusEditor()}d.init()}},
composition:{start:function(){var b=ShapeEvent.text.IME,c=ShapeEditor.text.editor,d=ShapeEditor.config.isSlideLocked(),f=[];if(ShapeEditor.select.shapes.length){var g=ShapeEditor.select.getShapesOfZero(),h=ShapeEvent.checkLockStatus(g,"Modify");if(g.data.type===p.ShapeConstants.ShapeNodeType.PICTURE||h||d||!c._isEditable())return;ShapeEditor.text.isEditable(g.data.nvOProps.nvDProps.id)||c.edit(g)}b.editing||c.IMEHandler.select();if(d=ShapeEditor.select.getShapesOfZero()){g=p.extend(true,{},d.data);
d=c._getFromTo();if(d.from.num.index!=d.to.num.index){h=[];h.push(c.remove(d.from.num.index,d.to.num.index));h=c.modulateData.getTextObject(h);(g=c.modulateData.getShapeObject(h,g,"Editor"))&&f.push(g);c.modulateData.triggerEvent(f);c.cursor.refresh(d.from,d.from);c.clearCopiedContent()}b.editing=true;ShapeEvent.text.IME.contentEditable.text().length&&c.IMEHandler.shape.finalize();c.IMEHandler.shape.init()}},end:function(b){var c=ShapeEvent.text.IME,d=ShapeEditor.text.editor;c.editing=false;setTimeout(function(){c.editing||
d.IMEHandler.shape.finalize(b)},20)}}}}}})(jQuery);(function(p){ShapeEditor.align={type:"slide",alignSlide:"slide",alignShapes:"shapes",alignLeft:"left",alignRight:"right",alignBottom:"bottom",alignTop:"top",alignCenter:"center",alignMiddle:"middle",alignHorizontal:"horizontal",alignVertical:"vertical",set:function(b){var c=ShapeEditor.select.getShapes(ShapeEditor.select.shapes,true),d=ShapeEditor.config.isSlideLocked(),f=[];p.each(c,function(o,q){var r=q.data;if(r.type!=p.ShapeConstants.ShapeNodeType.CONNECTOR)f.push(q);else(r=(r=r.nvOProps)?r.nvODProps:
undefined)&&(r.start&&r.start.id||r.end&&r.end.id)||f.push(q)});var g=this,h=g.alignProps(b,f),m=[];p.each(f,function(o,q){var r=q.data,u=r.nvOProps.nvODProps&&r.nvOProps.nvODProps.locks?r.nvOProps.nvODProps.locks:undefined;if(!(u&&(u.noMove||u.noModify))&&!d){u=r.props.transform.dim;var v=g.position(q,b);u=g[b].call(this,v,h[b],h.dimension,u);v=r.props.transform;p.extend(v.pos,u);g.setData(q.data,q.box);m[m.length]={id:r.nvOProps.nvDProps.id,data:{action:"modify",data:{props:{transform:v}}}}}});
var n=ShapeEditor.event.dependency(ShapeEditor.select.shapes,true);p.each(c,function(o,q){var r=q.data;if(r.type==p.ShapeConstants.ShapeNodeType.CONNECTOR){ShapeEditor.bbox.remove(r.nvOProps.nvDProps.id);ShapeEditor.bbox.create(r,q.box)}else ShapeEditor.bbox.move(r,q.box)});p.merge(m,n);m.length&&ShapeEditor.config.container.trigger("modified",{shapeData:m,appData:{action:"Editor"}});if(ShapeEditor.config.isSupported.text&&ShapeEditor.text.isEditable()){ShapeEditor.text.containerMoved();ShapeEditor.text.refresh(true)}},
setData:function(b,c){p.ShapeObject.props.transform.pos.set(b,ShapeEditor.config.get.shapeContainer(),c)},setType:function(b){this.type=b},alignProps:function(b,c){var d={};if(this.type==this.alignShapes)d=this.alignShapeProps(c,b);else{d[b]=0;var f=ShapeEditor.config.get.scale();if(b==this.alignCenter||b==this.alignRight)d.dimension=ShapeEditor.config.container.width()/f;else if(b==this.alignMiddle||b==this.alignBottom)d.dimension=ShapeEditor.config.container.height()/f}return d},positionId:function(b,
c,d){(b=c.props.transform.rotate)||(b=0);c={left:["swbox","sebox","nebox","nwbox"],right:["nebox","nwbox","swbox","sebox"],top:["nwbox","swbox","sebox","nebox"],bottom:["sebox","nebox","nwbox","swbox"],center:["swbox","sebox","nebox","nwbox"],middle:["nwbox","swbox","sebox","nebox"]};var f=c[d][0];b%=360;if(b>=0&&b<90)f=c[d][0];else if(b>=90&&b<180)f=c[d][1];else if(b>=180&&b<270)f=c[d][2];else if(b>=270&&b<360)f=c[d][3];return f},position:function(b,c,d){var f=b.data;b=this.positionId(b,f,c);bboxData=
ShapeEditor.bbox.getBBoxData(p.BBoxConstant.value[b],f);b=ShapeEditor.bbox.position(bboxData,f,b,"",1);if(!d){b.x-=f.props.transform.pos.left;b.y-=f.props.transform.pos.top}return c==this.alignLeft||c==this.alignRight||c==this.alignCenter?b.x:b.y},alignShapeProps:function(b,c){var d=[],f=this,g=null;p.each(b,function(n,o){var q=f.position(o,c,true);d.push(q)});d=zoho.array.sort(d);var h={align:null,dimension:null};if(c==f.alignLeft||c==f.alignCenter||c==f.alignTop||c==f.alignMiddle){h[c]=d[0];if(c==
f.alignCenter)g=f.alignRight;else if(c==f.alignMiddle)g=f.alignBottom;if(g){var m=f.alignShapeProps(b,g);h.dimension=m[g]-h[c]}}else if(c==f.alignRight||c==f.alignBottom)h[c]=d[d.length-1];return h},left:function(b,c){return{left:Math.round(c-b)}},right:function(b,c,d){return{left:Math.round(d-b+c)}},top:function(b,c){return{top:Math.round(c-b)}},bottom:function(b,c,d){return{top:Math.round(d-b+c)}},center:function(b,c,d,f){return{left:Math.round(c+d*0.5-f.width*0.5)}},middle:function(b,c,d,f){return{top:Math.round(c+
d*0.5-f.height*0.5)}},distribute:function(b){var c=ShapeEditor.select.getShapes(ShapeEditor.select.shapes,true),d=ShapeEditor.config.isSlideLocked(),f=0,g=0,h=c.length+1,m,n=this.sortedPosition(c,b),o=ShapeEditor.config.get.scale();if(b==this.alignHorizontal)m=ShapeEditor.config.container.width()/o;else if(b==this.alignVertical)m=ShapeEditor.config.container.height()/o;if(this.type==this.alignShapes){h=c.length-1;f=n[0].big;m=n[h].small-n[0].big;n.shift();n.pop()}p.each(n,function(){g+=this.big-this.small});
b=this[b].call(this,n,(m-g)/h,f);c=ShapeEditor.event.dependency(c);p.merge(b,c);b.length&&!d&&ShapeEditor.config.container.trigger("modified",{shapeData:b,appData:{action:"Editor"}});d=ShapeEditor.select.getShapes(ShapeEditor.select.shapes,true);p.each(d,function(q,r){var u=r.data;if(u.type==p.ShapeConstants.ShapeNodeType.CONNECTOR){ShapeEditor.bbox.remove(u.nvOProps.nvDProps.id);ShapeEditor.bbox.create(u,r.box)}else ShapeEditor.bbox.move(u,r.box)});if(ShapeEditor.config.isSupported.text&&ShapeEditor.text.isEditable()){ShapeEditor.text.containerMoved();
ShapeEditor.text.refresh(true)}},sortedPosition:function(b,c){var d=[],f=this,g=[];if(c==f.alignHorizontal)g=[f.alignLeft,f.alignRight];else if(c=f.alignVertical)g=[f.alignTop,f.alignBottom];p.each(b,function(h,m){idval=m.data.nvOProps.nvDProps.id;var n=[];p.each(g,function(o,q){n.push(f.position(m,q,true))});n=zoho.array.sort(n);d[h]={small:n[0],big:n[n.length-1],id:idval}});d.sort(zoho.array.compareXY);return d},horizontal:function(b,c,d){var f=this,g=[];p.each(b,function(){var h=ShapeEditor.select.check(this.id).shape;
d+=c;h.data.props.transform.pos.left=d;g[g.length]={id:this.id,data:{action:"modify",data:{props:{transform:h.data.props.transform}}}};d+=this.big-this.small;f.setData(h.data,h.box)});return g},vertical:function(b,c,d){var f=this,g=[];p.each(b,function(){var h=ShapeEditor.select.check(this.id).shape;d+=c;h.data.props.transform.pos.top=d;g[g.length]={id:this.id,data:{action:"modify",data:{props:{transform:h.data.props.transform}}}};d+=this.big-this.small;f.setData(h.data,h.box)});return g}}})(jQuery);(function(p){ShapeEditor.smartguide={smartGuideProximity:8,_isWithinRange:function(b,c,d){return b>=c-d&&b<=c+d},_setCondition:function(b,c,d,f,g,h){var m=b.current_value,n=b.shape_value,o=undefined,q=false,r=ShapeEditor.smartguide;o=r.smartGuideProximity;var u=b.modifiedAngle;if(d&&u%90!=0)o=0.75;if(r._isWithinRange(m,n,o))if(o=m-n)if(d){o*=b.modifiedDiff;q=r._getResize(o,f,u,g,h,c)}else q=o;return q},_getResize:function(b,c,d,f,g,h){var m=false,n=undefined;n=undefined;n=ShapeEditor.smartguide;if(f){b=
n._setAspect(b,c,d,g);if(b.dw){n=h.width+b.dw;if(n>=0){m=true;if(d%90==0){h.width=n;h.height=h.width/g}}}else if(b.dh){n=h.height+b.dh;if(n>=0){m=true;if(d%90==0){h.height=n;h.width=h.height*g}}}}else{b=n._setNoAspect(b,c,d);if(b.dw){n=h.width+b.dw;if(n>=0){m=true;if(d%90==0)h.width=n}}else if(b.dh){n=h.height+b.dh;if(n>=0){m=true;if(d%90==0)h.height=n}}}return m},_setAspect:function(b,c,d,f){var g=zoho.math.toRadians,h=undefined,m=undefined;if(d>=0&&d<=90)if(c=="ebox"&&d!=0)h=b/Math.cos(g(90-d))*
f;else if(c=="wbox")if(d==90)m=b;else{c=Math.atan(f);h=Math.sin(c)*b/Math.sin(g(d)+c)}else if((c=="sbox"||c=="sebox")&&d!=0)m=b/Math.cos(g(90-d));else if(c=="nwbox"&&d!=90)h=b/Math.cos(g(d));else{if(c=="swbox"){c=Math.atan(f);h=Math.sin(c)*b/Math.sin(g(d)+c)}}else if(d>90&&d<=180)if(c=="ebox"){c=Math.atan(f);h=Math.sin(c)*b/Math.sin(g(180-d)+c)}else if(c=="wbox"&&d!=180)m=b/Math.cos(g(d-90));else if(c=="nbox"||c=="nebox")h=b/Math.cos(g(180-d));else if(c=="sbox"){c=Math.atan(f);m=Math.cos(c)*b/Math.sin(c+
g(180-d))}else if(c=="swbox"&&d!=180)m=b/Math.cos(g(90-d));else{if(c=="sebox"){c=Math.atan(f);h=Math.sin(c)*b/Math.sin(c+g(180-d))}}else if(d>180&&d<=270)if((c=="ebox"||c=="sbox"||c=="sebox")&&d!=270)h=b/Math.cos(g(d-180));else if(c=="nbox"){c=Math.atan(f);m=Math.cos(c)*b/Math.sin(c+g(d-180))}else if(d==270&&(c=="nebox"||c=="nwbox"))m=b;else if(c=="nebox"){c=Math.atan(f);m=Math.cos(c)*b/Math.sin(c+g(d-180))}else{if(c=="nwbox")m=b/Math.cos(g(270-d))}else if(d>270&&d<360)if(c=="ebox"||c=="wbox"||c==
"swbox")h=b/Math.cos(g(360-d));else if(c=="nbox"||c=="sbox"||c=="nebox")m=b/Math.cos(g(d-270));else if(c=="nwbox"){c=Math.atan(f);h=Math.sin(c)*b/Math.sin(c+g(360-d))}return{dw:h,dh:m}},_setNoAspect:function(b,c,d){var f=zoho.math.toRadians,g=undefined,h=undefined;if(c=="ebox"||c=="wbox"){g=undefined;if(d>=0&&d<90&&c!="ebox")g=b/Math.cos(f(d));else if(d>90&&d<180&&c!="wbox")g=b/Math.cos(f(180-d));else if(d>=180&&d<270&&c!="wbox")g=-(b/Math.cos(f(d)));else if(d>270&&d<360&&c!="ebox")g=b/Math.cos(f(360-
d))}else if(c=="nbox"||c=="sbox"){h=undefined;if(d>0&&d<90&&c!="nbox")h=b/Math.cos(f(90-d));else if(d>=90&&d<180&&c!="nbox")h=b/Math.cos(f(90-d));else if(d>180&&d<270&&c!="sbox")h=b/Math.cos(f(270-d));else if(d>=270&&d<360&&c!="sbox")h=b/Math.cos(f(d-270))}else if(d>=0&&d<=90)if(c=="nwbox"&&d!=90||c=="swbox"&&d<=45)g=b/Math.cos(f(d));else{if(c=="sebox"&&d!=0||c=="swbox"&&d>45)h=b/Math.cos(f(90-d))}else if(d>90&&d<=180)if(c=="nebox"&&d!=90||c=="sebox"&&d>135)g=b/Math.cos(f(180-d));else{if(c=="swbox"&&
d!=180||c=="sebox"&&d<=135)h=b/Math.cos(f(90-d))}else if(d>180&&d<=270)if(c=="sebox"&&d!=270||c=="nebox"&&d<=225)g=b/Math.cos(f(d-180));else{if(c=="nwbox"&&d!=180||c=="nebox"&&d>225)h=b/Math.cos(f(270-d))}else if(d>270&&d<=360)if(c=="swbox"&&d!=270||c=="nwbox"&&d>315)g=b/Math.cos(f(360-d));else if(c=="nwbox"&&d<=315||c=="nebox"&&d!=360)h=b/Math.cos(f(d-270));return{dw:g,dh:h}},guideMapping:{nbox:{0:false,1:true,2:true,3:false,4:false,5:true,6:true,7:false},sbox:{0:false,1:true,2:true,3:false,4:false,
5:true,6:true,7:false},ebox:{0:true,1:false,2:false,3:true,4:true,5:false,6:false,7:true},wbox:{0:true,1:false,2:false,3:true,4:true,5:false,6:false,7:true},nwbox:{0:false,1:false,2:true,3:true,4:false,5:false,6:true,7:true},sebox:{0:false,1:false,2:true,3:true,4:false,5:false,6:true,7:true},nebox:{0:true,1:true,2:false,3:false,4:true,5:true,6:false,7:false},swbox:{0:true,1:true,2:false,3:false,4:true,5:true,6:false,7:false}},allowSmartGuide:{horizontal:{nbox:{quadrant1:{angle0:{0:false,1:true,2:true,
3:false,4:false}},quadrant2:{angle0:{0:false,1:false,2:false,3:false,4:false}},quadrant3:{angle0:{0:false,1:false,2:false,3:true,4:true}},quadrant4:{angle0:{0:false,1:false,2:false,3:false,4:false}}},ebox:{quadrant1:{angle0:{0:false,1:false,2:false,3:false,4:false}},quadrant2:{angle0:{0:false,1:false,2:false,3:true,4:true}},quadrant3:{angle0:{0:false,1:false,2:false,3:false,4:false}},quadrant4:{angle0:{0:false,1:true,2:true,3:false,4:false}}},sbox:{quadrant1:{angle0:{0:false,1:false,2:false,3:true,
4:true}},quadrant2:{angle0:{0:false,1:false,2:false,3:false,4:false}},quadrant3:{angle0:{0:false,1:true,2:true,3:false,4:false}},quadrant4:{angle0:{0:false,1:false,2:false,3:false,4:false}}},wbox:{quadrant1:{angle0:{0:false,1:false,2:false,3:false,4:false}},quadrant2:{angle0:{0:false,1:true,2:true,3:false,4:false}},quadrant3:{angle0:{0:false,1:false,2:false,3:false,4:false}},quadrant4:{angle0:{0:false,1:false,2:false,3:true,4:true}}}},vertical:{nbox:{quadrant1:{angle0:{0:false,1:false,2:false,3:false,
4:false}},quadrant2:{angle0:{0:false,1:false,2:false,3:true,4:true}},quadrant3:{angle0:{0:false,1:false,2:false,3:false,4:false}},quadrant4:{angle0:{0:false,1:true,2:true,3:false,4:false}}},ebox:{quadrant1:{angle0:{0:false,1:false,2:false,3:true,4:true}},quadrant2:{angle0:{0:false,1:false,2:false,3:false,4:false}},quadrant3:{angle0:{0:false,1:true,2:true,3:false,4:false}},quadrant4:{angle0:{0:false,1:false,2:false,3:false,4:false}}},sbox:{quadrant1:{angle0:{0:false,1:false,2:false,3:false,4:false}},
quadrant2:{angle0:{0:false,1:true,2:true,3:false,4:false}},quadrant3:{angle0:{0:false,1:false,2:false,3:false,4:false}},quadrant4:{angle0:{0:false,1:false,2:false,3:true,4:true}}},wbox:{quadrant1:{angle0:{0:false,1:true,2:true,3:false,4:false}},quadrant2:{angle0:{0:false,1:false,2:false,3:false,4:false}},quadrant3:{angle0:{0:false,1:false,2:false,3:true,4:true}},quadrant4:{angle0:{0:false,1:false,2:false,3:false,4:false}}}}},getAllowSmartGuide:function(b,c,d,f,g,h){var m=true;if(b&&c&&d%90==0&&(f==
"nbox"||f=="wbox"||f=="ebox"||f=="sbox")){b=ShapeEditor.resize.getQuadrant(d);m=ShapeEditor.smartguide.allowSmartGuide[h][f][b.quadrant][b.angleVal][g]}return m},getCornerPointsShapes:function(b){var c={},d=b.scaleFactor,f=ShapeEditor.config,g=f.container,h=f.get.getAllShapeData(),m=g.height()/d,n=g.width()/d;d={height:m,width:n};var o=ShapeEditor.resize,q=0;if(f.isSupported.grids_guides){var r=f.get.viewPropsData(),u=r.display;u.showGuides&&p.each(r.guides,function(C,y){if(y.orient=="HORIZONTAL")c[q++]=
{cp:o.getCornerPoints({left:0,top:y.pos},{width:0,height:0},0),center:false,showGuides:false,type:"guide"};else if(y.orient=="VERTICAL")c[q++]={cp:o.getCornerPoints({left:y.pos,top:0},{width:0,height:0},0),center:false,showGuides:false,type:"guide"}});if(u.showSmartGuides){c[q++]={cp:o.getCornerPoints({left:0,top:0},d,0),center:true,showGuides:true,type:"slide"};p.isEmptyObject(h)||p.each(h,function(C,y){var x=y.type.toLowerCase(),w=y[x].nvOProps.nvDProps.id;if(!y[x].nvOProps.nvDProps.hidden){y[x].props&&
y[x].props.transform||f.get.mergeTransformShape(y[x]);var D=y[x].props.transform;if(D&&!D.dim&&y.type===p.ShapeConstants.ShapeNodeType.GRAPHICFRAME&&y[x].obj.type===p.ShapeConstants.GraphicObjectType.TABLE)D.dim=ShapeEditor.resize.getDimOfTable(y[x]);p.isEmptyObject(D)||(c[w]={cp:o.getCornerPoints(D.pos,D.dim,D.rotate?D.rotate:0),center:true,showGuides:true,type:"object"})}})}if(u.showGrids){h=r.grids.space;n/=2;m/=2;r=n;u=m;for(var v=0;r>h;v++){r=n-v*h;c[q++]={cp:o.getCornerPoints({left:r,top:0},
{width:0,height:0},0),center:false,showGuides:true,type:"grid"};if(v!=0)c[q++]={cp:o.getCornerPoints({left:n+v*h,top:0},{width:0,height:0},0),center:false,showGuides:true,type:"grid"}}for(v=0;u>h;v++){u=m-v*h;c[q++]={cp:o.getCornerPoints({left:0,top:u},{width:0,height:0},0),center:false,showGuides:true,type:"grid"};if(v!=0)c[q++]={cp:o.getCornerPoints({left:0,top:m+v*h},{width:0,height:0},0),center:false,showGuides:true,type:"grid"}}}}if(!p(ShapeEditor.v_Div).length)ShapeEditor.v_Div=p("<div>").attr("id",
"vsmartguide").addClass("smartGuide smartGuideVertical");if(!p(ShapeEditor.h_Div).length)ShapeEditor.h_Div=p("<div>").attr("id","hsmartguide").addClass("smartGuide smartGuideHorizontal");g.append(ShapeEditor.v_Div);g.append(ShapeEditor.h_Div);b.slideTransform=d;b.cornerPoints=c},getCurrentValues:function(b,c){var d=Math.min(b.c1.x,b.c2.x,b.c3.x,b.c4.x),f=Math.max(b.c1.x,b.c2.x,b.c3.x,b.c4.x),g=Math.min(b.c1.y,b.c2.y,b.c3.y,b.c4.y),h=Math.max(b.c1.y,b.c2.y,b.c3.y,b.c4.y);return{H_val:{0:{current_value:(d+
f)*0.5,shape_value:undefined,modifiedDiff:1,modifiedAngle:c},1:{current_value:d,shape_value:undefined,modifiedDiff:1,modifiedAngle:c},2:{current_value:d,shape_value:undefined,modifiedDiff:1,modifiedAngle:c},3:{current_value:f,shape_value:undefined,modifiedDiff:-1,modifiedAngle:(c+180)%360},4:{current_value:f,shape_value:undefined,modifiedDiff:-1,modifiedAngle:(c+180)%360}},V_val:{0:{current_value:(g+h)*0.5,shape_value:undefined,modifiedDiff:1,modifiedAngle:c},1:{current_value:g,shape_value:undefined,
modifiedDiff:1,modifiedAngle:(c+270)%360},2:{current_value:g,shape_value:undefined,modifiedDiff:1,modifiedAngle:(c+270)%360},3:{current_value:h,shape_value:undefined,modifiedDiff:-1,modifiedAngle:(c+90)%360},4:{current_value:h,shape_value:undefined,modifiedDiff:-1,modifiedAngle:(c+90)%360}}}},set:function(b,c,d,f,g,h,m,n){var o=false;if(c)if(c.nvOProps.nvDProps.id!="groupselect"){var q=ShapeEditor.smartguide,r=ShapeEditor.resize;d.cornerPoints||q.getCornerPointsShapes(d);var u=d.cornerPoints,v=d.slideTransform,
C=d.scaleFactor;if(!p.isEmptyObject(u)){var y=false;d=c.props?c.props.transform:undefined;if(!d){ShapeEditor.config.get.mergeTransformShape(c);d=c.props.transform}var x=d.rotate?d.rotate:0,w=undefined,D=undefined;if(b.width&&b.height){w=r.getCornerPoints(b,{width:b.width,height:b.height},x);y=true;D=d.dim.width/d.dim.height}else w=r.getCornerPoints(b,d.dim,x);c=q.getCurrentValues(w,x);var z=c.H_val,A=c.V_val,E=z[1].current_value,H=z[3].current_value,F=A[1].current_value,G=A[3].current_value;c=parseInt(x/
45);var L=true;if(h)L=q.guideMapping[h][c];var B=false,I=false,M=v.width,P=v.height,U=0,Q=0,J=0,S=0,T=false,da=false,ea=false,fa=false;p.each(u,function(ga,O){var Z=O.cp.c1,$=O.cp.c2,aa=O.cp.c3,ba=O.cp.c4,V=Math.min(Z.x,$.x,aa.x,ba.x),W=Math.max(Z.x,$.x,aa.x,ba.x),X=Math.min(Z.y,$.y,aa.y,ba.y),Y=Math.max(Z.y,$.y,aa.y,ba.y),ca=O.center;z[0].shape_value=(V+W)*0.5;z[1].shape_value=V;z[2].shape_value=W;z[3].shape_value=V;z[4].shape_value=W;A[0].shape_value=(X+Y)*0.5;A[1].shape_value=X;A[2].shape_value=
Y;A[3].shape_value=X;A[4].shape_value=Y;if(L){I||p.each(z,function(N,R){if(!(N==0&&y)&&!(N==0&&!ca))if(q.getAllowSmartGuide(y,m,x,h,N,"vertical"))if(I=q._setCondition(R,b,y,h,m,D)){if(y){var K=p.extend(true,{},f);if(m)K=r.getTangentialAnchor(x,h,f,n.width-b.width,n.height-b.height);K=VectorUtil.positionShape(x,[b.width,b.height],K,undefined,g);b.left=K.left;b.top=K.top;w=r.getCornerPoints(b,{width:b.width,height:b.height},x);F=Math.min(w.c1.y,w.c2.y,w.c3.y,w.c4.y);G=Math.max(w.c1.y,w.c2.y,w.c3.y,
w.c4.y);A[0].current_value=(F+G)*0.5;A[1].current_value=F;A[2].current_value=F;A[3].current_value=G;A[4].current_value=G}else{b.left-=I;I=true}U=R.shape_value;if(O.type=="slide"&&N==0)ea=true;else if(O.type=="grid"){J=F;P=G}else{J=Math.min(F,X);P=Math.max(G,Y)}P-=J;T=O.showGuides;return false}});B||p.each(A,function(N,R){if(!(N==0&&y)&&!(N==0&&!ca))if(q.getAllowSmartGuide(y,m,x,h,N,"horizontal"))if(B=q._setCondition(R,b,y,h,m,D)){if(y){var K=p.extend(true,{},f);if(m)K=r.getTangentialAnchor(x,h,f,
n.width-b.width,n.height-b.height);K=VectorUtil.positionShape(x,[b.width,b.height],K,undefined,g);b.left=K.left;b.top=K.top;w=r.getCornerPoints(b,{width:b.width,height:b.height},x);E=Math.min(w.c1.x,w.c2.x,w.c3.x,w.c4.x);H=Math.max(w.c1.x,w.c2.x,w.c3.x,w.c4.x)}else{b.top-=B;B=true}S=R.shape_value;if(O.type=="slide"&&N==0)fa=true;else if(O.type=="grid"){Q=E;M=H}else{Q=Math.min(E,V);M=Math.max(H,W)}M-=Q;da=O.showGuides;return false}})}else{B||p.each(A,function(N,R){if(!(N==0&&y)&&!(N==0&&!ca))if(q.getAllowSmartGuide(y,
m,x,h,N,"horizontal"))if(B=q._setCondition(R,b,y,h,m,D)){if(y){var K=p.extend(true,{},f);if(m)K=r.getTangentialAnchor(x,h,f,n.width-b.width,n.height-b.height);K=VectorUtil.positionShape(x,[b.width,b.height],K,undefined,g);b.left=K.left;b.top=K.top;w=r.getCornerPoints(b,{width:b.width,height:b.height},x);E=Math.min(w.c1.x,w.c2.x,w.c3.x,w.c4.x);H=Math.max(w.c1.x,w.c2.x,w.c3.x,w.c4.x);z[0].current_value=(E+H)*0.5;z[1].current_value=E;z[2].current_value=E;z[3].current_value=H;z[4].current_value=H}else{b.top-=
B;B=true}S=R.shape_value;type_H=O.type;if(type_H=="grid"){Q=E;M=H}else{Q=Math.min(E,V);M=Math.max(H,W)}M-=Q;da=O.showGuides;return false}});I||p.each(z,function(N,R){if(!(N==0&&y)&&!(N==0&&!ca))if(q.getAllowSmartGuide(y,m,x,h,N,"vertical"))if(I=q._setCondition(R,b,y,h,m,D)){if(y){var K=p.extend(true,{},f);if(m)K=r.getTangentialAnchor(x,h,f,n.width-b.width,n.height-b.height);K=VectorUtil.positionShape(x,[b.width,b.height],K,undefined,g);b.left=K.left;b.top=K.top;w=r.getCornerPoints(b,{width:b.width,
height:b.height},x);F=Math.min(w.c1.y,w.c2.y,w.c3.y,w.c4.y);G=Math.max(w.c1.y,w.c2.y,w.c3.y,w.c4.y)}else{b.left-=I;I=true}U=R.shape_value;if(O.type=="slide"&&N==0)ea=true;else if(O.type=="grid"){J=F;P=G}else{J=Math.min(F,X);P=Math.max(G,Y)}P-=J;T=O.showGuides;return false}})}if(I&&T){ShapeEditor.v_Div.css({visibility:"visible",top:(J-10)*C,left:U*C,height:(P+20)*C});ea&&ShapeEditor.v_Div.addClass("smartGuideSlide")}else ShapeEditor.v_Div.css("visibility","hidden").removeClass("smartGuideSlide");if(B&&
da){ShapeEditor.h_Div.css({visibility:"visible",top:S*C,left:(Q-10)*C,width:(M+20)*C});fa&&ShapeEditor.h_Div.addClass("smartGuideSlide")}else ShapeEditor.h_Div.css("visibility","hidden").removeClass("smartGuideSlide")});o=B||I?true:false}}return o}}})(jQuery);
function defineWithValue(e){return{enumerable:!1,writable:!1,value:e}}function Hashtable(){var e={},t=[],n=[],i=0,o=function(o,r){if(!o)return!1;try{e[o]=r}catch(e){return!1}return i++,t.push(o),n.push(r),!0},r=function(t){if(!t)return null;try{return e[t]}catch(e){}return null},a=function(e){return void 0!==r(e)&&null!==r(e)},s=function(o){if(!o||!a(o))return!1;try{delete e[o]}catch(e){return!1}i--;var r=t.indexOf(o);return t.splice(r,1),n.splice(r,1),!0},l=function(){return i},d=function(){return t.splice(0)},c=function(){var t=[];return J.each(e,function(e,n){t.push(n)}),t};return{size:l,put:o,get:r,remove:s,keys:d,values:c}}function Conversions(){}function Utils(){}function Editor(){var e=J("#editorpane"),t=J("#editorpane-wrapper"),n=J("#contentpane"),i=J("div.zw-contentpane:first")[0],o=J("div.tdvc"),r=J("div.tdhc"),a={},s={TC_ON:0,TC_ON_BY_COLLAB:0,TC_All_Markup:0,TC_No_Markup:0,TC_Original:0,TC_Accept:0,TC_Reject:0,TC_Next:0,TC_Prev:0,TC_Review:0,ins_wm:0,pg_margin:0,pg_clr:0,pg_or:0,pg_ps:0},l={};is_wkhtmltopdf_browser||isOfflineRequest||ZFontsUtil.forEachWebFont(function(e){var t,n={family:e.getFontName(),variants:{}},i=e.getFontVariants();for(t in i)n.variants[(/^[0-9]*i$/.test(t)?"i":"n")+parseInt(t)/100]=e.getFontURL(t);l[n.family.toLowerCase()]=new ZWWebFont(n)});var d,c;return{defaultFonts:[],orgPolicyData:{},doc:new Doc,docClientInfo:{},documentContent:null,visiblePageNumbers:[],bookmarks:a,statistics:s,jTdVerticalControler:o,jTdHorizantalControler:r,jeditorPane:e,jeditorPaneWrapper:t,jContentPane:n,jMultiByteSpan:null,clientActiveSection:i,prevClientActiveSection:i,WCTimer:null,editorOffset:e.offset(),jMbSpan_editableSpan:null,contentpaneOffset:n.offset(),contentpaneRight:0,orgName:"",scheme:"http",uuid:"",zuid:"",timeZone:"",zoid:"",loginName:"",isMailMerge:"",lang:"",countryCode:"",currentCommand:COMMAND.ANY,currentKey:"",currentOp:"",w3schoolURL:"",view:"",editable:!0,type:"LOGIN",conversionURL:"",isOfflineMode:!1,serverurl:"",editorType:"WRITER",subAction:null,startCursorIdx:1,isLazyFileLoaded:!1,browserInfo:{},zoomFactor:1,customZoom:"",isHardReload:!1,widthVariant:0,options:{},init:function(e,t){if(Utils.startTime("LOADING_COMPONENT"),Utils.startTime("LOADING_DOCUMENT"),PubSub.publish("Document/InitEditor",editorProps),editor.documentContent=e.content,"REMOTE"==editor.getEditorType())for(var n in w_usersettings)w_usersettings[n]=editor.documentContent.defaults[n];if(editor.doc.getRole()!=USER_ROLE.PUBLIC){this.jMultiByteSpan=J(document.createElement("span"));var i={};i.id="zohoMultiByteSpan",i.contenteditable=!1,i.tabindex=1,this.jMultiByteSpan.attr(i),i={},i.contenteditable=!0,this.jMbSpan_editableSpan=J(document.createElement("span")),this.jMbSpan_editableSpan.attr(i),this.jMultiByteSpan.append(this.jMbSpan_editableSpan);var o=document.getElementById("editorpane");o.appendChild(this.jMultiByteSpan[0]);var r=document.createElement("div");r.setAttribute("id","_zohoPaste"),o.appendChild(r);var a=document.createElement("div");a.setAttribute("id","_zohoPDFContainer"),o.appendChild(a);var s=document.createElement("canvas");s.setAttribute("id","copyImage"),o.appendChild(s)}J.ajaxPrefilter(function(e,t,n){n.then(function(e,n,i){if("POST"===t.type){var o=i.getResponseHeader("BUILDVERSION");if("REMOTE"!=editor.getEditorType()&&o&&null!=o&&o!==buildLabel){var r=function(){var e=i.getResponseHeader("ZW-Reload");PubSub.publish("Server/BuildChange",{force:"true"==e})},a=i.getResponseHeader("role");if(a){var s=a.split(",");s.indexOf(editor.doc.getRole())>-1&&r()}else r();buildLabel=o}}})}),window.onbeforeunload=editor.onBeforeUnload,window.onunload=editor.onUnload,window.onresize=function(e){editor.onResize()},this.loadDocument(e,t)},getPageID:function(e){return e=e||editor.currentPageIndex||0,editor.jeditorPane.children(".zw-page").eq(e).data("id")},bindEditorErrors:function(){window.onerror=function(e,t,n,i,o){if(editor.lastError){var r=printStackTrace({e:editor.lastError});e=editor.lastError.message,Utils.log("Stack ::: "+r.join("\n"),r.join("\n"))}return e===ZWCollaboration.SHOW_CARET_ERROR||e===ZWCollaboration.SHOW_CARET_GETPORTION_ERROR||e===ZWCollaboration.SHOW_CARET_SELECTION_ERROR||e===ZWCollaboration.SHOW_CARET_PLACENODE_ERROR||e===ZWCollaboration.SET_CURSOR_ERROR||e===ZWCollaboration.SHOW_SELECTION_ERROR?(PubSub.publish("Document/Error",{title:"TITLE_CURSOR_ERROR",errorNo:e,errorMsg:"MSG_CURSOR_ERROR"}),editor.lastError=null,!0):e===ZWCollaboration.API_NEGATIVE_IDX||e===ZWCollaboration.API_IOB_IDX||e===ZWCollaboration.OP_APPLYTO_ERROR||e===ZWCollaboration.OP_PROCESSING_ERR||e===ZWCollaboration.OP_TC_ERROR||e===ZWCollaboration.DELETE_TC_BLOCK_ERROR||e===ZWCollaboration.TC_NOMARKUP_OPS_PROCESSING_ERROR||e==ZWCollaboration.OP_LK_ERROR||e===ZWCollaboration.OP_APPLYTO_ERROR_DOM||e===ZWCollaboration.OP_IDX_IOB||e===ZWCollaboration.DT_DOM_RENDERING_ERROR||e==ZWCollaboration.COLLAB_OP_APPLYTO_ERROR||e===ZWCollaboration.TABLE_INSERT_COLUMN||e===ZWCollaboration.TABLE_INSERT_ROW||e===ZWCollaboration.TABLE_DELETE_COLUMN||e===ZWCollaboration.TABLE_DELETE_ROW||e===ZWCollaboration.TABLE_DISTRIBUTE_COLUMNS||e===ZWCollaboration.TABLE_FIXED_COLUMN_WIDTH||e===ZWCollaboration.TABLE_FIT_TO_WINDOW?(PubSub.publish("Document/Error",{title:"OOPS",errorNo:e,errorMsg:"MSG_EDIT_ERROR"}),editor.lastError=null,!0):void 0}},setView:function(e){this.view=e},getView:function(){return this.view},setEditable:function(e){this.editable=e,PubSub.publish("Document/EditPermissionChanged",e)},isEditable:function(){return this.editable},setOrgPolicy:function(e){U.extend(editor.orgPolicyData,e)},getOrgPolicy:function(){return editor.orgPolicyData},setEditorProperty:function(e){for(var t in e.userInfo){var n=e.userInfo[t];"role"==t?("SHAREDREAD"!=n&&"STOREAGE_SERVICE_READER"!=n&&"REMOTEVIEW"!=n&&"REMOTECOLLABVIEW"!==n&&"WORKSPACE_CRMLIB_READER"!==n&&"PREVIEW"!==n||this.setEditable(!1),editor.doc.setRole(n)):"orgName"===t||"zuid"===t||"zoid"===t||"scheme"===t||"language"===t||"countryCode"===t||"uuid"===t?(editor[t]=n,"language"===t&&(editor.lang=n)):"fullName"===t?editor.loginName=n:"isZohoCorpUser"===t&&(window.isGrammarSupported=n)}for(var t in e.urls){var n=e.urls[t];"serverurl"===t||"base_url"===t||"w3schoolURL"===t||"docsUploadServerURL"===t||"conversionURL"===t||"iamServerURL"===t?editor[t]=n:"zohodocs"===t&&(editor.docsServerURL=n)}if(e.options)for(var t in e.options){var n=e.options[t];"REMOTE"===t?RemoteEditor.init(n):editor.options[t]=n}editor.orgPolicyData=e.orgInfo,editor.setBrowserInfo(e.browserInfo),editor.setEditorType(e.type),editor.setOffline(e.isOfflineMode),editor.cloudUploadServices=e.deployment.cloudupload_services,editor.makeACopyCustomOptions=e.deployment.makeacopy_options},setBrowserInfo:function(e){editor.browserInfo=e,editor.browserInfo.isPresto="Presto"==e.engine,editor.browserInfo.isTrident="Trident"==e.engine,editor.browserInfo.isWebkit="AppleWebKit"==e.engine,editor.browserInfo.isGecko="Gecko"==e.engine},setDocProperty:function(e){for(var t in e){var n=e[t];"collabUsersDetails"===t?n&&(n[editor.zuid].uuids||(n[editor.zuid].uuids=editor.uuid),editor.doc.setUserData(n)):"spellCheck"===t?(n.hasOwnProperty("SUPPORTEDLANGUAGES")&&Proofing.setSupportedLanguages(n.SUPPORTEDLANGUAGES),n.hasOwnProperty("BROWSER_LANGUAGE")&&Proofing.setBrowserLanguage(n.BROWSER_LANGUAGE)):"subAction"==t&&(0==DocUtil.getKeys(n).length?editor.subAction=null:editor.subAction=n)}},onResize:function(){PubSub.publish("Document/Resize"),editor.updateEditorOffset()},updateEditorOffset:function(){editor.editorOffset=editor.jeditorPane.offset();var e=J("div.zw-contentpane:visible").first();e[0]?editor.contentpaneOffset=e.offset():editor.contentpaneOffset=J("div.zw-contentpane").first().show().offset(),editor.editorPaneContainerOffset=editor.editorPaneContainer.offset(),editor.editorPaneContainerHt=editor.editorPaneContainer.height(),editor.contentpaneRight=editor.contentpaneOffset.left+editor.doc.getPaperWidth()+editor.doc.bodyFormat[ATTR_BODY.DS_MR].convertor().pixels},processFetchResponse:function(e){return"FAILED"==e.RESPONSE?void PubSub.publish("Document/LoadingFailed",e):void editor.loadDocument(e)},setOffline:function(e){this.isOfflineMode=e},isOffline:function(){return this.isOfflineMode},lock:function(){editor.doc.setDocInfo({DOCUMENT_LOCKED:!0}),PubSub.publish("Document/Locked")},unlock:function(){editor.doc.setDocInfo({DOCUMENT_LOCKED:!1}),PubSub.publish("Document/UnLocked")},onBeforeUnload:function(e){var t=editor.doc.getDocInfo(),n=editor.doc.getRole();if(t&&(1!=t.VERSION||0!=t.REVISION||!t.newDoc||"REMOTE"==editor.getEditorType()||editor.isOffline())&&!t.UpgradeToWriter3){if("REMOTE"==editor.getEditorType()){if("REMOTEPUBLICUSER"===n)return;if(RemoteEditor.documentModified&&!RemoteEditor.quitWithoutSaving)return J.i18n("writer.remotesave.DOCUMENT_UNSAVED")}else{if(ZWCollaboration.msgQueue&&ZWCollaboration.msgQueue.isAckPending()&&(!ZWOffline.isOfflineSetupDone||"TEMPLATE_USER"===n))return J.i18n("writer.remotesave.DOCUMENT_UNSAVED");if("undefined"!=typeof CommentManager&&CommentManager.isUnposted())return J.i18n("writer.common.UNPOST_COMMENTS")}editor.onZWUnload()}},onUnload:function(){},onZWUnload:function(){var e=editor.doc.getDocInfo(),t={};try{if(ZWOffline.UnloadHandler(),editor.isOffline()&&"REMOTEPUBLICUSER"===editor.doc.getRole())return;Utils.generateReports();try{2==window.devicePixelRatio?Utils.addToStatistics("RetinaScreen"):Utils.addToStatistics("NonRetinaScreen")}catch(e){}t.statistics=JSON.stringify(editor.statistics),editor.doc.docInfo.MAILMERGE_DOCUMENT&&(t.MAILMERGE_DOCUMENT=!0)}catch(e){}this.sendStats(),t.rid=editor.doc.getDocInfo().RID,t.unload="true",t.wmssessionid=ZWCollaboration.getWMSSessionId();var n=ZWCollaboration.getWMSRawSessionId();n&&(t.rawsid=n),t.chid=e.COLLAB_ID,t.uname=editor.zuid,t.lang=Proofing.getLanguage();var i=Utils.getUrl("unload");t.tstamp=(new Date).getTime(),t.sid=editor.uuid,t.contentEdited=ZWCollaboration.contentEdited,t.startingVersion=ZWCollaboration.startingVersion,"REMOTE"==editor.getEditorType()&&(t.rsid=RemoteEditor.rsid),Utils.setCsrfParam(t),J.ajax({type:"POST",global:!1,async:!1,url:i,data:t,error:function(){},success:function(e){ZWCollaboration.contentEdited=void 0,ZWCollaboration.startingVersion=void 0}})},sendStats:function(){var e=editor.getEditorType();if("REMOTE"!=e&&"ANYONEWITHLINK"!=e){var t={},n=Utils.getNiceUrlPrefix("doc/stats/"+editor.doc.getDocInfo().RID),i=ViewManager.getPageCount();editor.docClientInfo.PAGE_COUNT=i;var o=FontUtils.getTestMetrics();for(var r in o)editor.docClientInfo[r]=o[r];DocTreeManager.doc&&DocTreeManager.doc.metaSections&&(editor.docClientInfo.ENDNOTE_LEN=DocTreeManager.getEndNoteCount(),editor.docClientInfo.FOOTNOTE_LEN=DocTreeManager.getFootNoteCount()),t.docinfo=JSON.stringify(editor.docClientInfo),Utils.setCsrfParam(t),J.ajax({type:"POST",global:!1,async:!1,url:n,data:t,error:function(){},success:function(e){}})}},loadDocument:function(e,t){!editor.isEditable()&&editor.jMultiByteSpan&&editor.jMultiByteSpan.css("top","-100000px"),EditorUtil.focusMultiByteSpan(),editor.doc.setDocInfo(e.info),editor.isHardReload=t,"undefined"!=typeof CommentManager&&CommentManager.reset(),"comments"in e.content&&(CommentModels.comment_sequence_number=e.content.comments.comment_sequence_number,editor.commentCont=e.content.comments.comments?e.content.comments.comments:null),editor.documentContent=e.content;var n=editor.doc.getDocInfo();(n.CHECKEDOUT&&n.CHECKEDOUTBY_ZUID!=editor.zuid||editor.subAction&&editor.subAction.version)&&editor.setEditable(!1),editor.doc.contStr="",editor.doc.formats=[],ZWCollaboration.clientInfo="",ZWCollaboration.mailInfo="",editor.doc.bodyFormat={},editor.doc.bodyFormat.listFormat={},editor.doc.paintFormat={},extImgCache={},editor.doc.rid=n.RID,this.removeDOMCursor(),editor.doc.createDomCursor(editor.uuid,editor.zuid),editor.doc.snapShotManager&&(editor.doc.snapShotManager.resetSnapShotManager(),editor.doc.snapShotManager.setSkipSnapShot(!1)),ZWCollaboration.stopUpdates=!1,ZWCollaboration.msgQueue&&(ZWCollaboration.msgQueue=new MsgQueue),ZWCollaboration.syncSent=!1,ZWCollaboration.timeOutVal=void 0,"HISTORY"==editor.getView()||n.UpgradeToWriter3||1!=n.ISTRASHED||RestoreTrash.initRestoreEditor(),n.UpgradeToWriter3&&editor.setEditable(!1),editor.renderDocument(),Utils.addScrRes()},removeDOMCursor:function(){for(var e in editor.doc.domCursor)DomUtil.removeCursorNode(e,"start"),DomUtil.removeCursorNode(e,"end")},renderDocument:function(){var e=editor.documentContent,t=editor.doc.getDocInfo();Utils.log("FetchContent-ver:"+e.ver+",rev:"+e.rev+"curr.ver:"+t.VERSION+",curr.rev:"+t.REVISION),Utils.log("LOAD DOCUMENT CONTENT STARTED "),ZWCollaboration.MUTATION_SEND_VERSION=t.VERSION=e.ver,ZWCollaboration.MUTATION_SEND_REVISION=t.REVISION=e.rev,Utils.log("VERSION,REVISION UPDATED FROM FILESTORE CONTENT "),editor.doc.contStr=e.content,editor.doc.bucket.initBucketSize(editor.doc.getDocumentLength()),editor.doc.bucket.init(new Array(editor.doc.getDocumentLength())),editor.doc.formats=new Array(editor.doc.getDocumentLength());for(var n,i=editor.getThemeFonts(e.defaults)||[],o=!1,r=0,a=e.styles.length;r<a;r++)if(J.isEmptyObject(n=e.styles[r])){editor.doc.setFormatAt(r,null);var s=editor.doc.getCharAt(r);DOC_INVISIBLE_CHARS.indexOf(s)==-1||s==UNICODE.TABLEEND||s==UNICODE.TOCEND||o||Utils.sendErrorDetails("FORMAT_MISSING<ZWERROR>"+editor.doc.getDocInfo().VERSION+"."+editor.doc.getDocInfo().REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No = FORMAT_MISSING DOC len ="+editor.doc.getDocumentLength()+" buildLabel::: "+buildLabel+"\n IDX : CHAR : \n"+r+" : "+JSON.stringify(s)+" Error Log End \n<ZWERROR>"),o=!0}else{editor.doc.setFormatAt(r,n);for(var l,d=n[ATTR_TEXT.TS_FF],c=d&&Utils.stringToFonts(d)||[],u=0,p=c.length;u<p;u++)l=c[u],l&&!i.contains(l)&&i.push(l)}Utils.log("@renderDocument-->addFonts"),editor.addFonts(i||[],editor.onWebFontsLoadComplete)},onWebFontsLoadComplete:function(e){e&&e.length&&(UIUtils.showMessage("error",J.i18n("common","WEBFONT_FAILURE_INFO"),null,"normalfont",null,!0),Utils.sendErrorDetails("NO_ERROR_MAIL<ZWERROR>"+editor.doc.getDocInfo().VERSION+"."+editor.doc.getDocInfo().REVISION+"<ZWERROR>WEBFONTS_LOADING_FAILURE\nFailure Log Start \nFailed WebFonts: ["+e.toString()+"]\nCLIENT INFO: "+ZWCollaboration.clientInfo+"\nbuildLabel: "+buildLabel+"\nFailure Log End")),Conversions.init();var t=editor.documentContent,n=t.defaults;n[ATTR_BODY.DS_HT]||(n[ATTR_BODY.DS_HT]=Conversions.headerTopDefault),n[ATTR_BODY.DS_FB]||(n[ATTR_BODY.DS_FB]=Conversions.footerBottomDefault),editor.doc.setBodyFormat(n),n=editor.doc.getBodyFormat(),t.locks&&(editor.doc.locks=DocOpBuilder.build(t.locks)),DocUtil.setDocStyleObject();var i=Conversions.toGlobalUnit(n[ATTR_BODY.DS_PH]),o=Conversions.toGlobalUnit(n[ATTR_BODY.DS_PW]),r=PageLayout.getPaperSize(o,i,w_usersettings[ATTR_BODY.DS_UN]),a={};a[ATTR_BODY.DS_PS]=r,parseFloat(o)>parseFloat(i)&&(a[ATTR_BODY.DS_OR]="Landscape"),editor.doc.setBodyFormat(a),extend(w_usersettings,a);var s=editor.isHardReload;s&&afterWebFontsLoad(),Lock.init(),editor.setCursorStartIdx();editor.getView();if(Utils.isNonEditableView())PubSub.publish("Document/readonlyview");else{editor.doc.getBodyFormat();Proofing.init(),"cn"===editor.countryCode&&"zh"===editor.lang&&(editor.lang="zh-cn"),moment.locale(editor.lang),WordComplete.init()}EditorView.initView(),DocTreeManager.init(),d=new ZDoc(DocTreeManager.doc),c=new ZDocBuilder(d),editor.doc.initTrackChangeDetails(),editor.doc.getRole()===USER_ROLE.PUBLIC?editor.doc.getTrackChangeDetails().setDisplayMode(TCConstants.NO_MARKUP_VIEW):is_wkhtmltopdf_browser&&editor.options.TC_DISPLAYMODE&&editor.doc.getTrackChangeDetails().setDisplayMode(parseInt(editor.options.TC_DISPLAYMODE)),TcManager.init(),PubSub.publish("Document/BeforeLoading");try{EditorView.setView(n.view),DomUtil.applyDocumentStyle(n);var l=new DocOpBuilder;l.operation="load",DocTreeManager.updateDocOpBuilder(l),ViewManager.updatePageSettings(),DocTreeManager.refreshTree(),editor.visiblePageNumbers.push(1),l.postApplyTo(),editor.onResize(),s||(PubSub.publish("Document/EditorReady"),PubSub.publish("Document/ComponentReady"))}catch(e){Utils.log("Stack :: "+e.stack),s&&Utils.sendErrorDetails("LOADING FAILURE<ZWERROR>"+editor.doc.getDocInfo().VERSION+"."+editor.doc.getDocInfo().REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No =LOADING FAILURE DOC len ="+editor.doc.getDocumentLength()+" RID ::: "+editor.doc.getDocInfo().RID+" buildLabel::: "+buildLabel+"\n Error Log End \n"),editor.renderingError(e)}if(editor.currentPageIndex=0,editor.clientActiveSection=editor.prevClientActiveSection=editor.jeditorPane.children(".zw-page").eq(editor.currentPageIndex).children(".zw-contentpane:first")[0],s&&writerLazyJsUrl){editor.browserInfo.is_ie&&editor.editorPaneContainer[0].attachEvent?editor.editorPaneContainer[0].attachEvent("onscroll",editor.mouseEventHandler):editor.editorPaneContainer[0].addEventListener("scroll",editor.mouseEventHandler);var u={async:"async",defer:"defer",src:writerLazyJsUrl,callback:function(){editor.afterInit()}};loadJS(u)}},getEditorType:function(){return this.type},getThemeFonts:function(e){var t,n,i,o,e=e||editor.doc.getBodyFormat(),r=e.styles.para,a=[];for(t in r)if(n=r[t]||{},i=n.textFormat||{},o=i[ATTR_TEXT.TS_FF]){"zwmajor"===o||"#major"===o?o=e.theme.font.major.latin:"zwminor"!==o&&"#minor"!==o||(o=e.theme.font.minor.latin);for(var s,l=Utils.stringToFonts(o),d=0,c=l.length;d<c;d++)s=l[d],s&&!a.contains(s)&&a.push(s)}return a},setEditorType:function(e){this.type=e},setOptions:function(e){this.options=e},getOptions:function(){return this.options},getBaseURL:function(){return this.base_url},getServerURL:function(){return this.serverurl},renderingError:function(e){var t=editor.doc.getDocInfo();if("REMOTE"==editor.getEditorType()){if("undefined"!=typeof MailMerge&&MailMerge.isPreviewMode())PubSub.publish("Document/Warning",WARNING_MSG.UNABLE_TO_LOAD_CONTENT_IN_MAILMERGE_PREVIEW);else if(editor.doc.getRole()!=USER_ROLE.PUBLIC)return void(window.location.href="/writer/jsp/error.jsp")}else"undefined"!=typeof MailMerge&&MailMerge.isPreviewMode()?PubSub.publish("Document/Warning",WARNING_MSG.UNABLE_TO_LOAD_CONTENT_IN_MAILMERGE_PREVIEW):editor.getView()==EDITOR_VIEWS.HISTORY?PubSub.publish("Document/HistoryLoadError",e):"1"==t.VERSION&&"0"==t.REVISION?PubSub.publish("Document/Warning",WARNING_MSG.UNABLE_TO_LOAD_VERSION):RestoreDocumentProperVersion.lastRestoreVersion?PubSub.publish("Document/Restore",RestoreDocumentProperVersion.lastRestoreVersion):PubSub.publish("Document/Restore",void 0)},bindEvents:function(){if(editor.jeditorPane.on("mousedown mouseup mousemove",function(e){return editor.mouseEventHandler(e.originalEvent)}),editor.browserInfo.isWebkit&&(document.onmouseup=function(e){if(3!=e.which&&!EventHandler.isMenuOpened&&!EventHandler.isDialogOpened&&editor.isEditable()&&!EventHandler.mouseUpDone){var t=0,n=Utils.getCorrectedCoord(e),i=editor.doc.getSelection(),o=i.getLastRange();if(editor.imgDrag){Resize.handleImageMove(e);return!1}0!=J(e.target).parents("div.inner_shape").length?t=o.start:(t=EventHandler.mouseDown_coord.y>n.y?editor.doc.getSectionStart(o.start)+1:i.parents(NODE_TYPE.SECTION).getEnd(),t>o.start&&i.setLastModifiedPosition("end")),EventHandler.mouseUpDone=!0,o.setEnd(t),i.removeAllRanges().addRange(o),EditorUtil.focusMultiByteSpan()}}),editor.browserInfo.is_ie||(window.onblur=function(e){2==e.eventPhase&&CurUtil.stopBlinking()}),J(document.body).on("click",function(e){var t=editor.browserInfo.is_ie?e.srcElement:e.target;t&&J(t).parents("#editorpane,#toolbarContainer,div.ui-zcolorpalette-shaded-container,.ui-zcolorpalette-colors-container")[0]||CurUtil.stopBlinking()}),window.onfocus=function(e){if(!editor.browserInfo.is_ie){var t=e,n=editor.browserInfo.is_ie?t.srcElement:t.target;n&&n==window&&(setTimeout(function(){editor.onResize()},100),CurUtil.blinkCursor())}},"SHAREDREADCOMMENT"==editor.doc.getRole()||"ANYONELINK_SHAREDREADCOMMENT"==editor.doc.getRole())return void(editor.jeditorPane[0].oncopy=editor.onCopy);var e=editor.jeditorPane[0];e.onkeydown=e.onkeyup=e.onkeypress=editor.keyEventHandler,e.oncopy=e.oncut=editor.onCopy,e.ondragenter=e.ondragleave=e.ondragstart=e.ondrop=e.ondragover=editor.mouseEventHandler,e.onpaste=function(e){function t(e){if(r=e.getData("text/html"),o=e.getData("text/plain"),!r&&e.files.length){var t=e&&e.items&&e.items.length;if(t>0)for(var n,i=0;i<t;){if(n=e.items[i],n&&n.type.indexOf("image")!=-1){a=!0,PasteUtil.handleImagePaste(n.getAsFile());break}i++}}}var n=e.originalEvent,i=n&&n.clipboardData?n.clipboardData:e.clipboardData,o=null,r=null,a=!1;i&&t(i),editor.browserInfo.is_ie&&(o=window.clipboardData.getData("Text"));var s=function(){PasteUtil.hidePasteDiv(),editor.clientActiveSection.focus();var e,t=document.getElementById("_zohoPaste");if(editor.browserInfo.is_ie){var n=document.getElementById("pasteFrame");n.contentWindow.document.body.innerHTML=t.innerHTML,r=t.innerHTML}EventHandler.btnPasteOption>=0&&(e=EventHandler.btnPasteOption,EventHandler.btnPasteOption=""),EventHandler.plainTextPaste&&(e=CONST.PASTE_TEXTONLYFORMAT),editor.doc.execCmd("paste",[e,r,o])};return a||setTimeout(s,0),!0},e.ownerDocument.addEventListener("compositionstart",function(e){EventHandler.handleCompositionStart(e)},!0),e.ownerDocument.addEventListener("compositionend",function(e){EventHandler.handleCompositionEnd(e)},!1),e.ownerDocument.addEventListener("compositionupdate",function(e){EventHandler.handleCompositionUpdate(e)},!1),e.ownerDocument.addEventListener("textInput",function(e){EventHandler.handleTextInput(e)},!1)},setCursorStartIdx:function(){var e=1;if(null!=editor.subAction&&(null!=editor.subAction.bookmarks||null!=editor.subAction.comments))if(null!=editor.subAction.bookmarks?e=DocUtil.getFloatElementIdx(editor.subAction.bookmarks):null!=editor.subAction.comments&&(e=DocUtil.getFloatElementIdx(editor.subAction.comments)),e!=-1)editor.startCursorIdx=e;else if(editor.startCursorIdx=1,editor.subAction.state=!0,null!=editor.subAction.comments){var t=function(){UIUtils.showMessage("error",J.i18n("writer.common.COMMENT_DELETED_INFO"),"showclose","normalfont",8e3),PubSub.unsubscribe("Document/FirstTimeComponentReady",t)};PubSub.subscribe("Document/FirstTimeComponentReady",t)}},afterInit:function(){if(editor.isLazyFileLoaded=!0,null==editor.subAction||editor.subAction.state||!DocTreeManager.isSectionBuildInProcess()){if(!editor.isOffline()&&(initWMS(),editor.isEditable())){Utils.log("@afterInit-->addFonts");var e=(editorProps.defaultFonts||"").split(",");editor.addFonts(e.concat(WebFonts.userWebFonts))}if(null!=editor.subAction&&(editor.subAction.state=!0),editor.doc.createSelection(editor.uuid),editor.doc.snapShotManager=SnapShotManager,ZWCollaboration.msgQueue=new MsgQueue,ZWOffline.handleAfterInit(),"SHAREDREAD"===editor.doc.getRole()||"SHAREDREADCOMMENT"===editor.doc.getRole()||"ANYONELINK_SHAREDREADCOMMENT"==editor.doc.getRole()||editor.isEditable()){var t=editor.doc.getSelection();if(editor.startCursorIdx>1){var n=editor.doc.createRange(editor.startCursorIdx);t.removeAllRanges().addRange(n),Utils.scrollElementIntoView(editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start")[0],500,!0)}else{try{var i=editor.doc.getParents(NODE_TYPE.PARAGRAPH,editor.startCursorIdx);t.removeAllRanges().setSelectionType(SEL_AUTO_GEN).moveTo(i,!0),CurUtil.stopBlinking();var o=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start");o||(CurUtil.createCursor("start",editor.uuid,editor.zuid),editor.updateVisiblePages(editor.jeditorPane.children(".zw-page")[editor.currentPageIndex]),editor.togglePages()),EventHandler.toggleSection()}catch(e){editor.doc.getDomCursorNode()||CurUtil.createCursor("start",editor.uuid,editor.zuid)}CurUtil.blinkCursor()}}editor.isEditable()||CurUtil.stopBlinking(),PubSub.publish("Document/AfterInit"),PubSub.publish("Document/EditorReady")}},fetchDocument:function(e,t,n){var i=Utils.getUrl("view"),o=editor.doc.getDocInfo(),r={};r.viewVersion=t,r.chid=o.COLLAB_ID,r.sid=1,r.tstamp=(new Date).getTime(),Utils.setCsrfParam(r),"REMOTE"==editor.getEditorType()?(r.rsid=RemoteEditor.rsid,r.uname=RemoteEditor.options.wms_annnonuser_id):(r.rid=e,r.uname=editor.zuid),J.ajax({type:"POST",dataType:"json",url:i,data:r,success:function(e){if("SUCCESS"===e.RESPONSE){var t={};t.content=e.docContent,t.info=e.docInfo,editor.processFetchResponse(t)}else"FAILED"===e.RESPONSE&&PubSub.publish("Document/LoadingError",200)},error:function(e,t,n){PubSub.publish("Document/LoadingError",e.status)}})},isRemoteEditor:function(){return!1},mouseEventHandler:function(e,t){var n=e||window.event,i=editor.browserInfo.is_ie?n.srcElement:n.target,o=J(i),r=n.type,a=!1;if(this.currentCommand=COMMAND.ANY,"mouseup"==r&&PubSub.publish("Document/BeforeMouseUp",n),"tableProp"===i.id||o.hasClass("bMark")||o.hasClass("ui-page-collapse-div")||o.parent().hasClass("ui-page-collapse-div")||!editor.isEditable()||"dummyImage"==o[0].id||o[0].getAttribute("class")&&o[0].getAttribute("class").indexOf("rect")!=-1)return!0;if(!(InsertShape.handleMouseEvents(n,r)||InsertShape.isShapeSelected&&"scroll"!=r||J(e.target).parents("#review_Rightpane").length)){if(("mouseup"==r||"mousemove"==r)&&TableVisualCueHandler&&TableVisualCueHandler.isOpen()){var s=TableVisualCueHandler.handleMouseEvents(n);if(s)return n.stopPropagation(),!1}var l=editor.doc.getSelection();if("mousedown"==r||"mouseup"==r){if(!l.isCollapsed()&&3==n.which&&o[0].getAtribute("class").indexOf("zw-image")==-1||editor.scrollOn)return EventHandler.mouseUpDone=!0,"mousedown"==r&&(editor.scrollOn=!1),!1;if("mousedown"==r){PubSub.publish("Document/BeforeMouseDown",n),EventHandler.mouseUpDone=!1;var d=(editor.editorPaneContainer[0].clientWidth,editor.editorPaneContainerOffset.top+editor.editorPaneContainerHt-20);(n.clientX>editor.editorPaneContainer[0].clientWidth||n.clientY>d)&&(editor.scrollOn=!0,EventHandler.mouseUpDone=!0)}else{if(EventHandler.isMenuOpened||EventHandler.isDialogOpened)return!1;EventHandler.mouseUpDone=!0}}if("mousedown"==r&&l.isCollapsed()&&editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start").css("visibility","hidden"),"mousemove"==r||"mouseup"==r||"mousedown"==r||"click"==r){if("mousedown"==r&&(l.isMultipleSelection=!1,l.isCtrlSelection=!1,l.isCellSelection=!1,l.isRowSelection=!1,PubSub.publish("QuickSeek/hideBarWithID","Selection")),o.hasClass("ui-hdr-ftr-exit"))return!1;if(EventHandler.handleMouseEvents(n),l.isCollapsed()&&l.resetLastModifiedPosition(),("mousedown"==r||"mouseup"==r||"mousemove"==r)&&(a=Resize.handleImageMove(n),"mousedown"==r&&a))return!1}else if("dragstart"==r){Resize.removeResizeDiv();var c=l.getLastRange();if(!c.isMultipleTablesSelected()&&J(i).hasClass("overlay"))l.isTextDrag=!0,EventHandler.textDragStart=!0,J(editor.clientActiveSection).removeClass("selectableSection").addClass("unselectable"),a=!0;else if(editor.imgDragStart||CropImage.getImageDrag()||CropImage.isCropImageActive())return Utils.stopEvent(n),!1}else if("drop"==r||"dragstop"==r){if(EventHandler.mouseUpDone=!0,EventHandler.textDragStart)EventHandler.moveText();else if(EventHandler.mouseDown||"dragstop"==r){if(editor.imgDragStart||CropImage.getImageDrag())return Utils.stopEvent(n),!1}else editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start").css("border-left-style",""),EventHandler.dropImage(n);a=!0}else if("dragover"==r||"drag"==r){if((editor.imgDragStart||CropImage.getImageDrag()||CropImage.isCropImageActive())&&(Utils.stopEvent(n),a=!0),EventHandler.mouseDown||(editor.externalImgDrag=!0),EventHandler.textDragStart||editor.externalImgDrag||!editor.isFloatingImage(EventHandler.imgDragAttr)){if(0==J(n.originalEvent?n.originalEvent.target:i).parents("#ui-editor-outer-div").length)return;EventHandler.moveCursor(n)}}else{if("dragleave"==r)return EventHandler.mouseDown||(Utils.stopEvent(n),a=!0),(editor.imgDragStart||CropImage.getImageDrag())&&(Utils.stopEvent(n),a=!0),!0;if("dragenter"==r){if(!EventHandler.mouseDown){if(n.dataTransfer&&n.dataTransfer.items[0]||!CropImage.isCropImageActive())return ImportDoc.init(),PanelUtil.showDragAndDropContainer(),!0;Utils.stopEvent(n),a=!0}return(editor.imgDragStart||CropImage.getImageDrag()||CropImage.isCropImageActive())&&(Utils.stopEvent(n),a=!0),!0}"scroll"==r&&(editor.scrollOn=!0,editor.updateEditorOffset(),PubSub.publish("Document/ScrollEvent"))}if("mouseup"==r&&(EditorUtil.focusMultiByteSpan(),/updateRowHeight|updateColumnWidth/.test(editor.lastOperation)||(editor.editorPaneContainer[0].scrollTop=CurUtil.scrollTop),EventHandler.multiByteTyping||CurUtil.blinkCursor()),a)return Utils.stopEvent(n),!1;if(editor.doc.isHighLighterOn&&"mouseup"==r){var u=l.getTextFormat(),p=l.getParaFormat();u=Utils.mergeObjs([p[ATTR_PARAGRAPH.TEXTFORMAT],u]);var h=DocUtil.formatGenerator.getTextFormat(u,"BackColor",editor.doc.highLightTextColor);l.applyFormat(h),Op.sendMsg();var c=editor.doc.createRange(l.getLastRange().end);l.removeAllRanges().addRange(c)}return!0}},onCopy:function(e){if(!editor.browserInfo.is_ie&&!EventHandler.isDialogOpened){var t=document.getElementById("_zohoPaste");e.clipboardData.setData("text/html",t.innerHTML),e.clipboardData.setData("text/plain",t.innerText),e.preventDefault()}return!0},keyEventHandler:function(e){var t=editor.browserInfo.is_ie?window.event:e,n=editor.browserInfo.is_ie?t.srcElement:t.target,i=(J(n),!1),o=t.type,r=t.charCode,a=t.keyCode,s=t.shiftKey,l=t.ctrlKey,d=t.metaKey,c=t.altKey,u=t.key||t.keyIdentifier,p=t.repeat||!1;if(EventHandler.isOnlyCtrlKeyPressed=!1,this.currentCommand=COMMAND.ANY,!editor.isEditable())return!0;var h=editor.doc.getSelection();if("keydown"==o){if(EventHandler.isOnlyCtrlKeyPressed=!c&&!s&&(editor.browserInfo.is_mac?!l&&d&&"Meta"==u:l&&"Control"==u),editor.keyPressTriggered=!1,PubSub.publish("Document/BeforeKeyDown",a),EventHandler.isNonCharKey=16==a||17==a||18==a||91==a||93==a||27==a||20==a||45==a||112<=a&&a<=130,a!=KEYS.TAB&&a!=KEYS.ENTER&&WordComplete.removeSuggestion(),229==a){document.activeElement;return EventHandler.multiByteTyping?(EventHandler.multiByteTyping=!0,!0):(CurUtil.stopBlinking(),h.isCollapsed()||editor.doc.execCmd("delete","nextchar"),editor.browserInfo.is_ie?EventHandler.multiByteTyping||(EventHandler.multiByteTyping=!0,EditorUtil.focusMultiByteSpan()):editor.browserInfo.isWebkit,!0)}editor.isCompositionEnd=!1,EventHandler.isNonCharKey||(EditorUtil.flushContents(),EventHandler.multiByteTyping=!1),i=EventHandler.handleKeyDown(t),editor.doc.isHighLighterOn&&(editor.doc.isHighLighterOn=!1,editor.jeditorPane.children(".zw-page").css("cursor",""),J("#fmt-lpnl-bgcolor").removeClass("ui-highlight-active")),t.shiftKey&&p||PubSub.publish("Editor/KeyDown",t)}else if("keypress"==o){if(EventHandler.multiByteTyping)return!0;if(!(d||!editor.browserInfo.isWebkit&&l||a==KEYS.ENTER||0==r||l&&s)){var f=String.fromCharCode(a);if(editor.browserInfo.isGecko&&(f=String.fromCharCode(r)),(34===a||34===r)&&parseInt(w_usersettings[ATTR_BODY.DS_AUTOSMARTQUOTES])){var m=editor.doc.getCharAt(h.getStart()-1);f=" "===m||m===UNICODE.PARA?"":""}editor.addChar(f,t),32==a||32==r?Utils.afterSpaceOperations(f):WordComplete.lookupWord(),PubSub.publish("Selection/updateClientLeft"),editor.keyPressTriggered=!0,i=!0}}else if("keyup"==o){if(EventHandler.multiByteTyping)return!0;(editor.browserInfo.is_mac||editor.browserInfo.is_windows&&editor.keyPressTriggered||editor.browserInfo.is_windows&&!editor.keyPressTriggered&&(!l||!c))&&(i=!0)}return i?(Utils.stopEvent(t),!1):void 0},addChar:function(e,t){var n="";for(var i in UNICODE)"MULTIBYTE_SPACE"!=i&&"SPACE"!=i&&"MERGEFIELD_START"!=i&&"MERGEFIELD_END"!=i&&(n=UNICODE[i],e=e.replace(new RegExp(n,"gi"),""));if(e.length){var o=editor.doc.createElement(NODE_TYPE.TEXT,e),r=editor.doc.getSelection(),a=r.getTextFormat(),s=!1,l={},d=r.getStart();jQuery.isEmptyObject(a)||("ON"===a[ATTR_TEXT.TS_AUTO_COREECT]&&(s=!0,l=DocUtil.copyStyle(a),l[ATTR_TEXT.TS_AUTO_COREECT]="OFF"),a.hasOwnProperty(TCConstants.TC)&&delete a[TCConstants.TC],delete a[ATTR_TEXT.TS_AUTO_COREECT],o.css=a),"repeatAction"===editor.doc.lastAction.action&&(editor.doc.lastAction.action="Typing",editor.doc.clearLastAction()),CurUtil.stopBlinking(),Command.exec("InsertChar",{cmd:"insert",element:o}),s&&(editor.doc.setFormatAt(d,l),r.setCursorFormat())}},close:function(){this.onBeforeUnload(),editor.jeditorPane.off("mousedown mouseup mousemove"),dom.onkeydown=dom.onkeyup=dom.onkeypress=dom.ondragenter=dom.ondragleave=dom.ondragstart=dom.ondrop=dom.ondragover=document.onmouseup=window.onblur=window.onresize=window.onfocus=void 0,PubSub.publish("Document/CloseEditor"),editor=void 0,PubSub.unsubscribeAll()},isFloatingImage:function(e){return e&&e[ATTR_IMAGE.I_AL]&&!("bottom"==e[ATTR_IMAGE.I_AL])},addDraggables:function(e,t){var n=editor.doc.getRole();editor.isEditable()&&"SHAREDREADCOMMENT"!=n&&"ANYONELINK_SHAREDREADCOMMENT"!=n&&e.draggable({helper:"clone",opacity:.65,scroll:!0,containment:"#editorpane-container",start:function(e,t){return PubSub.publish("Document/DragStart"),editor.mouseEventHandler(e)},drag:function(e,n){return t&&n.helper.css({"pointer-events":"none",display:"none"}),n.position.top/=editor.zoomFactor,n.position.left/=editor.zoomFactor,editor.mouseEventHandler(e)},stop:function(e,t){return PubSub.publish("Document/DragStop"),editor.mouseEventHandler(e,t)}})},prepareDraggables:function(e){J(e)},isFinalDocument:function(){var e=editor.doc.getDocInfo();return e.FINAL_INFO&&e.FINAL_INFO.STATUS},addFonts:function(e,t){for(var n,i,o=[],r=0,a=e&&e.length||0;r<a;r++)(n=e[r])&&(i=editor.getWebFont(n),i&&!o.contains(i)&&o.push(i),n=n.toLowerCase(),!editor.defaultFonts.contains(n)&&editor.defaultFonts.push(n));ZWWebFontLoader.loadWebFonts(o,t)},getWebFont:function(e){return l&&l[e&&e.toLowerCase()]},updateVisiblePages:function(e,t){editor.visiblePageNumbers.splice(0,editor.visiblePageNumbers.length);var n=J(e),i=n.data("id"),o=ViewManager.pages.items[i];if(o){var r=o,a=t.top,s=a-editor.editorPaneContainerHt,l=a+2*editor.editorPaneContainerHt;r&&editor.visiblePageNumbers.push(r.pageNumber);for(var d,c,u;o.prev&&(d=o.prev.el,u=o.prev,c=J(d),(d.offsetTop+d.offsetHeight)*editor.zoomFactor>s);)o=o.prev,editor.visiblePageNumbers.push(u.pageNumber);for(o=r;o.next&&(u=o.next,d=o.next.el,c=J(d),d.offsetTop*editor.zoomFactor<l);)editor.visiblePageNumbers.push(u.pageNumber),o=o.next;var o,p=0,h=editor.visiblePageNumbers.length;for(p=0;p<h;p++)try{o=ViewManager.getPageAtPageNumber(editor.visiblePageNumbers[p]),o&&(o.createContentFragments(),o.renderView())}catch(e){Utils.log("Stack ::: "+e.stack);var f=new Error(ZWCollaboration.DT_DOM_RENDERING_ERROR);throw editor.lastError=f,e}}},togglePages:function(){if(Utils.isEditableMode()){var e;ViewManager.hideAllPageContents();for(var t=0,n=editor.visiblePageNumbers.length;t<n;t++)e=ViewManager.getPageAtPageNumber(editor.visiblePageNumbers[t]),e&&(e.content.el.style.display="block")}},handleScroll:function(){clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout(function(){var e=editor.getViewPortInfo(),t=e.pageNo,n=ViewManager.getElements("page")[t-1];editor.updateVisiblePages(n,e.viewport),editor.togglePages(),PubSub.publish("Document/ViewportChanged",ViewManager.getPageAtPageNumber(t),e.viewport)},10)},getViewPortInfo:function(){var e={},t=ViewManager.getPageCount(),n=1,i=0,o=ViewManager.getPages(),r=o[editor.currentPageIndex];r||(r=o[0]),i=editor.editorPaneContainer.scrollTop();for(var a,s,l,d=i+editor.editorPaneContainer.height(),c=o.length,u=ViewManager.getPageHeight(),p=0;p<c;p++)if(a=o[p],s=(a.pageNumber-1)*(u+20)*editor.zoomFactor,s-=40,l=(s+u)*editor.zoomFactor,l+=40,i>s&&l>i){r=o[p];break}return n=r&&r.pageNumber||1,viewport={},viewport.top=i,viewport.bottom=d,e.pageNo=n,e.pageCount=t,e.viewport=viewport,e},getDocument:function(){return d},getDocumentBuilder:function(){return c}}}function DocOp(){this.characters=null,this.retain_count=null,this.delete_characters=null,this.styles=null,this.isPriorityOp=!1,this.lock_data=null}function _docop(){var e;return{type:e}}function InsertOp(e){this.type=DOCOP_TYPE_INSERT,this.chars=e,this.cut=function(e,t){var n=this.chars.substring(e,t);return this.chars=this.chars.substring(t),new InsertOp(n)},this.length=function(){return this.chars.length()},this.toString=function(){return"{'is':'"+Utils.escapeSplChars(this.chars)+"'}"},this.toJSON=function(){return{is:this.chars}},this.clone=function(){return new InsertOp(this.chars)}}function RetainOp(e){this.type=DOCOP_TYPE_RETAIN,this.retain=e,this.cut=function(e){return this.retain-=e,new RetainOp(e)},this.length=function(){return e},this.toString=function(){return"{'r':"+this.retain+"}"},this.toJSON=function(){return{r:this.retain}},this.clone=function(){return new RetainOp(this.retain)}}function DeleteOp(e,t){this.type=DOCOP_TYPE_DELETE,this.chars=e,this.priority=!!t,this.cut=function(e,t){var n=this.chars.substring(e,t);return this.chars=this.chars.substring(t),new DeleteOp(n)},this.length=function(){return this.chars.length()},this.toString=function(){return"{'ds':'"+Utils.escapeSplChars(this.chars)+"'}"},this.toJSON=function(){return{ds:this.chars}},this.clone=function(){return new DeleteOp(this.chars,this.priority)}}function StartStyleOp(e){this.type=DOCOP_TYPE_STYLESTART,this.styles=DocUtil.copyStyle(e),this.toString=function(){return"{'as':{'start':"+JSON.stringify(this.styles)+"}}"},this.toJSON=function(){return{as:{start:this.styles}}},this.clone=function(){return new StartStyleOp(this.styles)}}function EndStyleOp(e){this.type=DOCOP_TYPE_STYLEEND,this.styles=DocUtil.copyStyle(e),this.toString=function(){return"{'as':{'end':"+JSON.stringify(this.styles)+"}}"},this.clone=function(){return new EndStyleOp(this.styles)},this.toJSON=function(){return{as:{end:this.styles}}}}function TCOp(e,t,n,i,o,r,a){this.range=e,this.action=t,this.zuid=n,this.chars=i,this.style=o,this.originAction=r,this.contentStyleOp=a}function LockOp(e,t){this.type=DOCOP_TYPE_LOCK,this.lockData=DocUtil.copyStyle(t),this.range=e,this.origRange=e,this.cut=function(e){return this.range-=e,new LockOp(e,this.lockData)},this.clone=function(){return new LockOp(this.range,this.lockData)},this.length=function(){return this.range},this.toString=function(){return"{'lk':'"+JSON.stringify(this.lockData)+"'}"},this.toJSON=function(){return{lk:{range:this.range,data:this.lockData}}}}function DocOpBuilder(){this.docOps=[],this.zuid=null,this.isLock=!1,this.isRedact=!1,this.redactContent="",this.isInsideRedact=!1,this.cursor=[]}function DocOpUtil(){}function DocUtil(){}function DomUtil(){}function LinkedList(){this.items={},this.first=this.last=null,this.length=0}function DTUpdateQueue(e){this.nodesMap={},this.length=0}function DTSection(e,t,n){var i=editor.doc.getRawFormatAt(e);this.start=e,this.end=t,this.children=[],this.name=i.st||"content",this.nodesToUpdate=new DTUpdateQueue,this.nodelessRange=null,this.width=n.width,this.view={},this.doc=n,this.lists={},this.nodes={},this.def=null,this.type="section",this.isSectionBuildInRecursion=!1;var o=editor.doc.getBodyFormat()[ATTR_BODY.DS_HF_TYPE];"header_primary"==this.name?(i.hftype||(i.hftype=1),2==o||3==o?this.name="header_odd":this.name="header"):"footer_primary"==this.name?(i.hftype||(i.hftype=3),2==o||3==o?this.name="footer_odd":this.name="footer"):i.hftype==CONST.HEADER_PRIMARY?2==o||3==o?this.name="header_odd":this.name="header":i.hftype==CONST.FOOTER_PRIMARY?2==o||3==o?this.name="footer_odd":this.name="footer":i.hftype==CONST.HEADER_EVEN?this.name="header_even":i.hftype==CONST.FOOTER_EVEN?this.name="footer_even":i.hftype==CONST.HEADER_FIRST?this.name="header_first":i.hftype==CONST.FOOTER_FIRST&&(this.name="footer_first"),this.name.indexOf("header")==-1&&this.name.indexOf("footer")==-1||(this.width=editor.doc.getPaperWidth());var r,a,s,l,d;for(this.unknownImages={},this.format=i,r=editor.doc.getCharAt(this.start)==UNICODE.SECTION_START?this.start+1:this.start;r<this.end;)a=editor.doc.getCharAt(r),DTNode.types[a]?(a==UNICODE.PARA?(l=getStart(UNICODE.PARA,r)-this.start,d=r+1-this.start):(l=r-this.start,d=getEnd(a,r)-this.start),s=new DTNode.types[a](l,d,this),this.addChild(s),this.nodesToUpdate.push(s.id,makeOp(s,"create")),r=this.start+s.end):r+=1}function MetaElement(e,t){this.start=e,this.end=getEnd(UNICODE.SECTIONEND,t.index+e)-t.index,this.parent=t,this.section=t,this.view=null,this.children=[],this.id="node_"+("x"+Math.random()).replace(/\D/g,"")}function HeaderView(e){this.id=randomId("header"),this.page=e,this.height=0,this.views=new LinkedList,this.padding={top:"7px".convertor(),bottom:"7px".convertor()}}function HeaderView_Primary(){this.id=randomId("header"),this.viewMap={},this.views=new LinkedList,this.height=0,this.floatImages=[]}function HeaderView_Odd(){this.id=randomId("header"),this.viewMap={},this.views=new LinkedList,this.height=0,this.floatImages=[]}function HeaderView_Even(){this.id=randomId("header"),this.viewMap={},this.views=new LinkedList,this.height=0,this.floatImages=[]}function HeaderView_First(){this.id=randomId("header"),this.viewMap={},this.views=new LinkedList,this.height=0,this.floatImages=[]}function FooterView(e){this.id=randomId("footer"),this.page=e,this.height=0,this.separatorHeight=0,this.views=new LinkedList,this.padding={top:"7px".convertor(),bottom:"7px".convertor()}}function FooterView_Primary(e){this.id=randomId("footer"),this.page=e,this.height=0,this.viewMap={},this.views=new LinkedList,this.separatorHeight=0,this.floatImages=[]}function FooterView_Odd(e){this.id=randomId("footer"),this.page=e,this.height=0,this.viewMap={},this.views=new LinkedList,this.separatorHeight=0,this.floatImages=[]}function FooterView_Even(e){this.id=randomId("footer"),this.page=e,this.height=0,this.viewMap={},this.views=new LinkedList,this.separatorHeight=0,this.floatImages=[]}function FooterView_First(e){this.id=randomId("footer"),this.height=0,this.viewMap={},this.views=new LinkedList,this.separatorHeight=0,this.floatImages=[]}function ContentView(e){this.id=randomId("content"),this.page=e,this.columns=new LinkedList,this.height=0,this.minHeight=0,this.separatorHeight=0}function ColumnView(e){this.id=randomId("column"),this.content=e,this.views=new LinkedList,this.endNoteViews=new LinkedList,this.footNoteViews=new LinkedList,this.fragment=document.createDocumentFragment(),this.viewMap={},this.outgoingFootnotes={references:{},ids:[]}}function PageView(){this.id=randomId("page"),this.header=new HeaderView(this),this.footer=new FooterView(this),this.content=new ContentView(this),this.allViews={},this.views=new LinkedList,this.headerViews=new LinkedList,this.footerViews=new LinkedList,this.height=0,this.fragment=document.createDocumentFragment(),this.isPageRendered=!1,this.pageNumber=0,this.floatImages=[]}function NoteView(e){this.type=e.name;var t=this.type[0]+"n";this.id=randomId(t),this.node=e,this.referenceChar,this.el,this.rangeElement,this.containingParaReference={},this.views=new LinkedList,this.viewMap={},ViewManager.addViewDetails(this)}function EndNoteView(e){NoteView.call(this,e),this.className="zw-endnotepane"}function FootNoteView(e){NoteView.call(this,e),this.className="zw-footnotepane"}function List(){}function PageLayout(){this.paperSize="Letter"}function PUtil(){}function ZWOffline(){}function MsgHandler(){}function ZWCollaboration(){}function ReviewUtil(){}function InsertShape(){}function ShapePaste(){}function BucketArray(){function e(){this.start=0,this.array=[],this.next=null,this.prev=null}function t(e){if(a&&a.start<e&&e<a.start+a.array.length)return a;for(var t=0,n=c.length;t<n&&c[t].start<=e;t++);return a=c[t-1],c[t-1]}function n(n,o){var r=new e;r.start=n,r.array=o;var a=t(n);return i(a,r),c.splice(a?c.indexOf(a)+1:0,0,r),r}function i(e,t){return e?(t.prev=e,t.next=e.next,void(e.next=t)):t}function o(e,t){for(;e;)e.start+=t,e=e.next}function r(e){if(e&&e.array.length>=d){var t=e.array.splice(l),i=e.start+l;bkt_new=n(i,t)}}var a,s=1e4,l=s,d=2*s,c=[];return{getbuckets:function(){return c},initBucketSize:function(e){var t=s;e>4e5&&(t=1e5),l=t,d=2*l},init:function(e){if(e&&e.splice){c=[];var t=e,i=0;do{var o=t.splice(l);n(i,t),i+=t.length,t=o}while(0!=Math.round(t.length/l))}},get:function(e){var n=t(e);if(!n)throw"Index out of bounds. Invalid index.";return n.array[e-n.start]},set:function(e,n){var i=t(e);if(!i)throw"Index out of bounds. Invalid index.";var o=e-i.start;i.array[o]=n},remove:function(e,n){var i=t(e);if(!i)throw"Index out of bounds. Invalid index.";for(;n&&i;){var r=e-i.start,a=i.array.length-r,s=n>a?a:n;if(i.array.splice(r,s),o(i.next,-s),0==i.array.length){var l=i.next;if(i.prev&&(i.prev.next=i.next),i.next&&(i.next.prev=i.prev),c.splice(i?c.indexOf(i):0,1),i=l,!i)break;e=i.start}else i=i.next,e=i?i.start:0;n-=s}},put:function(e,n){var i=t(e);if(!i)throw"Index out of bounds. Invalid index.";var a=i.array,s=e-i.start;a.splice(s,0,n),o(i.next,1),r(i)},push:function(e){var t=c[c.length-1];t||(t=n(0,[])),t.array.push(e),r(t)},getBetweenIdx:function(e,n){var i,o,r,a,s=[];if(i=t(e),r=i.start,a=r+i.array.length,s=i.array.slice(e,a),n>a){o=t(n),r=o.start;for(var l=i.next;l&&l!=o;)s=s.concat(l.array.slice(0,l.array.length)),l=l.next;s=s.concat(o.array.slice(0,n))}else s=s.slice(0,n);return s},getFormats:function(){var e,t,n,i,o=[],r=[],a=this.getbuckets(),s=a.length;for(e=0;e<s;e++)for(n=a[e],r=n.array,t=0,i=n.array.length;t<i;t++)o.push(r[t]);return o}}}function exportDoc(){}function writerConfig(){}function UIUtils(){}function CommonError(){}function RestoreDocumentProperVersion(){}!function(e,t,n){function i(e,t,n){return e.addEventListener?void e.addEventListener(t,n,!1):void e.attachEvent("on"+t,n)}function o(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return y[e.which]?y[e.which]:A[e.which]?A[e.which]:String.fromCharCode(e.which).toLowerCase()}function r(e,t){return e.sort().join(",")===t.sort().join(",")}function a(e){e=e||{};var t,n=!1;for(t in M)e[t]?n=!0:M[t]=0;n||(U=!1)}function s(e,t,n,i,o,a){var s,l,d=[],c=n.type;if(!w[e])return[];for("keyup"==c&&f(e)&&(t=[e]),s=0;s<w[e].length;++s)if(l=w[e][s],(i||!l.seq||M[l.seq]==l.level)&&c==l.action&&("keypress"==c&&!n.metaKey&&!n.ctrlKey||r(t,l.modifiers))){var u=!i&&l.combo==o,p=i&&l.seq==i&&l.level==a;(u||p)&&w[e].splice(s,1),d.push(l)}return d}function l(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}function d(e){return e.preventDefault?void e.preventDefault():void(e.returnValue=!1)}function c(e){return e.stopPropagation?void e.stopPropagation():void(e.cancelBubble=!0)}function u(e,t,n,i){k.stopCallback(t,t.target||t.srcElement,n,i)||e(t,n)===!1&&(d(t),c(t))}function p(e,t,n){var i,o=s(e,t,n),r={},l=0,d=!1;for(i=0;i<o.length;++i)o[i].seq&&(l=Math.max(l,o[i].level));for(i=0;i<o.length;++i)if(o[i].seq){if(o[i].level!=l)continue;d=!0,r[o[i].seq]=1,u(o[i].callback,n,o[i].combo,o[i].seq)}else d||u(o[i].callback,n,o[i].combo);var c="keypress"==n.type&&N;n.type!=U||f(e)||c||a(r),N=d&&"keydown"==n.type}function h(e){"number"!=typeof e.which&&(e.which=e.keyCode);var t=o(e);if(t)return"keyup"==e.type&&L===t?void(L=!1):void k.handleKey(t,l(e),e)}function f(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function m(){clearTimeout(D),D=setTimeout(a,1e3)}function g(){if(!O){O={};for(var e in y)e>95&&e<112||y.hasOwnProperty(e)&&(O[y[e]]=e)}return O}function T(e,t,n){return n||(n=g()[e]?"keydown":"keypress"),"keypress"==n&&t.length&&(n="keydown"),n}function _(e,t,n,i){function r(t){return function(){U=t,++M[e],m()}}function s(t){u(n,t,e),"keyup"!==i&&(L=o(t)),setTimeout(a,10)}M[e]=0;for(var l=0;l<t.length;++l){var d=l+1===t.length,c=d?s:r(i||v(t[l+1]).action);S(t[l],c,i,e,l)}}function E(e){return"+"===e?["+"]:e.split("+")}function v(e,t){var n,i,o,r=[];for(n=E(e),o=0;o<n.length;++o)i=n[o],I[i]&&(i=I[i]),t&&"keypress"!=t&&C[i]&&(i=C[i],r.push("shift")),f(i)&&r.push(i);return t=T(i,r,t),{key:i,modifiers:r,action:t}}function S(e,t,n,i,o){P[e+":"+n]=t,e=e.replace(/\s+/g," ");var r,a=e.split(" ");return a.length>1?void _(e,a,t,n):(r=v(e,n),w[r.key]=w[r.key]||[],s(r.key,r.modifiers,{type:r.action},i,e,o),void w[r.key][i?"unshift":"push"]({callback:t,modifiers:r.modifiers,action:r.action,seq:i,level:o,combo:e}))}function b(e,t,n){for(var i=0;i<e.length;++i)S(e[i],t,n)}function R(e){e=e||t,i(e,"keypress",h),i(e,"keydown",h),i(e,"keyup",h)}for(var O,D,y={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},A={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},C={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},I={option:"alt",command:"meta",return:"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},w={},P={},M={},L=!1,N=!1,U=!1,x=1;x<20;++x)y[111+x]="f"+x;for(x=0;x<=9;++x)y[x+96]=x;var k={bind:function(e,t,n){return e=e instanceof Array?e:[e],b(e,t,n),this},unbind:function(e,t){return k.bind(e,function(){},t)},trigger:function(e,t){return P[e+":"+t]&&P[e+":"+t]({},e),this},reset:function(){return w={},P={},this},stopCallback:function(e,t){return!1},handleKey:p,init:R};e.Mousetrap=k,"function"==typeof define&&define.amd&&define(k)}(window,document),function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.printStackTrace=t()}(this,function(){function e(t){t=t||{guess:!0};var n=t.e||null,i=!!t.guess,o=new e.implementation,r=o.run(n);return i?o.guessAnonymousFunctions(r):r}return e.implementation=function(){},e.implementation.prototype={run:function(e,t){return e=e||this.createException(),t=t||this.mode(e),"other"===t?this.other(arguments.callee):this[t](e)},createException:function(){try{this.undef()}catch(e){return e}},mode:function(e){return e.arguments&&e.stack?"chrome":e.stack&&e.sourceURL?"safari":e.stack&&e.number?"ie":e.stack&&e.fileName?"firefox":e.message&&e["opera#sourceloc"]?e.stacktrace?e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?"opera9":"opera10a":"opera9":e.message&&e.stack&&e.stacktrace?e.stacktrace.indexOf("called from line")<0?"opera10b":"opera11":e.stack&&!e.fileName?"chrome":"other"},instrumentFunction:function(t,n,i){t=t||window;var o=t[n];t[n]=function(){return i.call(this,e().slice(4)),t[n]._instrumented.apply(this,arguments)},t[n]._instrumented=o},deinstrumentFunction:function(e,t){e[t].constructor===Function&&e[t]._instrumented&&e[t]._instrumented.constructor===Function&&(e[t]=e[t]._instrumented)},chrome:function(e){return(e.stack+"\n").replace(/^[\s\S]+?\s+at\s+/," at ").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}() ($1)$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}() ($1)").replace(/^(.+) \((.+)\)$/gm,"$1@$2").split("\n").slice(0,-1)},safari:function(e){return e.stack.replace(/\[native code\]\n/m,"").replace(/^(?=\w+Error\:).*$\n/m,"").replace(/^@/gm,"{anonymous}()@").split("\n")},ie:function(e){return e.stack.replace(/^\s*at\s+(.*)$/gm,"$1").replace(/^Anonymous function\s+/gm,"{anonymous}() ").replace(/^(.+)\s+\((.+)\)$/gm,"$1@$2").split("\n").slice(1)},firefox:function(e){return e.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^(?:\((\S*)\))?@/gm,"{anonymous}($1)@").split("\n")},opera11:function(e){for(var t="{anonymous}",n=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/,i=e.stacktrace.split("\n"),o=[],r=0,a=i.length;r<a;r+=2){var s=n.exec(i[r]);if(s){var l=s[4]+":"+s[1]+":"+s[2],d=s[3]||"global code";d=d.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,t),o.push(d+"@"+l+" -- "+i[r+1].replace(/^\s+/,""))}}return o},opera10b:function(e){for(var t=/^(.*)@(.+):(\d+)$/,n=e.stacktrace.split("\n"),i=[],o=0,r=n.length;o<r;o++){var a=t.exec(n[o]);if(a){var s=a[1]?a[1]+"()":"global code";i.push(s+"@"+a[2]+":"+a[3])}}return i},opera10a:function(e){for(var t="{anonymous}",n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,i=e.stacktrace.split("\n"),o=[],r=0,a=i.length;r<a;r+=2){var s=n.exec(i[r]);if(s){var l=s[3]||t;o.push(l+"()@"+s[2]+":"+s[1]+" -- "+i[r+1].replace(/^\s+/,""))}}return o},opera9:function(e){for(var t="{anonymous}",n=/Line (\d+).*script (?:in )?(\S+)/i,i=e.message.split("\n"),o=[],r=2,a=i.length;r<a;r+=2){var s=n.exec(i[r]);s&&o.push(t+"()@"+s[2]+":"+s[1]+" -- "+i[r+1].replace(/^\s+/,""))}return o},other:function(e){for(var t,n,i="{anonymous}",o=/function\s*([\w\-$]+)?\s*\(/i,r=[],a=10,s=Array.prototype.slice;e&&e.arguments&&r.length<a;){t=o.test(e.toString())?RegExp.$1||i:i,n=s.call(e.arguments||[]),r[r.length]=t+"("+this.stringifyArguments(n)+")";try{e=e.caller}catch(e){r[r.length]=""+e;break}}return r},stringifyArguments:function(e){for(var t=[],n=Array.prototype.slice,i=0;i<e.length;++i){var o=e[i];void 0===o?t[i]="undefined":null===o?t[i]="null":o.constructor&&(o.constructor===Array?o.length<3?t[i]="["+this.stringifyArguments(o)+"]":t[i]="["+this.stringifyArguments(n.call(o,0,1))+"..."+this.stringifyArguments(n.call(o,-1))+"]":o.constructor===Object?t[i]="#object":o.constructor===Function?t[i]="#function":o.constructor===String?t[i]='"'+o+'"':o.constructor===Number?t[i]=o:t[i]="?")}return t.join(",")},sourceCache:{},ajax:function(e){var t=this.createXMLHTTPObject();if(t)try{return t.open("GET",e,!1),t.send(null),t.responseText}catch(e){}return""},createXMLHTTPObject:function(){for(var e,t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],n=0;n<t.length;n++)try{return e=t[n](),this.createXMLHTTPObject=t[n],e}catch(e){}},isSameDomain:function(e){return"undefined"!=typeof location&&e.indexOf(location.hostname)!==-1},getSource:function(e){return this.sourceCache[e]||(this.sourceCache[e]=this.ajax(e).split("\n")),this.sourceCache[e]},guessAnonymousFunctions:function(e){for(var t=0;t<e.length;++t){var n=/\{anonymous\}\(.*\)@(.*)/,i=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,o=e[t],r=n.exec(o);if(r){var a=i.exec(r[1]);if(a){var s=a[1],l=a[2],d=a[3]||0;if(s&&this.isSameDomain(s)&&l){var c=this.guessAnonymousFunction(s,l,d);e[t]=o.replace("{anonymous}",c)}}}}return e},guessAnonymousFunction:function(e,t,n){var i;try{i=this.findFunctionName(this.getSource(e),t)}catch(t){i="getSource failed with url: "+e+", exception: "+t.toString()}return i},findFunctionName:function(e,t){for(var n,i,o,r=/function\s+([^(]*?)\s*\(([^)]*)\)/,a=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,s=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,l="",d=Math.min(t,20),c=0;c<d;++c)if(n=e[t-c-1],o=n.indexOf("//"),o>=0&&(n=n.substr(0,o)),n){if(l=n+l,i=a.exec(l),i&&i[1])return i[1];if(i=r.exec(l),i&&i[1])return i[1];if(i=s.exec(l),i&&i[1])return i[1]}return"(?)"}},e}),function(){function e(e){function t(t,n,i,o,r,a){for(;r>=0&&a>r;r+=e){var s=o?o[r]:r;i=n(i,t[s],s,t)}return i}return function(n,i,o,r){i=E(i,r,4);var a=!y(n)&&_.keys(n),s=(a||n).length,l=e>0?0:s-1;return arguments.length<3&&(o=n[a?a[l]:l],l+=e),t(n,i,o,a,l,s)}}function t(e){return function(t,n,i){n=v(n,i);for(var o=D(t),r=e>0?0:o-1;r>=0&&o>r;r+=e)if(n(t[r],r,t))return r;return-1}}function n(e,t,n){return function(i,o,r){var a=0,s=D(i);if("number"==typeof r)e>0?a=r>=0?r:Math.max(r+s,a):s=r>=0?Math.min(r+1,s):r+s+1;else if(n&&r&&s)return r=n(i,o),i[r]===o?r:-1;if(o!==o)return r=t(c.call(i,a,s),_.isNaN),r>=0?r+a:-1;for(r=e>0?a:s-1;r>=0&&s>r;r+=e)if(i[r]===o)return r;return-1}}function i(e,t){var n=P.length,i=e.constructor,o=_.isFunction(i)&&i.prototype||s,r="constructor";for(_.has(e,r)&&!_.contains(t,r)&&t.push(r);n--;)r=P[n],r in e&&e[r]!==o[r]&&!_.contains(t,r)&&t.push(r)}var o=this,r=o._,a=Array.prototype,s=Object.prototype,l=Function.prototype,d=a.push,c=a.slice,u=s.toString,p=s.hasOwnProperty,h=Array.isArray,f=Object.keys,m=l.bind,g=Object.create,T=function(){},_=function(e){return e instanceof _?e:this instanceof _?void(this._wrapped=e):new _(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):o._=_,_.VERSION="1.8.3";var E=function(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,o){return e.call(t,n,i,o)};case 4:return function(n,i,o,r){return e.call(t,n,i,o,r)}}return function(){return e.apply(t,arguments)}},v=function(e,t,n){return null==e?_.identity:_.isFunction(e)?E(e,t,n):_.isObject(e)?_.matcher(e):_.property(e)};_.iteratee=function(e,t){return v(e,t,1/0)};var S=function(e,t){return function(n){var i=arguments.length;if(2>i||null==n)return n;for(var o=1;i>o;o++)for(var r=arguments[o],a=e(r),s=a.length,l=0;s>l;l++){var d=a[l];t&&void 0!==n[d]||(n[d]=r[d])}return n}},b=function(e){if(!_.isObject(e))return{};if(g)return g(e);T.prototype=e;var t=new T;return T.prototype=null,t},R=function(e){return function(t){return null==t?void 0:t[e]}},O=Math.pow(2,53)-1,D=R("length"),y=function(e){var t=D(e);return"number"==typeof t&&t>=0&&O>=t};_.each=_.forEach=function(e,t,n){t=E(t,n);var i,o;if(y(e))for(i=0,o=e.length;o>i;i++)t(e[i],i,e);else{var r=_.keys(e);for(i=0,o=r.length;o>i;i++)t(e[r[i]],r[i],e)}return e},_.map=_.collect=function(e,t,n){t=v(t,n);for(var i=!y(e)&&_.keys(e),o=(i||e).length,r=Array(o),a=0;o>a;a++){var s=i?i[a]:a;r[a]=t(e[s],s,e)}return r},_.reduce=_.foldl=_.inject=e(1),_.reduceRight=_.foldr=e(-1),_.find=_.detect=function(e,t,n){var i;return i=y(e)?_.findIndex(e,t,n):_.findKey(e,t,n),void 0!==i&&i!==-1?e[i]:void 0},_.filter=_.select=function(e,t,n){var i=[];return t=v(t,n),_.each(e,function(e,n,o){t(e,n,o)&&i.push(e)}),i},_.reject=function(e,t,n){return _.filter(e,_.negate(v(t)),n)},_.every=_.all=function(e,t,n){t=v(t,n);for(var i=!y(e)&&_.keys(e),o=(i||e).length,r=0;o>r;r++){var a=i?i[r]:r;if(!t(e[a],a,e))return!1}return!0},_.some=_.any=function(e,t,n){t=v(t,n);for(var i=!y(e)&&_.keys(e),o=(i||e).length,r=0;o>r;r++){var a=i?i[r]:r;if(t(e[a],a,e))return!0}return!1},_.contains=_.includes=_.include=function(e,t,n,i){return y(e)||(e=_.values(e)),("number"!=typeof n||i)&&(n=0),_.indexOf(e,t,n)>=0},_.invoke=function(e,t){var n=c.call(arguments,2),i=_.isFunction(t);return _.map(e,function(e){var o=i?t:e[t];return null==o?o:o.apply(e,n)})},_.pluck=function(e,t){return _.map(e,_.property(t))},_.where=function(e,t){return _.filter(e,_.matcher(t))},_.findWhere=function(e,t){return _.find(e,_.matcher(t))},_.max=function(e,t,n){var i,o,r=-1/0,a=-1/0;if(null==t&&null!=e){e=y(e)?e:_.values(e);for(var s=0,l=e.length;l>s;s++)i=e[s],i>r&&(r=i)}else t=v(t,n),_.each(e,function(e,n,i){o=t(e,n,i),(o>a||o===-1/0&&r===-1/0)&&(r=e,a=o)});return r},_.min=function(e,t,n){var i,o,r=1/0,a=1/0;if(null==t&&null!=e){e=y(e)?e:_.values(e);for(var s=0,l=e.length;l>s;s++)i=e[s],r>i&&(r=i)}else t=v(t,n),_.each(e,function(e,n,i){o=t(e,n,i),(a>o||1/0===o&&1/0===r)&&(r=e,a=o)});return r},_.shuffle=function(e){for(var t,n=y(e)?e:_.values(e),i=n.length,o=Array(i),r=0;i>r;r++)t=_.random(0,r),t!==r&&(o[r]=o[t]),o[t]=n[r];return o},_.sample=function(e,t,n){return null==t||n?(y(e)||(e=_.values(e)),e[_.random(e.length-1)]):_.shuffle(e).slice(0,Math.max(0,t))},_.sortBy=function(e,t,n){return t=v(t,n),_.pluck(_.map(e,function(e,n,i){return{value:e,index:n,criteria:t(e,n,i)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return e.index-t.index}),"value")};var A=function(e){return function(t,n,i){var o={};return n=v(n,i),_.each(t,function(i,r){var a=n(i,r,t);e(o,i,a)}),o}};_.groupBy=A(function(e,t,n){_.has(e,n)?e[n].push(t):e[n]=[t]}),_.indexBy=A(function(e,t,n){e[n]=t}),_.countBy=A(function(e,t,n){_.has(e,n)?e[n]++:e[n]=1}),_.toArray=function(e){return e?_.isArray(e)?c.call(e):y(e)?_.map(e,_.identity):_.values(e):[]},_.size=function(e){return null==e?0:y(e)?e.length:_.keys(e).length},_.partition=function(e,t,n){t=v(t,n);var i=[],o=[];return _.each(e,function(e,n,r){(t(e,n,r)?i:o).push(e)}),[i,o]},_.first=_.head=_.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:_.initial(e,e.length-t)},_.initial=function(e,t,n){return c.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},_.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:_.rest(e,Math.max(0,e.length-t))},_.rest=_.tail=_.drop=function(e,t,n){return c.call(e,null==t||n?1:t)},_.compact=function(e){return _.filter(e,_.identity)};var C=function(e,t,n,i){for(var o=[],r=0,a=i||0,s=D(e);s>a;a++){var l=e[a];if(y(l)&&(_.isArray(l)||_.isArguments(l))){t||(l=C(l,t,n));var d=0,c=l.length;for(o.length+=c;c>d;)o[r++]=l[d++]}else n||(o[r++]=l)}return o};_.flatten=function(e,t){return C(e,t,!1)},_.without=function(e){return _.difference(e,c.call(arguments,1))},_.uniq=_.unique=function(e,t,n,i){_.isBoolean(t)||(i=n,n=t,t=!1),null!=n&&(n=v(n,i));for(var o=[],r=[],a=0,s=D(e);s>a;a++){var l=e[a],d=n?n(l,a,e):l;t?(a&&r===d||o.push(l),r=d):n?_.contains(r,d)||(r.push(d),o.push(l)):_.contains(o,l)||o.push(l)}return o},_.union=function(){return _.uniq(C(arguments,!0,!0))},_.intersection=function(e){for(var t=[],n=arguments.length,i=0,o=D(e);o>i;i++){var r=e[i];if(!_.contains(t,r)){for(var a=1;n>a&&_.contains(arguments[a],r);a++);a===n&&t.push(r)}}return t},_.difference=function(e){var t=C(arguments,!0,!0,1);return _.filter(e,function(e){return!_.contains(t,e)})},_.zip=function(){return _.unzip(arguments)},_.unzip=function(e){for(var t=e&&_.max(e,D).length||0,n=Array(t),i=0;t>i;i++)n[i]=_.pluck(e,i);return n},_.object=function(e,t){for(var n={},i=0,o=D(e);o>i;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n},_.findIndex=t(1),_.findLastIndex=t(-1),_.sortedIndex=function(e,t,n,i){n=v(n,i,1);for(var o=n(t),r=0,a=D(e);a>r;){var s=Math.floor((r+a)/2);n(e[s])<o?r=s+1:a=s}return r},_.indexOf=n(1,_.findIndex,_.sortedIndex),_.lastIndexOf=n(-1,_.findLastIndex),_.range=function(e,t,n){null==t&&(t=e||0,e=0),n=n||1;for(var i=Math.max(Math.ceil((t-e)/n),0),o=Array(i),r=0;i>r;r++,e+=n)o[r]=e;return o};var I=function(e,t,n,i,o){if(!(i instanceof t))return e.apply(n,o);var r=b(e.prototype),a=e.apply(r,o);return _.isObject(a)?a:r};_.bind=function(e,t){if(m&&e.bind===m)return m.apply(e,c.call(arguments,1));if(!_.isFunction(e))throw new TypeError("Bind must be called on a function");var n=c.call(arguments,2),i=function(){return I(e,i,t,this,n.concat(c.call(arguments)))};return i},_.partial=function(e){var t=c.call(arguments,1),n=function(){for(var i=0,o=t.length,r=Array(o),a=0;o>a;a++)r[a]=t[a]===_?arguments[i++]:t[a];for(;i<arguments.length;)r.push(arguments[i++]);return I(e,n,this,this,r)};return n},_.bindAll=function(e){var t,n,i=arguments.length;if(1>=i)throw new Error("bindAll must be passed function names");for(t=1;i>t;t++)n=arguments[t],e[n]=_.bind(e[n],e);return e},_.memoize=function(e,t){var n=function(i){var o=n.cache,r=""+(t?t.apply(this,arguments):i);return _.has(o,r)||(o[r]=e.apply(this,arguments)),o[r]};return n.cache={},n},_.delay=function(e,t){var n=c.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},_.defer=_.partial(_.delay,_,1),_.throttle=function(e,t,n){var i,o,r,a=null,s=0;n||(n={});var l=function(){s=n.leading===!1?0:_.now(),a=null,r=e.apply(i,o),a||(i=o=null)};return function(){var d=_.now();s||n.leading!==!1||(s=d);var c=t-(d-s);return i=this,o=arguments,0>=c||c>t?(a&&(clearTimeout(a),a=null),s=d,r=e.apply(i,o),a||(i=o=null)):a||n.trailing===!1||(a=setTimeout(l,c)),r}},_.debounce=function(e,t,n){var i,o,r,a,s,l=function(){var d=_.now()-a;t>d&&d>=0?i=setTimeout(l,t-d):(i=null,n||(s=e.apply(r,o),i||(r=o=null)))};return function(){r=this,o=arguments,a=_.now();var d=n&&!i;return i||(i=setTimeout(l,t)),d&&(s=e.apply(r,o),r=o=null),s}},_.wrap=function(e,t){return _.partial(t,e)},_.negate=function(e){return function(){return!e.apply(this,arguments)}},_.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,i=e[t].apply(this,arguments);n--;)i=e[n].call(this,i);return i}},_.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},_.before=function(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),1>=e&&(t=null),n}},_.once=_.partial(_.before,2);var w=!{toString:null}.propertyIsEnumerable("toString"),P=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];_.keys=function(e){if(!_.isObject(e))return[];if(f)return f(e);var t=[];for(var n in e)_.has(e,n)&&t.push(n);return w&&i(e,t),t},_.allKeys=function(e){if(!_.isObject(e))return[];var t=[];for(var n in e)t.push(n);return w&&i(e,t),t},_.values=function(e){for(var t=_.keys(e),n=t.length,i=Array(n),o=0;n>o;o++)i[o]=e[t[o]];return i},_.mapObject=function(e,t,n){t=v(t,n);for(var i,o=_.keys(e),r=o.length,a={},s=0;r>s;s++)i=o[s],a[i]=t(e[i],i,e);return a},_.pairs=function(e){for(var t=_.keys(e),n=t.length,i=Array(n),o=0;n>o;o++)i[o]=[t[o],e[t[o]]];return i},_.invert=function(e){for(var t={},n=_.keys(e),i=0,o=n.length;o>i;i++)t[e[n[i]]]=n[i];return t},_.functions=_.methods=function(e){var t=[];for(var n in e)_.isFunction(e[n])&&t.push(n);return t.sort()},_.extend=S(_.allKeys),_.extendOwn=_.assign=S(_.keys),_.findKey=function(e,t,n){t=v(t,n);for(var i,o=_.keys(e),r=0,a=o.length;a>r;r++)if(i=o[r],t(e[i],i,e))return i},_.pick=function(e,t,n){var i,o,r={},a=e;if(null==a)return r;_.isFunction(t)?(o=_.allKeys(a),i=E(t,n)):(o=C(arguments,!1,!1,1),i=function(e,t,n){return t in n},a=Object(a));for(var s=0,l=o.length;l>s;s++){var d=o[s],c=a[d];i(c,d,a)&&(r[d]=c)}return r},_.omit=function(e,t,n){if(_.isFunction(t))t=_.negate(t);else{var i=_.map(C(arguments,!1,!1,1),String);t=function(e,t){return!_.contains(i,t)}}return _.pick(e,t,n)},_.defaults=S(_.allKeys,!0),_.create=function(e,t){var n=b(e);return t&&_.extendOwn(n,t),n},_.clone=function(e){return _.isObject(e)?_.isArray(e)?e.slice():_.extend({},e):e},_.tap=function(e,t){return t(e),e},_.isMatch=function(e,t){var n=_.keys(t),i=n.length;if(null==e)return!i;for(var o=Object(e),r=0;i>r;r++){var a=n[r];if(t[a]!==o[a]||!(a in o))return!1}return!0};var M=function(e,t,n,i){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof _&&(e=e._wrapped),t instanceof _&&(t=t._wrapped);var o=u.call(e);if(o!==u.call(t))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var r="[object Array]"===o;if(!r){if("object"!=typeof e||"object"!=typeof t)return!1;var a=e.constructor,s=t.constructor;if(a!==s&&!(_.isFunction(a)&&a instanceof a&&_.isFunction(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],i=i||[];for(var l=n.length;l--;)if(n[l]===e)return i[l]===t;if(n.push(e),i.push(t),r){if(l=e.length,l!==t.length)return!1;for(;l--;)if(!M(e[l],t[l],n,i))return!1}else{var d,c=_.keys(e);if(l=c.length,_.keys(t).length!==l)return!1;for(;l--;)if(d=c[l],!_.has(t,d)||!M(e[d],t[d],n,i))return!1}return n.pop(),i.pop(),!0};_.isEqual=function(e,t){return M(e,t)},_.isEmpty=function(e){return null==e||(y(e)&&(_.isArray(e)||_.isString(e)||_.isArguments(e))?0===e.length:0===_.keys(e).length)},_.isElement=function(e){return!(!e||1!==e.nodeType)},_.isArray=h||function(e){return"[object Array]"===u.call(e)},_.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},_.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){_["is"+e]=function(t){return u.call(t)==="[object "+e+"]"}}),_.isArguments(arguments)||(_.isArguments=function(e){return _.has(e,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(_.isFunction=function(e){return"function"==typeof e||!1}),_.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},_.isNaN=function(e){return _.isNumber(e)&&e!==+e},_.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===u.call(e)},_.isNull=function(e){return null===e},_.isUndefined=function(e){return void 0===e},_.has=function(e,t){return null!=e&&p.call(e,t)},_.noConflict=function(){return o._=r,this},_.identity=function(e){return e},_.constant=function(e){return function(){return e}},_.noop=function(){},_.property=R,_.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},_.matcher=_.matches=function(e){return e=_.extendOwn({},e),function(t){return _.isMatch(t,e)}},_.times=function(e,t,n){var i=Array(Math.max(0,e));t=E(t,n,1);for(var o=0;e>o;o++)i[o]=t(o);return i},_.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},_.now=Date.now||function(){return(new Date).getTime()};var L={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},N=_.invert(L),U=function(e){var t=function(t){return e[t]},n="(?:"+_.keys(e).join("|")+")",i=RegExp(n),o=RegExp(n,"g");return function(e){return e=null==e?"":""+e,i.test(e)?e.replace(o,t):e}};_.escape=U(L),_.unescape=U(N),_.result=function(e,t,n){var i=null==e?void 0:e[t];return void 0===i&&(i=n),_.isFunction(i)?i.call(e):i};var x=0;_.uniqueId=function(e){var t=++x+"";return e?e+t:t},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var k=/(.)^/,F={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Y=/\\|'|\r|\n|\u2028|\u2029/g,B=function(e){return"\\"+F[e]};_.template=function(e,t,n){!t&&n&&(t=n),t=_.defaults({},t,_.templateSettings);var i=RegExp([(t.escape||k).source,(t.interpolate||k).source,(t.evaluate||k).source].join("|")+"|$","g"),o=0,r="__p+='";e.replace(i,function(t,n,i,a,s){return r+=e.slice(o,s).replace(Y,B),o=s+t.length,n?r+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?r+="'+\n((__t=("+i+"))==null?'':__t)+\n'":a&&(r+="';\n"+a+"\n__p+='"),t}),r+="';\n",t.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{var a=new Function(t.variable||"obj","_",r)}catch(e){throw e.source=r,e}var s=function(e){return a.call(this,e,_)},l=t.variable||"obj";return s.source="function("+l+"){\n"+r+"}",s},_.chain=function(e){var t=_(e);return t._chain=!0,t};var H=function(e,t){return e._chain?_(t).chain():t};_.mixin=function(e){_.each(_.functions(e),function(t){var n=_[t]=e[t];_.prototype[t]=function(){var e=[this._wrapped];return d.apply(e,arguments),H(this,n.apply(_,e))}})},_.mixin(_),_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=a[e];_.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],H(this,n)}}),_.each(["concat","join","slice"],function(e){var t=a[e];_.prototype[e]=function(){return H(this,t.apply(this._wrapped,arguments))}}),_.prototype.value=function(){return this._wrapped},_.prototype.valueOf=_.prototype.toJSON=_.prototype.value,_.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return _})}.call(this),function(e){function t(e,t,n){switch(arguments.length){case 2:return null!=e?e:t;case 3:return null!=e?e:null!=t?t:n;default:throw new Error("Implement me")}}function n(e,t){return De.call(e,t)}function i(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function o(e){Ee.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function r(e,t){var n=!0;return p(function(){return n&&(o(e),n=!1),t.apply(this,arguments)},t)}function a(e,t){gt[e]||(o(t),gt[e]=!0)}function s(e,t){return function(n){return m(e.call(this,n),t)}}function l(e,t){return function(n){return this.localeData().ordinal(e.call(this,n),t)}}function d(){}function c(e,t){t!==!1&&P(e),h(this,e),this._d=new Date(+e._d)}function u(e){var t=O(e),n=t.year||0,i=t.quarter||0,o=t.month||0,r=t.week||0,a=t.day||0,s=t.hour||0,l=t.minute||0,d=t.second||0,c=t.millisecond||0;this._milliseconds=+c+1e3*d+6e4*l+36e5*s,this._days=+a+7*r,this._months=+o+3*i+12*n,this._data={},this._locale=Ee.localeData(),this._bubble()}function p(e,t){for(var i in t)n(t,i)&&(e[i]=t[i]);return n(t,"toString")&&(e.toString=t.toString),n(t,"valueOf")&&(e.valueOf=t.valueOf),e}function h(e,t){var n,i,o;if("undefined"!=typeof t._isAMomentObject&&(e._isAMomentObject=t._isAMomentObject),"undefined"!=typeof t._i&&(e._i=t._i),"undefined"!=typeof t._f&&(e._f=t._f),"undefined"!=typeof t._l&&(e._l=t._l),"undefined"!=typeof t._strict&&(e._strict=t._strict),"undefined"!=typeof t._tzm&&(e._tzm=t._tzm),"undefined"!=typeof t._isUTC&&(e._isUTC=t._isUTC),"undefined"!=typeof t._offset&&(e._offset=t._offset),"undefined"!=typeof t._pf&&(e._pf=t._pf),"undefined"!=typeof t._locale&&(e._locale=t._locale),Ne.length>0)for(n in Ne)i=Ne[n],o=t[i],"undefined"!=typeof o&&(e[i]=o);return e}function f(e){return 0>e?Math.ceil(e):Math.floor(e)}function m(e,t,n){for(var i=""+Math.abs(e),o=e>=0;i.length<t;)i="0"+i;return(o?n?"+":"":"-")+i}function g(e,t){var n={milliseconds:0,months:0};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function T(e,t){var n;return t=x(t,e),e.isBefore(t)?n=g(e,t):(n=g(t,e),n.milliseconds=-n.milliseconds,n.months=-n.months),n}function _(e,t){return function(n,i){var o,r;return null===i||isNaN(+i)||(a(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period)."),r=n,n=i,i=r),n="string"==typeof n?+n:n,o=Ee.duration(n,i),E(this,o,e),this}}function E(e,t,n,i){var o=t._milliseconds,r=t._days,a=t._months;i=null==i||i,o&&e._d.setTime(+e._d+o*n),r&&he(e,"Date",pe(e,"Date")+r*n),a&&ue(e,pe(e,"Month")+a*n),i&&Ee.updateOffset(e,r||a)}function v(e){return"[object Array]"===Object.prototype.toString.call(e)}function S(e){return"[object Date]"===Object.prototype.toString.call(e)||e instanceof Date}function b(e,t,n){var i,o=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),a=0;for(i=0;o>i;i++)(n&&e[i]!==t[i]||!n&&y(e[i])!==y(t[i]))&&a++;return a+r}function R(e){if(e){var t=e.toLowerCase().replace(/(.)s$/,"$1");e=dt[e]||ct[t]||t}return e}function O(e){var t,i,o={};for(i in e)n(e,i)&&(t=R(i),t&&(o[t]=e[i]));return o}function D(t){var n,i;if(0===t.indexOf("week"))n=7,i="day";else{if(0!==t.indexOf("month"))return;n=12,i="month"}Ee[t]=function(o,r){var a,s,l=Ee._locale[t],d=[];if("number"==typeof o&&(r=o,o=e),s=function(e){var t=Ee().utc().set(i,e);return l.call(Ee._locale,t,o||"")},null!=r)return s(r);for(a=0;n>a;a++)d.push(s(a));return d}}function y(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=t>=0?Math.floor(t):Math.ceil(t)),n}function A(e,t){return new Date(Date.UTC(e,t+1,0)).getUTCDate()}function C(e,t,n){return se(Ee([e,11,31+t-n]),t,n).week}function I(e){return w(e)?366:365}function w(e){return e%4===0&&e%100!==0||e%400===0}function P(e){var t;e._a&&-2===e._pf.overflow&&(t=e._a[Ae]<0||e._a[Ae]>11?Ae:e._a[Ce]<1||e._a[Ce]>A(e._a[ye],e._a[Ae])?Ce:e._a[Ie]<0||e._a[Ie]>23?Ie:e._a[we]<0||e._a[we]>59?we:e._a[Pe]<0||e._a[Pe]>59?Pe:e._a[Me]<0||e._a[Me]>999?Me:-1,e._pf._overflowDayOfYear&&(ye>t||t>Ce)&&(t=Ce),e._pf.overflow=t)}function M(e){return null==e._isValid&&(e._isValid=!isNaN(e._d.getTime())&&e._pf.overflow<0&&!e._pf.empty&&!e._pf.invalidMonth&&!e._pf.nullInput&&!e._pf.invalidFormat&&!e._pf.userInvalidated,e._strict&&(e._isValid=e._isValid&&0===e._pf.charsLeftOver&&0===e._pf.unusedTokens.length)),e._isValid}function L(e){return e?e.toLowerCase().replace("_","-"):e}function N(e){for(var t,n,i,o,r=0;r<e.length;){for(o=L(e[r]).split("-"),t=o.length,n=L(e[r+1]),n=n?n.split("-"):null;t>0;){if(i=U(o.slice(0,t).join("-")))return i;if(n&&n.length>=t&&b(o,n,!0)>=t-1)break;t--}r++}return null}function U(e){var t=null;if(!Le[e]&&Ue)try{t=Ee.locale(),require("./locale/"+e),Ee.locale(t)}catch(e){}return Le[e]}function x(e,t){return t._isUTC?Ee(e).zone(t._offset||0):Ee(e).local()}function k(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function F(e){var t,n,i=e.match(Ye);for(t=0,n=i.length;n>t;t++)i[t]=mt[i[t]]?mt[i[t]]:k(i[t]);return function(o){var r="";for(t=0;n>t;t++)r+=i[t]instanceof Function?i[t].call(o,e):i[t];return r}}function Y(e,t){return e.isValid()?(t=B(t,e.localeData()),ut[t]||(ut[t]=F(t)),ut[t](e)):e.localeData().invalidDate()}function B(e,t){function n(e){return t.longDateFormat(e)||e}var i=5;for(Be.lastIndex=0;i>=0&&Be.test(e);)e=e.replace(Be,n),Be.lastIndex=0,i-=1;return e}function H(e,t){var n,i=t._strict;switch(e){case"Q":return $e;case"DDDD":return Qe;case"YYYY":case"GGGG":case"gggg":return i?et:Ve;case"Y":case"G":case"g":return nt;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return i?tt:Je;case"S":if(i)return $e;case"SS":if(i)return qe;case"SSS":if(i)return Qe;case"DDD":return We;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return ze;case"a":case"A":return t._locale._meridiemParse;case"X":return Xe;case"Z":case"ZZ":return Ze;case"T":return je;case"SSSS":return Ge;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return i?qe:He;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return He;case"Do":return Ke;default:return n=new RegExp(K(X(e.replace("\\","")),"i"))}}function W(e){e=e||"";var t=e.match(Ze)||[],n=t[t.length-1]||[],i=(n+"").match(st)||["-",0,0],o=+(60*i[1])+y(i[2]);return"+"===i[0]?-o:o}function V(e,t,n){var i,o=n._a;switch(e){case"Q":null!=t&&(o[Ae]=3*(y(t)-1));break;case"M":case"MM":null!=t&&(o[Ae]=y(t)-1);break;case"MMM":case"MMMM":i=n._locale.monthsParse(t),null!=i?o[Ae]=i:n._pf.invalidMonth=t;break;case"D":case"DD":null!=t&&(o[Ce]=y(t));break;case"Do":null!=t&&(o[Ce]=y(parseInt(t,10)));break;case"DDD":case"DDDD":null!=t&&(n._dayOfYear=y(t));break;case"YY":o[ye]=Ee.parseTwoDigitYear(t);break;case"YYYY":case"YYYYY":case"YYYYYY":o[ye]=y(t);break;case"a":case"A":n._isPm=n._locale.isPM(t);break;case"H":case"HH":case"h":case"hh":o[Ie]=y(t);break;case"m":case"mm":o[we]=y(t);break;case"s":case"ss":o[Pe]=y(t);break;case"S":case"SS":case"SSS":case"SSSS":o[Me]=y(1e3*("0."+t));break;case"X":n._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":n._useUTC=!0,n._tzm=W(t);break;case"dd":case"ddd":case"dddd":i=n._locale.weekdaysParse(t),null!=i?(n._w=n._w||{},n._w.d=i):n._pf.invalidWeekday=t;break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":e=e.substr(0,1);case"gggg":case"GGGG":case"GGGGG":e=e.substr(0,2),t&&(n._w=n._w||{},n._w[e]=y(t));break;case"gg":case"GG":n._w=n._w||{},n._w[e]=Ee.parseTwoDigitYear(t)}}function J(e){var n,i,o,r,a,s,l;n=e._w,null!=n.GG||null!=n.W||null!=n.E?(a=1,s=4,i=t(n.GG,e._a[ye],se(Ee(),1,4).year),o=t(n.W,1),r=t(n.E,1)):(a=e._locale._week.dow,s=e._locale._week.doy,i=t(n.gg,e._a[ye],se(Ee(),a,s).year),o=t(n.w,1),null!=n.d?(r=n.d,a>r&&++o):r=null!=n.e?n.e+a:a),l=le(i,o,r,s,a),e._a[ye]=l.year,e._dayOfYear=l.dayOfYear}function G(e){var n,i,o,r,a=[];if(!e._d){for(o=Z(e),e._w&&null==e._a[Ce]&&null==e._a[Ae]&&J(e),e._dayOfYear&&(r=t(e._a[ye],o[ye]),e._dayOfYear>I(r)&&(e._pf._overflowDayOfYear=!0),i=ie(r,0,e._dayOfYear),e._a[Ae]=i.getUTCMonth(),e._a[Ce]=i.getUTCDate()),n=0;3>n&&null==e._a[n];++n)e._a[n]=a[n]=o[n];for(;7>n;n++)e._a[n]=a[n]=null==e._a[n]?2===n?1:0:e._a[n];e._d=(e._useUTC?ie:ne).apply(null,a),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()+e._tzm)}}function z(e){var t;e._d||(t=O(e._i),e._a=[t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond],G(e))}function Z(e){var t=new Date;return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function j(e){if(e._f===Ee.ISO_8601)return void q(e);e._a=[],e._pf.empty=!0;var t,n,i,o,r,a=""+e._i,s=a.length,l=0;for(i=B(e._f,e._locale).match(Ye)||[],t=0;t<i.length;t++)o=i[t],n=(a.match(H(o,e))||[])[0],n&&(r=a.substr(0,a.indexOf(n)),r.length>0&&e._pf.unusedInput.push(r),a=a.slice(a.indexOf(n)+n.length),l+=n.length),mt[o]?(n?e._pf.empty=!1:e._pf.unusedTokens.push(o),V(o,n,e)):e._strict&&!n&&e._pf.unusedTokens.push(o);e._pf.charsLeftOver=s-l,a.length>0&&e._pf.unusedInput.push(a),e._isPm&&e._a[Ie]<12&&(e._a[Ie]+=12),e._isPm===!1&&12===e._a[Ie]&&(e._a[Ie]=0),G(e),P(e)}function X(e){return e.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,i,o){return t||n||i||o})}function K(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function $(e){var t,n,o,r,a;if(0===e._f.length)return e._pf.invalidFormat=!0,void(e._d=new Date(NaN));for(r=0;r<e._f.length;r++)a=0,t=h({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._pf=i(),t._f=e._f[r],j(t),M(t)&&(a+=t._pf.charsLeftOver,a+=10*t._pf.unusedTokens.length,t._pf.score=a,(null==o||o>a)&&(o=a,n=t));p(e,n||t)}function q(e){var t,n,i=e._i,o=it.exec(i);if(o){for(e._pf.iso=!0,t=0,n=rt.length;n>t;t++)if(rt[t][1].exec(i)){e._f=rt[t][0]+(o[6]||" ");break}for(t=0,n=at.length;n>t;t++)if(at[t][1].exec(i)){e._f+=at[t][0];break}i.match(Ze)&&(e._f+="Z"),j(e)}else e._isValid=!1}function Q(e){q(e),e._isValid===!1&&(delete e._isValid,Ee.createFromInputFallback(e))}function ee(e,t){var n,i=[];for(n=0;n<e.length;++n)i.push(t(e[n],n));return i}function te(t){var n,i=t._i;i===e?t._d=new Date:S(i)?t._d=new Date(+i):null!==(n=xe.exec(i))?t._d=new Date(+n[1]):"string"==typeof i?Q(t):v(i)?(t._a=ee(i.slice(0),function(e){return parseInt(e,10)}),G(t)):"object"==typeof i?z(t):"number"==typeof i?t._d=new Date(i):Ee.createFromInputFallback(t)}function ne(e,t,n,i,o,r,a){var s=new Date(e,t,n,i,o,r,a);return 1970>e&&s.setFullYear(e),s}function ie(e){var t=new Date(Date.UTC.apply(null,arguments));return 1970>e&&t.setUTCFullYear(e),t}function oe(e,t){if("string"==typeof e)if(isNaN(e)){if(e=t.weekdaysParse(e),"number"!=typeof e)return null}else e=parseInt(e,10);return e}function re(e,t,n,i,o){return o.relativeTime(t||1,!!n,e,i)}function ae(e,t,n){var i=Ee.duration(e).abs(),o=Oe(i.as("s")),r=Oe(i.as("m")),a=Oe(i.as("h")),s=Oe(i.as("d")),l=Oe(i.as("M")),d=Oe(i.as("y")),c=o<pt.s&&["s",o]||1===r&&["m"]||r<pt.m&&["mm",r]||1===a&&["h"]||a<pt.h&&["hh",a]||1===s&&["d"]||s<pt.d&&["dd",s]||1===l&&["M"]||l<pt.M&&["MM",l]||1===d&&["y"]||["yy",d];return c[2]=t,c[3]=+e>0,c[4]=n,re.apply({},c)}function se(e,t,n){var i,o=n-t,r=n-e.day();return r>o&&(r-=7),o-7>r&&(r+=7),i=Ee(e).add(r,"d"),{week:Math.ceil(i.dayOfYear()/7),year:i.year()}}function le(e,t,n,i,o){var r,a,s=ie(e,0,1).getUTCDay();return s=0===s?7:s,n=null!=n?n:o,r=o-s+(s>i?7:0)-(o>s?7:0),a=7*(t-1)+(n-o)+r+1,{year:a>0?e:e-1,dayOfYear:a>0?a:I(e-1)+a}}function de(t){var n=t._i,i=t._f;return t._locale=t._locale||Ee.localeData(t._l),null===n||i===e&&""===n?Ee.invalid({nullInput:!0}):("string"==typeof n&&(t._i=n=t._locale.preparse(n)),Ee.isMoment(n)?new c(n,!0):(i?v(i)?$(t):j(t):te(t),new c(t)))}function ce(e,t){var n,i;if(1===t.length&&v(t[0])&&(t=t[0]),!t.length)return Ee();for(n=t[0],i=1;i<t.length;++i)t[i][e](n)&&(n=t[i]);return n}function ue(e,t){var n;return"string"==typeof t&&(t=e.localeData().monthsParse(t),"number"!=typeof t)?e:(n=Math.min(e.date(),A(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e)}function pe(e,t){return e._d["get"+(e._isUTC?"UTC":"")+t]()}function he(e,t,n){return"Month"===t?ue(e,n):e._d["set"+(e._isUTC?"UTC":"")+t](n)}function fe(e,t){return function(n){return null!=n?(he(this,e,n),Ee.updateOffset(this,t),this):pe(this,e)}}function me(e){return 400*e/146097}function ge(e){return 146097*e/400}function Te(e){Ee.duration.fn[e]=function(){return this._data[e]}}function _e(e){"undefined"==typeof ender&&(ve=Re.moment,Re.moment=e?r("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",Ee):Ee)}for(var Ee,ve,Se,be="2.8.3",Re="undefined"!=typeof global?global:this,Oe=Math.round,De=Object.prototype.hasOwnProperty,ye=0,Ae=1,Ce=2,Ie=3,we=4,Pe=5,Me=6,Le={},Ne=[],Ue="undefined"!=typeof module&&module.exports,xe=/^\/?Date\((\-?\d+)/i,ke=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,Fe=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,Ye=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,Be=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,He=/\d\d?/,We=/\d{1,3}/,Ve=/\d{1,4}/,Je=/[+\-]?\d{1,6}/,Ge=/\d+/,ze=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Ze=/Z|[\+\-]\d\d:?\d\d/gi,je=/T/i,Xe=/[\+\-]?\d+(\.\d{1,3})?/,Ke=/\d{1,2}/,$e=/\d/,qe=/\d\d/,Qe=/\d{3}/,et=/\d{4}/,tt=/[+-]?\d{6}/,nt=/[+-]?\d+/,it=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,ot="YYYY-MM-DDTHH:mm:ssZ",rt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],at=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],st=/([\+\-]|\d\d)/gi,lt=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),dt={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},ct={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},ut={},pt={s:45,m:45,h:22,d:26,M:11},ht="DDD w W M D d".split(" "),ft="M D H h m s w W".split(" "),mt={M:function(){return this.month()+1},MMM:function(e){return this.localeData().monthsShort(this,e)},MMMM:function(e){return this.localeData().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.localeData().weekdaysMin(this,e)},ddd:function(e){return this.localeData().weekdaysShort(this,e)},dddd:function(e){return this.localeData().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return m(this.year()%100,2)},YYYY:function(){return m(this.year(),4)},YYYYY:function(){return m(this.year(),5)},YYYYYY:function(){var e=this.year(),t=e>=0?"+":"-";return t+m(Math.abs(e),6)},gg:function(){return m(this.weekYear()%100,2)},gggg:function(){return m(this.weekYear(),4)},ggggg:function(){return m(this.weekYear(),5)},GG:function(){return m(this.isoWeekYear()%100,2)},GGGG:function(){return m(this.isoWeekYear(),4)},GGGGG:function(){return m(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return y(this.milliseconds()/100)},SS:function(){return m(y(this.milliseconds()/10),2)},SSS:function(){return m(this.milliseconds(),3)},SSSS:function(){return m(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+m(y(e/60),2)+":"+m(y(e)%60,2)},ZZ:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+m(y(e/60),2)+m(y(e)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},gt={},Tt=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];ht.length;)Se=ht.pop(),mt[Se+"o"]=l(mt[Se],Se);for(;ft.length;)Se=ft.pop(),mt[Se+Se]=s(mt[Se],2);mt.DDDD=s(mt.DDD,3),p(d.prototype,{set:function(e){var t,n;for(n in e)t=e[n],"function"==typeof t?this[n]=t:this["_"+n]=t},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e){var t,n,i;for(this._monthsParse||(this._monthsParse=[]),t=0;12>t;t++)if(this._monthsParse[t]||(n=Ee.utc([2e3,t]),i="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[t]=new RegExp(i.replace(".",""),"i")),this._monthsParse[t].test(e))return t},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var t,n,i;for(this._weekdaysParse||(this._weekdaysParse=[]),t=0;7>t;t++)if(this._weekdaysParse[t]||(n=Ee([2e3,1]).day(t),i="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[t]=new RegExp(i.replace(".",""),"i")),this._weekdaysParse[t].test(e))return t},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return"p"===(e+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t){var n=this._calendar[e];return"function"==typeof n?n.apply(t):n},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,n,i){var o=this._relativeTime[n];return"function"==typeof o?o(e,t,n,i):o.replace(/%d/i,e)},pastFuture:function(e,t){var n=this._relativeTime[e>0?"future":"past"];return"function"==typeof n?n(t):n.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",preparse:function(e){return e},postformat:function(e){return e},week:function(e){return se(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),Ee=function(t,n,o,r){var a;return"boolean"==typeof o&&(r=o,o=e),a={},a._isAMomentObject=!0,a._i=t,a._f=n,a._l=o,a._strict=r,a._isUTC=!1,a._pf=i(),de(a)},Ee.suppressDeprecationWarnings=!1,Ee.createFromInputFallback=r("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(e){e._d=new Date(e._i)}),Ee.min=function(){var e=[].slice.call(arguments,0);return ce("isBefore",e)},Ee.max=function(){var e=[].slice.call(arguments,0);return ce("isAfter",e)},Ee.utc=function(t,n,o,r){var a;return"boolean"==typeof o&&(r=o,o=e),a={},a._isAMomentObject=!0,a._useUTC=!0,a._isUTC=!0,a._l=o,a._i=t,a._f=n,a._strict=r,a._pf=i(),de(a).utc()},Ee.unix=function(e){return Ee(1e3*e)},Ee.duration=function(e,t){var i,o,r,a,s=e,l=null;return Ee.isDuration(e)?s={ms:e._milliseconds,d:e._days,M:e._months}:"number"==typeof e?(s={},t?s[t]=e:s.milliseconds=e):(l=ke.exec(e))?(i="-"===l[1]?-1:1,s={y:0,d:y(l[Ce])*i,h:y(l[Ie])*i,m:y(l[we])*i,s:y(l[Pe])*i,ms:y(l[Me])*i}):(l=Fe.exec(e))?(i="-"===l[1]?-1:1,r=function(e){var t=e&&parseFloat(e.replace(",","."));return(isNaN(t)?0:t)*i},s={y:r(l[2]),M:r(l[3]),d:r(l[4]),h:r(l[5]),m:r(l[6]),s:r(l[7]),w:r(l[8])}):"object"==typeof s&&("from"in s||"to"in s)&&(a=T(Ee(s.from),Ee(s.to)),s={},s.ms=a.milliseconds,s.M=a.months),o=new u(s),Ee.isDuration(e)&&n(e,"_locale")&&(o._locale=e._locale),o},Ee.version=be,Ee.defaultFormat=ot,Ee.ISO_8601=function(){},Ee.momentProperties=Ne,Ee.updateOffset=function(){},Ee.relativeTimeThreshold=function(t,n){return pt[t]!==e&&(n===e?pt[t]:(pt[t]=n,!0))},Ee.lang=r("moment.lang is deprecated. Use moment.locale instead.",function(e,t){return Ee.locale(e,t)}),Ee.locale=function(e,t){var n;return e&&(n="undefined"!=typeof t?Ee.defineLocale(e,t):Ee.localeData(e),n&&(Ee.duration._locale=Ee._locale=n)),Ee._locale._abbr},Ee.defineLocale=function(e,t){return null!==t?(t.abbr=e,Le[e]||(Le[e]=new d),Le[e].set(t),Ee.locale(e),Le[e]):(delete Le[e],null)},Ee.langData=r("moment.langData is deprecated. Use moment.localeData instead.",function(e){return Ee.localeData(e)}),Ee.localeData=function(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return Ee._locale;if(!v(e)){if(t=U(e))return t;e=[e]}return N(e)},Ee.isMoment=function(e){return e instanceof c||null!=e&&n(e,"_isAMomentObject")},Ee.isDuration=function(e){return e instanceof u};for(Se=Tt.length-1;Se>=0;--Se)D(Tt[Se]);Ee.normalizeUnits=function(e){return R(e)},Ee.invalid=function(e){var t=Ee.utc(NaN);return null!=e?p(t._pf,e):t._pf.userInvalidated=!0,t},Ee.parseZone=function(){return Ee.apply(null,arguments).parseZone()},Ee.parseTwoDigitYear=function(e){return y(e)+(y(e)>68?1900:2e3)},p(Ee.fn=c.prototype,{clone:function(){return Ee(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var e=Ee(this).utc();return 0<e.year()&&e.year()<=9999?Y(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):Y(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return M(this)},isDSTShifted:function(){return!!this._a&&(this.isValid()&&b(this._a,(this._isUTC?Ee.utc(this._a):Ee(this._a)).toArray())>0)},parsingFlags:function(){return p({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(e){return this.zone(0,e)},local:function(e){return this._isUTC&&(this.zone(0,e),this._isUTC=!1,e&&this.add(this._dateTzOffset(),"m")),this},format:function(e){var t=Y(this,e||Ee.defaultFormat);return this.localeData().postformat(t)},add:_(1,"add"),subtract:_(-1,"subtract"),diff:function(e,t,n){var i,o,r,a=x(e,this),s=6e4*(this.zone()-a.zone());return t=R(t),"year"===t||"month"===t?(i=432e5*(this.daysInMonth()+a.daysInMonth()),o=12*(this.year()-a.year())+(this.month()-a.month()),r=this-Ee(this).startOf("month")-(a-Ee(a).startOf("month")),r-=6e4*(this.zone()-Ee(this).startOf("month").zone()-(a.zone()-Ee(a).startOf("month").zone())),o+=r/i,"year"===t&&(o/=12)):(i=this-a,o="second"===t?i/1e3:"minute"===t?i/6e4:"hour"===t?i/36e5:"day"===t?(i-s)/864e5:"week"===t?(i-s)/6048e5:i),n?o:f(o)},from:function(e,t){return Ee.duration({to:this,from:e}).locale(this.locale()).humanize(!t)},fromNow:function(e){return this.from(Ee(),e)},calendar:function(e){var t=e||Ee(),n=x(t,this).startOf("day"),i=this.diff(n,"days",!0),o=-6>i?"sameElse":-1>i?"lastWeek":0>i?"lastDay":1>i?"sameDay":2>i?"nextDay":7>i?"nextWeek":"sameElse";return this.format(this.localeData().calendar(o,this))},isLeapYear:function(){return w(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=oe(e,this.localeData()),this.add(e-t,"d")):t},month:fe("Month",!0),startOf:function(e){switch(e=R(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e?this.weekday(0):"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},endOf:function(e){return e=R(e),this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms")},isAfter:function(e,t){return t=R("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=Ee.isMoment(e)?e:Ee(e),+this>+e):+this.clone().startOf(t)>+Ee(e).startOf(t)},isBefore:function(e,t){return t=R("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=Ee.isMoment(e)?e:Ee(e),+e>+this):+this.clone().startOf(t)<+Ee(e).startOf(t)},isSame:function(e,t){return t=R(t||"millisecond"),"millisecond"===t?(e=Ee.isMoment(e)?e:Ee(e),+this===+e):+this.clone().startOf(t)===+x(e,this).startOf(t)},min:r("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(e){return e=Ee.apply(null,arguments),this>e?this:e}),max:r("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(e){return e=Ee.apply(null,arguments),e>this?this:e}),zone:function(e,t){var n,i=this._offset||0;return null==e?this._isUTC?i:this._dateTzOffset():("string"==typeof e&&(e=W(e)),Math.abs(e)<16&&(e*=60),!this._isUTC&&t&&(n=this._dateTzOffset()),this._offset=e,this._isUTC=!0,null!=n&&this.subtract(n,"m"),i!==e&&(!t||this._changeInProgress?E(this,Ee.duration(i-e,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,Ee.updateOffset(this,!0),this._changeInProgress=null)),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(e){return e=e?Ee(e).zone():0,(this.zone()-e)%60===0},daysInMonth:function(){return A(this.year(),this.month())},dayOfYear:function(e){var t=Oe((Ee(this).startOf("day")-Ee(this).startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},quarter:function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},weekYear:function(e){var t=se(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==e?t:this.add(e-t,"y")},isoWeekYear:function(e){var t=se(this,1,4).year;return null==e?t:this.add(e-t,"y")},week:function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},isoWeek:function(e){var t=se(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},weekday:function(e){var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},isoWeekday:function(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)},isoWeeksInYear:function(){return C(this.year(),1,4)},weeksInYear:function(){var e=this.localeData()._week;return C(this.year(),e.dow,e.doy)},get:function(e){return e=R(e),this[e]()},set:function(e,t){return e=R(e),"function"==typeof this[e]&&this[e](t),this},locale:function(t){var n;return t===e?this._locale._abbr:(n=Ee.localeData(t),null!=n&&(this._locale=n),this)},lang:r("moment().lang() is deprecated. Use moment().localeData() instead.",function(t){return t===e?this.localeData():this.locale(t)}),localeData:function(){return this._locale},_dateTzOffset:function(){return 15*Math.round(this._d.getTimezoneOffset()/15)}}),Ee.fn.millisecond=Ee.fn.milliseconds=fe("Milliseconds",!1),Ee.fn.second=Ee.fn.seconds=fe("Seconds",!1),Ee.fn.minute=Ee.fn.minutes=fe("Minutes",!1),Ee.fn.hour=Ee.fn.hours=fe("Hours",!0),Ee.fn.date=fe("Date",!0),Ee.fn.dates=r("dates accessor is deprecated. Use date instead.",fe("Date",!0)),Ee.fn.year=fe("FullYear",!0),Ee.fn.years=r("years accessor is deprecated. Use year instead.",fe("FullYear",!0)),Ee.fn.days=Ee.fn.day,Ee.fn.months=Ee.fn.month,Ee.fn.weeks=Ee.fn.week,Ee.fn.isoWeeks=Ee.fn.isoWeek,Ee.fn.quarters=Ee.fn.quarter,Ee.fn.toJSON=Ee.fn.toISOString,p(Ee.duration.fn=u.prototype,{_bubble:function(){var e,t,n,i=this._milliseconds,o=this._days,r=this._months,a=this._data,s=0;a.milliseconds=i%1e3,e=f(i/1e3),a.seconds=e%60,t=f(e/60),a.minutes=t%60,n=f(t/60),a.hours=n%24,o+=f(n/24),s=f(me(o)),o-=f(ge(s)),r+=f(o/30),o%=30,s+=f(r/12),r%=12,a.days=o,a.months=r,a.years=s},abs:function(){return this._milliseconds=Math.abs(this._milliseconds),this._days=Math.abs(this._days),this._months=Math.abs(this._months),this._data.milliseconds=Math.abs(this._data.milliseconds),this._data.seconds=Math.abs(this._data.seconds),this._data.minutes=Math.abs(this._data.minutes),this._data.hours=Math.abs(this._data.hours),this._data.months=Math.abs(this._data.months),this._data.years=Math.abs(this._data.years),this},weeks:function(){return f(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*y(this._months/12)},humanize:function(e){var t=ae(this,!e,this.localeData());return e&&(t=this.localeData().pastFuture(+this,t)),this.localeData().postformat(t)},add:function(e,t){var n=Ee.duration(e,t);return this._milliseconds+=n._milliseconds,this._days+=n._days,this._months+=n._months,this._bubble(),this},subtract:function(e,t){var n=Ee.duration(e,t);return this._milliseconds-=n._milliseconds,this._days-=n._days,this._months-=n._months,this._bubble(),this},get:function(e){return e=R(e),this[e.toLowerCase()+"s"]()},as:function(e){var t,n;if(e=R(e),"month"===e||"year"===e)return t=this._days+this._milliseconds/864e5,n=this._months+12*me(t),"month"===e?n:n/12;switch(t=this._days+ge(this._months/12),e){case"week":return t/7+this._milliseconds/6048e5;case"day":return t+this._milliseconds/864e5;case"hour":return 24*t+this._milliseconds/36e5;case"minute":return 24*t*60+this._milliseconds/6e4;case"second":return 24*t*60*60+this._milliseconds/1e3;case"millisecond":return Math.floor(24*t*60*60*1e3)+this._milliseconds;default:throw new Error("Unknown unit "+e)}},lang:Ee.fn.lang,locale:Ee.fn.locale,toIsoString:r("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",function(){return this.toISOString()}),toISOString:function(){var e=Math.abs(this.years()),t=Math.abs(this.months()),n=Math.abs(this.days()),i=Math.abs(this.hours()),o=Math.abs(this.minutes()),r=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(e?e+"Y":"")+(t?t+"M":"")+(n?n+"D":"")+(i||o||r?"T":"")+(i?i+"H":"")+(o?o+"M":"")+(r?r+"S":""):"P0D"},localeData:function(){return this._locale}}),Ee.duration.fn.toString=Ee.duration.fn.toISOString;for(Se in lt)n(lt,Se)&&Te(Se.toLowerCase());Ee.duration.fn.asMilliseconds=function(){return this.as("ms")},Ee.duration.fn.asSeconds=function(){return this.as("s")},Ee.duration.fn.asMinutes=function(){return this.as("m")},Ee.duration.fn.asHours=function(){return this.as("h")},Ee.duration.fn.asDays=function(){return this.as("d")},Ee.duration.fn.asWeeks=function(){return this.as("weeks")},Ee.duration.fn.asMonths=function(){return this.as("M")},Ee.duration.fn.asYears=function(){return this.as("y")},Ee.locale("en",{ordinal:function(e){var t=e%10,n=1===y(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n}}),function(e){e(Ee)}(function(e){return e.defineLocale("af",{months:"Januarie_Februarie_Maart_April_Mei_Junie_Julie_Augustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Aug_Sep_Okt_Nov_Des".split("_"),weekdays:"Sondag_Maandag_Dinsdag_Woensdag_Donderdag_Vrydag_Saterdag".split("_"),weekdaysShort:"Son_Maa_Din_Woe_Don_Vry_Sat".split("_"),weekdaysMin:"So_Ma_Di_Wo_Do_Vr_Sa".split("_"),meridiem:function(e,t,n){return 12>e?n?"vm":"VM":n?"nm":"NM"},longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Vandag om] LT",nextDay:"[Mre om] LT",nextWeek:"dddd [om] LT",lastDay:"[Gister om] LT",lastWeek:"[Laas] dddd [om] LT",sameElse:"L"},relativeTime:{future:"oor %s",past:"%s gelede",s:"'n paar sekondes",m:"'n minuut",mm:"%d minute",h:"'n uur",hh:"%d ure",d:"'n dag",dd:"%d dae",M:"'n maand",MM:"%d maande",y:"'n jaar",yy:"%d jaar"},ordinal:function(e){return e+(1===e||8===e||e>=20?"ste":"de")},week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("ar-ma",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:6,doy:12}})}),function(e){e(Ee)}(function(e){var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},n={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};return e.defineLocale("ar-sa",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},meridiem:function(e){return 12>e?"":""},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},preparse:function(e){return e.replace(/[-]/g,function(e){return n[e]}).replace(//g,",")},postformat:function(e){return e.replace(/\d/g,function(e){return t[e]}).replace(/,/g,"")},week:{dow:6,doy:12}})}),function(e){e(Ee)}(function(e){var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},n={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"},i=function(e){return 0===e?0:1===e?1:2===e?2:e%100>=3&&10>=e%100?3:e%100>=11?4:5},o={s:["  "," ",["",""],"%d ","%d ","%d "],m:["  "," ",["",""],"%d ","%d ","%d "],h:["  "," ",["",""],"%d ","%d ","%d "],d:["  "," ",["",""],"%d ","%d ","%d "],M:["  "," ",["",""],"%d ","%d ","%d "],y:["  "," ",["",""],"%d ","%d ","%d "]},r=function(e){return function(t,n){var r=i(t),a=o[e][i(t)];return 2===r&&(a=a[n?0:1]),a.replace(/%d/i,t)}},a=["  "," "," "," "," "," "," "," "," ","  ","  ","  "];return e.defineLocale("ar",{months:a,monthsShort:a,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},meridiem:function(e){return 12>e?"":""},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:r("s"),m:r("m"),mm:r("m"),h:r("h"),hh:r("h"),d:r("d"),dd:r("d"),M:r("M"),MM:r("M"),y:r("y"),yy:r("y")},preparse:function(e){return e.replace(/[-]/g,function(e){return n[e]}).replace(//g,",")},postformat:function(e){return e.replace(/\d/g,function(e){return t[e]}).replace(/,/g,"")},week:{dow:6,doy:12}})}),function(e){e(Ee)}(function(e){var t={1:"-inci",5:"-inci",8:"-inci",70:"-inci",80:"-inci",2:"-nci",7:"-nci",20:"-nci",50:"-nci",3:"-nc",4:"-nc",100:"-nc",6:"-nc",9:"-uncu",10:"-uncu",30:"-uncu",60:"-nc",90:"-nc"};return e.defineLocale("az",{months:"yanvar_fevral_mart_aprel_may_iyun_iyul_avqust_sentyabr_oktyabr_noyabr_dekabr".split("_"),monthsShort:"yan_fev_mar_apr_may_iyn_iyl_avq_sen_okt_noy_dek".split("_"),weekdays:"Bazar_Bazar ertsi_rnb axam_rnb_Cm axam_Cm_nb".split("_"),weekdaysShort:"Baz_BzE_Ax_r_CAx_Cm_n".split("_"),weekdaysMin:"Bz_BE_A__CA_C_".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[bugn saat] LT",nextDay:"[sabah saat] LT",nextWeek:"[gln hft] dddd [saat] LT",lastDay:"[dnn] LT",lastWeek:"[ken hft] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s vvl",s:"birne saniyy",m:"bir dqiq",mm:"%d dqiq",h:"bir saat",hh:"%d saat",d:"bir gn",dd:"%d gn",M:"bir ay",MM:"%d ay",y:"bir il",yy:"%d il"},meridiem:function(e){return 4>e?"gec":12>e?"shr":17>e?"gndz":"axam"},ordinal:function(e){if(0===e)return e+"-nc";var n=e%10,i=e%100-n,o=e>=100?100:null;return e+(t[n]||t[i]||t[o])},week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){function t(e,t){var n=e.split("_");return t%10===1&&t%100!==11?n[0]:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?n[1]:n[2]}function n(e,n,i){var o={mm:n?"__":"__",hh:n?"__":"__",dd:"__",MM:"__",yy:"__"};return"m"===i?n?"":"":"h"===i?n?"":"":e+" "+t(o[i],+e)}function i(e,t){var n={nominative:"___________".split("_"),accusative:"___________".split("_")},i=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(t)?"accusative":"nominative";return n[i][e.month()]}function o(e,t){var n={nominative:"______".split("_"),accusative:"______".split("_")},i=/\[ ?[] ?(?:|)? ?\] ?dddd/.test(t)?"accusative":"nominative";return n[i][e.day()]}return e.defineLocale("be",{months:i,monthsShort:"___________".split("_"),weekdays:o,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., LT",LLLL:"dddd, D MMMM YYYY ., LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",lastDay:"[ ] LT",nextWeek:function(){return"[] dddd [] LT"},lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return"[ ] dddd [] LT";case 1:case 2:case 4:return"[ ] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:n,mm:n,h:n,hh:n,d:"",dd:n,M:"",MM:n,y:"",yy:n},meridiem:function(e){return 4>e?"":12>e?"":17>e?"":""},ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":case"w":case"W":return e%10!==2&&e%10!==3||e%100===12||e%100===13?e+"-":e+"-";case"D":return e+"-";default:return e}},week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){return e.defineLocale("bg",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"H:mm",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[ ] dddd [] LT";case 1:case 2:case 4:case 5:return"[ ] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},ordinal:function(e){var t=e%10,n=e%100;return 0===e?e+"-":0===n?e+"-":n>10&&20>n?e+"-":1===t?e+"-":2===t?e+"-":7===t||8===t?e+"-":e+"-"},week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},n={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};return e.defineLocale("bn",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(e){return e.replace(/[]/g,function(e){return n[e]})},postformat:function(e){return e.replace(/\d/g,function(e){return t[e]})},meridiem:function(e){return 4>e?"":10>e?"":17>e?"":20>e?"":""},week:{dow:0,doy:6}})}),function(e){e(Ee)}(function(e){var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},n={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};return e.defineLocale("bo",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[], LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},preparse:function(e){return e.replace(/[]/g,function(e){return n[e]})},postformat:function(e){return e.replace(/\d/g,function(e){return t[e]})},meridiem:function(e){return 4>e?"":10>e?"":17>e?"":20>e?"":""},week:{dow:0,doy:6}})}),function(e){e(Ee)}(function(t){function n(e,t,n){var i={mm:"munutenn",MM:"miz",dd:"devezh"};return e+" "+r(i[n],e)}function i(e){switch(o(e)){case 1:case 3:case 4:case 5:case 9:return e+" bloaz";default:return e+" vloaz"}}function o(e){return e>9?o(e%10):e}function r(e,t){return 2===t?a(e):e}function a(t){var n={m:"v",b:"v",d:"z"};return n[t.charAt(0)]===e?t:n[t.charAt(0)]+t.substring(1)}return t.defineLocale("br",{months:"Genver_C'hwevrer_Meurzh_Ebrel_Mae_Mezheven_Gouere_Eost_Gwengolo_Here_Du_Kerzu".split("_"),monthsShort:"Gen_C'hwe_Meu_Ebr_Mae_Eve_Gou_Eos_Gwe_Her_Du_Ker".split("_"),weekdays:"Sul_Lun_Meurzh_Merc'her_Yaou_Gwener_Sadorn".split("_"),weekdaysShort:"Sul_Lun_Meu_Mer_Yao_Gwe_Sad".split("_"),weekdaysMin:"Su_Lu_Me_Mer_Ya_Gw_Sa".split("_"),longDateFormat:{LT:"h[e]mm A",L:"DD/MM/YYYY",LL:"D [a viz] MMMM YYYY",LLL:"D [a viz] MMMM YYYY LT",LLLL:"dddd, D [a viz] MMMM YYYY LT"},calendar:{sameDay:"[Hiziv da] LT",nextDay:"[Warc'hoazh da] LT",nextWeek:"dddd [da] LT",lastDay:"[Dec'h da] LT",lastWeek:"dddd [paset da] LT",sameElse:"L"},relativeTime:{future:"a-benn %s",past:"%s 'zo",s:"un nebeud segondenno",m:"ur vunutenn",mm:n,h:"un eur",hh:"%d eur",d:"un devezh",dd:n,M:"ur miz",MM:n,y:"ur bloaz",yy:i},ordinal:function(e){var t=1===e?"a":"vet";return e+t},week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){function t(e,t,n){var i=e+" ";switch(n){case"m":return t?"jedna minuta":"jedne minute";case"mm":return i+=1===e?"minuta":2===e||3===e||4===e?"minute":"minuta";case"h":return t?"jedan sat":"jednog sata";case"hh":return i+=1===e?"sat":2===e||3===e||4===e?"sata":"sati";case"dd":return i+=1===e?"dan":"dana";case"MM":return i+=1===e?"mjesec":2===e||3===e||4===e?"mjeseca":"mjeseci";case"yy":return i+=1===e?"godina":2===e||3===e||4===e?"godine":"godina"}}return e.defineLocale("bs",{months:"januar_februar_mart_april_maj_juni_juli_avgust_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._avg._sep._okt._nov._dec.".split("_"),weekdays:"nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),longDateFormat:{LT:"H:mm",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[juer u] LT",lastWeek:function(){switch(this.day()){case 0:case 3:return"[prolu] dddd [u] LT";case 6:return"[prole] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[proli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",m:t,mm:t,h:t,hh:t,d:"dan",dd:t,M:"mjesec",MM:t,y:"godinu",yy:t},ordinal:"%d.",week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){return e.defineLocale("ca",{months:"gener_febrer_mar_abril_maig_juny_juliol_agost_setembre_octubre_novembre_desembre".split("_"),monthsShort:"gen._febr._mar._abr._mai._jun._jul._ag._set._oct._nov._des.".split("_"),weekdays:"diumenge_dilluns_dimarts_dimecres_dijous_divendres_dissabte".split("_"),weekdaysShort:"dg._dl._dt._dc._dj._dv._ds.".split("_"),weekdaysMin:"Dg_Dl_Dt_Dc_Dj_Dv_Ds".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:function(){return"[avui a "+(1!==this.hours()?"les":"la")+"] LT"},nextDay:function(){return"[dem a "+(1!==this.hours()?"les":"la")+"] LT"},nextWeek:function(){return"dddd [a "+(1!==this.hours()?"les":"la")+"] LT"},lastDay:function(){return"[ahir a "+(1!==this.hours()?"les":"la")+"] LT"},lastWeek:function(){return"[el] dddd [passat a "+(1!==this.hours()?"les":"la")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"fa %s",s:"uns segons",m:"un minut",mm:"%d minuts",h:"una hora",hh:"%d hores",d:"un dia",dd:"%d dies",M:"un mes",MM:"%d mesos",y:"un any",yy:"%d anys"},ordinal:"%d",week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){function t(e){return e>1&&5>e&&1!==~~(e/10)}function n(e,n,i,o){var r=e+" ";switch(i){case"s":return n||o?"pr sekund":"pr sekundami";case"m":return n?"minuta":o?"minutu":"minutou";case"mm":return n||o?r+(t(e)?"minuty":"minut"):r+"minutami";case"h":return n?"hodina":o?"hodinu":"hodinou";case"hh":return n||o?r+(t(e)?"hodiny":"hodin"):r+"hodinami";case"d":return n||o?"den":"dnem";case"dd":return n||o?r+(t(e)?"dny":"dn"):r+"dny";case"M":return n||o?"msc":"mscem";case"MM":return n||o?r+(t(e)?"msce":"msc"):r+"msci";case"y":return n||o?"rok":"rokem";case"yy":return n||o?r+(t(e)?"roky":"let"):r+"lety"}}var i="leden_nor_bezen_duben_kvten_erven_ervenec_srpen_z_jen_listopad_prosinec".split("_"),o="led_no_be_dub_kv_vn_vc_srp_z_j_lis_pro".split("_");return e.defineLocale("cs",{months:i,monthsShort:o,monthsParse:function(e,t){var n,i=[];for(n=0;12>n;n++)i[n]=new RegExp("^"+e[n]+"$|^"+t[n]+"$","i");return i}(i,o),weekdays:"nedle_pondl_ter_steda_tvrtek_ptek_sobota".split("_"),weekdaysShort:"ne_po_t_st_t_p_so".split("_"),weekdaysMin:"ne_po_t_st_t_p_so".split("_"),longDateFormat:{LT:"H:mm",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd D. MMMM YYYY LT"},calendar:{sameDay:"[dnes v] LT",nextDay:"[ztra v] LT",nextWeek:function(){switch(this.day()){case 0:return"[v nedli v] LT";case 1:case 2:return"[v] dddd [v] LT";case 3:return"[ve stedu v] LT";case 4:return"[ve tvrtek v] LT";case 5:return"[v ptek v] LT";case 6:return"[v sobotu v] LT"}},lastDay:"[vera v] LT",lastWeek:function(){switch(this.day()){case 0:return"[minulou nedli v] LT";case 1:case 2:return"[minul] dddd [v] LT";case 3:return"[minulou stedu v] LT";case 4:case 5:return"[minul] dddd [v] LT";case 6:return"[minulou sobotu v] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"ped %s",s:n,m:n,mm:n,h:n,hh:n,d:n,dd:n,M:n,MM:n,y:n,yy:n},ordinal:"%d.",week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("cv",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD-MM-YYYY",LL:"YYYY [] MMMM [] D[-]",LLL:"YYYY [] MMMM [] D[-], LT",LLLL:"dddd, YYYY [] MMMM [] D[-], LT"},calendar:{sameDay:"[] LT []",nextDay:"[] LT []",lastDay:"[] LT []",nextWeek:"[] dddd LT []",lastWeek:"[] dddd LT []",sameElse:"L"},relativeTime:{future:function(e){var t=/$/i.exec(e)?"":/$/i.exec(e)?"":"";return e+t},past:"%s ",s:"- ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},ordinal:"%d-",week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){return e.defineLocale("cy",{months:"Ionawr_Chwefror_Mawrth_Ebrill_Mai_Mehefin_Gorffennaf_Awst_Medi_Hydref_Tachwedd_Rhagfyr".split("_"),monthsShort:"Ion_Chwe_Maw_Ebr_Mai_Meh_Gor_Aws_Med_Hyd_Tach_Rhag".split("_"),weekdays:"Dydd Sul_Dydd Llun_Dydd Mawrth_Dydd Mercher_Dydd Iau_Dydd Gwener_Dydd Sadwrn".split("_"),weekdaysShort:"Sul_Llun_Maw_Mer_Iau_Gwe_Sad".split("_"),weekdaysMin:"Su_Ll_Ma_Me_Ia_Gw_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Heddiw am] LT",nextDay:"[Yfory am] LT",nextWeek:"dddd [am] LT",lastDay:"[Ddoe am] LT",lastWeek:"dddd [diwethaf am] LT",sameElse:"L"},relativeTime:{future:"mewn %s",past:"%s yn l",s:"ychydig eiliadau",m:"munud",mm:"%d munud",h:"awr",hh:"%d awr",d:"diwrnod",dd:"%d diwrnod",M:"mis",MM:"%d mis",y:"blwyddyn",yy:"%d flynedd"},ordinal:function(e){var t=e,n="",i=["","af","il","ydd","ydd","ed","ed","ed","fed","fed","fed","eg","fed","eg","eg","fed","eg","eg","fed","eg","fed"];return t>20?n=40===t||50===t||60===t||80===t||100===t?"fed":"ain":t>0&&(n=i[t]),e+n},week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("da",{months:"januar_februar_marts_april_maj_juni_juli_august_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"sndag_mandag_tirsdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"sn_man_tir_ons_tor_fre_lr".split("_"),weekdaysMin:"s_ma_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd [d.] D. MMMM YYYY LT"},calendar:{sameDay:"[I dag kl.] LT",nextDay:"[I morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[I gr kl.] LT",lastWeek:"[sidste] dddd [kl] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"f sekunder",m:"et minut",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dage",M:"en mned",MM:"%d mneder",y:"et r",yy:"%d r"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){function t(e,t,n){var i={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return t?i[n][0]:i[n][1]}return e.defineLocale("de-at",{months:"Jnner_Februar_Mrz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jn._Febr._Mrz._Apr._Mai_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm [Uhr]",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Heute um] LT",sameElse:"L",nextDay:"[Morgen um] LT",nextWeek:"dddd [um] LT",lastDay:"[Gestern um] LT",lastWeek:"[letzten] dddd [um] LT"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",m:t,mm:"%d Minuten",h:t,hh:"%d Stunden",d:t,dd:t,M:t,MM:t,y:t,yy:t},ordinal:"%d.",week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){function t(e,t,n){var i={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return t?i[n][0]:i[n][1]}return e.defineLocale("de",{months:"Januar_Februar_Mrz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Apr._Mai_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm [Uhr]",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Heute um] LT",sameElse:"L",nextDay:"[Morgen um] LT",nextWeek:"dddd [um] LT",lastDay:"[Gestern um] LT",lastWeek:"[letzten] dddd [um] LT"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",m:t,mm:"%d Minuten",h:t,hh:"%d Stunden",d:t,dd:t,M:t,MM:t,y:t,yy:t},ordinal:"%d.",week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("el",{monthsNominativeEl:"___________".split("_"),monthsGenitiveEl:"___________".split("_"),months:function(e,t){return/D/.test(t.substring(0,t.indexOf("MMMM")))?this._monthsGenitiveEl[e.month()]:this._monthsNominativeEl[e.month()]},monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),meridiem:function(e,t,n){return e>11?n?"":"":n?"":""},isPM:function(e){return""===(e+"").toLowerCase()[0]},meridiemParse:/[]\.??\.?/i,longDateFormat:{LT:"h:mm A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendarEl:{sameDay:"[ {}] LT",nextDay:"[ {}] LT",nextWeek:"dddd [{}] LT",lastDay:"[ {}] LT",lastWeek:function(){switch(this.day()){case 6:return"[ ] dddd [{}] LT";default:return"[ ] dddd [{}] LT"}},sameElse:"L"},calendar:function(e,t){var n=this._calendarEl[e],i=t&&t.hours();return"function"==typeof n&&(n=n.apply(t)),n.replace("{}",i%12===1?"":"")},relativeTime:{future:" %s",past:"%s ",s:"",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},ordinal:function(e){return e+""},week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("en-au",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(e){var t=e%10,n=1===~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n},week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("en-ca",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"YYYY-MM-DD",LL:"D MMMM, YYYY",LLL:"D MMMM, YYYY LT",LLLL:"dddd, D MMMM, YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(e){var t=e%10,n=1===~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n}})}),function(e){e(Ee)}(function(e){return e.defineLocale("en-gb",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(e){var t=e%10,n=1===~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n},week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("eo",{months:"januaro_februaro_marto_aprilo_majo_junio_julio_agusto_septembro_oktobro_novembro_decembro".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_ag_sep_okt_nov_dec".split("_"),weekdays:"Dimano_Lundo_Mardo_Merkredo_ado_Vendredo_Sabato".split("_"),weekdaysShort:"Dim_Lun_Mard_Merk_a_Ven_Sab".split("_"),weekdaysMin:"Di_Lu_Ma_Me_a_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"D[-an de] MMMM, YYYY",LLL:"D[-an de] MMMM, YYYY LT",LLLL:"dddd, [la] D[-an de] MMMM, YYYY LT"},meridiem:function(e,t,n){return e>11?n?"p.t.m.":"P.T.M.":n?"a.t.m.":"A.T.M."},calendar:{sameDay:"[Hodia je] LT",nextDay:"[Morga je] LT",nextWeek:"dddd [je] LT",lastDay:"[Hiera je] LT",lastWeek:"[pasinta] dddd [je] LT",sameElse:"L"},relativeTime:{future:"je %s",past:"anta %s",s:"sekundoj",m:"minuto",mm:"%d minutoj",h:"horo",hh:"%d horoj",d:"tago",dd:"%d tagoj",M:"monato",MM:"%d monatoj",y:"jaro",yy:"%d jaroj"},ordinal:"%da",week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){var t="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),n="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_");return e.defineLocale("es",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(e,i){return/-MMM-/.test(i)?n[e.month()]:t[e.month()]},weekdays:"domingo_lunes_martes_mircoles_jueves_viernes_sbado".split("_"),weekdaysShort:"dom._lun._mar._mi._jue._vie._sb.".split("_"),weekdaysMin:"Do_Lu_Ma_Mi_Ju_Vi_S".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY LT",LLLL:"dddd, D [de] MMMM [de] YYYY LT"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[maana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un da",dd:"%d das",M:"un mes",MM:"%d meses",y:"un ao",yy:"%d aos"},ordinal:"%d",week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){function t(e,t,n,i){var o={s:["mne sekundi","mni sekund","paar sekundit"],m:["he minuti","ks minut"],mm:[e+" minuti",e+" minutit"],h:["he tunni","tund aega","ks tund"],hh:[e+" tunni",e+" tundi"],d:["he peva","ks pev"],M:["kuu aja","kuu aega","ks kuu"],MM:[e+" kuu",e+" kuud"],y:["he aasta","aasta","ks aasta"],yy:[e+" aasta",e+" aastat"]};return t?o[n][2]?o[n][2]:o[n][1]:i?o[n][0]:o[n][1]}return e.defineLocale("et",{months:"jaanuar_veebruar_mrts_aprill_mai_juuni_juuli_august_september_oktoober_november_detsember".split("_"),monthsShort:"jaan_veebr_mrts_apr_mai_juuni_juuli_aug_sept_okt_nov_dets".split("_"),weekdays:"phapev_esmaspev_teisipev_kolmapev_neljapev_reede_laupev".split("_"),weekdaysShort:"P_E_T_K_N_R_L".split("_"),weekdaysMin:"P_E_T_K_N_R_L".split("_"),longDateFormat:{LT:"H:mm",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Tna,] LT",nextDay:"[Homme,] LT",nextWeek:"[Jrgmine] dddd LT",lastDay:"[Eile,] LT",lastWeek:"[Eelmine] dddd LT",sameElse:"L"},relativeTime:{future:"%s prast",past:"%s tagasi",s:t,m:t,mm:t,h:t,hh:t,d:t,dd:"%d peva",M:t,MM:t,y:t,yy:t},ordinal:"%d.",week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("eu",{months:"urtarrila_otsaila_martxoa_apirila_maiatza_ekaina_uztaila_abuztua_iraila_urria_azaroa_abendua".split("_"),monthsShort:"urt._ots._mar._api._mai._eka._uzt._abu._ira._urr._aza._abe.".split("_"),weekdays:"igandea_astelehena_asteartea_asteazkena_osteguna_ostirala_larunbata".split("_"),weekdaysShort:"ig._al._ar._az._og._ol._lr.".split("_"),weekdaysMin:"ig_al_ar_az_og_ol_lr".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"YYYY[ko] MMMM[ren] D[a]",LLL:"YYYY[ko] MMMM[ren] D[a] LT",LLLL:"dddd, YYYY[ko] MMMM[ren] D[a] LT",l:"YYYY-M-D",ll:"YYYY[ko] MMM D[a]",lll:"YYYY[ko] MMM D[a] LT",llll:"ddd, YYYY[ko] MMM D[a] LT"},calendar:{sameDay:"[gaur] LT[etan]",nextDay:"[bihar] LT[etan]",nextWeek:"dddd LT[etan]",lastDay:"[atzo] LT[etan]",lastWeek:"[aurreko] dddd LT[etan]",sameElse:"L"},relativeTime:{future:"%s barru",past:"duela %s",s:"segundo batzuk",m:"minutu bat",mm:"%d minutu",h:"ordu bat",hh:"%d ordu",d:"egun bat",dd:"%d egun",M:"hilabete bat",MM:"%d hilabete",y:"urte bat",yy:"%d urte"},ordinal:"%d.",week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},n={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};return e.defineLocale("fa",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},meridiem:function(e){return 12>e?"  ":"  "},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] [] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(e){return e.replace(/[-]/g,function(e){return n[e]}).replace(//g,",")},postformat:function(e){return e.replace(/\d/g,function(e){return t[e]}).replace(/,/g,"")},ordinal:"%d",week:{dow:6,doy:12}})}),function(e){e(Ee)}(function(e){function t(e,t,i,o){var r="";switch(i){case"s":return o?"muutaman sekunnin":"muutama sekunti";case"m":return o?"minuutin":"minuutti";case"mm":r=o?"minuutin":"minuuttia";break;case"h":return o?"tunnin":"tunti";case"hh":r=o?"tunnin":"tuntia";break;case"d":return o?"pivn":"piv";case"dd":r=o?"pivn":"piv";break;case"M":return o?"kuukauden":"kuukausi";case"MM":r=o?"kuukauden":"kuukautta";break;case"y":return o?"vuoden":"vuosi";case"yy":r=o?"vuoden":"vuotta"}return r=n(e,o)+" "+r}function n(e,t){return 10>e?t?o[e]:i[e]:e}var i="nolla yksi kaksi kolme nelj viisi kuusi seitsemn kahdeksan yhdeksn".split(" "),o=["nolla","yhden","kahden","kolmen","neljn","viiden","kuuden",i[7],i[8],i[9]];return e.defineLocale("fi",{months:"tammikuu_helmikuu_maaliskuu_huhtikuu_toukokuu_keskuu_heinkuu_elokuu_syyskuu_lokakuu_marraskuu_joulukuu".split("_"),monthsShort:"tammi_helmi_maalis_huhti_touko_kes_hein_elo_syys_loka_marras_joulu".split("_"),weekdays:"sunnuntai_maanantai_tiistai_keskiviikko_torstai_perjantai_lauantai".split("_"),weekdaysShort:"su_ma_ti_ke_to_pe_la".split("_"),weekdaysMin:"su_ma_ti_ke_to_pe_la".split("_"),longDateFormat:{LT:"HH.mm",L:"DD.MM.YYYY",LL:"Do MMMM[ta] YYYY",LLL:"Do MMMM[ta] YYYY, [klo] LT",LLLL:"dddd, Do MMMM[ta] YYYY, [klo] LT",l:"D.M.YYYY",ll:"Do MMM YYYY",lll:"Do MMM YYYY, [klo] LT",llll:"ddd, Do MMM YYYY, [klo] LT"},calendar:{sameDay:"[tnn] [klo] LT",nextDay:"[huomenna] [klo] LT",nextWeek:"dddd [klo] LT",lastDay:"[eilen] [klo] LT",lastWeek:"[viime] dddd[na] [klo] LT",sameElse:"L"},relativeTime:{future:"%s pst",past:"%s sitten",s:t,m:t,mm:t,h:t,hh:t,d:t,dd:t,M:t,MM:t,y:t,yy:t},ordinal:"%d.",week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("fo",{months:"januar_februar_mars_aprl_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sunnudagur_mnadagur_tsdagur_mikudagur_hsdagur_frggjadagur_leygardagur".split("_"),weekdaysShort:"sun_mn_ts_mik_hs_fr_ley".split("_"),weekdaysMin:"su_m_t_mi_h_fr_le".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D. MMMM, YYYY LT"},calendar:{sameDay:"[ dag kl.] LT",nextDay:"[ morgin kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[ gjr kl.] LT",lastWeek:"[sstu] dddd [kl] LT",sameElse:"L"},relativeTime:{future:"um %s",past:"%s sani",s:"f sekund",m:"ein minutt",mm:"%d minuttir",h:"ein tmi",hh:"%d tmar",d:"ein dagur",dd:"%d dagar",M:"ein mnai",MM:"%d mnair",y:"eitt r",yy:"%d r"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("fr-ca",{months:"janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),monthsShort:"janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Aujourd'hui ] LT",nextDay:"[Demain ] LT",nextWeek:"dddd [] LT",lastDay:"[Hier ] LT",lastWeek:"dddd [dernier ] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},ordinal:function(e){return e+(1===e?"er":"")}})}),function(e){e(Ee)}(function(e){return e.defineLocale("fr",{months:"janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),monthsShort:"janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Aujourd'hui ] LT",nextDay:"[Demain ] LT",nextWeek:"dddd [] LT",lastDay:"[Hier ] LT",lastWeek:"dddd [dernier ] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},ordinal:function(e){return e+(1===e?"er":"")},week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("gl",{months:"Xaneiro_Febreiro_Marzo_Abril_Maio_Xuo_Xullo_Agosto_Setembro_Outubro_Novembro_Decembro".split("_"),monthsShort:"Xan._Feb._Mar._Abr._Mai._Xu._Xul._Ago._Set._Out._Nov._Dec.".split("_"),weekdays:"Domingo_Luns_Martes_Mrcores_Xoves_Venres_Sbado".split("_"),weekdaysShort:"Dom._Lun._Mar._Mr._Xov._Ven._Sb.".split("_"),weekdaysMin:"Do_Lu_Ma_M_Xo_Ve_S".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:function(){return"[hoxe "+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[ma "+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd ["+(1!==this.hours()?"s":"a")+"] LT"},lastDay:function(){return"[onte "+(1!==this.hours()?"":"a")+"] LT"},lastWeek:function(){return"[o] dddd [pasado "+(1!==this.hours()?"s":"a")+"] LT"},sameElse:"L"},relativeTime:{future:function(e){return"uns segundos"===e?"nuns segundos":"en "+e},past:"hai %s",s:"uns segundos",m:"un minuto",mm:"%d minutos",h:"unha hora",hh:"%d horas",d:"un da",dd:"%d das",M:"un mes",MM:"%d meses",y:"un ano",yy:"%d anos"},ordinal:"%d",week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){return e.defineLocale("he",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D []MMMM YYYY",LLL:"D []MMMM YYYY LT",LLLL:"dddd, D []MMMM YYYY LT",l:"D/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY LT",llll:"ddd, D MMM YYYY LT"},calendar:{sameDay:"[ ]LT",nextDay:"[ ]LT",nextWeek:"dddd [] LT",lastDay:"[ ]LT",lastWeek:"[] dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",m:"",mm:"%d ",h:"",hh:function(e){return 2===e?"":e+" "},d:"",dd:function(e){return 2===e?"":e+" "},M:"",MM:function(e){return 2===e?"":e+" "},y:"",yy:function(e){return 2===e?"":e+" "}}})}),function(e){e(Ee)}(function(e){var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},n={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};return e.defineLocale("hi",{months:"___________".split("_"),monthsShort:"._.__.___._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"  ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(e){return e.replace(/[]/g,function(e){return n[e]})},postformat:function(e){return e.replace(/\d/g,function(e){return t[e]})},meridiem:function(e){return 4>e?"":10>e?"":17>e?"":20>e?"":""},week:{dow:0,doy:6}})}),function(e){e(Ee)}(function(e){function t(e,t,n){var i=e+" ";switch(n){case"m":return t?"jedna minuta":"jedne minute";case"mm":return i+=1===e?"minuta":2===e||3===e||4===e?"minute":"minuta";case"h":return t?"jedan sat":"jednog sata";case"hh":return i+=1===e?"sat":2===e||3===e||4===e?"sata":"sati";case"dd":return i+=1===e?"dan":"dana";case"MM":return i+=1===e?"mjesec":2===e||3===e||4===e?"mjeseca":"mjeseci";case"yy":return i+=1===e?"godina":2===e||3===e||4===e?"godine":"godina"}}return e.defineLocale("hr",{months:"sjeanj_veljaa_oujak_travanj_svibanj_lipanj_srpanj_kolovoz_rujan_listopad_studeni_prosinac".split("_"),monthsShort:"sje._vel._ou._tra._svi._lip._srp._kol._ruj._lis._stu._pro.".split("_"),weekdays:"nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),longDateFormat:{LT:"H:mm",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[juer u] LT",lastWeek:function(){switch(this.day()){case 0:case 3:return"[prolu] dddd [u] LT";case 6:return"[prole] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[proli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",m:t,mm:t,h:t,hh:t,d:"dan",dd:t,M:"mjesec",MM:t,y:"godinu",yy:t},ordinal:"%d.",week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){function t(e,t,n,i){var o=e;switch(n){case"s":return i||t?"nhny msodperc":"nhny msodperce";case"m":return"egy"+(i||t?" perc":" perce");case"mm":return o+(i||t?" perc":" perce");case"h":return"egy"+(i||t?" ra":" rja");case"hh":return o+(i||t?" ra":" rja");case"d":return"egy"+(i||t?" nap":" napja");case"dd":return o+(i||t?" nap":" napja");case"M":return"egy"+(i||t?" hnap":" hnapja");case"MM":return o+(i||t?" hnap":" hnapja");case"y":return"egy"+(i||t?" v":" ve");case"yy":return o+(i||t?" v":" ve")}return""}function n(e){return(e?"":"[mlt] ")+"["+i[this.day()]+"] LT[-kor]"}var i="vasrnap htfn kedden szerdn cstrtkn pnteken szombaton".split(" ");return e.defineLocale("hu",{months:"janur_februr_mrcius_prilis_mjus_jnius_jlius_augusztus_szeptember_oktber_november_december".split("_"),monthsShort:"jan_feb_mrc_pr_mj_jn_jl_aug_szept_okt_nov_dec".split("_"),weekdays:"vasrnap_htf_kedd_szerda_cstrtk_pntek_szombat".split("_"),weekdaysShort:"vas_ht_kedd_sze_cst_pn_szo".split("_"),weekdaysMin:"v_h_k_sze_cs_p_szo".split("_"),longDateFormat:{LT:"H:mm",L:"YYYY.MM.DD.",LL:"YYYY. MMMM D.",LLL:"YYYY. MMMM D., LT",LLLL:"YYYY. MMMM D., dddd LT"},meridiem:function(e,t,n){return 12>e?n===!0?"de":"DE":n===!0?"du":"DU"},calendar:{sameDay:"[ma] LT[-kor]",nextDay:"[holnap] LT[-kor]",nextWeek:function(){return n.call(this,!0)},lastDay:"[tegnap] LT[-kor]",lastWeek:function(){return n.call(this,!1)},sameElse:"L"},relativeTime:{future:"%s mlva",past:"%s",s:t,m:t,mm:t,h:t,hh:t,d:t,dd:t,M:t,MM:t,y:t,yy:t},ordinal:"%d.",week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){function t(e,t){var n={nominative:"___________".split("_"),accusative:"___________".split("_")},i=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(t)?"accusative":"nominative";return n[i][e.month()]}function n(e){var t="___________".split("_");return t[e.month()]}function i(e){var t="______".split("_");return t[e.day()]}return e.defineLocale("hy-am",{months:t,monthsShort:n,weekdays:i,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., LT",LLLL:"dddd, D MMMM YYYY ., LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",lastDay:"[] LT",nextWeek:function(){return"dddd [ ] LT"},lastWeek:function(){return"[] dddd [ ] LT"},sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"  ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},meridiem:function(e){return 4>e?"":12>e?"":17>e?"":""},ordinal:function(e,t){switch(t){case"DDD":case"w":case"W":case"DDDo":return 1===e?e+"-":e+"-";default:return e}},week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){return e.defineLocale("id",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Ags_Sep_Okt_Nov_Des".split("_"),weekdays:"Minggu_Senin_Selasa_Rabu_Kamis_Jumat_Sabtu".split("_"),weekdaysShort:"Min_Sen_Sel_Rab_Kam_Jum_Sab".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] LT",LLLL:"dddd, D MMMM YYYY [pukul] LT"},meridiem:function(e){return 11>e?"pagi":15>e?"siang":19>e?"sore":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Besok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kemarin pukul] LT",lastWeek:"dddd [lalu pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lalu",s:"beberapa detik",m:"semenit",mm:"%d menit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){function t(e){return e%100===11||e%10!==1}function n(e,n,i,o){var r=e+" ";switch(i){case"s":return n||o?"nokkrar sekndur":"nokkrum sekndum";case"m":return n?"mnta":"mntu";case"mm":return t(e)?r+(n||o?"mntur":"mntum"):n?r+"mnta":r+"mntu";case"hh":return t(e)?r+(n||o?"klukkustundir":"klukkustundum"):r+"klukkustund";case"d":return n?"dagur":o?"dag":"degi";case"dd":return t(e)?n?r+"dagar":r+(o?"daga":"dgum"):n?r+"dagur":r+(o?"dag":"degi");case"M":return n?"mnuur":o?"mnu":"mnui";case"MM":return t(e)?n?r+"mnuir":r+(o?"mnui":"mnuum"):n?r+"mnuur":r+(o?"mnu":"mnui");case"y":return n||o?"r":"ri";case"yy":return t(e)?r+(n||o?"r":"rum"):r+(n||o?"r":"ri")}}return e.defineLocale("is",{months:"janar_febrar_mars_aprl_ma_jn_jl_gst_september_oktber_nvember_desember".split("_"),monthsShort:"jan_feb_mar_apr_ma_jn_jl_g_sep_okt_nv_des".split("_"),weekdays:"sunnudagur_mnudagur_rijudagur_mivikudagur_fimmtudagur_fstudagur_laugardagur".split("_"),weekdaysShort:"sun_mn_ri_mi_fim_fs_lau".split("_"),weekdaysMin:"Su_M_r_Mi_Fi_F_La".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] LT",LLLL:"dddd, D. MMMM YYYY [kl.] LT"},calendar:{sameDay:"[ dag kl.] LT",nextDay:"[ morgun kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[ gr kl.] LT",lastWeek:"[sasta] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"eftir %s",past:"fyrir %s san",s:n,m:n,mm:n,h:"klukkustund",hh:n,d:n,dd:n,M:n,MM:n,y:n,yy:n},ordinal:"%d.",week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("it",{months:"gennaio_febbraio_marzo_aprile_maggio_giugno_luglio_agosto_settembre_ottobre_novembre_dicembre".split("_"),monthsShort:"gen_feb_mar_apr_mag_giu_lug_ago_set_ott_nov_dic".split("_"),weekdays:"Domenica_Luned_Marted_Mercoled_Gioved_Venerd_Sabato".split("_"),weekdaysShort:"Dom_Lun_Mar_Mer_Gio_Ven_Sab".split("_"),weekdaysMin:"D_L_Ma_Me_G_V_S".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Oggi alle] LT",nextDay:"[Domani alle] LT",nextWeek:"dddd [alle] LT",lastDay:"[Ieri alle] LT",lastWeek:"[lo scorso] dddd [alle] LT",sameElse:"L"},relativeTime:{future:function(e){return(/^[0-9].+$/.test(e)?"tra":"in")+" "+e},past:"%s fa",s:"alcuni secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"},ordinal:"%d",week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("ja",{months:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"Ahm",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMDLT",LLLL:"YYYYMDLT dddd"},meridiem:function(e){return 12>e?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[]dddd LT",lastDay:"[] LT",lastWeek:"[]dddd LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s",s:"",m:"1",mm:"%d",h:"1",hh:"%d",d:"1",dd:"%d",M:"1",MM:"%d",y:"1",yy:"%d"}})}),function(e){e(Ee)}(function(e){function t(e,t){var n={nominative:"___________".split("_"),accusative:"___________".split("_")},i=/D[oD] *MMMM?/.test(t)?"accusative":"nominative";return n[i][e.month()]}function n(e,t){var n={nominative:"______".split("_"),accusative:"______".split("_")},i=/(|)/.test(t)?"accusative":"nominative";return n[i][e.day()]}return e.defineLocale("ka",{months:t,monthsShort:"___________".split("_"),weekdays:n,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"h:mm A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[] LT[-]",nextDay:"[] LT[-]",lastDay:"[] LT[-]",nextWeek:"[] dddd LT[-]",lastWeek:"[] dddd LT-",sameElse:"L"},relativeTime:{future:function(e){return/(|||)/.test(e)?e.replace(/$/,""):e+""},past:function(e){return/(||||)/.test(e)?e.replace(/(|)$/," ")://.test(e)?e.replace(/$/," "):void 0},s:" ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},ordinal:function(e){return 0===e?e:1===e?e+"-":20>e||100>=e&&e%20===0||e%100===0?"-"+e:e+"-"},week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){return e.defineLocale("km",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] [] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("ko",{months:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h m",L:"YYYY.MM.DD",LL:"YYYY MMMM D",LLL:"YYYY MMMM D LT",LLLL:"YYYY MMMM D dddd LT"},meridiem:function(e){return 12>e?"":""},calendar:{sameDay:" LT",nextDay:" LT",nextWeek:"dddd LT",lastDay:" LT",lastWeek:" dddd LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"",ss:"%d",m:"",mm:"%d",h:"",hh:"%d",d:"",dd:"%d",M:"",MM:"%d",y:"",yy:"%d"},ordinal:"%d",meridiemParse:/(|)/,isPM:function(e){return""===e}})}),function(e){e(Ee)}(function(e){function t(e,t,n){var i={m:["eng Minutt","enger Minutt"],h:["eng Stonn","enger Stonn"],d:["een Dag","engem Dag"],M:["ee Mount","engem Mount"],y:["ee Joer","engem Joer"]};return t?i[n][0]:i[n][1]}function n(e){var t=e.substr(0,e.indexOf(" "));return o(t)?"a "+e:"an "+e}function i(e){var t=e.substr(0,e.indexOf(" "));return o(t)?"viru "+e:"virun "+e}function o(e){if(e=parseInt(e,10),isNaN(e))return!1;if(0>e)return!0;if(10>e)return e>=4&&7>=e;if(100>e){var t=e%10,n=e/10;return o(0===t?n:t)}if(1e4>e){for(;e>=10;)e/=10;return o(e)}return e/=1e3,o(e)}return e.defineLocale("lb",{months:"Januar_Februar_Merz_Abrll_Mee_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Abr._Mee_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),weekdays:"Sonndeg_Mindeg_Dnschdeg_Mttwoch_Donneschdeg_Freideg_Samschdeg".split("_"),weekdaysShort:"So._M._D._M._Do._Fr._Sa.".split("_"),weekdaysMin:"So_M_D_M_Do_Fr_Sa".split("_"),longDateFormat:{LT:"H:mm [Auer]",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Haut um] LT",sameElse:"L",nextDay:"[Muer um] LT",nextWeek:"dddd [um] LT",lastDay:"[Gschter um] LT",lastWeek:function(){switch(this.day()){case 2:case 4:return"[Leschten] dddd [um] LT";default:return"[Leschte] dddd [um] LT"}}},relativeTime:{future:n,past:i,s:"e puer Sekonnen",m:t,mm:"%d Minutten",h:t,hh:"%d Stonnen",d:t,dd:"%d Deeg",M:t,MM:"%d Mint",y:t,yy:"%d Joer"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){function t(e,t,n,i){return t?"kelios sekunds":i?"keli sekundi":"kelias sekundes"}function n(e,t,n,i){return t?o(n)[0]:i?o(n)[1]:o(n)[2]}function i(e){return e%10===0||e>10&&20>e}function o(e){return s[e].split("_")}function r(e,t,r,a){var s=e+" ";return 1===e?s+n(e,t,r[0],a):t?s+(i(e)?o(r)[1]:o(r)[0]):a?s+o(r)[1]:s+(i(e)?o(r)[1]:o(r)[2])}function a(e,t){var n=-1===t.indexOf("dddd HH:mm"),i=l[e.day()];return n?i:i.substring(0,i.length-2)+""}var s={m:"minut_minuts_minut",mm:"minuts_minui_minutes",h:"valanda_valandos_valand",hh:"valandos_valand_valandas",d:"diena_dienos_dien",dd:"dienos_dien_dienas",M:"mnuo_mnesio_mnes",MM:"mnesiai_mnesi_mnesius",y:"metai_met_metus",yy:"metai_met_metus"},l="sekmadienis_pirmadienis_antradienis_treiadienis_ketvirtadienis_penktadienis_etadienis".split("_");return e.defineLocale("lt",{months:"sausio_vasario_kovo_balandio_gegus_birelio_liepos_rugpjio_rugsjo_spalio_lapkriio_gruodio".split("_"),monthsShort:"sau_vas_kov_bal_geg_bir_lie_rgp_rgs_spa_lap_grd".split("_"),weekdays:a,weekdaysShort:"Sek_Pir_Ant_Tre_Ket_Pen_e".split("_"),weekdaysMin:"S_P_A_T_K_Pn_".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"YYYY [m.] MMMM D [d.]",LLL:"YYYY [m.] MMMM D [d.], LT [val.]",LLLL:"YYYY [m.] MMMM D [d.], dddd, LT [val.]",l:"YYYY-MM-DD",ll:"YYYY [m.] MMMM D [d.]",lll:"YYYY [m.] MMMM D [d.], LT [val.]",llll:"YYYY [m.] MMMM D [d.], ddd, LT [val.]"},calendar:{sameDay:"[iandien] LT",nextDay:"[Rytoj] LT",nextWeek:"dddd LT",lastDay:"[Vakar] LT",lastWeek:"[Prajus] dddd LT",sameElse:"L"},relativeTime:{future:"po %s",past:"prie %s",s:t,m:n,mm:r,h:n,hh:r,d:n,dd:r,M:n,MM:r,y:n,yy:r},ordinal:function(e){return e+"-oji"},week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){function t(e,t,n){var i=e.split("_");return n?t%10===1&&11!==t?i[2]:i[3]:t%10===1&&11!==t?i[0]:i[1]}function n(e,n,o){return e+" "+t(i[o],e,n)}var i={mm:"minti_mintes_minte_mintes",hh:"stundu_stundas_stunda_stundas",dd:"dienu_dienas_diena_dienas",MM:"mnesi_mneus_mnesis_mnei",yy:"gadu_gadus_gads_gadi"};return e.defineLocale("lv",{months:"janvris_februris_marts_aprlis_maijs_jnijs_jlijs_augusts_septembris_oktobris_novembris_decembris".split("_"),monthsShort:"jan_feb_mar_apr_mai_jn_jl_aug_sep_okt_nov_dec".split("_"),weekdays:"svtdiena_pirmdiena_otrdiena_trediena_ceturtdiena_piektdiena_sestdiena".split("_"),weekdaysShort:"Sv_P_O_T_C_Pk_S".split("_"),weekdaysMin:"Sv_P_O_T_C_Pk_S".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"YYYY. [gada] D. MMMM",LLL:"YYYY. [gada] D. MMMM, LT",LLLL:"YYYY. [gada] D. MMMM, dddd, LT"},calendar:{sameDay:"[odien pulksten] LT",nextDay:"[Rt pulksten] LT",nextWeek:"dddd [pulksten] LT",lastDay:"[Vakar pulksten] LT",lastWeek:"[Pagju] dddd [pulksten] LT",sameElse:"L"},relativeTime:{future:"%s vlk",past:"%s agrk",s:"daas sekundes",m:"minti",mm:n,h:"stundu",hh:n,d:"dienu",dd:n,M:"mnesi",MM:n,y:"gadu",yy:n},ordinal:"%d.",week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("mk",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"e_o_____a".split("_"),longDateFormat:{LT:"H:mm",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[ ] dddd [] LT";case 1:case 2:case 4:case 5:return"[ ] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},ordinal:function(e){var t=e%10,n=e%100;return 0===e?e+"-":0===n?e+"-":n>10&&20>n?e+"-":1===t?e+"-":2===t?e+"-":7===t||8===t?e+"-":e+"-"},week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){return e.defineLocale("ml",{months:"___________".split("_"),monthsShort:"._._._.___._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm -",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},meridiem:function(e){return 4>e?"":12>e?"":17>e?" ":20>e?"":""}})}),function(e){e(Ee)}(function(e){var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},n={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};return e.defineLocale("mr",{months:"___________".split("_"),monthsShort:"._._._._._._._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(e){return e.replace(/[]/g,function(e){return n[e]})},postformat:function(e){return e.replace(/\d/g,function(e){return t[e]})},meridiem:function(e){return 4>e?"":10>e?"":17>e?"":20>e?"":""},week:{dow:0,doy:6}})}),function(e){e(Ee)}(function(e){return e.defineLocale("ms-my",{months:"Januari_Februari_Mac_April_Mei_Jun_Julai_Ogos_September_Oktober_November_Disember".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ogs_Sep_Okt_Nov_Dis".split("_"),weekdays:"Ahad_Isnin_Selasa_Rabu_Khamis_Jumaat_Sabtu".split("_"),weekdaysShort:"Ahd_Isn_Sel_Rab_Kha_Jum_Sab".split("_"),weekdaysMin:"Ah_Is_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] LT",LLLL:"dddd, D MMMM YYYY [pukul] LT"},meridiem:function(e){return 11>e?"pagi":15>e?"tengahari":19>e?"petang":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Esok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kelmarin pukul] LT",lastWeek:"dddd [lepas pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lepas",s:"beberapa saat",m:"seminit",mm:"%d minit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},n={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};return e.defineLocale("my",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[.] LT []",nextDay:"[] LT []",nextWeek:"dddd LT []",lastDay:"[.] LT []",lastWeek:"[] dddd LT []",sameElse:"L"},relativeTime:{future:" %s ",past:" %s ",s:".",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},preparse:function(e){return e.replace(/[]/g,function(e){return n[e]})},postformat:function(e){return e.replace(/\d/g,function(e){return t[e]})},week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("nb",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sndag_mandag_tirsdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"sn_man_tirs_ons_tors_fre_lr".split("_"),weekdaysMin:"s_ma_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"H.mm",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] LT",LLLL:"dddd D. MMMM YYYY [kl.] LT"},calendar:{sameDay:"[i dag kl.] LT",nextDay:"[i morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[i gr kl.] LT",lastWeek:"[forrige] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"for %s siden",s:"noen sekunder",m:"ett minutt",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dager",M:"en mned",MM:"%d mneder",y:"ett r",yy:"%d r"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},n={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};return e.defineLocale("ne",{months:"___________".split("_"),monthsShort:"._.__.___._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"._._._._._._.".split("_"),weekdaysMin:"._.__._._._.".split("_"),longDateFormat:{LT:"A h:mm ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},preparse:function(e){return e.replace(/[]/g,function(e){return n[e]})},postformat:function(e){return e.replace(/\d/g,function(e){return t[e]})},meridiem:function(e){return 3>e?"":10>e?"":15>e?"":18>e?"":20>e?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[] dddd[,] LT",lastDay:"[] LT",lastWeek:"[] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){var t="jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_"),n="jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_");return e.defineLocale("nl",{months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:function(e,i){return/-MMM-/.test(i)?n[e.month()]:t[e.month()]},weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"Zo_Ma_Di_Wo_Do_Vr_Za".split("_"),longDateFormat:{LT:"HH:mm",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[vandaag om] LT",nextDay:"[morgen om] LT",nextWeek:"dddd [om] LT",lastDay:"[gisteren om] LT",lastWeek:"[afgelopen] dddd [om] LT",sameElse:"L"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",m:"n minuut",mm:"%d minuten",h:"n uur",hh:"%d uur",d:"n dag",dd:"%d dagen",M:"n maand",MM:"%d maanden",y:"n jaar",yy:"%d jaar"},ordinal:function(e){return e+(1===e||8===e||e>=20?"ste":"de")},week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("nn",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sundag_mndag_tysdag_onsdag_torsdag_fredag_laurdag".split("_"),weekdaysShort:"sun_mn_tys_ons_tor_fre_lau".split("_"),weekdaysMin:"su_m_ty_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[I dag klokka] LT",nextDay:"[I morgon klokka] LT",nextWeek:"dddd [klokka] LT",lastDay:"[I gr klokka] LT",lastWeek:"[Fregande] dddd [klokka] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"for %s sidan",s:"nokre sekund",m:"eit minutt",mm:"%d minutt",h:"ein time",hh:"%d timar",d:"ein dag",dd:"%d dagar",M:"ein mnad",MM:"%d mnader",y:"eit r",yy:"%d r"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){function t(e){return 5>e%10&&e%10>1&&~~(e/10)%10!==1}function n(e,n,i){var o=e+" ";switch(i){case"m":return n?"minuta":"minut";case"mm":return o+(t(e)?"minuty":"minut");case"h":return n?"godzina":"godzin";case"hh":return o+(t(e)?"godziny":"godzin");case"MM":return o+(t(e)?"miesice":"miesicy");case"yy":return o+(t(e)?"lata":"lat")}}var i="stycze_luty_marzec_kwiecie_maj_czerwiec_lipiec_sierpie_wrzesie_padziernik_listopad_grudzie".split("_"),o="stycznia_lutego_marca_kwietnia_maja_czerwca_lipca_sierpnia_wrzenia_padziernika_listopada_grudnia".split("_");return e.defineLocale("pl",{months:function(e,t){return/D MMMM/.test(t)?o[e.month()]:i[e.month()]},monthsShort:"sty_lut_mar_kwi_maj_cze_lip_sie_wrz_pa_lis_gru".split("_"),weekdays:"niedziela_poniedziaek_wtorek_roda_czwartek_pitek_sobota".split("_"),weekdaysShort:"nie_pon_wt_r_czw_pt_sb".split("_"),weekdaysMin:"N_Pn_Wt_r_Cz_Pt_So".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Dzi o] LT",nextDay:"[Jutro o] LT",nextWeek:"[W] dddd [o] LT",lastDay:"[Wczoraj o] LT",lastWeek:function(){switch(this.day()){case 0:return"[W zesz niedziel o] LT";case 3:return"[W zesz rod o] LT";case 6:return"[W zesz sobot o] LT";default:return"[W zeszy] dddd [o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"%s temu",s:"kilka sekund",m:n,mm:n,h:n,hh:n,d:"1 dzie",dd:"%d dni",M:"miesic",MM:n,y:"rok",yy:n},ordinal:"%d.",week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("pt-br",{months:"janeiro_fevereiro_maro_abril_maio_junho_julho_agosto_setembro_outubro_novembro_dezembro".split("_"),monthsShort:"jan_fev_mar_abr_mai_jun_jul_ago_set_out_nov_dez".split("_"),weekdays:"domingo_segunda-feira_tera-feira_quarta-feira_quinta-feira_sexta-feira_sbado".split("_"),weekdaysShort:"dom_seg_ter_qua_qui_sex_sb".split("_"),weekdaysMin:"dom_2_3_4_5_6_sb".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY [s] LT",LLLL:"dddd, D [de] MMMM [de] YYYY [s] LT"},calendar:{sameDay:"[Hoje s] LT",nextDay:"[Amanh s] LT",nextWeek:"dddd [s] LT",lastDay:"[Ontem s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[ltimo] dddd [s] LT":"[ltima] dddd [s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"%s atrs",s:"segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um ms",MM:"%d meses",y:"um ano",yy:"%d anos"},ordinal:"%d"})}),function(e){e(Ee)}(function(e){return e.defineLocale("pt",{months:"janeiro_fevereiro_maro_abril_maio_junho_julho_agosto_setembro_outubro_novembro_dezembro".split("_"),monthsShort:"jan_fev_mar_abr_mai_jun_jul_ago_set_out_nov_dez".split("_"),weekdays:"domingo_segunda-feira_tera-feira_quarta-feira_quinta-feira_sexta-feira_sbado".split("_"),weekdaysShort:"dom_seg_ter_qua_qui_sex_sb".split("_"),weekdaysMin:"dom_2_3_4_5_6_sb".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY LT",LLLL:"dddd, D [de] MMMM [de] YYYY LT"},calendar:{sameDay:"[Hoje s] LT",nextDay:"[Amanh s] LT",nextWeek:"dddd [s] LT",lastDay:"[Ontem s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[ltimo] dddd [s] LT":"[ltima] dddd [s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"h %s",s:"segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um ms",MM:"%d meses",y:"um ano",yy:"%d anos"},ordinal:"%d",week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){function t(e,t,n){var i={mm:"minute",hh:"ore",dd:"zile",MM:"luni",yy:"ani"},o=" ";return(e%100>=20||e>=100&&e%100===0)&&(o=" de "),e+o+i[n]}return e.defineLocale("ro",{months:"ianuarie_februarie_martie_aprilie_mai_iunie_iulie_august_septembrie_octombrie_noiembrie_decembrie".split("_"),monthsShort:"ian._febr._mart._apr._mai_iun._iul._aug._sept._oct._nov._dec.".split("_"),weekdays:"duminic_luni_mari_miercuri_joi_vineri_smbt".split("_"),weekdaysShort:"Dum_Lun_Mar_Mie_Joi_Vin_Sm".split("_"),weekdaysMin:"Du_Lu_Ma_Mi_Jo_Vi_S".split("_"),longDateFormat:{LT:"H:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[azi la] LT",nextDay:"[mine la] LT",nextWeek:"dddd [la] LT",lastDay:"[ieri la] LT",lastWeek:"[fosta] dddd [la] LT",sameElse:"L"},relativeTime:{future:"peste %s",past:"%s n urm",s:"cteva secunde",m:"un minut",mm:t,h:"o or",hh:t,d:"o zi",dd:t,M:"o lun",MM:t,y:"un an",yy:t},week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){function t(e,t){var n=e.split("_");return t%10===1&&t%100!==11?n[0]:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?n[1]:n[2]}function n(e,n,i){var o={mm:n?"__":"__",hh:"__",dd:"__",MM:"__",yy:"__"};return"m"===i?n?"":"":e+" "+t(o[i],+e)}function i(e,t){var n={nominative:"___________".split("_"),accusative:"___________".split("_")},i=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(t)?"accusative":"nominative";return n[i][e.month()]}function o(e,t){var n={nominative:"___________".split("_"),accusative:"___________".split("_")},i=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(t)?"accusative":"nominative";return n[i][e.month()]}function r(e,t){var n={nominative:"______".split("_"),accusative:"______".split("_")},i=/\[ ?[] ?(?:|)? ?\] ?dddd/.test(t)?"accusative":"nominative";return n[i][e.day()]}return e.defineLocale("ru",{months:i,monthsShort:o,weekdays:r,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),monthsParse:[/^/i,/^/i,/^/i,/^/i,/^[|]/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i],longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., LT",LLLL:"dddd, D MMMM YYYY ., LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",lastDay:"[ ] LT",nextWeek:function(){return 2===this.day()?"[] dddd [] LT":"[] dddd [] LT"},lastWeek:function(){switch(this.day()){case 0:return"[ ] dddd [] LT";case 1:case 2:case 4:return"[ ] dddd [] LT";case 3:case 5:case 6:return"[ ] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:n,mm:n,h:"",hh:n,d:"",dd:n,M:"",MM:n,y:"",yy:n},meridiemParse:/|||/i,isPM:function(e){return/^(|)$/.test(e)},meridiem:function(e){return 4>e?"":12>e?"":17>e?"":""},ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":return e+"-";case"D":return e+"-";case"w":case"W":return e+"-";default:return e}},week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){function t(e){return e>1&&5>e}function n(e,n,i,o){var r=e+" ";switch(i){case"s":return n||o?"pr seknd":"pr sekundami";case"m":return n?"minta":o?"mintu":"mintou";case"mm":return n||o?r+(t(e)?"minty":"mint"):r+"mintami";case"h":return n?"hodina":o?"hodinu":"hodinou";case"hh":return n||o?r+(t(e)?"hodiny":"hodn"):r+"hodinami";case"d":return n||o?"de":"dom";case"dd":return n||o?r+(t(e)?"dni":"dn"):r+"dami";case"M":return n||o?"mesiac":"mesiacom";case"MM":return n||o?r+(t(e)?"mesiace":"mesiacov"):r+"mesiacmi";case"y":return n||o?"rok":"rokom";case"yy":return n||o?r+(t(e)?"roky":"rokov"):r+"rokmi"}}var i="janur_februr_marec_aprl_mj_jn_jl_august_september_oktber_november_december".split("_"),o="jan_feb_mar_apr_mj_jn_jl_aug_sep_okt_nov_dec".split("_");return e.defineLocale("sk",{months:i,monthsShort:o,monthsParse:function(e,t){var n,i=[];for(n=0;12>n;n++)i[n]=new RegExp("^"+e[n]+"$|^"+t[n]+"$","i");return i}(i,o),weekdays:"nedea_pondelok_utorok_streda_tvrtok_piatok_sobota".split("_"),weekdaysShort:"ne_po_ut_st_t_pi_so".split("_"),weekdaysMin:"ne_po_ut_st_t_pi_so".split("_"),longDateFormat:{LT:"H:mm",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd D. MMMM YYYY LT"},calendar:{sameDay:"[dnes o] LT",nextDay:"[zajtra o] LT",nextWeek:function(){switch(this.day()){case 0:return"[v nedeu o] LT";case 1:case 2:return"[v] dddd [o] LT";case 3:return"[v stredu o] LT";case 4:return"[vo tvrtok o] LT";case 5:return"[v piatok o] LT";case 6:return"[v sobotu o] LT"}},lastDay:"[vera o] LT",lastWeek:function(){switch(this.day()){case 0:return"[minul nedeu o] LT";case 1:case 2:return"[minul] dddd [o] LT";case 3:return"[minul stredu o] LT";case 4:case 5:return"[minul] dddd [o] LT";case 6:return"[minul sobotu o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"pred %s",s:n,m:n,mm:n,h:n,hh:n,d:n,dd:n,M:n,MM:n,y:n,yy:n},ordinal:"%d.",week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){function t(e,t,n){var i=e+" ";switch(n){case"m":return t?"ena minuta":"eno minuto";case"mm":return i+=1===e?"minuta":2===e?"minuti":3===e||4===e?"minute":"minut";case"h":return t?"ena ura":"eno uro";case"hh":return i+=1===e?"ura":2===e?"uri":3===e||4===e?"ure":"ur";case"dd":return i+=1===e?"dan":"dni";case"MM":return i+=1===e?"mesec":2===e?"meseca":3===e||4===e?"mesece":"mesecev";case"yy":return i+=1===e?"leto":2===e?"leti":3===e||4===e?"leta":"let"}}return e.defineLocale("sl",{months:"januar_februar_marec_april_maj_junij_julij_avgust_september_oktober_november_december".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._avg._sep._okt._nov._dec.".split("_"),weekdays:"nedelja_ponedeljek_torek_sreda_etrtek_petek_sobota".split("_"),weekdaysShort:"ned._pon._tor._sre._et._pet._sob.".split("_"),weekdaysMin:"ne_po_to_sr_e_pe_so".split("_"),longDateFormat:{LT:"H:mm",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danes ob] LT",nextDay:"[jutri ob] LT",nextWeek:function(){switch(this.day()){case 0:return"[v] [nedeljo] [ob] LT";case 3:return"[v] [sredo] [ob] LT";case 6:return"[v] [soboto] [ob] LT";case 1:case 2:case 4:case 5:return"[v] dddd [ob] LT"}},lastDay:"[veraj ob] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[prejnja] dddd [ob] LT";case 1:case 2:case 4:case 5:return"[prejnji] dddd [ob] LT"}},sameElse:"L"},relativeTime:{future:"ez %s",past:"%s nazaj",s:"nekaj sekund",m:t,mm:t,h:t,hh:t,d:"en dan",dd:t,M:"en mesec",MM:t,y:"eno leto",yy:t},ordinal:"%d.",week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){return e.defineLocale("sq",{months:"Janar_Shkurt_Mars_Prill_Maj_Qershor_Korrik_Gusht_Shtator_Tetor_Nntor_Dhjetor".split("_"),monthsShort:"Jan_Shk_Mar_Pri_Maj_Qer_Kor_Gus_Sht_Tet_Nn_Dhj".split("_"),weekdays:"E Diel_E Hn_E Mart_E Mrkur_E Enjte_E Premte_E Shtun".split("_"),weekdaysShort:"Die_Hn_Mar_Mr_Enj_Pre_Sht".split("_"),weekdaysMin:"D_H_Ma_M_E_P_Sh".split("_"),meridiem:function(e){return 12>e?"PD":"MD"},longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Sot n] LT",nextDay:"[Nesr n] LT",nextWeek:"dddd [n] LT",lastDay:"[Dje n] LT",lastWeek:"dddd [e kaluar n] LT",sameElse:"L"},relativeTime:{future:"n %s",past:"%s m par",s:"disa sekonda",m:"nj minut",mm:"%d minuta",h:"nj or",hh:"%d or",d:"nj dit",dd:"%d dit",M:"nj muaj",MM:"%d muaj",y:"nj vit",yy:"%d vite"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){var t={words:{m:[" "," "],mm:["","",""],h:[" "," "],hh:["","",""],dd:["","",""],MM:["","",""],yy:["","",""]},correctGrammaticalCase:function(e,t){return 1===e?t[0]:e>=2&&4>=e?t[1]:t[2]},translate:function(e,n,i){var o=t.words[i];return 1===i.length?n?o[0]:o[1]:e+" "+t.correctGrammaticalCase(e,o)}};return e.defineLocale("sr-cyrl",{months:["","","","","","","","","","","",""],monthsShort:[".",".",".",".","","","",".",".",".",".","."],weekdays:["","","","","","",""],weekdaysShort:[".",".",".",".",".",".","."],weekdaysMin:["","","","","","",""],longDateFormat:{LT:"H:mm",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:function(){switch(this.day()){case 0:return"[] [] [] LT";case 3:return"[] [] [] LT";case 6:return"[] [] [] LT";case 1:case 2:case 4:case 5:return"[] dddd [] LT"}},lastDay:"[ ] LT",lastWeek:function(){var e=["[] [] [] LT","[] [] [] LT","[] [] [] LT","[] [] [] LT","[] [] [] LT","[] [] [] LT","[] [] [] LT"];return e[this.day()]},sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",m:t.translate,mm:t.translate,h:t.translate,hh:t.translate,d:"",dd:t.translate,M:"",MM:t.translate,y:"",yy:t.translate},ordinal:"%d.",week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){var t={words:{m:["jedan minut","jedne minute"],mm:["minut","minute","minuta"],h:["jedan sat","jednog sata"],hh:["sat","sata","sati"],dd:["dan","dana","dana"],MM:["mesec","meseca","meseci"],yy:["godina","godine","godina"]},correctGrammaticalCase:function(e,t){return 1===e?t[0]:e>=2&&4>=e?t[1]:t[2]},translate:function(e,n,i){var o=t.words[i];return 1===i.length?n?o[0]:o[1]:e+" "+t.correctGrammaticalCase(e,o)}};return e.defineLocale("sr",{months:["januar","februar","mart","april","maj","jun","jul","avgust","septembar","oktobar","novembar","decembar"],monthsShort:["jan.","feb.","mar.","apr.","maj","jun","jul","avg.","sep.","okt.","nov.","dec."],weekdays:["nedelja","ponedeljak","utorak","sreda","etvrtak","petak","subota"],weekdaysShort:["ned.","pon.","uto.","sre.","et.","pet.","sub."],weekdaysMin:["ne","po","ut","sr","e","pe","su"],longDateFormat:{LT:"H:mm",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedelju] [u] LT";case 3:return"[u] [sredu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[jue u] LT",lastWeek:function(){var e=["[prole] [nedelje] [u] LT","[prolog] [ponedeljka] [u] LT","[prolog] [utorka] [u] LT","[prole] [srede] [u] LT","[prolog] [etvrtka] [u] LT","[prolog] [petka] [u] LT","[prole] [subote] [u] LT"];return e[this.day()]},sameElse:"L"},relativeTime:{future:"za %s",past:"pre %s",s:"nekoliko sekundi",m:t.translate,mm:t.translate,h:t.translate,hh:t.translate,d:"dan",dd:t.translate,M:"mesec",MM:t.translate,y:"godinu",yy:t.translate},ordinal:"%d.",week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){return e.defineLocale("sv",{months:"januari_februari_mars_april_maj_juni_juli_augusti_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"sndag_mndag_tisdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"sn_mn_tis_ons_tor_fre_lr".split("_"),weekdaysMin:"s_m_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Idag] LT",nextDay:"[Imorgon] LT",lastDay:"[Igr] LT",nextWeek:"dddd LT",lastWeek:"[Frra] dddd[en] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"fr %s sedan",s:"ngra sekunder",m:"en minut",mm:"%d minuter",h:"en timme",hh:"%d timmar",d:"en dag",dd:"%d dagar",M:"en mnad",MM:"%d mnader",y:"ett r",yy:"%d r"},ordinal:function(e){var t=e%10,n=1===~~(e%100/10)?"e":1===t?"a":2===t?"a":"e";return e+n},week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("ta",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[ ] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"  ",m:" ",mm:"%d ",h:"  ",hh:"%d  ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},ordinal:function(e){return e+""},meridiem:function(e){return e>=6&&10>=e?" ":e>=10&&14>=e?" ":e>=14&&18>=e?" ":e>=18&&20>=e?" ":e>=20&&24>=e?" ":e>=0&&6>=e?" ":void 0},week:{dow:0,doy:6}})}),function(e){e(Ee)}(function(e){return e.defineLocale("th",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"._._._._._._.".split("_"),longDateFormat:{LT:"H  m ",L:"YYYY/MM/DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY  LT",LLLL:"dddd D MMMM YYYY  LT"},meridiem:function(e){return 12>e?"":""},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd[ ] LT",lastDay:"[ ] LT",lastWeek:"[]dddd[ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s",s:"",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "}})}),function(e){e(Ee)}(function(e){return e.defineLocale("tl-ph",{months:"Enero_Pebrero_Marso_Abril_Mayo_Hunyo_Hulyo_Agosto_Setyembre_Oktubre_Nobyembre_Disyembre".split("_"),monthsShort:"Ene_Peb_Mar_Abr_May_Hun_Hul_Ago_Set_Okt_Nob_Dis".split("_"),weekdays:"Linggo_Lunes_Martes_Miyerkules_Huwebes_Biyernes_Sabado".split("_"),weekdaysShort:"Lin_Lun_Mar_Miy_Huw_Biy_Sab".split("_"),weekdaysMin:"Li_Lu_Ma_Mi_Hu_Bi_Sab".split("_"),longDateFormat:{LT:"HH:mm",L:"MM/D/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM DD, YYYY LT"},calendar:{sameDay:"[Ngayon sa] LT",nextDay:"[Bukas sa] LT",nextWeek:"dddd [sa] LT",lastDay:"[Kahapon sa] LT",lastWeek:"dddd [huling linggo] LT",sameElse:"L"},relativeTime:{future:"sa loob ng %s",past:"%s ang nakalipas",s:"ilang segundo",m:"isang minuto",mm:"%d minuto",h:"isang oras",hh:"%d oras",d:"isang araw",dd:"%d araw",M:"isang buwan",MM:"%d buwan",y:"isang taon",yy:"%d taon"},ordinal:function(e){return e},week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){var t={1:"'inci",5:"'inci",8:"'inci",70:"'inci",80:"'inci",2:"'nci",7:"'nci",20:"'nci",50:"'nci",3:"'nc",4:"'nc",100:"'nc",6:"'nc",9:"'uncu",10:"'uncu",30:"'uncu",60:"'nc",90:"'nc"};return e.defineLocale("tr",{months:"Ocak_ubat_Mart_Nisan_Mays_Haziran_Temmuz_Austos_Eyll_Ekim_Kasm_Aralk".split("_"),monthsShort:"Oca_ub_Mar_Nis_May_Haz_Tem_Au_Eyl_Eki_Kas_Ara".split("_"),weekdays:"Pazar_Pazartesi_Sal_aramba_Perembe_Cuma_Cumartesi".split("_"),weekdaysShort:"Paz_Pts_Sal_ar_Per_Cum_Cts".split("_"),weekdaysMin:"Pz_Pt_Sa_a_Pe_Cu_Ct".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[bugn saat] LT",nextDay:"[yarn saat] LT",nextWeek:"[haftaya] dddd [saat] LT",lastDay:"[dn] LT",lastWeek:"[geen hafta] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s nce",s:"birka saniye",m:"bir dakika",mm:"%d dakika",h:"bir saat",hh:"%d saat",d:"bir gn",dd:"%d gn",M:"bir ay",MM:"%d ay",y:"bir yl",yy:"%d yl"},ordinal:function(e){if(0===e)return e+"'nc";var n=e%10,i=e%100-n,o=e>=100?100:null;return e+(t[n]||t[i]||t[o])},week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){return e.defineLocale("tzm-latn",{months:"innayr_brayr_mars_ibrir_mayyw_ywnyw_ywlywz_wt_wtanbir_ktwbr_nwwanbir_dwjnbir".split("_"),monthsShort:"innayr_brayr_mars_ibrir_mayyw_ywnyw_ywlywz_wt_wtanbir_ktwbr_nwwanbir_dwjnbir".split("_"),weekdays:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),weekdaysShort:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),weekdaysMin:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[asdkh g] LT",nextDay:"[aska g] LT",nextWeek:"dddd [g] LT",lastDay:"[assant g] LT",lastWeek:"dddd [g] LT",sameElse:"L"},relativeTime:{future:"dadkh s yan %s",past:"yan %s",s:"imik",m:"minu",mm:"%d minu",h:"saa",hh:"%d tassain",d:"ass",dd:"%d ossan",M:"ayowr",MM:"%d iyyirn",y:"asgas",yy:"%d isgasn"},week:{dow:6,doy:12}})}),function(e){e(Ee)}(function(e){return e.defineLocale("tzm",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] LT",sameElse:"L"},relativeTime:{future:"   %s",past:" %s",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d o",M:"o",MM:"%d ",y:"",yy:"%d "},week:{dow:6,doy:12}})}),function(e){e(Ee)}(function(e){function t(e,t){var n=e.split("_");return t%10===1&&t%100!==11?n[0]:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?n[1]:n[2]}function n(e,n,i){var o={mm:"__",hh:"__",dd:"__",MM:"__",yy:"__"};return"m"===i?n?"":"":"h"===i?n?"":"":e+" "+t(o[i],+e)}function i(e,t){var n={nominative:"___________".split("_"),accusative:"___________".split("_")},i=/D[oD]? *MMMM?/.test(t)?"accusative":"nominative";return n[i][e.month()]}function o(e,t){var n={nominative:"______".split("_"),accusative:"______".split("_"),genitive:"______".split("_")},i=/(\[[]\]) ?dddd/.test(t)?"accusative":/\[?(?:|)? ?\] ?dddd/.test(t)?"genitive":"nominative";return n[i][e.day()]}function r(e){return function(){return e+""+(11===this.hours()?"":"")+"] LT"}}return e.defineLocale("uk",{months:i,monthsShort:"___________".split("_"),weekdays:o,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., LT",LLLL:"dddd, D MMMM YYYY ., LT"},calendar:{sameDay:r("[ "),nextDay:r("[ "),lastDay:r("[ "),nextWeek:r("[] dddd ["),lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return r("[] dddd [").call(this);case 1:case 2:case 4:return r("[] dddd [").call(this)}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:n,mm:n,h:"",hh:n,d:"",dd:n,M:"",MM:n,y:"",yy:n},meridiem:function(e){return 4>e?"":12>e?"":17>e?"":""},ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":case"w":case"W":return e+"-";case"D":return e+"-";default:return e}},week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){return e.defineLocale("uz",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"D MMMM YYYY, dddd LT"},calendar:{sameDay:"[ ] LT []",nextDay:"[] LT []",nextWeek:"dddd [ ] LT []",lastDay:"[ ] LT []",lastWeek:"[] dddd [ ] LT []",sameElse:"L"},relativeTime:{future:" %s ",past:"  %s ",s:"",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},week:{dow:1,doy:7}})}),function(e){e(Ee)}(function(e){return e.defineLocale("vi",{months:"thng 1_thng 2_thng 3_thng 4_thng 5_thng 6_thng 7_thng 8_thng 9_thng 10_thng 11_thng 12".split("_"),monthsShort:"Th01_Th02_Th03_Th04_Th05_Th06_Th07_Th08_Th09_Th10_Th11_Th12".split("_"),weekdays:"ch nht_th hai_th ba_th t_th nm_th su_th by".split("_"),weekdaysShort:"CN_T2_T3_T4_T5_T6_T7".split("_"),weekdaysMin:"CN_T2_T3_T4_T5_T6_T7".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM [nm] YYYY",LLL:"D MMMM [nm] YYYY LT",LLLL:"dddd, D MMMM [nm] YYYY LT",l:"DD/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY LT",llll:"ddd, D MMM YYYY LT"},calendar:{sameDay:"[Hm nay lc] LT",nextDay:"[Ngy mai lc] LT",nextWeek:"dddd [tun ti lc] LT",lastDay:"[Hm qua lc] LT",lastWeek:"dddd [tun ri lc] LT",sameElse:"L"},relativeTime:{future:"%s ti",past:"%s trc",s:"vi giy",m:"mt pht",mm:"%d pht",h:"mt gi",hh:"%d gi",d:"mt ngy",dd:"%d ngy",M:"mt thng",MM:"%d thng",y:"mt nm",yy:"%d nm"},ordinal:function(e){return e},week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("zh-cn",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"Ahmm",L:"YYYY-MM-DD",LL:"YYYYMMMD",LLL:"YYYYMMMDLT",LLLL:"YYYYMMMDddddLT",l:"YYYY-MM-DD",ll:"YYYYMMMD",lll:"YYYYMMMDLT",llll:"YYYYMMMDddddLT"},meridiem:function(e,t){var n=100*e+t;return 600>n?"":900>n?"":1130>n?"":1230>n?"":1800>n?"":""},calendar:{sameDay:function(){return 0===this.minutes()?"[]Ah[]":"[]LT"},nextDay:function(){return 0===this.minutes()?"[]Ah[]":"[]LT"},lastDay:function(){return 0===this.minutes()?"[]Ah[]":"[]LT"},nextWeek:function(){var t,n;return t=e().startOf("week"),n=this.unix()-t.unix()>=604800?"[]":"[]",0===this.minutes()?n+"dddAh":n+"dddAhmm"},lastWeek:function(){var t,n;return t=e().startOf("week"),n=this.unix()<t.unix()?"[]":"[]",0===this.minutes()?n+"dddAh":n+"dddAhmm"},sameElse:"LL"},ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"";case"M":return e+"";case"w":case"W":return e+"";default:return e}},relativeTime:{future:"%s",past:"%s",s:"",m:"1",mm:"%d",h:"1",hh:"%d",d:"1",dd:"%d",M:"1",MM:"%d",y:"1",yy:"%d"},week:{dow:1,doy:4}})}),function(e){e(Ee)}(function(e){return e.defineLocale("zh-tw",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"Ahmm",L:"YYYYMMMD",LL:"YYYYMMMD",LLL:"YYYYMMMDLT",LLLL:"YYYYMMMDddddLT",l:"YYYYMMMD",ll:"YYYYMMMD",lll:"YYYYMMMDLT",llll:"YYYYMMMDddddLT"},meridiem:function(e,t){var n=100*e+t;return 900>n?"":1130>n?"":1230>n?"":1800>n?"":""},calendar:{sameDay:"[]LT",nextDay:"[]LT",nextWeek:"[]ddddLT",lastDay:"[]LT",lastWeek:"[]ddddLT",sameElse:"L"},ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"";case"M":return e+"";case"w":case"W":return e+"";default:return e}},relativeTime:{future:"%s",past:"%s",s:"",m:"",mm:"%d",h:"",hh:"%d",d:"",dd:"%d",M:"",MM:"%d",y:"",yy:"%d"}})}),Ee.locale("en"),Ue?module.exports=Ee:"function"==typeof define&&define.amd?(define("moment",function(e,t,n){return n.config&&n.config()&&n.config().noGlobal===!0&&(Re.moment=ve),Ee}),_e(!0)):_e()}.call(this),function(e){e(function(){var t={primaryStyles:["fontFamily","fontSize","fontWeight","fontVariant","fontStyle","paddingLeft","paddingTop","paddingBottom","paddingRight","marginLeft","marginTop","marginBottom","marginRight","borderLeftColor","borderTopColor","borderBottomColor","borderRightColor","borderLeftStyle","borderTopStyle","borderBottomStyle","borderRightStyle","borderLeftWidth","borderTopWidth","borderBottomWidth","borderRightWidth","line-height","outline","text-align"],specificStyle:{"word-wrap":"break-word","overflow-x":"hidden","overflow-y":"auto"},simulator:e('<div id="textarea_simulator"/>').css({position:"absolute",top:0,left:0,visibility:"hidden"}).appendTo(document.body),toHtml:function(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").split(" ").join('<span style="white-space:prev-wrap">&nbsp;</span>')},getCaretPosition:function(){var n=t,i=this,o=i[0],r=i.offset();if(e.browser.msie&&e.browser.version<=9){o.focus();var a=document.selection.createRange();return e("#hskeywords").val(o.scrollTop),{left:a.boundingLeft-r.left,top:parseInt(a.boundingTop)-r.top+o.scrollTop+document.documentElement.scrollTop+parseInt(i.getComputedStyle("fontSize"))}}n.simulator.empty(),e.each(n.primaryStyles,function(e,t){i.cloneStyle(n.simulator,t)}),n.simulator.css(e.extend({width:i.width(),height:i.height()},n.specificStyle));var s=i.val()||i.text(),l=i.getCursorPosition(),d=s.substring(0,l),c=s.substring(l),u=e('<span class="before"/>').html(n.toHtml(d)),p=e('<span class="focus"/>'),h=e('<span class="after"/>').html(n.toHtml(c));n.simulator.append(u).append(p).append(h);var f=p.offset(),m=n.simulator.offset();return{top:f.top-m.top-o.scrollTop+(e.browser.mozilla?0:parseInt(i.getComputedStyle("fontSize"))),left:p[0].offsetLeft-n.simulator[0].offsetLeft-o.scrollLeft}}};e.fn.extend({setCursorPosition:function(t){return 0==this.length?this:e(this).setSelection(t,t)},setSelection:function(e,t){if(0==this.length)return this;if(input=this[0],input.createTextRange){var n=input.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select()}else if(input.setSelectionRange)input.focus(),input.setSelectionRange(e,t);else{var i=this.get(0),n=document.createRange();n.collapse(!0),n.setStart(i.childNodes[0],e),n.setEnd(i.childNodes[0],t);var o=window.getSelection();o.removeAllRanges(),o.addRange(n)}return this},getComputedStyle:function(t){if(0!=this.length){var n=this[0],i=this.css(t);return i=i||(e.browser.msie?n.currentStyle[t]:document.defaultView.getComputedStyle(n,null)[t])}},cloneStyle:function(t,n){var i=this.getComputedStyle(n);i&&e(t).css(n,i)},cloneAllStyle:function(e,t){var n=this[0];for(var i in n.style){var o=n.style[i];"string"==typeof o||"number"==typeof o?this.cloneStyle(e,i):NaN}},getCursorPosition:function(){var e=input=this[0],t=input.value||input.innerText;this.data("lastCursorPosition")||this.data("lastCursorPosition",0);var n=this.data("lastCursorPosition");if(document.selection){input.focus();var i=document.selection.createRange(),o=document.selection.createRange().text.length;i.moveStart("character",-t.length),n=i.text.length-o}else{if(input.selectionStart||"0"==input.selectionStart)return input.selectionStart;if("undefined"!=typeof window.getSelection&&window.getSelection().rangeCount>0)try{var r=window.getSelection(),a=r.getRangeAt(0),s=a.cloneRange();s.selectNodeContents(e),s.setEnd(a.endContainer,a.endOffset),n=s.toString().length}catch(e){n=this.data("lastCursorPosition")}else if("undefined"!=typeof document.selection&&"Control"!=document.selection.type){var l=document.selection.createRange(),d=document.body.createTextRange();d.moveToElementText(e),d.setEndPoint("EndToEnd",l),n=d.text.length}}return this.data("lastCursorPosition",n),n},getCaretPosition:t.getCaretPosition})})}(jQuery),function(e,t,n){function i(t,n){this.options=e.extend({},c,n),i.MENU_TEMPLATE=this.options.menuTemplate,i.ITEM_TEMPLATE=this.options.listItemTemplate,this.element=t,this.$element=e(t),this.$itemList=e(i.MENU_TEMPLATE),this.reset(),this._defaults=c,this._name=d,this.expression=new RegExp("(^|\\s)"+this.options.token+"([-\\w.]*)$"),this.cleanupHandle=null,this.init()}var o=function(e,t){e.text(t.val)},r=function(e){var t=e.filter(function(e){return""!==val&&(e.val.toLowerCase().indexOf(val.toLowerCase())>=0||(e.meta||"").toLowerCase().indexOf(val.toLowerCase())>=0)});return t},a=function(e,t){},s=function(e){e.show()},l=function(e){e.hide()},d="sew",c={token:"@",elementFactory:o,values:[],unique:!1,repeat:!0,maxNoOfSuggestions:10,filterFn:r,menuTemplate:"<div class='-sew-list-container' style='display: none; position: absolute;'><ul class='-sew-list'></ul></div>",listItemTemplate:'<li class="-sew-list-item"></li>',renderCallback:a,show:s,hide:l,extras:{}};i.MENU_TEMPLATE=c.menuTemplate,i.ITEM_TEMPLATE=c.listItemTemplate,i.KEYS=[40,38,13,27,9],i.prototype.init=function(){this.$element.bind("keyup",e.proxy(this.onKeyUp,this)).bind("keydown",e.proxy(this.onKeyDown,this)).bind("blur",e.proxy(this.remove,this))},i.prototype.reset=function(){this.options.unique&&(this.options.values=i.getUniqueElements(this.options.values)),this.index=0,this.matched=!1,this.dontFilter=!1,this.lastFilter=n,this.filtered=this.options.values.slice(0)},i.prototype.next=function(){this.index=(this.index+1)%this.filtered.length,this.hightlightItem()},i.prototype.prev=function(){this.index=(this.index+this.filtered.length-1)%this.filtered.length,this.hightlightItem()},i.prototype.select=function(){this.replace(this.filtered[this.index].val),this.$element.trigger("mention-selected",this.filtered[this.index]),this.hideList()},i.prototype.remove=function(){this.options.hide(this.$itemList),this.cleanupHandle=t.setTimeout(e.proxy(function(){this.$itemList.remove()},this),1e3)},i.prototype.replace=function(e){var t=this.$element.getCursorPosition(),n=this.getText(),i=n.substring(0,t);i=i.replace(this.expression,"$1"+this.options.token+e);var o=n.substring(t,n.length),r=o.match(/^\s/)?"":" ",a=i+r+o;this.setText(a),this.$element.setCursorPosition(i.length+1)},i.prototype.hightlightItem=function(){this.$itemList.find(".-sew-list-item").removeClass("selected");var e=this.$itemList.find(".-sew-list-item").parent(),t=this.filtered[this.index].element.addClass("selected"),n=t.position().top;e.scrollTop(e.scrollTop()+n)},i.prototype.renderElements=function(t){this.$element.parent().append(this.$itemList);var n=this.$itemList.empty();t.forEach(e.proxy(function(t,o){var r=e(i.ITEM_TEMPLATE);this.options.elementFactory(r,t),t.element=r.appendTo(n).bind("click",e.proxy(this.onItemClick,this,t)).bind("mouseover",e.proxy(this.onItemHover,this,o))},this)),this.index=0,this.hightlightItem(),this.options.renderCallback(this.$element,this.$itemList)},i.prototype.displayList=function(){if(this.filtered.length){this.options.show(this.$itemList);var e=this.$element,t=this.$element.position(),n=e.getCaretPosition();this.$itemList.css({left:t.left+n.left,top:t.top+n.top})}},i.prototype.hideList=function(){this.options.hide(this.$itemList),this.reset()},i.prototype.filterList=function(e){if(e!=this.lastFilter){this.lastFilter=e,this.$itemList.find(".-sew-list-item").remove();var t=this.options.values,n=this;this.options.filterFn({values:t,query:e},function(e){n.filtered=e,e=n.filtered=e.slice(0,n.options.maxNoOfSuggestions),e.length?(n.renderElements(e),n.options.show(n.$itemList)):n.hideList()})}},i.getUniqueElements=function(e){var t=[];return e.forEach(function(e){var n=t.map(function(e){return e.val}).indexOf(e.val)>=0;n||t.push(e)}),t},i.prototype.getText=function(){return this.$element.val()||this.$element.text()},i.prototype.setText=function(e){this.$element.is("input,textarea")?this.$element.val(e):this.$element.html(e)},i.prototype.onKeyUp=function(e){var t=this.$element.getCursorPosition(),n=this.getText().substring(0,t),i=n.match(this.expression);return!i&&this.matched?(this.matched=!1,this.dontFilter=!1,void this.hideList()):(i&&!this.matched&&(this.lastFilter="\n",this.matched=!0),void(i&&!this.dontFilter&&this.filterList(i[2])))},i.prototype.onKeyDown=function(e){var t=this.$itemList.is(":visible");if(t&&!(i.KEYS.indexOf(e.keyCode)<0)){switch(e.keyCode){case 9:case 13:this.select();break;case 40:this.next();break;case 38:this.prev();break;case 27:this.options.hide(this.$itemList),this.dontFilter=!0}e.preventDefault()}},i.prototype.onItemClick=function(e,n){this.cleanupHandle&&t.clearTimeout(this.cleanupHandle),this.replace(e.val),this.$element.trigger("mention-selected",this.filtered[this.index]),this.hideList()},i.prototype.onItemHover=function(e,t){this.index=e,this.hightlightItem()},e.fn[d]=function(t){return this.each(function(){e.data(this,"plugin_"+d)||e.data(this,"plugin_"+d,new i(this,t))})}}(jQuery,window),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){var t=!1,n=!1,i=0,o=2e3,r=0,a=["webkit","ms","moz","o"],s=window.requestAnimationFrame||!1,l=window.cancelAnimationFrame||!1;if(!s)for(var d in a){var c=a[d];s||(s=window[c+"RequestAnimationFrame"]),l||(l=window[c+"CancelAnimationFrame"]||window[c+"CancelRequestAnimationFrame"])}var u=window.MutationObserver||window.WebKitMutationObserver||!1,p={zindex:"auto",cursoropacitymin:0,cursoropacitymax:1,cursorcolor:"#424242",cursorwidth:"5px",cursorborder:"1px solid #fff",cursorborderradius:"5px",scrollspeed:60,mousescrollstep:24,touchbehavior:!1,hwacceleration:!0,usetransition:!0,boxzoom:!1,dblclickzoom:!0,gesturezoom:!0,grabcursorenabled:!0,autohidemode:!0,background:"",iframeautoresize:!0,cursorminheight:32,preservenativescrolling:!0,railoffset:!1,railhoffset:!1,bouncescroll:!0,spacebarenabled:!0,railpadding:{top:0,right:0,left:0,bottom:0},disableoutline:!0,horizrailenabled:!0,railalign:"right",railvalign:"bottom",enabletranslate3d:!0,enablemousewheel:!0,enablekeyboard:!0,smoothscroll:!0,sensitiverail:!0,enablemouselockapi:!0,cursorfixedheight:!1,directionlockdeadzone:6,hidecursordelay:400,nativeparentscrolling:!0,enablescrollonselection:!0,overflowx:!0,overflowy:!0,cursordragspeed:.3,rtlmode:"auto",cursordragontouch:!1,oneaxismousemode:"auto",scriptpath:function(){var e=document.getElementsByTagName("script"),e=e[e.length-1].src.split("?")[0];return 0<e.split("/").length?e.split("/").slice(0,-1).join("/")+"/":""}(),preventmultitouchscrolling:!0},h=!1,f=function(){if(h)return h;var e=document.createElement("DIV"),t=e.style,n=navigator.userAgent,i=navigator.platform,o={haspointerlock:"pointerLockElement"in document||"webkitPointerLockElement"in document||"mozPointerLockElement"in document};o.isopera="opera"in window,o.isopera12=o.isopera&&"getUserMedia"in navigator,o.isoperamini="[object OperaMini]"===Object.prototype.toString.call(window.operamini),o.isie="all"in document&&"attachEvent"in e&&!o.isopera,o.isieold=o.isie&&!("msInterpolationMode"in t),o.isie7=o.isie&&!o.isieold&&(!("documentMode"in document)||7==document.documentMode),o.isie8=o.isie&&"documentMode"in document&&8==document.documentMode,o.isie9=o.isie&&"performance"in window&&9<=document.documentMode,o.isie10=o.isie&&"performance"in window&&10==document.documentMode,o.isie11="msRequestFullscreen"in e&&11<=document.documentMode,o.isie9mobile=/iemobile.9/i.test(n),o.isie9mobile&&(o.isie9=!1),o.isie7mobile=!o.isie9mobile&&o.isie7&&/iemobile/i.test(n),o.ismozilla="MozAppearance"in t,o.iswebkit="WebkitAppearance"in t,o.ischrome="chrome"in window,o.ischrome22=o.ischrome&&o.haspointerlock,o.ischrome26=o.ischrome&&"transition"in t,o.cantouch="ontouchstart"in document.documentElement||"ontouchstart"in window,o.hasmstouch=window.MSPointerEvent||!1,o.hasw3ctouch=window.PointerEvent||!1,o.ismac=/^mac$/i.test(i),o.isios=o.cantouch&&/iphone|ipad|ipod/i.test(i),o.isios4=o.isios&&!("seal"in Object),o.isios7=o.isios&&"webkitHidden"in document,o.isandroid=/android/i.test(n),o.haseventlistener="addEventListener"in e,o.trstyle=!1,o.hastransform=!1,o.hastranslate3d=!1,o.transitionstyle=!1,o.hastransition=!1,o.transitionend=!1,i=["transform","msTransform","webkitTransform","MozTransform","OTransform"];for(n=0;n<i.length;n++)if("undefined"!=typeof t[i[n]]){o.trstyle=i[n];break}o.hastransform=!!o.trstyle,o.hastransform&&(t[o.trstyle]="translate3d(1px,2px,3px)",o.hastranslate3d=/translate3d/.test(t[o.trstyle])),o.transitionstyle=!1,o.prefixstyle="",o.transitionend=!1;for(var i="transition webkitTransition msTransition MozTransition OTransition OTransition KhtmlTransition".split(" "),r=" -webkit- -ms- -moz- -o- -o -khtml-".split(" "),a="transitionend webkitTransitionEnd msTransitionEnd transitionend otransitionend oTransitionEnd KhtmlTransitionEnd".split(" "),n=0;n<i.length;n++)if(i[n]in t){o.transitionstyle=i[n],o.prefixstyle=r[n],o.transitionend=a[n];break}o.ischrome26&&(o.prefixstyle=r[1]),o.hastransition=o.transitionstyle;e:{for(n=["-webkit-grab","-moz-grab","grab"],(o.ischrome&&!o.ischrome22||o.isie)&&(n=[]),i=0;i<n.length;i++)if(r=n[i],t.cursor=r,t.cursor==r){t=r;break e}t="url(//mail.google.com/mail/images/2/openhand.cur),n-resize"}return o.cursorgrabvalue=t,o.hasmousecapture="setCapture"in e,o.hasMutationObserver=!1!==u,h=o},m=function(a,d){function c(){var e=E.doc.css(S.trstyle);return!(!e||"matrix"!=e.substr(0,6))&&e.replace(/^.*\((.*)\)$/g,"$1").replace(/px/g,"").split(/, +/)}function h(){var e=E.win;if("zIndex"in e)return e.zIndex();for(;0<e.length&&9!=e[0].nodeType;){var t=e.css("zIndex");if(!isNaN(t)&&0!=t)return parseInt(t);e=e.parent()}return!1}function m(e,t,n){return t=e.css(t),e=parseFloat(t),isNaN(e)?(e=D[t]||0,n=3==e?n?E.win.outerHeight()-E.win.innerHeight():E.win.outerWidth()-E.win.innerWidth():1,E.isie8&&e&&(e+=1),n?e:0):e}function T(e,t,n,i){E._bind(e,t,function(i){i=i?i:window.event;var o={original:i,target:i.target||i.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==i.type?0:1,deltaX:0,deltaZ:0,preventDefault:function(){return i.preventDefault?i.preventDefault():i.returnValue=!1,!1},stopImmediatePropagation:function(){i.stopImmediatePropagation?i.stopImmediatePropagation():i.cancelBubble=!0}};return"mousewheel"==t?(o.deltaY=-.025*i.wheelDelta,i.wheelDeltaX&&(o.deltaX=-.025*i.wheelDeltaX)):o.deltaY=i.detail,n.call(e,o)},i)}function _(e,t,n){var i,o;if(0==e.deltaMode?(i=-Math.floor(E.opt.mousescrollstep/54*e.deltaX),o=-Math.floor(E.opt.mousescrollstep/54*e.deltaY)):1==e.deltaMode&&(i=-Math.floor(e.deltaX*E.opt.mousescrollstep),o=-Math.floor(e.deltaY*E.opt.mousescrollstep)),t&&E.opt.oneaxismousemode&&0==i&&o&&(i=o,o=0,n&&(0>i?E.getScrollLeft()>=E.page.maxw:0>=E.getScrollLeft())&&(o=i,i=0)),i&&(E.scrollmom&&E.scrollmom.stop(),E.lastdeltax+=i,E.debounced("mousewheelx",function(){var e=E.lastdeltax;E.lastdeltax=0,E.rail.drag||E.doScrollLeftBy(e)},15)),o){if(E.opt.nativeparentscrolling&&n&&!E.ispage&&!E.zoomactive)if(0>o){if(E.getScrollTop()>=E.page.maxh)return!0}else if(0>=E.getScrollTop())return!0;E.scrollmom&&E.scrollmom.stop(),E.lastdeltay+=o,E.debounced("mousewheely",function(){var e=E.lastdeltay;E.lastdeltay=0,E.rail.drag||E.doScrollBy(e)},15)}return e.stopImmediatePropagation(),e.preventDefault()}var E=this;if(this.version="3.6.0",this.name="nicescroll",this.me=d,this.opt={doc:e("body"),win:!1},e.extend(this.opt,p),this.opt.snapbackspeed=80,a)for(var v in E.opt)"undefined"!=typeof a[v]&&(E.opt[v]=a[v]);this.iddoc=(this.doc=E.opt.doc)&&this.doc[0]?this.doc[0].id||"":"",this.ispage=/^BODY|HTML/.test(E.opt.win?E.opt.win[0].nodeName:this.doc[0].nodeName),this.haswrapper=!1!==E.opt.win,this.win=E.opt.win||(this.ispage?e(window):this.doc),this.docscroll=this.ispage&&!this.haswrapper?e(window):this.win,this.body=e("body"),this.iframe=this.isfixed=this.viewport=!1,this.isiframe="IFRAME"==this.doc[0].nodeName&&"IFRAME"==this.win[0].nodeName,this.istextarea="TEXTAREA"==this.win[0].nodeName,this.forcescreen=!1,this.canshowonmouseevent="scroll"!=E.opt.autohidemode,this.page=this.view=this.onzoomout=this.onzoomin=this.onscrollcancel=this.onscrollend=this.onscrollstart=this.onclick=this.ongesturezoom=this.onkeypress=this.onmousewheel=this.onmousemove=this.onmouseup=this.onmousedown=!1,this.scroll={x:0,y:0},this.scrollratio={x:0,y:0},this.cursorheight=20,this.scrollvaluemax=0,this.isrtlmode="auto"==this.opt.rtlmode?"rtl"==(this.win[0]==window?this.body:this.win).css("direction"):!0===this.opt.rtlmode,this.observerbody=this.observerremover=this.observer=this.scrollmom=this.scrollrunning=!1;do this.id="ascrail"+o++;while(document.getElementById(this.id));this.hasmousefocus=this.hasfocus=this.zoomactive=this.zoom=this.selectiondrag=this.cursorfreezed=this.cursor=this.rail=!1,this.visibility=!0,this.hidden=this.locked=this.railslocked=!1,this.cursoractive=!0,this.wheelprevented=!1,this.overflowx=E.opt.overflowx,this.overflowy=E.opt.overflowy,this.nativescrollingarea=!1,this.checkarea=0,this.events=[],this.saved={},this.delaylist={},this.synclist={},this.lastdeltay=this.lastdeltax=0,this.detected=f();var S=e.extend({},this.detected);this.ishwscroll=(this.canhwscroll=S.hastransform&&E.opt.hwacceleration)&&E.haswrapper,this.hasreversehr=this.isrtlmode&&!S.iswebkit,this.istouchcapable=!1,!S.cantouch||S.isios||S.isandroid||!S.iswebkit&&!S.ismozilla||(this.istouchcapable=!0,S.cantouch=!1),E.opt.enablemouselockapi||(S.hasmousecapture=!1,S.haspointerlock=!1),this.debounced=function(e,t,n){var i=E.delaylist[e];E.delaylist[e]=t,i||setTimeout(function(){var t=E.delaylist[e];E.delaylist[e]=!1,t.call(E)},n)};var b=!1;this.synched=function(e,t){return E.synclist[e]=t,function(){b||(s(function(){b=!1;for(var e in E.synclist){var t=E.synclist[e];t&&t.call(E),E.synclist[e]=!1}}),b=!0)}(),e},this.unsynched=function(e){E.synclist[e]&&(E.synclist[e]=!1)},this.css=function(e,t){for(var n in t)E.saved.css.push([e,n,e.css(n)]),e.css(n,t[n])},this.scrollTop=function(e){return"undefined"==typeof e?E.getScrollTop():E.setScrollTop(e)},this.scrollLeft=function(e){return"undefined"==typeof e?E.getScrollLeft():E.setScrollLeft(e)};var R=function(e,t,n,i,o,r,a){this.st=e,this.ed=t,this.spd=n,this.p1=i||0,this.p2=o||1,this.p3=r||0,this.p4=a||1,this.ts=(new Date).getTime(),this.df=this.ed-this.st};if(R.prototype={B2:function(e){return 3*e*e*(1-e)},B3:function(e){return 3*e*(1-e)*(1-e)},B4:function(e){return(1-e)*(1-e)*(1-e)},getNow:function(){var e=1-((new Date).getTime()-this.ts)/this.spd,t=this.B2(e)+this.B3(e)+this.B4(e);return 0>e?this.ed:this.st+Math.round(this.df*t)},update:function(e,t){return this.st=this.getNow(),this.ed=e,this.spd=t,this.ts=(new Date).getTime(),this.df=this.ed-this.st,this}},this.ishwscroll){this.doc.translate={x:0,y:0,tx:"0px",ty:"0px"},S.hastranslate3d&&S.isios&&this.doc.css("-webkit-backface-visibility","hidden"),this.getScrollTop=function(e){if(!e){if(e=c())return 16==e.length?-e[13]:-e[5];if(E.timerscroll&&E.timerscroll.bz)return E.timerscroll.bz.getNow()}return E.doc.translate.y},this.getScrollLeft=function(e){if(!e){if(e=c())return 16==e.length?-e[12]:-e[4];if(E.timerscroll&&E.timerscroll.bh)return E.timerscroll.bh.getNow()}return E.doc.translate.x},this.notifyScrollEvent=function(e){var t=document.createEvent("UIEvents");t.initUIEvent("scroll",!1,!0,window,1),t.niceevent=!0,e.dispatchEvent(t)};var O=this.isrtlmode?1:-1;S.hastranslate3d&&E.opt.enabletranslate3d?(this.setScrollTop=function(e,t){E.doc.translate.y=e,E.doc.translate.ty=-1*e+"px",E.doc.css(S.trstyle,"translate3d("+E.doc.translate.tx+","+E.doc.translate.ty+",0px)"),t||E.notifyScrollEvent(E.win[0])},this.setScrollLeft=function(e,t){E.doc.translate.x=e,E.doc.translate.tx=e*O+"px",E.doc.css(S.trstyle,"translate3d("+E.doc.translate.tx+","+E.doc.translate.ty+",0px)"),t||E.notifyScrollEvent(E.win[0])}):(this.setScrollTop=function(e,t){E.doc.translate.y=e,E.doc.translate.ty=-1*e+"px",E.doc.css(S.trstyle,"translate("+E.doc.translate.tx+","+E.doc.translate.ty+")"),t||E.notifyScrollEvent(E.win[0])},this.setScrollLeft=function(e,t){E.doc.translate.x=e,E.doc.translate.tx=e*O+"px",E.doc.css(S.trstyle,"translate("+E.doc.translate.tx+","+E.doc.translate.ty+")"),t||E.notifyScrollEvent(E.win[0])})}else this.getScrollTop=function(){return E.docscroll.scrollTop()},this.setScrollTop=function(e){return E.docscroll.scrollTop(e)},this.getScrollLeft=function(){return E.detected.ismozilla&&E.isrtlmode?Math.abs(E.docscroll.scrollLeft()):E.docscroll.scrollLeft()},this.setScrollLeft=function(e){return E.docscroll.scrollLeft(E.detected.ismozilla&&E.isrtlmode?-e:e)};this.getTarget=function(e){return!!e&&(e.target?e.target:!!e.srcElement&&e.srcElement)},this.hasParent=function(e,t){if(!e)return!1;for(var n=e.target||e.srcElement||e||!1;n&&n.id!=t;)n=n.parentNode||!1;return!1!==n};var D={thin:1,medium:3,thick:5};this.getDocumentScrollOffset=function(){return{top:window.pageYOffset||document.documentElement.scrollTop,left:window.pageXOffset||document.documentElement.scrollLeft}},this.getOffset=function(){if(E.isfixed){var e=E.win.offset(),t=E.getDocumentScrollOffset();return e.top-=t.top,e.left-=t.left,e}return e=E.win.offset(),E.viewport?(t=E.viewport.offset(),{top:e.top-t.top,left:e.left-t.left}):e},this.updateScrollBar=function(e){if(E.ishwscroll)E.rail.css({height:E.win.innerHeight()-(E.opt.railpadding.top+E.opt.railpadding.bottom)}),E.railh&&E.railh.css({width:E.win.innerWidth()-(E.opt.railpadding.left+E.opt.railpadding.right)});else{var t=E.getOffset(),n=t.top,i=t.left-(E.opt.railpadding.left+E.opt.railpadding.right),n=n+m(E.win,"border-top-width",!0),i=i+(E.rail.align?E.win.outerWidth()-m(E.win,"border-right-width")-E.rail.width:m(E.win,"border-left-width")),o=E.opt.railoffset;o&&(o.top&&(n+=o.top),E.rail.align&&o.left&&(i+=o.left)),E.railslocked||E.rail.css({top:n,left:i,height:(e?e.h:E.win.innerHeight())-(E.opt.railpadding.top+E.opt.railpadding.bottom)}),E.zoom&&E.zoom.css({top:n+1,left:1==E.rail.align?i-20:i+E.rail.width+4}),E.railh&&!E.railslocked&&(n=t.top,i=t.left,(o=E.opt.railhoffset)&&(o.top&&(n+=o.top),o.left&&(i+=o.left)),e=E.railh.align?n+m(E.win,"border-top-width",!0)+E.win.innerHeight()-E.railh.height:n+m(E.win,"border-top-width",!0),i+=m(E.win,"border-left-width"),E.railh.css({top:e-(E.opt.railpadding.top+E.opt.railpadding.bottom),left:i,width:E.railh.width}))}},this.doRailClick=function(e,t,n){var i;E.railslocked||(E.cancelEvent(e),t?(t=n?E.doScrollLeft:E.doScrollTop,i=n?(e.pageX-E.railh.offset().left-E.cursorwidth/2)*E.scrollratio.x:(e.pageY-E.rail.offset().top-E.cursorheight/2)*E.scrollratio.y,t(i)):(t=n?E.doScrollLeftBy:E.doScrollBy,i=n?E.scroll.x:E.scroll.y,e=n?e.pageX-E.railh.offset().left:e.pageY-E.rail.offset().top,n=n?E.view.w:E.view.h,t(i>=e?n:-n)))},E.hasanimationframe=s,E.hascancelanimationframe=l,E.hasanimationframe?E.hascancelanimationframe||(l=function(){E.cancelAnimationFrame=!0}):(s=function(e){return setTimeout(e,15-Math.floor(+new Date/1e3)%16)},l=clearInterval),this.init=function(){if(E.saved.css=[],S.isie7mobile||S.isoperamini)return!0;if(S.hasmstouch&&E.css(E.ispage?e("html"):E.win,{"-ms-touch-action":"none"}),E.zindex="auto",E.zindex=E.ispage||"auto"!=E.opt.zindex?E.opt.zindex:h()||"auto",!E.ispage&&"auto"!=E.zindex&&E.zindex>r&&(r=E.zindex),E.isie&&0==E.zindex&&"auto"==E.opt.zindex&&(E.zindex="auto"),!E.ispage||!S.cantouch&&!S.isieold&&!S.isie9mobile){var o=E.docscroll;E.ispage&&(o=E.haswrapper?E.win:E.doc),S.isie9mobile||E.css(o,{"overflow-y":"hidden"}),E.ispage&&S.isie7&&("BODY"==E.doc[0].nodeName?E.css(e("html"),{"overflow-y":"hidden"}):"HTML"==E.doc[0].nodeName&&E.css(e("body"),{"overflow-y":"hidden"})),!S.isios||E.ispage||E.haswrapper||E.css(e("body"),{"-webkit-overflow-scrolling":"touch"});var a=e(document.createElement("div"));a.css({position:"relative",top:0,float:"right",width:E.opt.cursorwidth,height:"0px","background-color":E.opt.cursorcolor,border:E.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":E.opt.cursorborderradius,"-moz-border-radius":E.opt.cursorborderradius,"border-radius":E.opt.cursorborderradius}),a.hborder=parseFloat(a.outerHeight()-a.innerHeight()),a.addClass("nicescroll-cursors"),E.cursor=a;var s=e(document.createElement("div"));s.attr("id",E.id),s.addClass("nicescroll-rails nicescroll-rails-vr");var l,d,c,p=["left","right","top","bottom"];for(c in p)d=p[c],(l=E.opt.railpadding[d])?s.css("padding-"+d,l+"px"):E.opt.railpadding[d]=0;s.append(a),s.width=Math.max(parseFloat(E.opt.cursorwidth),a.outerWidth()),s.css({width:s.width+"px",zIndex:E.zindex,background:E.opt.background,cursor:"default"}),s.visibility=!0,s.scrollable=!0,s.align="left"==E.opt.railalign?0:1,E.rail=s,a=E.rail.drag=!1,!E.opt.boxzoom||E.ispage||S.isieold||(a=document.createElement("div"),E.bind(a,"click",E.doZoom),E.bind(a,"mouseenter",function(){E.zoom.css("opacity",E.opt.cursoropacitymax)}),E.bind(a,"mouseleave",function(){E.zoom.css("opacity",E.opt.cursoropacitymin)}),E.zoom=e(a),E.zoom.css({cursor:"pointer","z-index":E.zindex,backgroundImage:"url("+E.opt.scriptpath+"zoomico.png)",height:18,width:18,backgroundPosition:"0px 0px"}),E.opt.dblclickzoom&&E.bind(E.win,"dblclick",E.doZoom),S.cantouch&&E.opt.gesturezoom&&(E.ongesturezoom=function(e){return 1.5<e.scale&&E.doZoomIn(e),.8>e.scale&&E.doZoomOut(e),E.cancelEvent(e)},E.bind(E.win,"gestureend",E.ongesturezoom))),E.railh=!1;var f;if(E.opt.horizrailenabled&&(E.css(o,{"overflow-x":"hidden"}),a=e(document.createElement("div")),a.css({position:"absolute",top:0,height:E.opt.cursorwidth,width:"0px","background-color":E.opt.cursorcolor,border:E.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":E.opt.cursorborderradius,"-moz-border-radius":E.opt.cursorborderradius,"border-radius":E.opt.cursorborderradius}),S.isieold&&a.css({overflow:"hidden"}),a.wborder=parseFloat(a.outerWidth()-a.innerWidth()),a.addClass("nicescroll-cursors"),E.cursorh=a,f=e(document.createElement("div")),f.attr("id",E.id+"-hr"),f.addClass("nicescroll-rails nicescroll-rails-hr"),f.height=Math.max(parseFloat(E.opt.cursorwidth),a.outerHeight()),f.css({height:f.height+"px",zIndex:E.zindex,background:E.opt.background}),f.append(a),f.visibility=!0,f.scrollable=!0,f.align="top"==E.opt.railvalign?0:1,E.railh=f,E.railh.drag=!1),E.ispage?(s.css({position:"fixed",top:"0px",height:"100%"}),s.align?s.css({right:"0px"}):s.css({left:"0px"}),E.body.append(s),E.railh&&(f.css({position:"fixed",left:"0px",width:"100%"}),f.align?f.css({bottom:"0px"}):f.css({top:"0px"}),E.body.append(f))):(E.ishwscroll?("static"==E.win.css("position")&&E.css(E.win,{position:"relative"}),o="HTML"==E.win[0].nodeName?E.body:E.win,e(o).scrollTop(0).scrollLeft(0),E.zoom&&(E.zoom.css({position:"absolute",top:1,right:0,"margin-right":s.width+4}),o.append(E.zoom)),s.css({position:"absolute",top:0}),s.align?s.css({right:0}):s.css({left:0}),o.append(s),f&&(f.css({position:"absolute",left:0,bottom:0}),f.align?f.css({bottom:0}):f.css({top:0}),o.append(f))):(E.isfixed="fixed"==E.win.css("position"),o=E.isfixed?"fixed":"absolute",E.isfixed||(E.viewport=E.getViewport(E.win[0])),E.viewport&&(E.body=E.viewport,0==/fixed|absolute/.test(E.viewport.css("position"))&&E.css(E.viewport,{position:"relative"})),s.css({position:o}),E.zoom&&E.zoom.css({position:o}),E.updateScrollBar(),E.body.append(s),E.zoom&&E.body.append(E.zoom),E.railh&&(f.css({position:o}),E.body.append(f))),S.isios&&E.css(E.win,{"-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none"}),S.isie&&E.opt.disableoutline&&E.win.attr("hideFocus","true"),S.iswebkit&&E.opt.disableoutline&&E.win.css({outline:"none"})),!1===E.opt.autohidemode?(E.autohidedom=!1,E.rail.css({opacity:E.opt.cursoropacitymax}),E.railh&&E.railh.css({opacity:E.opt.cursoropacitymax})):!0===E.opt.autohidemode||"leave"===E.opt.autohidemode?(E.autohidedom=e().add(E.rail),S.isie8&&(E.autohidedom=E.autohidedom.add(E.cursor)),E.railh&&(E.autohidedom=E.autohidedom.add(E.railh)),E.railh&&S.isie8&&(E.autohidedom=E.autohidedom.add(E.cursorh))):"scroll"==E.opt.autohidemode?(E.autohidedom=e().add(E.rail),E.railh&&(E.autohidedom=E.autohidedom.add(E.railh))):"cursor"==E.opt.autohidemode?(E.autohidedom=e().add(E.cursor),E.railh&&(E.autohidedom=E.autohidedom.add(E.cursorh))):"hidden"==E.opt.autohidemode&&(E.autohidedom=!1,E.hide(),E.railslocked=!1),S.isie9mobile)E.scrollmom=new g(E),E.onmangotouch=function(){var e=E.getScrollTop(),t=E.getScrollLeft();if(e==E.scrollmom.lastscrolly&&t==E.scrollmom.lastscrollx)return!0;var n=e-E.mangotouch.sy,i=t-E.mangotouch.sx;if(0!=Math.round(Math.sqrt(Math.pow(i,2)+Math.pow(n,2)))){var o=0>n?-1:1,r=0>i?-1:1,a=+new Date;E.mangotouch.lazy&&clearTimeout(E.mangotouch.lazy),80<a-E.mangotouch.tm||E.mangotouch.dry!=o||E.mangotouch.drx!=r?(E.scrollmom.stop(),E.scrollmom.reset(t,e),E.mangotouch.sy=e,E.mangotouch.ly=e,E.mangotouch.sx=t,E.mangotouch.lx=t,E.mangotouch.dry=o,E.mangotouch.drx=r,E.mangotouch.tm=a):(E.scrollmom.stop(),E.scrollmom.update(E.mangotouch.sx-i,E.mangotouch.sy-n),E.mangotouch.tm=a,n=Math.max(Math.abs(E.mangotouch.ly-e),Math.abs(E.mangotouch.lx-t)),E.mangotouch.ly=e,E.mangotouch.lx=t,2<n&&(E.mangotouch.lazy=setTimeout(function(){E.mangotouch.lazy=!1,E.mangotouch.dry=0,E.mangotouch.drx=0,E.mangotouch.tm=0,E.scrollmom.doMomentum(30)},100)))}},s=E.getScrollTop(),f=E.getScrollLeft(),E.mangotouch={sy:s,ly:s,dry:0,sx:f,lx:f,drx:0,lazy:!1,tm:0},E.bind(E.docscroll,"scroll",E.onmangotouch);else{if(S.cantouch||E.istouchcapable||E.opt.touchbehavior||S.hasmstouch){E.scrollmom=new g(E),E.ontouchstart=function(t){if(t.pointerType&&2!=t.pointerType&&"touch"!=t.pointerType)return!1;if(E.hasmoving=!1,!E.railslocked){var n;if(S.hasmstouch)for(n=!!t.target&&t.target;n;){var i=e(n).getNiceScroll();if(0<i.length&&i[0].me==E.me)break;if(0<i.length)return!1;if("DIV"==n.nodeName&&n.id==E.id)break;n=!!n.parentNode&&n.parentNode}if(E.cancelScroll(),(n=E.getTarget(t))&&/INPUT/i.test(n.nodeName)&&/range/i.test(n.type))return E.stopPropagation(t);if(!("clientX"in t)&&"changedTouches"in t&&(t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY),E.forcescreen&&(i=t,t={original:t.original?t.original:t},t.clientX=i.screenX,t.clientY=i.screenY),E.rail.drag={x:t.clientX,y:t.clientY,sx:E.scroll.x,sy:E.scroll.y,st:E.getScrollTop(),sl:E.getScrollLeft(),pt:2,dl:!1},E.ispage||!E.opt.directionlockdeadzone)E.rail.drag.dl="f";else{var i=e(window).width(),o=e(window).height(),r=Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),a=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight),o=Math.max(0,a-o),i=Math.max(0,r-i);E.rail.drag.ck=!E.rail.scrollable&&E.railh.scrollable?0<o&&"v":!(!E.rail.scrollable||E.railh.scrollable)&&(0<i&&"h"),E.rail.drag.ck||(E.rail.drag.dl="f")}if(E.opt.touchbehavior&&E.isiframe&&S.isie&&(i=E.win.position(),E.rail.drag.x+=i.left,E.rail.drag.y+=i.top),E.hasmoving=!1,E.lastmouseup=!1,E.scrollmom.reset(t.clientX,t.clientY),!S.cantouch&&!this.istouchcapable&&!t.pointerType){if(!n||!/INPUT|SELECT|TEXTAREA/i.test(n.nodeName))return!E.ispage&&S.hasmousecapture&&n.setCapture(),E.opt.touchbehavior?(n.onclick&&!n._onclick&&(n._onclick=n.onclick,n.onclick=function(e){return!E.hasmoving&&void n._onclick.call(this,e)}),E.cancelEvent(t)):E.stopPropagation(t);/SUBMIT|CANCEL|BUTTON/i.test(e(n).attr("type"))&&(pc={tg:n,click:!1},E.preventclick=pc)}}},E.ontouchend=function(e){if(!E.rail.drag)return!0;if(2==E.rail.drag.pt){if(e.pointerType&&2!=e.pointerType&&"touch"!=e.pointerType)return!1;if(E.scrollmom.doMomentum(),E.rail.drag=!1,E.hasmoving&&(E.lastmouseup=!0,E.hideCursor(),S.hasmousecapture&&document.releaseCapture(),!S.cantouch))return E.cancelEvent(e)}else if(1==E.rail.drag.pt)return E.onmouseup(e)};var m=E.opt.touchbehavior&&E.isiframe&&!S.hasmousecapture;E.ontouchmove=function(t,n){if(!E.rail.drag||t.targetTouches&&E.opt.preventmultitouchscrolling&&1<t.targetTouches.length||t.pointerType&&2!=t.pointerType&&"touch"!=t.pointerType)return!1;if(2==E.rail.drag.pt){if(S.cantouch&&S.isios&&"undefined"==typeof t.original)return!0;if(E.hasmoving=!0,E.preventclick&&!E.preventclick.click&&(E.preventclick.click=E.preventclick.tg.onclick||!1,E.preventclick.tg.onclick=E.onpreventclick),t=e.extend({original:t},t),"changedTouches"in t&&(t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY),E.forcescreen){var i=t;t={original:t.original?t.original:t},t.clientX=i.screenX,t.clientY=i.screenY}var o,i=o=0;m&&!n&&(o=E.win.position(),i=-o.left,o=-o.top);var r=t.clientY+o;o=r-E.rail.drag.y;var a=t.clientX+i,s=a-E.rail.drag.x,l=E.rail.drag.st-o;E.ishwscroll&&E.opt.bouncescroll?0>l?l=Math.round(l/2):l>E.page.maxh&&(l=E.page.maxh+Math.round((l-E.page.maxh)/2)):(0>l&&(r=l=0),l>E.page.maxh&&(l=E.page.maxh,r=0));var d;if(E.railh&&E.railh.scrollable&&(d=E.isrtlmode?s-E.rail.drag.sl:E.rail.drag.sl-s,E.ishwscroll&&E.opt.bouncescroll?0>d?d=Math.round(d/2):d>E.page.maxw&&(d=E.page.maxw+Math.round((d-E.page.maxw)/2)):(0>d&&(a=d=0),d>E.page.maxw&&(d=E.page.maxw,a=0))),i=!1,E.rail.drag.dl)i=!0,"v"==E.rail.drag.dl?d=E.rail.drag.sl:"h"==E.rail.drag.dl&&(l=E.rail.drag.st);else{o=Math.abs(o);var s=Math.abs(s),c=E.opt.directionlockdeadzone;if("v"==E.rail.drag.ck){if(o>c&&s<=.3*o)return E.rail.drag=!1,!0;s>c&&(E.rail.drag.dl="f",e("body").scrollTop(e("body").scrollTop()))}else if("h"==E.rail.drag.ck){if(s>c&&o<=.3*s)return E.rail.drag=!1,!0;o>c&&(E.rail.drag.dl="f",e("body").scrollLeft(e("body").scrollLeft()))}}if(E.synched("touchmove",function(){E.rail.drag&&2==E.rail.drag.pt&&(E.prepareTransition&&E.prepareTransition(0),E.rail.scrollable&&E.setScrollTop(l),E.scrollmom.update(a,r),E.railh&&E.railh.scrollable?(E.setScrollLeft(d),E.showCursor(l,d)):E.showCursor(l),S.isie10&&document.selection.clear())}),S.ischrome&&E.istouchcapable&&(i=!1),i)return E.cancelEvent(t)}else if(1==E.rail.drag.pt)return E.onmousemove(t)}}if(E.onmousedown=function(e,t){if(!E.rail.drag||1==E.rail.drag.pt){if(E.railslocked)return E.cancelEvent(e);E.cancelScroll(),E.rail.drag={x:e.clientX,y:e.clientY,sx:E.scroll.x,sy:E.scroll.y,pt:1,hr:!!t};var n=E.getTarget(e);return!E.ispage&&S.hasmousecapture&&n.setCapture(),E.isiframe&&!S.hasmousecapture&&(E.saved.csspointerevents=E.doc.css("pointer-events"),E.css(E.doc,{"pointer-events":"none"})),E.hasmoving=!1,E.cancelEvent(e)}},E.onmouseup=function(e){if(E.rail.drag)return 1!=E.rail.drag.pt||(S.hasmousecapture&&document.releaseCapture(),E.isiframe&&!S.hasmousecapture&&E.doc.css("pointer-events",E.saved.csspointerevents),E.rail.drag=!1,E.hasmoving&&E.triggerScrollEnd(),E.cancelEvent(e))},E.onmousemove=function(e){if(E.rail.drag&&1==E.rail.drag.pt){if(S.ischrome&&0==e.which)return E.onmouseup(e);if(E.cursorfreezed=!0,E.hasmoving=!0,E.rail.drag.hr){E.scroll.x=E.rail.drag.sx+(e.clientX-E.rail.drag.x),0>E.scroll.x&&(E.scroll.x=0);var t=E.scrollvaluemaxw;E.scroll.x>t&&(E.scroll.x=t)}else E.scroll.y=E.rail.drag.sy+(e.clientY-E.rail.drag.y),0>E.scroll.y&&(E.scroll.y=0),t=E.scrollvaluemax,E.scroll.y>t&&(E.scroll.y=t);return E.synched("mousemove",function(){E.rail.drag&&1==E.rail.drag.pt&&(E.showCursor(),E.rail.drag.hr?E.hasreversehr?E.doScrollLeft(E.scrollvaluemaxw-Math.round(E.scroll.x*E.scrollratio.x),E.opt.cursordragspeed):E.doScrollLeft(Math.round(E.scroll.x*E.scrollratio.x),E.opt.cursordragspeed):E.doScrollTop(Math.round(E.scroll.y*E.scrollratio.y),E.opt.cursordragspeed))}),E.cancelEvent(e)}},S.cantouch||E.opt.touchbehavior)E.onpreventclick=function(e){if(E.preventclick)return E.preventclick.tg.onclick=E.preventclick.click,E.preventclick=!1,E.cancelEvent(e)},E.bind(E.win,"mousedown",E.ontouchstart),E.onclick=!S.isios&&function(e){return!E.lastmouseup||(E.lastmouseup=!1,E.cancelEvent(e))},E.opt.grabcursorenabled&&S.cursorgrabvalue&&(E.css(E.ispage?E.doc:E.win,{cursor:S.cursorgrabvalue}),E.css(E.rail,{cursor:S.cursorgrabvalue}));else{var T=function(e){if(E.selectiondrag){if(e){var t=E.win.outerHeight();e=e.pageY-E.selectiondrag.top,0<e&&e<t&&(e=0),e>=t&&(e-=t),E.selectiondrag.df=e}0!=E.selectiondrag.df&&(E.doScrollBy(2*-Math.floor(E.selectiondrag.df/6)),E.debounced("doselectionscroll",function(){T()},50))}};E.hasTextSelected="getSelection"in document?function(){return 0<document.getSelection().rangeCount}:"selection"in document?function(){return"None"!=document.selection.type}:function(){return!1},E.onselectionstart=function(e){E.ispage||(E.selectiondrag=E.win.offset())},E.onselectionend=function(e){E.selectiondrag=!1},E.onselectiondrag=function(e){E.selectiondrag&&E.hasTextSelected()&&E.debounced("selectionscroll",function(){T(e)},250)}}S.hasw3ctouch?(E.css(E.rail,{"touch-action":"none"}),E.css(E.cursor,{"touch-action":"none"}),E.bind(E.win,"pointerdown",E.ontouchstart),E.bind(document,"pointerup",E.ontouchend),E.bind(document,"pointermove",E.ontouchmove)):S.hasmstouch?(E.css(E.rail,{"-ms-touch-action":"none"}),E.css(E.cursor,{"-ms-touch-action":"none"}),E.bind(E.win,"MSPointerDown",E.ontouchstart),E.bind(document,"MSPointerUp",E.ontouchend),E.bind(document,"MSPointerMove",E.ontouchmove),E.bind(E.cursor,"MSGestureHold",function(e){e.preventDefault()}),E.bind(E.cursor,"contextmenu",function(e){e.preventDefault()})):this.istouchcapable&&(E.bind(E.win,"touchstart",E.ontouchstart),E.bind(document,"touchend",E.ontouchend),E.bind(document,"touchcancel",E.ontouchend),E.bind(document,"touchmove",E.ontouchmove)),(E.opt.cursordragontouch||!S.cantouch&&!E.opt.touchbehavior)&&(E.rail.css({cursor:"default"}),E.railh&&E.railh.css({cursor:"default"}),E.jqbind(E.rail,"mouseenter",function(){return!(!E.ispage&&!E.win.is(":visible"))&&(E.canshowonmouseevent&&E.showCursor(),void(E.rail.active=!0))}),E.jqbind(E.rail,"mouseleave",function(){E.rail.active=!1,E.rail.drag||E.hideCursor()}),E.opt.sensitiverail&&(E.bind(E.rail,"click",function(e){E.doRailClick(e,!1,!1)}),E.bind(E.rail,"dblclick",function(e){E.doRailClick(e,!0,!1)}),E.bind(E.cursor,"click",function(e){E.cancelEvent(e)}),E.bind(E.cursor,"dblclick",function(e){E.cancelEvent(e)})),E.railh&&(E.jqbind(E.railh,"mouseenter",function(){return!(!E.ispage&&!E.win.is(":visible"))&&(E.canshowonmouseevent&&E.showCursor(),void(E.rail.active=!0))}),E.jqbind(E.railh,"mouseleave",function(){E.rail.active=!1,E.rail.drag||E.hideCursor()}),E.opt.sensitiverail&&(E.bind(E.railh,"click",function(e){E.doRailClick(e,!1,!0)}),E.bind(E.railh,"dblclick",function(e){E.doRailClick(e,!0,!0)}),E.bind(E.cursorh,"click",function(e){E.cancelEvent(e)}),E.bind(E.cursorh,"dblclick",function(e){E.cancelEvent(e)})))),S.cantouch||E.opt.touchbehavior?(E.bind(S.hasmousecapture?E.win:document,"mouseup",E.ontouchend),E.bind(document,"mousemove",E.ontouchmove),E.onclick&&E.bind(document,"click",E.onclick),E.opt.cursordragontouch&&(E.bind(E.cursor,"mousedown",E.onmousedown),E.bind(E.cursor,"mouseup",E.onmouseup),E.cursorh&&E.bind(E.cursorh,"mousedown",function(e){E.onmousedown(e,!0)}),E.cursorh&&E.bind(E.cursorh,"mouseup",E.onmouseup))):(E.bind(S.hasmousecapture?E.win:document,"mouseup",E.onmouseup),E.bind(document,"mousemove",E.onmousemove),E.onclick&&E.bind(document,"click",E.onclick),E.bind(E.cursor,"mousedown",E.onmousedown),E.bind(E.cursor,"mouseup",E.onmouseup),E.railh&&(E.bind(E.cursorh,"mousedown",function(e){E.onmousedown(e,!0)}),E.bind(E.cursorh,"mouseup",E.onmouseup)),!E.ispage&&E.opt.enablescrollonselection&&(E.bind(E.win[0],"mousedown",E.onselectionstart),E.bind(document,"mouseup",E.onselectionend),E.bind(E.cursor,"mouseup",E.onselectionend),E.cursorh&&E.bind(E.cursorh,"mouseup",E.onselectionend),E.bind(document,"mousemove",E.onselectiondrag)),E.zoom&&(E.jqbind(E.zoom,"mouseenter",function(){E.canshowonmouseevent&&E.showCursor(),E.rail.active=!0}),E.jqbind(E.zoom,"mouseleave",function(){E.rail.active=!1,E.rail.drag||E.hideCursor()}))),E.opt.enablemousewheel&&(E.isiframe||E.bind(S.isie&&E.ispage?document:E.win,"mousewheel",E.onmousewheel),E.bind(E.rail,"mousewheel",E.onmousewheel),E.railh&&E.bind(E.railh,"mousewheel",E.onmousewheelhr)),E.ispage||S.cantouch||/HTML|^BODY/.test(E.win[0].nodeName)||(E.win.attr("tabindex")||E.win.attr({tabindex:i++}),E.jqbind(E.win,"focus",function(e){t=E.getTarget(e).id||!0,E.hasfocus=!0,E.canshowonmouseevent&&E.noticeCursor()}),E.jqbind(E.win,"blur",function(e){t=!1,E.hasfocus=!1}),E.jqbind(E.win,"mouseenter",function(e){n=E.getTarget(e).id||!0,E.hasmousefocus=!0,E.canshowonmouseevent&&E.noticeCursor()}),E.jqbind(E.win,"mouseleave",function(){n=!1,E.hasmousefocus=!1,E.rail.drag||E.hideCursor()}))}if(E.onkeypress=function(i){if(E.railslocked&&0==E.page.maxh)return!0;i=i?i:window.e;var o=E.getTarget(i);if(o&&/INPUT|TEXTAREA|SELECT|OPTION/.test(o.nodeName)&&(!o.getAttribute("type")&&!o.type||!/submit|button|cancel/i.tp)||e(o).attr("contenteditable"))return!0;if(E.hasfocus||E.hasmousefocus&&!t||E.ispage&&!t&&!n){if(o=i.keyCode,E.railslocked&&27!=o)return E.cancelEvent(i);var r=i.ctrlKey||!1,a=i.shiftKey||!1,s=!1;switch(o){case 38:case 63233:E.doScrollBy(72),s=!0;break;case 40:case 63235:E.doScrollBy(-72),s=!0;break;case 37:case 63232:E.railh&&(r?E.doScrollLeft(0):E.doScrollLeftBy(72),s=!0);break;case 39:case 63234:E.railh&&(r?E.doScrollLeft(E.page.maxw):E.doScrollLeftBy(-72),s=!0);break;case 33:case 63276:E.doScrollBy(E.view.h),s=!0;break;case 34:case 63277:E.doScrollBy(-E.view.h),s=!0;break;case 36:case 63273:E.railh&&r?E.doScrollPos(0,0):E.doScrollTo(0),s=!0;break;case 35:case 63275:E.railh&&r?E.doScrollPos(E.page.maxw,E.page.maxh):E.doScrollTo(E.page.maxh),s=!0;break;case 32:E.opt.spacebarenabled&&(a?E.doScrollBy(E.view.h):E.doScrollBy(-E.view.h),s=!0);break;case 27:E.zoomactive&&(E.doZoom(),s=!0)}if(s)return E.cancelEvent(i)}},E.opt.enablekeyboard&&E.bind(document,S.isopera&&!S.isopera12?"keypress":"keydown",E.onkeypress),E.bind(document,"keydown",function(e){e.ctrlKey&&(E.wheelprevented=!0)}),E.bind(document,"keyup",function(e){e.ctrlKey||(E.wheelprevented=!1)}),E.bind(window,"blur",function(e){E.wheelprevented=!1}),E.bind(window,"resize",E.lazyResize),E.bind(window,"orientationchange",E.lazyResize),E.bind(window,"load",E.lazyResize),S.ischrome&&!E.ispage&&!E.haswrapper){var _=E.win.attr("style"),s=parseFloat(E.win.css("width"))+1;E.win.css("width",s),E.synched("chromefix",function(){E.win.attr("style",_)})}E.onAttributeChange=function(e){E.lazyResize(E.isieold?250:30)},!1!==u&&(E.observerbody=new u(function(t){if(t.forEach(function(t){if("attributes"==t.type)return e("body").hasClass("modal-open")?E.hide():E.show()}),document.body.scrollHeight!=E.page.maxh)return E.lazyResize(30)}),E.observerbody.observe(document.body,{childList:!0,subtree:!0,characterData:!1,attributes:!0,attributeFilter:["class"]})),E.ispage||E.haswrapper||(!1!==u?(E.observer=new u(function(e){e.forEach(E.onAttributeChange)}),E.observer.observe(E.win[0],{childList:!0,characterData:!1,attributes:!0,subtree:!1}),E.observerremover=new u(function(e){e.forEach(function(e){if(0<e.removedNodes.length)for(var t in e.removedNodes)if(E&&e.removedNodes[t]==E.win[0])return E.remove()})}),E.observerremover.observe(E.win[0].parentNode,{childList:!0,characterData:!1,attributes:!1,subtree:!1})):(E.bind(E.win,S.isie&&!S.isie9?"propertychange":"DOMAttrModified",E.onAttributeChange),S.isie9&&E.win[0].attachEvent("onpropertychange",E.onAttributeChange),E.bind(E.win,"DOMNodeRemoved",function(e){e.target==E.win[0]&&E.remove()}))),!E.ispage&&E.opt.boxzoom&&E.bind(window,"resize",E.resizeZoom),E.istextarea&&E.bind(E.win,"mouseup",E.lazyResize),E.lazyResize(30)}if("IFRAME"==this.doc[0].nodeName){var v=function(){E.iframexd=!1;var t;try{t="contentDocument"in this?this.contentDocument:this.contentWindow.document}catch(e){E.iframexd=!0,t=!1}if(E.iframexd)return"console"in window&&console.log("NiceScroll error: policy restriced iframe"),!0;if(E.forcescreen=!0,E.isiframe&&(E.iframe={doc:e(t),html:E.doc.contents().find("html")[0],body:E.doc.contents().find("body")[0]},E.getContentSize=function(){return{w:Math.max(E.iframe.html.scrollWidth,E.iframe.body.scrollWidth),h:Math.max(E.iframe.html.scrollHeight,E.iframe.body.scrollHeight)}},E.docscroll=e(E.iframe.body)),!S.isios&&E.opt.iframeautoresize&&!E.isiframe){E.win.scrollTop(0),E.doc.height("");var n=Math.max(t.getElementsByTagName("html")[0].scrollHeight,t.body.scrollHeight);E.doc.height(n)}E.lazyResize(30),S.isie7&&E.css(e(E.iframe.html),{"overflow-y":"hidden"}),E.css(e(E.iframe.body),{"overflow-y":"hidden"}),S.isios&&E.haswrapper&&E.css(e(t.body),{"-webkit-transform":"translate3d(0,0,0)"}),"contentWindow"in this?E.bind(this.contentWindow,"scroll",E.onscroll):E.bind(t,"scroll",E.onscroll),E.opt.enablemousewheel&&E.bind(t,"mousewheel",E.onmousewheel),E.opt.enablekeyboard&&E.bind(t,S.isopera?"keypress":"keydown",E.onkeypress),(S.cantouch||E.opt.touchbehavior)&&(E.bind(t,"mousedown",E.ontouchstart),E.bind(t,"mousemove",function(e){return E.ontouchmove(e,!0)}),E.opt.grabcursorenabled&&S.cursorgrabvalue&&E.css(e(t.body),{cursor:S.cursorgrabvalue})),E.bind(t,"mouseup",E.ontouchend),E.zoom&&(E.opt.dblclickzoom&&E.bind(t,"dblclick",E.doZoom),E.ongesturezoom&&E.bind(t,"gestureend",E.ongesturezoom))};this.doc[0].readyState&&"complete"==this.doc[0].readyState&&setTimeout(function(){v.call(E.doc[0],!1)},500),E.bind(this.doc,"load",v)}},this.showCursor=function(e,t){if(E.cursortimeout&&(clearTimeout(E.cursortimeout),E.cursortimeout=0),E.rail){if(E.autohidedom&&(E.autohidedom.stop().css({opacity:E.opt.cursoropacitymax}),E.cursoractive=!0),E.rail.drag&&1==E.rail.drag.pt||("undefined"!=typeof e&&!1!==e&&(E.scroll.y=Math.round(1*e/E.scrollratio.y)),"undefined"!=typeof t&&(E.scroll.x=Math.round(1*t/E.scrollratio.x))),E.cursor.css({height:E.cursorheight,top:E.scroll.y}),E.cursorh){var n=E.hasreversehr?E.scrollvaluemaxw-E.scroll.x:E.scroll.x;!E.rail.align&&E.rail.visibility?E.cursorh.css({width:E.cursorwidth,left:n+E.rail.width}):E.cursorh.css({width:E.cursorwidth,left:n}),E.cursoractive=!0}E.zoom&&E.zoom.stop().css({opacity:E.opt.cursoropacitymax})}},this.hideCursor=function(e){E.cursortimeout||!E.rail||!E.autohidedom||E.hasmousefocus&&"leave"==E.opt.autohidemode||(E.cursortimeout=setTimeout(function(){E.rail.active&&E.showonmouseevent||(E.autohidedom.stop().animate({opacity:E.opt.cursoropacitymin}),E.zoom&&E.zoom.stop().animate({opacity:E.opt.cursoropacitymin}),E.cursoractive=!1),E.cursortimeout=0},e||E.opt.hidecursordelay))},this.noticeCursor=function(e,t,n){E.showCursor(t,n),E.rail.active||E.hideCursor(e)},this.getContentSize=E.ispage?function(){return{w:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),h:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}}:E.haswrapper?function(){return{w:E.doc.outerWidth()+parseInt(E.win.css("paddingLeft"))+parseInt(E.win.css("paddingRight")),h:E.doc.outerHeight()+parseInt(E.win.css("paddingTop"))+parseInt(E.win.css("paddingBottom"))}}:function(){return{w:E.docscroll[0].scrollWidth,h:E.docscroll[0].scrollHeight}},this.onResize=function(e,t){if(!E||!E.win)return!1;if(!E.haswrapper&&!E.ispage){if("none"==E.win.css("display"))return E.visibility&&E.hideRail().hideRailHr(),!1;E.hidden||E.visibility||E.showRail().showRailHr()}var n=E.page.maxh,i=E.page.maxw,o=E.view.h,r=E.view.w;if(E.view={w:E.ispage?E.win.width():parseInt(E.win[0].clientWidth),h:E.ispage?E.win.height():parseInt(E.win[0].clientHeight)},E.page=t?t:E.getContentSize(),E.page.maxh=Math.max(0,E.page.h-E.view.h),E.page.maxw=Math.max(0,E.page.w-E.view.w),E.page.maxh==n&&E.page.maxw==i&&E.view.w==r&&E.view.h==o){if(E.ispage)return E;if(n=E.win.offset(),E.lastposition&&(i=E.lastposition,i.top==n.top&&i.left==n.left))return E;E.lastposition=n}return 0==E.page.maxh?(E.hideRail(),E.scrollvaluemax=0,E.scroll.y=0,E.scrollratio.y=0,E.cursorheight=0,E.setScrollTop(0),E.rail.scrollable=!1):(E.page.maxh-=E.opt.railpadding.top+E.opt.railpadding.bottom,E.rail.scrollable=!0),0==E.page.maxw?(E.hideRailHr(),E.scrollvaluemaxw=0,E.scroll.x=0,E.scrollratio.x=0,E.cursorwidth=0,E.setScrollLeft(0),E.railh.scrollable=!1):(E.page.maxw-=E.opt.railpadding.left+E.opt.railpadding.right,E.railh.scrollable=!0),E.railslocked=E.locked||0==E.page.maxh&&0==E.page.maxw,E.railslocked?(E.ispage||E.updateScrollBar(E.view),!1):(E.hidden||E.visibility?E.hidden||E.railh.visibility||E.showRailHr():E.showRail().showRailHr(),E.istextarea&&E.win.css("resize")&&"none"!=E.win.css("resize")&&(E.view.h-=20),E.cursorheight=Math.min(E.view.h,Math.round(E.view.h/E.page.h*E.view.h)),E.cursorheight=E.opt.cursorfixedheight?E.opt.cursorfixedheight:Math.max(E.opt.cursorminheight,E.cursorheight),E.cursorwidth=Math.min(E.view.w,Math.round(E.view.w/E.page.w*E.view.w)),E.cursorwidth=E.opt.cursorfixedheight?E.opt.cursorfixedheight:Math.max(E.opt.cursorminheight,E.cursorwidth),E.scrollvaluemax=E.view.h-E.cursorheight-E.cursor.hborder-(E.opt.railpadding.top+E.opt.railpadding.bottom),E.railh&&(E.railh.width=0<E.page.maxh?E.view.w-E.rail.width:E.view.w,E.scrollvaluemaxw=E.railh.width-E.cursorwidth-E.cursorh.wborder-(E.opt.railpadding.left+E.opt.railpadding.right)),E.ispage||E.updateScrollBar(E.view),E.scrollratio={x:E.page.maxw/E.scrollvaluemaxw,y:E.page.maxh/E.scrollvaluemax},E.getScrollTop()>E.page.maxh?E.doScrollTop(E.page.maxh):(E.scroll.y=Math.round(E.getScrollTop()*(1/E.scrollratio.y)),E.scroll.x=Math.round(E.getScrollLeft()*(1/E.scrollratio.x)),E.cursoractive&&E.noticeCursor()),E.scroll.y&&0==E.getScrollTop()&&E.doScrollTo(Math.floor(E.scroll.y*E.scrollratio.y)),E)},this.resize=E.onResize,this.lazyResize=function(e){return e=isNaN(e)?30:e,E.debounced("resize",E.resize,e),E},this.jqbind=function(t,n,i){E.events.push({e:t,n:n,f:i,q:!0}),e(t).bind(n,i)},this.bind=function(e,t,n,i){var o="jquery"in e?e[0]:e;"mousewheel"==t?window.addEventListener||"onwheel"in document?E._bind(o,"wheel",n,i||!1):(e="undefined"!=typeof document.onmousewheel?"mousewheel":"DOMMouseScroll",T(o,e,n,i||!1),"DOMMouseScroll"==e&&T(o,"MozMousePixelScroll",n,i||!1)):o.addEventListener?(S.cantouch&&/mouseup|mousedown|mousemove/.test(t)&&E._bind(o,"mousedown"==t?"touchstart":"mouseup"==t?"touchend":"touchmove",function(e){if(e.touches){if(2>e.touches.length){var t=e.touches.length?e.touches[0]:e;t.original=e,n.call(this,t)}}else e.changedTouches&&(t=e.changedTouches[0],t.original=e,n.call(this,t))},i||!1),E._bind(o,t,n,i||!1),S.cantouch&&"mouseup"==t&&E._bind(o,"touchcancel",n,i||!1)):E._bind(o,t,function(e){return(e=e||window.event||!1)&&e.srcElement&&(e.target=e.srcElement),"pageY"in e||(e.pageX=e.clientX+document.documentElement.scrollLeft,e.pageY=e.clientY+document.documentElement.scrollTop),!1!==n.call(o,e)&&!1!==i||E.cancelEvent(e)})},S.haseventlistener?(this._bind=function(e,t,n,i){E.events.push({e:e,n:t,f:n,b:i,q:!1}),e.addEventListener(t,n,i||!1)},this.cancelEvent=function(e){return!!e&&(e=e.original?e.original:e,e.preventDefault(),e.stopPropagation(),e.preventManipulation&&e.preventManipulation(),!1)},this.stopPropagation=function(e){return!!e&&(e=e.original?e.original:e,e.stopPropagation(),!1)},this._unbind=function(e,t,n,i){e.removeEventListener(t,n,i)}):(this._bind=function(e,t,n,i){E.events.push({e:e,n:t,f:n,b:i,q:!1}),e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},this.cancelEvent=function(e){return!!(e=window.event||!1)&&(e.cancelBubble=!0,e.cancel=!0,e.returnValue=!1)},this.stopPropagation=function(e){return!!(e=window.event||!1)&&(e.cancelBubble=!0,!1)},this._unbind=function(e,t,n,i){e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=!1}),this.unbindAll=function(){for(var e=0;e<E.events.length;e++){var t=E.events[e];t.q?t.e.unbind(t.n,t.f):E._unbind(t.e,t.n,t.f,t.b)}},this.showRail=function(){return 0==E.page.maxh||!E.ispage&&"none"==E.win.css("display")||(E.visibility=!0,E.rail.visibility=!0,E.rail.css("display","block")),E},this.showRailHr=function(){return E.railh?(0==E.page.maxw||!E.ispage&&"none"==E.win.css("display")||(E.railh.visibility=!0,E.railh.css("display","block")),E):E},this.hideRail=function(){return E.visibility=!1,E.rail.visibility=!1,E.rail.css("display","none"),E},this.hideRailHr=function(){return E.railh?(E.railh.visibility=!1,E.railh.css("display","none"),E):E},this.show=function(){return E.hidden=!1,E.railslocked=!1,E.showRail().showRailHr()},this.hide=function(){return E.hidden=!0,E.railslocked=!0,E.hideRail().hideRailHr()},this.toggle=function(){return E.hidden?E.show():E.hide()},this.remove=function(){E.stop(),E.cursortimeout&&clearTimeout(E.cursortimeout),E.doZoomOut(),E.unbindAll(),S.isie9&&E.win[0].detachEvent("onpropertychange",E.onAttributeChange),!1!==E.observer&&E.observer.disconnect(),!1!==E.observerremover&&E.observerremover.disconnect(),!1!==E.observerbody&&E.observerbody.disconnect(),E.events=null,E.cursor&&E.cursor.remove(),E.cursorh&&E.cursorh.remove(),E.rail&&E.rail.remove(),E.railh&&E.railh.remove(),E.zoom&&E.zoom.remove();for(var t=0;t<E.saved.css.length;t++){var n=E.saved.css[t];n[0].css(n[1],"undefined"==typeof n[2]?"":n[2])}E.saved=!1,E.me.data("__nicescroll","");var i=e.nicescroll;i.each(function(e){if(this&&this.id===E.id){delete i[e];for(var t=++e;t<i.length;t++,e++)i[e]=i[t];i.length--,i.length&&delete i[i.length]}});for(var o in E)E[o]=null,delete E[o];E=null},this.scrollstart=function(e){return this.onscrollstart=e,E},this.scrollend=function(e){return this.onscrollend=e,E},this.scrollcancel=function(e){return this.onscrollcancel=e,E},this.zoomin=function(e){return this.onzoomin=e,E},this.zoomout=function(e){return this.onzoomout=e,E},this.isScrollable=function(t){if(t=t.target?t.target:t,"OPTION"==t.nodeName)return!0;for(;t&&1==t.nodeType&&!/^BODY|HTML/.test(t.nodeName);){var n=e(t),n=n.css("overflowY")||n.css("overflowX")||n.css("overflow")||"";if(/scroll|auto/.test(n))return t.clientHeight!=t.scrollHeight;t=!!t.parentNode&&t.parentNode}return!1},this.getViewport=function(t){for(t=!(!t||!t.parentNode)&&t.parentNode;t&&1==t.nodeType&&!/^BODY|HTML/.test(t.nodeName);){var n=e(t);if(/fixed|absolute/.test(n.css("position")))return n;var i=n.css("overflowY")||n.css("overflowX")||n.css("overflow")||"";if(/scroll|auto/.test(i)&&t.clientHeight!=t.scrollHeight||0<n.getNiceScroll().length)return n;t=!!t.parentNode&&t.parentNode}return!1},this.triggerScrollEnd=function(){if(E.onscrollend){var e=E.getScrollLeft(),t=E.getScrollTop();E.onscrollend.call(E,{type:"scrollend",current:{x:e,y:t},end:{x:e,y:t}})}},this.onmousewheel=function(e){if(!E.wheelprevented){if(E.railslocked)return E.debounced("checkunlock",E.resize,250),!0;if(E.rail.drag)return E.cancelEvent(e);if("auto"==E.opt.oneaxismousemode&&0!=e.deltaX&&(E.opt.oneaxismousemode=!1),E.opt.oneaxismousemode&&0==e.deltaX&&!E.rail.scrollable)return!E.railh||!E.railh.scrollable||E.onmousewheelhr(e);var t=+new Date,n=!1;return E.opt.preservenativescrolling&&E.checkarea+600<t&&(E.nativescrollingarea=E.isScrollable(e),n=!0),E.checkarea=t,!!E.nativescrollingarea||((e=_(e,!1,n))&&(E.checkarea=0),e)}},this.onmousewheelhr=function(e){if(!E.wheelprevented){if(E.railslocked||!E.railh.scrollable)return!0;if(E.rail.drag)return E.cancelEvent(e);var t=+new Date,n=!1;return E.opt.preservenativescrolling&&E.checkarea+600<t&&(E.nativescrollingarea=E.isScrollable(e),n=!0),E.checkarea=t,!!E.nativescrollingarea||(E.railslocked?E.cancelEvent(e):_(e,!0,n))}},this.stop=function(){return E.cancelScroll(),E.scrollmon&&E.scrollmon.stop(),E.cursorfreezed=!1,E.scroll.y=Math.round(E.getScrollTop()*(1/E.scrollratio.y)),E.noticeCursor(),E},this.getTransitionSpeed=function(e){var t=Math.round(10*E.opt.scrollspeed);return e=Math.min(t,Math.round(e/20*E.opt.scrollspeed)),20<e?e:0},E.opt.smoothscroll?E.ishwscroll&&S.hastransition&&E.opt.usetransition&&E.opt.smoothscroll?(this.prepareTransition=function(e,t){var n=t?20<e?e:0:E.getTransitionSpeed(e),i=n?S.prefixstyle+"transform "+n+"ms ease-out":"";return E.lasttransitionstyle&&E.lasttransitionstyle==i||(E.lasttransitionstyle=i,E.doc.css(S.transitionstyle,i)),n},this.doScrollLeft=function(e,t){var n=E.scrollrunning?E.newscrolly:E.getScrollTop();E.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=E.scrollrunning?E.newscrollx:E.getScrollLeft();E.doScrollPos(n,e,t)},this.doScrollPos=function(e,t,n){var i=E.getScrollTop(),o=E.getScrollLeft();return(0>(E.newscrolly-i)*(t-i)||0>(E.newscrollx-o)*(e-o))&&E.cancelScroll(),0==E.opt.bouncescroll&&(0>t?t=0:t>E.page.maxh&&(t=E.page.maxh),0>e?e=0:e>E.page.maxw&&(e=E.page.maxw)),(!E.scrollrunning||e!=E.newscrollx||t!=E.newscrolly)&&(E.newscrolly=t,E.newscrollx=e,E.newscrollspeed=n||!1,!E.timer&&void(E.timer=setTimeout(function(){var n,i,o=E.getScrollTop(),r=E.getScrollLeft();n=e-r,i=t-o,n=Math.round(Math.sqrt(Math.pow(n,2)+Math.pow(i,2))),n=E.newscrollspeed&&1<E.newscrollspeed?E.newscrollspeed:E.getTransitionSpeed(n),E.newscrollspeed&&1>=E.newscrollspeed&&(n*=E.newscrollspeed),E.prepareTransition(n,!0),E.timerscroll&&E.timerscroll.tm&&clearInterval(E.timerscroll.tm),0<n&&(!E.scrollrunning&&E.onscrollstart&&E.onscrollstart.call(E,{type:"scrollstart",current:{x:r,y:o},request:{x:e,y:t},end:{x:E.newscrollx,y:E.newscrolly},speed:n}),S.transitionend?E.scrollendtrapped||(E.scrollendtrapped=!0,E.bind(E.doc,S.transitionend,E.onScrollTransitionEnd,!1)):(E.scrollendtrapped&&clearTimeout(E.scrollendtrapped),E.scrollendtrapped=setTimeout(E.onScrollTransitionEnd,n)),E.timerscroll={bz:new R(o,E.newscrolly,n,0,0,.58,1),bh:new R(r,E.newscrollx,n,0,0,.58,1)},E.cursorfreezed||(E.timerscroll.tm=setInterval(function(){E.showCursor(E.getScrollTop(),E.getScrollLeft())},60))),E.synched("doScroll-set",function(){E.timer=0,E.scrollendtrapped&&(E.scrollrunning=!0),E.setScrollTop(E.newscrolly),E.setScrollLeft(E.newscrollx),E.scrollendtrapped||E.onScrollTransitionEnd()})},50)))},this.cancelScroll=function(){if(!E.scrollendtrapped)return!0;var e=E.getScrollTop(),t=E.getScrollLeft();return E.scrollrunning=!1,S.transitionend||clearTimeout(S.transitionend),E.scrollendtrapped=!1,E._unbind(E.doc[0],S.transitionend,E.onScrollTransitionEnd),E.prepareTransition(0),E.setScrollTop(e),E.railh&&E.setScrollLeft(t),E.timerscroll&&E.timerscroll.tm&&clearInterval(E.timerscroll.tm),E.timerscroll=!1,E.cursorfreezed=!1,E.showCursor(e,t),E},this.onScrollTransitionEnd=function(){E.scrollendtrapped&&E._unbind(E.doc[0],S.transitionend,E.onScrollTransitionEnd),E.scrollendtrapped=!1,E.prepareTransition(0),E.timerscroll&&E.timerscroll.tm&&clearInterval(E.timerscroll.tm),E.timerscroll=!1;var e=E.getScrollTop(),t=E.getScrollLeft();return E.setScrollTop(e),E.railh&&E.setScrollLeft(t),E.noticeCursor(!1,e,t),E.cursorfreezed=!1,0>e?e=0:e>E.page.maxh&&(e=E.page.maxh),0>t?t=0:t>E.page.maxw&&(t=E.page.maxw),e!=E.newscrolly||t!=E.newscrollx?E.doScrollPos(t,e,E.opt.snapbackspeed):(E.onscrollend&&E.scrollrunning&&E.triggerScrollEnd(),void(E.scrollrunning=!1))}):(this.doScrollLeft=function(e,t){var n=E.scrollrunning?E.newscrolly:E.getScrollTop();E.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=E.scrollrunning?E.newscrollx:E.getScrollLeft();E.doScrollPos(n,e,t)},this.doScrollPos=function(e,t,n){function i(){if(E.cancelAnimationFrame)return!0;if(E.scrollrunning=!0,u=1-u)return E.timer=s(i)||1;var e,t,n=0,o=t=E.getScrollTop();E.dst.ay?(o=E.bzscroll?E.dst.py+E.bzscroll.getNow()*E.dst.ay:E.newscrolly,e=o-t,(0>e&&o<E.newscrolly||0<e&&o>E.newscrolly)&&(o=E.newscrolly),E.setScrollTop(o),o==E.newscrolly&&(n=1)):n=1,t=e=E.getScrollLeft(),E.dst.ax?(t=E.bzscroll?E.dst.px+E.bzscroll.getNow()*E.dst.ax:E.newscrollx,e=t-e,(0>e&&t<E.newscrollx||0<e&&t>E.newscrollx)&&(t=E.newscrollx),E.setScrollLeft(t),t==E.newscrollx&&(n+=1)):n+=1,2==n?(E.timer=0,E.cursorfreezed=!1,E.bzscroll=!1,E.scrollrunning=!1,0>o?o=0:o>E.page.maxh&&(o=E.page.maxh),0>t?t=0:t>E.page.maxw&&(t=E.page.maxw),t!=E.newscrollx||o!=E.newscrolly?E.doScrollPos(t,o):E.onscrollend&&E.triggerScrollEnd()):E.timer=s(i)||1}if(t="undefined"==typeof t||!1===t?E.getScrollTop(!0):t,E.timer&&E.newscrolly==t&&E.newscrollx==e)return!0;E.timer&&l(E.timer),E.timer=0;var o=E.getScrollTop(),r=E.getScrollLeft();(0>(E.newscrolly-o)*(t-o)||0>(E.newscrollx-r)*(e-r))&&E.cancelScroll(),E.newscrolly=t,E.newscrollx=e,E.bouncescroll&&E.rail.visibility||(0>E.newscrolly?E.newscrolly=0:E.newscrolly>E.page.maxh&&(E.newscrolly=E.page.maxh)),E.bouncescroll&&E.railh.visibility||(0>E.newscrollx?E.newscrollx=0:E.newscrollx>E.page.maxw&&(E.newscrollx=E.page.maxw)),E.dst={},E.dst.x=e-r,E.dst.y=t-o,E.dst.px=r,E.dst.py=o;var a=Math.round(Math.sqrt(Math.pow(E.dst.x,2)+Math.pow(E.dst.y,2)));E.dst.ax=E.dst.x/a,E.dst.ay=E.dst.y/a;var d=0,c=a;if(0==E.dst.x?(d=o,c=t,E.dst.ay=1,E.dst.py=0):0==E.dst.y&&(d=r,c=e,E.dst.ax=1,E.dst.px=0),a=E.getTransitionSpeed(a),n&&1>=n&&(a*=n),E.bzscroll=0<a&&(E.bzscroll?E.bzscroll.update(c,a):new R(d,c,a,0,1,0,1)),!E.timer){(o==E.page.maxh&&t>=E.page.maxh||r==E.page.maxw&&e>=E.page.maxw)&&E.checkContentSize();var u=1;E.cancelAnimationFrame=!1,E.timer=1,E.onscrollstart&&!E.scrollrunning&&E.onscrollstart.call(E,{type:"scrollstart",current:{x:r,y:o},request:{x:e,y:t},end:{x:E.newscrollx,y:E.newscrolly},speed:a}),i(),(o==E.page.maxh&&t>=o||r==E.page.maxw&&e>=r)&&E.checkContentSize(),E.noticeCursor()}},this.cancelScroll=function(){return E.timer&&l(E.timer),E.timer=0,E.bzscroll=!1,E.scrollrunning=!1,E}):(this.doScrollLeft=function(e,t){var n=E.getScrollTop();E.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=E.getScrollLeft();E.doScrollPos(n,e,t)},this.doScrollPos=function(e,t,n){var i=e>E.page.maxw?E.page.maxw:e;0>i&&(i=0);var o=t>E.page.maxh?E.page.maxh:t;0>o&&(o=0),E.synched("scroll",function(){E.setScrollTop(o),E.setScrollLeft(i)})},this.cancelScroll=function(){}),this.doScrollBy=function(e,t){var n=0,n=t?Math.floor((E.scroll.y-e)*E.scrollratio.y):(E.timer?E.newscrolly:E.getScrollTop(!0))-e;if(E.bouncescroll){var i=Math.round(E.view.h/2);n<-i?n=-i:n>E.page.maxh+i&&(n=E.page.maxh+i)}return E.cursorfreezed=!1,i=E.getScrollTop(!0),0>n&&0>=i?E.noticeCursor():n>E.page.maxh&&i>=E.page.maxh?(E.checkContentSize(),E.noticeCursor()):void E.doScrollTop(n)},this.doScrollLeftBy=function(e,t){var n=0,n=t?Math.floor((E.scroll.x-e)*E.scrollratio.x):(E.timer?E.newscrollx:E.getScrollLeft(!0))-e;if(E.bouncescroll){var i=Math.round(E.view.w/2);n<-i?n=-i:n>E.page.maxw+i&&(n=E.page.maxw+i)}return E.cursorfreezed=!1,i=E.getScrollLeft(!0),0>n&&0>=i||n>E.page.maxw&&i>=E.page.maxw?E.noticeCursor():void E.doScrollLeft(n)},this.doScrollTo=function(e,t){t&&Math.round(e*E.scrollratio.y),E.cursorfreezed=!1,E.doScrollTop(e)},this.checkContentSize=function(){var e=E.getContentSize();e.h==E.page.h&&e.w==E.page.w||E.resize(!1,e)},E.onscroll=function(e){E.rail.drag||E.cursorfreezed||E.synched("scroll",function(){E.scroll.y=Math.round(E.getScrollTop()*(1/E.scrollratio.y)),E.railh&&(E.scroll.x=Math.round(E.getScrollLeft()*(1/E.scrollratio.x))),E.noticeCursor()})},E.bind(E.docscroll,"scroll",E.onscroll),this.doZoomIn=function(t){if(!E.zoomactive){E.zoomactive=!0,E.zoomrestore={style:{}};var n,i="position top left zIndex backgroundColor marginTop marginBottom marginLeft marginRight".split(" "),o=E.win[0].style;for(n in i){var a=i[n];E.zoomrestore.style[a]="undefined"!=typeof o[a]?o[a]:""}return E.zoomrestore.style.width=E.win.css("width"),E.zoomrestore.style.height=E.win.css("height"),E.zoomrestore.padding={w:E.win.outerWidth()-E.win.width(),h:E.win.outerHeight()-E.win.height()},S.isios4&&(E.zoomrestore.scrollTop=e(window).scrollTop(),e(window).scrollTop(0)),E.win.css({position:S.isios4?"absolute":"fixed",top:0,left:0,"z-index":r+100,margin:"0px"}),i=E.win.css("backgroundColor"),(""==i||/transparent|rgba\(0, 0, 0, 0\)|rgba\(0,0,0,0\)/.test(i))&&E.win.css("backgroundColor","#fff"),E.rail.css({"z-index":r+101}),E.zoom.css({"z-index":r+102}),E.zoom.css("backgroundPosition","0px -18px"),E.resizeZoom(),E.onzoomin&&E.onzoomin.call(E),E.cancelEvent(t)}},this.doZoomOut=function(t){if(E.zoomactive)return E.zoomactive=!1,E.win.css("margin",""),E.win.css(E.zoomrestore.style),S.isios4&&e(window).scrollTop(E.zoomrestore.scrollTop),E.rail.css({"z-index":E.zindex}),E.zoom.css({"z-index":E.zindex}),E.zoomrestore=!1,E.zoom.css("backgroundPosition","0px 0px"),E.onResize(),E.onzoomout&&E.onzoomout.call(E),E.cancelEvent(t)},this.doZoom=function(e){return E.zoomactive?E.doZoomOut(e):E.doZoomIn(e)},this.resizeZoom=function(){if(E.zoomactive){var t=E.getScrollTop();E.win.css({width:e(window).width()-E.zoomrestore.padding.w+"px",height:e(window).height()-E.zoomrestore.padding.h+"px"}),E.onResize(),E.setScrollTop(Math.min(E.page.maxh,t))}},this.init(),e.nicescroll.push(this)},g=function(e){var t=this;this.nc=e,this.steptime=this.lasttime=this.speedy=this.speedx=this.lasty=this.lastx=0,this.snapy=this.snapx=!1,this.demuly=this.demulx=0,this.lastscrolly=this.lastscrollx=-1,this.timer=this.chky=this.chkx=0,this.time=function(){return+new Date},this.reset=function(e,n){t.stop();var i=t.time();t.steptime=0,t.lasttime=i,t.speedx=0,t.speedy=0,t.lastx=e,t.lasty=n,t.lastscrollx=-1,t.lastscrolly=-1},this.update=function(e,n){var i=t.time();t.steptime=i-t.lasttime,t.lasttime=i;var i=n-t.lasty,o=e-t.lastx,r=t.nc.getScrollTop(),a=t.nc.getScrollLeft(),r=r+i,a=a+o;t.snapx=0>a||a>t.nc.page.maxw,t.snapy=0>r||r>t.nc.page.maxh,t.speedx=o,t.speedy=i,t.lastx=e,t.lasty=n},this.stop=function(){t.nc.unsynched("domomentum2d"),t.timer&&clearTimeout(t.timer),t.timer=0,t.lastscrollx=-1,t.lastscrolly=-1},this.doSnapy=function(e,n){var i=!1;0>n?(n=0,i=!0):n>t.nc.page.maxh&&(n=t.nc.page.maxh,i=!0),0>e?(e=0,i=!0):e>t.nc.page.maxw&&(e=t.nc.page.maxw,i=!0),i?t.nc.doScrollPos(e,n,t.nc.opt.snapbackspeed):t.nc.triggerScrollEnd()},this.doMomentum=function(e){var n=t.time(),i=e?n+e:t.lasttime;e=t.nc.getScrollLeft();var o=t.nc.getScrollTop(),r=t.nc.page.maxh,a=t.nc.page.maxw;if(t.speedx=0<a?Math.min(60,t.speedx):0,t.speedy=0<r?Math.min(60,t.speedy):0,i=i&&60>=n-i,(0>o||o>r||0>e||e>a)&&(i=!1),e=!(!t.speedx||!i)&&t.speedx,t.speedy&&i&&t.speedy||e){var s=Math.max(16,t.steptime);50<s&&(e=s/50,t.speedx*=e,t.speedy*=e,s=50),t.demulxy=0,t.lastscrollx=t.nc.getScrollLeft(),t.chkx=t.lastscrollx,t.lastscrolly=t.nc.getScrollTop(),t.chky=t.lastscrolly;var l=t.lastscrollx,d=t.lastscrolly,c=function(){var e=600<t.time()-n?.04:.02;t.speedx&&(l=Math.floor(t.lastscrollx-t.speedx*(1-t.demulxy)),t.lastscrollx=l,0>l||l>a)&&(e=.1),t.speedy&&(d=Math.floor(t.lastscrolly-t.speedy*(1-t.demulxy)),t.lastscrolly=d,0>d||d>r)&&(e=.1),t.demulxy=Math.min(1,t.demulxy+e),t.nc.synched("domomentum2d",function(){t.speedx&&(t.nc.getScrollLeft()!=t.chkx&&t.stop(),t.chkx=l,t.nc.setScrollLeft(l)),t.speedy&&(t.nc.getScrollTop()!=t.chky&&t.stop(),t.chky=d,t.nc.setScrollTop(d)),t.timer||(t.nc.hideCursor(),t.doSnapy(l,d))}),1>t.demulxy?t.timer=setTimeout(c,s):(t.stop(),t.nc.hideCursor(),t.doSnapy(l,d))};c()}else t.doSnapy(t.nc.getScrollLeft(),t.nc.getScrollTop())}},T=e.fn.scrollTop;e.cssHooks.pageYOffset={get:function(t,n,i){return(n=e.data(t,"__nicescroll")||!1)&&n.ishwscroll?n.getScrollTop():T.call(t)},set:function(t,n){var i=e.data(t,"__nicescroll")||!1;return i&&i.ishwscroll?i.setScrollTop(parseInt(n)):T.call(t,n),this}},e.fn.scrollTop=function(t){if("undefined"==typeof t){var n=!!this[0]&&(e.data(this[0],"__nicescroll")||!1);return n&&n.ishwscroll?n.getScrollTop():T.call(this)}return this.each(function(){var n=e.data(this,"__nicescroll")||!1;n&&n.ishwscroll?n.setScrollTop(parseInt(t)):T.call(e(this),t)})};var _=e.fn.scrollLeft;e.cssHooks.pageXOffset={get:function(t,n,i){return(n=e.data(t,"__nicescroll")||!1)&&n.ishwscroll?n.getScrollLeft():_.call(t)},set:function(t,n){var i=e.data(t,"__nicescroll")||!1;return i&&i.ishwscroll?i.setScrollLeft(parseInt(n)):_.call(t,n),this}},e.fn.scrollLeft=function(t){if("undefined"==typeof t){var n=!!this[0]&&(e.data(this[0],"__nicescroll")||!1);return n&&n.ishwscroll?n.getScrollLeft():_.call(this)}return this.each(function(){var n=e.data(this,"__nicescroll")||!1;n&&n.ishwscroll?n.setScrollLeft(parseInt(t)):_.call(e(this),t)})};var E=function(t){var n=this;if(this.length=0,this.name="nicescrollarray",this.each=function(e){for(var t=0,i=0;t<n.length;t++)e.call(n[t],i++);return n},this.push=function(e){n[n.length]=e,n.length++},this.eq=function(e){return n[e]},t)for(var i=0;i<t.length;i++){var o=e.data(t[i],"__nicescroll")||!1;o&&(this[this.length]=o,this.length++)}return this};!function(e,t,n){for(var i=0;i<t.length;i++)n(e,t[i])}(E.prototype,"show hide toggle onResize resize remove stop doScrollPos".split(" "),function(e,t){e[t]=function(){var e=arguments;return this.each(function(){this[t].apply(this,e)})}}),e.fn.getNiceScroll=function(t){return"undefined"==typeof t?new E(this):this[t]&&e.data(this[t],"__nicescroll")||!1},e.extend(e.expr[":"],{nicescroll:function(t){return!!e.data(t,"__nicescroll")}}),e.fn.niceScroll=function(t,n){"undefined"!=typeof n||"object"!=typeof t||"jquery"in t||(n=t,t=!1),n=e.extend({},n);var i=new E;"undefined"==typeof n&&(n={}),t&&(n.doc=e(t),n.win=e(this));var o=!("doc"in n);return o||"win"in n||(n.win=e(this)),this.each(function(){var t=e(this).data("__nicescroll")||!1;t||(n.doc=o?e(this):n.doc,t=new m(n,e(this)),e(this).data("__nicescroll",t)),i.push(t)}),1==i.length?i[0]:i},window.NiceScroll={getjQuery:function(){return e}},e.nicescroll||(e.nicescroll=new E,e.nicescroll.options=p)}),function(){function e(e,t,n){return e.call.apply(e.bind,arguments)}function t(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function n(i,o,r){return n=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?e:t,n.apply(null,arguments)}function i(e,t){this.a=e,this.m=t||e,this.c=this.m.document}function o(e,t,n,i){if(t=e.c.createElement(t),n)for(var o in n)n.hasOwnProperty(o)&&("style"==o?t.style.cssText=n[o]:t.setAttribute(o,n[o]));return i&&t.appendChild(e.c.createTextNode(i)),t}function r(e,t,n){e=e.c.getElementsByTagName(t)[0],e||(e=document.documentElement),e.insertBefore(n,e.lastChild)}function a(e){e.parentNode&&e.parentNode.removeChild(e)}function s(e,t,n){t=t||[],n=n||[];for(var i=e.className.split(/\s+/),o=0;o<t.length;o+=1){for(var r=!1,a=0;a<i.length;a+=1)if(t[o]===i[a]){r=!0;break}r||i.push(t[o])}for(t=[],o=0;o<i.length;o+=1){for(r=!1,a=0;a<n.length;a+=1)if(i[o]===n[a]){r=!0;break}r||t.push(i[o])}e.className=t.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function l(e,t){for(var n=e.className.split(/\s+/),i=0,o=n.length;i<o;i++)if(n[i]==t)return!0;return!1}function d(e){if("string"==typeof e.f)return e.f;var t=e.m.location.protocol;return"about:"==t&&(t=e.a.location.protocol),"https:"==t?"https:":"http:"}function c(e){return e.m.location.hostname||e.a.location.hostname}function u(e,t,n){function i(){d&&a&&s&&(d(l),d=null)}t=o(e,"link",{rel:"stylesheet",href:t,media:"all"});var a=!1,s=!0,l=null,d=n||null;ie?(t.onload=function(){a=!0,i()},t.onerror=function(){a=!0,l=Error("Stylesheet failed to load"),i()}):setTimeout(function(){a=!0,i()},0),r(e,"head",t)}function p(e,t,n,i){var r=e.c.getElementsByTagName("head")[0];if(r){var a=o(e,"script",{src:t}),s=!1;return a.onload=a.onreadystatechange=function(){s||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(s=!0,n&&n(null),a.onload=a.onreadystatechange=null,"HEAD"==a.parentNode.tagName&&r.removeChild(a))},r.appendChild(a),setTimeout(function(){s||(s=!0,n&&n(Error("Script load timeout")))},i||5e3),a}return null}function h(){this.a=0,this.c=null}function f(e){return e.a++,function(){e.a--,g(e)}}function m(e,t){e.c=t,g(e)}function g(e){0==e.a&&e.c&&(e.c(),e.c=null)}function T(e){this.a=e||"-"}function _(e,t){this.c=e,this.f=4,this.a="n";var n=(t||"n4").match(/^([nio])([1-9])$/i);n&&(this.a=n[1],this.f=parseInt(n[2],10))}function E(e){return b(e)+" "+(e.f+"00")+" 300px "+v(e.c)}function v(e){var t=[];e=e.split(/,\s*/);for(var n=0;n<e.length;n++){var i=e[n].replace(/['"]/g,"");-1!=i.indexOf(" ")||/^\d/.test(i)?t.push("'"+i+"'"):t.push(i)}return t.join(",")}function S(e){return e.a+e.f}function b(e){var t="normal";return"o"===e.a?t="oblique":"i"===e.a&&(t="italic"),t}function R(e){var t=4,n="n",i=null;return e&&((i=e.match(/(normal|oblique|italic)/i))&&i[1]&&(n=i[1].substr(0,1).toLowerCase()),(i=e.match(/([1-9]00|normal|bold)/i))&&i[1]&&(/bold/i.test(i[1])?t=7:/[1-9]00/.test(i[1])&&(t=parseInt(i[1].substr(0,1),10)))),n+t}function O(e,t){this.c=e,this.f=e.m.document.documentElement,this.h=t,this.a=new T("-"),this.j=!1!==t.events,this.g=!1!==t.classes}function D(e){e.g&&s(e.f,[e.a.c("wf","loading")]),A(e,"loading")}function y(e){if(e.g){var t=l(e.f,e.a.c("wf","active")),n=[],i=[e.a.c("wf","loading")];t||n.push(e.a.c("wf","inactive")),s(e.f,n,i)}A(e,"inactive")}function A(e,t,n){e.j&&e.h[t]&&(n?e.h[t](n.c,S(n)):e.h[t]())}function C(){this.c={}}function I(e,t,n){var i,o=[];for(i in t)if(t.hasOwnProperty(i)){var r=e.c[i];r&&o.push(r(t[i],n))}return o}function w(e,t){this.c=e,this.f=t,this.a=o(this.c,"span",{"aria-hidden":"true"},this.f)}function P(e){r(e.c,"body",e.a)}function M(e){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+v(e.c)+";"+("font-style:"+b(e)+";font-weight:"+(e.f+"00")+";")}function L(e,t,n,i,o,r){this.g=e,this.j=t,this.a=i,this.c=n,this.f=o||3e3,this.h=r||void 0}function N(e,t,n,i,o,r,a){this.v=e,this.B=t,this.c=n,this.a=i,this.s=a||"BESbswy",this.f={},this.w=o||3e3,this.u=r||null,this.o=this.j=this.h=this.g=null,this.g=new w(this.c,this.s),this.h=new w(this.c,this.s),this.j=new w(this.c,this.s),this.o=new w(this.c,this.s),e=new _(this.a.c+",serif",S(this.a)),e=M(e),this.g.a.style.cssText=e,e=new _(this.a.c+",sans-serif",S(this.a)),e=M(e),this.h.a.style.cssText=e,e=new _("serif",S(this.a)),e=M(e),this.j.a.style.cssText=e,e=new _("sans-serif",S(this.a)),e=M(e),this.o.a.style.cssText=e,P(this.g),P(this.h),P(this.j),P(this.o)}function U(){if(null===re){var e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);re=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))}return re}function x(e,t,n){for(var i in oe)if(oe.hasOwnProperty(i)&&t===e.f[oe[i]]&&n===e.f[oe[i]])return!0;return!1}function k(e){var t,n=e.g.a.offsetWidth,i=e.h.a.offsetWidth;(t=n===e.f.serif&&i===e.f["sans-serif"])||(t=U()&&x(e,n,i)),t?ne()-e.A>=e.w?U()&&x(e,n,i)&&(null===e.u||e.u.hasOwnProperty(e.a.c))?Y(e,e.v):Y(e,e.B):F(e):Y(e,e.v)}function F(e){setTimeout(n(function(){k(this)},e),50)}function Y(e,t){setTimeout(n(function(){a(this.g.a),a(this.h.a),a(this.j.a),a(this.o.a),t(this.a)},e),0)}function B(e,t,n){this.c=e,this.a=t,this.f=0,this.o=this.j=!1,this.s=n}function H(e){0==--e.f&&e.j&&(e.o?(e=e.a,e.g&&s(e.f,[e.a.c("wf","active")],[e.a.c("wf","loading"),e.a.c("wf","inactive")]),A(e,"active")):y(e.a))}function W(e){this.j=e,this.a=new C,this.h=0,this.f=this.g=!0}function V(e,t,i,o,r){var a=0==--e.h;(e.f||e.g)&&setTimeout(function(){var e=r||null,l=o||null||{};if(0===i.length&&a)y(t.a);else{t.f+=i.length,a&&(t.j=a);var d,c=[];for(d=0;d<i.length;d++){var u=i[d],p=l[u.c],h=t.a,f=u;if(h.g&&s(h.f,[h.a.c("wf",f.c,S(f).toString(),"loading")]),A(h,"fontloading",f),h=null,null===ae)if(window.FontFace){var f=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),m=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);ae=f?42<parseInt(f[1],10):!m}else ae=!1;h=ae?new L(n(t.g,t),n(t.h,t),t.c,u,t.s,p):new N(n(t.g,t),n(t.h,t),t.c,u,t.s,e,p),c.push(h)}for(d=0;d<c.length;d++)c[d].start()}},0)}function J(e,t,n){var i=[],o=n.timeout;D(t);var i=I(e.a,n,e.c),r=new B(e.c,t,o);for(e.h=i.length,t=0,n=i.length;t<n;t++)i[t].load(function(t,n,i){V(e,r,t,n,i)})}function G(e,t){this.c=e,this.a=t}function z(e,t,n){var i=d(e.c);return e=(e.a.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,""),i+"//"+e+"/"+t+".js"+(n?"?v="+n:"")}function Z(e,t){this.c=e,this.a=t}function j(e,t,n){e?this.c=e:this.c=t+se,this.a=[],this.f=[],this.g=n||""}function X(e,t){for(var n=t.length,i=0;i<n;i++){var o=t[i].split(":");3==o.length&&e.f.push(o.pop());var r="";2==o.length&&""!=o[1]&&(r=":"),e.a.push(o.join(r))}}function K(e){if(0==e.a.length)throw Error("No fonts to load!");if(-1!=e.c.indexOf("kit="))return e.c;for(var t=e.a.length,n=[],i=0;i<t;i++)n.push(e.a[i].replace(/ /g,"+"));return t=e.c+"?family="+n.join("%7C"),0<e.f.length&&(t+="&subset="+e.f.join(",")),0<e.g.length&&(t+="&text="+encodeURIComponent(e.g)),t}function $(e){this.f=e,this.a=[],this.c={}}function q(e){for(var t=e.f.length,n=0;n<t;n++){var i=e.f[n].split(":"),o=i[0].replace(/\+/g," "),r=["n4"];if(2<=i.length){var a,s=i[1];if(a=[],s)for(var s=s.split(","),l=s.length,d=0;d<l;d++){var c;if(c=s[d],c.match(/^[\w-]+$/)){var u=ue.exec(c.toLowerCase());if(null==u)c="";else{if(c=u[2],c=null==c||""==c?"n":ce[c],u=u[1],null==u||""==u)u="4";else var p=de[u],u=p?p:isNaN(u)?"4":u.substr(0,1);c=[c,u].join("")}}else c="";c&&a.push(c)}0<a.length&&(r=a),3==i.length&&(i=i[2],a=[],i=i?i.split(","):a,0<i.length&&(i=le[i[0]])&&(e.c[o]=i))}for(e.c[o]||(i=le[o])&&(e.c[o]=i),i=0;i<r.length;i+=1)e.a.push(new _(o,r[i]))}}function Q(e,t){this.c=e,this.a=t}function ee(e,t){this.c=e,this.a=t}function te(e,t){this.c=e,this.f=t,this.a=[]}var ne=Date.now||function(){return+new Date},ie=!!window.FontFace;T.prototype.c=function(e){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n].replace(/[\W_]+/g,"").toLowerCase());return t.join(this.a)},L.prototype.start=function(){var e=this.c.m.document,t=this,n=ne(),i=new Promise(function(i,o){function r(){ne()-n>=t.f?o():e.fonts.load(E(t.a),t.h).then(function(e){1<=e.length?i():setTimeout(r,25)},function(){o()})}r()}),o=new Promise(function(e,n){setTimeout(n,t.f)});Promise.race([o,i]).then(function(){t.g(t.a)},function(){t.j(t.a)})};var oe={D:"serif",C:"sans-serif"},re=null;N.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.o.a.offsetWidth,this.A=ne(),k(this)};var ae=null;B.prototype.g=function(e){var t=this.a;t.g&&s(t.f,[t.a.c("wf",e.c,S(e).toString(),"active")],[t.a.c("wf",e.c,S(e).toString(),"loading"),t.a.c("wf",e.c,S(e).toString(),"inactive")]),A(t,"fontactive",e),this.o=!0,H(this)},B.prototype.h=function(e){var t=this.a;if(t.g){var n=l(t.f,t.a.c("wf",e.c,S(e).toString(),"active")),i=[],o=[t.a.c("wf",e.c,S(e).toString(),"loading")];n||i.push(t.a.c("wf",e.c,S(e).toString(),"inactive")),s(t.f,i,o)}A(t,"fontinactive",e),H(this)},W.prototype.load=function(e){this.c=new i(this.j,e.context||this.j),this.g=!1!==e.events,this.f=!1!==e.classes,J(this,new O(this.c,e),e)},G.prototype.load=function(e){function t(){if(r["__mti_fntLst"+i]){var n,o=r["__mti_fntLst"+i](),a=[];if(o)for(var s=0;s<o.length;s++){var l=o[s].fontfamily;void 0!=o[s].fontStyle&&void 0!=o[s].fontWeight?(n=o[s].fontStyle+o[s].fontWeight,a.push(new _(l,n))):a.push(new _(l))}e(a)}else setTimeout(function(){t()},50)}var n=this,i=n.a.projectId,o=n.a.version;if(i){var r=n.c.m;p(this.c,z(n,i,o),function(o){o?e([]):(r["__MonotypeConfiguration__"+i]=function(){return n.a},t())}).id="__MonotypeAPIScript__"+i}else e([])},Z.prototype.load=function(e){var t,n,i=this.a.urls||[],o=this.a.families||[],r=this.a.testStrings||{},a=new h;for(t=0,n=i.length;t<n;t++)u(this.c,i[t],f(a));var s=[];for(t=0,n=o.length;t<n;t++)if(i=o[t].split(":"),i[1])for(var l=i[1].split(","),d=0;d<l.length;d+=1)s.push(new _(i[0],l[d]));else s.push(new _(i[0]));m(a,function(){e(s,r)})};var se="//fonts.googleapis.com/css",le={latin:"BESbswy","latin-ext":"",cyrillic:"",greek:"",khmer:"",Hanuman:""},de={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},ce={i:"i",italic:"i",n:"n",normal:"n"},ue=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/,pe={Arimo:!0,Cousine:!0,Tinos:!0};Q.prototype.load=function(e){var t=new h,n=this.c,i=new j(this.a.api,d(n),this.a.text),o=this.a.families;X(i,o);var r=new $(o);q(r),u(n,K(i),f(t)),m(t,function(){e(r.a,r.c,pe)})},ee.prototype.load=function(e){var t=this.a.id,n=this.c.m;t?p(this.c,(this.a.api||"https://use.typekit.net")+"/"+t+".js",function(t){if(t)e([]);else if(n.Typekit&&n.Typekit.config&&n.Typekit.config.fn){t=n.Typekit.config.fn;for(var i=[],o=0;o<t.length;o+=2)for(var r=t[o],a=t[o+1],s=0;s<a.length;s++)i.push(new _(r,a[s]));try{n.Typekit.load({events:!1,classes:!1,async:!0})}catch(e){}e(i)}},2e3):e([])},te.prototype.load=function(e){var t=this.f.id,n=this.c.m,i=this;t?(n.__webfontfontdeckmodule__||(n.__webfontfontdeckmodule__={}),n.__webfontfontdeckmodule__[t]=function(t,n){for(var o=0,r=n.fonts.length;o<r;++o){var a=n.fonts[o];i.a.push(new _(a.name,R("font-weight:"+a.weight+";font-style:"+a.style)))}e(i.a)},p(this.c,d(this.c)+(this.f.api||"//f.fontdeck.com/s/css/js/")+c(this.c)+"/"+t+".js",function(t){t&&e([])})):e([])};var he=new W(window);he.a.c.custom=function(e,t){return new Z(t,e)},he.a.c.fontdeck=function(e,t){return new te(t,e)},he.a.c.monotype=function(e,t){return new G(t,e)},he.a.c.typekit=function(e,t){return new ee(t,e)},he.a.c.google=function(e,t){return new Q(t,e)};var fe={load:n(he.load,he)};"function"==typeof define&&define.amd?define(function(){return fe}):"undefined"!=typeof module&&module.exports?module.exports=fe:(window.WebFont=fe,window.WebFontConfig&&he.load(window.WebFontConfig))}(),function(e,t){if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(n,i,o){e.Backbone=t(e,o,n,i)});else if("undefined"!=typeof exports){var n=require("underscore");t(e,exports,n)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,n,i){var o=e.Backbone,r=[],a=(r.push,r.slice);r.splice;t.VERSION="1.1.2",t.$=i,t.noConflict=function(){return e.Backbone=o,this},t.emulateHTTP=!1,t.emulateJSON=!1;var s=t.Events={on:function(e,t,n){if(!d(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var i=this._events[e]||(this._events[e]=[]);return i.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,i){if(!d(this,"once",e,[t,i])||!t)return this;var o=this,r=n.once(function(){o.off(e,r),t.apply(this,arguments)});return r._callback=t,this.on(e,r,i)},off:function(e,t,i){var o,r,a,s,l,c,u,p;if(!this._events||!d(this,"off",e,[t,i]))return this;if(!e&&!t&&!i)return this._events=void 0,this;for(s=e?[e]:n.keys(this._events),l=0,c=s.length;l<c;l++)if(e=s[l],a=this._events[e]){if(this._events[e]=o=[],t||i)for(u=0,p=a.length;u<p;u++)r=a[u],(t&&t!==r.callback&&t!==r.callback._callback||i&&i!==r.context)&&o.push(r);o.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=a.call(arguments,1);if(!d(this,"trigger",e,t))return this;var n=this._events[e],i=this._events.all;return n&&c(n,t),i&&c(i,arguments),this},stopListening:function(e,t,i){var o=this._listeningTo;if(!o)return this;var r=!t&&!i;i||"object"!=typeof t||(i=this),e&&((o={})[e._listenId]=e);for(var a in o)e=o[a],e.off(t,i,this),(r||n.isEmpty(e._events))&&delete this._listeningTo[a];return this}},l=/\s+/,d=function(e,t,n,i){if(!n)return!0;if("object"==typeof n){for(var o in n)e[t].apply(e,[o,n[o]].concat(i));return!1}if(l.test(n)){for(var r=n.split(l),a=0,s=r.length;a<s;a++)e[t].apply(e,[r[a]].concat(i));return!1}return!0},c=function(e,t){var n,i=-1,o=e.length,r=t[0],a=t[1],s=t[2];switch(t.length){case 0:for(;++i<o;)(n=e[i]).callback.call(n.ctx);return;case 1:for(;++i<o;)(n=e[i]).callback.call(n.ctx,r);return;case 2:for(;++i<o;)(n=e[i]).callback.call(n.ctx,r,a);return;case 3:for(;++i<o;)(n=e[i]).callback.call(n.ctx,r,a,s);return;default:for(;++i<o;)(n=e[i]).callback.apply(n.ctx,t);return}},u={listenTo:"on",listenToOnce:"once"};n.each(u,function(e,t){s[t]=function(t,i,o){var r=this._listeningTo||(this._listeningTo={}),a=t._listenId||(t._listenId=n.uniqueId("l"));return r[a]=t,o||"object"!=typeof i||(o=this),t[e](i,o,this),this}}),s.bind=s.on,s.unbind=s.off,n.extend(t,s);var p=t.Model=function(e,t){var i=e||{};t||(t={}),this.cid=n.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(i=this.parse(i,t)||{}),i=n.defaults({},i,n.result(this,"defaults")),this.set(i,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(p.prototype,s,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,i){var o,r,a,s,l,d,c,u;if(null==e)return this;if("object"==typeof e?(r=e,i=t):(r={})[e]=t,i||(i={}),!this._validate(r,i))return!1;a=i.unset,l=i.silent,s=[],d=this._changing,this._changing=!0,d||(this._previousAttributes=n.clone(this.attributes),this.changed={}),u=this.attributes,c=this._previousAttributes,this.idAttribute in r&&(this.id=r[this.idAttribute]);for(o in r)t=r[o],n.isEqual(u[o],t)||s.push(o),n.isEqual(c[o],t)?delete this.changed[o]:this.changed[o]=t,a?delete u[o]:u[o]=t;if(!l){s.length&&(this._pending=i);for(var p=0,h=s.length;p<h;p++)this.trigger("change:"+s[p],this,u[s[p]],i)}if(d)return this;if(!l)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var i in this.attributes)t[i]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&n.clone(this.changed);var t,i=!1,o=this._changing?this._previousAttributes:this.attributes;for(var r in e)n.isEqual(o[r],t=e[r])||((i||(i={}))[r]=t);return i},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,i=e.success;return e.success=function(n){return!!t.set(t.parse(n,e),e)&&(i&&i(t,n,e),void t.trigger("sync",t,n,e))},k(this,e),this.sync("read",this,e)},save:function(e,t,i){var o,r,a,s=this.attributes;if(null==e||"object"==typeof e?(o=e,i=t):(o={})[e]=t,i=n.extend({validate:!0},i),o&&!i.wait){if(!this.set(o,i))return!1}else if(!this._validate(o,i))return!1;o&&i.wait&&(this.attributes=n.extend({},s,o)),void 0===i.parse&&(i.parse=!0);var l=this,d=i.success;return i.success=function(e){l.attributes=s;var t=l.parse(e,i);return i.wait&&(t=n.extend(o||{},t)),!(n.isObject(t)&&!l.set(t,i))&&(d&&d(l,e,i),void l.trigger("sync",l,e,i))},k(this,i),r=this.isNew()?"create":i.patch?"patch":"update","patch"===r&&(i.attrs=o),a=this.sync(r,this,i),o&&i.wait&&(this.attributes=s),a},destroy:function(e){e=e?n.clone(e):{};var t=this,i=e.success,o=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(n){(e.wait||t.isNew())&&o(),i&&i(t,n,e),t.isNew()||t.trigger("sync",t,n,e)},this.isNew())return e.success(),!1;k(this,e);var r=this.sync("delete",this,e);return e.wait||o(),r},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||x();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var i=this.validationError=this.validate(e,t)||null;return!i||(this.trigger("invalid",this,i,n.extend(t,{validationError:i})),!1)}});var h=["keys","values","pairs","invert","pick","omit"];n.each(h,function(e){p.prototype[e]=function(){var t=a.call(arguments);return t.unshift(this.attributes),n[e].apply(n,t)}});var f=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},m={add:!0,remove:!0,merge:!0},g={add:!0,remove:!1};n.extend(f.prototype,s,{model:p,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,g))},remove:function(e,t){var i=!n.isArray(e);e=i?[e]:n.clone(e),t||(t={});var o,r,a,s;for(o=0,r=e.length;o<r;o++)s=e[o]=this.get(e[o]),s&&(delete this._byId[s.id],delete this._byId[s.cid],a=this.indexOf(s),this.models.splice(a,1),this.length--,t.silent||(t.index=a,s.trigger("remove",s,this,t)),this._removeReference(s,t));return i?e[0]:e},set:function(e,t){t=n.defaults({},t,m),t.parse&&(e=this.parse(e,t));var i=!n.isArray(e);e=i?e?[e]:[]:n.clone(e);var o,r,a,s,l,d,c,u=t.at,h=this.model,f=this.comparator&&null==u&&t.sort!==!1,g=n.isString(this.comparator)?this.comparator:null,T=[],_=[],E={},v=t.add,S=t.merge,b=t.remove,R=!(f||!v||!b)&&[];for(o=0,r=e.length;o<r;o++){if(l=e[o]||{},a=l instanceof p?s=l:l[h.prototype.idAttribute||"id"],d=this.get(a))b&&(E[d.cid]=!0),S&&(l=l===s?s.attributes:l,t.parse&&(l=d.parse(l,t)),d.set(l,t),f&&!c&&d.hasChanged(g)&&(c=!0)),e[o]=d;else if(v){if(s=e[o]=this._prepareModel(l,t),!s)continue;T.push(s),this._addReference(s,t)}s=d||s,!R||!s.isNew()&&E[s.id]||R.push(s),E[s.id]=!0}if(b){for(o=0,r=this.length;o<r;++o)E[(s=this.models[o]).cid]||_.push(s);_.length&&this.remove(_,t)}if(T.length||R&&R.length)if(f&&(c=!0),this.length+=T.length,null!=u)for(o=0,r=T.length;o<r;o++)this.models.splice(u+o,0,T[o]);else{R&&(this.models.length=0);var O=R||T;for(o=0,r=O.length;o<r;o++)this.models.push(O[o])}if(c&&this.sort({silent:!0}),!t.silent){for(o=0,r=T.length;o<r;o++)(s=T[o]).trigger("add",s,this,t);(c||R&&R.length)&&this.trigger("sort",this,t)}return i?e[0]:e},reset:function(e,t){t||(t={});for(var i=0,o=this.models.length;i<o;i++)this._removeReference(this.models[i],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return a.apply(this.models,arguments)},get:function(e){if(null!=e)return this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){return n.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=e?n.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success,i=this;return e.success=function(n){var o=e.reset?"reset":"set";i[o](n,e),t&&t(i,n,e),i.trigger("sync",i,n,e)},k(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?n.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var i=this,o=t.success;return t.success=function(e,n){t.wait&&i.add(e,t),o&&o(e,n,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof p)return e;t=t?n.clone(t):{},t.collection=this;var i=new this.model(e,t);return i.validationError?(this.trigger("invalid",this,i.validationError,t),!1):i},_addReference:function(e,t){this._byId[e.cid]=e,null!=e.id&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,i){("add"!==e&&"remove"!==e||n===this)&&("destroy"===e&&this.remove(t,i),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});var T=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];n.each(T,function(e){f.prototype[e]=function(){var t=a.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var _=["groupBy","countBy","sortBy","indexBy"];n.each(_,function(e){f.prototype[e]=function(t,i){var o=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,o,i)}});var E=t.View=function(e){this.cid=n.uniqueId("view"),e||(e={}),n.extend(this,n.pick(e,S)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},v=/^(\S+)\s*(.*)$/,S=["model","collection","el","id","attributes","className","tagName","events"];n.extend(E.prototype,s,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var i=e[t];if(n.isFunction(i)||(i=this[e[t]]),i){var o=t.match(v),r=o[1],a=o[2];i=n.bind(i,this),r+=".delegateEvents"+this.cid,""===a?this.$el.on(r,i):this.$el.on(r,a,i)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"),!1);else{var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e.class=n.result(this,"className"));var i=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(i,!1)}}}),t.sync=function(e,i,o){var r=R[e];n.defaults(o||(o={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var a={type:r,dataType:"json"};if(o.url||(a.url=n.result(i,"url")||x()),null!=o.data||!i||"create"!==e&&"update"!==e&&"patch"!==e||(a.contentType="application/json",a.data=JSON.stringify(o.attrs||i.toJSON(o))),o.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),o.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){a.type="POST",o.emulateJSON&&(a.data._method=r);var s=o.beforeSend;o.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",r),s)return s.apply(this,arguments)}}"GET"===a.type||o.emulateJSON||(a.processData=!1),"PATCH"===a.type&&b&&(a.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=o.xhr=t.ajax(n.extend(a,o));return i.trigger("request",i,l,o),l};var b=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),R={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var O=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},D=/\((.*?)\)/g,y=/(\(\?)?:\w+/g,A=/\*\w+/g,C=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(O.prototype,s,{initialize:function(){},route:function(e,i,o){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(i)&&(o=i,i=""),o||(o=this[i]);var r=this;return t.history.route(e,function(n){var a=r._extractParameters(e,n);r.execute(o,a),r.trigger.apply(r,["route:"+i].concat(a)),r.trigger("route",i,a),t.history.trigger("route",r,i,a)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(this.routes){this.routes=n.result(this,"routes");for(var e,t=n.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(C,"\\$&").replace(D,"(?:$1)?").replace(y,function(e,t){return t?e:"([^/?]+)"}).replace(A,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var i=e.exec(t).slice(1);return n.map(i,function(e,t){return t===i.length-1?e||null:e?decodeURIComponent(e):null})}});var I=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},w=/^[#\/]|\s+$/g,P=/^\/+|\/+$/g,M=/msie [\w.]+/,L=/\/$/,N=/#.*$/;I.started=!1,n.extend(I.prototype,s,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(L,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(w,"")},start:function(e){if(I.started)throw new Error("Backbone.history has already been started");I.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var i=this.getFragment(),o=document.documentMode,r=M.exec(navigator.userAgent.toLowerCase())&&(!o||o<=7);if(this.root=("/"+this.root+"/").replace(P,"/"),r&&this._wantsHashChange){var a=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=a.hide().appendTo("body")[0].contentWindow,this.navigate(i)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=i;var s=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&s.hash&&(this.fragment=this.getHash().replace(w,""),this.history.replaceState({},document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),I.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t!==this.fragment&&(this.iframe&&this.navigate(t),void this.loadUrl())},loadUrl:function(e){return e=this.fragment=this.getFragment(e),n.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})},navigate:function(e,t){if(!I.started)return!1;t&&t!==!0||(t={trigger:!!t});var n=this.root+(e=this.getFragment(e||""));if(e=e.replace(N,""),this.fragment!==e){if(this.fragment=e,""===e&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,n){if(n){var i=e.href.replace(/(javascript:|#).*$/,"");e.replace(i+"#"+t)}else e.hash="#"+t}}),t.history=new I;var U=function(e,t){var i,o=this;i=e&&n.has(e,"constructor")?e.constructor:function(){return o.apply(this,arguments)},n.extend(i,o,t);var r=function(){this.constructor=i};return r.prototype=o.prototype,i.prototype=new r,e&&n.extend(i.prototype,e),i.__super__=o.prototype,i};p.extend=f.extend=O.extend=E.extend=I.extend=U;var x=function(){throw new Error('A "url" property or function must be specified')},k=function(e,t){var n=t.error;t.error=function(i){n&&n(e,i,t),e.trigger("error",e,i,t)}};return t}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):"object"==typeof exports?exports.Handlebars=t():e.Handlebars=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function i(){var e=T();return e.compile=function(t,n){return c.compile(t,n,e)},e.precompile=function(t,n){return c.precompile(t,n,e)},e.AST=l.default,e.Compiler=c.Compiler,e.JavaScriptCompiler=p.default,e.Parser=d.parser,e.parse=d.parse,e}var o=n(8).default;t.__esModule=!0;var r=n(1),a=o(r),s=n(2),l=o(s),d=n(3),c=n(4),u=n(5),p=o(u),h=n(6),f=o(h),m=n(7),g=o(m),T=a.default.create,_=i();_.create=i,g.default(_),_.Visitor=f.default,_.default=_,t.default=_,e.exports=t.default},function(e,t,n){"use strict";function i(){var e=new s.HandlebarsEnvironment;return h.extend(e,s),e.SafeString=d.default,e.Exception=u.default,e.Utils=h,e.escapeExpression=h.escapeExpression,e.VM=m,e.template=function(t){return m.template(t,e)},e}var o=n(9).default,r=n(8).default;t.__esModule=!0;var a=n(10),s=o(a),l=n(11),d=r(l),c=n(12),u=r(c),p=n(13),h=o(p),f=n(14),m=o(f),g=n(7),T=r(g),_=i();_.create=i,T.default(_),_.default=_,t.default=_,e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0;var i={Program:function(e,t,n,i){this.loc=i,this.type="Program",this.body=e,this.blockParams=t,this.strip=n},MustacheStatement:function(e,t,n,i,o,r){this.loc=r,this.type="MustacheStatement",this.path=e,this.params=t||[],this.hash=n,this.escaped=i,this.strip=o},BlockStatement:function(e,t,n,i,o,r,a,s,l){this.loc=l,this.type="BlockStatement",this.path=e,this.params=t||[],this.hash=n,this.program=i,this.inverse=o,this.openStrip=r,this.inverseStrip=a,this.closeStrip=s},PartialStatement:function(e,t,n,i,o){this.loc=o,this.type="PartialStatement",this.name=e,this.params=t||[],this.hash=n,this.indent="",this.strip=i},ContentStatement:function(e,t){this.loc=t,this.type="ContentStatement",this.original=this.value=e},CommentStatement:function(e,t,n){this.loc=n,this.type="CommentStatement",this.value=e,this.strip=t},SubExpression:function(e,t,n,i){this.loc=i,this.type="SubExpression",this.path=e,this.params=t||[],this.hash=n},PathExpression:function(e,t,n,i,o){this.loc=o,this.type="PathExpression",this.data=e,this.original=i,this.parts=n,this.depth=t},StringLiteral:function(e,t){this.loc=t,this.type="StringLiteral",this.original=this.value=e},NumberLiteral:function(e,t){this.loc=t,this.type="NumberLiteral",this.original=this.value=Number(e)},BooleanLiteral:function(e,t){this.loc=t,this.type="BooleanLiteral",this.original=this.value="true"===e},UndefinedLiteral:function(e){this.loc=e,this.type="UndefinedLiteral",this.original=this.value=void 0},NullLiteral:function(e){this.loc=e,this.type="NullLiteral",this.original=this.value=null},Hash:function(e,t){this.loc=t,this.type="Hash",this.pairs=e},HashPair:function(e,t,n){this.loc=n,this.type="HashPair",this.key=e,this.value=t},helpers:{helperExpression:function(e){return!("SubExpression"!==e.type&&!e.params.length&&!e.hash)},scopedId:function(e){return/^\.|this\b/.test(e.original)},simpleId:function(e){return 1===e.parts.length&&!i.helpers.scopedId(e)&&!e.depth}}};t.default=i,e.exports=t.default},function(e,t,n){"use strict";function i(e,t){if("Program"===e.type)return e;s.default.yy=m,m.locInfo=function(e){return new m.SourceLocation(t&&t.srcName,e)};var n=new u.default;return n.accept(s.default.parse(e))}var o=n(8).default,r=n(9).default;t.__esModule=!0,t.parse=i;var a=n(15),s=o(a),l=n(2),d=o(l),c=n(16),u=o(c),p=n(17),h=r(p),f=n(13);t.parser=s.default;var m={};f.extend(m,h,d.default)},function(e,t,n){"use strict";function i(){}function o(e,t,n){if(null==e||"string"!=typeof e&&"Program"!==e.type)throw new c.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);t=t||{},"data"in t||(t.data=!0),t.compat&&(t.useDepths=!0);var i=n.parse(e,t),o=(new n.Compiler).compile(i,t);return(new n.JavaScriptCompiler).compile(o,t)}function r(e,t,n){function i(){var t=n.parse(e,r),i=(new n.Compiler).compile(t,r),o=(new n.JavaScriptCompiler).compile(i,r,void 0,!0);return n.template(o)}function o(e,t){return a||(a=i()),a.call(this,e,t)}var r=void 0===arguments[1]?{}:arguments[1];if(null==e||"string"!=typeof e&&"Program"!==e.type)throw new c.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+e);"data"in r||(r.data=!0),r.compat&&(r.useDepths=!0);var a=void 0;return o._setup=function(e){return a||(a=i()),a._setup(e)},o._child=function(e,t,n,o){return a||(a=i()),a._child(e,t,n,o)},o}function a(e,t){if(e===t)return!0;if(u.isArray(e)&&u.isArray(t)&&e.length===t.length){for(var n=0;n<e.length;n++)if(!a(e[n],t[n]))return!1;return!0}}function s(e){if(!e.path.parts){var t=e.path;e.path=new h.default.PathExpression(!1,0,[t.original+""],t.original+"",t.loc)}}var l=n(8).default;t.__esModule=!0,t.Compiler=i,t.precompile=o,t.compile=r;var d=n(12),c=l(d),u=n(13),p=n(2),h=l(p),f=[].slice;i.prototype={compiler:i,equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var n=0;n<t;n++){var i=this.opcodes[n],o=e.opcodes[n];if(i.opcode!==o.opcode||!a(i.args,o.args))return!1}t=this.children.length;for(var n=0;n<t;n++)if(!this.children[n].equals(e.children[n]))return!1;return!0},guid:0,compile:function(e,t){this.sourceNode=[],this.opcodes=[],this.children=[],this.options=t,this.stringParams=t.stringParams,this.trackIds=t.trackIds,t.blockParams=t.blockParams||[];var n=t.knownHelpers;if(t.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},n)for(var i in n)i in n&&(t.knownHelpers[i]=n[i]);return this.accept(e)},compileProgram:function(e){var t=new this.compiler,n=t.compile(e,this.options),i=this.guid++;return this.usePartial=this.usePartial||n.usePartial,this.children[i]=n,this.useDepths=this.useDepths||n.useDepths,i},accept:function(e){this.sourceNode.unshift(e);var t=this[e.type](e);return this.sourceNode.shift(),t},Program:function(e){this.options.blockParams.unshift(e.blockParams);for(var t=e.body,n=t.length,i=0;i<n;i++)this.accept(t[i]);return this.options.blockParams.shift(),this.isSimple=1===n,this.blockParams=e.blockParams?e.blockParams.length:0,this},BlockStatement:function(e){s(e);var t=e.program,n=e.inverse;t=t&&this.compileProgram(t),n=n&&this.compileProgram(n);var i=this.classifySexpr(e);"helper"===i?this.helperSexpr(e,t,n):"simple"===i?(this.simpleSexpr(e),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("emptyHash"),this.opcode("blockValue",e.path.original)):(this.ambiguousSexpr(e,t,n),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},PartialStatement:function(e){this.usePartial=!0;var t=e.params;if(t.length>1)throw new c.default("Unsupported number of partial arguments: "+t.length,e);t.length||t.push({type:"PathExpression",parts:[],depth:0});var n=e.name.original,i="SubExpression"===e.name.type;i&&this.accept(e.name),this.setupFullMustacheParams(e,void 0,void 0,!0);var o=e.indent||"";this.options.preventIndent&&o&&(this.opcode("appendContent",o),o=""),this.opcode("invokePartial",i,n,o),this.opcode("append")},MustacheStatement:function(e){this.SubExpression(e),e.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ContentStatement:function(e){e.value&&this.opcode("appendContent",e.value)},CommentStatement:function(){},SubExpression:function(e){s(e);var t=this.classifySexpr(e);"simple"===t?this.simpleSexpr(e):"helper"===t?this.helperSexpr(e):this.ambiguousSexpr(e)},ambiguousSexpr:function(e,t,n){var i=e.path,o=i.parts[0],r=null!=t||null!=n;this.opcode("getContext",i.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.accept(i),this.opcode("invokeAmbiguous",o,r)},simpleSexpr:function(e){this.accept(e.path),this.opcode("resolvePossibleLambda")},helperSexpr:function(e,t,n){var i=this.setupFullMustacheParams(e,t,n),o=e.path,r=o.parts[0];if(this.options.knownHelpers[r])this.opcode("invokeKnownHelper",i.length,r);else{if(this.options.knownHelpersOnly)throw new c.default("You specified knownHelpersOnly, but used the unknown helper "+r,e);o.falsy=!0,this.accept(o),this.opcode("invokeHelper",i.length,o.original,h.default.helpers.simpleId(o))}},PathExpression:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var t=e.parts[0],n=h.default.helpers.scopedId(e),i=!e.depth&&!n&&this.blockParamIndex(t);i?this.opcode("lookupBlockParam",i,e.parts):t?e.data?(this.options.data=!0,this.opcode("lookupData",e.depth,e.parts)):this.opcode("lookupOnContext",e.parts,e.falsy,n):this.opcode("pushContext")},StringLiteral:function(e){this.opcode("pushString",e.value)},NumberLiteral:function(e){this.opcode("pushLiteral",e.value)},BooleanLiteral:function(e){this.opcode("pushLiteral",e.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(e){var t=e.pairs,n=0,i=t.length;for(this.opcode("pushHash");n<i;n++)this.pushParam(t[n].value);for(;n--;)this.opcode("assignToHash",t[n].key);this.opcode("popHash")},opcode:function(e){this.opcodes.push({opcode:e,args:f.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(e){e&&(this.useDepths=!0)},classifySexpr:function(e){var t=h.default.helpers.simpleId(e.path),n=t&&!!this.blockParamIndex(e.path.parts[0]),i=!n&&h.default.helpers.helperExpression(e),o=!n&&(i||t);if(o&&!i){var r=e.path.parts[0],a=this.options;a.knownHelpers[r]?i=!0:a.knownHelpersOnly&&(o=!1)}return i?"helper":o?"ambiguous":"simple"},pushParams:function(e){for(var t=0,n=e.length;t<n;t++)this.pushParam(e[t])},pushParam:function(e){var t=null!=e.value?e.value:e.original||"";if(this.stringParams)t.replace&&(t=t.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),e.depth&&this.addDepth(e.depth),this.opcode("getContext",e.depth||0),this.opcode("pushStringParam",t,e.type),"SubExpression"===e.type&&this.accept(e);else{if(this.trackIds){var n=void 0;if(!e.parts||h.default.helpers.scopedId(e)||e.depth||(n=this.blockParamIndex(e.parts[0])),n){var i=e.parts.slice(1).join(".");this.opcode("pushId","BlockParam",n,i)}else t=e.original||t,t.replace&&(t=t.replace(/^\.\//g,"").replace(/^\.$/g,"")),this.opcode("pushId",e.type,t)}this.accept(e)}},setupFullMustacheParams:function(e,t,n,i){var o=e.params;return this.pushParams(o),this.opcode("pushProgram",t),this.opcode("pushProgram",n),e.hash?this.accept(e.hash):this.opcode("emptyHash",i),o},blockParamIndex:function(e){for(var t=0,n=this.options.blockParams.length;t<n;t++){var i=this.options.blockParams[t],o=i&&u.indexOf(i,e);if(i&&o>=0)return[t,o]}}}},function(e,t,n){"use strict";function i(e){this.value=e}function o(){}function r(e,t,n,i){var o=t.popStack(),r=0,a=n.length;for(e&&a--;r<a;r++)o=t.nameLookup(o,n[r],i);return e?[t.aliasable("this.strict"),"(",o,", ",t.quotedString(n[r]),")"]:o}var a=n(8).default;t.__esModule=!0;var s=n(10),l=n(12),d=a(l),c=n(13),u=n(18),p=a(u);o.prototype={nameLookup:function(e,t){return o.isValidJavaScriptVariableName(t)?[e,".",t]:[e,"['",t,"']"]},depthedLookup:function(e){return[this.aliasable("this.lookup"),'(depths, "',e,'")']},compilerInfo:function(){var e=s.COMPILER_REVISION,t=s.REVISION_CHANGES[e];return[e,t]},appendToBuffer:function(e,t,n){return c.isArray(e)||(e=[e]),e=this.source.wrap(e,t),this.environment.isSimple?["return ",e,";"]:n?["buffer += ",e,";"]:(e.appendToBuffer=!0,e)},initializeBuffer:function(){return this.quotedString("")},compile:function(e,t,n,i){this.environment=e,this.options=t,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!i,this.name=this.environment.name,this.isChild=!!n,this.context=n||{programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(e,t),this.useDepths=this.useDepths||e.useDepths||this.options.compat,this.useBlockParams=this.useBlockParams||e.useBlockParams;var o=e.opcodes,r=void 0,a=void 0,s=void 0,l=void 0;for(s=0,l=o.length;s<l;s++)r=o[s],this.source.currentLocation=r.loc,a=a||r.loc,this[r.opcode].apply(this,r.args);if(this.source.currentLocation=a,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new d.default("Compile completed with content left on stack");var c=this.createFunctionContext(i);if(this.isChild)return c;var u={compiler:this.compilerInfo(),main:c},p=this.context.programs;for(s=0,l=p.length;s<l;s++)p[s]&&(u[s]=p[s]);return this.environment.usePartial&&(u.usePartial=!0),this.options.data&&(u.useData=!0),this.useDepths&&(u.useDepths=!0),this.useBlockParams&&(u.useBlockParams=!0),this.options.compat&&(u.compat=!0),i?u.compilerOptions=this.options:(u.compiler=JSON.stringify(u.compiler),this.source.currentLocation={start:{line:1,column:0}},u=this.objectLiteral(u),t.srcName?(u=u.toStringWithSourceMap({file:t.destName}),u.map=u.map&&u.map.toString()):u=u.toString()),u},preamble:function(){this.lastContext=0,this.source=new p.default(this.options.srcName)},createFunctionContext:function(e){var t="",n=this.stackVars.concat(this.registers.list);n.length>0&&(t+=", "+n.join(", "));var i=0;for(var o in this.aliases){var r=this.aliases[o];this.aliases.hasOwnProperty(o)&&r.children&&r.referenceCount>1&&(t+=", alias"+ ++i+"="+o,r.children[0]="alias"+i)}var a=["depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&a.push("blockParams"),this.useDepths&&a.push("depths");var s=this.mergeSource(t);return e?(a.push(s),Function.apply(this,a)):this.source.wrap(["function(",a.join(","),") {\n  ",s,"}"])},mergeSource:function(e){var t=this.environment.isSimple,n=!this.forceBuffer,i=void 0,o=void 0,r=void 0,a=void 0;return this.source.each(function(e){e.appendToBuffer?(r?e.prepend("  + "):r=e,a=e):(r&&(o?r.prepend("buffer += "):i=!0,a.add(";"),r=a=void 0),o=!0,t||(n=!1))}),n?r?(r.prepend("return "),a.add(";")):o||this.source.push('return "";'):(e+=", buffer = "+(i?"":this.initializeBuffer()),r?(r.prepend("return buffer + "),a.add(";")):this.source.push("return buffer;")),e&&this.source.prepend("var "+e.substring(2)+(i?"":";\n")),this.source.merge()},blockValue:function(e){var t=this.aliasable("helpers.blockHelperMissing"),n=[this.contextName(0)];this.setupHelperArgs(e,0,n);var i=this.popStack();n.splice(1,0,i),this.push(this.source.functionCall(t,"call",n))},ambiguousBlockValue:function(){var e=this.aliasable("helpers.blockHelperMissing"),t=[this.contextName(0)];this.setupHelperArgs("",0,t,!0),this.flushInline();var n=this.topStack();t.splice(1,0,n),this.pushSource(["if (!",this.lastHelper,") { ",n," = ",this.source.functionCall(e,"call",t),"}"])},appendContent:function(e){this.pendingContent?e=this.pendingContent+e:this.pendingLocation=this.source.currentLocation,this.pendingContent=e},append:function(){if(this.isInline())this.replaceStack(function(e){return[" != null ? ",e,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var e=this.popStack();this.pushSource(["if (",e," != null) { ",this.appendToBuffer(e,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("this.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(e){this.lastContext=e},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(e,t,n){var i=0;n||!this.options.compat||this.lastContext?this.pushContext():this.push(this.depthedLookup(e[i++])),this.resolvePath("context",e,i,t)},lookupBlockParam:function(e,t){this.useBlockParams=!0,this.push(["blockParams[",e[0],"][",e[1],"]"]),this.resolvePath("context",t,1)},lookupData:function(e,t){e?this.pushStackLiteral("this.data(data, "+e+")"):this.pushStackLiteral("data"),this.resolvePath("data",t,0,!0)},resolvePath:function(e,t,n,i){var o=this;if(this.options.strict||this.options.assumeObjects)return void this.push(r(this.options.strict,this,t,e));for(var a=t.length;n<a;n++)this.replaceStack(function(r){var a=o.nameLookup(r,t[n],e);return i?[" && ",a]:[" != null ? ",a," : ",r]})},resolvePossibleLambda:function(){this.push([this.aliasable("this.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(e,t){this.pushContext(),this.pushString(t),"SubExpression"!==t&&("string"==typeof e?this.pushString(e):this.pushStackLiteral(e))},emptyHash:function(e){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(e?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[],ids:[]}},popHash:function(){var e=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(e.ids)),this.stringParams&&(this.push(this.objectLiteral(e.contexts)),this.push(this.objectLiteral(e.types))),this.push(this.objectLiteral(e.values))},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){null!=e?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null);},invokeHelper:function(e,t,n){var i=this.popStack(),o=this.setupHelper(e,t),r=n?[o.name," || "]:"",a=["("].concat(r,i);this.options.strict||a.push(" || ",this.aliasable("helpers.helperMissing")),a.push(")"),this.push(this.source.functionCall(a,"call",o.callParams))},invokeKnownHelper:function(e,t){var n=this.setupHelper(e,t);this.push(this.source.functionCall(n.name,"call",n.callParams))},invokeAmbiguous:function(e,t){this.useRegister("helper");var n=this.popStack();this.emptyHash();var i=this.setupHelper(0,e,t),o=this.lastHelper=this.nameLookup("helpers",e,"helper"),r=["(","(helper = ",o," || ",n,")"];this.options.strict||(r[0]="(helper = ",r.push(" != null ? helper : ",this.aliasable("helpers.helperMissing"))),this.push(["(",r,i.paramsInit?["),(",i.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",i.callParams)," : helper))"])},invokePartial:function(e,t,n){var i=[],o=this.setupParams(t,1,i,!1);e&&(t=this.popStack(),delete o.name),n&&(o.indent=JSON.stringify(n)),o.helpers="helpers",o.partials="partials",e?i.unshift(t):i.unshift(this.nameLookup("partials",t,"partial")),this.options.compat&&(o.depths="depths"),o=this.objectLiteral(o),i.push(o),this.push(this.source.functionCall("this.invokePartial","",i))},assignToHash:function(e){var t=this.popStack(),n=void 0,i=void 0,o=void 0;this.trackIds&&(o=this.popStack()),this.stringParams&&(i=this.popStack(),n=this.popStack());var r=this.hash;n&&(r.contexts[e]=n),i&&(r.types[e]=i),o&&(r.ids[e]=o),r.values[e]=t},pushId:function(e,t,n){"BlockParam"===e?this.pushStackLiteral("blockParams["+t[0]+"].path["+t[1]+"]"+(n?" + "+JSON.stringify("."+n):"")):"PathExpression"===e?this.pushString(t):"SubExpression"===e?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:o,compileChildren:function(e,t){for(var n=e.children,i=void 0,o=void 0,r=0,a=n.length;r<a;r++){i=n[r],o=new this.compiler;var s=this.matchExistingProgram(i);null==s?(this.context.programs.push(""),s=this.context.programs.length,i.index=s,i.name="program"+s,this.context.programs[s]=o.compile(i,t,this.context,!this.precompile),this.context.environments[s]=i,this.useDepths=this.useDepths||o.useDepths,this.useBlockParams=this.useBlockParams||o.useBlockParams):(i.index=s,i.name="program"+s,this.useDepths=this.useDepths||i.useDepths,this.useBlockParams=this.useBlockParams||i.useBlockParams)}},matchExistingProgram:function(e){for(var t=0,n=this.context.environments.length;t<n;t++){var i=this.context.environments[t];if(i&&i.equals(e))return t}},programExpression:function(e){var t=this.environment.children[e],n=[t.index,"data",t.blockParams];return(this.useBlockParams||this.useDepths)&&n.push("blockParams"),this.useDepths&&n.push("depths"),"this.program("+n.join(", ")+")"},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},push:function(e){return e instanceof i||(e=this.source.wrap(e)),this.inlineStack.push(e),e},pushStackLiteral:function(e){this.push(new i(e))},pushSource:function(e){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),e&&this.source.push(e)},replaceStack:function(e){var t=["("],n=void 0,o=void 0,r=void 0;if(!this.isInline())throw new d.default("replaceStack on non-inline");var a=this.popStack(!0);if(a instanceof i)n=[a.value],t=["(",n],r=!0;else{o=!0;var s=this.incrStack();t=["((",this.push(s)," = ",a,")"],n=this.topStack()}var l=e.call(this,n);r||this.popStack(),o&&this.stackSlot--,this.push(t.concat(l,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;this.inlineStack=[];for(var t=0,n=e.length;t<n;t++){var o=e[t];if(o instanceof i)this.compileStack.push(o);else{var r=this.incrStack();this.pushSource([r," = ",o,";"]),this.compileStack.push(r)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var t=this.isInline(),n=(t?this.inlineStack:this.compileStack).pop();if(!e&&n instanceof i)return n.value;if(!t){if(!this.stackSlot)throw new d.default("Invalid stack pop");this.stackSlot--}return n},topStack:function(){var e=this.isInline()?this.inlineStack:this.compileStack,t=e[e.length-1];return t instanceof i?t.value:t},contextName:function(e){return this.useDepths&&e?"depths["+e+"]":"depth"+e},quotedString:function(e){return this.source.quotedString(e)},objectLiteral:function(e){return this.source.objectLiteral(e)},aliasable:function(e){var t=this.aliases[e];return t?(t.referenceCount++,t):(t=this.aliases[e]=this.source.wrap(e),t.aliasable=!0,t.referenceCount=1,t)},setupHelper:function(e,t,n){var i=[],o=this.setupHelperArgs(t,e,i,n),r=this.nameLookup("helpers",t,"helper");return{params:i,paramsInit:o,name:r,callParams:[this.contextName(0)].concat(i)}},setupParams:function(e,t,n){var i={},o=[],r=[],a=[],s=void 0;i.name=this.quotedString(e),i.hash=this.popStack(),this.trackIds&&(i.hashIds=this.popStack()),this.stringParams&&(i.hashTypes=this.popStack(),i.hashContexts=this.popStack());var l=this.popStack(),d=this.popStack();(d||l)&&(i.fn=d||"this.noop",i.inverse=l||"this.noop");for(var c=t;c--;)s=this.popStack(),n[c]=s,this.trackIds&&(a[c]=this.popStack()),this.stringParams&&(r[c]=this.popStack(),o[c]=this.popStack());return this.trackIds&&(i.ids=this.source.generateArray(a)),this.stringParams&&(i.types=this.source.generateArray(r),i.contexts=this.source.generateArray(o)),this.options.data&&(i.data="data"),this.useBlockParams&&(i.blockParams="blockParams"),i},setupHelperArgs:function(e,t,n,i){var o=this.setupParams(e,t,n,!0);return o=this.objectLiteral(o),i?(this.useRegister("options"),n.push("options"),["options=",o]):(n.push(o),"")}},function(){for(var e="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),t=o.RESERVED_WORDS={},n=0,i=e.length;n<i;n++)t[e[n]]=!0}(),o.isValidJavaScriptVariableName=function(e){return!o.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(e)},t.default=o,e.exports=t.default},function(e,t,n){"use strict";function i(){this.parents=[]}var o=n(8).default;t.__esModule=!0;var r=n(12),a=o(r),s=n(2),l=o(s);i.prototype={constructor:i,mutating:!1,acceptKey:function(e,t){var n=this.accept(e[t]);if(this.mutating){if(n&&(!n.type||!l.default[n.type]))throw new a.default('Unexpected node type "'+n.type+'" found when accepting '+t+" on "+e.type);e[t]=n}},acceptRequired:function(e,t){if(this.acceptKey(e,t),!e[t])throw new a.default(e.type+" requires "+t)},acceptArray:function(e){for(var t=0,n=e.length;t<n;t++)this.acceptKey(e,t),e[t]||(e.splice(t,1),t--,n--)},accept:function(e){if(e){this.current&&this.parents.unshift(this.current),this.current=e;var t=this[e.type](e);return this.current=this.parents.shift(),!this.mutating||t?t:t!==!1?e:void 0}},Program:function(e){this.acceptArray(e.body)},MustacheStatement:function(e){this.acceptRequired(e,"path"),this.acceptArray(e.params),this.acceptKey(e,"hash")},BlockStatement:function(e){this.acceptRequired(e,"path"),this.acceptArray(e.params),this.acceptKey(e,"hash"),this.acceptKey(e,"program"),this.acceptKey(e,"inverse")},PartialStatement:function(e){this.acceptRequired(e,"name"),this.acceptArray(e.params),this.acceptKey(e,"hash")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:function(e){this.acceptRequired(e,"path"),this.acceptArray(e.params),this.acceptKey(e,"hash")},PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(e){this.acceptArray(e.pairs)},HashPair:function(e){this.acceptRequired(e,"value")}},t.default=i,e.exports=t.default},function(e,t,n){(function(n){"use strict";t.__esModule=!0,t.default=function(e){var t="undefined"!=typeof n?n:window,i=t.Handlebars;e.noConflict=function(){t.Handlebars===e&&(t.Handlebars=i)}},e.exports=t.default}).call(t,function(){return this}())},function(e,t,n){"use strict";t.default=function(e){return e&&e.__esModule?e:{default:e}},t.__esModule=!0},function(e,t,n){"use strict";t.default=function(e){if(e&&e.__esModule)return e;var t={};if("object"==typeof e&&null!==e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},t.__esModule=!0},function(e,t,n){"use strict";function i(e,t){this.helpers=e||{},this.partials=t||{},o(this)}function o(e){e.registerHelper("helperMissing",function(){if(1!==arguments.length)throw new u.default('Missing helper: "'+arguments[arguments.length-1].name+'"')}),e.registerHelper("blockHelperMissing",function(t,n){var i=n.inverse,o=n.fn;if(t===!0)return o(this);if(t===!1||null==t)return i(this);if(m(t))return t.length>0?(n.ids&&(n.ids=[n.name]),e.helpers.each(t,n)):i(this);if(n.data&&n.ids){var a=r(n.data);a.contextPath=d.appendContextPath(n.data.contextPath,n.name),n={data:a}}return o(t,n)}),e.registerHelper("each",function(e,t){function n(t,n,o){l&&(l.key=t,l.index=n,l.first=0===n,l.last=!!o,c&&(l.contextPath=c+t)),s+=i(e[t],{data:l,blockParams:d.blockParams([e[t],t],[c+t,null])})}if(!t)throw new u.default("Must pass iterator to #each");var i=t.fn,o=t.inverse,a=0,s="",l=void 0,c=void 0;if(t.data&&t.ids&&(c=d.appendContextPath(t.data.contextPath,t.ids[0])+"."),g(e)&&(e=e.call(this)),t.data&&(l=r(t.data)),e&&"object"==typeof e)if(m(e))for(var p=e.length;a<p;a++)n(a,a,a===e.length-1);else{var h=void 0;for(var f in e)e.hasOwnProperty(f)&&(h&&n(h,a-1),h=f,a++);h&&n(h,a-1,!0)}return 0===a&&(s=o(this)),s}),e.registerHelper("if",function(e,t){return g(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||d.isEmpty(e)?t.inverse(this):t.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers.if.call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})}),e.registerHelper("with",function(e,t){g(e)&&(e=e.call(this));var n=t.fn;if(d.isEmpty(e))return t.inverse(this);if(t.data&&t.ids){var i=r(t.data);i.contextPath=d.appendContextPath(t.data.contextPath,t.ids[0]),t={data:i}}return n(e,t)}),e.registerHelper("log",function(t,n){var i=n.data&&null!=n.data.level?parseInt(n.data.level,10):1;e.log(i,t)}),e.registerHelper("lookup",function(e,t){return e&&e[t]})}function r(e){var t=d.extend({},e);return t._parent=e,t}var a=n(9).default,s=n(8).default;t.__esModule=!0,t.HandlebarsEnvironment=i,t.createFrame=r;var l=n(13),d=a(l),c=n(12),u=s(c),p="3.0.1";t.VERSION=p;var h=6;t.COMPILER_REVISION=h;var f={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1"};t.REVISION_CHANGES=f;var m=d.isArray,g=d.isFunction,T=d.toString,_="[object Object]";i.prototype={constructor:i,logger:E,log:v,registerHelper:function(e,t){if(T.call(e)===_){if(t)throw new u.default("Arg not supported with multiple helpers");d.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if(T.call(e)===_)d.extend(this.partials,e);else{if("undefined"==typeof t)throw new u.default("Attempting to register a partial as undefined");this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]}};var E={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:1,log:function(e,t){if("undefined"!=typeof console&&E.level<=e){var n=E.methodMap[e];(console[n]||console.log).call(console,t)}}};t.logger=E;var v=E.log;t.log=v},function(e,t,n){"use strict";function i(e){this.string=e}t.__esModule=!0,i.prototype.toString=i.prototype.toHTML=function(){return""+this.string},t.default=i,e.exports=t.default},function(e,t,n){"use strict";function i(e,t){var n=t&&t.loc,r=void 0,a=void 0;n&&(r=n.start.line,a=n.start.column,e+=" - "+r+":"+a);for(var s=Error.prototype.constructor.call(this,e),l=0;l<o.length;l++)this[o[l]]=s[o[l]];Error.captureStackTrace&&Error.captureStackTrace(this,i),n&&(this.lineNumber=r,this.column=a)}t.__esModule=!0;var o=["description","fileName","lineNumber","message","name","number","stack"];i.prototype=new Error,t.default=i,e.exports=t.default},function(e,t,n){"use strict";function i(e){return c[e]}function o(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],n)&&(e[n]=arguments[t][n]);return e}function r(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}function a(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}return p.test(e)?e.replace(u,i):e}function s(e){return!e&&0!==e||!(!m(e)||0!==e.length)}function l(e,t){return e.path=t,e}function d(e,t){return(e?e+".":"")+t}t.__esModule=!0,t.extend=o,t.indexOf=r,t.escapeExpression=a,t.isEmpty=s,t.blockParams=l,t.appendContextPath=d;var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},u=/[&<>"'`]/g,p=/[&<>"'`]/,h=Object.prototype.toString;t.toString=h;var f=function(e){return"function"==typeof e};f(/x/)&&(t.isFunction=f=function(e){return"function"==typeof e&&"[object Function]"===h.call(e)});var f;t.isFunction=f;var m=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===h.call(e)};t.isArray=m},function(e,t,n){"use strict";function i(e){var t=e&&e[0]||1,n=g.COMPILER_REVISION;if(t!==n){if(t<n){var i=g.REVISION_CHANGES[n],o=g.REVISION_CHANGES[t];throw new m.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+i+") or downgrade your runtime to an older version ("+o+").")}throw new m.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}}function o(e,t){function n(n,i,o){o.hash&&(i=h.extend({},i,o.hash)),n=t.VM.resolvePartial.call(this,n,i,o);var r=t.VM.invokePartial.call(this,n,i,o);if(null==r&&t.compile&&(o.partials[o.name]=t.compile(n,e.compilerOptions,t),r=o.partials[o.name](i,o)),null!=r){if(o.indent){for(var a=r.split("\n"),s=0,l=a.length;s<l&&(a[s]||s+1!==l);s++)a[s]=o.indent+a[s];r=a.join("\n")}return r}throw new m.default("The partial "+o.name+" could not be compiled when running in runtime-only mode")}function i(t){var n=void 0===arguments[1]?{}:arguments[1],r=n.data;i._setup(n),!n.partial&&e.useData&&(r=d(t,r));var a=void 0,s=e.useBlockParams?[]:void 0;return e.useDepths&&(a=n.depths?[t].concat(n.depths):[t]),e.main.call(o,t,o.helpers,o.partials,r,s,a)}if(!t)throw new m.default("No environment passed to template");if(!e||!e.main)throw new m.default("Unknown template object: "+typeof e);t.VM.checkRevision(e.compiler);var o={strict:function(e,t){if(!(t in e))throw new m.default('"'+t+'" not defined in '+e);return e[t]},lookup:function(e,t){for(var n=e.length,i=0;i<n;i++)if(e[i]&&null!=e[i][t])return e[i][t]},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:h.escapeExpression,invokePartial:n,fn:function(t){return e[t]},programs:[],program:function(e,t,n,i,o){var a=this.programs[e],s=this.fn(e);return t||o||i||n?a=r(this,e,s,t,n,i,o):a||(a=this.programs[e]=r(this,e,s)),a},data:function(e,t){for(;e&&t--;)e=e._parent;return e},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n=h.extend({},t,e)),n},noop:t.VM.noop,compilerInfo:e.compiler};return i.isTop=!0,i._setup=function(n){n.partial?(o.helpers=n.helpers,o.partials=n.partials):(o.helpers=o.merge(n.helpers,t.helpers),e.usePartial&&(o.partials=o.merge(n.partials,t.partials)))},i._child=function(t,n,i,a){if(e.useBlockParams&&!i)throw new m.default("must pass block params");if(e.useDepths&&!a)throw new m.default("must pass parent depths");return r(o,t,e[t],n,0,i,a)},i}function r(e,t,n,i,o,r,a){function s(t){var o=void 0===arguments[1]?{}:arguments[1];return n.call(e,t,e.helpers,e.partials,o.data||i,r&&[o.blockParams].concat(r),a&&[t].concat(a))}return s.program=t,s.depth=a?a.length:0,s.blockParams=o||0,s}function a(e,t,n){return e?e.call||n.name||(n.name=e,e=n.partials[e]):e=n.partials[n.name],e}function s(e,t,n){if(n.partial=!0,void 0===e)throw new m.default("The partial "+n.name+" could not be found");if(e instanceof Function)return e(t,n)}function l(){return""}function d(e,t){return t&&"root"in t||(t=t?g.createFrame(t):{},t.root=e),t}var c=n(9).default,u=n(8).default;t.__esModule=!0,t.checkRevision=i,t.template=o,t.wrapProgram=r,t.resolvePartial=a,t.invokePartial=s,t.noop=l;var p=n(13),h=c(p),f=n(12),m=u(f),g=n(10)},function(e,t,n){"use strict";t.__esModule=!0;var i=function(){function e(){this.yy={}}var t={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,content:12,COMMENT:13,CONTENT:14,openRawBlock:15,END_RAW_BLOCK:16,OPEN_RAW_BLOCK:17,helperName:18,openRawBlock_repetition0:19,openRawBlock_option0:20,CLOSE_RAW_BLOCK:21,openBlock:22,block_option0:23,closeBlock:24,openInverse:25,block_option1:26,OPEN_BLOCK:27,openBlock_repetition0:28,openBlock_option0:29,openBlock_option1:30,CLOSE:31,OPEN_INVERSE:32,openInverse_repetition0:33,openInverse_option0:34,openInverse_option1:35,openInverseChain:36,OPEN_INVERSE_CHAIN:37,openInverseChain_repetition0:38,openInverseChain_option0:39,openInverseChain_option1:40,inverseAndProgram:41,INVERSE:42,inverseChain:43,inverseChain_option0:44,OPEN_ENDBLOCK:45,OPEN:46,mustache_repetition0:47,mustache_option0:48,OPEN_UNESCAPED:49,mustache_repetition1:50,mustache_option1:51,CLOSE_UNESCAPED:52,OPEN_PARTIAL:53,partialName:54,partial_repetition0:55,partial_option0:56,param:57,sexpr:58,OPEN_SEXPR:59,sexpr_repetition0:60,sexpr_option0:61,CLOSE_SEXPR:62,hash:63,hash_repetition_plus0:64,hashSegment:65,ID:66,EQUALS:67,blockParams:68,OPEN_BLOCK_PARAMS:69,blockParams_repetition_plus0:70,CLOSE_BLOCK_PARAMS:71,path:72,dataName:73,STRING:74,NUMBER:75,BOOLEAN:76,UNDEFINED:77,NULL:78,DATA:79,pathSegments:80,SEP:81,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",13:"COMMENT",14:"CONTENT",16:"END_RAW_BLOCK",17:"OPEN_RAW_BLOCK",21:"CLOSE_RAW_BLOCK",27:"OPEN_BLOCK",31:"CLOSE",32:"OPEN_INVERSE",37:"OPEN_INVERSE_CHAIN",42:"INVERSE",45:"OPEN_ENDBLOCK",46:"OPEN",49:"OPEN_UNESCAPED",52:"CLOSE_UNESCAPED",53:"OPEN_PARTIAL",59:"OPEN_SEXPR",62:"CLOSE_SEXPR",66:"ID",67:"EQUALS",69:"OPEN_BLOCK_PARAMS",71:"CLOSE_BLOCK_PARAMS",74:"STRING",75:"NUMBER",76:"BOOLEAN",77:"UNDEFINED",78:"NULL",79:"DATA",81:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[12,1],[10,3],[15,5],[9,4],[9,4],[22,6],[25,6],[36,6],[41,2],[43,3],[43,1],[24,3],[8,5],[8,5],[11,5],[57,1],[57,1],[58,5],[63,1],[65,3],[68,3],[18,1],[18,1],[18,1],[18,1],[18,1],[18,1],[18,1],[54,1],[54,1],[73,2],[72,1],[80,3],[80,1],[6,0],[6,2],[19,0],[19,2],[20,0],[20,1],[23,0],[23,1],[26,0],[26,1],[28,0],[28,2],[29,0],[29,1],[30,0],[30,1],[33,0],[33,2],[34,0],[34,1],[35,0],[35,1],[38,0],[38,2],[39,0],[39,1],[40,0],[40,1],[44,0],[44,1],[47,0],[47,2],[48,0],[48,1],[50,0],[50,2],[51,0],[51,1],[55,0],[55,2],[56,0],[56,1],[60,0],[60,2],[61,0],[61,1],[64,1],[64,2],[70,1],[70,2]],performAction:function(e,t,n,i,o,r,a){var s=r.length-1;switch(o){case 1:return r[s-1];case 2:this.$=new i.Program(r[s],null,{},i.locInfo(this._$));break;case 3:this.$=r[s];break;case 4:this.$=r[s];break;case 5:this.$=r[s];break;case 6:this.$=r[s];break;case 7:this.$=r[s];break;case 8:this.$=new i.CommentStatement(i.stripComment(r[s]),i.stripFlags(r[s],r[s]),i.locInfo(this._$));break;case 9:this.$=new i.ContentStatement(r[s],i.locInfo(this._$));break;case 10:this.$=i.prepareRawBlock(r[s-2],r[s-1],r[s],this._$);break;case 11:this.$={path:r[s-3],params:r[s-2],hash:r[s-1]};break;case 12:this.$=i.prepareBlock(r[s-3],r[s-2],r[s-1],r[s],!1,this._$);break;case 13:this.$=i.prepareBlock(r[s-3],r[s-2],r[s-1],r[s],!0,this._$);break;case 14:this.$={path:r[s-4],params:r[s-3],hash:r[s-2],blockParams:r[s-1],strip:i.stripFlags(r[s-5],r[s])};break;case 15:this.$={path:r[s-4],params:r[s-3],hash:r[s-2],blockParams:r[s-1],strip:i.stripFlags(r[s-5],r[s])};break;case 16:this.$={path:r[s-4],params:r[s-3],hash:r[s-2],blockParams:r[s-1],strip:i.stripFlags(r[s-5],r[s])};break;case 17:this.$={strip:i.stripFlags(r[s-1],r[s-1]),program:r[s]};break;case 18:var l=i.prepareBlock(r[s-2],r[s-1],r[s],r[s],!1,this._$),d=new i.Program([l],null,{},i.locInfo(this._$));d.chained=!0,this.$={strip:r[s-2].strip,program:d,chain:!0};break;case 19:this.$=r[s];break;case 20:this.$={path:r[s-1],strip:i.stripFlags(r[s-2],r[s])};break;case 21:this.$=i.prepareMustache(r[s-3],r[s-2],r[s-1],r[s-4],i.stripFlags(r[s-4],r[s]),this._$);break;case 22:this.$=i.prepareMustache(r[s-3],r[s-2],r[s-1],r[s-4],i.stripFlags(r[s-4],r[s]),this._$);break;case 23:this.$=new i.PartialStatement(r[s-3],r[s-2],r[s-1],i.stripFlags(r[s-4],r[s]),i.locInfo(this._$));break;case 24:this.$=r[s];break;case 25:this.$=r[s];break;case 26:this.$=new i.SubExpression(r[s-3],r[s-2],r[s-1],i.locInfo(this._$));break;case 27:this.$=new i.Hash(r[s],i.locInfo(this._$));break;case 28:this.$=new i.HashPair(i.id(r[s-2]),r[s],i.locInfo(this._$));break;case 29:this.$=i.id(r[s-1]);break;case 30:this.$=r[s];break;case 31:this.$=r[s];break;case 32:this.$=new i.StringLiteral(r[s],i.locInfo(this._$));break;case 33:this.$=new i.NumberLiteral(r[s],i.locInfo(this._$));break;case 34:this.$=new i.BooleanLiteral(r[s],i.locInfo(this._$));break;case 35:this.$=new i.UndefinedLiteral(i.locInfo(this._$));break;case 36:this.$=new i.NullLiteral(i.locInfo(this._$));break;case 37:this.$=r[s];break;case 38:this.$=r[s];break;case 39:this.$=i.preparePath(!0,r[s],this._$);break;case 40:this.$=i.preparePath(!1,r[s],this._$);break;case 41:r[s-2].push({part:i.id(r[s]),original:r[s],separator:r[s-1]}),this.$=r[s-2];break;case 42:this.$=[{part:i.id(r[s]),original:r[s]}];break;case 43:this.$=[];break;case 44:r[s-1].push(r[s]);break;case 45:this.$=[];break;case 46:r[s-1].push(r[s]);break;case 53:this.$=[];break;case 54:r[s-1].push(r[s]);break;case 59:this.$=[];break;case 60:r[s-1].push(r[s]);break;case 65:this.$=[];break;case 66:r[s-1].push(r[s]);break;case 73:this.$=[];break;case 74:r[s-1].push(r[s]);break;case 77:this.$=[];break;case 78:r[s-1].push(r[s]);break;case 81:this.$=[];break;case 82:r[s-1].push(r[s]);break;case 85:this.$=[];break;case 86:r[s-1].push(r[s]);break;case 89:this.$=[r[s]];break;case 90:r[s-1].push(r[s]);break;case 91:this.$=[r[s]];break;case 92:r[s-1].push(r[s])}},table:[{3:1,4:2,5:[2,43],6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],46:[2,43],49:[2,43],53:[2,43]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:[1,11],14:[1,18],15:16,17:[1,21],22:14,25:15,27:[1,19],32:[1,20],37:[2,2],42:[2,2],45:[2,2],46:[1,12],49:[1,13],53:[1,17]},{1:[2,1]},{5:[2,44],13:[2,44],14:[2,44],17:[2,44],27:[2,44],32:[2,44],37:[2,44],42:[2,44],45:[2,44],46:[2,44],49:[2,44],53:[2,44]},{5:[2,3],13:[2,3],14:[2,3],17:[2,3],27:[2,3],32:[2,3],37:[2,3],42:[2,3],45:[2,3],46:[2,3],49:[2,3],53:[2,3]},{5:[2,4],13:[2,4],14:[2,4],17:[2,4],27:[2,4],32:[2,4],37:[2,4],42:[2,4],45:[2,4],46:[2,4],49:[2,4],53:[2,4]},{5:[2,5],13:[2,5],14:[2,5],17:[2,5],27:[2,5],32:[2,5],37:[2,5],42:[2,5],45:[2,5],46:[2,5],49:[2,5],53:[2,5]},{5:[2,6],13:[2,6],14:[2,6],17:[2,6],27:[2,6],32:[2,6],37:[2,6],42:[2,6],45:[2,6],46:[2,6],49:[2,6],53:[2,6]},{5:[2,7],13:[2,7],14:[2,7],17:[2,7],27:[2,7],32:[2,7],37:[2,7],42:[2,7],45:[2,7],46:[2,7],49:[2,7],53:[2,7]},{5:[2,8],13:[2,8],14:[2,8],17:[2,8],27:[2,8],32:[2,8],37:[2,8],42:[2,8],45:[2,8],46:[2,8],49:[2,8],53:[2,8]},{18:22,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:33,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{4:34,6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],37:[2,43],42:[2,43],45:[2,43],46:[2,43],49:[2,43],53:[2,43]},{4:35,6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],42:[2,43],45:[2,43],46:[2,43],49:[2,43],53:[2,43]},{12:36,14:[1,18]},{18:38,54:37,58:39,59:[1,40],66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{5:[2,9],13:[2,9],14:[2,9],16:[2,9],17:[2,9],27:[2,9],32:[2,9],37:[2,9],42:[2,9],45:[2,9],46:[2,9],49:[2,9],53:[2,9]},{18:41,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:42,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:43,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{31:[2,73],47:44,59:[2,73],66:[2,73],74:[2,73],75:[2,73],76:[2,73],77:[2,73],78:[2,73],79:[2,73]},{21:[2,30],31:[2,30],52:[2,30],59:[2,30],62:[2,30],66:[2,30],69:[2,30],74:[2,30],75:[2,30],76:[2,30],77:[2,30],78:[2,30],79:[2,30]},{21:[2,31],31:[2,31],52:[2,31],59:[2,31],62:[2,31],66:[2,31],69:[2,31],74:[2,31],75:[2,31],76:[2,31],77:[2,31],78:[2,31],79:[2,31]},{21:[2,32],31:[2,32],52:[2,32],59:[2,32],62:[2,32],66:[2,32],69:[2,32],74:[2,32],75:[2,32],76:[2,32],77:[2,32],78:[2,32],79:[2,32]},{21:[2,33],31:[2,33],52:[2,33],59:[2,33],62:[2,33],66:[2,33],69:[2,33],74:[2,33],75:[2,33],76:[2,33],77:[2,33],78:[2,33],79:[2,33]},{21:[2,34],31:[2,34],52:[2,34],59:[2,34],62:[2,34],66:[2,34],69:[2,34],74:[2,34],75:[2,34],76:[2,34],77:[2,34],78:[2,34],79:[2,34]},{21:[2,35],31:[2,35],52:[2,35],59:[2,35],62:[2,35],66:[2,35],69:[2,35],74:[2,35],75:[2,35],76:[2,35],77:[2,35],78:[2,35],79:[2,35]},{21:[2,36],31:[2,36],52:[2,36],59:[2,36],62:[2,36],66:[2,36],69:[2,36],74:[2,36],75:[2,36],76:[2,36],77:[2,36],78:[2,36],79:[2,36]},{21:[2,40],31:[2,40],52:[2,40],59:[2,40],62:[2,40],66:[2,40],69:[2,40],74:[2,40],75:[2,40],76:[2,40],77:[2,40],78:[2,40],79:[2,40],81:[1,45]},{66:[1,32],80:46},{21:[2,42],31:[2,42],52:[2,42],59:[2,42],62:[2,42],66:[2,42],69:[2,42],74:[2,42],75:[2,42],76:[2,42],77:[2,42],78:[2,42],79:[2,42],81:[2,42]},{50:47,52:[2,77],59:[2,77],66:[2,77],74:[2,77],75:[2,77],76:[2,77],77:[2,77],78:[2,77],79:[2,77]},{23:48,36:50,37:[1,52],41:51,42:[1,53],43:49,45:[2,49]},{26:54,41:55,42:[1,53],45:[2,51]},{16:[1,56]},{31:[2,81],55:57,59:[2,81],66:[2,81],74:[2,81],75:[2,81],76:[2,81],77:[2,81],78:[2,81],79:[2,81]},{31:[2,37],59:[2,37],66:[2,37],74:[2,37],75:[2,37],76:[2,37],77:[2,37],78:[2,37],79:[2,37]},{31:[2,38],59:[2,38],66:[2,38],74:[2,38],75:[2,38],76:[2,38],77:[2,38],78:[2,38],79:[2,38]},{18:58,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{28:59,31:[2,53],59:[2,53],66:[2,53],69:[2,53],74:[2,53],75:[2,53],76:[2,53],77:[2,53],78:[2,53],79:[2,53]},{31:[2,59],33:60,59:[2,59],66:[2,59],69:[2,59],74:[2,59],75:[2,59],76:[2,59],77:[2,59],78:[2,59],79:[2,59]},{19:61,21:[2,45],59:[2,45],66:[2,45],74:[2,45],75:[2,45],76:[2,45],77:[2,45],78:[2,45],79:[2,45]},{18:65,31:[2,75],48:62,57:63,58:66,59:[1,40],63:64,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{66:[1,70]},{21:[2,39],31:[2,39],52:[2,39],59:[2,39],62:[2,39],66:[2,39],69:[2,39],74:[2,39],75:[2,39],76:[2,39],77:[2,39],78:[2,39],79:[2,39],81:[1,45]},{18:65,51:71,52:[2,79],57:72,58:66,59:[1,40],63:73,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{24:74,45:[1,75]},{45:[2,50]},{4:76,6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],37:[2,43],42:[2,43],45:[2,43],46:[2,43],49:[2,43],53:[2,43]},{45:[2,19]},{18:77,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{4:78,6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],45:[2,43],46:[2,43],49:[2,43],53:[2,43]},{24:79,45:[1,75]},{45:[2,52]},{5:[2,10],13:[2,10],14:[2,10],17:[2,10],27:[2,10],32:[2,10],37:[2,10],42:[2,10],45:[2,10],46:[2,10],49:[2,10],53:[2,10]},{18:65,31:[2,83],56:80,57:81,58:66,59:[1,40],63:82,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{59:[2,85],60:83,62:[2,85],66:[2,85],74:[2,85],75:[2,85],76:[2,85],77:[2,85],78:[2,85],79:[2,85]},{18:65,29:84,31:[2,55],57:85,58:66,59:[1,40],63:86,64:67,65:68,66:[1,69],69:[2,55],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:65,31:[2,61],34:87,57:88,58:66,59:[1,40],63:89,64:67,65:68,66:[1,69],69:[2,61],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:65,20:90,21:[2,47],57:91,58:66,59:[1,40],63:92,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{31:[1,93]},{31:[2,74],59:[2,74],66:[2,74],74:[2,74],75:[2,74],76:[2,74],77:[2,74],78:[2,74],79:[2,74]},{31:[2,76]},{21:[2,24],31:[2,24],52:[2,24],59:[2,24],62:[2,24],66:[2,24],69:[2,24],74:[2,24],75:[2,24],76:[2,24],77:[2,24],78:[2,24],79:[2,24]},{21:[2,25],31:[2,25],52:[2,25],59:[2,25],62:[2,25],66:[2,25],69:[2,25],74:[2,25],75:[2,25],76:[2,25],77:[2,25],78:[2,25],79:[2,25]},{21:[2,27],31:[2,27],52:[2,27],62:[2,27],65:94,66:[1,95],69:[2,27]},{21:[2,89],31:[2,89],52:[2,89],62:[2,89],66:[2,89],69:[2,89]},{21:[2,42],31:[2,42],52:[2,42],59:[2,42],62:[2,42],66:[2,42],67:[1,96],69:[2,42],74:[2,42],75:[2,42],76:[2,42],77:[2,42],78:[2,42],79:[2,42],81:[2,42]},{21:[2,41],31:[2,41],52:[2,41],59:[2,41],62:[2,41],66:[2,41],69:[2,41],74:[2,41],75:[2,41],76:[2,41],77:[2,41],78:[2,41],79:[2,41],81:[2,41]},{52:[1,97]},{52:[2,78],59:[2,78],66:[2,78],74:[2,78],75:[2,78],76:[2,78],77:[2,78],78:[2,78],79:[2,78]},{52:[2,80]},{5:[2,12],13:[2,12],14:[2,12],17:[2,12],27:[2,12],32:[2,12],37:[2,12],42:[2,12],45:[2,12],46:[2,12],49:[2,12],53:[2,12]},{18:98,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{36:50,37:[1,52],41:51,42:[1,53],43:100,44:99,45:[2,71]},{31:[2,65],38:101,59:[2,65],66:[2,65],69:[2,65],74:[2,65],75:[2,65],76:[2,65],77:[2,65],78:[2,65],79:[2,65]},{45:[2,17]},{5:[2,13],13:[2,13],14:[2,13],17:[2,13],27:[2,13],32:[2,13],37:[2,13],42:[2,13],45:[2,13],46:[2,13],49:[2,13],53:[2,13]},{31:[1,102]},{31:[2,82],59:[2,82],66:[2,82],74:[2,82],75:[2,82],76:[2,82],77:[2,82],78:[2,82],79:[2,82]},{31:[2,84]},{18:65,57:104,58:66,59:[1,40],61:103,62:[2,87],63:105,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{30:106,31:[2,57],68:107,69:[1,108]},{31:[2,54],59:[2,54],66:[2,54],69:[2,54],74:[2,54],75:[2,54],76:[2,54],77:[2,54],78:[2,54],79:[2,54]},{31:[2,56],69:[2,56]},{31:[2,63],35:109,68:110,69:[1,108]},{31:[2,60],59:[2,60],66:[2,60],69:[2,60],74:[2,60],75:[2,60],76:[2,60],77:[2,60],78:[2,60],79:[2,60]},{31:[2,62],69:[2,62]},{21:[1,111]},{21:[2,46],59:[2,46],66:[2,46],74:[2,46],75:[2,46],76:[2,46],77:[2,46],78:[2,46],79:[2,46]},{21:[2,48]},{5:[2,21],13:[2,21],14:[2,21],17:[2,21],27:[2,21],32:[2,21],37:[2,21],42:[2,21],45:[2,21],46:[2,21],49:[2,21],53:[2,21]},{21:[2,90],31:[2,90],52:[2,90],62:[2,90],66:[2,90],69:[2,90]},{67:[1,96]},{18:65,57:112,58:66,59:[1,40],66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{5:[2,22],13:[2,22],14:[2,22],17:[2,22],27:[2,22],32:[2,22],37:[2,22],42:[2,22],45:[2,22],46:[2,22],49:[2,22],53:[2,22]},{31:[1,113]},{45:[2,18]},{45:[2,72]},{18:65,31:[2,67],39:114,57:115,58:66,59:[1,40],63:116,64:67,65:68,66:[1,69],69:[2,67],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{5:[2,23],13:[2,23],14:[2,23],17:[2,23],27:[2,23],32:[2,23],37:[2,23],42:[2,23],45:[2,23],46:[2,23],49:[2,23],53:[2,23]},{62:[1,117]},{59:[2,86],62:[2,86],66:[2,86],74:[2,86],75:[2,86],76:[2,86],77:[2,86],78:[2,86],79:[2,86]},{62:[2,88]},{31:[1,118]},{31:[2,58]},{66:[1,120],70:119},{31:[1,121]},{31:[2,64]},{14:[2,11]},{21:[2,28],31:[2,28],52:[2,28],62:[2,28],66:[2,28],69:[2,28]},{5:[2,20],13:[2,20],14:[2,20],17:[2,20],27:[2,20],32:[2,20],37:[2,20],42:[2,20],45:[2,20],46:[2,20],49:[2,20],53:[2,20]},{31:[2,69],40:122,68:123,69:[1,108]},{31:[2,66],59:[2,66],66:[2,66],69:[2,66],74:[2,66],75:[2,66],76:[2,66],77:[2,66],78:[2,66],79:[2,66]},{31:[2,68],69:[2,68]},{21:[2,26],31:[2,26],52:[2,26],59:[2,26],62:[2,26],66:[2,26],69:[2,26],74:[2,26],75:[2,26],76:[2,26],77:[2,26],78:[2,26],79:[2,26]},{13:[2,14],14:[2,14],17:[2,14],27:[2,14],32:[2,14],37:[2,14],42:[2,14],45:[2,14],46:[2,14],49:[2,14],53:[2,14]},{66:[1,125],71:[1,124]},{66:[2,91],71:[2,91]},{13:[2,15],14:[2,15],17:[2,15],27:[2,15],32:[2,15],42:[2,15],45:[2,15],46:[2,15],49:[2,15],53:[2,15]},{31:[1,126]},{31:[2,70]},{31:[2,29]},{66:[2,92],71:[2,92]},{13:[2,16],14:[2,16],17:[2,16],27:[2,16],32:[2,16],37:[2,16],42:[2,16],45:[2,16],46:[2,16],49:[2,16],53:[2,16]}],defaultActions:{4:[2,1],49:[2,50],51:[2,19],55:[2,52],64:[2,76],73:[2,80],78:[2,17],82:[2,84],92:[2,48],99:[2,18],100:[2,72],105:[2,88],107:[2,58],110:[2,64],111:[2,11],123:[2,70],124:[2,29]},parseError:function(e,t){throw new Error(e)},parse:function(e){function t(){var e;return e=n.lexer.lex()||1,"number"!=typeof e&&(e=n.symbols_[e]||e),e}var n=this,i=[0],o=[null],r=[],a=this.table,s="",l=0,d=0,c=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var u=this.lexer.yylloc;r.push(u);var p=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var h,f,m,g,T,_,E,v,S,b={};;){if(m=i[i.length-1],this.defaultActions[m]?g=this.defaultActions[m]:(null!==h&&"undefined"!=typeof h||(h=t()),g=a[m]&&a[m][h]),"undefined"==typeof g||!g.length||!g[0]){var R="";if(!c){S=[];for(_ in a[m])this.terminals_[_]&&_>2&&S.push("'"+this.terminals_[_]+"'");R=this.lexer.showPosition?"Parse error on line "+(l+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+S.join(", ")+", got '"+(this.terminals_[h]||h)+"'":"Parse error on line "+(l+1)+": Unexpected "+(1==h?"end of input":"'"+(this.terminals_[h]||h)+"'"),this.parseError(R,{text:this.lexer.match,token:this.terminals_[h]||h,line:this.lexer.yylineno,loc:u,expected:S})}}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+m+", token: "+h);switch(g[0]){case 1:i.push(h),o.push(this.lexer.yytext),r.push(this.lexer.yylloc),i.push(g[1]),h=null,f?(h=f,f=null):(d=this.lexer.yyleng,s=this.lexer.yytext,l=this.lexer.yylineno,u=this.lexer.yylloc,c>0&&c--);break;case 2:if(E=this.productions_[g[1]][1],b.$=o[o.length-E],b._$={first_line:r[r.length-(E||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(E||1)].first_column,last_column:r[r.length-1].last_column},p&&(b._$.range=[r[r.length-(E||1)].range[0],r[r.length-1].range[1]]),T=this.performAction.call(b,s,d,l,this.yy,g[1],o,r),"undefined"!=typeof T)return T;E&&(i=i.slice(0,-1*E*2),o=o.slice(0,-1*E),r=r.slice(0,-1*E)),i.push(this.productions_[g[1]][0]),o.push(b.$),r.push(b._$),v=a[i[i.length-2]][i[i.length-1]],i.push(v);break;case 3:return!0}}return!0}},n=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var o=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[o[0],o[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,i,o;this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),a=0;a<r.length&&(n=this._input.match(this.rules[r[a]]),!n||t&&!(n[0].length>t[0].length)||(t=n,i=a,this.options.flex));a++);return t?(o=t[0].match(/(?:\r\n?|\n).*/g),o&&(this.yylineno+=o.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:o?o[o.length-1].length-o[o.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,r[i],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),e?e:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return"undefined"!=typeof e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)}};return e.options={},e.performAction=function(e,t,n,i){function o(e,n){return t.yytext=t.yytext.substr(e,t.yyleng-n)}switch(n){case 0:if("\\\\"===t.yytext.slice(-2)?(o(0,1),this.begin("mu")):"\\"===t.yytext.slice(-1)?(o(0,1),this.begin("emu")):this.begin("mu"),t.yytext)return 14;break;case 1:return 14;case 2:return this.popState(),14;case 3:return t.yytext=t.yytext.substr(5,t.yyleng-9),this.popState(),16;case 4:return 14;case 5:return this.popState(),13;case 6:return 59;case 7:return 62;case 8:return 17;case 9:return this.popState(),this.begin("raw"),21;case 10:return 53;case 11:return 27;case 12:return 45;case 13:return this.popState(),42;case 14:return this.popState(),42;case 15:return 32;case 16:return 37;case 17:return 49;case 18:return 46;case 19:this.unput(t.yytext),this.popState(),this.begin("com");break;case 20:return this.popState(),13;case 21:return 46;case 22:return 67;case 23:return 66;case 24:return 66;case 25:return 81;case 26:break;case 27:return this.popState(),52;case 28:return this.popState(),31;case 29:return t.yytext=o(1,2).replace(/\\"/g,'"'),74;case 30:return t.yytext=o(1,2).replace(/\\'/g,"'"),74;case 31:return 79;case 32:return 76;case 33:return 76;case 34:return 77;case 35:return 78;case 36:return 75;case 37:return 69;case 38:return 71;case 39:return 66;case 40:return 66;case 41:return"INVALID";case 42:return 5}},e.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]*?(?=(\{\{\{\{\/)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],e.conditions={mu:{rules:[6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[5],inclusive:!1},raw:{rules:[3,4],inclusive:!1},INITIAL:{rules:[0,1,42],inclusive:!0}},e}();return t.lexer=n,e.prototype=t,t.Parser=e,new e}();t.default=i,e.exports=t.default},function(e,t,n){"use strict";function i(){}function o(e,t,n){void 0===t&&(t=e.length);var i=e[t-1],o=e[t-2];return i?"ContentStatement"===i.type?(o||!n?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(i.original):void 0:n}function r(e,t,n){void 0===t&&(t=-1);var i=e[t+1],o=e[t+2];return i?"ContentStatement"===i.type?(o||!n?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(i.original):void 0:n}function a(e,t,n){var i=e[null==t?0:t+1];if(i&&"ContentStatement"===i.type&&(n||!i.rightStripped)){var o=i.value;i.value=i.value.replace(n?/^\s+/:/^[ \t]*\r?\n?/,""),i.rightStripped=i.value!==o}}function s(e,t,n){var i=e[null==t?e.length-1:t-1];if(i&&"ContentStatement"===i.type&&(n||!i.leftStripped)){var o=i.value;return i.value=i.value.replace(n?/\s+$/:/[ \t]+$/,""),i.leftStripped=i.value!==o,i.leftStripped}}var l=n(8).default;t.__esModule=!0;var d=n(6),c=l(d);i.prototype=new c.default,i.prototype.Program=function(e){var t=!this.isRootSeen;this.isRootSeen=!0;for(var n=e.body,i=0,l=n.length;i<l;i++){var d=n[i],c=this.accept(d);if(c){var u=o(n,i,t),p=r(n,i,t),h=c.openStandalone&&u,f=c.closeStandalone&&p,m=c.inlineStandalone&&u&&p;c.close&&a(n,i,!0),c.open&&s(n,i,!0),m&&(a(n,i),s(n,i)&&"PartialStatement"===d.type&&(d.indent=/([ \t]+$)/.exec(n[i-1].original)[1])),h&&(a((d.program||d.inverse).body),s(n,i)),f&&(a(n,i),s((d.inverse||d.program).body))}}return e},i.prototype.BlockStatement=function(e){this.accept(e.program),this.accept(e.inverse);var t=e.program||e.inverse,n=e.program&&e.inverse,i=n,l=n;if(n&&n.chained)for(i=n.body[0].program;l.chained;)l=l.body[l.body.length-1].program;var d={open:e.openStrip.open,close:e.closeStrip.close,openStandalone:r(t.body),closeStandalone:o((i||t).body)};if(e.openStrip.close&&a(t.body,null,!0),n){var c=e.inverseStrip;c.open&&s(t.body,null,!0),c.close&&a(i.body,null,!0),e.closeStrip.open&&s(l.body,null,!0),o(t.body)&&r(i.body)&&(s(t.body),a(i.body))}else e.closeStrip.open&&s(t.body,null,!0);return d},i.prototype.MustacheStatement=function(e){return e.strip},i.prototype.PartialStatement=i.prototype.CommentStatement=function(e){var t=e.strip||{};return{inlineStandalone:!0,open:t.open,close:t.close}},t.default=i,e.exports=t.default},function(e,t,n){"use strict";function i(e,t){this.source=e,this.start={line:t.first_line,column:t.first_column},this.end={line:t.last_line,column:t.last_column}}function o(e){return/^\[.*\]$/.test(e)?e.substr(1,e.length-2):e}function r(e,t){return{open:"~"===e.charAt(2),close:"~"===t.charAt(t.length-3)}}function a(e){return e.replace(/^\{\{~?\!-?-?/,"").replace(/-?-?~?\}\}$/,"")}function s(e,t,n){n=this.locInfo(n);for(var i=e?"@":"",o=[],r=0,a="",s=0,l=t.length;s<l;s++){var d=t[s].part,c=t[s].original!==d;if(i+=(t[s].separator||"")+d,c||".."!==d&&"."!==d&&"this"!==d)o.push(d);else{if(o.length>0)throw new h.default("Invalid path: "+i,{loc:n});".."===d&&(r++,a+="../")}}return new this.PathExpression(e,r,o,i,n)}function l(e,t,n,i,o,r){var a=i.charAt(3)||i.charAt(2),s="{"!==a&&"&"!==a;return new this.MustacheStatement(e,t,n,s,o,this.locInfo(r))}function d(e,t,n,i){if(e.path.original!==n){var o={loc:e.path.loc};throw new h.default(e.path.original+" doesn't match "+n,o)}i=this.locInfo(i);var r=new this.Program([t],null,{},i);return new this.BlockStatement(e.path,e.params,e.hash,r,void 0,{},{},{},i)}function c(e,t,n,i,o,r){if(i&&i.path&&e.path.original!==i.path.original){var a={loc:e.path.loc};throw new h.default(e.path.original+" doesn't match "+i.path.original,a)}t.blockParams=e.blockParams;var s=void 0,l=void 0;return n&&(n.chain&&(n.program.body[0].closeStrip=i.strip),l=n.strip,s=n.program),o&&(o=s,s=t,t=o),new this.BlockStatement(e.path,e.params,e.hash,t,s,e.strip,l,i&&i.strip,this.locInfo(r))}var u=n(8).default;t.__esModule=!0,t.SourceLocation=i,t.id=o,t.stripFlags=r,t.stripComment=a,t.preparePath=s,t.prepareMustache=l,t.prepareRawBlock=d,t.prepareBlock=c;var p=n(12),h=u(p)},function(e,t,n){"use strict";function i(e,t,n){if(r.isArray(e)){for(var i=[],o=0,a=e.length;o<a;o++)i.push(t.wrap(e[o],n));return i}return"boolean"==typeof e||"number"==typeof e?e+"":e}function o(e){this.srcFile=e,this.source=[]}t.__esModule=!0;var r=n(13),a=void 0;try{}catch(e){}a||(a=function(e,t,n,i){this.src="",i&&this.add(i)},a.prototype={add:function(e){r.isArray(e)&&(e=e.join("")),this.src+=e},prepend:function(e){r.isArray(e)&&(e=e.join("")),this.src=e+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}}),o.prototype={prepend:function(e,t){this.source.unshift(this.wrap(e,t))},push:function(e,t){this.source.push(this.wrap(e,t))},merge:function(){var e=this.empty();return this.each(function(t){e.add(["  ",t,"\n"])}),e},each:function(e){for(var t=0,n=this.source.length;t<n;t++)e(this.source[t])},empty:function(){var e=void 0===arguments[0]?this.currentLocation||{start:{}}:arguments[0];return new a(e.start.line,e.start.column,this.srcFile)},wrap:function(e){var t=void 0===arguments[1]?this.currentLocation||{start:{}}:arguments[1];return e instanceof a?e:(e=i(e,this,t),new a(t.start.line,t.start.column,this.srcFile,e))},functionCall:function(e,t,n){return n=this.generateList(n),this.wrap([e,t?"."+t+"(":"(",n,")"])},quotedString:function(e){return'"'+(e+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var o=i(e[n],this);"undefined"!==o&&t.push([this.quotedString(n),":",o])}var r=this.generateList(t);return r.prepend("{"),r.add("}"),r},generateList:function(e,t){for(var n=this.empty(t),o=0,r=e.length;o<r;o++)o&&n.add(","),n.add(i(e[o],this,t));return n},generateArray:function(e,t){var n=this.generateList(e,t);return n.prepend("["),n.add("]"),n}},t.default=o,e.exports=t.default}])}),function(){function e(){function e(){for(var e=0,t=1,n=2;t!=n;)e++,t=n,n<<=1;return e}this.Diff_Timeout=1,this.Diff_EditCost=4,this.Diff_DualThreshold=32,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=e()}function t(){this.diffs=[],this.start2=this.start1=null,this.length2=this.length1=0}var n;n=e.prototype,n.diff_main=function(e,t,n){if(e==t)return[[0,e]];"undefined"==typeof n&&(n=!0);var i=n,o=this.diff_commonPrefix(e,t);n=e.substring(0,o),e=e.substring(o),t=t.substring(o),o=this.diff_commonSuffix(e,t);var r=e.substring(e.length-o);return e=e.substring(0,e.length-o),t=t.substring(0,t.length-o),e=this.diff_compute(e,t,i),n&&e.unshift([0,n]),r&&e.push([0,r]),this.diff_cleanupMerge(e),e},n.diff_compute=function(e,t,n){var i;if(!e)return[[1,t]];if(!t)return[[-1,e]];i=e.length>t.length?e:t;var o=e.length>t.length?t:e,r=i.indexOf(o);if(r!=-1)return i=[[1,i.substring(0,r)],[0,o],[1,i.substring(r+o.length)]],e.length>t.length&&(i[0][0]=i[2][0]=-1),i;if(i=this.diff_halfMatch(e,t)){var a=i[0];return e=i[1],o=i[2],t=i[3],i=i[4],a=this.diff_main(a,o,n),n=this.diff_main(e,t,n),a.concat([[0,i]],n)}if(n&&(e.length<100||t.length<100)&&(n=!1),n&&(a=this.diff_linesToChars(e,t),e=a[0],t=a[1],a=a[2]),(i=this.diff_map(e,t))||(i=[[-1,e],[1,t]]),n){for(this.diff_charsToLines(i,a),this.diff_cleanupSemantic(i),i.push([0,""]),t=e=n=0,o=a="";n<i.length;){switch(i[n][0]){case 1:t++,o+=i[n][1];break;case-1:e++,a+=i[n][1];break;case 0:if(e>=1&&t>=1){for(a=this.diff_main(a,o,!1),i.splice(n-e-t,e+t),n=n-e-t,e=a.length-1;e>=0;e--)i.splice(n,0,a[e]);n+=a.length}e=t=0,o=a=""}n++}i.pop()}return i},n.diff_linesToChars=function(e,t){function n(e){for(var t="",n=0,r=-1,a=i.length;r<e.length-1;){r=e.indexOf("\n",n),r==-1&&(r=e.length-1);var s=e.substring(n,r+1);n=r+1,(o.hasOwnProperty?o.hasOwnProperty(s):void 0!==o[s])?t+=String.fromCharCode(o[s]):(t+=String.fromCharCode(a),o[s]=a,i[a++]=s)}return t}var i=[],o={};return i[0]="",e=n(e),t=n(t),[e,t,i]},n.diff_charsToLines=function(e,t){for(var n=0;n<e.length;n++){for(var i=e[n][1],o=[],r=0;r<i.length;r++)o[r]=t[i.charCodeAt(r)];e[n][1]=o.join("")}},n.diff_map=function(e,t){var n=(new Date).getTime()+1e3*this.Diff_Timeout,i=e.length,o=t.length,r=i+o-1,a=2*this.Diff_DualThreshold<r,s=[],l=[],d={},c={};d[1]=0,c[1]=0;for(var u,p,h,f={},m=!1,g=!!f.hasOwnProperty,T=(i+o)%2,_=0;_<r;_++){if(this.Diff_Timeout>0&&(new Date).getTime()>n)return null;s[_]={};for(var E=-_;E<=_;E+=2){for(u=E==-_||E!=_&&d[E-1]<d[E+1]?d[E+1]:d[E-1]+1,p=u-E,a&&(h=u+","+p,T&&(g?f.hasOwnProperty(h):void 0!==f[h])&&(m=!0),T||(f[h]=_));!m&&u<i&&p<o&&e.charAt(u)==t.charAt(p);)u++,p++,a&&(h=u+","+p,T&&(g?f.hasOwnProperty(h):void 0!==f[h])&&(m=!0),T||(f[h]=_));if(d[E]=u,s[_][u+","+p]=!0,u==i&&p==o)return this.diff_path1(s,e,t);if(m)return l=l.slice(0,f[h]+1),n=this.diff_path1(s,e.substring(0,u),t.substring(0,p)),n.concat(this.diff_path2(l,e.substring(u),t.substring(p)))}if(a)for(l[_]={},E=-_;E<=_;E+=2){for(u=E==-_||E!=_&&c[E-1]<c[E+1]?c[E+1]:c[E-1]+1,p=u-E,h=i-u+","+(o-p),!T&&(g?f.hasOwnProperty(h):void 0!==f[h])&&(m=!0),T&&(f[h]=_);!m&&u<i&&p<o&&e.charAt(i-u-1)==t.charAt(o-p-1);)u++,p++,h=i-u+","+(o-p),!T&&(g?f.hasOwnProperty(h):void 0!==f[h])&&(m=!0),T&&(f[h]=_);if(c[E]=u,l[_][u+","+p]=!0,m)return s=s.slice(0,f[h]+1),n=this.diff_path1(s,e.substring(0,i-u),t.substring(0,o-p)),n.concat(this.diff_path2(l,e.substring(i-u),t.substring(o-p)))}}return null},n.diff_path1=function(e,t,n){for(var i=[],o=t.length,r=n.length,a=null,s=e.length-2;s>=0;s--)for(;1;){if(e[s].hasOwnProperty?e[s].hasOwnProperty(o-1+","+r):void 0!==e[s][o-1+","+r]){o--,a===-1?i[0][1]=t.charAt(o)+i[0][1]:i.unshift([-1,t.charAt(o)]),a=-1;break}if(e[s].hasOwnProperty?e[s].hasOwnProperty(o+","+(r-1)):void 0!==e[s][o+","+(r-1)]){r--,1===a?i[0][1]=n.charAt(r)+i[0][1]:i.unshift([1,n.charAt(r)]),a=1;break}o--,r--,0===a?i[0][1]=t.charAt(o)+i[0][1]:i.unshift([0,t.charAt(o)]),a=0}return i},n.diff_path2=function(e,t,n){for(var i=[],o=0,r=t.length,a=n.length,s=null,l=e.length-2;l>=0;l--)for(;1;){if(e[l].hasOwnProperty?e[l].hasOwnProperty(r-1+","+a):void 0!==e[l][r-1+","+a]){r--,s===-1?i[o-1][1]+=t.charAt(t.length-r-1):i[o++]=[-1,t.charAt(t.length-r-1)],s=-1;break}if(e[l].hasOwnProperty?e[l].hasOwnProperty(r+","+(a-1)):void 0!==e[l][r+","+(a-1)]){a--,1===s?i[o-1][1]+=n.charAt(n.length-a-1):i[o++]=[1,n.charAt(n.length-a-1)],s=1;break}r--,a--,0===s?i[o-1][1]+=t.charAt(t.length-r-1):i[o++]=[0,t.charAt(t.length-r-1)],s=0}return i},n.diff_commonPrefix=function(e,t){if(!e||!t||e.charCodeAt(0)!==t.charCodeAt(0))return 0;for(var n=0,i=Math.min(e.length,t.length),o=i,r=0;n<o;)e.substring(r,o)==t.substring(r,o)?r=n=o:i=o,o=Math.floor((i-n)/2+n);return o},n.diff_commonSuffix=function(e,t){if(!e||!t||e.charCodeAt(e.length-1)!==t.charCodeAt(t.length-1))return 0;for(var n=0,i=Math.min(e.length,t.length),o=i,r=0;n<o;)e.substring(e.length-o,e.length-r)==t.substring(t.length-o,t.length-r)?r=n=o:i=o,o=Math.floor((i-n)/2+n);return o},n.diff_halfMatch=function(e,t){function n(e,t,n){for(var i,o,a,s,l=e.substring(n,n+Math.floor(e.length/4)),d=-1,c="";(d=t.indexOf(l,d+1))!=-1;){var u=r.diff_commonPrefix(e.substring(n),t.substring(d)),p=r.diff_commonSuffix(e.substring(0,n),t.substring(0,d));c.length<p+u&&(c=t.substring(d-p,d)+t.substring(d,d+u),i=e.substring(0,n-p),o=e.substring(n+u),a=t.substring(0,d-p),s=t.substring(d+u))}return c.length>=e.length/2?[i,o,a,s,c]:null}var i=e.length>t.length?e:t,o=e.length>t.length?t:e;if(i.length<10||o.length<1)return null;var r=this,a=n(i,o,Math.ceil(i.length/4));return i=n(i,o,Math.ceil(i.length/2)),a||i?(a=i?a&&a[4].length>i[4].length?a:i:a,e.length>t.length?(e=a[0],t=a[1],i=a[2],o=a[3]):(i=a[0],o=a[1],e=a[2],t=a[3]),a=a[4],[e,t,i,o,a]):null},n.diff_cleanupSemantic=function(e){for(var t=!1,n=[],i=0,o=null,r=0,a=0,s=0;r<e.length;)0==e[r][0]?(n[i++]=r,a=s,s=0,o=e[r][1]):(s+=e[r][1].length,null!==o&&o.length<=a&&o.length<=s&&(e.splice(n[i-1],0,[-1,o]),e[n[i-1]+1][0]=1,i--,i--,r=i>0?n[i-1]:-1,s=a=0,o=null,t=!0)),r++;t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e)},n.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 5;var s=0;return(e.charAt(e.length-1).match(n)||t.charAt(0).match(n))&&(s++,(e.charAt(e.length-1).match(i)||t.charAt(0).match(i))&&(s++,(e.charAt(e.length-1).match(o)||t.charAt(0).match(o))&&(s++,(e.match(r)||t.match(a))&&s++))),s}for(var n=/[^a-zA-Z0-9]/,i=/\s/,o=/[\r\n]/,r=/\n\r?\n$/,a=/^\r?\n\r?\n/,s=1;s<e.length-1;){if(0==e[s-1][0]&&0==e[s+1][0]){var l=e[s-1][1],d=e[s][1],c=e[s+1][1],u=this.diff_commonSuffix(l,d);if(u){var p=d.substring(d.length-u);l=l.substring(0,l.length-u),d=p+d.substring(0,d.length-u),c=p+c}u=l,p=d;for(var h=c,f=t(l,d)+t(d,c);d.charAt(0)===c.charAt(0);){l+=d.charAt(0),d=d.substring(1)+c.charAt(0),c=c.substring(1);var m=t(l,d)+t(d,c);m>=f&&(f=m,u=l,p=d,h=c)}e[s-1][1]!=u&&(u?e[s-1][1]=u:(e.splice(s-1,1),s--),e[s][1]=p,h?e[s+1][1]=h:(e.splice(s+1,1),s--))}s++}},n.diff_cleanupEfficiency=function(e){for(var t=!1,n=[],i=0,o="",r=0,a=!1,s=!1,l=!1,d=!1;r<e.length;)0==e[r][0]?(e[r][1].length<this.Diff_EditCost&&(l||d)?(n[i++]=r,a=l,s=d,o=e[r][1]):(i=0,o=""),l=d=!1):(e[r][0]==-1?d=!0:l=!0,o&&(a&&s&&l&&d||o.length<this.Diff_EditCost/2&&a+s+l+d==3)&&(e.splice(n[i-1],0,[-1,o]),e[n[i-1]+1][0]=1,i--,o="",a&&s?(l=d=!0,i=0):(i--,r=i>0?n[i-1]:-1,l=d=!1),t=!0)),r++;t&&this.diff_cleanupMerge(e)},n.diff_cleanupMerge=function(e){e.push([0,""]);for(var t,n=0,i=0,o=0,r="",a="";n<e.length;)switch(e[n][0]){case 1:o++,a+=e[n][1],n++;break;case-1:i++,r+=e[n][1],n++;break;case 0:0!==i||0!==o?(0!==i&&0!==o&&(t=this.diff_commonPrefix(a,r),0!==t&&(n-i-o>0&&0==e[n-i-o-1][0]?e[n-i-o-1][1]+=a.substring(0,t):(e.splice(0,0,[0,a.substring(0,t)]),n++),a=a.substring(t),r=r.substring(t)),t=this.diff_commonSuffix(a,r),0!==t&&(e[n][1]=a.substring(a.length-t)+e[n][1],a=a.substring(0,a.length-t),r=r.substring(0,r.length-t))),0===i?e.splice(n-i-o,i+o,[1,a]):0===o?e.splice(n-i-o,i+o,[-1,r]):e.splice(n-i-o,i+o,[-1,r],[1,a]),n=n-i-o+(i?1:0)+(o?1:0)+1):0!==n&&0==e[n-1][0]?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,i=o=0,a=r=""}for(""===e[e.length-1][1]&&e.pop(),i=!1,n=1;n<e.length-1;)0==e[n-1][0]&&0==e[n+1][0]&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),i=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),i=!0)),n++;i&&this.diff_cleanupMerge(e)},n.diff_xIndex=function(e,t){var n,i=0,o=0,r=0,a=0;for(n=0;n<e.length&&(1!==e[n][0]&&(i+=e[n][1].length),e[n][0]!==-1&&(o+=e[n][1].length),!(i>t));n++)r=i,a=o;return e.length!=n&&e[n][0]===-1?a:a+(t-r)},n.diff_prettyHtml=function(e){for(var t=[],n=0,i=0;i<e.length;i++){var o=e[i][0],r=e[i][1],a=r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"&para;<BR>");switch(o){case 1:t[i]='<INS STYLE="background:#E6FFE6;" TITLE="i='+n+'">'+a+"</INS>";break;case-1:t[i]='<DEL STYLE="background:#FFE6E6;" TITLE="i='+n+'">'+a+"</DEL>";break;case 0:t[i]='<SPAN TITLE="i='+n+'">'+a+"</SPAN>"}o!==-1&&(n+=r.length)}return t.join("")},n.diff_text1=function(e){for(var t=[],n=0;n<e.length;n++)1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")},n.diff_text2=function(e){for(var t=[],n=0;n<e.length;n++)e[n][0]!==-1&&(t[n]=e[n][1]);return t.join("")},n.diff_levenshtein=function(e){for(var t=0,n=0,i=0,o=0;o<e.length;o++){var r=e[o][0],a=e[o][1];switch(r){case 1:n+=a.length;break;case-1:i+=a.length;break;case 0:t+=Math.max(n,i),i=n=0}}return t+=Math.max(n,i)},n.diff_toDelta=function(e){for(var t=[],n=0;n<e.length;n++)switch(e[n][0]){case 1:t[n]="+"+encodeURI(e[n][1]);break;case-1:t[n]="-"+e[n][1].length;break;case 0:t[n]="="+e[n][1].length}return t.join("\t").replace(/\x00/g,"%00").replace(/%20/g," ")},n.diff_fromDelta=function(e,t){var n=[],i=0,o=0;t=t.replace(/%00/g,"\0"),t=t.split(/\t/g);for(var r=0;r<t.length;r++){var a=t[r].substring(1);switch(t[r].charAt(0)){case"+":try{n[i++]=[1,decodeURI(a)]}catch(e){throw new Error("Illegal escape in diff_fromDelta: "+a)}break;case"-":case"=":var s=parseInt(a,10);if(isNaN(s)||s<0)throw new Error("Invalid number in diff_fromDelta: "+a);a=e.substring(o,o+=s),"="==t[r].charAt(0)?n[i++]=[0,a]:n[i++]=[-1,a];break;default:if(t[r])throw new Error("Invalid diff operation in diff_fromDelta: "+t[r])}}if(o!=e.length)throw new Error("Delta length ("+o+") does not equal source text length ("+e.length+").");return n},n.match_main=function(e,t,n){return n=Math.max(0,Math.min(n,e.length)),e==t?0:e.length?e.substring(n,n+t.length)==t?n:this.match_bitap(e,t,n):-1},n.match_bitap=function(e,t,n){function i(e,i){return e/=t.length,i=Math.abs(n-i),r.Match_Distance?e+i/r.Match_Distance:i?1:e}if(t.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var o=this.match_alphabet(t),r=this,a=this.Match_Threshold,s=e.indexOf(t,n);s!=-1&&(a=Math.min(i(0,s),a)),s=e.lastIndexOf(t,n+t.length),s!=-1&&(a=Math.min(i(0,s),a));var l=1<<t.length-1;s=-1;for(var d,c,u,p=t.length+e.length,h=0;h<t.length;h++){for(d=0,c=p;d<c;)i(h,n+c)<=a?d=c:p=c,c=Math.floor((p-d)/2+d);p=c,d=Math.max(1,n-c+1);var f=Math.min(n+c,e.length)+t.length;for(c=Array(f+2),c[f+1]=(1<<h)-1,f=f;f>=d;f--){var m=o[e.charAt(f-1)];if(c[f]=0===h?(c[f+1]<<1|1)&m:(c[f+1]<<1|1)&m|(u[f+1]|u[f])<<1|1|u[f+1],c[f]&l&&(m=i(h,f-1),m<=a)){if(a=m,s=f-1,!(s>n))break;d=Math.max(1,2*n-s)}}if(i(h+1,n)>a)break;u=c}return s},n.match_alphabet=function(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=0;for(n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t},n.patch_addContext=function(e,t){for(var n=t.substring(e.start2,e.start2+e.length1),i=0;t.indexOf(n)!=t.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)i+=this.Patch_Margin,n=t.substring(e.start2-i,e.start2+e.length1+i);i+=this.Patch_Margin,(n=t.substring(e.start2-i,e.start2))&&e.diffs.unshift([0,n]),(t=t.substring(e.start2+e.length1,e.start2+e.length1+i))&&e.diffs.push([0,t]),e.start1-=n.length,e.start2-=n.length,e.length1+=n.length+t.length,e.length2+=n.length+t.length},n.patch_make=function(e,n,i){var o;if("string"==typeof e&&"string"==typeof n&&"undefined"==typeof i)o=e,n=this.diff_main(o,n,!0),n.length>2&&(this.diff_cleanupSemantic(n),this.diff_cleanupEfficiency(n));else if("object"==typeof e&&"undefined"==typeof n&&"undefined"==typeof i)n=e,o=this.diff_text1(n);else if("string"==typeof e&&"object"==typeof n&&"undefined"==typeof i)o=e,n=n;else{if("string"!=typeof e||"string"!=typeof n||"object"!=typeof i)throw new Error("Unknown call format to patch_make.");o=e,n=i}if(0===n.length)return[];i=[],e=new t;var r=0,a=0,s=0,l=o;o=o;for(var d=0;d<n.length;d++){var c=n[d][0],u=n[d][1];switch(r||0===c||(e.start1=a,e.start2=s),c){case 1:e.diffs[r++]=n[d],e.length2+=u.length,o=o.substring(0,s)+u+o.substring(s);break;case-1:e.length1+=u.length,e.diffs[r++]=n[d],o=o.substring(0,s)+o.substring(s+u.length);break;case 0:u.length<=2*this.Patch_Margin&&r&&n.length!=d+1?(e.diffs[r++]=n[d],e.length1+=u.length,e.length2+=u.length):u.length>=2*this.Patch_Margin&&r&&(this.patch_addContext(e,l),i.push(e),e=new t,r=0,l=o,a=s)}1!==c&&(a+=u.length),c!==-1&&(s+=u.length)}return r&&(this.patch_addContext(e,l),i.push(e)),i},n.patch_deepCopy=function(e){for(var n=[],i=0;i<e.length;i++){var o=e[i],r=new t;r.diffs=[];for(var a=0;a<o.diffs.length;a++)r.diffs[a]=o.diffs[a].slice();r.start1=o.start1,r.start2=o.start2,r.length1=o.length1,r.length2=o.length2,n[i]=r}return n},n.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var n=this.patch_addPadding(e);t=n+t+n,this.patch_splitMax(e);for(var i=0,o=[],r=0;r<e.length;r++){var a,s=e[r].start2+i,l=this.diff_text1(e[r].diffs),d=-1;if(l.length>this.Match_MaxBits?(a=this.match_main(t,l.substring(0,this.Match_MaxBits),s),a!=-1&&(d=this.match_main(t,l.substring(l.length-this.Match_MaxBits),s+l.length-this.Match_MaxBits),(d==-1||a>=d)&&(a=-1))):a=this.match_main(t,l,s),a==-1)o[r]=!1,i-=e[r].length2-e[r].length1;else if(o[r]=!0,i=a-s,s=d==-1?t.substring(a,a+l.length):t.substring(a,d+this.Match_MaxBits),l==s)t=t.substring(0,a)+this.diff_text2(e[r].diffs)+t.substring(a+l.length);else if(s=this.diff_main(l,s,!1),l.length>this.Match_MaxBits&&this.diff_levenshtein(s)/l.length>this.Patch_DeleteThreshold)o[r]=!1;else{this.diff_cleanupSemanticLossless(s),l=0;var c;for(d=0;d<e[r].diffs.length;d++){var u=e[r].diffs[d];0!==u[0]&&(c=this.diff_xIndex(s,l)),1===u[0]?t=t.substring(0,a+c)+u[1]+t.substring(a+c):u[0]===-1&&(t=t.substring(0,a+c)+t.substring(a+this.diff_xIndex(s,l+u[1].length))),u[0]!==-1&&(l+=u[1].length)}}}return t=t.substring(n.length,t.length-n.length),[t,o]},n.patch_addPadding=function(e){for(var t=this.Patch_Margin,n="",i=1;i<=t;i++)n+=String.fromCharCode(i);for(i=0;i<e.length;i++)e[i].start1+=t,e[i].start2+=t;i=e[0];var o=i.diffs;if(0==o.length||0!=o[0][0])o.unshift([0,n]),i.start1-=t,i.start2-=t,i.length1+=t,i.length2+=t;else if(t>o[0][1].length){var r=t-o[0][1].length;o[0][1]=n.substring(o[0][1].length)+o[0][1],i.start1-=r,i.start2-=r,i.length1+=r,i.length2+=r}return i=e[e.length-1],o=i.diffs,0==o.length||0!=o[o.length-1][0]?(o.push([0,n]),i.length1+=t,i.length2+=t):t>o[o.length-1][1].length&&(r=t-o[o.length-1][1].length,o[o.length-1][1]+=n.substring(0,r),i.length1+=r,i.length2+=r),n},n.patch_splitMax=function(e){for(var n=0;n<e.length;n++)if(e[n].length1>this.Match_MaxBits){var i=e[n];e.splice(n--,1);for(var o=this.Match_MaxBits,r=i.start1,a=i.start2,s="";0!==i.diffs.length;){var l=new t,d=!0;for(l.start1=r-s.length,l.start2=a-s.length,""!==s&&(l.length1=l.length2=s.length,l.diffs.push([0,s]));0!==i.diffs.length&&l.length1<o-this.Patch_Margin;){s=i.diffs[0][0];var c=i.diffs[0][1];1===s?(l.length2+=c.length,a+=c.length,l.diffs.push(i.diffs.shift()),d=!1):s===-1&&1==l.diffs.length&&0==l.diffs[0][0]&&c.length>2*o?(l.length1+=c.length,r+=c.length,d=!1,l.diffs.push([s,c]),i.diffs.shift()):(c=c.substring(0,o-l.length1-this.Patch_Margin),l.length1+=c.length,r+=c.length,0===s?(l.length2+=c.length,a+=c.length):d=!1,l.diffs.push([s,c]),c==i.diffs[0][1]?i.diffs.shift():i.diffs[0][1]=i.diffs[0][1].substring(c.length))}s=this.diff_text2(l.diffs),s=s.substring(s.length-this.Patch_Margin),c=this.diff_text1(i.diffs).substring(0,this.Patch_Margin),""!==c&&(l.length1+=c.length,l.length2+=c.length,0!==l.diffs.length&&0===l.diffs[l.diffs.length-1][0]?l.diffs[l.diffs.length-1][1]+=c:l.diffs.push([0,c])),d||e.splice(++n,0,l)}}},n.patch_toText=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return t.join("")},n.patch_fromText=function(e){var n=[];if(!e)return n;e=e.replace(/%00/g,"\0"),e=e.split("\n");for(var i=0;i<e.length;){var o=e[i].match(/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/);if(!o)throw new Error("Invalid patch string: "+e[i]);var r=new t;for(n.push(r),r.start1=parseInt(o[1],10),""===o[2]?(r.start1--,r.length1=1):"0"==o[2]?r.length1=0:(r.start1--,r.length1=parseInt(o[2],10)),r.start2=parseInt(o[3],10),""===o[4]?(r.start2--,r.length2=1):"0"==o[4]?r.length2=0:(r.start2--,r.length2=parseInt(o[4],10)),i++;i<e.length;){o=e[i].charAt(0);try{var a=decodeURI(e[i].substring(1))}catch(e){throw new Error("Illegal escape in patch_fromText: "+a)}if("-"==o)r.diffs.push([-1,a]);else if("+"==o)r.diffs.push([1,a]);else if(" "==o)r.diffs.push([0,a]);else{if("@"==o)break;if(""!==o)throw new Error('Invalid patch mode "'+o+'" in: '+a)}i++}}return n},t.prototype.toString=function(){var e,t;e=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1,t=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2,e=["@@ -"+e+" +"+t+" @@\n"];var n;for(t=0;t<this.diffs.length;t++){switch(this.diffs[t][0]){case 1:n="+";break;case-1:n="-";break;case 0:n=" "}e[t+1]=n+encodeURI(this.diffs[t][1])+"\n"}return e.join("").replace(/\x00/g,"%00").replace(/%20/g," ")},window.diff_match_patch=e,window.patch_obj=t,window.DIFF_DELETE=-1,window.DIFF_INSERT=1,window.DIFF_EQUAL=0}();var IN_GLOBAL_SCOPE=!0;window.PR_SHOULD_USE_CONTINUATION=!0;var prettyPrintOne,prettyPrint;!function(){function e(e){function t(e){var t=e.charCodeAt(0);if(92!==t)return t;var n=e.charAt(1);return t=u[n],t?t:"0"<=n&&n<="7"?parseInt(e.substring(1),8):"u"===n||"x"===n?parseInt(e.substring(2),16):e.charCodeAt(1)}function n(e){if(e<32)return(e<16?"\\x0":"\\x")+e.toString(16);var t=String.fromCharCode(e);return"\\"===t||"-"===t||"]"===t||"^"===t?"\\"+t:t}function i(e){var i=e.substring(1,e.length-1).match(new RegExp("\\\\u[0-9A-Fa-f]{4}|\\\\x[0-9A-Fa-f]{2}|\\\\[0-3][0-7]{0,2}|\\\\[0-7]{1,2}|\\\\[\\s\\S]|-|[^-\\\\]","g")),o=[],r="^"===i[0],a=["["];r&&a.push("^");for(var s=r?1:0,l=i.length;s<l;++s){var d=i[s];if(/\\[bdsw]/i.test(d))a.push(d);else{var c,u=t(d);s+2<l&&"-"===i[s+1]?(c=t(i[s+2]),s+=2):c=u,o.push([u,c]),c<65||u>122||(c<65||u>90||o.push([32|Math.max(65,u),32|Math.min(c,90)]),c<97||u>122||o.push([Math.max(97,u)&-33,Math.min(c,122)&-33]))}}o.sort(function(e,t){return e[0]-t[0]||t[1]-e[1]});for(var p=[],h=[],s=0;s<o.length;++s){var f=o[s];f[0]<=h[1]+1?h[1]=Math.max(h[1],f[1]):p.push(h=f)}for(var s=0;s<p.length;++s){var f=p[s];a.push(n(f[0])),f[1]>f[0]&&(f[1]+1>f[0]&&a.push("-"),a.push(n(f[1])))}return a.push("]"),a.join("")}function o(e){for(var t=e.source.match(new RegExp("(?:\\[(?:[^\\x5C\\x5D]|\\\\[\\s\\S])*\\]|\\\\u[A-Fa-f0-9]{4}|\\\\x[A-Fa-f0-9]{2}|\\\\[0-9]+|\\\\[^ux0-9]|\\(\\?[:!=]|[\\(\\)\\^]|[^\\x5B\\x5C\\(\\)\\^]+)","g")),o=t.length,s=[],l=0,d=0;l<o;++l){var c=t[l];if("("===c)++d;else if("\\"===c.charAt(0)){var u=+c.substring(1);u&&(u<=d?s[u]=-1:t[l]=n(u))}}for(var l=1;l<s.length;++l)-1===s[l]&&(s[l]=++r);for(var l=0,d=0;l<o;++l){var c=t[l];if("("===c)++d,s[d]||(t[l]="(?:");else if("\\"===c.charAt(0)){var u=+c.substring(1);u&&u<=d&&(t[l]="\\"+s[u])}}for(var l=0;l<o;++l)"^"===t[l]&&"^"!==t[l+1]&&(t[l]="");if(e.ignoreCase&&a)for(var l=0;l<o;++l){var c=t[l],p=c.charAt(0);c.length>=2&&"["===p?t[l]=i(c):"\\"!==p&&(t[l]=c.replace(/[a-zA-Z]/g,function(e){var t=e.charCodeAt(0);return"["+String.fromCharCode(t&-33,32|t)+"]"}))}return t.join("")}for(var r=0,a=!1,s=!1,l=0,d=e.length;l<d;++l){var c=e[l];if(c.ignoreCase)s=!0;else if(/[a-z]/i.test(c.source.replace(/\\u[0-9a-f]{4}|\\x[0-9a-f]{2}|\\[^ux]/gi,""))){a=!0,s=!1;break}}for(var u={b:8,t:9,n:10,v:11,f:12,r:13},p=[],l=0,d=e.length;l<d;++l){var c=e[l];if(c.global||c.multiline)throw new Error(""+c);p.push("(?:"+o(c)+")")}return new RegExp(p.join("|"),s?"gi":"g")}function t(e,t){function n(e){var l=e.nodeType;if(1==l){if(i.test(e.className))return;for(var d=e.firstChild;d;d=d.nextSibling)n(d);var c=e.nodeName.toLowerCase();"br"!==c&&"li"!==c||(o[s]="\n",a[s<<1]=r++,a[s++<<1|1]=e)}else if(3==l||4==l){var u=e.nodeValue;u.length&&(u=t?u.replace(/\r\n?/g,"\n"):u.replace(/[ \t\r\n]+/g," "),o[s]=u,a[s<<1]=r,r+=u.length,a[s++<<1|1]=e)}}var i=/(?:^|\s)nocode(?:\s|$)/,o=[],r=0,a=[],s=0;return n(e),{sourceCode:o.join("").replace(/\n$/,""),spans:a}}function n(e,t,n,i){if(t){var o={sourceCode:t,basePos:e};n(o),i.push.apply(i,o.decorations)}}function i(e){for(var t=void 0,n=e.firstChild;n;n=n.nextSibling){var i=n.nodeType;t=1===i?t?e:n:3===i&&V.test(n.nodeValue)?e:t}return t===e?void 0:t}function o(t,i){var o,r={};!function(){for(var n=t.concat(i),a=[],s={},l=0,d=n.length;l<d;++l){var c=n[l],u=c[3];if(u)for(var p=u.length;--p>=0;)r[u.charAt(p)]=c;var h=c[1],f=""+h;s.hasOwnProperty(f)||(a.push(h),s[f]=null)}a.push(/[\0-\uffff]/),o=e(a)}();var a=i.length,s=function(e){for(var t=e.sourceCode,l=e.basePos,c=[l,U],u=0,p=t.match(o)||[],h={},f=0,m=p.length;f<m;++f){var g,T=p[f],_=h[T],E=void 0;if("string"==typeof _)g=!1;else{var v=r[T.charAt(0)];if(v)E=T.match(v[1]),_=v[0];else{for(var S=0;S<a;++S)if(v=i[S],E=T.match(v[1])){_=v[0];break}E||(_=U)}g=_.length>=5&&"lang-"===_.substring(0,5),!g||E&&"string"==typeof E[1]||(g=!1,_=F),g||(h[T]=_)}var b=u;if(u+=T.length,g){var R=E[1],O=T.indexOf(R),D=O+R.length;E[2]&&(D=T.length-E[2].length,O=D-R.length);var y=_.substring(5);n(l+b,T.substring(0,O),s,c),n(l+b+O,R,d(y,R),c),n(l+b+D,T.substring(D),s,c)}else c.push(l+b,_)}e.decorations=c};return s}function r(e){var t=[],n=[];e.tripleQuotedStrings?t.push([I,/^(?:\'\'\'(?:[^\'\\]|\\[\s\S]|\'{1,2}(?=[^\']))*(?:\'\'\'|$)|\"\"\"(?:[^\"\\]|\\[\s\S]|\"{1,2}(?=[^\"]))*(?:\"\"\"|$)|\'(?:[^\\\']|\\[\s\S])*(?:\'|$)|\"(?:[^\\\"]|\\[\s\S])*(?:\"|$))/,null,"'\""]):e.multiLineStrings?t.push([I,/^(?:\'(?:[^\\\']|\\[\s\S])*(?:\'|$)|\"(?:[^\\\"]|\\[\s\S])*(?:\"|$)|\`(?:[^\\\`]|\\[\s\S])*(?:\`|$))/,null,"'\"`"]):t.push([I,/^(?:\'(?:[^\\\'\r\n]|\\.)*(?:\'|$)|\"(?:[^\\\"\r\n]|\\.)*(?:\"|$))/,null,"\"'"]),e.verbatimStrings&&n.push([I,/^@\"(?:[^\"]|\"\")*(?:\"|$)/,null]);var i=e.hashComments;i&&(e.cStyleComments?(i>1?t.push([P,/^#(?:##(?:[^#]|#(?!##))*(?:###|$)|.*)/,null,"#"]):t.push([P,/^#(?:(?:define|e(?:l|nd)if|else|error|ifn?def|include|line|pragma|undef|warning)\b|[^\r\n]*)/,null,"#"]),n.push([I,/^<(?:(?:(?:\.\.\/)*|\/?)(?:[\w-]+(?:\/[\w-]+)+)?[\w-]+\.h(?:h|pp|\+\+)?|[a-z]\w*)>/,null])):t.push([P,/^#[^\r\n]*/,null,"#"])),e.cStyleComments&&(n.push([P,/^\/\/[^\r\n]*/,null]),n.push([P,/^\/\*[\s\S]*?(?:\*\/|$)/,null]));var r=e.regexLiterals;if(r){var a=r>1?"":"\n\r",s=a?".":"[\\S\\s]",l="/(?=[^/*"+a+"])(?:[^/\\x5B\\x5C"+a+"]|\\x5C"+s+"|\\x5B(?:[^\\x5C\\x5D"+a+"]|\\x5C"+s+")*(?:\\x5D|$))+/";n.push(["lang-regex",RegExp("^"+W+"("+l+")")])}var d=e.types;d&&n.push([M,d]);var c=(""+e.keywords).replace(/^ | $/g,"");c.length&&n.push([w,new RegExp("^(?:"+c.replace(/[\s,]+/g,"|")+")\\b"),null]),t.push([U,/^\s+/,null," \r\n\t"]);var u="^.[^\\s\\w.$@'\"`/\\\\]*";return e.regexLiterals&&(u+="(?!s*/)"),n.push([L,/^@[a-z_$][a-z_$@0-9]*/i,null],[M,/^(?:[@_]?[A-Z]+[a-z][A-Za-z_$@0-9]*|\w+_t\b)/,null],[U,/^[a-z_$][a-z_$@0-9]*/i,null],[L,new RegExp("^(?:0x[a-f0-9]+|(?:\\d(?:_\\d+)*\\d*(?:\\.\\d*)?|\\.\\d\\+)(?:e[+\\-]?\\d+)?)[a-z]*","i"),null,"0123456789"],[U,/^\\[\s\S]?/,null],[N,new RegExp(u),null]),o(t,n)}function a(e,t,n){function i(e){var t=e.nodeType;if(1!=t||r.test(e.className)){if((3==t||4==t)&&n){var l=e.nodeValue,d=l.match(a);if(d){var c=l.substring(0,d.index);e.nodeValue=c;var u=l.substring(d.index+d[0].length);if(u){var p=e.parentNode;p.insertBefore(s.createTextNode(u),e.nextSibling)}o(e),c||e.parentNode.removeChild(e)}}}else if("br"===e.nodeName)o(e),e.parentNode&&e.parentNode.removeChild(e);else for(var h=e.firstChild;h;h=h.nextSibling)i(h)}function o(e){function t(e,n){var i=n?e.cloneNode(!1):e,o=e.parentNode;if(o){var r=t(o,1),a=e.nextSibling;r.appendChild(i);for(var s=a;s;s=a)a=s.nextSibling,r.appendChild(s)}return i}for(;!e.nextSibling;)if(e=e.parentNode,!e)return;for(var n,i=t(e.nextSibling,0);(n=i.parentNode)&&1===n.nodeType;)i=n;d.push(i)}for(var r=/(?:^|\s)nocode(?:\s|$)/,a=/\r\n?|\n/,s=e.ownerDocument,l=s.createElement("li");e.firstChild;)l.appendChild(e.firstChild);for(var d=[l],c=0;c<d.length;++c)i(d[c]);t===(0|t)&&d[0].setAttribute("value",t);var u=s.createElement("ol");u.className="linenums";for(var p=Math.max(0,t-1|0)||0,c=0,h=d.length;c<h;++c)l=d[c],l.className="L"+(c+p)%10,l.firstChild||l.appendChild(s.createTextNode("")),u.appendChild(l);e.appendChild(u)}function s(e){var t=/\bMSIE\s(\d+)/.exec(navigator.userAgent);t=t&&+t[1]<=8;var n=/\n/g,i=e.sourceCode,o=i.length,r=0,a=e.spans,s=a.length,l=0,d=e.decorations,c=d.length,u=0;d[c]=o;var p,h;for(h=p=0;h<c;)d[h]!==d[h+2]?(d[p++]=d[h++],d[p++]=d[h++]):h+=2;for(c=p,h=p=0;h<c;){for(var f=d[h],m=d[h+1],g=h+2;g+2<=c&&d[g+1]===m;)g+=2;d[p++]=f,d[p++]=m,h=g}c=d.length=p;var T,_=e.sourceNode;_&&(T=_.style.display,_.style.display="none");try{for(;l<s;){var E,v=(a[l],a[l+2]||o),S=d[u+2]||o,g=Math.min(v,S),b=a[l+1];if(1!==b.nodeType&&(E=i.substring(r,g))){t&&(E=E.replace(n,"\r")),b.nodeValue=E;var R=b.ownerDocument,O=R.createElement("span");O.className=d[u+1];var D=b.parentNode;D.replaceChild(O,b),O.appendChild(b),r<v&&(a[l+1]=b=R.createTextNode(i.substring(g,v)),D.insertBefore(b,O.nextSibling))}r=g,r>=v&&(l+=2),r>=S&&(u+=2)}}finally{_&&(_.style.display=T)}}function l(e,t){for(var n=t.length;--n>=0;){var i=t[n];G.hasOwnProperty(i)?f.console&&console.warn("cannot override language handler %s",i):G[i]=e}}function d(e,t){return e&&G.hasOwnProperty(e)||(e=/^\s*</.test(t)?"default-markup":"default-code"),G[e]}function c(e){var n=e.langExtension;try{var i=t(e.sourceNode,e.pre),o=i.sourceCode;e.sourceCode=o,e.spans=i.spans,e.basePos=0,d(n,o)(e),s(e)}catch(e){f.console&&console.log(e&&e.stack||e)}}function u(e,t,n){var i=document.createElement("div");i.innerHTML="<pre>"+e+"</pre>",i=i.firstChild,n&&a(i,n,!0);var o={langExtension:t,numberLines:n,sourceNode:i,pre:1};return c(o),i.innerHTML}function p(e,t){var n={langExtension:t,sourceCode:e,spans:[0,e],basePos:0};try{d(t,e)(n)}catch(e){f.console&&console.log(e&&e.stack||e)}n.decorations.splice(0,2);for(var i=0;i<n.decorations.length-2;)n.decorations[i]===n.decorations[i+2]?n.decorations.splice(i,2):i+=2;return n.decorations}function h(e,t){function n(e){return r.getElementsByTagName(e)}function o(){for(var t=f.PR_SHOULD_USE_CONTINUATION?m.now()+250:1/0;T<d.length&&m.now()<t;T++){for(var n=d[T],r=O,l=n;l=l.previousSibling;){var u=l.nodeType,p=(7===u||8===u)&&l.nodeValue;if(p?!/^\??prettify\b/.test(p):3!==u||/\S/.test(l.nodeValue))break;if(p){r={},p.replace(/\b(\w+)=([\w:.%+-]+)/g,function(e,t,n){r[t]=n});break}}var h=n.className;if((r!==O||E.test(h))&&!v.test(h)){for(var D=!1,y=n.parentNode;y;y=y.parentNode){var A=y.tagName;if(R.test(A)&&y.className&&E.test(y.className)){D=!0;break}}if(!D){n.className+=" prettyprinted";var C=r.lang;if(!C){C=h.match(_);var I;!C&&(I=i(n))&&b.test(I.tagName)&&(C=I.className.match(_)),C&&(C=C[1])}var w;if(S.test(n.tagName))w=1;else{var P=n.currentStyle,M=s.defaultView,L=P?P.whiteSpace:M&&M.getComputedStyle?M.getComputedStyle(n,null).getPropertyValue("white-space"):0;w=L&&"pre"===L.substring(0,3)}var N=r.linenums;(N="true"===N||+N)||(N=h.match(/\blinenums\b(?::(\d+))?/),N=!!N&&(!N[1]||!N[1].length||+N[1])),N&&a(n,N,w),g={langExtension:C,sourceNode:n,numberLines:N,pre:w},c(g)}}}T<d.length?setTimeout(o,250):"function"==typeof e&&e()}for(var r=t||document.body,s=r.ownerDocument||document,l=[n("pre"),n("code"),n("xmp")],d=[],u=0;u<l.length;++u)for(var p=0,h=l[u].length;p<h;++p)d.push(l[u][p]);l=null;var m=Date;m.now||(m={now:function(){return+new Date}});var g,T=0,_=/\blang(?:uage)?-([\w.]+)(?!\S)/,E=/\bprettyprint\b/,v=/\bprettyprinted\b/,S=/pre|xmp/i,b=/^code$/i,R=/^(?:pre|code|xmp)$/i,O={};o()}var f=window,m=["break,continue,do,else,for,if,return,while"],g=[m,"auto,case,char,const,default,double,enum,extern,float,goto,inline,int,long,register,short,signed,sizeof,static,struct,switch,typedef,union,unsigned,void,volatile"],T=[g,"catch,class,delete,false,import,new,operator,private,protected,public,this,throw,true,try,typeof"],_=[T,"alignof,align_union,asm,axiom,bool,concept,concept_map,const_cast,constexpr,decltype,delegate,dynamic_cast,explicit,export,friend,generic,late_check,mutable,namespace,nullptr,property,reinterpret_cast,static_assert,static_cast,template,typeid,typename,using,virtual,where"],E=[T,"abstract,assert,boolean,byte,extends,finally,final,implements,import,instanceof,interface,null,native,package,strictfp,super,synchronized,throws,transient"],v=[T,"abstract,as,base,bool,by,byte,checked,decimal,delegate,descending,dynamic,event,finally,fixed,foreach,from,group,implicit,in,interface,internal,into,is,let,lock,null,object,out,override,orderby,params,partial,readonly,ref,sbyte,sealed,stackalloc,string,select,uint,ulong,unchecked,unsafe,ushort,var,virtual,where"],S="all,and,by,catch,class,else,extends,false,finally,for,if,in,is,isnt,loop,new,no,not,null,of,off,on,or,return,super,then,throw,true,try,unless,until,when,while,yes",b=[T,"debugger,eval,export,function,get,instanceof,null,set,undefined,var,with,Infinity,NaN"],R="caller,delete,die,do,dump,elsif,eval,exit,foreach,for,goto,if,import,last,local,my,next,no,our,print,package,redo,require,sub,undef,unless,until,use,wantarray,while,BEGIN,END",O=[m,"and,as,assert,class,def,del,elif,except,exec,finally,from,global,import,in,is,lambda,nonlocal,not,or,pass,print,raise,try,with,yield,False,True,None"],D=[m,"alias,and,begin,case,class,def,defined,elsif,end,ensure,false,in,module,next,nil,not,or,redo,rescue,retry,self,super,then,true,undef,unless,until,when,yield,BEGIN,END"],y=[m,"case,done,elif,esac,eval,fi,function,in,local,set,then,until"],A=[_,v,E,b,R,O,D,y],C=/^(DIR|FILE|vector|(de|priority_)?queue|list|stack|(const_)?iterator|(multi)?(set|map)|bitset|u?(int|float)\d*)\b/,I="str",w="kwd",P="com",M="typ",L="lit",N="pun",U="pln",x="tag",k="dec",F="src",Y="atn",B="atv",H="nocode",W="(?:^^\\.?|[+-]|[!=]=?=?|\\#|%=?|&&?=?|\\(|\\*=?|[+\\-]=|->|\\/=?|::?|<<?=?|>>?>?=?|,|;|\\?|@|\\[|~|{|\\^\\^?=?|\\|\\|?=?|break|case|continue|delete|do|else|finally|instanceof|return|throw|try|typeof)\\s*",V=/\S/,J=r({keywords:A,hashComments:!0,cStyleComments:!0,multiLineStrings:!0,regexLiterals:!0}),G={};l(J,["default-code"]),l(o([],[[U,/^[^<?]+/],[k,/^<!\w[^>]*(?:>|$)/],[P,/^<\!--[\s\S]*?(?:-\->|$)/],["lang-",/^<\?([\s\S]+?)(?:\?>|$)/],["lang-",/^<%([\s\S]+?)(?:%>|$)/],[N,/^(?:<[%?]|[%?]>)/],["lang-",/^<xmp\b[^>]*>([\s\S]+?)<\/xmp\b[^>]*>/i],["lang-js",/^<script\b[^>]*>([\s\S]*?)(<\/script\b[^>]*>)/i],["lang-css",/^<style\b[^>]*>([\s\S]*?)(<\/style\b[^>]*>)/i],["lang-in.tag",/^(<\/?[a-z][^<>]*>)/i]]),["default-markup","htm","html","mxml","xhtml","xml","xsl"]),l(o([[U,/^[\s]+/,null," \t\r\n"],[B,/^(?:\"[^\"]*\"?|\'[^\']*\'?)/,null,"\"'"]],[[x,/^^<\/?[a-z](?:[\w.:-]*\w)?|\/?>$/i],[Y,/^(?!style[\s=]|on)[a-z](?:[\w:-]*\w)?/i],["lang-uq.val",/^=\s*([^>\'\"\s]*(?:[^>\'\"\s\/]|\/(?=\s)))/],[N,/^[=<>\/]+/],["lang-js",/^on\w+\s*=\s*\"([^\"]+)\"/i],["lang-js",/^on\w+\s*=\s*\'([^\']+)\'/i],["lang-js",/^on\w+\s*=\s*([^\"\'>\s]+)/i],["lang-css",/^style\s*=\s*\"([^\"]+)\"/i],["lang-css",/^style\s*=\s*\'([^\']+)\'/i],["lang-css",/^style\s*=\s*([^\"\'>\s]+)/i]]),["in.tag"]),l(o([],[[B,/^[\s\S]+/]]),["uq.val"]),l(r({keywords:_,hashComments:!0,cStyleComments:!0,types:C}),["c","cc","cpp","cxx","cyc","m"]),l(r({keywords:"null,true,false"}),["json"]),l(r({keywords:v,hashComments:!0,cStyleComments:!0,verbatimStrings:!0,types:C}),["cs"]),l(r({keywords:E,cStyleComments:!0}),["java"]),l(r({keywords:y,hashComments:!0,multiLineStrings:!0}),["bash","bsh","csh","sh"]),l(r({keywords:O,hashComments:!0,multiLineStrings:!0,tripleQuotedStrings:!0}),["cv","py","python"]),l(r({keywords:R,hashComments:!0,multiLineStrings:!0,regexLiterals:2}),["perl","pl","pm"]),l(r({keywords:D,hashComments:!0,multiLineStrings:!0,regexLiterals:!0}),["rb","ruby"]),l(r({keywords:b,cStyleComments:!0,regexLiterals:!0}),["javascript","js"]),l(r({keywords:S,hashComments:3,cStyleComments:!0,multilineStrings:!0,tripleQuotedStrings:!0,regexLiterals:!0}),["coffee"]),l(o([],[[I,/^[\s\S]+/]]),["regex"]);var z=f.PR={createSimpleLexer:o,registerLangHandler:l,sourceDecorator:r,PR_ATTRIB_NAME:Y,PR_ATTRIB_VALUE:B,PR_COMMENT:P,PR_DECLARATION:k,PR_KEYWORD:w,PR_LITERAL:L,PR_NOCODE:H,PR_PLAIN:U,PR_PUNCTUATION:N,PR_SOURCE:F,PR_STRING:I,PR_TAG:x,PR_TYPE:M,prettyPrintOne:IN_GLOBAL_SCOPE?f.prettyPrintOne=u:prettyPrintOne=u,prettyPrint:prettyPrint=IN_GLOBAL_SCOPE?f.prettyPrint=h:prettyPrint=h,prettyTokens:p};"function"==typeof define&&define.amd&&define("google-code-prettify",[],function(){return z})}(),PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[\t\n\r \xA0]+/,null,"\t\n\r "],[PR.PR_PLAIN,/^(?:\"(?:[^\"\\]|\\[\s\S])*(?:\"|$)|\'(?:[^\'\\]|\\[\s\S])+(?:\'|$)|`[^`]*(?:`|$))/,null,"\"'"]],[[PR.PR_COMMENT,/^(?:\/\/[^\r\n]*|\/\*[\s\S]*?\*\/)/],[PR.PR_PLAIN,/^(?:[^\/\"\'`]|\/(?![\/\*]))+/i]]),["go"]),PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[\t\n\r \xA0]+/,null,"\t\n\r "],[PR.PR_STRING,/^(?:"(?:[^\"\\]|\\.)*"|'(?:[^\'\\]|\\.)*')/,null,"\"'"]],[[PR.PR_COMMENT,/^(?:--[^\r\n]*|\/\*[\s\S]*?(?:\*\/|$))/],[PR.PR_KEYWORD,/^(?:ADD|ALL|ALTER|AND|ANY|APPLY|AS|ASC|AUTHORIZATION|BACKUP|BEGIN|BETWEEN|BREAK|BROWSE|BULK|BY|CASCADE|CASE|CHECK|CHECKPOINT|CLOSE|CLUSTERED|COALESCE|COLLATE|COLUMN|COMMIT|COMPUTE|CONNECT|CONSTRAINT|CONTAINS|CONTAINSTABLE|CONTINUE|CONVERT|CREATE|CROSS|CURRENT|CURRENT_DATE|CURRENT_TIME|CURRENT_TIMESTAMP|CURRENT_USER|CURSOR|DATABASE|DBCC|DEALLOCATE|DECLARE|DEFAULT|DELETE|DENY|DESC|DISK|DISTINCT|DISTRIBUTED|DOUBLE|DROP|DUMMY|DUMP|ELSE|END|ERRLVL|ESCAPE|EXCEPT|EXEC|EXECUTE|EXISTS|EXIT|FETCH|FILE|FILLFACTOR|FOLLOWING|FOR|FOREIGN|FREETEXT|FREETEXTTABLE|FROM|FULL|FUNCTION|GOTO|GRANT|GROUP|HAVING|HOLDLOCK|IDENTITY|IDENTITYCOL|IDENTITY_INSERT|IF|IN|INDEX|INNER|INSERT|INTERSECT|INTO|IS|JOIN|KEY|KILL|LEFT|LIKE|LINENO|LOAD|MATCH|MATCHED|MERGE|NATURAL|NATIONAL|NOCHECK|NONCLUSTERED|NOCYCLE|NOT|NULL|NULLIF|OF|OFF|OFFSETS|ON|OPEN|OPENDATASOURCE|OPENQUERY|OPENROWSET|OPENXML|OPTION|OR|ORDER|OUTER|OVER|PARTITION|PERCENT|PIVOT|PLAN|PRECEDING|PRECISION|PRIMARY|PRINT|PROC|PROCEDURE|PUBLIC|RAISERROR|READ|READTEXT|RECONFIGURE|REFERENCES|REPLICATION|RESTORE|RESTRICT|RETURN|REVOKE|RIGHT|ROLLBACK|ROWCOUNT|ROWGUIDCOL|ROWS?|RULE|SAVE|SCHEMA|SELECT|SESSION_USER|SET|SETUSER|SHUTDOWN|SOME|START|STATISTICS|SYSTEM_USER|TABLE|TEXTSIZE|THEN|TO|TOP|TRAN|TRANSACTION|TRIGGER|TRUNCATE|TSEQUAL|UNBOUNDED|UNION|UNIQUE|UNPIVOT|UPDATE|UPDATETEXT|USE|USER|USING|VALUES|VARYING|VIEW|WAITFOR|WHEN|WHERE|WHILE|WITH|WITHIN|WRITETEXT|XML)(?=[^\w-]|$)/i,null],[PR.PR_LITERAL,/^[+-]?(?:0x[\da-f]+|(?:(?:\.\d+|\d+(?:\.\d*)?)(?:e[+\-]?\d+)?))/i],[PR.PR_PLAIN,/^[a-z_][\w-]*/i],[PR.PR_PUNCTUATION,/^[^\w\t\n\r \xA0\"\'][^\w\t\n\r \xA0+\-\"\']*/]]),["sql"]),PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[ \t\r\n\f]+/,null," \t\r\n\f"]],[[PR.PR_STRING,/^\"(?:[^\n\r\f\\\"]|\\(?:\r\n?|\n|\f)|\\[\s\S])*\"/,null],[PR.PR_STRING,/^\'(?:[^\n\r\f\\\']|\\(?:\r\n?|\n|\f)|\\[\s\S])*\'/,null],["lang-css-str",/^url\(([^\)\"\']+)\)/i],[PR.PR_KEYWORD,/^(?:url|rgb|\!important|@import|@page|@media|@charset|inherit)(?=[^\-\w]|$)/i,null],["lang-css-kw",/^(-?(?:[_a-z]|(?:\\[0-9a-f]+ ?))(?:[_a-z0-9\-]|\\(?:\\[0-9a-f]+ ?))*)\s*:/i],[PR.PR_COMMENT,/^\/\*[^*]*\*+(?:[^\/*][^*]*\*+)*\//],[PR.PR_COMMENT,/^(?:<!--|-->)/],[PR.PR_LITERAL,/^(?:\d+|\d*\.\d+)(?:%|[a-z]+)?/i],[PR.PR_LITERAL,/^#(?:[0-9a-f]{3}){1,2}\b/i],[PR.PR_PLAIN,/^-?(?:[_a-z]|(?:\\[\da-f]+ ?))(?:[_a-z\d\-]|\\(?:\\[\da-f]+ ?))*/i],[PR.PR_PUNCTUATION,/^[^\s\w\'\"]+/]]),["css"]),PR.registerLangHandler(PR.createSimpleLexer([],[[PR.PR_KEYWORD,/^-?(?:[_a-z]|(?:\\[\da-f]+ ?))(?:[_a-z\d\-]|\\(?:\\[\da-f]+ ?))*/i]]),["css-kw"]),PR.registerLangHandler(PR.createSimpleLexer([],[[PR.PR_STRING,/^[^\)\"\']+/]]),["css-str"]),PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[ \n\r\t\v\f\0]+/,null," \n\r\t\v\f\0"],[PR.PR_STRING,/^"(?:[^"\\]|(?:\\.)|(?:\\\((?:[^"\\)]|\\.)*\)))*"/,null,'"']],[[PR.PR_LITERAL,/^(?:(?:0x[\da-fA-F][\da-fA-F_]*\.[\da-fA-F][\da-fA-F_]*[pP]?)|(?:\d[\d_]*\.\d[\d_]*[eE]?))[+-]?\d[\d_]*/,null],[PR.PR_LITERAL,/^-?(?:(?:0(?:(?:b[01][01_]*)|(?:o[0-7][0-7_]*)|(?:x[\da-fA-F][\da-fA-F_]*)))|(?:\d[\d_]*))/,null],[PR.PR_LITERAL,/^(?:true|false|nil)\b/,null],[PR.PR_KEYWORD,/^\b(?:__COLUMN__|__FILE__|__FUNCTION__|__LINE__|#available|#else|#elseif|#endif|#if|#line|arch|arm|arm64|associativity|as|break|case|catch|class|continue|convenience|default|defer|deinit|didSet|do|dynamic|dynamicType|else|enum|fallthrough|final|for|func|get|import|indirect|infix|init|inout|internal|i386|if|in|iOS|iOSApplicationExtension|is|lazy|left|let|mutating|none|nonmutating|operator|optional|OSX|OSXApplicationExtension|override|postfix|precedence|prefix|private|protocol|Protocol|public|required|rethrows|return|right|safe|self|set|static|struct|subscript|super|switch|throw|try|Type|typealias|unowned|unsafe|var|weak|watchOS|while|willSet|x86_64)\b/,null],[PR.PR_COMMENT,/^\/\/.*?[\n\r]/,null],[PR.PR_COMMENT,/^\/\*[\s\S]*?(?:\*\/|$)/,null],[PR.PR_PUNCTUATION,/^<<=|<=|<<|>>=|>=|>>|===|==|\.\.\.|&&=|\.\.<|!==|!=|&=|~=|~|\(|\)|\[|\]|{|}|@|#|;|\.|,|:|\|\|=|\?\?|\|\||&&|&\*|&\+|&-|&=|\+=|-=|\/=|\*=|\^=|%=|\|=|->|`|==|\+\+|--|\/|\+|!|\*|%|<|>|&|\||\^|\?|=|-|_/,null],[PR.PR_TYPE,/^\b(?:[@_]?[A-Z]+[a-z][A-Za-z_$@0-9]*|\w+_t\b)/,null]]),["swift"]),function(e){e.PR&&(e.ZWPR=PR)}(window),function(e){e.U=_.noConflict()}(window),function(e){"use strict";var t=console,n=function(){this.debug=0};n.prototype.enable=function(e){this.debug=e||1},n.prototype.disable=function(){this.debug=0},n.prototype.error=function(){this.debug>0&&t.error.apply(t,arguments)},n.prototype.info=function(){this.debug>1&&t.info.apply(t,arguments)},n.prototype.log=function(){this.debug>0&&t.log.apply(t,arguments)},n.prototype.time=function(){this.debug>2&&t.time.apply(t,arguments)},n.prototype.timeEnd=function(){this.debug>2&&t.timeEnd.apply(t,arguments)},n.prototype.trace=function(){this.debug>2&&t.trace.apply(t,arguments)},n.prototype.warn=function(){this.debug>1&&t.warn.apply(t,arguments)},e.ZWLogger=n}(window),ATTR_BODY={DS_COLCOLS:"cols",DS_COLCOUNT:"count",DS_COLSPACE:"space",DS_COLWID:"width",DS_COLISEQWID:"iseqwidth",DS_COLSEP:"seperator",DS_DEFAULTSPACE:"defaultspace",DS_WEBFONTS:"webfonts",DS_PS:"ps",DS_PW:"pw",DS_PH:"ph",DS_SPLANG:"splang",DS_OR:"or",DS_UN:"un",DS_AUTOLINK:"autolink",DS_AUTOLIST:"autolist",DS_AUTODATEFORMAT:"autoDateFmt",DS_PASTEOPTIONS:"pasteOptions",DS_AUTOCAPS:"autocaps",DS_AUTOCORRECTCAPSLOCK:"autocaps_correct",DS_AUTOCAPSDAYS:"autocaps_days",DS_AUTOCOMPLETE:"autocomplete",DS_AUTOSMARTQUOTES:"autosmartquotes",DS_BGC:"bgc",DS_DIR:"dir",DS_LS:"ls",DS_ML:"ml",DS_MR:"mr",DS_MB:"mb",DS_MT:"mt",DS_HT:"ht",DS_FB:"fb",DS_SB:"sb",DS_VIEW:"view",DS_SA:"sa",DS_EN:"endnote",DS_FN:"footnote",DS_TPS:"tps",DS_INSPL:"inspl",DS_COMM:"comm",DS_PREF:"ds_pref",DS_AUTOCORRECTS:"autocorrects",DS_HEADINGSTYLES:"headingstyles",DS_PARASTYLES:"paraStyles",DS_STYLES:"styles",DS_PARA:"para",DS_THEME:"theme",DS_PADTHEME:"padtheme",DS_FONT:"font",DS_PGBRK:"pgbrk",DS_COLBRK:"colbrk",SP_IGNOREUPPERCASE:"sp_ignoreuppercase",SP_IGNORENUMBERED:"sp_ignorenumbered",SP_FLAGREPEATEDWORD:"sp_flagrepeatedword",SP_IGNORELINK:"sp_ignorelink",DS_TABLETHEME:"tabletheme",PREF:"pref",DS_TOC:"toc",DS_HIDERUL:"hideruler",DS_BANNERVER:"bannerver",DS_HF_TYPE:"hf_type",WM_URL:"wm_url",WM_TYPE:"wm_type",WM_SIZE:"wm_size",WM_AN:"wm_an",WM_FF:"wm_ff",WM_FGC:"wm_fgc",WM_FS:"wm_fs",WM_PURL:"wm_purl",WM_TXT:"wm_txt",WM_URL:"wm_url",WM_OP:"wm_op",WM_OURL:"wm_ourl",TC_ISENABLED:"tc_isEnabled",TC_ISREVIEWPAGE:"tc_isReviewPage",TC_ON_BY_ZUID:"tc_on_by_zuid",TC_ON_BY_COLLAB:"tc_on_by_collab",TC_OFF_BY_COLLAB:"tc_off_by_collab",TC_COLLAB_LIST:"tc_collab_list",TC_DISPLAYMODE:"tc_displayMode",DS_SHOWNONPRINTINGCHAR:"show_non_printing_char",DS_PAGENUMBER:"pagenumber",DS_PAGENUMBER_FORMAT:"pageno_format",DS_PAGENUMBER_STARTS_AT:"pageno_starts_at"},ATTR_TEXT={TS_FF:"ff",TS_FW:"fw",CLS:"cls",MM_FIELDNAME:"mm_fld",MM_INFO:"mminfo",TS_CS:"cs",TS_FV:"fv",TS_FS:"fs",TS_SIZE:"size",TS_FGC:"fgc",TS_BGC:"bgc",TS_TD:"td",TS_SP:"sp",TS_GR:"grammar",TS_VA:"va",BID:"bid",TS_NULL:"ts_null",TS_AUTO_COREECT:"autocorrect",TS_TT:"tt",CHAR_STY:"char_sty",TS_HD:"heading"},TEXT_ATTR={"font-family":"ff","font-size":"size","font-weight":"fw","font-style":"fs","font-variant":"fv",color:"fgc","text-decoration":"td","letter-spacing":"cs","background-color":"bgc","vertical-align":"va"},ATTR_PARAGRAPH={PS_NULL:"ps_null",PS_SB:"sb",PS_DIR:"dir",PS_SA:"sa",PS_ML:"ml",PS_MR:"mr",TEXTFORMAT:"textFormat",PS_PL:"pl",PS_PR:"pr",PS_PT:"pt",PS_PB:"pb",PS_TI:"ti",PS_BGC:"bgc",PS_TPS:"tps",PS_LS:"ls",PS_RI:"ri",PS_AL:"al",PS_HD:"hd",PS_TYPE:"ps_type",LS_DATA:"ls_data",PS_FLI:"fli",PS_WS:"ws",PS_TS:"ts",PS_H0:"h0",EN_WO:"en_wo",EN_BL:"en_bl",EN_PB:"en_pb",PS_DROPCAP:"isDropCapPresent",PS_CODE:"code"},PARA_ATTR={"margin-top":"sb","margin-bottom":"sa",direction:"dir","margin-left":"ml","margin-right":"mr","padding-left":"pl","padding-right":"pr","text-indent":"ti","background-color":"bgc","line-height":"ls","right-indent":"ri","text-align":"al","word-spacing":"ws"},ATTR_TOC={theme:"theme",level:"level",leader:"leader",al:"al",showNo:"showNo",al_right:"al_right"},ATTR_IMAGE={I_SRC:"src",I_WID:"wid",I_CALC_WID:"calc_wid",I_WID_UN:"wid_un",I_HT_UN:"ht_un",I_HT:"ht",I_OP:"op",I_AL:"al",I_IMGSIZE:"zoom",I_LATEXEXP:"latexexp",I_ID:"id",I_ALT:"alt",I_TOOLTIP:"tooltip",I_ML:"ml",I_MR:"mr",I_MT:"mt",I_MB:"mb",I_SHAPENAME:"shapeName",I_SHAPEDATA:"shapeData",I_LEFT:"left",I_TOP:"top",I_ROTATE:"rotation",I_LINKDATA:"linkData",I_CROPRECT:"cropRect",I_ORGINALWID:"orginalWid",I_ORGINALHT:"orginalHt"},ATTR_SHAPE={SHAPEID:"shapeId",RID:"rid",ORGDATA:"orgData",PAPER_WIDTH:"PAPER_WIDTH",PAPER_HEIGHT:"PAPER_HEIGHT",ZINDEX:"z-index",SHAPEDATA:"shapeData",BGSHAPE:"bgshape"},ATTR_TABLE={TBLS_AL:"al",TBLS_BGC:"bgc",TBLS_CP:"cp",TBLS_WID:"wid",TBLS_BGIMG:"bgimg",TBLS_THEME:"theme",TBLS_THEMENAME:"themeName",TBLS_VER:"ver",TBLS_COLS:"cols",TBLS_ML:"ml",TBLS_DIR:"dir",TBLS_TBL_BGC:"z_tbl_bgc",TBLS_THEME_OBJECT:"themeObj"},ATTR_ROW={TRS_HT:"ht",TRS_BGC:"bgc"},ATTR_CELL={TDS_MRG:"merge",TDS_BGC:"bgc",TDS_VA:"va",TDS_TXTAL:"txtal",TDS_CSPAN:"cspan",TDS_RSPAN:"rspan",TDS_HT:"ht",TDS_WID:"wid",TDS_PL:"pl",TDS_PR:"pr",TDS_PB:"pb",TDS_PT:"pt",TDS_BGIMG:"bgimg",Z_TD_BGC:"z_td_bgc"},ATTR_SECTION={SID:"sid",ST:"st",PARENTID:"parentid",CTYPE:"ctype",USERNAME:"uname",NAME:"name",TIME:"time",USERID:"uid",COLOR:"color",RESOLVE:"resolve"},ATTR_HR={BID:"bid",HR_AL:"al",HR_WID:"wid",HR_HT:"ht"},ATTR_AUTOFIELD={FIELDTYPE:"ftype",VALUE:"val",DATEFMT:"datefmt",DEFINEDAUTHOR:"definedauthor",ISAUTO:"isauto",FORMULA:"formula"},ATTR_LINK={LINK_TYPE:"lnktype",LINK_URL:"url",LINK_TARGET:"target",LINK_TOOLTIP:"tooltip"},ATTR_COMMON={TYPE:"type",CLS:"cls",ST:"st",ID:"id",NAME:"name",IDX:"idx",START:"start",END:"end",FIELDINFO:"fieldinfo",HISTORY_CLS:"history_diff",BORDERS:"borders"},ATTR_SHAPE={BGSHAPE:"bgshape"},ATTR_WIDGET={WIDGET:"widget",CUSTOM_DATA:"customdata",THUMBNAIL:"thumbnail",SRC:"widgetSrc",SERVICE:"service",ID:"id",WID:"wid",HT:"ht",WIDTH:"width",TUBEID:"id",SANDBOX:"sandbox",HEIGHT:"height",STYLE:"style",BORDER:"border",BORDER_RADIUS:"border-radius",SHOW_PUBURL:"/show/publish/",REPORTS_PUBURL:"/ZDBDataSheetView.cc?OBJID=",SHEET_PUBURL:"/sheet/published.do?rid=",SHEET_EXTERNAL_PUBURL:"/sheet/publishrange.do?id=",SHEET_INTRANET_PUBURL:"/sheet/publishrange.org?id=",SHEET_CHARTS_PUBURL:"/sheet/publicgraphs/",YOUTUBE_EMBED_URL:"www.youtube.com/embed/",DOCS_EMBED_URL:"docs.zoho.com/file/",SERVICE_SHOW:"SHOW",SERVICE_DOCS:"DOCS",SERVICE_REPORTS:"REPORTS",SERVICE_SHEET:"SHEET",SERVICE_YOUTUBE:"YOUTUBE",SERVICE_SHEETCHART:"SHEETCHART",SERVICE_SHEETCHARTIMG:"SHEETCHARTIMG",SERVICE_SHEETEXTERNAL:"SHEETEXTERNAL",SERVICE_SHEETINTRANET:"SHEETINTRANET",URL_REGEX:"^(?:|http(?:|s)://)(?:|(?:[^/])+[.])(?:zoho.(?:com|com.cn|eu))(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])wordpress.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])twitter.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])mozilla.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])scribd.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])techsmith.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])google.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])facebook.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])yahoo.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])youtube.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])slideshare.net(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])dailymotion.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])vimeo.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])flickr.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])blip.tv(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])myspace.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])slidesharecdn.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])qualvu.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])clicflic.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])salesforce.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])voicethread.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])viddler.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])animoto.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])360cities.net(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])dotsub.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])livestream.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])ted.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])teachertube.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])voicethread.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])d.yimg.com(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])mozilla.org(?:|/.*)$|^(?:|http(?:|s)://)(?:|(?:[^/])+[.])scribd.com(?:|/.*)$",VIDEO_REGEX:/^((http|https)?\:\/\/)?(www\.)?(?:youtu\.be\/|youtube\.com(?:\/embed\/|\/v\/|\/watch\?v=|\/user\/\S+|\/ytscreeningroom\?v=))([\w\-]{10,12})\b$/,ZOHO_OFFICE_REGEX:"^(?:|http(?:|s)://)(?:|(?:[^/])+[.])(?:zoho.(?:com|com.cn|eu)(/writer|/sheet|/show))(?:|/.*)$"},ATTR_BORDERS={TYPE:"type",WIDTH:"width",COLOR:"color",SPACE:"space",BORDER_TOP:"border-top",BORDER_LEFT:"border-left",BORDER_RIGHT:"border-right",BORDER_BOTTOM:"border-bottom"};var is_phantom_browser=!(!navigator.userAgent||navigator.userAgent.indexOf("PhantomJS")==-1),is_wkhtmltopdf_browser=!(!navigator.userAgent||navigator.userAgent.indexOf("wkhtmltopdf")==-1),CONST={MERGEFIELD:"mergeField",NEXTRECORD:"nextrecord",TOC_PREV_PARA:"tocBr",TOC_MAIN_DIV:"toc",TOC_REGENERATE:"tocRegenerate",TOC_CLOSE:"tocClose",TOC_SETTINGS:"tocSettings",TOC_CONT_DIV:"zwTOCDiv",ZERO_WIDTH_SPACE:"&#8203;",ZERO_WIDTH_JOINER:"&zwj;",PG_SPLIT_NODE:"pagesplitnode",PG_SPLIT_LAYER:"split-layer",PG_BRK_LAYER:"pagebreaklayer",FN_LAYER:"footnoteslayer",FIELD_TEXT_NODE:"field_text_node",FTR_LAYER:"footerlayer",PRI_PG_FTR:"primarypagefooter",HDR_LAYER:"headerlayer",PRI_PG_HDR:"primarypageheader",MUST_PAGINATE:-1,STATE_STARTED:0,HEADER_EVEN:0,HEADER_PRIMARY:1,FOOTER_EVEN:2,FOOTER_PRIMARY:3,HEADER_FIRST:4,FOOTER_FIRST:5,STATE_COMPLETE:1,PASTE_SOURCEFORMAT:0,PORTION_END_WITHOUT_TAB:"PORTION_END_WITHOUT_TAB",PASTE_DESTINATIONFORMAT:1,PASTE_TEXTONLYFORMAT:2,PASTE_CONTINUELIST:3,PASTE_ASNEWLIST:4,PASTE_MERGELIST:5,PASTE_DONT_MERGELIST:6,DEFAULT_AUTO_CORRECTS:["--","-","(c)","(r)","(tm)","1/4","1/2","3/4","-->","<--","<->","==>","<==","<=>"],CLEAN_MODE:0,RICH_EDIT_MODE:1,REVIEW_MODE:2,MSG_TYPE_CONFIRM:1,MSG_TYPE_RELOAD:2,MSG_TYPE_RELOADCANCEL:3,MSG_TYPE_YESNO:4,MSG_TYPE_ALERT:5,MSG_TYPE_CUSTOM:6,SEVERITY_WARNING:"warning",SEVERITY_ALERT:"alert",SEVERITY_ERROR:"error",SEVERITY_SUCCESS:"success",BUTTON_1_CLICKED:1,BUTTON_2_CLICKED:2,BUTTON_3_CLICKED:3,BUTTON_OK_CLICKED:1,BUTTON_RELOAD_CLICKED:1,BUTTON_YES_CLICKED:1,BUTTON_CANCEL_CLICKED:2,BUTTON_NO_CLICKED:2,PAGE_BOTTOM_MARGIN_BORDERS:25,DEFAULT_PAPER:"Letter",DEFAULT_ORIENTATION:"Portrait",MIN_COLUMN_WIDTH:"1.27cm"},PARA_TAG_MAPPING={0:"Normal",1:"Heading 1",2:"Heading 2",3:"Heading 3",4:"Heading 4",5:"Heading 5",6:"Heading 6",7:"Heading 7",8:"Heading 8",9:"Heading 9",101:"Title",102:"Subtitle",103:"Quote",104:"Intense Quote",105:"List Paragraph",106:"No Spacing"},CHAR_TAG_MAPPING={1:"Subtle Emphasis",2:"Emphasis",3:"Intense Emphasis",4:"Strong",5:"Subtle Reference",6:"Intense Reference",7:"Book Title"},NODE_NAME={HTML:"html",HEAD:"head",META:"meta",LINK:"link",STYLE:"style",BODY:"body",DIV:"div",HR:"hr",P:"p",SPAN:"span",TABLE:"table",TBODY:"tbody",TR:"tr",TD:"td",A:"a",IMAGE:"img"},NODE_TYPE={BODY:"body",PARA:"para",PARAGRAPH:"paragraph",TAB:"tab",TEXT:"text",IMAGE:"image",IFRAME:"iframe",HR:"hr",BR:"br",TABLE:"table",TABLEEND:"tableend",TBODY:"tbody",ROW:"row",RUN:"run",FIELD_START:"fieldstart",FIELD_END:"fieldend",CELL:"cell",TOC:"toc",LINK:"link",WORD:"word",HEADER_PRIMARY:"header_primary",HEADER_FIRST:13,HEADER_ODD:14,FOOTER_PRIMARY:"footer_primary",FOOTER_FIRST:16,FOOTER_ODD:17,FOOTNOTE:"footnote",ENDNOTE:"endnote",COMMENT:"comment",SECTION:"section",AUTOFIELD:"autofield",BOOKMARK:"bookmark",MAILMERGEFIELD:"mergeField",NEXTRECORD:"nextrecord",PLACEHOLDER:"placeholder",TOC:"toc",TOCEND:"tocend",WIDGET:"widget"},LIST_TYPE={TOC_TYPE_1:128,NONE:255,DECIMAL:0,LOWER_ALPHA:4,UPPER_ALPHA:3,LOWER_ROMAN:2,UPPER_ROMAN:1,DISC:6,CIRCLE:7,BOX:8,RECENT_ORDER:0,RECENT_UNORDER:6,CHECKLIST:256},H_LIST_TYPE={ARTICLE:16,LEGAL_STYLE:17,LIST_STYLE:18,CHAPTER:19},LIST_STYLE_OBJECT={0:{level0:{type:0,startsWith:1,c:"\0."},level1:{type:4,startsWith:1,c:"."},level2:{type:2,startsWith:1,c:"."},level3:{type:0,startsWith:1,c:"."},level4:{type:4,startsWith:1,c:"."},level5:{type:2,startsWith:1,c:"."},level6:{type:0,startsWith:1,c:"."},level7:{type:4,startsWith:1,c:"."},level8:{type:2,startsWith:1,c:"\b."}},4:{level0:{type:4,startsWith:1,c:"\0."},level1:{type:2,startsWith:1,c:"."},level2:{type:0,startsWith:1,c:"."},level3:{type:4,startsWith:1,c:"."},level4:{type:2,startsWith:1,c:"."},level5:{type:0,startsWith:1,c:"."},level6:{type:4,startsWith:1,c:"."},level7:{type:2,startsWith:1,c:"."},level8:{type:0,startsWith:1,c:"\b."}},3:{level0:{type:3,startsWith:1,c:"\0."},level1:{type:2,startsWith:1,c:"."},level2:{type:0,startsWith:1,c:"."},level3:{type:4,startsWith:1,c:"."},level4:{type:2,startsWith:1,c:"."},level5:{type:0,startsWith:1,c:"."},level6:{type:4,startsWith:1,c:"."},level7:{type:2,startsWith:1,c:"."},level8:{type:0,startsWith:1,c:"\b."}},2:{level0:{type:2,startsWith:1,c:"\0."},level1:{type:0,startsWith:1,c:"."},level2:{type:4,startsWith:1,c:"."},level3:{type:2,startsWith:1,c:"."},level4:{type:0,startsWith:1,c:"."},level5:{type:4,startsWith:1,c:"."},level6:{type:2,startsWith:1,c:"."},level7:{type:0,startsWith:1,c:"."},level8:{type:4,startsWith:1,c:"\b."}},1:{level0:{type:1,startsWith:1,c:"\0."},level1:{type:2,startsWith:1,c:"."},level2:{type:0,startsWith:1,c:"."},level3:{type:4,startsWith:1,c:"."},level4:{type:2,startsWith:1,c:"."},level5:{type:0,startsWith:1,c:"."},level6:{type:4,startsWith:1,c:"."},level7:{type:2,startsWith:1,c:"."},level8:{type:0,startsWith:1,c:"\b."}},6:{level0:{type:6,startsWith:1},level1:{type:7,startsWith:1},level2:{type:8,startsWith:1},level3:{type:6,startsWith:1},level4:{type:7,startsWith:1},level5:{type:8,startsWith:1},level6:{type:6,startsWith:1},level7:{type:7,startsWith:1},level8:{type:8,startsWith:1}},7:{level0:{type:7,startsWith:1},level1:{type:8,startsWith:1},level2:{type:6,startsWith:1},level3:{type:7,startsWith:1},level4:{type:8,startsWith:1},level5:{type:6,startsWith:1},level6:{type:7,startsWith:1},level7:{type:8,startsWith:1},level8:{type:6,startsWith:1}},8:{level0:{type:8,startsWith:1},level1:{type:6,startsWith:1},level2:{type:7,startsWith:1},level3:{type:8,startsWith:1},level4:{type:6,startsWith:1},level5:{type:7,startsWith:1},level6:{type:8,startsWith:1},level7:{type:6,startsWith:1},level8:{type:7,startsWith:1}},255:{level0:{type:255,startsWith:1},level1:{type:255,startsWith:1},level2:{type:255,startsWith:1},level3:{type:255,startsWith:1},level4:{type:255,startsWith:1},level5:{type:255,startsWith:1},level6:{type:255,startsWith:1},level7:{type:255,startsWith:1},level8:{type:255,startsWith:1}}},DIRECTION={LEFT:0,RIGHT:1},TEXT_ALIGN={0:"left",1:"center",2:"right",3:"justify"},PARA_DIR={RTL:"rtl",LTR:"ltr"},UNICODE={TABLE:"",ROW:"",CELL:"",TABLEEND:"",IMAGE:"",IFRAME:"",BR:"\v",PARA:"\n",TAB:"\t",RANGE_START:"",RANGE_END:"",SPACE:" ",MULTIBYTE_SPACE:"",SECTION_START:"",HR:"\r",TOCEND:"",TOCSTART:"",MERGEFIELD_START:"",MERGEFIELD_END:""},DOC_INVISIBLE_CHARS;!function(){var e=[];for(var t in UNICODE)"MULTIBYTE_SPACE"!=t&&"SPACE"!=t&&"MERGEFIELD_START"!=t&&"MERGEFIELD_END"!=t&&e.push(UNICODE[t]);DOC_INVISIBLE_CHARS=e.join("")}();var CONT_REGEX_REDACT_EXCLUDE="";!function(){for(var e in UNICODE)CONT_REGEX_REDACT_EXCLUDE+=UNICODE[e]}();var DOC_CHARS={paragraph:UNICODE.PARA,table:UNICODE.TABLE,row:UNICODE.ROW,cell:UNICODE.CELL,hr:UNICODE.HR,section:UNICODE.SECTION_START,image:UNICODE.IMAGE,br:UNICODE.BR},AUTOFIELD_TYPE={AUTO_PAGENUMBER:"autopno",AUTO_PAGECOUNT:"autopcnt",AUTO_DATE:"autodate",AUTO_DOCNAME:"autodocname",AUTO_DOCVERSION:"autodocversion",AUTO_AUTHOR:"autoauthor",AUTO_FORMULA:"autoformula"},COMMAND={ANY:0,UNDO:1,REDO:2,TYPING:3,CUSTOM_PASTE:4},CONT_REGEXP={PARASTART:UNICODE.PARA+"|"+UNICODE.TABLE+"|"+UNICODE.HR+"|"+UNICODE.CELL+"|"+UNICODE.ROW+"|"+UNICODE.TABLEEND+"|"+UNICODE.SECTION_START+"|"+UNICODE.TOCSTART+"|"+UNICODE.TOCEND,BLOCKSTART:UNICODE.PARA+"|"+UNICODE.TABLE+"|"+UNICODE.HR+"|"+UNICODE.CELL+"|"+UNICODE.ROW,TABLEEND:UNICODE.TABLEEND,TABLESTART:UNICODE.TABLE,ROWSTART:UNICODE.ROW+"|"+UNICODE.TABLE,ROWEND:UNICODE.ROW+"|"+UNICODE.TABLEEND,CELLSTART:UNICODE.CELL,CELLEND:UNICODE.CELL+"|"+UNICODE.ROW+"|"+UNICODE.TABLEEND,SECTIONSTART:UNICODE.SECTION_START,SECTIONEND:UNICODE.SECTION_START,TC_BLOCK_CHARS:UNICODE.TABLEEND+"|"+UNICODE.TOCEND};CONT_REGEXP.PARAEND=CONT_REGEXP.BLOCKSTART+"|"+UNICODE.TABLEEND+"|"+UNICODE.SECTION_START+"|"+UNICODE.HR+"|"+UNICODE.TOCSTART+"|"+UNICODE.TOCEND,CONT_REGEXP.PORTION_END=CONT_REGEXP.PARAEND+"|"+UNICODE.TAB+"|"+UNICODE.RANGE_START+"|"+UNICODE.RANGE_END+"|"+UNICODE.HR+"|"+UNICODE.BR+"|"+UNICODE.IMAGE,CONT_REGEXP[CONST.PORTION_END_WITHOUT_TAB]=CONT_REGEXP.PARAEND+"|"+UNICODE.RANGE_START+"|"+UNICODE.RANGE_END+"|"+UNICODE.HR+"|"+UNICODE.BR+"|"+UNICODE.IMAGE,CONT_REGEXP.AUTOFIELD_WITHOUT_PAGENO_COUNT_FORMULA=AUTOFIELD_TYPE.AUTO_DATE+"|"+AUTOFIELD_TYPE.AUTO_AUTHOR+"|"+AUTOFIELD_TYPE.AUTO_DOCNAME+"|"+AUTOFIELD_TYPE.AUTO_DOCVERSION,CONT_REGEXP.AUTOFIELD_WITHOUT_FORMULA=CONT_REGEXP.AUTOFIELD_WITHOUT_PAGENO_COUNT_FORMULA+"|"+AUTOFIELD_TYPE.AUTO_PAGENUMBER+"|"+AUTOFIELD_TYPE.AUTO_PAGECOUNT,CONT_REGEXP.AUTOFIELD_WITHOUT_PAGENO_COUNT=CONT_REGEXP.AUTOFIELD_WITHOUT_PAGENO_COUNT_FORMULA+"|"+AUTOFIELD_TYPE.AUTO_FORMULA,CONT_REGEXP.AUTOFIELD=CONT_REGEXP.AUTOFIELD_WITHOUT_FORMULA+"|"+AUTOFIELD_TYPE.AUTO_FORMULA,PREDEFINED_NOTE_REFERENCE_SYMBOLS=["*","","",""];var KEYS={SPACE:32,CAPS:20,BACKSPACE:8,TAB:9,ENTER:13,ESC:27,INSERT:45,DELETE:46,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,NAV_LEFT:37,NAV_UP:38,NAV_RIGHT:39,NAV_DOWN:40,LEFTWINDOW:91,RIGHTWINDOW:92,F7:118,SHIFT:16,C:67,V:86,COMMA:188,Q:81,CTRL:17,ALT:18,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F8:119,F9:120,F10:121,F11:122,F12:123},NON_PRINTABLE_KEYS={CAPS:20,BACKSPACE:8,TAB:9,ENTER:13,ESC:27,INSERT:45,DELETE:46,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,NAV_LEFT:37,NAV_UP:38,NAV_RIGHT:39,NAV_DOWN:40,LEFTWINDOW:91,RIGHTWINDOW:92,SHIFT:16,CTRL:17,ALT:18,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},SavedDesign={},DocDesignName="",DefaultStyles={para:{h0:{textFormat:{ff:"zwminor",size:11},ls:"1.2"},h1:{textFormat:{ff:"zwmajor",fw:"bold",size:"18",fgc:"zwaccent1*75"}},h2:{textFormat:{ff:"zwmajor",fw:"bold",size:"14",fgc:"zwaccent1"}},h3:{textFormat:{ff:"zwmajor",fw:"bold",size:"12",fgc:"zwaccent1"}},h4:{textFormat:{ff:"zwmajor",fs:"italic",size:"11",fgc:"zwaccent1"}},h5:{textFormat:{ff:"zwmajor",fw:"bold",size:"10",fgc:"zwaccent1"}},h6:{textFormat:{ff:"zwmajor",fs:"italic",size:"10",fgc:"zwaccent1*50"}},h7:{textFormat:{ff:"zwmajor",fs:"italic",size:"11",fgc:"zwaccent1"}},h8:{textFormat:{ff:"zwmajor",fs:"italic",size:"11",fgc:"zwaccent1"}},h9:{textFormat:{ff:"zwmajor",fs:"italic",size:"11",fgc:"zwaccent1"}},h101:{al:1,textFormat:{ff:"zwmajor",fw:"bold",size:"12",fgc:"zwaccent1"}},h102:{textFormat:{ff:"zwmajor",fs:"italic",size:"11",fgc:"zwaccent1"}},h103:{textFormat:{ff:"zwmajor",fs:"italic",size:"11",fgc:"zwaccent1"}},h104:{textFormat:{ff:"zwmajor",fs:"italic",size:"11",fgc:"zwaccent1"}},h105:{textFormat:{ff:"zwmajor",fs:"italic",size:"11",fgc:"zwaccent1"}},h106:{textFormat:{ff:"zwmajor",fs:"italic",size:"11",fgc:"zwaccent1"}}},char:{1:{fw:"bold",fs:"italic",fgc:"zwaccent1",cs:"0.5pt"},2:{fw:"bold",fs:"italic",fgc:"zwaccent2",cs:"0.5pt"},3:{fw:"bold",fs:"italic",fgc:"zwaccent3",cs:"0.5pt"},4:{fw:"bold",fs:"italic",fgc:"zwaccent4",cs:"0.5pt"},5:{fw:"bold",fs:"italic",fgc:"zwaccent5",cs:"0.5pt"},6:{fw:"bold",fs:"italic",fgc:"zwaccent6",cs:"0.5pt"},7:{fw:"bold",fs:"italic",fgc:"zwaccent2",cs:"0.5pt"}},table:{},shape:{},name:"Default"},DefaultTheme={name:"Default",color:{name:"Default",dark1:"rgb(0,0,0)",dark2:"rgb(223,227,229)",accent2:"rgb(246,195,0)",accent3:"rgb(127,198,93)",accent4:"rgb(136,139,163)",accent5:"rgb(244,126,47)",accent6:"rgb(70,171,198)",light2:"rgb(26,58,42)",light1:"rgb(255,255,255)",accent1:"rgb(68,125,226)",hlink:"rgb(204,153,0)",folHlink:"rgb(150,150,150)"},font:{name:"Default",minor:{latin:"arial,helvetica,sans-serif"},major:{latin:"arial black,avant garde"}},fmtScheme:{name:"Default",fill:{type:"solid",color:"rgb(255,0,0)",gradient:[],opactity:"0.4"},line:{width:"1px",type:"dash",color:"rgb(255,0,0)"},effects:{shadow:{color:"rgb(255,0,0)",distance:"2",angle:"30"},reflection:{distance:"2",radius:"30",opacity:"0.5"},bgfill:{" img":""}}}},MAX_REVISION=99,REGEX={docUnicodes:/[\u000e\u000f\u0010\u0011\u0012\u000b\u001c\u0013\t]/g},HEADER_ALLOWENCE={top:"0.2in",right:"0in",bottom:"0.1in",left:"0in"},FOOTER_ALLOWENCE={top:"0.1in",right:"0in",bottom:"0.2in",left:"0in"},PAPER_HEIGHT_ALLOWENCE="0.1in";REMOTE_MESSAGE={},REMOTE_MESSAGE.probleminRemoteclient="writer.remotesave.REMOTESAVE_ERR_MSG2",REMOTE_MESSAGE.ExportResultNull="writer.remotesave.REMOTESAVE_ERR_MSG3",REMOTE_MESSAGE.postexception="writer.remotesave.REMOTESAVE_ERR_MSG4",REMOTE_MESSAGE.exportContentNull="writer.remotesave.REMOTESAVE_ERR_MSG4",REMOTE_MESSAGE.publicexportError="writer.remotesave.REMOTESAVE_ERR_MSG5",REMOTE_MESSAGE.connectionrefused="writer.remotesave.REMOTESAVE_ERR_MSG5";var HLIST_TYPE={};HLIST_TYPE={16:{level2:{startsWith:1,c:"()",type:4,htype:16},level3:{startsWith:1,c:"()",type:2,htype:16},level0:{startsWith:1,c:"Article \0.",type:1,htype:16},level1:{startsWith:1,c:"Section \0.",type:22,htype:16},level8:{startsWith:1,c:"\b.",type:1,htype:16},level7:{startsWith:1,c:".",type:1,htype:16},level6:{startsWith:1,c:")",type:1,htype:16},level5:{startsWith:1,c:")",type:4,htype:16},level4:{startsWith:1,c:")",type:0,htype:16}},17:{level0:{type:0,startsWith:1,c:"\0",htype:17},level1:{type:0,startsWith:1,c:"\0.",htype:17},level2:{type:0,startsWith:1,c:"\0..",htype:17},level3:{type:0,startsWith:1,c:"\0...",htype:17},level4:{type:0,startsWith:1,c:"\0....",htype:17},level5:{type:0,startsWith:1,c:"\0.....",htype:17},level6:{type:0,startsWith:1,c:"\0......",htype:17},level7:{type:0,startsWith:1,c:"\0.......",htype:17},level8:{type:0,startsWith:1,c:"\0........\b",htype:17}},18:{level0:{type:1,startsWith:1,c:"\0.",htype:18},level1:{type:3,startsWith:1,c:".",htype:18},level2:{type:0,startsWith:1,c:".",htype:18},level3:{type:4,startsWith:1,c:")",htype:18},level4:{type:0,startsWith:1,c:"()",htype:18},level5:{type:4,startsWith:1,c:"()",htype:18},level6:{type:1,startsWith:1,c:"()",htype:18},level7:{type:1,startsWith:1,c:"()",htype:18},level8:{type:1,startsWith:1,c:"(\b)",htype:18}},19:{level2:{startsWith:1,type:255,htype:19},level3:{startsWith:1,type:255,htype:19},level0:{startsWith:1,c:"Chapter \0",type:0,htype:19},level1:{startsWith:1,type:255,htype:19},level8:{startsWith:1,type:0,htype:19},level7:{startsWith:1,type:0,htype:19},level6:{type:0,startsWith:1,htype:19},level5:{startsWith:1,type:255,htype:19},level4:{startsWith:1,type:255,htype:19}}};var ListLevelNo=[];ListLevelNo[0]="\0",ListLevelNo[1]="",ListLevelNo[2]="",ListLevelNo[3]="",ListLevelNo[4]="",ListLevelNo[5]="",ListLevelNo[6]="",ListLevelNo[7]="",ListLevelNo[8]="\b";var TCConstants={UPDATE_MODE:"update",CREATE_MODE:"create",DELETE_MODE:"delete",INSERT:"ins",DELETE:"del",UPDATE:"upd",TASK:"task",REMOVE:"remove",ACTION:"action",ZUID:"zuid",TIME:"time",TC:"tc",TC_NULL:"tc_null",ROW:"row",ALL_MARKUP_VIEW:1,NO_MARKUP_VIEW:2,ORIGINAL_MARKUP_VIEW:3,ORIGINAL_VIEW:4,ALL:1,ADDED:2,DELETED:3,ALL_FILTER:1,ADDED_FILTER:2,DELETED_FILTER:3,AUTHOR_BY_FILTER:4},LINK_TYPES={WEBURL:1,BOOKMARK:2,MAILTO:3,ZWDOC:4},EDITOR_VIEWS={EDITOR:1,HISTORY:2,PRINT_PREVIEW:3,MAILMERGE_PREVIEW:4,TEMPLATEI_EDIT:5,VERSIONVIEW:6},HEADER_FOOTER_TYPE={PRIMARY:0,DIFF_FIRST_PAGE:1,DIFF_ODD_EVEN_PAGE:2,DIFF_FIRST_ODD_EVEN_PAGE:3},WARNING_MSG={NEW_VERSION_UPLOADED:"NEW_VERSION_UPLOADED",HEADING_NOT_FOUND:"NOHEADINGFOUND",LOWER_HEADING_FOUND:"LOWER_HEADING_FOUND",CANT_DELETE_ROW:"CANT_DELETE_ROW",CANT_DELETE_COLUMN:"CANT_DELETE_COLUMN",MERGE_IS_NOT_POSSIBLE:"MERGE_IS_NOT_POSSIBLE",BOOKMARK_REMOVED:"BOOKMARK_REMOVED",UNABLE_TO_PREVIEW_TEMPLATE:"UNABLE_TO_PREVIEW_TEMPLATE",UNABLE_TO_LOAD_VERSION:"UNABLE_TO_LOAD_VERSION",UNABLE_TO_LOAD_VERSION_IN_HISTORY:"UNABLE_TO_LOAD_VERSION_IN_HISTORY",UNABLE_TO_LOAD_CONTENT_IN_MAILMERGE_PREVIEW:"UNABLE_TO_LOAD_CONTENT_IN_MAILMERGE_PREVIEW",REPLACE_NO_MATCHES_FOUND:"REPLACE_NO_MATCHES_FOUND",REPLACE_SEARCH_COMPLETED_MSG:"REPLACE_SEARCH_COMPLETED_MSG",COLUMN_WIDTH_IS_LESS:"COLUMN_WIDTH_IS_LESS"},UNITS={PIXELS:"px",MILLIMETERS:"mm",INCHES:"in",PERCENTAGE:"%"},WORD_BREAK_CHAR="[\\u0028\\u005B\\u00AB\\u2018\\u201C\\u3008\\u300A\\u300C\\u300E\\u3010\\u3014\\u3016\\u3018\\u301D\\uFF08\\uFF3B\\uFF5F\\uFF5B]*[\\u2F00-\\u30FF\\u3190-\\u319F\\u31C0-\\u3AEF\\u4E00-\\u9FCF\\uF900-\\uFAFF\\uFE10-\\uFE1F\\uFE30-\\uFE4F\\uFF00-\\uFFEF][\\u002C\\u0029\\u005D\\u00BB\\u2019\\u201D\\u3001\\u3009\\u300B\\u300D\\u300F\\u3011\\u3015\\u3017\\u3019\\u301F\\u3005\\u303B\\u30FC\\u30FD\\u30FE\\u30A1\\u30A3\\u30A5\\u30A7\\u30A9\\u30C3\\u30E3\\u30E5\\u30E7\\u30EE\\u30F5\\u30F6\\u3041\\u3043\\u3045\\u3047\\u3049\\u3063\\u3083\\u3085\\u3087\\u308E\\u3095\\u3096\\u31F0\\u31F1\\u31F2\\u31F3\\u31F4\\u31F5\\u31F6\\u31F7\\u31F8\\u31F9\\u31FA\\u31FB\\u31FC\\u31FD\\u31FE\\u31FF\\u2010\\u2013\\u301C\\u30A0\\u0021\\u002E\\u003A\\u003B\\u003F\\u203C\\u2047\\u2048\\u2049\\u3001\\u3002\\u30FB\\uFF01\\uFF1F\\uFF09\\uFF3D\\uFF5D\\uFF60]*",ARABIC_UNICODES=["\\u0600-\\u06FF","\\u0750-\\u077F","\\u08A0-\\u08FF","\\uFB50-\\uFDFF","\\uFE70-\\uFEFF"],HEBREW_UNICODES=["\\u0590-\\u05FF","\\uFB1D-\\uFB4F"],SYRIAC_UNICODES=["\\u0700-\\u074F"],SAMARATIAN_UNICODES=["\\u0800-\\u083F"],MANDAIC_UNICODES=["\\u0840-\\u085F"],RTL_UNICODES=ARABIC_UNICODES.concat(HEBREW_UNICODES).concat(SYRIAC_UNICODES).concat(SAMARATIAN_UNICODES).concat(MANDAIC_UNICODES),CJK_SYMBOLS=["\\u2F00-\\u30FF","\\u3190-\\u319F","\\u31C0-\\u3AEF","\\u4E00-\\u9FCF","\\uF900-\\uFAFF","\\uFE10-\\uFE1F","\\uFE30-\\uFE4F","\\uFF00-\\uFFEF"],STRICT_RTL_REGEX=new RegExp("^["+RTL_UNICODES.join("")+"]+$",""),STARTS_WITH_RTL_REGEX=new RegExp("^["+RTL_UNICODES.join("")+"]+(\\s{0,1}["+RTL_UNICODES.join("")+"]|.*)*$",""),STARTS_WITH_LTR_REGEX=new RegExp("^[^"+RTL_UNICODES.join("")+"]+(\\s{0,1}["+RTL_UNICODES.join("")+"])+["+RTL_UNICODES.join("")+"]*$",""),ENDS_WITH_RTL_REGEX=new RegExp("^[^"+RTL_UNICODES.join("")+"].*["+RTL_UNICODES.join("")+"]$",""),ARABIC_REGEX=new RegExp("^["+ARABIC_UNICODES.join("")+"]+$",""),WORD_BREAK_ENTITY=[" ",UNICODE.TAB,UNICODE.PARA,UNICODE.RANGE_START,UNICODE.RANGE_END,UNICODE.IMAGE,"\v","\f"],WORD_BREAK_REGEX_FOR_LINE=new RegExp(WORD_BREAK_CHAR+"|["+RTL_UNICODES.join("")+"]+(?!["+RTL_UNICODES.join("")+"])|"+("[^"+CJK_SYMBOLS.join("")+WORD_BREAK_ENTITY.join("")+"]+")+"| +\f?|[\t\n\v\f\\u000e\\u000f\\u0013]|","mg"),Themesetnames=["Default","Architecture","Bold","Brushstrokes","Bubbles","Bulletin","Chalkboard","Civil","Community","Dormitory","Elemental","Essential","Executive","Guidebook","Lightbox","Luxury","Motion","Oblique","Orbit","Perspective","Pinstripes","Pulp","Sheer","Tradition","Treasury","Universal","Watercolor"],EDITOR_MODES={COMPOSE:1,COLLABORATE:2,COMPLETE:3},ELEM_ID={EDITORPANE:"editorpane",EDITORPANEWRAPPER:"editorpane-wrapper",EDITORPANECONTAINER:"editorpane-container",EDITORRIGHTPANEL:"editor-rightPanel",EDITOROUTERDIV:"ui-editor-outer-div",MAINOUTERDIV:"mainOuterDiv",TOPBANDWRAPPER:"topband-wrapper",REVIEWRIGHTPANE:"review_Rightpane",BOTTOMBAR:"bottombar"},LAYOUTS={COMPOSE:1,COLLABORATE:2,COMPLETE:3,RICHEDIT:4,VERSIONHISTORY:5,MAILMERGEPREVIEW:6,READONLY:7,READCOMMENT:8,REMOTE:10,USERTEMPLATE:11,PRINTPREVIEW:12,VERSIONVIEW:13,HISTORYDIFFVIEW:14},ANIMATIONS={SLIDEIN:"SLIDEIN",FADEIN:"FADEIN",FLIPIN:"FLIPIN",FLIPOUT:"FLIPOUT",FADEOUT:"FADEOUT",SLIDEOUT:"SLIDEOUT"},SCROLLDIRECTION={UP:"UP",DOWN:"DOWN"},COMPONENTS_INIT_DONE=[],MAILMERGE={MMINFO:"mminfo",MMINFOS:"mminfos",FIELD_ID:"id",FIELD_NAME:"display_name",GROUP_NAME:"groupname",TYPE:"type",TYPE_IMAGE:"image",TYPE_LINK:"website",BUILD_IN_FIELD:"buildInField"},HISTORY_CONST={ACTION:"history_action",ZUID:"history_zuid",ACTION_INS:"ins",ACTION_DEL:"del",ACTION_ALL:"all"},NOTIFICATION_RULE_CONSTANTS={ALL_CHANGES:8,ALL_COMMENTS:16,NEW_COMMENTS:64,PARTICIPATED_COMMENTS:32,NO_NOTIFICATION:4},ZERO_RECT={};Object.defineProperties(ZERO_RECT,{bottom:defineWithValue(0),height:defineWithValue(0),left:defineWithValue(0),right:defineWithValue(0),top:defineWithValue(0),width:defineWithValue(0)});var PAGE_BORDER_WIDTH=is_wkhtmltopdf_browser?0:2,USER_STATS={ZW_4_STATS:"ZW_4_STATS",HMBG:"hmbg"},ZWSURVEY={KEY:"ZWSURVEY"},DEFAULT_LANGUAGE="en",LANG_CODE_TO_FULLSTR={en:"English",fr:"Franais",ja:"",zh:"",de:"Deutsch",nl:"Nederlands",it:"italiano",sv:"svenska",es:"espaol",pt:"portugus",da:"dansk",tr:"Trke",pl:"polski",ru:"",hu:"magyar",hr:"hrvatski",cs:"etina",et:"eesti keel",fi:"suomen kieli",el:"",ko:"",lt:"lietuvi kalba",no:"Norsk",ro:"limba romn",sk:"slovenina",th:"",uk:"",vi:"Ting Vit",ta:""};Object.defineProperties(window,{SEL_AUTO_GEN:defineWithValue(0),SEL_KEYBOARD:defineWithValue(1),SEL_MOUSE:defineWithValue(2),SEL_OP_GEN:defineWithValue(3)});var USER_ROLE={PUBLIC:"PUBLIC",TEMPLATE_USER:"TEMPLATE_USER",REMOTE_PUBLIC_USER:"REMOTEPUBLICUSER"},DISABLED_OPERATIONS_ONLIST=["copy","cut","paste"],IMAGELIBRARY_MAXCOUNT_TOBEUPLOAD=50,ESIGN={ADOBESIGN:"adobesign",DOCUSIGN:"docusign",SIGNEASY:"signeasy",ZOHOSIGN:"zohosign"},SHAPE={DROPCAP_FONT_COLORS_MAP:{normal:[0,0,0],greenfill:[255,255,255],bluefill:[255,255,255],dropcap1:[0,0,0],dropcap2:[255,255,255],dropcap3:[255,255,255],dropcap4:[0,0,0],dropcap5:[0,0,0],dropcap6:[106,192,105],dropcap7:[0,0,0],dropcap8:[0,0,0],dropcap9:[0,0,0],dropcap10:[165,65,24],dropcap11:[0,0,0],dropcap12:[255,255,255],dropcap13:[255,255,255],dropcap14:[255,255,255],dropcap15:[0,0,0],dropcap16:[0,0,0],dropcap17:[0,169,165],dropcap18:[0,0,0],dropcap19:[0,0,0]}},CONST_VIEW={EOP_WIDTH:14,LINE_DIV_CHILDREN:"div.spell-error,div.replace-overlay,div.float-div,div.icon-tab,div.bMark"},ZINDEX={TEXT_BACKGROUND:-2,COMMENT_HIGHLIGHT:-1},shouldNotCarryParaStyle=[ATTR_COMMON.TYPE,ATTR_PARAGRAPH.PS_HD,ATTR_PARAGRAPH.PS_TS,ATTR_PARAGRAPH.LS_DATA,ATTR_PARAGRAPH.PS_TYPE,ATTR_PARAGRAPH.TEXTFORMAT,TCConstants.TC,ATTR_PARAGRAPH.PS_CODE],shouldNotCarryTextStyle=[ATTR_COMMON.TYPE,ATTR_TEXT.TS_VA,ATTR_TEXT.CHAR_STY,TCConstants.TC],AllowedEmbedService=["SHOW","REPORTS","SHEET","YOUTUBE","SHEETCHART","SHEETCHARTIMG","SHEETEXTERNAL","SHEETINTRANET"];PubSub=function(){"use strict";var e=function(e,t,n){var r,a,s,l,d=n&&n.async||!1,c=n&&n.context||null,u=n&&n.once||!1,p=n&&n.timeout||!1,h=!1;for(r=d?o[e]||(o[e]=[]):i[e]||(i[e]=[]),s=0,l=r.length;s<l;s++)a=r[s],t===a.callback&&c===a.context&&(h=!0);h||r.push({async:d,callback:t,context:c,name:e,once:u,timeout:p})},t=function(e,t,n){var r,a=n&&n.async||!1,s=n&&n.context||null;if(r=a&&o[e]||i[e],r&&(t||s)){a?o[e]=[]:i[e]=[];for(var l,d=0;d<r.length;d++)l=r[d],t&&t!==l.callback||s&&s!==l.context?a?o[e].push(l):i[e].push(l):a&&clearTimeout(l.timer)}},n=function(e){var t=Array.prototype.slice.call(arguments,1);e.timer=setTimeout(function(){e.callback.apply(e.context,t)},e.timeout)},i={},o={},r=function(t,n,i){Array.isArray(t)&&!Array.prototype.forEach.call(t,function(t){e(t,n,i)})||e(t,n,i)},a=function(){var e=Array.prototype.slice.call(arguments),t=e[2]||{};t.once=!0,e[2]=t,r.apply(null,e)},s=function(e,n,i){Array.isArray(e)&&!Array.prototype.forEach.call(e,function(e){t(e,n,i)})||t(e,n,i)},l=function(){var e,n=Array.prototype.concat.call(o,i);for(e in n)t(e)},d=function(e){var t,r,a=Array.prototype.slice.call(arguments,1);if(r=o[e])for(t=0;t<r.length;t++)clearTimeout(r[t].timer);if(r=i[e])for(t=0;t<r.length;t++)r[t].callback.apply(r[t].context,a),r[t].once&&r.splice(t--,1);if(r=o[e])for(t=0;t<r.length;t++)n.apply(null,Array.prototype.concat.call(r[t],a))};return{allEvents:i,allAsyncEvents:o,subscribe:r,subscribeOnce:a,unsubscribe:s,unsubscribeAll:l,publish:d}}();var ZRange=function(e){"use strict";var t=function(e,t){this.start=e||0,this.end=t||this.start};return t.prototype.containsRange=function(e){return this.start<=e.start&&e.end<=this.end},t.prototype.overlapsRange=function(e){return e.start<=this.start&&this.start<=e.end||e.start<=this.end&&this.end<=e.end},t.prototype.strictlyContainsRange=function(e){return this.start<e.start&&e.end<this.end},Object.defineProperties(t.prototype,{length:{get:function(){return Math.abs(this.end-this.start)}}}),t}(window),ZDoc=function(e){"use strict";var t,n=function(e,t){var i,o=[];switch(e&&e.type){case NODE_TYPE.PARA:var r=e.getHeadingType(),a=DocUtil.copyStyle(ComputedParaStyleObject["h"+r]);a[ATTR_PARAGRAPH.PS_TS]=a.textFormat,delete a.textFormat,delete a[TCConstants.TC],i=e.getFormat(),i=Utils.mergeObjs([a,i]),t===NODE_TYPE.RUN&&(i=i[ATTR_PARAGRAPH.PS_TS]);case NODE_TYPE.RUN:i||(i=extend({},e.getFormat()),delete i[TCConstants.TC]),o.push(i),o=o.concat(n(e.getParent(),t));break;case NODE_TYPE.FIELD_START:case NODE_TYPE.FIELD_END:o.push(extend({},e.getFormat()))}return o},i=function(e){t=e},o=i.prototype;return o.getCharAt=function(e){return editor.doc.getCharAt(e)},o.getComputedFormat=function(e){if(e){var t=e.type,i=n(e,t=e.type),o=Utils.mergeObjs(i.reverse()),r=TextStyleObject[o[ATTR_TEXT.CHAR_STY]];return r&&(o=Utils.mergeObjs([r,o])),DocUtil.constructRenderingFormat(o),o}},o.getContent=function(e){return!e&&editor.doc.getContent()||e&&editor.doc.getContent(e.start,e.end)},o.getLayout=function(){return ViewManager},o.getNodeAt=function(e){var n=t.getTreeNodeAtIndex(e);if(!n||!n.children.length||n.type!==NODE_TYPE.PARA||n.getEndIndex()===e)return n;n=n.getFirstChild();do if(n.getIndex()<=e&&e<=n.getEndIndex())return n;while(n=n.getNextSibling());return n},o.getNodesInRange=function(){var e,t,n={handleNodeStart:function(n){n.isNodeType(t)&&e.push(n)},handleNodeEnd:function(e){}};return function(i,o){if(e=[],!(t=i)||!o||!o.length)return e;var r=i&&UNICODE[i.toUpperCase()];if(r){for(var a,s=new RegExp(r,"g"),l=this.getContent(o);a=s.exec(l);)e.push(this.getNodeAt(o.start+a.index));return e}return this.visitNodesInRange(o,n),e}}(),o.getSelection=function(e){return editor.doc.getSelection(e)},o.visitNodesInRange=function(){var e=function(t,n,i){if(!t||t.getIndex()>=n.end)return 0;do if(t.hasChildNodes()){var o=new ZRange(t.getIndex());if(n.end===o.start)return 0;if(n.containsRange(o)&&i.handleNodeStart(t),!e(t.getFirstChild(),n,i))return 0;if(t.type===NODE_TYPE.SECTION)return 0;n.strictlyContainsRange(new ZRange(t.getEndIndex()))&&i.handleNodeEnd(t)}else(n.overlapsRange(t.getNodeRange())||n.containsRange(t.getNodeRange()))&&i.handleNodeStart(t);while(t=t.getNextSibling());return 1};return function(t,n){if(t&&t.length&&n&&n.handleNodeStart&&n.handleNodeEnd){for(var i=this.getNodeAt(t.start);i&&!(i.getIndex()<=t.start&&t.end<=i.getEndIndex());)i=i.getParent();e(i,t,n)}}}(),i}(window),ZDocBuilder=function(){"use strict";var e=function(e){this.zdoc=e},t=e.prototype;return t.cloneNode=function(){if(!this.node)return this;var e=[{r:this.node.getIndex()}];return e=e.concat(this.node.getOps()),Op.processMsg(e),this},t.insertImage=function(){var e=[NODE_TYPE.AUTOFIELD,NODE_TYPE.BOOKMARK,NODE_TYPE.BR,NODE_TYPE.COMMENT,NODE_TYPE.ENDNOTE,NODE_TYPE.FIELD_START,NODE_TYPE.FOOTNOTE,NODE_TYPE.IFRAME,NODE_TYPE.IMAGE,NODE_TYPE.LINK,NODE_TYPE.MAILMERGEFIELD,NODE_TYPE.NEXTRECORD,NODE_TYPE.PARA,NODE_TYPE.RUN,NODE_TYPE.TAB,NODE_TYPE.TEXT],t=new RegExp("^("+e.join("|")+")$");return function(e,n){if(!this.node||!t.test(this.node.getNodeType()))return this;var i,o=[],e=extend(e||{},{type:NODE_TYPE.IMAGE}),r=Math.min(this.node.getIndex()+(n.start||0),this.node.getEndIndex()+1);return o.push({r:r}),n.length&&o.push({ds:this.node.getContent().substring(n.start,n.end)}),o.push({as:{start:e,id:i=Utils.randomString()}}),o.push({is:UNICODE.IMAGE}),o.push({as:{end:DocUtil.getKeys(e),id:i}}),Op.processMsg(o),this}}(),t.insertParagraph=function(){if(!this.node)return this;for(var e,t=this.node.getEndIndex(),n=this.node;n.getNodeType()!==NODE_TYPE.PARA;)n=n.getParent();var i=n.getFormat();i.hasOwnProperty(ATTR_PARAGRAPH.PS_HD)&&0==parseInt(i[ATTR_PARAGRAPH.PS_HD])&&delete i[ATTR_PARAGRAPH.PS_HD];var o=[{r:t},{as:{start:i,id:e=Utils.randomString()}},{is:UNICODE.PARA},{as:{end:DocUtil.getKeys(i),id:e}}];return Op.processMsg(o),this},t.getDocument=function(){return this.zdoc},t.moveToNode=function(e){return this.node=e,this},t.setFormat=function(e){if(!this.node||!e)return this;var t,e=extend(e||{},{type:this.node.isNodeType(NODE_TYPE.PARA)?NODE_TYPE.PARAGRAPH:this.node.getNodeType()}),n=[{r:this.node.getIndex()},{as:{start:e,id:t=Utils.randomString()}},{r:this.node.length},{as:{end:DocUtil.getKeys(e),id:t}}];return Op.processMsg(n),this},t.sync=function(){return this.node=null,Op.sendMsg(),this},t.removeNode=function(){var e=[{r:this.node.getIndex()},{ds:this.node.getText()}];return Op.processMsg(e),this},e}();!function(){function e(){if(!Utils.isNonEditableView()){var e=editor.doc.getBodyFormat();g=editor&&editor.doc&&e&&e[ATTR_BODY.DS_VIEW]||g,g==p&&(g=h)}}function t(){return g||(g=h),editor.getView()==EDITOR_VIEWS.HISTORY&&HistoryUI.isDiffView()?h:g}function n(e){var t=g,n=e;Utils.isNonEditableView()||(e==p&&(e=h),t!==n&&(editor.onResize(),TabHandler.updateDefaultValues()),g=e)}function i(){if(u)o();else{J("#quickFixedView,#quickPageView,#quickWebView").removeClass("statusbar_acvtive"),J("#quickFullScreen").addClass("statusbar_acvtive"),J("#toolbarContainer,#ztb-topband,#remote_topband").hide();var e={position:"absolute",top:"5px",right:"21px","z-index":1e5,display:"block"},t=J("div#fullscreen_close");t[0]?t.css(e).show():J(document.createElement("div")).appendTo(document.body).attr("id","fullscreen_close").css(e).html('<div style="border-radius: 2px; display: inline-block; padding: 3px; background:#4d4d4d ; border: 1px solid #434345;"><span class="ui-components-icon ui-icon-closethick ui-fr" style ="cursor: pointer"></span><span style="float: left; margin-top: 2px; margin-right: 10px; color: #FFF;">'+J.i18n("common","FULL_SCREEN_CLOSE")+"</span></div>").bind("click",function(){J("#fullscreen_close").hide(),editor.editorOffset=editor.jeditorPane.offset(),EditorUtil.focusMultiByteSpan()}),J("#fullscreen_close").fadeOut(1e4,function(){J(this).hide()}),editor.isEditable()&&"SHAREDREAD"!==editor.doc.getRole()&&"SHAREDREADCOMMENT"!==editor.doc.getRole()&&"ANYONELINK_SHAREDREADCOMMENT"!==editor.doc.getRole()||J("#readonlyouter").hide(),Utils.setEditorHht(),editor.editorOffset=editor.jeditorPane.offset(),u=!0}PubSub.publish("Document/FullViewHandling"),setTimeout(function(){EditorUtil.focusMultiByteSpan(),editor.doc.getSelection().select()},100)}function o(){J("div#fullscreen_close").hide(),J("#toolbarContainer,#ztb-topband,#remote_topband").show(),editor.isEditable()&&"SHAREDREAD"!=editor.doc.getRole()&&"SHAREDREADCOMMENT"!=editor.doc.getRole()&&"ANYONELINK_SHAREDREADCOMMENT"!=editor.doc.getRole()||J("#readonlyouter").show(),J("#quickFullScreen").removeClass("statusbar_acvtive");var e=t();J("#quick"+e.replace(/\s/,"")).addClass("statusbar_acvtive"),Utils.setEditorHht(),editor.editorOffset=editor.jeditorPane.offset(),u=!1}function r(){return t()==h}function a(){return t()==f}function s(){return t()==m}function l(){return u}function d(){return PrintPreview&&PrintPreview.isPrintPreview()}function c(e){var t=PageLayout.Paper.Legal.Landscape.width.pixel||0;if(!e){var n=editor.doc.getBodyFormat();t-=n[ATTR_BODY.DS_ML].convertor().pixels+n[ATTR_BODY.DS_MR].convertor().pixels}return t}var u=!1,p="Normal View",h="Fixed View",f="Page View",m="Web View",g="undefined"!=typeof w_usersettings&&w_usersettings.view||f;g==p&&(g=h),window.EditorView={initView:e,getView:t,gotoFullView:i,exitFullView:o,isFixedView:r,isPageView:a,isWebView:s,isFullView:l,isPrintView:d,width:c,setView:n}}();var Z=function(){"use strict";var e={},t=function(t,n){var i=n?J("#"+t,"#"+n):J("#"+t);return i[0]&&(e[t]=i),i},n=function(n,i){return n?e[n]?e[n]:t(n,i):J(n)};return n}();Conversions.oneInchInMM=25.4,Conversions.globalUnit=UNITS.INCHES,Conversions.init=function(){Conversions.globalUnit=w_usersettings[ATTR_BODY.DS_UN]||Conversions.globalUnit,Conversions.globalUnit===UNITS.INCHES?(Conversions.globalUnitInPx=96,Conversions.isInInches=!0,Conversions.isInMM=!1,Conversions.showUnit='"',Conversions.step=.125,Conversions.cellPaddingStep=.01,Conversions.deltaForInnerTable=.1,Conversions.defaultCellPadding="0.059in",Conversions.factor=1,Conversions.headerTopDefault="0.5in",Conversions.footerBottomDefault="0.5in",Conversions.rowHtMinValue="0.23in",Conversions.multiColumnSpacingDefault="1.0in"):Conversions.globalUnit===UNITS.MILLIMETERS&&(Conversions.globalUnitInPx=3.779527559,Conversions.isInMM=!0,Conversions.isInInches=!1,Conversions.showUnit="mm",Conversions.step=5,Conversions.cellPaddingStep=.5,Conversions.deltaForInnerTable=5,Conversions.defaultCellPadding="1.5mm",Conversions.factor=25.4,Conversions.headerTopDefault="12.250mm",Conversions.footerBottomDefault="12.250mm",Conversions.multiColumnSpacingDefault="25.4mm",Conversions.rowHtMinValue="6.08mm")},Conversions.toGlobalValue=function(e){if(e){var t=e.convertor();return Conversions.isInMM?t.millimeters.toFixed(3)+UNITS.MILLIMETERS:Conversions.isInInches?t.inches.toFixed(3)+UNITS.INCHES:void 0}},Conversions.toPixels=function(e){if(e){if(/px$/i.test(e))return parseFloat(e);var t=e.convertor();return parseFloat(t.pixels.toFixed(3))}},Conversions.toGlobalUnit=function(e){if(e)return e.indexOf("in")==-1&&Conversions.isInMM||e.indexOf("mm")==-1&&Conversions.isInInches?parseFloat(parseFloat(e).toFixed(3)):Conversions.isInMM?parseFloat((parseFloat(e)*Conversions.oneInchInMM).toFixed(3)):Conversions.isInInches?parseFloat((parseFloat(e)/Conversions.oneInchInMM).toFixed(3)):void 0},Conversions.inchToPx=function(e){return void 0==e?0:(e&&"string"==typeof e&&e.match("in")&&(e=96*parseFloat(e)),parseInt(e))},Conversions.mmToPx=function(e){return void 0==e?0:(e&&"string"==typeof e&&e.match("mm")&&(e=96*parseFloat(e)/25.4),parseInt(e))},Utils.getBottombarHeight=function(){var e=document.getElementById("bottombar"),t=document.getElementById("wmstoolbar"),n=(e&&e.offsetHeight)+(t&&t.offsetHeight);return n||0},Utils.setEditorHht=function(){var e=J("#ui-editor-outer-div");editor.doc.getRole();if(e[0]){var t=Utils.getBottombarHeight();(is_wkhtmltopdf_browser||editorProps.isEmbed||editorProps.isWebLayout)&&e.css("overflow","");var n=J(window).height()-(e.offset().top+t);if(EditorView.isWebView()&&(n-=parseFloat(e.css("borderTopWidth"))+parseFloat(e.css("borderBottomWidth"))+parseFloat(e.css("marginBottom"))),e.css("height",n),e=J("#verdetails"),e[0]&&!e.is(":hidden")){var i=n-(e.innerHeight()-e.height());e.css("height",i);var o=J("#verlist"),r=o.outerHeight(!0)-o.height(),a=e.height()-(J("#vertitle").outerHeight(!0)+J("#versionpagination").height());o.css("height",a-r)}if(e=J("#mm-list-container"),e[0]&&!e.is(":hidden")){e.css("height",J(window).height()-e.offset().top),e=J("#mm-preview-recordlisting");var s=J(window).height()-(e.offset().top+t);e.css("height",s)}if(e=J("#docprintpreview"),e[0]&&!e.is(":hidden")){var l=document.documentElement.clientHeight-e.position().top-t;e.css("height",l),t>0&&e.css("margin-bottom",t)}e=J("#modifiedusercontainer"),e.css({"margin-top":n-e.height()})}},Utils.merge=function(e,t){var n,i,o;for(i=0,n=e.length,o=t.length;i<o;i++)e[n++]=t[i];return e},Utils.scrollToEditorTop=function(){editor.editorPaneContainer.scroll(function(){var e=J("#top");if(editor.editorPaneContainer.scrollTop()>500){if(editor.isEditable()){var t=Utils.getBottombarHeight()+7;e.css("bottom",t),e.addClass("ui-scroll-to-top-anim")}}else e.removeClass("ui-scroll-to-top-anim"),e.css("bottom",0)})},Utils.arrayContains=function(){var e=Array.prototype.indexOf;return e?function(e,t){return e.indexOf(t)!=-1}:function(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]==t)return!0;return!1}}(),Utils.addArrayMethods=function(){Array.prototype.map||(Array.prototype.map=function(e,t){for(var n=new Array(this.length),i=0,o=this.length;i<o;i++)i in this&&(n[i]=e.call(t,this[i],i,this));return n}),Array.prototype.filter||(Array.prototype.filter=function(e,t){for(var n,i=[],o=0,r=this.length;o<r;o++)o in this&&e.call(t,n=this[o],o,this)&&i.push(n);return i}),Array.prototype.removeDuplicates||(Array.prototype.removeDuplicates=function(){return this.filter(function(e,t,n){return n.indexOf(e)==t})}),Array.prototype.reduce||(Array.prototype.reduce=function(e){"use strict";if(null==this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof e)throw new TypeError(e+" is not a function");var t,n=Object(this),i=n.length>>>0,o=0;if(2==arguments.length)t=arguments[1];else{for(;o<i&&!(o in n);)o++;if(o>=i)throw new TypeError("Reduce of empty array with no initial value");t=n[o++]}for(;o<i;o++)o in n&&(t=e(t,n[o],o,n));return t}),Array.from||(Array.from=function(){var e=Object.prototype.toString,t=function(t){return"function"==typeof t||"[object Function]"===e.call(t)},n=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t},i=Math.pow(2,53)-1,o=function(e){var t=n(e);return Math.min(Math.max(t,0),i)};return function(e){var n=this,i=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var r,a=arguments.length>1?arguments[1]:void 0;if("undefined"!=typeof a){if(!t(a))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(r=arguments[2])}for(var s,l=o(i.length),d=t(n)?Object(new n(l)):new Array(l),c=0;c<l;)s=i[c],a?d[c]="undefined"==typeof r?a(s,c):a.call(r,s,c):d[c]=s,c+=1;return d.length=l,d}}())}(),Utils.nodeNameEquals=function(e,t){if(!e||!t)return!1;if(t.indexOf("*")!=-1)return!0;var n=t.split("|");return Utils.arrayContains(n,e.nodeName.toLowerCase())},Utils.findPrevious=function(e,t,n,i,o){if(!t)return null;do{var r=o?t.previousSibling:DomUtil.getPreviousSibling(t);if(r)for(t=r;0!=t.childNodes.length&&!Utils.nodeNameEquals(t,n);)t=t.lastChild;else{for(;t&&!(o?t.previousSibling:DomUtil.getPreviousSibling(t));)t=t.parentNode;if(!t)return;if(Utils.nodeNameEquals(t,"body")||t.id==editor.clientActiveSection.id)return null;for(t=o?t.previousSibling:DomUtil.getPreviousSibling(t);0!=t.childNodes.length&&!Utils.nodeNameEquals(t,n);)t=t.lastChild}}while(!Utils.nodeNameEquals(t,n));return t},Utils.findNext=function(e,t,n,i,o){if(t){do{var r=o?t.nextSibling:DomUtil.getNextSibling(t);if(r)for(t=r;0!=t.childNodes.length&&!Utils.nodeNameEquals(t,n);)t=t.firstChild;else{for(;t&&!(o?t.nextSibling:DomUtil.getNextSibling(t));)t=t.parentNode;if(!t)return;if(Utils.nodeNameEquals(t,"body")||t.id==editor.clientActiveSection.id)return null;for(t=o?t.nextSibling:DomUtil.getNextSibling(t);0!=t.childNodes.length&&!Utils.nodeNameEquals(t,n);)t=t.firstChild}}while(!Utils.nodeNameEquals(t,n));return t}};var chars="abcdefghijklmnopqrstuvwxyz0123456789";Utils.randomString=function(e){for(var t=e||12,n="",i=0;i<t;i++){var o=Math.floor(Math.random()*chars.length);n+=chars.substring(o,o+1)}return n},Utils.isEmpty=function(e,t){if(!e)return!0;if(3==e.nodeType)return 0==e.nodeValue.replace(/\u200b/g,"").length;var n=CONT_REGEXP.AUTOFIELD_WITHOUT_FORMULA+"|"+NODE_TYPE.MAILMERGEFIELD+"|"+CONST.TOC_CLOSE+"|"+CONST.TOC_REGENERATE+"|"+CONST.TOC_SETTINGS+"|noteClass|seqNameClass|zohotab|noteClass|<hr";if(t||(n+="|<br"),n=new RegExp(n,"gi"),"img"==e.nodeName.toLowerCase())return!1;var i=editor.browserInfo.is_ie?e.innerText:J(e).text();if(0==i.replace(/\u200B/g,"").length){var o=Utils.getOutterHTML(e).toLowerCase(),r=J(e).find("img").not(J(e).find("."+CONST.PG_SPLIT_NODE)),a=o.match(n);return(!a||0==a.length)&&0==r.length}return!1},Utils.textLen=function(e){var t=0,n=e.nodeType;if(3==n)t+=e.nodeValue.length;else if(1==n)if(Utils.nodeNameEquals(e,"div"));else if(J(e).hasClass("zw-space"))t+=1;else if(Utils.nodeNameEquals(e,"img")&&(e.className||"").toLowerCase().indexOf("spacer")==-1)t+=1;else if(e.hasChildNodes())for(var i=e.childNodes,o=i.length,r=0;r<o;r++)t+=Utils.textLen(i[r]);return t},Utils.getAsFunction=function(e){if(e){var t,n=e.split("."),i=window,o="";return J(n).each(function(e,r){t=r.indexOf("()"),i=t>0?i[r.substring(0,t)]():i[r],e==n.length-2&&(o=i)}),{fn:i,base:o,callable:function(){i&&i.call(o,arguments[0])}}}};var escapedUnicodes={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},unicodeRegEx=/\uffff/.test("")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g;Utils.escapeSplChars=function(e){return escapedUnicodes.hasOwnProperty(e)&&escapedUnicodes[e]?escapedUnicodes[e]:e=e.replace(unicodeRegEx,function(e){var t=e.charCodeAt(0),n="\\u";return 16>t?n+="000":256>t?n+="00":4096>t&&(n+="0"),escapedUnicodes[e]=n+t.toString(16)})},Utils.compareJSON=function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var i=e[n],o=t[n];if(jQuery.isPlainObject(i)&&jQuery.isPlainObject(o)){if(!Utils.compareJSON(i,o))return!1}else if(jQuery.isArray(i)&&jQuery.isArray(o)){if(!Utils.compareArray(i,o))return!1}else if(i!==o)return!1}for(var n in t)if(t.hasOwnProperty(n)){var i=e[n],o=t[n];if(jQuery.isPlainObject(o)&&jQuery.isPlainObject(i)){if(!Utils.compareJSON(o,i))return!1}else if(jQuery.isArray(o)&&jQuery.isArray(i)){if(!Utils.compareArray(o,i))return!1}else if(o!==i)return!1}return!0},Utils.compareArray=function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if("object"==typeof e[n]&&"object"==typeof t[n]){if(!Utils.compareJSON(e[n],t[n]))return!1}else if(jQuery.isArray(e[n])&&jQuery.isArray(t[n])){if(!Utils.compareArray(e[n],t[n]))return!1}else if(e[n]!==t[n])return!1;return!0},Utils.stopEvent=function(e){editor.browserInfo.is_ie?(e.cancelBubble=!0,e.returnValue=!1):(e.stopPropagation(),e.preventDefault())},Utils.setNormalParaStyles=function(){var e=editor.doc.getParaStyles("h0"),t="",n="",i="",o=Utils.getStyle(e.textFormat).styles,r=Utils.getStyle(e).styles;for(var a in r)"margin-top"!=a&&"margin-bottom"!=a&&"line-height"!=a&&(t+=a+":"+r[a]+";\n");for(var a in o)n+=is_wkhtmltopdf_browser&&"letter-spacing"==a?a+":normal;\n":a+":"+o[a]+";\n";var s="#editorpane div.zw-paragraph,div.sl-paragraph{\n"+t+"}.paraStyle{\n"+t+"}";i="#editorpane p.zw-paragraph,p.sl-paragraph{\n"+t+"\nline-height: 1.6}";var l="#editorpane span.zw-portion,span.sl-portion{\n"+n+"}.paraStyle span{\n"+n+"} .zeroSize,.zw-br-portion {font-size: 0pt !important;} .aligntop {vertical-align: top;}",d=s+l+i,c=document.getElementById("styleforeditor");c.styleSheet&&c.styleSheet.cssText?c.styleSheet.cssText=d:J(c).text(d),Utils.setStylesInPasteFrame(d,"styleforeditor")},Utils.setStylesInPasteFrame=function(){var e=frames.pasteFrame,t=(e.document.body,DocStyleObject.para.h0),n=t.textFormat,i=["fontWeight","fontSize","fontFamily","fontStyle","color","text-decoration","backgroundColor","verticalAlign","letter-spacing","fontVariant"],o=["textAlign","textIndent","lineHeight"],r=["marginRight","marginTop","marginBottom","marginLeft","paddingLeft"],a="";for(var s in r){switch(s=r[s]){case"marginRight":var l=t[ATTR_PARAGRAPH.PS_MR]||"0in";a+="margin-right : "+l+";";break;case"marginTop":var l=t[ATTR_PARAGRAPH.PS_MT]||"0pt";a+="margin-top : "+l+";";break;case"marginBottom":var l=t[ATTR_PARAGRAPH.PS_MB]||"0pt";a+="margin-bottom : "+l+";";break;case"marginLeft":var l=t[ATTR_PARAGRAPH.PS_MB]||"0in";a+="margin-left : "+l+";";break;case"paddingLeft":var l=t[ATTR_PARAGRAPH.PS_PL]||"0in";a+="padding-left : "+l+";";break;case"paddingRight":var l=t[ATTR_PARAGRAPH.PS_PR]||"0in";a+="padding-right : "+l+";";break;case"paddingTop":var l=t[ATTR_PARAGRAPH.PS_PT]||"0in";a+="padding-top : "+l+";";break;case"paddingBottom":var l=t[ATTR_PARAGRAPH.PS_PB]||"0in";a+="padding-bottom : "+l+";"}a+="\n"}var d=" body *{ \n"+a+"}";a="";for(var s in o){switch(s=o[s]){case"textAlign":var l=TEXT_ALIGN[t[ATTR_PARAGRAPH.PS_AL]]||"left";a+="text-align : "+l+";";break;case"textIndent":var l=t[ATTR_PARAGRAPH.PS_TI]||"0in";a+="text-indent : "+l+";";break;case"lineHeight":var l=parseFloat(t[ATTR_PARAGRAPH.PS_LS])||"normal";a+="line-height : "+l+";"}a+="\n"}var c="";for(var s in i){switch(s=i[s]){case"fontWeight":var l=n[ATTR_TEXT.TS_FW]||"normal";c+="font-weight : "+l+";";break;case"fontSize":var l=n[ATTR_TEXT.TS_SIZE];c+="font-size : "+l+"pt;";break;case"fontFamily":var l=n[ATTR_TEXT.TS_FF];c+="font-family : "+l+";";break;case"fontStyle":var l=n[ATTR_TEXT.TS_FS]||"normal";c+="font-style : "+l+";";break;case"color":var l=n[ATTR_TEXT.TS_FGC]||"rgb(0, 0, 0)";c+="color : "+l+";";break;case"text-decoration":var l=n[ATTR_TEXT.TS_TD]||"none";c+="text-decoration : "+l+";";break;case"backgroundColor":var l=n[ATTR_TEXT.TS_BGC]||"transparent";c+="background-color : "+l+";";break;case"verticalAlign":var l=n[ATTR_TEXT.TS_VA]||"baseline";c+="vertical-align : "+l+";";break;case"letter-spacing":var l=n[ATTR_TEXT.TS_CS]||"0pt";c+="letter-spacing : "+l+";";break;case"fontVariant":var l=n[ATTR_TEXT.TS_FV]||"normal";c+="font-variant : "+l+";"}c+="\n"}d+=" body{ \n"+c+"\n"+a+"}";var u=J(e.document).find("style#styleforeditor"),p=u[0];if(!p){var h=e.document.head;p=Utils.createStyleTag(d),p.id="styleforeditor",h.appendChild(p)}},Utils.createStyleTag=function(e){var t=document.createElement("style");return t.type="text/css",t.styleSheet&&t.styleSheet.cssText?t.styleSheet.cssText=e:J(t).text(e),t},Utils.updateQuickStyleLabel=function(){for(var e=0,t=U.range(1,10),n=0;n<t.length;n++){var i=J(".heading"+t[n]);i.length>0&&(e=t[n])}for(var o=U.range(0===e?e+3:e+2,10),n=0;n<o.length;n++)J("#label_h"+o[n]).hide();for(var r=U.range(e<=1?3:e+2),n=0;n<r.length;n++)J("#label_h"+r[n]).show()},Utils.constructStyleText=function(e,t){var n="",i=DocUtil.copyStyle(e),o=[ATTR_PARAGRAPH.PS_SA,ATTR_PARAGRAPH.PS_SB,ATTR_PARAGRAPH.PS_LS,ATTR_COMMON.BORDERS,ATTR_PARAGRAPH.PS_ML,ATTR_PARAGRAPH.PS_PL,ATTR_PARAGRAPH.PS_TI,ATTR_PARAGRAPH.PS_AL,"textFormat"];t&&o.filter(function(e){delete i[e]});var r=Utils.getStyle(i);for(var a in r.styles)n+=is_wkhtmltopdf_browser&&"letter-spacing"==a?a+":normal;\n":a+":"+r.styles[a]+";\n";return n},Utils.getStyleText=function(e,t,n,i,o){var r,a,s,l;i?(r="#editorpane div.heading",a=" span.zw-portion",s="#editorpane .zw-paragraph",l="#editorpane span.zw-portion"):(r="p.heading",a=" span.zw-portion",l="span.zw-portion",s="p.zw-paragraph");var d="",c="";for(var u in e)if("name"!==u){var p=u.substring(1),h=Utils.constructStyleText(e[u],i);if(t){if(d+=("h0"===u?s:r+p)+"{\n",o&&!e[u].hasOwnProperty(ATTR_PARAGRAPH.PS_LS)){var f=e.h0[ATTR_PARAGRAPH.PS_LS];h+="line-height : "+f+";\n"}d+=h+"}\n",h=Utils.constructStyleText(e[u].textFormat),c+=("h0"!=u?r+p+a:l)+"{\n"}else n&&(c+="div#editorpane div.zw-paragraph span.char_sty"+u+"{\n");c+=h+"}\n"}return d+c},Utils.setDocumentStyle=function(e){e=e?e:DocStyleObject,e=DocUtil.copyStyle(e);var t=Utils.getStyleText(DocStyleObject.para,!0,!1,!0,!1),n=Utils.getStyleText(DocStyleObject.char,!1,!0,!0,!1),i=t+n+".zeroSize,.zw-br-portion { font-size: 0pt !important; } .aligntop { vertical-align: top; }",o=document.getElementById("styleforeditor");o.styleSheet&&o.styleSheet.cssText?o.styleSheet.cssText=i:J(o).text(i);var r=Utils.getStyleText(DocStyleObject.para,!0,!1,!1,!0);return Utils.setStylesInPasteFrame(r,"styleforeditor"),i},Utils.getStyle=function(e){if(!e)return null;var t={},n="",i=DomUtil.getBorderStyles(e);for(var o in e)if(e.hasOwnProperty(o)&&"type"!=o){var r=e[o];if("cls"==o)n+=" "+r;else if(o==ATTR_TEXT.TS_CS)"none"==r&&(r="normal"),i["letter-spacing"]=r;else if("st"==o&&r==NODE_TYPE.TAB)n+=" tab";else if(o==ATTR_TEXT.TS_FW)"none"==r&&(r="normal"),i["font-weight"]=r;else if(o==ATTR_TEXT.TS_FF)"none"==r&&(r=""),i["font-family"]=Utils.fontFamilyRenderingFix(r);else if(o==ATTR_TEXT.TS_FV)"none"==r&&(r=""),i["font-variant"]=r;else if(o==ATTR_TEXT.TS_FS)"none"==r&&(r="normal"),i["font-style"]=r;else if(o==ATTR_TEXT.TS_SIZE)"none"==r?i["font-size"]="":(r=parseFloat(r)+"pt",i["font-size"]=r);else if(o==ATTR_TEXT.TS_FGC)"none"==r&&(r=""),i.color=r;else if(o==ATTR_TEXT.TS_BGC)"none"==r&&(r=""),i["background-color"]=r;else if(o==ATTR_TEXT.TS_TD)"none"==r?i["text-decoration"]="none":e.cls&&"link"==e.cls&&r.indexOf("line-through")>-1?i["text-decoration"]="line-through underline":i["text-decoration"]=r;else if(o==ATTR_TEXT.TS_VA&&"none"!=r)i["vertical-align"]=r;else{if(o==ATTR_TEXT.TS_NULL){delete e[o],r&&(i={});break}o==ATTR_PARAGRAPH.PS_SB?i["margin-top"]=r:o==ATTR_PARAGRAPH.PS_DIR?i.direction=r:o==ATTR_PARAGRAPH.PS_SA?i["margin-bottom"]=r:o==ATTR_PARAGRAPH.PS_ML?i["margin-left"]=r:o==ATTR_PARAGRAPH.PS_MR?i["margin-right"]=r:o==ATTR_PARAGRAPH.PS_PL?i["padding-left"]=r:o==ATTR_PARAGRAPH.PS_PR?i["padding-right"]=r:o==ATTR_PARAGRAPH.PS_TI?i["text-indent"]=r:o==ATTR_PARAGRAPH.PS_BGC?"none"==r?i["background-color"]="":i["background-color"]=r:o==ATTR_PARAGRAPH.PS_LS?i["line-height"]=r:o==ATTR_PARAGRAPH.PS_AL&&0==r?i["text-align"]="left":o==ATTR_PARAGRAPH.PS_AL&&1==r?i["text-align"]="center":o==ATTR_PARAGRAPH.PS_AL&&2==r?i["text-align"]="right":o==ATTR_PARAGRAPH.PS_AL&&3==r?i["text-align"]="justify":o==ATTR_PARAGRAPH.PS_WS&&(i["word-spacing"]=r)}}return t.styles=i,t},function(){"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),String.prototype.capitalize=function(){return this.replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})},"function"!=typeof String.prototype.trimRight&&(String.prototype.trimRight=function(){return String(this).replace(/\s+$/,"")})}(),function(){Array.isArray||(Array.isArray=function(e){return e&&"object"==typeof e&&"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.repeat=function(e,t){for(;t;)this[--t]=e;return this},String.prototype.replaceAll=function(e,t){var n=this;return n.replace(new RegExp(e,"g"),t)}}(),Utils.createElement=function(e,t,n){var i,o,r=document.createElement(e);if(t)for(i in t)t.hasOwnProperty(i)&&(o=t[i],"class"===i?J(r).addClass(o):r.setAttribute(i,o));if(n){var a=null;a="string"==typeof n?document.createTextNode(n):n,r.appendChild(a)}return r},Utils.mergeJsonObjs=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},Utils.mergeObjs=function(e){for(var t,n,i,o={},r=e.length,a=0;a<r;a++){t=e[a];for(n in t)if(i=t[n],Utils.isPlainObject(i)&&o[n])o[n]=Utils.mergeObjs([o[n],i]);else{var s=i;if((n===ATTR_TEXT.TS_TD||n===ATTR_TEXT.CLS)&&o[n]&&o[n]!==i&&(s=o[n]+" "+i,n===ATTR_TEXT.TS_TD)){var l="";i.indexOf("none")==-1&&(s.indexOf("underline")!=-1&&(l+="underline "),s.indexOf("line-through")!=-1&&(l+="line-through")),s=l.trim()}o[n]=s}}return o},Utils.removeObjArray=function(e,t){for(var n=0;n<t.length;n++){var i=t[n];if(e==i.uuid){t.splice(n,1);break}}},Utils.setCsrfParam=function(e){csrfParamName&&(e[csrfParamName]=getcsrf())},Utils.fixForCachingInIe=function(e){if("object"!=typeof e){if(editor.browserInfo.is_ie){var t="?";return e.indexOf("?")>=0&&(t="&"),e=e+t+"fixCacheForIe="+(new Date).getTime()}return e}return editor.browserInfo.is_ie&&(e.fixForCachingInIe=(new Date).getTime()),e},Utils.replaceParams=function(e,t){if(e=J.i18n(e),"undefined"!=typeof t&&t.length>0)for(var n=0,i=t.length;n<i;n++)e=Utils.replace(e,"{"+n+"}",t[n]);return e},Utils.replace=function(e,t,n){var i=e.length,o=t.length;if(0==i||0==o)return e;var r=e.indexOf(t);if(!r&&t!=e.substring(0,o))return e;if(r==-1)return e;var a=e.substring(0,r)+n;return r+o<i&&(a+=Utils.replace(e.substring(r+o,i),t,n)),a},Utils.checkNetworkID=void 0,Utils.retryNetwork=function(){Utils.log("RETRY NETWORK CALLED");var e=function(){clearTimeout(Utils.checkNetworkID),Utils.checkNetworkID=void 0,ZWOffline.isOfflineSetupDone?window.isOfflineRequest&&!ZWOffline.wmsRegistered?ZWOffline.fetchSessionId(ZWOffline.networkUp):ZWOffline.networkUp():PubSub.publish("System/NetworkUp")},t=function(){clearTimeout(Utils.checkNetworkID),Utils.checkNetworkID=void 0,Utils.checkNetworkID=setTimeout(Utils.retryNetwork,5e3)};Utils.checkNetwork(e,t)},Utils.checkNetwork=function(e,t){Utils.log("CHECK NETWORK CALLED"),J.ajax({url:Utils.getNetworkCheckUrl(),success:function(){e()},error:function(){t()}})},Utils.getNetworkCheckUrl=function(){var e=window.location.protocol+"//"+editor.docsServerURL+"/images";return"REMOTE"==editor.getEditorType()&&(e=window.location.origin+"/writer/images/common"),e+"/favicon.ico?nocache="+J.now()},Utils.getUserImageURL=function(e){var t="";return t=ZWOffline.isOfflineSetupDone&&editor.isOffline()||!e||e&&"$"==e.toString().charAt(0)?window.commonimgStaticURL+"images/common/icon-user.png":contactServer+"/file?ID="+e+"&fs=thumb"},Utils.getOutterHTML=function(e){if(editor.browserInfo.is_ie)return e.outerHTML;var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML},Utils.encodeHTMLChars=function(){var e={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&#34;"};return function(t){return e[t]||t}}(),Utils.encodeHTMLString=function(e){for(var t="",n=0,i=e.length;n<i;n++)t+=Utils.encodeHTMLChars(e[n]);return t},Utils.isEncodeHTMLChar=function(e){return"<"==e||">"==e||"&"==e||'"'==e},Utils.prevScrollTime=null,Utils.scrollTimer=200,Utils.scrollElementIntoView=function(e,t,n){var i=J.Deferred(),o=!1;if(!e||!e.parentNode)return i.resolve(o),o;var r=0,a=0,s=!1,l=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start");l&&e==l[0]?(s=!0,r=CurUtil.offset.start.top,offsetLeft=CurUtil.offset.start.left,a=parseFloat(l[0].style.height)):(r=PUtil.offsetTop(e),offsetLeft=PUtil.offsetLeft(e),a=PUtil.offsetHeight(e)),r*=editor.zoomFactor,offsetLeft*=editor.zoomFactor,a*=editor.zoomFactor;var d,c,u=editor.editorPaneContainer,p=u.height(),h=u.width(),f=50*editor.zoomFactor,m=u[0].scrollTop,g=u[0].scrollLeft,T={};if(r>m?(r+=a,f=n?p-a:f,d=r-(m+p),d>-50*editor.zoomFactor&&(o=!0,T.scrollTop=m+d+f)):(d=r-m,d<0&&(o=!0,T.scrollTop=m+d-f)),offsetLeft>g?(c=offsetLeft-(g+h),c>-50*editor.zoomFactor&&(o=!0,T.scrollLeft=g+c+f)):(c=offsetLeft-g,c<0&&(o=!0,T.scrollLeft=g+c-f)),o){if(!t&&s){var _=(new Date).getTime();(!Utils.prevScrollTime||_-Utils.prevScrollTime>300)&&(t=Utils.scrollTimer,Utils.prevScrollTime=_)}"number"!=typeof t&&(t=10),void 0===T.scrollTop&&(t=0),u.animate(T,t,function(){setTimeout(function(){i.resolve(o)},t+50)})}else i.resolve(o);return i},Utils.resetURL=function(e){e=e||editor.getBaseURL(),e&&(window.location.href=e)},Utils.resetCollabVariables=function(){ZWCollaboration.stopUpdates=!1,ZWCollaboration.msgQueue.empty(),ZWCollaboration.syncSent=!1,ZWCollaboration.serverupInvoked=!1,ZWCollaboration.timeOutVal=void 0},Utils.reloadDocumentContent=function(){var e=function(){var t=editor.doc.getParents(NODE_TYPE.PARAGRAPH,1);editor.doc.getSelection().moveTo(t,!0);var n=editor.doc.getTrackChangeDetails();editor.doc.getTrackChangeDetails().getIsReviewPage()||n.getDisplayMode()===TCConstants.ORIGINAL_VIEW?editor.setEditable(!1):editor.setEditable(!0),PubSub.unsubscribe("Document/LoadingStart",e)};PubSub.subscribe("Document/LoadingStart",e),editor.fetchDocument(Utils.getDocumentId(),"")},Number.prototype.convertor=function(){return{inches:this.valueOf(),pixels:this.valueOf(),centimeters:this.valueOf(),millimeters:this.valueOf(),points:this.valueOf(),picas:this.valueOf()}},String.prototype.convertor=function(){var e=parseFloat(this),t={inches:e,pixels:e,centimeters:e,millimeters:e,points:e,picas:e};if(!/^[-+0-9]/.test(this)||!/px|in|cm|mm|pt|pc$/i.test(this))return t;var n=96;return/px$/i.test(this)?(t.inches*=1/n,t.centimeters*=2.54/n,t.millimeters*=25.4/n,t.points*=72/n,t.picas*=864/n):/in$/i.test(this)?(t.centimeters*=2.54,t.millimeters*=25.4,t.points*=72,t.picas*=864,t.pixels*=n):/cm$/i.test(this)?(t.inches*=1/2.54,t.millimeters*=10,t.points*=72/2.54,t.picas*=864/2.54,t.pixels*=n/2.54):/mm$/i.test(this)?(t.inches*=1/25.4,t.centimeters*=.1,t.points*=72/25.4,t.picas*=864/25.4,t.pixels*=n/25.4):/pt$/i.test(this)?(t.inches*=1/72,t.centimeters*=2.54/72,t.millimeters*=25.4/72,t.picas*=12,t.pixels*=n/72):/pc$/i.test(this)&&(t.inches*=1/864,t.centimeters*=2.54/864,t.millimeters*=25.4/864,t.points*=1/12,t.pixels*=n/864),t},Array.prototype.contains=function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return!0;return!1},Utils.isRTL=function(e){return"string"==typeof e&&(STARTS_WITH_RTL_REGEX.test(e)||STARTS_WITH_LTR_REGEX.test(e)||ENDS_WITH_RTL_REGEX.test(e))},Utils.isStrictRTL=function(e){if("string"!=typeof e)return!1;var t=!1;if(Utils.isRTL(e)&&(t=STRICT_RTL_REGEX.test(e),!t))for(var n=0,i=e.length;n<i;n++)t=Utils.areNeutralCharacters(e.charAt(n))||t;return t},Utils.isArabic=function(e){if("string"!=typeof e)return!1;var t=!1;if(Utils.isRTL(e)&&(t=ARABIC_REGEX.test(e),!t))for(var n=0,i=e.length;n<i;n++)t=Utils.areNeutralCharacters(e.charAt(n))||t;return t},Utils.areNeutralCharacters=function(e){return"string"==typeof e&&/^[-!$%^&*@()_+|#~=`{}\[\]:";'<>?,.\\\/0-9\f\r\n\v\x20\u00A0\u000e\u000f\u0013]+$/.test(e)},Utils.sendErrorDetails=function(e,t){var n={},i={},o={parentIsTable:!1,parentIsComment:!1,parentIsLink:!1,activeSection:""},r={},a={},s="",l=editor.doc.getSelection(),d=l&&l.getStart();try{s=Proofing.getLanguage(),commentError=CommentModels.lastError?JSON.stringify(CommentModels.lastError):{},o.parentIsTable=!(!d||!editor.doc.getParents(NODE_TYPE.TABLE,d)),o.parentIsComment=!(!d||!editor.doc.getParents(NODE_TYPE.COMMENT,d)),o.parentIsLink=!(!d||!editor.doc.getParents(NODE_TYPE.LINK,d)),o.activeSection=editor.clientActiveSection?editor.clientActiveSection.className:"";var c=editor.doc.getTrackChangeDetails();r.isEnabled=c.isEnabled()+"",r.displayMode=TcUtil.getDisplayMode(),a.isOfflineSetupDone=ZWOffline.isOfflineSetupDone,a.isCurrentSessionOffline=editor.isOffline()}catch(e){}var u=Utils.shrinkOperationSequence(ZWCollaboration.operationSequence);i.cursorDetails=o,i.tcDetails=r,i.language=s,i.commentError=commentError,i.offlineDetails=a,i.operationSequence=u.slice(u.length-50),CommentModels.lastError=null,U.extend(i,t),n.addinfo=JSON.stringify(i),n.content=e,"REMOTE"===editor.getEditorType()&&(n.rsid=RemoteEditor.rsid),Utils.setCsrfParam(n),J.ajax({type:"POST",global:!1,url:Utils.getUtilUrl(),async:!0,data:n,dataType:"json",error:function(){},success:function(t){e&&e.indexOf("FORMAT_MISSING")!=-1&&location.reload()}})},Utils.getSharedUserStatus=function(){var e={};Utils.setCsrfParam(e),J.ajax({type:"POST",global:!1,url:Utils.getNiceUrlPrefix(editor.doc.getDocInfo().RID+"/util/users"),async:!1,data:e,dataType:"json",error:function(){},success:function(e){if("SUCCESS"===e.RESPONSE){for(var t=e.USER_DETAILS,n=0;n<t.length;n++){var i=t[n];CollabListHandler.userStatus[i.ZUID]=i,CollabListHandler.userStatus=Utils.mergeObjs([editor.doc.getUserData(),CollabListHandler.userStatus])}CollabListHandler.userStatus=Utils.mergeObjs([editor.doc.getUserData(),CollabListHandler.userStatus])}}})},Utils.getDocumentSharedUsers=function(){var e={},t=null;return Utils.setCsrfParam(e),J.ajax({type:"POST",global:!1,url:Utils.getNiceUrlPrefix(editor.doc.getDocInfo().RID+"/util/sharedusers"),async:!1,data:e,dataType:"json",error:function(){},success:function(e){"FAILED"!==e.RESPONSE&&(t=e)}}),t?(U.each(t,function(e){e.val=e.emailid,e.fullname=e.fullname?e.fullname:e.emailid}),t.users):[]},Utils.getDocumentSharedUsersWithContacts=function(e){var t={};Utils.setCsrfParam(t),J.ajax({type:"POST",url:Utils.getNiceUrlPrefix(editor.doc.getDocInfo().RID+"/util/shareduserswithcontacts"),data:t,dataType:"json",error:function(){e([])},success:function(t){if("FAILED"!==t.RESPONSE){var n=t.users;U.each(n,function(e){e.val=e.emailid,e.fullname=e.fullname?e.fullname:e.emailid}),n=U.uniq(n,function(e){return e.emailid}),e(n)}else e([])}})},Utils.pxToPt=function(e){return.75*parseFloat(e)+"pt"},Utils.getDocumentId=function(){var e="REMOTE"!=editor.getEditorType()?editor.doc.getDocInfo().RID:RemoteEditor.rsid;return e},Utils.isValidImage=function(e){return/\.(gif|jpg|jpeg|bmp|png)$/i.test(e)},Utils.isImage=function(e){var t=e&&(e.value||e.name||"");return/\.(gif|jpg|jpeg|bmp|png)$/i.test(t)},Utils.isSupportedDocument=function(e){return/\.(wordprocessingml|html|openxmlformats|msword|macroEnabled|opendocument|plain)$/i.test(e)},Utils.removeWordFromArray=function(e,t){var n=J.inArray(e,t);t.splice(n,1)},Utils.escapeSelectorId=function(e){return e.replace(/(!|"|#|\$|%|\'|\(|\)|\*|\+|\,|\.|\/|\:|\;|<|=|>|\?|@|&|\[|\]|\^|`|\{|\||\}|~|\s)/g,function(e,t){return"\\"+t})},Utils.triggerNotification=function(){if("REMOTE"!=editor.getEditorType()){var e={};e.rid=editor.doc.getDocInfo().RID,e.contentEdited=ZWCollaboration.contentEdited,e.startingVersion=ZWCollaboration.startingVersion,Utils.setCsrfParam(e),J.post(Utils.getNiceUrlPrefix("user/settings/notificationrule"),e,function(){ZWCollaboration.contentEdited=void 0,ZWCollaboration.startingVersion=void 0})}};var browser_ie=!1,browser_ie6=!1,browser_nn4=!1,browser_nn6=!1;document.all&&window.navigator.userAgent.toUpperCase().indexOf("IE")>=0?(browser_ie=!0,navigator.appVersion.indexOf("6.0")>-1&&(browser_ie6=!0)):document.layers?browser_nn4=!0:(document.layers||!document.all&&document.getElementById)&&(browser_nn6=!0),String.prototype.splitWithIndex=function(e){for(var t=[],n=this.split(e),i=0,o=0;o<n.length;o++)t.push([i,n[o]]),i+=n[o].length+e.length;return t},Utils.hiliteText=function(e){var t=J("div.zw-page").css("background-color");if(e){EditorUtil.focusMultiByteSpan(),document.designMode="on";var n=document.getElementsByTagName("body")[0];for(var i in e){var o=e[i];if(o&&!editor.browserInfo.is_ie){for(;window.find(o,!1);){if(document.execCommand("BackColor",!1,"yellow"),window.getSelection){var r,a=window.getSelection();a.collapseToEnd()}else document.selection&&document.selection.createRange&&(r=document.selection.createRange(),r.execCommand("BackColor",!1,colour));document.execCommand("HiliteColor",!1,"yellow")||document.execCommand("BackColor",!1,"yellow")}window.getSelection().collapse(n,0)}}document.designMode="off",EditorUtil.focusMultiByteSpan(),J("div.zw-page").css("background-color",t)}},Utils.isEditableMode=function(){return!(!editor.isEditable()||"SHAREDREADCOMMENT"==editor.doc.getRole()||"ANYONELINK_SHAREDREADCOMMENT"==editor.doc.getRole()||editor.doc.getRole()==USER_ROLE.PUBLIC||editor.getView()==EDITOR_VIEWS.HISTORY||editor.getView()==EDITOR_VIEWS.MAILMERGE_PREVIEW||Utils.isVersionView())},Utils.getUrl=function(e){var t=Utils.getDocumentId();return"REMOTE"==editor.getEditorType()?url="rdoc":"ANYONEWITHLINK"==editor.getEditorType()?url="anyone":"WRITER_GDRIVE"===docProps.info.SERVICE_NAME?url="zwgd":url="doc",url="/writer/"+url+"/docoperation/"+t+"/"+e,url},Utils.getContextUrl=function(e){return"/writer/"+e},Utils.getNiceUrlPrefix=function(e){return Utils.getContextUrl("v1/web/"+e)},Utils.getUtilUrl=function(){return"REMOTE"==editor.getEditorType()?Utils.getNiceUrlPrefix("rdoc/util/"+editor.doc.docInfo.DOCUMENT_ID+"/errorlog"):Utils.getNiceUrlPrefix(editor.doc.getDocInfo().RID+"/util/errorlog")};var enableConsole=!1;Utils.log=function(e,t){var n=editor.doc.getDocInfo();25==n.REVISION&&1!=n.VERSION&&(ZWCollaboration.clientInfo="",ZWCollaboration.mailInfo="");var i="\n"+(new Date).toLocaleString()+"->"+e+"| DocId ="+Utils.getDocumentId()+" Doc Len ="+editor.doc.getDocumentLength()+"|CUR:"+n.VERSION+"."+n.REVISION,o=editor.doc.getSelection();o&&(i+="|Selection: "+o.toIntervals().join("|")),ZWCollaboration.clientInfo+=i,t&&(ZWCollaboration.mailInfo+="\n"+(new Date).toLocaleString()+"->"+t),enableConsole&&console&&console.log(i)},Utils.recordAction=function(e){U.each(Op.cursor,function(t,n,i){e+=(0===n?"[":",")+"("+t.start+","+t.end+")"+(n===i.length-1?"]":"")}),ZWCollaboration.operationSequence.push(e)},Utils.shrinkOperationSequence=function(e){for(var t=[],n=null,i=0,o=0;o<e.length;o++){n=e[o],++i;var r=e[o+1];n!=r&&(i>1&&(n=n+"("+i+")"),t.push(n),i=0)}return t},Utils.getMomentFmt=function(e){var t={yyyy:"YYYY","M/d/yy":"M/D/YY","dd/MM/yyyy":"DD/MM/YYYY","dd.MM.yyyy":"DD.MM.YYYY","M.d.yy":"M.D.YY","M/d/yyyy":"M/D/YYYY","MMM. d, yy":"MMM. D, YY","MMMM, yy":"MMMM, YY","MMM-yy":"MMM-YY","MMMM d, yyyy":"MMMM D, YYYY","d-MMM-yy":"D-MMM-YY","d MMMM yyyy":"D MMMM YYYY","d MMM YYYY":"D MMM YYYY","d MMMM, yyyy":"D MMMM, YYYY","d/M/yy":"D/M/YY","d/M/yyyy":"D/M/YYYY","d-M-yyyy":"D-M-YYYY","yyyy-M-d":"YYYY-M-D","dddd, MMMM d, y":"dddd, MMMM D, YYYY","yyyy-MM-dd":"YYYY-MM-DD","yyyy/MM/dd":"YYYY/MM/DD","HH:mm":"HH:mm","HH:mm:ss":"HH:mm:ss","h:mm am/pm":"h:mm A","h:mm:ss am/pm":"h:mm:ss A","M/d/yy h:mm am/pm":"M/D/YY h:mm A","M/d/yy h:mm:ss am/pm":"M/D/YY h:mm:ss A","M/d/yy HH:mm:ss":"M/D/YY HH:mm:ss","d/M/yyyy HH:mm:ss":"D/M/YYYY HH:mm:ss"},n=t[e];return n},Utils.checkListHandler=function(e){var t,n,i=e.data.state,o=e.data.node;n=DocUtil.copyStyle(editor.doc.getRawFormatAt(o.getEndIndex())),n[ATTR_PARAGRAPH.LS_DATA].state=i?0:1,t=editor.doc.getSelection().parents(NODE_TYPE.PARAGRAPH),t.attr(n),Op.sendMsg(),e.preventDefault(),e.stopPropagation(),EditorUtil.focusMultiByteSpan()},Utils.updatePageDivsMarginLeft=function(){if(!EditorView.isWebView()){var e=(J(document).width()-20-290-editor.doc.getPaperWidth(!0))/2;e<10&&(e=10),editor.jeditorPane.css("padding-left",e),editor.jeditorPane.find("div.zw-page").css("margin-left",0)}},Utils.resetPageDivsMarginLeft=function(){EditorView.isWebView()||(editor.jeditorPane.css("padding-left",0),editor.jeditorPane.find("div.zw-page").css("margin-left","auto"),editor.onResize())},Array.prototype.get=function(e,t){for(var n=0,i=this.length;n<i;n++)if(t(this[n],e))return this[n];return null},Utils.handleDeafaultAutoCorrects=function(e,t){if(w_usersettings[ATTR_BODY.DS_PREF]&&1==w_usersettings[ATTR_BODY.DS_PREF]){var n=w_usersettings[ATTR_BODY.DS_AUTOCORRECTS]||"{}";try{n=jQuery.parseJSON(n)}catch(e){n={}}if(n[e]&&1===n[e].tobeEnabled){var i=n[e].value||null,o=editor.doc.createElement(NODE_TYPE.TEXT,e),r=editor.doc.getSelection().getStart()-e.length,a=editor.doc.getSelection().getStart(),s=editor.doc.getSelection().textFormat,l=editor.doc.getRawFormatAt(r)||{};if(l&&"OFF"==l[ATTR_TEXT.TS_AUTO_COREECT])return delete l[ATTR_TEXT.TS_AUTO_COREECT],delete s[ATTR_TEXT.TS_AUTO_COREECT],void editor.doc.setFormatAt(r,l);o.setStart(r),o.setEnd(a);var d=editor.doc.createElement(NODE_TYPE.TEXT,i);d.setStart(r),d.setEnd(r+i.length);var c=DocUtil.copyStyle(s);return c[ATTR_TEXT.TS_AUTO_COREECT]="ON",delete s[ATTR_TEXT.TS_AUTO_COREECT],editor.doc.execCmd("replace",[o,d,!0]),editor.doc.setFormatAt(r,c),Utils.stopEvent(t),!1}}},Utils.correctDayAndMonths=function(e){if(parseInt(w_usersettings[ATTR_BODY.DS_AUTOCAPSDAYS])){var t=editor.doc.getSelection().getWord(),n=t.getStart(),i=t.getEnd();if(i-n===e.length&&editor.doc.getCharAt(n)!==e.indexOf(0)){var o=editor.doc.createElement(NODE_TYPE.TEXT,editor.doc.getCharAt(0)),r=editor.doc.getSelection().textFormat,a=editor.doc.getRawFormatAt(n)||{};if(a&&"OFF"==a[ATTR_TEXT.TS_AUTO_COREECT])return delete a[ATTR_TEXT.TS_AUTO_COREECT],delete r[ATTR_TEXT.TS_AUTO_COREECT],void editor.doc.setFormatAt(n,a);o.setStart(n),o.setEnd(n+1);var s=editor.doc.createElement(NODE_TYPE.TEXT,e.charAt(0));s.setStart(n),s.setEnd(n+1);var l=DocUtil.copyStyle(r);l[ATTR_TEXT.TS_AUTO_COREECT]="ON",delete r[ATTR_TEXT.TS_AUTO_COREECT],editor.doc.execCmd("replace",[o,s,!0]),editor.doc.setFormatAt(n,l)}}},Utils.clearFormatPainterData=function(){editor.doc.paintFormat_dblClick=!1,editor.doc.paintFormat={},editor.jeditorPane.find("div.zw-page").css("cursor","")},Utils.unbindCapitalizeNamesOfDaysShortcut=function(){if(editor.isEditable()&&"SHAREDREADCOMMENT"!==editor.doc.getRole()&&"ANYONELINK_SHAREDREADCOMMENT"!=editor.doc.getRole()){var e=DefaultAutoCorrects.getDefaultAutoCorrects(),t=editor.doc.getBodyFormat(),n=t[ATTR_BODY.DS_SPLANG];if(!n)return;var i=[];0===n.indexOf("en")?(i=DocUtil.getKeys(e.en.days),i=i.concat(DocUtil.getKeys(e.en.months))):0===n.indexOf("de")&&(i=DocUtil.getKeys(e.gr.days),i=i.concat(DocUtil.getKeys(e.gr.months)));for(var o=0,r=i.length;o<r;o++)Mousetrap.unbind(i[o])}},Utils.bindCapitalizeNamesOfDaysShortcut=function(){if(editor.isEditable()&&"SHAREDREADCOMMENT"!==editor.doc.getRole()&&"ANYONELINK_SHAREDREADCOMMENT"!==editor.doc.getRole()){var e,t,n,i,o,r=DefaultAutoCorrects.getDefaultAutoCorrects(),a=editor.doc.getBodyFormat(),s=a[ATTR_BODY.DS_SPLANG];if("locale"==s&&(s=Proofing.getLanguage()),!s)return;if(0===s.indexOf("en")){e="en",t=r[e].days;for(n in t)Mousetrap.bind(n,function(e,t){Utils.correctDayAndMonths(DefaultAutoCorrects.getDefaultAutoCorrects().en.days[t])},"keypress");i=r[e].months;for(o in i)Mousetrap.bind(o,function(e,t){Utils.correctDayAndMonths(DefaultAutoCorrects.getDefaultAutoCorrects().en.months[t])},"keypress")}else if(0===s.indexOf("de")){e="gr",t=r[e].days;for(n in t)Mousetrap.bind(n,function(e,t){Utils.correctDayAndMonths(DefaultAutoCorrects.getDefaultAutoCorrects().gr.days[t])},"keypress");i=r[e].months;for(o in i)Mousetrap.bind(o,function(e,t){Utils.correctDayAndMonths(DefaultAutoCorrects.getDefaultAutoCorrects().gr.months[t])},"keypress")}}},Utils.commonElementsInArray=function(e,t){var n,i,o=e.length,r=t.length,a=[];for(n=0;n<o;n++)for(i=0;i<r;i++)e[n]===t[i]&&a.push(e[n]);return a},Utils.getTransformedSize=function(e,t,n){var i,o=[],r=[],e=parseFloat(e),i=e*(Math.PI/180),a=0,s=0,l=0,d=n,c=t,u=n,p=t,h=0,f=t/2,m=n/2,g=Math.cos(i),T=Math.sin(i);o[0]=l*g-d*T+f*(1-g)+m*T,r[0]=l*T+d*g+m*(1-g)-f*T,o[1]=c*g-u*T+f*(1-g)+m*T,r[1]=c*T+u*g+m*(1-g)-f*T,o[2]=p*g-h*T+f*(1-g)+m*T,r[2]=p*T+h*g+m*(1-g)-f*T,o[3]=a*g-s*T+f*(1-g)+m*T,r[3]=a*T+s*g+m*(1-g)-f*T,o.sort(function(e,t){return e-t}),r.sort(function(e,t){return e-t});var _=o[3]-o[0],E=r[3]-r[0];return{width:_,height:E}},Utils.goToLink=function(){var e=editor.doc.getParents(NODE_TYPE.LINK,editor.doc.getSelection().getStart()-1);if(e){var t=e.attr(ATTR_LINK.LINK_TYPE);if(t===LINK_TYPES.BOOKMARK){var n=e.attr(ATTR_LINK.LINK_URL),i=/^http(s)?:\/\/.*\..*/i,o=/^www\..*\..*/i;if(i.test(n)||o.test(n))o.test(n)&&(n=editor.scheme+"://"+n),Utils.safeWindowOpen(decodeURI(n));else{var r=!0;Utils.moveToBookmark(n,r)}}else{var a=e.attr(ATTR_LINK.LINK_URL);Utils.safeWindowOpen(a)}}return!1},Utils.imageGoToLink=function(){var e=editor.doc.getSelection(),t=e.lastRange();t&&t.setStart(e.getStart()+1)&&t.setEnd(e.getEnd()+1);var n=editor.doc.getParents(NODE_TYPE.LINK,editor.doc.getSelection().getStart()-1);if(n){var i=n.attr(ATTR_LINK.LINK_TYPE);if(i===LINK_TYPES.BOOKMARK){var o=n.attr(ATTR_LINK.LINK_URL),r=/^http(s)?:\/\/.*\..*/i,a=/^www\..*\..*/i;if(r.test(o)||a.test(o))a.test(o)&&(o=editor.scheme+"://"+o),Utils.safeWindowOpen(decodeURI(o));else{var s=!0;Utils.moveToBookmark(o,s)}}else{var l=n.attr(ATTR_LINK.LINK_URL);Utils.safeWindowOpen(decodeURI(l))}}return!1},Utils.removeAllLinks=function(){var e=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.LINK);e.length&&editor.doc.execCmd("Unlink",e)},Utils.isLeadSurrogateChar=function(e){return/[\uD800-\uDBFF]/.test(e)},Utils.isTrailSurrogateChar=function(e){return/[\uDC00-\uDFFF]/.test(e)},Utils.setBGColor=function(e){editor.doc.execCmd("BackColor",e),this.addToStatistics("QuickBackColor")},Utils.componentToHex=function(e){var t=e.toString(16);return 1==t.length?"0"+t:t},Utils.hexToRgb=function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,n,i){return t+t+n+n+i+i});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n=n?"rgb("+parseInt(n[1],16)+","+parseInt(n[2],16)+","+parseInt(n[3],16)+")":null},Utils.rgbToHex=function(e){if(0===e.indexOf("#"))return e;var t="(",n=")",i=e.substring(e.indexOf(t)+t.length,e.lastIndexOf(n)),o=i.split(",");return"#"+Utils.componentToHex(parseInt(o[0]))+Utils.componentToHex(parseInt(o[1]))+Utils.componentToHex(parseInt(o[2]))},Utils.addScrRes=function(){var e=window.screen.availHeight,t=window.screen.availWidth;if(1920==t&&1080==e){var n="Unknown OS";navigator.appVersion.indexOf("Win")!=-1?n="Windows":navigator.appVersion.indexOf("Mac")!=-1?n="MacOS":navigator.appVersion.indexOf("X11")!=-1?n="UNIX":navigator.appVersion.indexOf("Linux")!=-1&&(n="Linux"),Utils.addToStatistics("Res_"+n+"_"+t+"x"+e)}},Utils.addToStatistics=function(e){return editor.statistics?(editor.statistics[e]||(editor.statistics[e]=0),void(editor.statistics[e]+=1)):void(editor.statistics={})},Utils.safeWindowOpen=function(e,t,n){var i=[];for(var o in t)t.hasOwnProperty(o)&&i.push(o+"="+t[o]);n=n||"";var r=(i.join(","),window.open("about:blank",n,i)),a=new RegExp("^(http|https|mailto:)","i");a.test(e)||(e=editor.scheme+"://"+e);var s=new RegExp("^mailto:","i");return s.test(e)||(r.opener=null),r.location.href=e,r.document.close(),!1},Utils.isPlainObject=function(e){return jQuery.isPlainObject(e)},Utils.strToVar=function(e){e=e.substring(1);for(var t,n=e.match(/(\w)+/g),i=0;i<n.length;i++)t=t?t[n[i]]:window[n[i]];return t},Utils.getColorAfterTint=function(e,t){t/=100;var n=e.substring(e.indexOf("(")+1,e.lastIndexOf(")")).split(/,\s*/),i=Utils.rgbToHsl(parseInt(n[0]),parseInt(n[1]),parseInt(n[2]));i[2]=i[2]*t+(1-t);var o=Utils.hslToRgb(i[0],i[1],i[2]);return"rgb("+o[0]+","+o[1]+","+o[2]+")"},Utils.getColorAfterShade=function(e,t){var n=e.substring(e.indexOf("(")+1,e.lastIndexOf(")")).split(/,\s*/),i=Utils.rgbToHsl(parseInt(n[0]),parseInt(n[1]),parseInt(n[2]));i[2]=i[2]*(parseInt(t)/100);var o=Utils.hslToRgb(i[0],i[1],i[2]);return"rgb("+o[0]+","+o[1]+","+o[2]+")"},Utils.hslToRgb=function(e,t,n){var i,o,r;if(0==t)i=o=r=n;else{var a=function(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e},s=n<.5?n*(1+t):n+t-n*t,l=2*n-s;i=a(l,s,e+1/3),o=a(l,s,e),r=a(l,s,e-1/3)}return[Math.round(255*i),Math.round(255*o),Math.round(255*r)]},Utils.rgbToHsl=function(e,t,n){e/=255,t/=255,n/=255;var i,o,r=Math.max(e,t,n),a=Math.min(e,t,n),s=(r+a)/2;if(r==a)i=o=0;else{var l=r-a;switch(o=s>.5?l/(2-r-a):l/(r+a),r){case e:i=(t-n)/l+(t<n?6:0);break;case t:i=(n-e)/l+2;break;case n:i=(e-t)/l+4}i/=6}return[i,o,s]},Utils.getWordBreakIndex=function(e,t,n){e=e||1,n=n||editor.doc.contStr,WORD_BREAK_REGEX_FOR_LINE.lastIndex=e;for(var i,o=[];(i=WORD_BREAK_REGEX_FOR_LINE.exec(n)[0])&&(e+=i.length,!(t&&e>t));)o.push(e),WORD_BREAK_REGEX_FOR_LINE.lastIndex=e;return o},Utils.binarySearch=function(e,t,n){if(!e||!e.length)return null;for(var i=0,o=e.length-1,r=null;i<=o;){var a=parseInt((i+o)/2);r=e[a];var s=t(r,n);if(s<0)i=a+1;else{if(!(s>0))break;o=a-1}}return r},Utils.findNextIndexOf=function(e,t,n){t=t?t:0;var i=RegExp(e,"g");i.lastIndex=t;var o=i.exec(n),r=-1;if(o&&(r=o.index),r>=0){if(t>r){var a=new Error(ZWCollaboration.API_NEGATIVE_IDX);throw editor.lastError=a,a}return r}return-1},Utils.findPreviousIndexOf=function(e,t,n){var i,o,r,a,s,l;if(t=t&&t>0?t:0,i=RegExp(e,"g"),o=i.exec(n),!o)return-1;for(r=0,i.lastIndex=0,s=0,l=n.length+1;s+1<l;)a=parseInt((s+l)/2),i.lastIndex=a,o=i.exec(n),o?(s=a,i.lastIndex=a):(l=a,i.lastIndex=s);return o=i.exec(n),o.index},Utils.getTocEnd=function(e,t,n){return Utils.getEnd(e,[UNICODE.TOCEND],t,n)},Utils.getEnd=function(e,t,n,i){if(0===e){var o=new Error(ZWCollaboration.TABLE_API_IDX_ERR);throw editor.lastError=o,o}var r,a=0;n||(n=editor.doc.getSectionEnd(e));for(var s="",l=0,d=t.length;l<d;l++)s+="|"+t[l];for(var c=Utils.findNextIndexOf(UNICODE.TABLE+"|"+UNICODE.TABLEEND+s,e,i);c>0&&c<n;){var u=i.charAt(c);if(u==UNICODE.TABLE)r=TableUtil.getTableEnd(c+1),r<0?(c++,a++):c=r+1;else if(u===UNICODE.TABLEEND||t.contains(u))return c;c=Utils.findNextIndexOf(UNICODE.TABLE+"|"+UNICODE.TABLEEND+s,c,i)}return-1},Utils.getColorReference=function(e){var t=["light1","dark1","light2","dark2","accent1","accent2","accent3","accent4","accent5","accent6"],n="";return!e.baseColor&&e.index>0?n="zw"+t[e.index]:e.baseColor&&e.index>0?(n="zw"+t[e.index],n+="lighten"==e.mode?"/":"*",n+=100-100*parseFloat(e.percentage)):n=e.color,n},Utils.getColorValFromRefString=function(e){var t=/[z][w](\w|\*|\/)+/,n=/\#(\w|\*|\/)+/,i=t.test(e),o=n.test(e);if(!i&&!o)return e;var r=t.exec(e),a=n.exec(e),s=e,l=i?r[0].substr("zw".length):a[0].substr("#".length);if(l.indexOf("accent")>-1||l.indexOf("dark")>-1||l.indexOf("light")>-1){var d=null,c=null,u=null;l.indexOf("*")>-1?(d=l.split("*")[0],c=parseInt(l.split("*")[1])):l.indexOf("/")>-1?(d=l.split("/")[0],u=parseInt(l.split("/")[1])):d=l,d=Theme.color[d],s=c||u?c?Utils.getColorAfterShade(d,c):Utils.getColorAfterTint(d,u):d}return s},Utils.getElementStyleAsJSON=function(e){if(!e)return{};for(var t=e.style,n={},i=t.length,o=0;o<i;o++){var r=t.item(o);n[r]=t[r]}return n},Utils.generateReports=function(){var e=editor.doc.getDocInfo();editor.statistics.charLen=editor.doc.contStr.length,editor.statistics.isShared=e.ISSHARED?1:0,editor.statistics.isCommentInDocument=CommentModels.commentCollection.length?1:0,editor.statistics.isPublished=e.PUBLISH_SCOPE?1:0,editor.statistics.share_any_one=e.ISSHARED&&!e.PUBLISH_SCOPE?1:0;var t=editor.browserInfo.platform||"UnknownPlatform";Utils.addToStatistics(t);var n=editor.browserInfo.browserName||"UnknownBrowser";Utils.addToStatistics(n)},Utils.showNameOnHoverInDiff=function(e,t,n){if(n&&n.fgc&&n.userName){var i='<div class="callout-con"><div class="callout user_name" style="background-color:'+n.fgc+";border:1px solid "+n.fgc+';color:white;font-weight:bold;"></div><div class="callout-outer" style="border-top-color:'+n.fgc+'"><div class="callout-inner" style="border-top:5px solid '+n.fgc+';display:none;"></div></div></div>',o=J(i).appendTo(e).find(".user_name").text(n.userName).end();J(t).mouseover(function(){var e=PUtil.offset(this,this.parentNode).left-editor.contentpaneOffset.left;o.show().css({left:e,position:"absolute"})}).mouseout(function(){o.hide()})}},Utils.isEmptyHeader=function(){var e,t,n,i=DocTreeManager.doc.sections,o=i.length,r=!0,a=editor.doc.bodyFormat.hf_type;for(a||(a=0),e=0;e<o-1;e++)0===a?i[e].name.indexOf("header_odd")!==-1&&(t=DocTreeManager.doc.sections[e].start,n=DocTreeManager.doc.sections[e].end):1===a?i[e].name.indexOf("header_odd")===-1&&i[e].name.indexOf("header_first")===-1||(t=DocTreeManager.doc.sections[e].start,n=DocTreeManager.doc.sections[e].end):2===a?i[e].name.indexOf("header_odd")===-1&&i[e].name.indexOf("header_even")===-1||(t=DocTreeManager.doc.sections[e].start,n=DocTreeManager.doc.sections[e].end):3===a&&i[e].name.indexOf("header")!==-1&&(t=DocTreeManager.doc.sections[e].start,n=DocTreeManager.doc.sections[e].end),n-t>2&&(r=!1);return r},Utils.isEmptyFooter=function(){var e,t=DocTreeManager.doc.sections,n=t.length,i=!0,o=editor.doc.bodyFormat.hf_type;o||(o=0);var r,a;for(e=0;e<n-1;e++){if(0===o){if(t[e].name.indexOf("footer_odd")!==-1)var r=DocTreeManager.doc.sections[e].start,a=DocTreeManager.doc.sections[e].end}else if(1===o){if(t[e].name.indexOf("footer_odd")!==-1||t[e].name.indexOf("footer_first")!==-1)var r=DocTreeManager.doc.sections[e].start,a=DocTreeManager.doc.sections[e].end}else if(2===o){if(t[e].name.indexOf("footer_odd")!==-1||t[e].name.indexOf("footer_even")!==-1)var r=DocTreeManager.doc.sections[e].start,a=DocTreeManager.doc.sections[e].end}else if(3===o&&t[e].name.indexOf("footer")!==-1)var r=DocTreeManager.doc.sections[e].start,a=DocTreeManager.doc.sections[e].end;a-r>2&&(i=!1)}return i},Utils.isEquivalentObject=function(e,t){var n=Object.getOwnPropertyNames(e),i=Object.getOwnPropertyNames(t);if(n.length!=i.length)return!1;for(var o=0,r=n.length;o<r;o++){var a=n[o];if(e[a]!==t[a])return!1}return!0},Utils.getEqualElements=function(e){var t,n,i,o;for(t=e.length,n=[],i=0;i<t;i++)for(o=i;o<t-1;o++)e[i]===e[o+1]&&(n.indexOf(e[i])===-1&&n.push(e[i]),n.indexOf(e[o+1])===-1&&n.push(e[o+1]));return n},Utils.getKeyWithSameValue=function(e,t){var n=[];e.length;for(var i in e)e[i]==t&&n.push(i);return n},Utils.getTimeFromNow=function(e){return moment(parseInt(e)).fromNow()},Utils.titleCase=function(e){for(var t=e.toLowerCase().split(" "),n=0;n<t.length;n++)t[n]=t[n].charAt(0).toUpperCase()+t[n].substring(1);return t.join(" ")},Utils.getLanguageFullString=function(e){return LANG_CODE_TO_FULLSTR[e]||""},Utils.isSupportedLanguage=function(e){return LANG_CODE_TO_FULLSTR.hasOwnProperty(e)},Utils.getAllSupportedLanguages=function(){var e=[];for(var t in LANG_CODE_TO_FULLSTR)e.push(LANG_CODE_TO_FULLSTR[t]);return e},Utils.perFormanceTime={},Utils.startTime=function(e){Utils.perFormanceTime[e]||(Utils.perFormanceTime[e]={}),Utils.perFormanceTime[e].startTime=new Date},Utils.endTime=function(e){return Utils.perFormanceTime[e]&&Utils.perFormanceTime[e].startTime?(new Date-Utils.perFormanceTime[e].startTime)/1e3:0},Utils.getUniqueElemsOfMultiDimArray=function(e){for(var t=[],n={},i=0,o=e.length;i<o;i++){var r=JSON.stringify(e[i]);n[r]||(t.push(e[i]),n[r]=!0)}return t},Utils.getCurrentTypingDirection=function(e){e||(e="start");var t,n,i=editor.doc.getSelection(),n=i.getNodesInSelection(NODE_TYPE.PARAGRAPH),o=n.length;return"start"==e?para=n[0]:para=n[o-1],t=para.attr(ATTR_PARAGRAPH.PS_DIR),void 0==t&&(t="ltr"),t},Utils.addId=function(e,t,n){return t=t||"",e.id=t+Utils.randomString(n),e},Utils.isHistoryView=function(){return editor.getView()===EDITOR_VIEWS.HISTORY},Utils.isVersionView=function(){return editor.getView()===EDITOR_VIEWS.VERSIONVIEW},Utils.isNonEditableView=function(){return U.contains([EDITOR_VIEWS.HISTORY,EDITOR_VIEWS.MAILMERGE_PREVIEW,EDITOR_VIEWS.PRINTPREVIEW,EDITOR_VIEWS.VERSIONVIEW],editor.getView())},Utils.fontFamilyRenderingFix=function(e){if(e&&"string"==(typeof e).toLowerCase()&&"none"!=e){for(var t=e.split(","),n=0,i=t.length;n<i;n++)t[n]=t[n].trim(),t[n].indexOf(" ")!=-1&&(t[n]="'"+t[n]+"'");e=t.join(",")}return e},Utils.invertColor=function(e){var t=e;return t=t.substring("#".length),t=parseInt(t,16),t^=16777215,t=t.toString(16),t=("000000"+t).slice(-6),t="#"+t},Utils.getUnsupportedFonts=function(){var e=[],t=editor.doc.getBodyFormat();return U.each([t.theme.font.major.latin,t.theme.font.minor.latin],function(t){U.each(Utils.stringToFonts(t),function(t){Utils.isUnsupportedFont(t)&&e.push(t)})}),U.each(editor.doc.getFormats(),function(t){t&&U.each(Utils.stringToFonts(t[ATTR_TEXT.TS_FF]),function(t){Utils.isUnsupportedFont(t)&&e.push(t)})}),e=U.unique(e)},Utils.addId=function(e,t,n){return t=t||"",e.id=t+Utils.randomString(n),e},Utils.isUnsupportedFont=function(e){return!e||!(U.contains(editor.defaultFonts,e.toLowerCase())||Utils.isWebFont(e))},Utils.isWebFont=function(e){for(var t=e&&e.split(",")||[],n=t.length;n--;)if(editor.getWebFont(t[n]))return!0;return!1},Utils.stringToFonts=function(e){var t=[];return U.each(e&&("string"==typeof e&&e.split(/[\s]*,[\s]*/g)||(e.length?e:[])),function(e){e&&!t.contains(e)&&t.push(e)}),t},Utils.getThemeFonts=function(e){return Utils.stringToFonts(e.font.minor.latin+","+e.font.major.latin)},Utils.convertCropDataToPercentage=function(e,t,n){var i={};return i.cropTop=(e.cropTop/t*100).toFixed(3)+"%",i.cropBottom=(e.cropBottom/t*100).toFixed(3)+"%",i.cropLeft=(e.cropLeft/n*100).toFixed(3)+"%",i.cropRight=(e.cropRight/n*100).toFixed(3)+"%",i},Utils.convertCropDataToPixel=function(e,t,n){var i={};return i.cropTop=parseFloat(e.cropTop)/100*t,i.cropBottom=parseFloat(e.cropBottom)/100*t,i.cropLeft=parseFloat(e.cropLeft)/100*n,i.cropRight=parseFloat(e.cropRight)/100*n,i},Utils.getOrginalHeighWidthOfImage=function(e){var t={};if(e&&e.cropRect){var n=e.cropRect,i=100-(parseFloat(n.cropTop)+parseFloat(n.cropBottom)),o=100-(parseFloat(n.cropLeft)+parseFloat(n.cropRight));t.wid=(100*e.wid/o).toFixed(3),t.ht=(100*e.ht/i).toFixed(3)}else t.ht=e.ht,t.wid=e.wid;return t},Utils.getBorderSize=function(e){var t=e[ATTR_COMMON.BORDERS],n=0,i=0,o=0,r=0;return t&&(n=t[ATTR_BORDERS.BORDER_TOP]&&parseFloat(t[ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH])||0,i=t[ATTR_BORDERS.BORDER_LEFT]&&parseFloat(t[ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.WIDTH])||0,o=t[ATTR_BORDERS.BORDER_RIGHT]&&parseFloat(t[ATTR_BORDERS.BORDER_RIGHT][ATTR_BORDERS.WIDTH])||0,r=t[ATTR_BORDERS.BORDER_BOTTOM]&&parseFloat(t[ATTR_BORDERS.BORDER_BOTTOM][ATTR_BORDERS.WIDTH])||0),{"border-top":n,"border-bottom":r,"border-right":o,"border-left":i}},Utils.clone=function(e){var t;if(null==e||"object"!=typeof e)return e;if(Array.isArray(e)){t=[];for(var n=0,i=e.length;n<i;n++)t[n]=Utils.clone(e[n]);return t}if(Utils.isPlainObject(e)){t={};for(var o in e)e.hasOwnProperty(o)&&(t[o]=Utils.clone(e[o]));return t}return t},Utils.unescapeHTML=function(e){return J("<textarea />").html(e).val()};var editor,XFormMap=function(e){"use strict";var t=function(){this.map={}};return t.prototype.applyOp=function(e){if(!e||!e.length())return e;for(var t in this.map){var n=DocOpBuilder.xform(e,this.map[t]);this.map[t]=DocOpBuilder.concise(n.second)}},t.prototype.disableAutoUpdate=function(){PubSub.unsubscribe("Document/AfterModelUpdation",this.applyOp,{context:this})},t.prototype.enableAutoUpdate=function(){PubSub.subscribe("Document/AfterModelUpdation",this.applyOp,{context:this})},t.prototype.flushOp=function(e){this.map={}},t.prototype.getOp=function(e){return this.map[e]},t.prototype.putOp=function(e,t){this.map[t]=e},t.prototype.removeOp=function(e){delete this.map[e]},t}();EditorUtil=function(){},EditorUtil.focusMultiByteSpan=function(e){if(editor.jMbSpan_editableSpan&&editor.jMultiByteSpan){editor.isCompositionEventStart||EditorUtil.updateMultiByteSpanLeft();var t=editor.jMbSpan_editableSpan;if(t[0].focus(),editor.browserInfo.isWebkit||editor.browserInfo.isGecko||editor.browserInfo.isPresto){t.html("&nbsp;");var n=document.createRange();n.selectNodeContents(t[0]);var i=window.getSelection();i.removeAllRanges(),e&&n.collapse(!0),i.addRange(n)}else{t.html("&#8203;");var n=document.body.createTextRange();n.moveToElementText(t[0]),n.select(n.collapse(!1))}}},EditorUtil.updateMultiByteSpanLeft=function(){editor.jMultiByteSpan.css({left:editor.editorPaneContainer.scrollLeft()/editor.zoomFactor,"z-index":0})},EditorUtil.positioningMultiByteSpan=function(){var e=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start").css("visibility","hidden"),t=J("#cursorSpan"),n=editor.doc.getSelection(),i=n.getComputedTextFormat(),o=n.getFirstRange(),r=o.getStartPortionData(),a=r.node,s=r.line,l=s.parent;if(!t[0]){var d=i[ATTR_TEXT.TS_BGC]||J(a).css("background-color");d&&"transparent"!=d||(d=editor.doc.bodyFormat[ATTR_BODY.DS_BGC]),t=J(document.createElement("span")).attr("id","cursorSpan").css("color",d),DomUtil.placeNode(a.firstChild,r.cursorPos,t[0])}var c;if(jQuery.isEmptyObject(i))(c=J(a).attr("style"))&&editor.jMbSpan_editableSpan.attr("style",c);else{DomUtil.setStyle(editor.jMbSpan_editableSpan[0],i);var u=n.getParaFormat();u&&editor.jMultiByteSpan.css("line-height",u[ATTR_PARAGRAPH.PS_LS])}var p=editor.doc.getRawFormatAt(l.getEndIndex())||{},h=(editor.doc.bodyFormat[ATTR_BODY.DS_ML]||0).convertor().pixels+(p[ATTR_PARAGRAPH.PS_ML]||0).convertor().pixels;width=0,JparentTD=J(a).closest("td.zw-td"),JparentTD[0]?(width=JparentTD.width(),h=PUtil.offsetLeft(JparentTD[0])):width=editor.doc.getPaperWidth()-(p[ATTR_PARAGRAPH.PS_ML]||0).convertor().pixels,editor.jMultiByteSpan.css({left:h,top:CurUtil.offset.start.top||0,height:s.height,width:width,"z-index":16});var e=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start")||jQuery(),f=(e.offset()||ZERO_RECT).left-(editor.jeditorPane.offset()||ZERO_RECT).left;editor.jMbSpan_editableSpanOrigTextIndet=f/editor.zoomFactor-h,editor.jMbSpan_editableSpan.css("text-indent",editor.jMbSpan_editableSpanOrigTextIndet)},EditorUtil.flushContents=function(e){if(EventHandler.multiByteTyping){var t=editor.jMbSpan_editableSpan,n=e&&e.data||e&&e.detail&&e.detail.data||t.html();if(n){editor.jMultiByteSpan.css({top:CurUtil.offset.start.top,left:editor.editorPaneContainer.scrollLeft()/editor.zoomFactor,"z-index":0,width:"100px"});var i=n.replace(/\u200b/gi,"");i=i.replace(/&nbsp;/gi," "),i=i.replace(/&amp;/gi,"&"),i=i.replace(/&lt;/gi,"<"),i=i.replace(/&gt;/gi,">"),i=i.replace(/<br>/gi,""),editor.addChar(i),t.removeAttr("style").html(""),editor.editorPaneContainer[0].scrollTop=CurUtil.scrollTop,EventHandler.multiByteTyping=!1,J("#cursorSpan").remove()}}},EditorUtil.setHTML=function(e){var t,n,i=J("#cursorSpan");i.html(e&&e.data||editor.jMbSpan_editableSpan.html()),t=editor.doc.getSelection().getParaFormat()||{},1==t[ATTR_PARAGRAPH.PS_AL]?n=parseFloat(editor.jMbSpan_editableSpanOrigTextIndet)-i.width()/2:2==t[ATTR_PARAGRAPH.PS_AL]&&(n=parseFloat(editor.jMbSpan_editableSpanOrigTextIndet)-i.width()),n&&editor.jMbSpan_editableSpan.css("text-indent",n)},EditorUtil.joinCollaboration=function(){Utils.log("JOIN COLLABORATION CALLED");var e={wmssessionid:ZWCollaboration.getWMSSessionId(),rid:editor.doc.getDocInfo().RID};"REMOTE"==editor.getEditorType()&&(e.rsid=RemoteEditor.rsid),csrfParamName&&(e[csrfParamName]=getcsrf()),J.ajax({type:"POST",global:!1,url:Utils.getUrl("join"),async:!0,data:e,dataType:"json",error:function(e){if(500===e.status&&e.responseText.search("1891")!==-1)return void(window.location.href="/writer/jsp/error.jsp?errorCode=1891")}})},EditorUtil.isCursorInHeaderFooter=function(){if(!editor.clientActiveSection)return!1;var e=editor.clientActiveSection.className;return e.indexOf("zw-contentpane")===-1&&e.indexOf("zw-footnotepane")===-1&&e.indexOf("zw-endnotepane")===-1},EditorUtil.isClipboardWebInstalled=function(){if(!editor.browserInfo.is_chrome)return!1;var e;return(e=chrome.app.getDetails())&&"Zoho Clipboard"===e.name||!1},EditorUtil.isZohoWriterChromeAppInstalled=function(){if(!editor.browserInfo.is_chrome)return!1;var e;return(e=chrome.app.getDetails())&&"Zoho Writer"===e.name||!1},EditorUtil.showTableOperationControls=function(e){if("SHAREDREADCOMMENT"!==editor.doc.getRole()&&"ANYONELINK_SHAREDREADCOMMENT"!==editor.doc.getRole()&&editor.doc.getSelection().isCollapsed()){var t=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start").parents("td.zw-td");if(t.closestParent(editor.clientActiveSection)[0]){var n=t.offset(),i=editor.jTdVerticalControler,o=editor.jTdHorizantalControler;o.css({"z-index":15,left:n.left+t.width()*editor.zoomFactor/2-o.width()/2-editor.editorOffset.left,top:n.top-editor.editorOffset.top-o.height()/2}).show(),i.css({"z-index":15,left:n.left-i.width()/2-editor.editorOffset.left,top:n.top-editor.editorOffset.top-i.height()/2+t.height()*editor.zoomFactor/2}).show()}}},Doc=function(){this.paintFormat={},this.paintFormat_dblClick=!1;Array.prototype.slice;this.locks=null,this.bucket=new BucketArray;var e={};return{createRange:function(e,t,n){return new ZWRange(e,t,n)},createSelection:function(t){return t&&!e.hasOwnProperty(t)&&(e[t]=new ZWSelection(t)),e[t]},removeSelection:function(t){t&&e.hasOwnProperty(t)&&(e[t].removeAllRanges(),delete e[t])},getSelection:function(t){return t=t||editor.uuid,e[t]||null},getAllSelections:function(){return e},contStr:"",bucket:new BucketArray,formats:[],bodyFormat:{},domCursor:{},ranges:{},docInfo:{},role:"OWNER",zuid:"",locks:this.locks,lastAction:{},isHiddenMarkersEnabled:!1,isHighLighterOn:!1,userData:{},collabUsers:[],getDefaultFontSizeList:function(){return[8,9,10,11,12,14,16,18,24,36,48,58,70]},tcDetails:window.TrackChangeDetails,getTrackChangeDetails:function(){return this.tcDetails},setTrackChangeDetails:function(e){this.tcDetails=e},createDomCursor:function(e,t){if(!e)return editor.doc.domCursor;var t=t?t:editor.zuid,n=this.domCursor[e];return n||(this.domCursor[e]={},this.domCursor[e].start={node:"",idx:"",cursor:""},this.domCursor[e].end={node:"",idx:"",cursor:""},this.domCursor[e].zuid=t),this.domCursor.bgColor||(this.domCursor[e].bgColor=editor.doc.getUserData()[t]?editor.doc.getUserData()[t].color:"black"),editor.doc.domCursor},setDomCursor:function(e,t,n,i,o,r){t=t?t:"start",e=e?e:editor.uuid,o=o?o:editor.zuid,this.domCursor[e][t].node=n,this.domCursor[e][t].idx=i,this.domCursor[e][t].cursor||r||J(CurUtil.createCursor(t,e,o)),this.domCursor[e].zuid=o,this.domCursor[e].bgColor||(this.domCursor[e].bgColor=editor.doc.getUserData()[o].color)},getDomCursorNode:function(e,t,n){n=n?n:"start",e=e?e:editor.uuid,this.domCursor[e]||editor.doc.createDomCursor(e,t);var i;if(this.domCursor[e]&&this.domCursor[e][n]&&(i=this.domCursor[e][n].cursor),i||(i=editor.jeditorPane.children("div#z-cursor-"+n+"-"+e),i[0]))return i},setDomCursorNode:function(e,t,n){t=t?t:"start",e=e?e:editor.uuid;var i=this.domCursor[e];i||this.createDomCursor(),this.domCursor[e][t].cursor=n},getDomCursorIdx:function(e,t){return t=t?t:"start",e=e?e:editor.uuid,this.domCursor[e][t].idx},setDomCursorIdx:function(e,t,n){t=t?t:"start",e=e?e:editor.uuid,this.domCursor[e][t].idx=n},getCursorPortionNode:function(e,t){return t=t?t:"start",e=e?e:editor.uuid,this.domCursor[e][t].node},setCursorPortionNode:function(e,t,n){t=t?t:"start",e=e?e:editor.uuid,this.domCursor[e][t].node=n},getContent:function(e,t){var n=this.contStr.substring(e,t);if(e<0||t<0||t<e){Utils.log("_"+ZWCollaboration.API_NEGATIVE_IDX+"_API_NEGATIVE_IDX_ doc.getContent("+e+", "+t+")");var i=new Error(ZWCollaboration.API_NEGATIVE_IDX);throw editor.lastError=i,i}return n},getSelectedContent:function(){var e=this.getSelection();return this.getContent(e.getStart(),e.getEnd())},getContentIterator:function(e,t){if(e=e||0,t=t||this.getDocumentLength(),"undefined"==typeof Intl||"undefined"==typeof Intl.v8BreakIterator){var n=1;return{next:function(){return e++<t?n++:-1}}}var i=new Intl.v8BreakIterator(["en"],{type:"character"});return i.adoptText(editor.doc.getContent(e,t)),i},setZuid:function(e){this.zuid=e},getDocInfo:function(){return this.docInfo},setDocInfo:function(e){var t;for(t in e)this.docInfo[t]=e[t]},getRole:function(){return this.role},setRole:function(e){this.role=e},getUserData:function(e){var t=this.userData;if(!e)return t;var n,i;for(n in t)if((i=t[n])&&(i.uuids||"").indexOf(e)!==-1)return i.zuid=n,i},setUserData:function(e){this.userData=e},updateUserData:function(e,t){e&&t&&(this.userData[e]=t)},removeUserData:function(e){e&&this.userData[e]&&delete this.userData[e]},getDocumentContent:function(){return this.contStr},getDocumentLength:function(){return this.contStr.length},getHeaderType:function(){return this.bodyFormat[ATTR_BODY.DS_HF_TYPE]},getListObj:function(e){if("undefined"==typeof e)return null;var t=this.getBodyFormat().listFormat[e];return"number"==typeof t&&(t=LIST_STYLE_OBJECT[t]),DocUtil.copyStyle(t)},getRawFormatAt:function(e){if(e<0){Utils.log("_"+ZWCollaboration.API_NEGATIVE_IDX+"_API_NEGATIVE_IDX_ doc.getRawFormatAt("+e+")");var t=new Error(ZWCollaboration.API_NEGATIVE_IDX);throw editor.lastError=t,t}return this.bucket.get(e)},getRawComputedTextFormatAt:function(e){var t=DocUtil.copyStyle(this.getRawFormatAt(e));if(!U.isEmpty(t)){var n=editor.doc.getParents(NODE_TYPE.PARAGRAPH,e).attr(ATTR_PARAGRAPH.PS_HD),i=OrigDocStyleObject.para["h"+(n?n:"0")].textFormat;t=Utils.mergeObjs([i,t])}return t},getThemeStyleFormatAt:function(e){var t=DocUtil.copyStyle(this.getRawFormatAt(e));return DocUtil.constructRenderingFormat(t),t},getComputedFormatAt:function(e,t){if(!t){Utils.log("getComputedFormatAt Invoked without type");var n=new Error(ZWCollaboration.OP_APPLYTO_ERROR);throw editor.lastError=n,n}var i=DocUtil.copyStyle(this.getRawFormatAt(e));if(!i||U.isEmpty(i)){if(t!=NODE_TYPE.TEXT&&t!=NODE_TYPE.PARAGRAPH)return{};t===NODE_TYPE.TEXT&&(i=DocUtil.getTextStyle(e))}else if(i.type&&i.type!=NODE_TYPE.TEXT&&i.type!=NODE_TYPE.PARAGRAPH)return i;if(t==NODE_TYPE.TEXT){var o=arguments[2]?arguments[2]:0,r=ComputedParaStyleObject["h"+o].textFormat;i.type==NODE_TYPE.PARAGRAPH&&(i=i[ATTR_PARAGRAPH.PS_TS]||{},i.type=NODE_TYPE.TEXT),i=Utils.mergeObjs([r,i])}else if(t===NODE_TYPE.PARAGRAPH){var a=DocTreeManager.getParents(NODE_TYPE.PARAGRAPH,e);i=DocUtil.getParaFormat(a.getEndIndex())}return i.hasOwnProperty(ATTR_TEXT.CHAR_STY)&&DocUtil.updateWithCharStyle(i),DocUtil.constructRenderingFormat(i),i},setFormatAt:function(e,t){if(e<0){Utils.log("_"+ZWCollaboration.API_NEGATIVE_IDX+"_API_NEGATIVE_IDX_ doc.setFormatAt("+e+")");var n=new Error(ZWCollaboration.API_NEGATIVE_IDX);throw editor.lastError=n,n}this.bucket.set(e,t)},createSection:function(e,t,n,i,o,r,a,s,l,d){return new Section(e,t,n,i,o,r,a,s,l,d)},isSectionStart:function(e){var t=this.getCharAt(e);return 0==e||t==UNICODE.SECTION_START},getSectionStart:function(e){var t=this.contStr.lastIndexOf(UNICODE.SECTION_START,e-1);return t=t<0?0:t},getSectionEnd:function(e){var t=e;this.getCharAt(e)!=UNICODE.SECTION_START&&(t=this.getSectionStart(e));var n=this.contStr.indexOf(UNICODE.SECTION_START,t+1);return n=n<0?this.getDocumentLength():n},getSectionContent:function(e){var t=e;this.isSectionStart(e)||(t=this.getSectionStart(e)),t++;var n=this.getSectionEnd(t+1);return this.getContent(t,n)},getCharAt:function(e){if(e<0){Utils.log("_"+ZWCollaboration.API_NEGATIVE_IDX+"_API_NEGATIVE_IDX_ doc.getCharAt("+e+")");var t=new Error(ZWCollaboration.API_NEGATIVE_IDX);throw editor.lastError=t,t}return this.contStr.charAt(e)},getParents:function(e,t){var n,i=null,o={};if(e==NODE_TYPE.BODY){var r=this.createElement(e,{});return r}if(e==NODE_TYPE.TEXT){var a=t,s=DocUtil.getTextStyleStart(a-1),l=DocUtil.getTextStyleEnd(a+1);l&&(l=this.getSectionEnd(a));var d=this.getContent(s,l),c=this.createElement(NODE_TYPE.TEXT,d);return c.setStart(s),c.setEnd(l-1),c}if(e==NODE_TYPE.IMAGE){var u=editor.doc.getRawFormatAt(t),p=null;return this.getCharAt(t)==UNICODE.IMAGE&&(p=this.createElement(e,u),p.setStart(t),p.setEnd(t+1)),p}if(e==NODE_TYPE.IFRAME){var u=editor.doc.getRawFormatAt(t),h=null;return this.getCharAt(t)!=UNICODE.IMAGE||u.type!=ATTR_WIDGET.WIDGET&&!NODE_TYPE.IFRAME||(h=this.createElement(e,u),h.setStart(t),h.setEnd(t+1)),h}if(e==NODE_TYPE.BR){var u=editor.doc.getRawFormatAt(t),f=null;return this.getCharAt(t)==UNICODE.BR&&(f=this.createElement(e,u),f.setStart(t),f.setEnd(t+1)),f}if(e==NODE_TYPE.TABLE)return n=DocTreeManager.getParents(e,t),n&&(o.dtNode=n,i=this.createElement(e,o),i.setStart(n.getIndex()),i.setEnd(n.getEndIndex()+1)),i;if(e==NODE_TYPE.ROW)return n=DocTreeManager.getParents(e,t),n&&(o.dtNode=n,i=this.createElement(e,o),i.setStart(n.getIndex()),i.setEnd(n.getEndIndex()+1)),i;if(e==NODE_TYPE.CELL)return n=DocTreeManager.getParents(e,t),n&&(i=this.createElement(e,n),i.setStart(n.getIndex()),i.setEnd(n.getEndIndex()+1)),i;if(e==NODE_TYPE.PARAGRAPH)return n=DocTreeManager.getParents(e,t),n&&(i=this.createElement(e,n),i.setStart(n.getIndex()),i.setEnd(n.getEndIndex()+1)),i;if(e==NODE_TYPE.HR){var m=this.createElement(e),g=t;if(editor.doc.getCharAt(t)!=UNICODE.HR&&(g=editor.doc.findNextIndexOf(UNICODE.HR,t)),g<0)return;return m.setStart(g),m.setEnd(g+1),m}if(e==NODE_TYPE.SECTION){var t=editor.doc.getSelection().getStart(),T=editor.doc.getSectionStart(t),_=editor.doc.getSectionEnd(T),E=editor.doc.getRawFormatAt(T),v=E.st||E.type,S=this.createSection(v,this.getContent(T+1,_),E.sid);return S.setStart(T),S.setEnd(_),S}if(e==NODE_TYPE.PLACEHOLDER||e==NODE_TYPE.COMMENT||e==NODE_TYPE.LINK||e==NODE_TYPE.AUTOFIELD){var b=DocUtil.getFloatElementRange(e,t);if(b){var E=editor.doc.getRawFormatAt(b.end-1)||{},R=e==NODE_TYPE.COMMENT||e==NODE_TYPE.PLACEHOLDER?this.createElement(e,{sectionId:E.id}):this.createElement(e,{});return R.setStart(b.start),R.setEnd(b.end),R}}return null},getBodyFormat:function(){return this.bodyFormat},getFormats:function(){return this.bucket.getFormats()},setBodyFormat:function(e){var t=editor.doc.getRole()==USER_ROLE.PUBLIC;for(var n in e){var i=e[n];t&&n==ATTR_BODY.DS_VIEW&&"Page View"==i?this.bodyFormat[n]="Fixed View":this.bodyFormat[n]=i}},createElement:function(e,t){return ElementBuilder.createElement(e,t)},findNextIndexOf:function(e,t){var n,i=this.getDocumentContent();return n=Utils.findNextIndexOf(e,t,i)},findPreviousIndexOf:function(e,t){var n,i=editor.doc.getContent(0,t);return n=Utils.findPreviousIndexOf(e,t,i)},getTextStyles:function(e){var t={};return t=e?DocUtil.copyStyle(TextStyleObject[e]):DocUtil.copyStyle(TextStyleObject)},getParaStyles:function(e){var t={};return e?t=DocUtil.copyStyle(ParaStyleObject[e]):(t=DocUtil.copyStyle(ParaStyleObject),delete t.name),t},getCodeStyles:function(){return{code:DocUtil.copyStyle(ParaStyleObject.code)}},getQuoteStyles:function(){return{quote:DocUtil.copyStyle(ParaStyleObject.quote)}},getListType:function(e,t){var n=this.getListObj(e);if("undefined"==typeof e||t<0||!n||J.isEmptyObject(n))return null;var i=n["level"+t].type;return i},getListStartingNo:function(e,t){var n=this.getListObj(e);if("undefined"==typeof e||t<0||!n||J.isEmptyObject(n))return null;var i=n["level"+t].startsWith;return i},getListChar:function(e,t){var n=this.getListObj(e);if("undefined"==typeof e||t<0||!n||J.isEmptyObject(n))return null;var i=n["level"+t].c;return i},getHeadingListId:function(){var e=this.getParaStyles("h1").ls_data;return e&&e.id},getFontSize:function(e){var t=this.getParaStyles("h"+e).textFormat[ATTR_TEXT.TS_SIZE];return t},getSection:function(e,t){for(var n=this.findNextIndexOf(UNICODE.SECTION_START),i=editor.doc.getDocumentLength(),o=[],r=n;r<i&&r>=0;){var a=editor.doc.getRawFormatAt(r);if(a){var s=a.st;"main"==e&&(s=e);var l=a.sid,d=this.findNextIndexOf(UNICODE.SECTION_START,r+1);if(d<0&&(d=i),a&&s==e&&(!t||t&&t==l)){var c=this.createSection(e,"",l);if(c.setStart(r),c.setEnd(d),c.content=this.getContent(r+1,d),e==NODE_TYPE.COMMENT&&a.cType&&"child"==a.cType&&(c.cType="child",c.parentId=a.parentId),t==l){o.push(c);break}o.push(c)}r=d}else n=this.findNextIndexOf(UNICODE.SECTION_START,r),r=n<0?i:n+1}var u=o.length?t?o[0]:o:null;return u},getElementAt:function(e){var t,n,i=this.getCharAt(e),o={};switch(i){case UNICODE.PARA:n=DocTreeManager.getTreeNodeAtIndex(e),t=this.createElement(NODE_TYPE.PARAGRAPH,n),t.setStart(n.getIndex()),t.setEnd(n.getEndIndex()+1);break;case UNICODE.TABLE:n=DocTreeManager.getTreeNodeAtIndex(e),o.dtNode=n,t=this.createElement(NODE_TYPE.TABLE,o),t.setStart(n.getIndex()),t.setEnd(n.getEndIndex()+1);break;case UNICODE.ROW:n=DocTreeManager.getTreeNodeAtIndex(e),o.dtNode=n,t=this.createElement(NODE_TYPE.ROW,o),t.setStart(n.getIndex()),t.setEnd(n.getEndIndex()+1);break;case UNICODE.CELL:n=DocTreeManager.getTreeNodeAtIndex(e),t=this.createElement(NODE_TYPE.CELL,n),t.setStart(n.getIndex()),t.setEnd(n.getEndIndex()+1);break;case UNICODE.HR:t=this.createElement(NODE_TYPE.HR),t.setStart(e),t.setEnd(e+1);break;case UNICODE.BR:t=this.createElement(NODE_TYPE.BR),t.setStart(e),t.setEnd(e+1);break;case UNICODE.IMAGE:t=this.createElement(NODE_TYPE.IMAGE),t.setStart(e),t.setEnd(e+1);break;default:t=this.createElement(NODE_TYPE.TEXT),t.setStart(e),t.setEnd(e+1)}return t},getPortionData:function(e,t){for(var n,i,o=DocTreeManager.lineAtIndex(e,t),r=J(o.el),a=r.find("span.zw-portion"),s=0,l=0,d=a.length,c=o.absStart;l<d;l++){if(i=parseInt(a.eq(l).attr("data-text-len")||0),c+i>=e){n=a[l],s=e-c;break}c+=i}return n=n||r.find("span.EOP")[0],n&&s<0&&(s=0),{node:n,cursorPos:s,line:o}},getNodesInSelection:function(e,t,n){var i=[];if(e==NODE_TYPE.PARAGRAPH){var o,r,a,s;for(o=DocTreeManager.getNodesBetweenIndex("para",t,n),r=0,a=o.length;r<a;r++)s=this.createElement(NODE_TYPE.PARAGRAPH,o[r]),s.setStart(o[r].getIndex()),s.setEnd(o[r].getEndIndex()+1),i.push(s)}else if(e==NODE_TYPE.TEXT)this.getTextNodesWithTabInSelection(i,t,n,!1);else if(e==NODE_TYPE.BOOKMARK){var l=this.findNextIndexOf(UNICODE.RANGE_END,t),d=[];if(l>=t&&l<n)for(var c,u;l<n&&l>0;){var p=-1,h=-1,f=editor.doc.getRawFormatAt(l);if(f&&f.type==e){c=f.id,u=f.name,p=l;for(var m=this.findNextIndexOf(UNICODE.RANGE_END,l);m<=n;){var g=editor.doc.getRawFormatAt(m);if(g&&g.type==e&&g.id==c){h=m+1;break}m=this.findNextIndexOf(UNICODE.RANGE_END,m+1)}if(p!=-1&&h!=-1){var T={id:c,name:u},_=this.createElement(e,T);_.setStart(p),_.setEnd(h),d.push(_)}}l=this.findNextIndexOf(UNICODE.RANGE_START,l+1)}i=d}else if(e==NODE_TYPE.IMAGE){for(var l=this.findNextIndexOf(UNICODE.IMAGE,t),d=[];l>=t&&l<n;){var E=this.getElementAt(l);d.push(E),l=this.findNextIndexOf(UNICODE.IMAGE,l+1)}i=d}else if(e==NODE_TYPE.LINK){var l,v,S,e,b,R;for(t==n&&(R=editor.doc.getParents(NODE_TYPE.LINK,t),R&&i.push(R)),l=t;l<=n&&(v=editor.doc.contStr.indexOf(UNICODE.RANGE_START,l),!(v<0||v>=n));)S=editor.doc.getRawFormatAt(v),e=S.type,"link"==e&&(b=editor.doc.getParents(NODE_TYPE.LINK,v+1),i.push(b)),l=v+1}return i},getTextNodesWithTabInSelection:function(e,t,n,i){"undefined"==typeof t&&(t=editor.doc.getSelection().getStart()),"undefined"==typeof n&&(n=editor.doc.getSelection().getEnd()),"undefined"==typeof i&&(i=!0);for(var o=t;o<=n;){var r=CONT_REGEXP.PORTION_END;i&&(r=CONT_REGEXP.PORTION_END_WITHOUT_TAB);var a=editor.doc.findNextIndexOf(r,o);a<0&&(a=editor.doc.getDocumentLength()),a>n&&(a=n);var s=editor.doc.getContent(o,a);if(s.length>0){var l=editor.doc.createElement(NODE_TYPE.TEXT,s);l.setStart(o),l.setEnd(a),e.push(l),o+=s.length}else o++}},getNewListId:function(){var e=this.bodyFormat.listFormat,t=0;for(var n in e){var i=parseInt(n);i>t&&(t=i)}return t+1},clearLastAction:function(){this.lastAction.cmd=this.lastAction.cmdValue=void 0},updateLastAction:function(e,t){var n;return"applyStyle"!==e||t[0]&&t[0][0]&&"paragraph"===t[0][0].type?("InsertChar"===e&&(this.lastAction&&"repeatAction"===this.lastAction.action?n=this.lastAction.cmdValue:(n=this.lastAction&&"InsertChar"===this.lastAction.cmd?this.lastAction.cmdValue:"",n+=t),t=n),this.clearLastAction(),this.lastAction.cmd=e,void(this.lastAction.cmdValue=t)):void this.clearLastAction()},applyLastAction:function(){if(!editor.isEditable())return!1;var e=editor.doc.lastAction.cmd;if(editor.doc.lastAction.action="repeatAction",PubSub.publish("DocOperation/applyLastAction",e),"InsertChar"===e){var t=editor.doc.createElement(NODE_TYPE.TEXT,editor.doc.lastAction.cmdValue);return Command.exec("InsertChar",{cmd:"insert",element:t}),!1}if("delrow"===e||"delcolumn"===e||"insrowafter"===e||"insrowbefore"===e||"inscolafter"===e||"inscolbefore"===e||"splitcells"===e||"deltable"===e||"setTableTheme"===e)return editor.doc.getSelection().parents(NODE_TYPE.TABLE)&&editor.doc.execCmd(e,editor.doc.lastAction.cmdValue),!1;if("Unlink"===e)return Utils.removeAllLinks(),!1;if("applyStyle"===e){var n=[];return editor.doc.getSelection().isCollapsed()?n.push(editor.doc.getSelection().parents(NODE_TYPE.PARAGRAPH)):n=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH),editor.doc.execCmd(e,[n,editor.doc.lastAction.cmdValue[1]]),!1}return"insbr"===e?(Command.exec("InsertChar",{cmd:"insbr"}),!1):"inspara"===e?(EventHandler.insertPara(),!1):"CreateLink"!==e&&"insimg"!==e&&"endnote"!==e&&(e?(editor.doc.execCmd(editor.doc.lastAction.cmd,editor.doc.lastAction.cmdValue),!1):void 0)},execCmd:function(e,t){"object"==typeof e&&(t=e[1],e=e[0]);var n=this.getSelection();if(!(n.isListItemSelection&&U.contains(DISABLED_OPERATIONS_ONLIST,e)||(Utils.addToStatistics(e),"FontSize"===e&&isNaN(t)||n.isInLockRange()&&(e.indexOf("ins")!=-1||e.indexOf("auto")!=-1||"delete"==e)))){if(PubSub.publish("DocOperation/BeforeExecCmd",e,t),EditorUtil.flushContents(),editor.lastOperation=e,editor.currentCommand=COMMAND.ANY,editor.doc.snapShotManager.flushTypedCharOps(),DocUtil.formatGenerator.isTextCommand(e)&&"SmallCaps"!==e||DocUtil.formatGenerator.isParaCommand(e)||DocUtil.formatGenerator.isNodeStyleCommand(e)?editor.doc.updateLastAction(e,t):editor.doc.clearLastAction(),DocUtil.formatGenerator.isTextCommand(e)&&"SmallCaps"!==e){if(t="BackColor"!==e||t?t:Doc.curBackGrdColor,t="ForeColor"!==e||t?t:Doc.curForeGrdColor,this.getSelection().isCollapsed()){n.updateCursorFormat(e,t);var i=n.parents(NODE_TYPE.PARAGRAPH);if(i.getEnd()-i.getStart()==1){var o={};o[ATTR_PARAGRAPH.PS_TS]=n.getTextFormat(),i.attr(o)}else"FontSize"===e&&setTimeout(function(){EditorUtil.focusMultiByteSpan()},10)}else{var r=n.getComputedTextFormat();e&&"FontName"==e&&t&&Utils.isWebFont(t);var o=DocUtil.formatGenerator.getTextFormat(r,e,t);n.applyFormat(o)}"BackColor"==e&&(editor.doc.isHighLighterOn||!n.isCollapsed()?(editor.doc.isHighLighterOn=!1,editor.jeditorPane.find("div.zw-page").css("cursor",""),J("#fmt-lpnl-bgcolor").removeClass("ui-highlight-active")):(J("#fmt-lpnl-bgcolor").addClass("ui-highlight-active"),editor.jeditorPane.find("div.zw-page").css("cursor","pointer"),editor.doc.isHighLighterOn=!0,editor.doc.highLightTextColor=t))}else if(DocUtil.formatGenerator.isParaCommand(e)){t="ParaBackColor"!==e||t?t:Doc.curParaBackGrdColor;var o=DocUtil.formatGenerator.getParaFormat(e,t);if("direction"==e&&o.dir===PARA_DIR.RTL){Utils.addToStatistics("DIRECTION_");var a=editor.doc.getSelection().getTargetRange(),s=editor.doc.getDocInfo().VERSION+"."+editor.doc.getDocInfo().REVISION;Utils.sendErrorDetails("NO_ERROR_MAIL<ZWERROR>"+s+"<ZWERROR>TEXT DIRECTION CHANGED TO RTL\nRange: "+JSON.stringify(a&&a.toCursorOp())+"\nVersion: "+s),o[ATTR_PARAGRAPH.PS_AL]=0}for(var l=DocUtil.getKeys(o),d=n.getNodesInSelection(NODE_TYPE.PARAGRAPH)||[],c=0;c<d.length;c++){var i=d[c],u=l[0];i.attr(u)!=o[u]&&i.attr(o)}}else if("undo"==e){editor.currentCommand=COMMAND.UNDO;var p=editor.doc.snapShotManager.getPrevious();if(p){void 0==p.isListItemSelection&&(p.isListItemSelection=!1),Op.isListItemSelection=n.isListItemSelection=p.isListItemSelection,Op.isCtrlSelection=p.isCtrlSelection,Op.processMsg(p.ops);for(var h=0,f=p.cursorStartPos.length;h<f;h++)Op.fillCursorPos(p.cursorStartPos[h],p.cursorEndPos[h])}}else if("redo"==e){editor.currentCommand=COMMAND.REDO;var m=editor.doc.snapShotManager.getNext();if(m){void 0==m.isListItemSelection&&(m.isListItemSelection=!1),Op.isListItemSelection=n.isListItemSelection=m.isListItemSelection,Op.isCtrlSelection=m.isCtrlSelection,Op.processMsg(m.ops);for(var h=0,f=m.cursorStartPos.length;h<f;h++)Op.fillCursorPos(m.cursorStartPos[h],m.cursorEndPos[h])}}else Command.exec(e,t);"paste"==e&&PasteUtil&&!PasteUtil.tablePaste||Op.sendMsg();var g=n.getStart();if(g&&editor.doc.getCharAt(g)==UNICODE.BR&&editor.doc.getCharAt(g-1)==UNICODE.PARA){EventHandler.mouseDown_coord.isLineEnd=!0;var T=editor.doc.getCursorPortionNode(editor.uuid,"start").node;EventHandler.mouseDown_coord.portion=J(T).parents("div.zw-paragraph").find("span.zw-portion,span.EOP")[0],n.select()}if(PubSub.publish("DocOperation/AfterExecCmd",e,t),n.isCollapsed()&&!InsertShape.isShapeSelected&&!/tableResize|updateRowHeight|updateColumnWidth/.test(editor.lastOperation)){var _=editor.doc.getDomCursorNode(editor.uuid,"start");_&&Utils.scrollElementIntoView(_[0])}"copy"==e||"cut"==e||InsertShape.isShapeSelected||EventHandler.isDialogFocused||EditorUtil.focusMultiByteSpan()}},getElement:function(e,t){if(e==NODE_TYPE.BOOKMARK){var n=this.contStr.indexOf(UNICODE.RANGE_START),i=editor.doc.getSectionEnd(1);i==-1&&(i=editor.doc.getDocumentLength());for(var o,r,a=[];n>-1&&n<i;){var s=-1,l=-1,d=editor.doc.getRawFormatAt(n);if(d&&d.type==e&&(!t||t&&(t==d.id||t==d.name))){o=d.id,r=d.name,s=n;var c=DocUtil.getRangeEnd(n);if(c<0)break;l=c+1;var u={id:o,name:r},p=this.createElement(e,u);if(p.setStart(s),p.setEnd(l),a.push(p),t)break}n=this.findNextIndexOf(UNICODE.RANGE_START,s!=-1?s+1:n+1)}return a}},getFloatElement:function(e,t){var n,i,o,r,a,s,l,d,c=null;if(s=DocTreeManager.getMetaSection(t),!s)return null;if(l=s.start,d=s.end,c=this.createSection(e,this.getContent(l+1,d),t),c.setStart(l),c.setEnd(d),!c)return null;for(i=this.findNextIndexOf(UNICODE.SECTION_START,1),o=this.findNextIndexOf(UNICODE.RANGE_START,1);o>-1&&o<i;){if(a=this.getRawFormatAt(o)||{},a[ATTR_COMMON.TYPE]==e&&a[ATTR_COMMON.ID]==t){r=DocUtil.getRangeEnd(o);break}o=this.findNextIndexOf(UNICODE.RANGE_START,o+1)}return o>-1&&r>-1&&(n=this.createElement(e,t),n.setStart(o),n.setEnd(r+1),n.section=c),n},getTextNodesInSelection:function(e,t){var n=[];if(e==t)return n;var i=editor.doc.getSectionEnd(e);t>i&&(t=i);var o,r=e;for(o=e+1;o<t;o++){var a=editor.doc.getRawFormatAt(o);if(!J.isEmptyObject(a)){if(!r&&a.type&&"text"==a.type){r=o;continue}if(!r)continue;if(!r)continue;n.push(DocUtil.createTextElement(r,o)),r=null,a.type&&"text"==a.type&&(r=o)}}return r&&n.push(DocUtil.createTextElement(r,o)),n},takeSnapShot:function(e){this.snapShotManager.takeSnapShot(e)},initTrackChangeDetails:function(){this.tcDetails.init(this.bodyFormat)},getCollabUserCount:function(e){for(var t,n=[],i=0,o=editor.doc.collabUsers.length;i<o;i++)t=editor.doc.collabUsers[i].zuid,editor.zuid===t||n.contains(t)||t===e||n.push(t);return n.length},getPaperWidth:function(e){if(EditorView.isWebView())return EditorView.width(e);var t=editor.doc.getBodyFormat(),n=Conversions.toGlobalUnit(t[ATTR_BODY.DS_PW])+w_usersettings[ATTR_BODY.DS_UN];return n="in"==w_usersettings[ATTR_BODY.DS_UN]?Conversions.inchToPx(n):Conversions.mmToPx(n),e||(n-=t[ATTR_BODY.DS_ML].convertor().pixels+t[ATTR_BODY.DS_MR].convertor().pixels),n}}},Doc.curForeGrdColor="#eb2b33",Doc.curBackGrdColor="#ffff00",Doc.curParaBackGrdColor="#fcbe02",Doc.curParaBorderColor="#eb2b33",DocOp.prototype.newCharacters=function(e){this.characters=e},DocOp.prototype.skipChars=function(e){this.retain_count=e},DocOp.prototype.changeStyles=function(e,t,n){this.styles={},this.styles.begin=DocUtil.copyStyle(t),this.styles.end=e,this.styles.id=n},DocOp.prototype.lock=function(e,t){this.lock_data=DocUtil.copyStyle(e),null!=t&&(this.lock_data.range=t)},DocOp.prototype.deleteCharacters=function(e){this.delete_characters=e},DocOp.prototype.cut=function(e){var t=new DocOp;if(this.isLock())this.lock_data.range-=e,t.lock(this.lock_data,e);else if(this.isInsert()){var n=this.characters.substring(0,e);this.characters=this.characters.substring(e),t.newCharacters(n)}else if(this.isDelete()){var n=this.delete_characters.substring(0,e);this.delete_characters=this.delete_characters.substring(e),t.deleteCharacters(n)}else this.isRetain()&&(this.retain_count-=e,t.skipChars(e));return t},DocOp.prototype.length=function(e){return null==e?null!=this.characters?this.characters.length:null!=this.delete_characters?this.delete_characters.length:null!=this.retain_count?this.retain_count:null!=this.lock_data?this.lock_data.range:this.styles&&(this.styles.begin||this.styles.end)?1:0:void(this.isInsert()?this.characters=this.characters.substring(0,e):this.isDelete()?this.delete_characters=this.delete_characters.substring(0,e):this.isRetain()?this.retain_count=e:this.isLock()&&(this.lock_data.range=e))},DocOp.clone=function(e){var t=new DocOp;return e.isTC()?e.clone():e.isRemoveTC()?e.clone():(e.isInsert()?t.newCharacters(e.characters):e.isDelete()?t.deleteCharacters(e.delete_characters):e.isRetain()?t.skipChars(e.retain_count):e.isAnnotation()?t.changeStyles(e.styles.end,e.styles.begin,e.styles.id):e.isLock()&&t.lock(e.lock_data),t.isPriorityOp=e.isPriorityOp,t)},DocOp.prototype.isInsert=function(){return null!=this.characters},DocOp.prototype.isPriorityDelete=function(){return null!=this.delete_characters&&this.isPriorityOp},DocOp.prototype.isDelete=function(){return null!=this.delete_characters},DocOp.prototype.isRetain=function(){return null!=this.retain_count},DocOp.prototype.isTC=function(){return this.type==DOCOP_TYPE_TC},DocOp.prototype.isRemoveTC=function(){return this.type==DOCOP_TYPE_REMOVE_TC},DocOp.prototype.isLock=function(){return null!=this.lock_data},DocOp.prototype.isRedact=function(){return null!=this.lock_data&&1==this.lock_data.data.redact},DocOp.prototype.isUnLock=function(){return null!=this.lock_data&&this.lock_data.data&&"unlock"==this.lock_data.data.state},DocOp.prototype.toString=function(){var e=this,t=[];return null!=e.retain_count?t.push("{'r':"+e.retain_count+"}"):e.isLock()?t.push("{'lk':'"+JSON.stringify(this.lock_data)+"'}"):null!=e.characters?t.push("{'is':'"+Utils.escapeSplChars(e.characters)+"'}"):e.delete_characters?t.push("{'ds':'"+Utils.escapeSplChars(e.delete_characters)+"'}"):e.styles&&(e.styles.end.length>0?t.push("{'as':{'end':"+JSON.stringify(e.styles.end)+",'id':"+JSON.stringify(e.styles.id)+"}}"):t.push("{'as':{'start':"+JSON.stringify(e.styles.begin)+",'id':"+JSON.stringify(e.styles.id)+"}}")),t.join()},DocOp.prototype.isAnnotation=function(){return this.styles&&(this.styles.begin||this.styles.end)},DocOp.prototype.isAnnotationStart=function(){return this.isAnnotation()&&0==this.styles.end.length},DocOp.prototype.isAnnotationEnd=function(){return this.isAnnotation()&&this.styles.end.length>0};var DOCOP_TYPE_RETAIN=1,DOCOP_TYPE_INSERT=2,DOCOP_TYPE_DELETE=3,DOCOP_TYPE_STYLESTART=4,DOCOP_TYPE_STYLEEND=5,DOCOP_TYPE_LOCK=6,DOCOP_TYPE_TC=7,DOCOP_TYPE_REMOVE_TC=8;InsertOp.prototype=new DocOp,RetainOp.prototype=new DocOp,DeleteOp.prototype=new DocOp,StartStyleOp.prototype=new DocOp,EndStyleOp.prototype=new DocOp;var TC_ACTION_DELETE="delete",TC_ACTION_INSERT="insert";TCOp.prototype=new DocOp,TCOp.prototype.type=DOCOP_TYPE_TC,TCOp.prototype.cut=function(e){this.range-=e;var t=this.chars.substring(0,e);this.chars=this.chars.substring(e);var n=TcNoMarkupHandler.cutContentStyleOp(this,e),i=n.inclusiveCutop,o=n.exclusiveCutop;this.contentStyleOp=o;var r=new TCOp(e,this.action,this.zuid,t,this.style,this.originAction,i);return r},TCOp.prototype.clone=function(){return new TCOp(this.range,this.action,this.zuid,this.chars,this.style,this.originAction,this.contentStyleOp)},TCOp.prototype.length=function(){return this.range},TCOp.prototype.toString=function(){var e={};return e.range=this.range,e.action=this.action,e.zuid=this.zuid,e.originAction=this.originAction,e.type=this.type,e.chars=this.getContentStyleOpChars(),JSON.stringify(e)},TCOp.prototype.toJSON=function(){return{tc:{range:this.range,action:this.action,zuid:this.zuid,originAction:this.originAction,type:this.type,chars:this.chars,style:this.style}}},TCOp.prototype.getUser=function(){return this.zuid},TCOp.prototype.setChars=function(e){this.chars=e},TCOp.prototype.getChars=function(){return this.chars},TCOp.prototype.getOriginAction=function(){return this.originAction},TCOp.prototype.setOriginAction=function(e){this.originAction=e},TCOp.prototype.getStyle=function(){return this.style},TCOp.prototype.setStyle=function(e){this.style=e},TCOp.prototype.getContentStyleOpChars=function(){return TcNoMarkupHandler.getContentStyleOpChars(this.contentStyleOp)},TCOp.prototype.getContentStyleOp=function(){return this.contentStyleOp},TCOp.prototype.getContentStyleOpLength=function(){return TcNoMarkupHandler.getContentStyleOpLength(this.contentStyleOp)},TCOp.prototype.setContentStyleOp=function(e){this.contentStyleOp=e},TCOp.prototype.isEquals=function(e){return!!e&&(this.action==e.action&&this.zuid==e.zuid&&this.style.type==e.style.type&&TcUtil.isEqualTCStyles(this.style,e.style))};var TCRemoveOp=function(e,t,n,i,o,r,a){TCOp.call(this),this.constructor(e,t,n,i,o,r,a)};TCRemoveOp.prototype=new TCOp,TCRemoveOp.prototype.constructor=TCOp,TCRemoveOp.prototype.type=DOCOP_TYPE_REMOVE_TC,TCRemoveOp.prototype.cut=function(e){this.range-=e;var t=this.chars.substring(0,e);this.chars=this.chars.substring(e);var n;if(this.getContentStyleOp()){var i=TcNoMarkupHandler.cutContentStyleOp(this,e);n=i.inclusiveCutop;var o=i.exclusiveCutop;this.contentStyleOp=o}var r=new TCRemoveOp(e,this.action,this.zuid,t,this.style,this.originAction,n);return r},TCRemoveOp.prototype.getContentStyleOpChars=function(){return TcNoMarkupHandler.getContentStyleOpChars(this.contentStyleOp)},TCRemoveOp.prototype.getContentStyleOp=function(){return this.contentStyleOp},TCRemoveOp.prototype.getContentStyleOpLength=function(){return TcNoMarkupHandler.getContentStyleOpLength(this.contentStyleOp)},TCRemoveOp.prototype.setContentStyleOp=function(e){this.contentStyleOp=e},TCRemoveOp.prototype.clone=function(){return new TCRemoveOp(this.range,this.action,this.zuid,this.chars,this.style,this.originAction,this.contentStyleOp)},TCRemoveOp.prototype.toString=function(){var e={};return e.range=this.range,e.action=this.action,e.zuid=this.zuid,e.originAction=this.originAction,e.type=this.type,e.chars=this.getContentStyleOpChars(),JSON.stringify(e)},LockOp.prototype=new DocOp,DocOpBuilder.prototype.length=function(){return this.docOps.length},DocOpBuilder.prototype.applyStyles=function(e,t,n){var i=[],o=new DocOp;o.skipChars(e),this.docOps.push(o),o=new DocOp,o.changeStyles([],n),this.docOps.push(o),o=new DocOp,o.skipChars(t-e),this.docOps.push(o);var i=[];for(var r in n)n.hasOwnProperty(r)&&i.push(r);o=new DocOp,o.changeStyles(i,[]),this.docOps.push(o)},DocOpBuilder.prototype.newCharacters=function(e){var t=new DocOp;t.newCharacters(e),this.docOps.push(t)},DocOpBuilder.prototype.deleteCharacters=function(e){var t=new DocOp;t.deleteCharacters(e),this.docOps.push(t)},DocOpBuilder.prototype.skipChars=function(e){var t=new DocOp;t.skipChars(e),this.docOps.push(t)},DocOpBuilder.prototype.newLockOp=function(e,t){var n=new DocOp;n.lock(e,t),this.docOps.push(n)},DocOpBuilder.prototype.applyTo=function(e){e&&(this.cursorObj=e.cursor,"collabop"===e.operation?this.uuid=e.sid:e.cursor&&(this.cursor=this.cursorObj[editor.uuid]),this.operation=e.operation);var t=editor.doc.getSelection();if(t&&1===t.length){var n=t.getLastRange();n&&this.cursorStart&&this.cursorEnd&&(n.setStart(this.cursorStart),n.setEnd(this.cursorEnd))}PubSub.publish("Document/BeforeModelUpdation",this),this._applyTo(),this.postApplyTo(),PubSub.publish("Document/AfterModelUpdation",this)},DocOpBuilder.prototype._applyTo=function(){for(var e,t=0,n=0,o=editor.doc,r=[],a=[],s=[],l="",d=this.docOps.length,c="",u=[],p=0;t<d;){if(n>o.getDocumentLength()||n<0){var h=new Error(ZWCollaboration.OP_IDX_IOB);throw editor.lastError=h,h}var f=this.docOps[t];if(editor.currentOp=f,null!=f.retain_count){n+=f.retain_count,p=f.retain_count;var m=!1;DocOpBuilder.build([]);if(r.length){m=!0;var g=DocOpUtil.getAnnotationStartOp(r);annotationStartIndex=n-f.retain_count;var T;if(g[NODE_TYPE.BODY]){C=g[NODE_TYPE.BODY];var _=new DocOp;if(_.changeStyles(null,C),editor.doc.snapShotManager&&editor.doc.snapShotManager.isSnapShotAllowed()){var E=editor.doc.snapShotManager.takeFmtBackup(n,_,!0),v=Utils.randomString();u.push({as:{start:E,id:v}}),u.push({r:0}),u.push({as:{end:DocUtil.getKeys(E),id:v}})}var S=o.getBodyFormat();T=DocUtil.copyStyle(S),DocOpUtil.updateStyles(S,C),PubSub.publish("Document/StyleChanged",annotationStartIndex,n,T,g)}else{if(T=editor.doc.getRawFormatAt(annotationStartIndex),PubSub.publish("Document/StyleChanged",annotationStartIndex,n,T,g),g[NODE_TYPE.PARAGRAPH]&&!this.triggerPagination&&(g[NODE_TYPE.PARAGRAPH].hasOwnProperty(ATTR_PARAGRAPH.EN_PB)||g[NODE_TYPE.PARAGRAPH].hasOwnProperty(ATTR_PARAGRAPH.EN_BL)||g[NODE_TYPE.PARAGRAPH].hasOwnProperty(ATTR_PARAGRAPH.EN_WO))&&(this.triggerPagination=!0),g[NODE_TYPE.TEXT]){var b={},R=o.getRawFormatAt(annotationStartIndex);jQuery.isEmptyObject(R)&&(R=DocOpUtil.getTextStyle(annotationStartIndex)),b=DocUtil.copyStyle(R);var O=o.getCharAt(n),D=o.getRawFormatAt(n);O&&!DocUtil.isBoundaryChar(O)&&jQuery.isEmptyObject(D)&&(D=DocOpUtil.getTextStyle(n),jQuery.isEmptyObject(D)&&(D={type:NODE_TYPE.TEXT}),o.setFormatAt(n,D)),jQuery.isEmptyObject(b)||o.setFormatAt(annotationStartIndex,b)}DocOpUtil.setStylesInRange(annotationStartIndex,n,g,u)}}editor.doc.snapShotManager&&!m&&editor.doc.snapShotManager.isSnapShotAllowed()&&u.push({r:p})}else if(null!=f.characters){var E=null,y=f.characters.length,A=r.length,C=r[A-1],g=DocOpUtil.getAnnotationStartOp(r),l="",I={},D=o.getRawFormatAt(n),w=n,P=n+f.characters.length;if(editor.doc.snapShotManager&&editor.doc.snapShotManager.isSnapShotAllowed()&&u.push({ds:f.characters}),C){C=g[C.type],E=C,l=E.type;var O=o.getCharAt(n);O&&!DocUtil.isBoundaryChar(O)&&(I=DocOpUtil.getTextStyle(n))}PubSub.publish("Document/ContentAdded",w,P,f.characters,C),D||jQuery.isEmptyObject(I)||o.setFormatAt(n,I),o.contStr=o.contStr.substr(0,n)+f.characters+o.contStr.substr(n),o.bucket.put(n,E);for(var M=1,L=y;M<L;M++)o.bucket.put(n+M,null);if(!C&&n&&DocUtil.isBoundaryChar(editor.doc.getCharAt(n-1))&&!DocUtil.isBoundaryChar(editor.doc.getCharAt(n))){var N=DocUtil.getTextStyleEnd(n),U=editor.doc.getRawFormatAt(N);U||(U={type:"text"}),editor.doc.setFormatAt(n,DocUtil.copyStyle(U)),DocUtil.mergeAdjacentStyles(n)}C&&DocUtil.mergeAdjacentStyles(n),n+=f.characters.length}else if(f.delete_characters){editor.doc.snapShotManager&&editor.doc.snapShotManager.isSnapShotAllowed()&&editor.doc.snapShotManager.takeDeletedContentBackup(n,n+f.delete_characters.length,u);var x=n,k=n+f.delete_characters.length;if(k>o.getDocumentLength())throw Utils.log("Error in delete @ : start"+x+" end "+k+" delChars"+o.contStr.substring(x,k)),"error in document applyTo";var F=o.contStr.substring(x,k);if(F!=f.delete_characters)throw Utils.log("Delete String content is mismatched... delChars : "+JSON.stringify(F)+". op_delChars : "+JSON.stringify(f.delete_characters)),"error in document applyTo";if(c+=F,PubSub.publish("Document/ContentDeleted",x,x+f.delete_characters.length,F),!editor.doc.getRawFormatAt(k)){var Y=DocUtil.getTextStyleStart(k),B=o.getRawFormatAt(Y);delete B[ATTR_TEXT.TS_SP],delete B[ATTR_TEXT.TS_GR],Y>=x&&Y<k&&o.setFormatAt(k,B)}o.bucket.remove(x,f.delete_characters.length),o.contStr=o.contStr.substr(0,x)+o.contStr.substr(k),DocUtil.mergeAdjacentStyles(n)}else if(f.styles){if(0==f.styles.end.length)s.push(n),r.push(f.styles.begin),a.push(f.styles.id);else if(f.styles.end.length>0){var H=f.styles.id,W=!1;for(e=r.length,i=e-1;i>=0;i--)if(a[i]==H){r.splice(i,1),s.splice(i,1),a.splice(i,1),W=!0;break}W||(r.pop(),a.pop(),s.pop())}}else if(f.isLock()){var k=f.length();if(f.isUnLock())Lock.updateLock(n,n+k,this),0==f.isRedact()&&this.redactContent&&(o.contStr=o.contStr.substr(0,n)+this.redactContent+o.contStr.substr(n+k),DocTreeManager.updateTree(n,n+k),PubSub.publish("Document/ContentUnMasked"));else{var V=!0;Lock.updateLock(n,n+k,this,V),f.isRedact()&&this.redactContent?(o.contStr=o.contStr.substr(0,n)+this.redactContent+o.contStr.substr(n+k),PubSub.publish("Document/ContentMasked")):0==f.isRedact()&&this.redactContent&&(o.contStr=o.contStr.substr(0,n)+this.redactContent+o.contStr.substr(n+k),PubSub.publish("Document/ContentUnMasked"))}n+=k}t++}editor.doc.snapShotManager&&editor.doc.snapShotManager.pushOps(u)},DocOpBuilder.prototype.setCursor=function(e){if(e&&e.length){try{var t=this.operation,n=editor.doc.getSelection();e.length>1&&t&&"undo"!=t&&"redo"!=t&&!n.isListItemSelection?n.isCtrlSelection?Utils.addToStatistics(t+"_ON_CTRL_SEL"):Utils.addToStatistics(t+"_ON_MUL_SEL"):t&&"undo"!=t&&"redo"!=t&&n.isListItemSelection&&Utils.addToStatistics(t+"_ON_LIST_SEL");for(var i,o,r,a=[],s=0,l=e.length;s<l;s++)i=e[s].start,o=e[s].end,r=editor.doc.createRange(i,o).setFocus(!1),a.push(r);n.isListItemSelection||("undo"==t||"redo"==t)&&Op.isListItemSelection?n.selectAllListItems(a&&a[0].start):("undo"!=t&&"redo"!=t||(n.isCtrlSelection=Op.isCtrlSelection),n.removeAllRanges().setSelectionType(SEL_OP_GEN).addRanges(a,!0).mapAllSelectionsToBulletin()),CurUtil.initCursor()}catch(t){Utils.log("_"+ZWCollaboration.SET_CURSOR_ERROR+"_SET_CURSOR_ERROR_ CURRENT-USER-SETCURSOR Cursor: "+JSON.stringify(e));var d=t.message;if(d===ZWCollaboration.SHOW_CARET_GETPORTION_ERROR||d===ZWCollaboration.SHOW_CARET_SELECTION_ERROR||d===ZWCollaboration.SHOW_CARET_PLACENODE_ERROR)throw t;var c=new Error(ZWCollaboration.SET_CURSOR_ERROR);throw c.stack=t.stack,c}if(0!==editor.doc.collabUsers.length&&"collabop"!==this.operation)try{ZWCollaboration.transformAndApplyOthersCursor(this,editor.uuid);var u=[];try{u=ZWCollaboration.getRangesInRegionOfUser(editor.uuid)||[],ZWCollaboration.updateCollabUsersRanges(u)}catch(e){u=[]}}catch(t){Utils.log("_"+ZWCollaboration.SET_COLLAB_CURSOR_ERROR+"_SET_COLLAB_CURSOR_ERROR_ COLLABORATORS-SETCURSOR Cursor: "+JSON.stringify(e)+", Collaborators: "+JSON.stringify(editor.doc.collabUsers));var d=t.message;if(d===ZWCollaboration.SHOW_CARET_GETPORTION_ERROR||d===ZWCollaboration.SHOW_CARET_SELECTION_ERROR||d===ZWCollaboration.SHOW_CARET_PLACENODE_ERROR)throw t;var c=new Error(ZWCollaboration.SET_COLLAB_CURSOR_ERROR);throw c.stack=t.stack,c}}},DocOpBuilder.prototype.postApplyTo=function(){var e=this,t=J.Deferred().progress(function(t){PubSub.publish("load"===e.operation?"Document/LoadingProgress":"DocOperation/CommandProgress",{node:t,cursor:e.cursorObj})}).done(function(){var t=editor.doc.getSelection();if(t&&"collabop"!==e.operation&&!t.isCollapsed()&&t.getLastRange().remove(),e.setCursor(e.cursor),"load"===e.operation)return void PubSub.publish("Document/LoadingComplete",e);if("collabop"===e.operation){var n=[];try{n=ZWCollaboration.getRangesInRegionOfUser(e.uuid)||[]}catch(e){n=[]}if((t&&t.isCollapsed()||n[0]&&n[0].SID==editor.uuid)&&!Resize.getTargetImg()){var i=t.toArray();if(t.removeAllRanges(),t.isListItemSelection)t.selectAllListItems(i[0].start);else for(var o=0,r=i.length;o<r;o++)t.showCaret(i[o])}e.cursorObj=n,n.length&&ZWCollaboration.updateCollabUsersRanges(e.cursorObj,e.uuid)}PubSub.publish("DocOperation/CommandComplete",e),Op.isCtrlSelection=!1,Op.isListItemSelection=!1});TcManager.applyChanges(),CommentModels.applyChanges(),DocTreeManager.applyChanges(),DocTreeManager.buildChanges(t)},DocOpBuilder.prototype.getDocOps=function(){return this.docOps},DocOpBuilder.prototype.push=function(e){this.docOps.push(e)},DocOpBuilder.prototype.pop=function(){this.docOps.pop()},DocOpBuilder.prototype.getCursorPos=function(){for(var e,t=this.getDocOps(),n=t.length,i=0,o={},r=[],a=0;a<n;a++)e=t[a],e.isRetain()&&(i+=e.length()),e.isAnnotation()&&(e.isAnnotationStart()?"cursor"==e.styles.begin.type&&(o.start=0==parseInt(i)?1:i):(o.end=0==parseInt(i)?1:i,r.push(o),o={}));return r},DocOpBuilder.prototype.toString=function(){for(var e,t=this.getDocOps(),n=[],i="",o=t.length,r=0;r<o;r++)e=t[r],e.isTC()?n.push(e.toString()):e.isRemoveTC()?n.push(e.toString()):e.isRetain()?n.push('{"r":'+e.retain_count+"}"):e.isInsert()?n.push('{"is":"'+Utils.escapeSplChars(e.characters)+'"}'):e.isLock()?n.push('{"lk":'+JSON.stringify(e.lock_data)+"}"):e.isDelete()?n.push('{"ds":"'+Utils.escapeSplChars(e.delete_characters)+'"}'):e.isAnnotation()&&(e.styles.end.length>0?n.push('{"as":{"end":'+JSON.stringify(e.styles.end)+',"id":'+JSON.stringify(e.styles.id)+"}}"):e.styles.begin&&n.push('{"as":{"start":'+JSON.stringify(e.styles.begin)+',"id":'+JSON.stringify(e.styles.id)+"}}"));return i=n.join(),"["+i+"]"},DocOpBuilder.prototype.toJson=function(){for(var e,t=this.getDocOps(),n=[],i=t.length,o=0;o<i;o++){var r={};e=t[o],e.isRetain()?r.r=e.retain_count:e.isInsert()?r.is=e.characters:e.isDelete()?r.ds=e.delete_characters:e.isAnnotation()&&(r.as={},r.as.id=e.styles.id,e.styles.end.length>0?r.as.end=e.styles.end:e.styles.begin&&(r.as.start=e.styles.begin)),n.push(r)}return n},DocOpBuilder.prototype.setPriorityDelete=function(e,t,n){var i,o,r;i=e.delete_characters,o=e.delete_characters.length;var a=Utils.findNextIndexOf(UNICODE.TABLE+"|"+UNICODE.ROW+"|"+UNICODE.CELL+"|"+UNICODE.TOCSTART,0,i);if(a!=-1){var s=e.delete_characters.charAt(a);if(0!=a){var l,d=a,c=i.substring(0,d);e.deleteCharacters(c);var u=i.substring(d,o);e=new DocOp,e.deleteCharacters(u),n.docOps.splice(t+1,0,e)}else if(s==UNICODE.TABLE?(l=TableUtil.getEnd(a+1,s,i),l>0&&(l+=1)):s==UNICODE.ROW?l=TableUtil.getEnd(a+1,s,i):s==UNICODE.CELL?l=TableUtil.getEnd(a+1,s,i):s==UNICODE.TOCSTART&&(l=Utils.getTocEnd(a+1,o,i)),l!=-1){if(r=i.substring(a,l),e.deleteCharacters(r),e.isPriorityOp=!0,l!=o){var u=i.substring(l,o);e=new DocOp,e.deleteCharacters(u),n.docOps.splice(t+1,0,e)}}else l==-1&&(r=i.substring(a,o),e.deleteCharacters(r),e.isPriorityOp=!0)}},DocOpBuilder.xform=function(e,t){if(0==e.docOps.length||0==t.docOps.length)return{first:e,second:t};for(var n=DocOpBuilder.clone(e),i=DocOpBuilder.clone(t),o=new DocOpBuilder,r=new DocOpBuilder,a={},s={},l=0,d=0,c=n.docOps[l],u=i.docOps[d],p={},h={next1:!1,next2:!1},f=t.zuid||editor.zuid;l<n.length()&&d<i.length();)c.isDelete()&&DocOpBuilder.prototype.setPriorityDelete(c,l,n),u.isDelete()&&DocOpBuilder.prototype.setPriorityDelete(u,d,i),0==c.length()||0==u.length()?(0==c.length()&&(o.push(c),h.next1=!0,h.next2=!1),0==u.length()&&(r.push(u),h.next2=!0,h.next1=!1)):c.isInsert()?DocOpBuilder.xformInsertChars(o,r,c,u,h,a,s,p):c.isRetain()?DocOpBuilder.xformRetain(o,r,c,u,h,a,s,p):c.isTC()?DocOpBuilder.xformChanges(o,r,c,u,h,a,s,p):c.isRemoveTC()?DocOpBuilder.xformRemoveChanges(o,r,c,u,h,a,s,p):c.isLock()?DocOpBuilder.xformLock(o,r,c,u,h,a,s,p,f):c.isDelete()?DocOpBuilder.xformDeleteChars(o,r,c,u,h,a,s,p):c.isAnnotation()&&DocOpBuilder.xformAnnotationBoundary(o,r,c,u,h,a,s,p),h.next1&&(l++,l<n.docOps.length&&(c=n.docOps[l])),h.next2&&(d++,d<i.docOps.length&&(u=i.docOps[d])),h.next1=!1,h.next2=!1;if(l!=n.docOps.length||d!=i.docOps.length){for(;l!=n.docOps.length;)o.push(n.docOps[l]),l++;for(;d!=i.docOps.length;)r.push(i.docOps[d]),d++}return{first:o,second:r}},DocOpBuilder.xformAnnotationBoundary=function(e,t,n,i,o,r,a,s){var l={},d="",c=[];if(n.isAnnotationEnd()>0)c=n.styles.end,d=n.styles.id;else{if(i.isAnnotationStart()){if(n.styles.begin.type==i.styles.begin.type){var u=(new Date).getMilliseconds();i.xformedStyleId=u,s[u]=n}}else if(n.hasOwnProperty("xformedStyleId")){var d=n.xformedStyleId,p=s[d],h=p.styles.begin;for(var f in h)n.styles.begin[f]=h[f]}l=n.styles.begin,d=n.styles.id}var m=new DocOp;m.changeStyles(c,l,d),e.docOps.push(m),o.next1=!0,o.next2=!1},DocOpBuilder.getPermission=function(e,t){var n=e.lock_data?e.lock_data.data.allowed_zuids:"";return n=","+n+",",e.lock_data&&(e.lock_data.data.zuid==t||n.indexOf(","+t+",")>-1)||"OWNER"==editor.doc.getRole()||"collabop"==t},DocOpBuilder.xformChanges=function(e,t,n,i,o,r,a,s,l){o.next1=!0,i.isDelete()?t.deleteCharacters(n.getContentStyleOpChars()):(e.push(n),t.skipChars(n.length()))},DocOpBuilder.xformRemoveChanges=function(e,t,n,i,o,r,a,s,l){var d=DocOpBuilder.cutToEqLenAndMove(n,i,o);i.isTC()?(d.item1.setContentStyleOp(d.item2.getContentStyleOp()),e.push(d.item1),t.push(d.item2)):i.isRetain()&&(e.skipChars(d.item1.length()),t.push(d.item2))},DocOpBuilder.xformLock=function(e,t,n,i,o,r,a,s,l){if(i.isInsert())if(n.lock_data.origRange!=n.lock_data.range&&n.lock_data.origRange){if(!DocOpBuilder.getPermission(n,l))throw"Error in xform lock";var d=new DocOp;d.lock(n.lock_data,i.length()),e.docOps.push(d),t.docOps.push(i),o.next1=!1,o.next2=!0}else{DocOpBuilder.xformInsertChars(t,e,i,n,o,a,r,s);var c=o.next1;o.next1=o.next2,o.next2=c}else if(i.isAnnotation()){DocOpBuilder.xformAnnotationBoundary(t,e,i,n,o,a,r,s);var c=o.next1;o.next1=o.next2,o.next2=c}else if(i.isRetain()){var u=Math.min(n.length(),i.length());e.newLockOp(n.lock_data,u),t.skipChars(u),u<n.lock_data.range?n.lock_data.range-=u:o.next1=!0,u<i.retain_count?i.retain_count-=u:o.next2=!0}else if(i.isDelete()){var p=i,h=n,u=Math.min(h.length(),p.length());if(!DocOpBuilder.getPermission(n,l))throw"Error in xform lock";u<h.length()?h.lock_data.range-=u:o.next1=!0,u<p.length()?(t.deleteCharacters(p.delete_characters.substr(0,u)),p.delete_characters=p.delete_characters.substring(u,p.length())):(t.deleteCharacters(p.delete_characters.substr(0,p.length())),o.next2=!0)}},DocOpBuilder.xformInsertChars=function(e,t,n,i,o,r,a,s){n.characters[0];if(i.isAnnotation()&&i.hasOwnProperty("xformedStyleId")&&(delete i.xformedStyleId,delete s.xformedStyleId),i.isPriorityDelete()){var l=new DocOp;l.deleteCharacters(n.characters),t.docOps.push(l)}else e.docOps.push(n),i.isLock()?i.length(n.characters.length+i.length()):t.skipChars(n.characters.length);o.next1=!0,o.next2=!1},DocOpBuilder.xformRetain=function(e,t,n,i,o,r,a,s){if(i.isInsert()){DocOpBuilder.xformInsertChars(t,e,i,n,o,a,r,s);var l=o.next1;o.next1=o.next2,o.next2=l}else if(i.isAnnotation()){DocOpBuilder.xformAnnotationBoundary(t,e,i,n,o,a,r,s);var l=o.next1;o.next1=o.next2,o.next2=l}else if(i.isTC()){var d=DocOpBuilder.cutToEqLenAndMove(n,i,o);t.docOps.push(d.item2)}else if(i.isRetain()){var c=Math.min(n.retain_count,i.retain_count);e.skipChars(c),t.skipChars(c),c<n.retain_count?n.retain_count-=c:o.next1=!0,c<i.retain_count?i.retain_count-=c:o.next2=!0}else if(i.isDelete()){var c=Math.min(n.retain_count,i.delete_characters.length);c<n.retain_count?n.retain_count-=c:o.next1=!0,t.deleteCharacters(i.delete_characters.substr(0,c)),c<i.delete_characters.length?i.delete_characters=i.delete_characters.substring(c,i.delete_characters.length):o.next2=!0}else if(i.isLock()){DocOpBuilder.xformLock(t,e,i,n,o,a,r,s);var l=o.next1;o.next1=o.next2,o.next2=l}},DocOpBuilder.xformDeleteChars=function(e,t,n,i,o,r,a,s){if(i.isInsert()){DocOpBuilder.xformInsertChars(t,e,i,n,o,a,r,s);var l=o.next1;o.next1=o.next2,o.next2=l}else if(i.isAnnotation()){DocOpBuilder.xformAnnotationBoundary(t,e,i,n,o,a,r,s);var l=o.next1;o.next1=o.next2,o.next2=l}else if(i.isRetain()){var d=Math.min(i.retain_count,n.delete_characters.length);e.deleteCharacters(n.delete_characters.substr(0,d)),d<n.delete_characters.length?n.delete_characters=n.delete_characters.substr(d,n.delete_characters.length):o.next1=!0,d<i.retain_count?i.retain_count-=d:o.next2=!0}else if(i.isDelete()){var d=Math.min(n.delete_characters.length,i.delete_characters.length);d<n.delete_characters.length?n.delete_characters=n.delete_characters.substr(d,n.delete_characters.length):o.next1=!0,d<i.delete_characters.length?i.delete_characters=i.delete_characters.substr(d,i.delete_characters.length):o.next2=!0}else i.isLock()?(e.docOps.push(n),n.length()>i.length()?i.length(0):i.length(i.length()-n.delete_characters.length),o.next1=!0,o.next2=!1):i.isTC()&&DocOpBuilder.cutToEqLenAndMove(n,i,o)},DocOpBuilder.clone=function(e){for(var t=new DocOpBuilder,n=e.getDocOps(),i=0;i<n.length;i++)t.push(DocOp.clone(n[i]));return e.isLock&&(t.isLock=!0),t.isRedact=e.isRedact,e.isInsideRedact=e.isInsideRedact,e.docOpIds&&(t.docOpIds=e.docOpIds),t},DocOpBuilder.concise=function(e){try{var t,n=e.getDocOps(),i=new DocOpBuilder,o=n.length;i.isRedact=e.isRedact,i.isInsideRedact=e.isInsideRedact;for(var r=0;r<o;r++){t=n[r];var a=i.docOps.pop();if(a)if(t.isLock()&&(i.isLock=!0),a.isInsert()&&t.isInsert())a.newCharacters(a.characters+t.characters),i.push(a);else if(a.isLock()&&t.isLock()&&DocOpBuilder.isSameLockDocOps(a,t))a.lock_data.range+=t.lock_data.range,i.push(a);else if(a.isRetain()&&t.isRetain())a.retain_count+=t.retain_count,i.push(a);else if(a.isDelete()&&t.isDelete())a.deleteCharacters(a.delete_characters+t.delete_characters),i.push(a);else{if(a.isAnnotationStart()&&t.isAnnotationEnd())continue;i.push(a),i.push(t)}else i.push(t)}}catch(t){throw Utils.log("DocOpBuilder: "+e.toString()),Utils.log("Exception: "+t.stack),Utils.log("Concise Failed @",r),"concise_error"}return i},DocOpBuilder.redact=function(e,t){try{var n=DocOpBuilder.clone(e),i=n.getDocOps(),o=DocOpBuilder.clone(t).getDocOps();if(0==i.length)return 0!=o.length?DocOpBuilder.clone(t):null;if(0==o.length)return DocOpBuilder.clone(e);for(var r=new DocOpBuilder,a=0,s=0,l=i[a],d=o[s],c=editor.zuid,u={next1:!1,next2:!1};a<i.length||s<o.length;){if(a>=i.length&&(l=null),s>=o.length&&(d=null),l&&d)l&&0==l.length()||d&&0==d.length()?(l&&0==l.length()&&(l.isLock||r.push(l),u.next1=!0,u.next2=!1),d&&0==d.length()&&(d.isLock()||r.push(d),u.next2=!0,u.next1=!1)):l&&d&&(l.isRetain()?DocOpBuilder.redactRetain(l,d,u,r):l.isLock()?DocOpBuilder.redactLock(l,d,u,r,c):l.isInsert()?DocOpBuilder.redactInsert(l,d,u,r,c):l.isDelete()?u.next1=!0:l.isAnnotation()&&DocOpBuilder.redactAnnotation(l,d,u,r));else{var p=l?l:d;p.isLock()||r.push(p),u[l?"next1":"next2"]=!0}u.next1&&(a++,a<i.length&&(l=i[a])),u.next2&&(s++,s<o.length&&(d=o[s]))}}catch(e){}return r},DocOpBuilder.redactRetain=function(e,t,n,i){if(t.isInsert())i.push(t),n.next1=!1,n.next2=!0;else if(t.isRetain()){var o=Math.min(e.length(),t.length());t.length()==e.length()?(i.push(e),n.next1=!0,n.next2=!0):o==e.length()?(i.push(e),t.retain_count-=o,n.next1=!0,n.next2=!1):(i.push(t),e.retain_count-=o,n.next1=!1,n.next2=!0)}else if(t.isDelete()){var o=Math.min(e.length(),t.length());if(t.length()==e.length())i.push(t),n.next1=!0,n.next2=!0;else if(o==e.length()){var r=new DocOp;r.deleteCharacters(t.delete_characters.substring(0,o)),i.push(r),t.deleteCharacters(t.delete_characters.substring(o)),n.next1=!0,n.next2=!1}else i.push(t),e.retain_count-=o,n.next1=!1,n.next2=!0}else t.isAnnotation()&&(i.push(t),n.next1=!1,n.next2=!0)},DocOpBuilder.redactLock=function(e,t,n,i,o){var r=e.isRedact();if(t.isRetain()){var a=Math.min(e.length(),t.length());if(t.length()==e.length())i.push(t),n.next1=!0,n.next2=!0;else if(a==e.length()){var s=new DocOp;s.skipChars(a),i.push(s),t.retain_count-=a,n.next1=!0,n.next2=!1}else i.push(t),e.length(itemt1.length()-a),n.next1=!1,n.next2=!0}else if(t.isInsert()){if(r&&!DocOpBuilder.getPermission(e,o)){var l=new DocOp;l.newCharacters(t.characters.replace(new RegExp("[^"+CONT_REGEX_REDACT_EXCLUDE+"]","g"),"*")),i.push(l)}else i.push(t);n.next1=!1,n.next2=!0}else if(t.isDelete()){var a=Math.min(e.length(),t.length());if(e.length()==t.length())r&&!DocOpBuilder.getPermission(e,o)?t.deleteCharacters(t.delete_characters.replace(new RegExp("[^"+CONT_REGEX_REDACT_EXCLUDE+"]","g"),"*")):t.deleteCharacters(t.delete_characters),i.push(t),e.length(0),n.next2=!0,n.next1=!0;else if(a==e.length()){var d=t.delete_characters.substring(0,a),c=new DocOp;r&&!DocOpBuilder.getPermission(e,o)?c.deleteCharacters(d.replace(new RegExp("[^"+CONT_REGEX_REDACT_EXCLUDE+"]","g"),"*")):c.deleteCharacters(d),i.push(c),t.deleteCharacters(t.delete_characters.substring(a)),n.next1=!0,n.next2=!1}else{var c=new DocOp,u=t.delete_characters.substring(0,a);r&&!DocOpBuilder.getPermission(e,o)?c.deleteCharacters(u.replace(new RegExp("[^"+CONT_REGEX_REDACT_EXCLUDE+"]","g"),"*")):c.deleteCharacters(u),i.push(c),e.length(e.length()-a),t.deleteCharacters(t.delete_characters.substring(a)),n.next1=!1,n.next2=!0}}else t.isAnnotation()&&(i.push(t),n.next1=!1,n.next2=!0)},DocOpBuilder.redactInsert=function(e,t,n,i,o){if(t.isRetain()){var r=Math.min(e.length(),t.length());if(e.length()==t.length())i.push(e),n.next1=!0,n.next2=!0;else if(r==e.length())i.push(e),t.retain_count-=r,n.next1=!0,n.next2=!1;else{var a=new DocOp;a.newCharacters(e.characters.substring(0,r)),i.push(a),e.newCharacters(e.characters.substring(r)),n.next1=!1,n.next2=!0}}else if(t.isLock()){var s=t.isRedact(),r=Math.min(e.length(),t.length());if(e.length()==t.length()){if(s&&!DocOpBuilder.getPermission(t,o)){var a=new DocOp;a.newCharacters(e.characters.replace(new RegExp("[^"+CONT_REGEX_REDACT_EXCLUDE+"]","g"),"*"))}else i.push(e);n.next1=!0,n.next2=!0}else if(r==e.length()){if(s&&!DocOpBuilder.getPermission(t,o)){var a=new DocOp;a.newCharacters(e.characters.replace(new RegExp("[^"+CONT_REGEX_REDACT_EXCLUDE+"]","g"),"*"))}else i.push(e);n.next1=!0,n.next2=!1}else{var l=e.characters.substring(0,r),a=new DocOp;s&&!DocOpBuilder.getPermission(t,o)&&(l=l.replace(new RegExp("[^"+CONT_REGEX_REDACT_EXCLUDE+"]","g"),"*")),a.newCharacters(l),i.push(a),e.newCharacters(e.characters.substring(r)),n.next1=!1,n.next2=!0}}},DocOpBuilder.redactAnnotation=function(e,t,n,i,o){i.push(e),n.next1=!0,n.next2=!1},DocOpBuilder.compose=function(e,t){try{var n=DocOpBuilder.clone(e).getDocOps(),i=DocOpBuilder.clone(t).getDocOps();if(0==n.length)return 0!=i.length?DocOpBuilder.clone(t):new DocOpBuilder;if(0==i.length)return DocOpBuilder.clone(e);for(var o=new DocOpBuilder,r=0,a=0,s=n[r],l=i[a],d={next1:!1,next2:!1};r<n.length||a<i.length;){if(r>=n.length&&(s=null),a>=i.length&&(l=null),s&&l)s&&0==s.length()||l&&0==l.length()?(s&&0==s.length()&&(o.push(s),d.next1=!0,d.next2=!1),l&&0==l.length()&&(o.push(l),d.next2=!0,d.next1=!1)):s&&l&&(d.next1=d.next2=!1,s.isInsert()?DocOpBuilder.composeInsert(s,l,d,o):s.isRetain()?DocOpBuilder.composeRetain(s,l,d,o):s.isDelete()?DocOpBuilder.composeDelete(s,l,d,o):s.isAnnotation()?DocOpBuilder.composeAnnotation(s,l,d,o):s.isTC()?DocOpBuilder.composeChanges(s,l,d,o):s.isRemoveTC()?DocOpBuilder.composeRemoveChanges(s,l,d,o):s.isLock()&&DocOpBuilder.composeLock(s,l,d,o));else{var c=s?s:l;o.push(c),d[s?"next1":"next2"]=!0}d.next1&&(r++,r<n.length&&(s=n[r])),d.next2&&(a++,a<i.length&&(l=i[a]))}}catch(e){throw Utils.log("docOps1: "+JSON.stringify(n)),Utils.log("docOps2: "+JSON.stringify(i)),Utils.log("Exception: "+e.stack),Utils.log("Compose Failed @c1 = "+r+" c2 ="+a),"compose_error"}return o},DocOpBuilder.mergeLocks=function(e,t){var n=DocOp.clone(e);return n},DocOpBuilder.composeRemoveChanges=function(e,t,n,i){var o=Math.min(e.length(),t.length());DocOpBuilder.cutToEqLenAndMove(e,t,n);t.isTC()?i.skipChars(o):t.isRetain()&&i.skipChars(o)},DocOpBuilder.composeChanges=function(e,t,n,i){var o=Math.min(e.length(),t.length());if(t.isAnnotation())return i.push(t),n.next2=!0,void(n.next1=!1);var r=DocOpBuilder.cutToEqLenAndMove(e,t,n);if(t.isRemoveTC())i.skipChars(o);else if(t.isTC()){var a=r.item2,a="hidden"===e.getOriginAction()?r.item1:r.item2;i.push(a)}else t.isRetain()&&i.push(r.item1)},DocOpBuilder.composeLock=function(e,t,n,i){if(!t.isLock()&&!t.isRetain())throw Utils.log("Lock operation can be composed with only lock and skip operation"),new Error("Lock error in compose");var o=e.length(),r=t.length(),a=Math.min(o,r);if(t.isRetain())if(o==r)i.push(e),n.next1=!0,n.next2=!0;else if(a==o){var s=DocOp.clone(e);s.lock_data.range=o,i.push(s),t.retain_count-=a,n.next1=!0,n.next2=!1}else{var s=DocOp.clone(e);s.lock_data.range=r,i.push(s),e.length(e.length()-a),n.next1=!1,n.next2=!0}else if(t.isLock())if(t.isUnLock())i.skipChars(a),o==r?(n.next1=!0,n.next2=!0):a==o?(t.length(t.length()-a),n.next1=!0,n.next2=!1):(e.length(e.length()-a),n.next1=!1,n.next2=!0);else if(o==r)i.push(t),n.next1=!0,n.next2=!0;else if(a==o)i.push(e),t.length(t.length()-a),n.next1=!0,n.next2=!1;else{var l=DocOpBuilder.mergeLocks(e,t);i.push(l),e.length(e.length()-a),n.next1=!1,n.next2=!0}return i},DocOpBuilder.composeAnnotation=function(e,t,n,i){t.isDelete()||t.isRetain()||t.isTC()?(i.push(e),n.next1=!0,n.next2=!1):t.isInsert()?(i.push(t),n.next1=!1,n.next2=!0):t.isAnnotation()&&(e.isAnnotationStart()?t.isAnnotationStart()?(i.push(t),n.next1=!1,n.next2=!0):(i.push(t),n.next1=!1,n.next2=!0):(i.push(e),n.next1=!0,n.next2=!1))},DocOpBuilder.composeInsert=function(e,t,n,i){if(t.isInsert())i.push(t),n.next2=!0,n.next1=!1;else if(t.isRetain()){var o=Math.min(e.length(),t.length());if(e.length()==t.length())i.push(e),n.next2=!0,n.next1=!0;else if(o==e.length())i.push(e),t.retain_count-=o,n.next2=!1,n.next1=!0;else{var r=new DocOp;r.newCharacters(e.characters.substring(0,o)),i.push(r),e.newCharacters(e.characters.substring(o)),n.next1=!1,n.next2=!0}}else if(t.isDelete()){var o=Math.min(e.length(),t.length());e.length()==t.length()?(n.next2=!0,n.next1=!0):o==e.length()?(t.deleteCharacters(t.delete_characters.substring(o)),n.next1=!0,n.next2=!1):(e.newCharacters(e.characters.substring(o)),n.next1=!1,n.next2=!0)}else t.isAnnotation()&&(i.push(t),n.next1=!1,n.next2=!0)},DocOpBuilder.composeRetain=function(e,t,n,i){if(t.isInsert())i.push(t),n.next1=!1,n.next2=!0;else if(t.isRetain()){var o=Math.min(e.length(),t.length());t.length()==e.length()?(i.push(e),n.next1=!0,n.next2=!0):o==e.length()?(i.push(e),t.retain_count-=o,n.next1=!0,n.next2=!1):(i.push(t),e.retain_count-=o,n.next1=!1,n.next2=!0)}else if(t.isDelete()){var o=Math.min(e.length(),t.length());if(t.length()==e.length())i.push(t),n.next1=!0,n.next2=!0;else if(o==e.length()){var r=new DocOp;r.deleteCharacters(t.delete_characters.substring(0,o)),i.push(r),t.deleteCharacters(t.delete_characters.substring(o)),n.next1=!0,n.next2=!1}else i.push(t),e.retain_count-=o,n.next1=!1,n.next2=!0}else if(t.isAnnotation())i.push(t),n.next1=!1,n.next2=!0;else if(t.isTC()){DocOpBuilder.composeChanges(t,e,n,i);var a=n.next1;n.next1=n.next2,n.next2=a}else if(t.isRemoveTC())i.skipChars(t.length()),n.next1=!1,n.next2=!0;else if(t.isLock()){var o=Math.min(e.length(),t.length());if(t.length()==e.length())t.isUnLock()?i.skipChars(o):i.push(t),n.next1=!0,n.next2=!0;else if(o==e.length()){if(t.isUnLock())i.skipChars(o);else{var s=DocOp.clone(t);s.lock_data.range=e.length(),i.push(s)}t.lock_data.range-=o,n.next1=!0,n.next2=!1}else t.isUnLock()?i.skipChars(o):i.push(t),e.retain_count-=o,n.next1=!1,n.next2=!0}},DocOpBuilder.composeDelete=function(e,t,n,i){t.isInsert()?(i.push(t),n.next2=!0,n.next1=!1):t.isDelete()?(i.push(e),n.next2=!1,n.next1=!0):t.isRetain()||t.isAnnotation()?(i.push(e),n.next1=!0,n.next2=!1):t.isTC()&&DocOpBuilder.cutToEqLenAndMove(e,t,n)},DocOpBuilder.build=function(e){for(var t,n=new DocOpBuilder,i=e.length,o=0;o<i;o++){var r,a=e[o],s=new DocOp;if(a.r>=0)s.skipChars(a.r);else if(a.is)s.newCharacters(a.is);else if(a.ds)s.deleteCharacters(a.ds);else if(a.as)r=a.as,t=r.id,r.start?s.changeStyles([],r.start,t):s.changeStyles(r.end,[],t);else if(r=a.lk){n.isLock=!0,s.lock(r),s.lock_data.origRange=r.range;var l=r.data;a.data&&(s.lock_data.data=l=a.data),n.isRedact=l.redact}n.push(s)}return n},DocOpBuilder.cleanUpUnlockOp=function(e){var t,n,i,o;for(o=new DocOpBuilder,o.isLock=!0,i=e.getDocOps(),n=i.length,t=0;t<n;t++)i[t].isUnLock()||o.push(i[t]);return o},DocOpBuilder.isSameLockDocOps=function(e,t){var n=e.lock_data.data,i=t.lock_data.data;for(var o in n)if(n[o]!=i[o])return!1;return!0},DocOpBuilder.cutToEqLenAndMove=function(e,t,n){var i=Math.min(e.length(),t.length());return n.next1=n.next2=!1,i<e.length()?e=e.cut(i):n.next1=!0,i<t.length()?t=t.cut(i):n.next2=!0,{item1:e,item2:t}},Lock=function(){function e(e){e.addEventListener("mouseover",function(n){var i=[];i=J.makeArray(e.classList),i.indexOf("editable-permitted")>-1?t(n,e.id,"lock-para-editable"):t(n,e.id,"lock-para")}),e.addEventListener("mouseout",function(n){var i=[];i=J.makeArray(e.classList),i.indexOf("editable-permitted")>-1?t(n,e.id,"lock-para-editable"):t(n,e.id,"lock-para")})}function t(e,t,n){[].forEach.call(document.querySelectorAll("."+t),function(t){t.classList["mouseover"===e.type?"add":"remove"](n)})}var n=!1,i=0,o=function(){PubSub.subscribe("paraview/create",a),PubSub.subscribe("paraview/modify",a),PubSub.subscribe("Document/readonlyview",r),PubSub.subscribe("paraview/update",a)},r=function(){PubSub.unsubscribe("paraview/create",a),PubSub.unsubscribe("Document/modify",a),PubSub.unsubscribe("Document/update",a)},a=function(e){editor.doc.locks&&(J(ViewManager.getViewElements(e)).find("div.lock-overlay,div.lock-icon-class,div.redact-icon-class").remove(),u(e.getIndex(),e.getEndIndex()))},s=function(e,t){var n,i,o,r,a,s=0,l=0,d=0,c=!1;if(!editor.doc.locks)return c;for(t=t||editor.zuid,n=editor.doc.locks.docOps,i=n.length;s<i;){if(o=n[s],o.isRetain())l+=o.retain_count;else if(o.isLock()){if(d=l,a=d+o.lock_data.range,d<e&&e<a){r=","+o.lock_data.data.allowed_zuids+",",o.lock_data.data.zuid==t||r.indexOf(","+t+",")>-1||(c=!0);break}l+=o.lock_data.range}s++}return c},l=function(e){if(editor.doc.locks){var t,n,i,o,r=editor.doc.locks.docOps,a=0,s=0,l=0;for(t=r.length;a<t;){if(n=r[a],n.isRetain())s+=n.retain_count;else if(n.isLock()){if(l=s,o=l+n.lock_data.range,l<=e&&e<=o){i=DocOpBuilder.build([{r:l}]),i.push(DocOp.clone(n));break}s+=n.lock_data.range}a++}return i}},d=function(e,t,n){if(!editor.doc.locks&&!n)return[];var i,o,r,a,s=0,l=0,d=0,c=[],u={};for(i=n?n.docOps:editor.doc.locks.docOps,o=i.length;s<o;)r=i[s],r.isRetain()?l+=r.retain_count:r.isLock()&&(d=l,a=d+r.lock_data.range,(d<=e&&e<=a||d<=t&&t<=a||e<=d&&a<=t)&&(e>d&&(d=e),t<a&&(a=t),d!=a&&(u.start=d,u.end=a,u.data=r.lock_data.data,c.push(u)),u={}),l+=r.lock_data.range),s++;return c},c=function(e){var t,n=0;for(n=0,t=e.length;n<t;n++)J(e[n].el).find("div.lock-overlay").remove(),J(e[n].el).find("div.lock-icon-class").remove(),J(e[n].el).find("div.redact-icon-class").remove()},u=function(t,n,o){var r,a,s,l,c,u,p,h,f,m,g,T,_,E=[],v=[],S=[],b=!1;for(E=d(t,n,o),s=E.length,r=0;r<s;r++){if(l=E[r],b=l.data.redact,void 0==b&&(b=!1),p=DocTreeManager.getLeftAtIndex(l.start),h=editor.doc.getCharAt(l.end-1)==UNICODE.PARA?DocTreeManager.getLeftAtIndex(l.end-1):DocTreeManager.getLeftAtIndex(l.end),f=DocTreeManager.lineAtIndex(l.start),!f)return;m=DocTreeManager.linesBetween(l.start,l.end),g=m.length;var R=g>1;for(a=0;a<g;a++){0==a&&i++,f=m[a],T=J(f.el),_=document.createElement("div"),u=document.createElement("div"),_.className="lock-overlay",_.className+=" lock-class-"+i,_.id="lock-class-"+i,0==a&&0==b?(u.className="lock-icon-class",u.className+=" lock-icon-position",u.id="lock-icon-"+i):0==a&&1==b&&(u.className="redact-icon-class",u.className+=" lock-icon-position",u.id="redact-icon-"+i);var O={},D={};R?0===a?(O.left=p,D.left=p,O.width=f.width-p):(O.left=0,D.left=0,O.width=f.width>=h&&a+1==g&&l.end!=f.end?h:f.width):(O.left=p,D.left=p,l.end!=f.end||h?O.width=h-p:O.width=f.width);var y=parseFloat(T.css("padding-top")||0)+"px";if(O.top=y,D.top=y,O.height=f.height,D.height="1px",T.find(".zw-image").length&&(O["z-index"]=-10),c=l.data){var A="";c.zuid==editor.zuid||c.allowed_zuids&&(","+c.allowed_zuids+",").indexOf(","+editor.zuid+",")>-1?c.zuid!=editor.zuid&&c.allowed_zuids&&(","+c.allowed_zuids+",").indexOf(","+editor.zuid+",")>-1?(0==b?(A=J.i18n("writer.lock.info.MSG1"),u.title=A,_.title=A):(A=J.i18n("writer.lock.info.MSG2"),_.title=A,u.title=A),_.className+=" editable-permitted"):c.zuid==editor.zuid&&(0==b?(A=J.i18n("writer.lock.CONTENT_LOCKED_BY_YOU"),u.title=A,_.title=A):(A=J.i18n("writer.lock.CONTENT_HIDDEN_BY_YOU"),J(_).css({background:"#F5F5F5",opacity:".5",border:"1px dashed #808080"}),_.title=A,u.title=A),_.className+=" editable-permitted"):0==b?(A=J.i18n("writer.lock.CONTENT_LOCKED_BY_THE_AUTHOR"),u.title=A,_.title=A):(A=J.i18n("writer.lock.CONTENT_HIDDEN_BY_THE_AUTHOR"),u.title=A,_.title=A)}J(_).css(O).appendTo(T[0]),v.push(_),J(u).css(D).appendTo(T[0]),S.push(u)}for(var C=v,I=0,w=C.length;I<w;I++)e(C[I])}},p=function(e,t){if(e==t){var n=l(e).getDocOps();e=n[0].length(),t=e+n[1].length()}Op.processMsg([{r:e},{lk:{range:t-e},data:{state:"unlock",type:"",redact:!1}}])},h=function(){n=!0,editor.setEditable(!1),editor.doc.getSelection().applyOnSelection(p)},f=function(e,t,n){var i=[{r:e},{lk:{range:t-e},data:{allowed_zuids:n?n.allowed_zuids:"",restricted_zuids:"",zuid:editor.zuid,type:"",state:"lock"}}];!n||1!=n.redact&&0!=n.redact||(i[1].data.redact=n.redact),Op.processMsg(i)},m=function(e){n=!0,editor.setEditable(!1),editor.doc.getSelection().applyOnSelection(f,e)},g=function(e){n=!0,editor.setEditable(!1);var t=editor.doc.getSelection().getStart(),i=editor.doc.getSelection().getEnd(),o=editor.doc.getSectionStart(t),r=editor.doc.getSectionEnd(t);f(o+1,t,e),f(i,r-1,e)},T=function(e,t,n,i){var o,r,a,s=e==t;s||(r=DocTreeManager.lineAtIndex(e),r&&(a=DocTreeManager.lineAtIndex(t)),r&&a&&(o=DocTreeManager.linesBetween(e,t),c(o))),i?editor.doc.locks?(editor.doc.locks=DocOpBuilder.compose(editor.doc.locks,n),editor.doc.locks=DocOpBuilder.concise(editor.doc.locks)):editor.doc.locks=n:editor.doc.locks&&(editor.doc.locks=DocOpBuilder.concise(DocOpBuilder.compose(editor.doc.locks,n)),editor.doc.locks=DocOpBuilder.cleanUpUnlockOp(editor.doc.locks)),!s&&r&&a&&u(o[0].start,o[o.length-1].end,editor.doc.locks)},_=function(){n&&(n=!1,editor.setEditable(!0))},E=function(){editor.addChar("  ");var e=editor.doc.getSelection(),t={},n=editor.doc.createRange(e[0].start-2,e[0].start);e.removeAllRanges().addRange(n),t.allowed_zuids=editor.zuid,t.redact=!0,m(t),Op.sendMsg(),n=editor.doc.createRange(e[0].start+1,e[0].start+1),e.removeAllRanges().addRange(n),CurUtil.blinkCursor(),EditorUtil.focusMultiByteSpan(),Utils.addToStatistics("Redact")},v=function(){editor.doc.getRole()===USER_ROLE.PUBLIC||is_wkhtmltopdf_browser||o()};return{init:v,lockSelection:m,lockUnSelection:g,insertRedact:E,unlockSelection:h,getLock:l,getLockRanges:d,updateLock:T,updateLockStatus:_,isIdxInLockArea:s}}();var TableUtil=function(){var e=function(e,t){if(0===e){var n=new Error(ZWCollaboration.TABLE_API_IDX_ERR);throw editor.lastError=n,n}var i,o=editor.doc.getDocumentContent(),r=editor.doc.getSectionStart(e),a=0;for(i=editor.doc.findPreviousIndexOf(UNICODE.TABLEEND+"|"+t,e,o);i>0&&i>r;){var s=o.charAt(i);if(s!=UNICODE.TABLEEND)return i;var l=TableUtil.getStart(i,UNICODE.TABLE);l<0?a++:i=l,i=editor.doc.findPreviousIndexOf(UNICODE.TABLEEND+"|"+t,i,o)}return-1},t=function(e,t,n){if(0===e){var i=new Error(ZWCollaboration.TABLE_API_IDX_ERR);throw editor.lastError=i,i}var o;n?o=n.length:(n=editor.doc.getDocumentContent(),o=editor.doc.getSectionEnd(e));for(var r,a=0,s=0!=t.length?"|"+t:"",l=Utils.findNextIndexOf(UNICODE.TABLE+"|"+UNICODE.TABLEEND+s,e,n);l>0&&l<o;){var d=n.charAt(l);if(d==UNICODE.TABLE)r=TableUtil.getEnd(l+1,""),r<0?(l++,a++):l=r+1;else if(d===UNICODE.TABLEEND||t.indexOf(d)>-1)return l;l=Utils.findNextIndexOf(UNICODE.TABLE+"|"+UNICODE.TABLEEND+s,l,n)}return-1},n=function(e){return o(e.dtNode.cols)},o=function(e){var t,n,i;t=Array.isArray(e)?[]:{};for(i in e)n=e[i],t[i]="object"==typeof n?o(n):n;return t},r=function(e,t){t[ATTR_TABLE.TBLS_VER]="4.0",e.attr(t)},a=function(e){var t,n=TableUtil.getCols(e),i=n.length,o=[],r=e.attr();if(u(r))for(t=0;t<i;t++)o.push(parseFloat(n[t].wt)*editor.doc.getPaperWidth()/100);else for(t=0;t<i;t++)o.push(n[t].wt.convertor().pixels);return o},s=function(e){var t,n,i=editor.doc.getElementAt(e),o=i.attr(ATTR_TABLE.TBLS_WID),r=[];if(o&&o.indexOf(UNITS.PERCENTAGE)!==-1){var s=TableUtil.getCols(i);for(t=s.length,n=0;n<t;n++)r.push(parseFloat(s[n].wt))}else{o=Conversions.toPixels(o);var l=a(i);for(t=l.length,n=0;n<t;n++)r.push(Math.round(l[n]/o*100*100)/100)}return r},l=function(e){for(var t=0;e;)t++,e=e.previousSibling();return t},d=function(e){for(var t=0;e;)t++,e=e.previousSibling();return t},c=function(e){var t=editor.doc.getRawFormatAt(e);t=t?t:{};var n=t[ATTR_CELL.TDS_MRG];return!n||"fc"===n},u=function(e){var t=e&&e[ATTR_TABLE.TBLS_WID]?e[ATTR_TABLE.TBLS_WID]:"";return t+="",t.indexOf(UNITS.PERCENTAGE)!==-1},p=function(e){var t=e&&e[ATTR_CELL.TDS_WID]?e[ATTR_CELL.TDS_WID]:"";return t+="",t.indexOf(UNITS.PERCENTAGE)!==-1},h=function(e){var t=1,n=DocTreeManager.getTreeNodeAtIndex(e);if("section"===n.parent.type){var i=ViewManager.getColumnWidth()/Conversions.globalUnitInPx,i=ViewManager.getColumnWidth()/Conversions.globalUnitInPx;t=i.toFixed(3)+Conversions.globalUnit}else{var o=n.parent.width;t=Conversions.toGlobalValue(o+UNITS.PIXELS)}return t},f=function(e){var t=1,n=DocTreeManager.getTreeNodeAtIndex(e),i=n.parent.parent;return t=i.actualWidth+UNITS.PIXELS,Conversions.isInInches?t=t.convertor().inches:Conversions.isInMM&&(t=t.convertor().millimeters),t},m=function(e,t){if(u(t)){t=DocUtil.copyStyle(t);var n=t[ATTR_TABLE.TBLS_WID]?parseFloat(t[ATTR_TABLE.TBLS_WID]).toFixed(3):1,i=parseFloat(h(e)),o=(n/100*i).toFixed(3);t[ATTR_TABLE.TBLS_WID]=o+Conversions.globalUnit}return t},g=function(e,t){if(p(t)){t=DocUtil.copyStyle(t);var n=t[ATTR_CELL.TDS_WID]?parseFloat(t[ATTR_CELL.TDS_WID]).toFixed(3):1,i=f(e),o=(n/100*i).toFixed(3);t[ATTR_TABLE.TBLS_WID]=o+Conversions.globalUnit}return t},T=function(e){var t=e.firstChild();return t.children().length},_=function(e){return e.children().length},E=function(e){var t=e.children(),n=[];return U.each(t,function(e){n=n.concat(e.children())}),n},v=function(e){var t,n=e.parentNode,i=n.children,o=i.length;for(t=0;t<o;t++)if(i[t]==e)return t},S=function(e){return Conversions.toGlobalValue(DTTableUtils.getCellWidth(e.dtNode)+UNITS.PIXELS)},b=function(e){return e.parentNode().type==NODE_TYPE.CELL},R=function(e,t){var n=editor.doc.getParents(NODE_TYPE.TABLE,editor.doc.getSelection().getStart()),i=TableResize.getResizedCellIdx(e),o=TableResize.resizeColumnWidth(i,n,t);editor.doc.execCmd("applyStyle",[o.eleArr,o.styArr,i==n.attr().cols.length?"updateLastColumnWidth":"updateColumnWidth"])},O=function(){var e=[],t=editor.doc.getParents(NODE_TYPE.ROW,editor.doc.getSelection().getStart()).dtNode;if(t)for(var n=t.children.length,i=0;i<n;i++)t.children[i].merge&&"fc"!=t.children[i].merge||e.push(t.children[i].actualWidth+UNITS.PIXELS);return e},D=function(e){var t=e.rawFormat,n=t[ATTR_TABLE.TBLS_AL],i=t[ATTR_TABLE.TBLS_ML],o=0+Conversions.globalUnit;if(i)o=i;else if(n)if("left"==n)o=0+Conversions.globalUnit;else if("right"==n||"center"==n){var r=ViewManager.getColumnWidth()/Conversions.globalUnitInPx,a=e.parent;if(a&&"cell"==a.type){var s=editor.doc.getElementAt(a.getIndex()),l=s.parentNode().parentNode().dtNode.cols,l=s.parentNode().parentNode().dtNode.cols,d=TableUtil.findColIdx(s);r=r=Conversions.toGlobalUnit(l[d-1].wt)}var c;c=t[ATTR_TABLE.TBLS_WID].indexOf("%")!=-1?parseFloat(t[ATTR_TABLE.TBLS_WID])*parseFloat(r)/100:Conversions.toGlobalUnit(t[ATTR_TABLE.TBLS_WID]);var u=parseFloat(r)-parseFloat(c);-parseFloat(c),"center"==n?o=u/2+Conversions.globalUnit:"right"==n&&(o=u+Conversions.globalUnit)}return o},y=function(e){var t=0;if(e.parent&&"cell"==e.parent.type){var n=ViewManager.getViewElements(e,editor.getPageID());t+=parseFloat(Conversions.toGlobalValue(J(n).offset().left-Z("editorpane").offset().left+UNITS.PIXELS))}else t=parseFloat(TableUtil.calculateTableMarginLeft(e)),t+=parseFloat(Conversions.toGlobalValue(ViewManager.getCurrentColumnLeft()+UNITS.PIXELS)),t+=parseFloat(Conversions.toGlobalValue(editor.doc.getBodyFormat().ml));return t+Conversions.globalUnit},A=function(e){for(var t=!1,n=e.children(),i=0,o=n.length;i<o;i++){var r=n[i].attr("*");if(r&&("vmp"===r[ATTR_CELL.TDS_MRG]||r[ATTR_CELL.TDS_RSPAN]>1)){t=!0;break}}return t},C=function(e){for(var t=e.parentNode(),n=t.nodeCountBefore(e),i=!1;t;){var o=t.children(),r=o[n],a=r.attr();a&&("hmp"===a[ATTR_CELL.TDS_MRG]||a[ATTR_CELL.TDS_CSPAN]>1)&&(i=!0),t=t.nextSibling()}return i},I=function(e){var t;if(e.tblLook)t=e.tblLook;else{t={firstRow:0,lastRow:0,firstColumn:0,lastColumn:0,noHBand:1,noVBand:1};for(var n in e)switch(n){case"firstRow":t.firstRow=1;break;case"lastRow":t.lastRow=1;break;case"firstColumn":t.firstColumn=1;break;case"lastColumn":t.lastColumn=1;break;case"band1Horz":t.noHBand=0;break;case"band2Horz":t.noHBand=0;break;case"band1Vert":t.noVBand=0;break;case"band2Vert":t.noVBand=0}}return t},w=function(e,t){var n=e.parent,i=n.getChildIndex()+1,o=n.parent.children.length,r=e.getChildIndex()+1,a=n.children.length,s=[];return t.firstRow&&1==i?(1==i&&1==r?s.push("nwCell"):1==i&&r==a&&s.push("neCell"),s.push("firstRow")):t.lastRow&&i==o&&(i==o&&r==a?s.push("seCell"):i==o&&1==r&&s.push("swCell"),s.push("lastRow")),t.firstColumn&&1==r?s.push("firstColumn"):t.lastColumn&&r==a&&s.push("lastColumn"),t.noVBand||(t.firstColumn?r%2==0?s.push("band1Vert"):"band2Vert":i%2==1?s.push("band1Vert"):"band2Vert"),t.noHBand||(t.firstRow?i%2==0?s.push("band1Horz"):"band2Horz":i%2==1?s.push("band1Horz"):"band2Horz"),s},P=function(e){var t=DocTreeManager.getParents(NODE_TYPE.PARAGRAPH,e);if("cell"!=t.parent.type)return null;var n=t.parent.parent.parent,i=editor.doc.getRawFormatAt(n.getIndex()),o=U.keys(n[ATTR_TABLE.TBLS_THEME][ATTR_TABLE.TBLS_THEME_OBJECT]),r=!0,a=U.find(o,function(e){return n[ATTR_TABLE.TBLS_THEME][ATTR_TABLE.TBLS_THEME_OBJECT][e].hasOwnProperty("para")});if(r=!!a,!r)return null;for(var s=t.parent,l=s.parent,d=(editor.doc.getRawFormatAt(s.getIndex()),n[ATTR_TABLE.TBLS_THEME][ATTR_TABLE.TBLS_THEME_OBJECT]),c=(s.getChildIndex()+1,l.getChildIndex()+1,n.children.length,l.children.length,I(d)),u=w(s,c),p=i.hasOwnProperty("para")?i.para:{},e=u.length-1;e>-1;e--){var h=u[e],f=d[h];f&&f.hasOwnProperty("para")&&(p=Utils.mergeObjs([p,f.para]))}return p},M=function(e){tableFormat=DocUtil.copyStyle(editor.doc.getRawFormatAt(e.getIndex())),themeJSON=e[ATTR_TABLE.TBLS_THEME][ATTR_TABLE.TBLS_THEME_OBJECT],tblLook=I(themeJSON),tblProps=themeJSON.tblPr?themeJSON.tblPr:{},tblBorders=tblProps.borders?tblProps.borders:{};tableFormat[ATTR_COMMON.BORDERS];return Utils.mergeObjs([{borders:tblBorders},tableFormat])},L=function(e){rowNode=e.parent,tableNode=rowNode.parent,tableFormat=DocUtil.copyStyle(editor.doc.getRawFormatAt(tableNode.getIndex())),cellFormat=DocUtil.copyStyle(editor.doc.getRawFormatAt(e.getIndex())),themeJSON=tableNode[ATTR_TABLE.TBLS_THEME][ATTR_TABLE.TBLS_THEME_OBJECT],cellIndex=e.getChildIndex()+1,rowIndex=rowNode.getChildIndex()+1,rowCount=tableNode.children.length,colCount=rowNode.children.length,tblLook=I(themeJSON),cellLocArray=w(e,tblLook);var t={},n=themeJSON.tblPr?themeJSON.tblPr:{};if(!U.isEmpty(n)&&(n.cell&&(t.bgc=n.cell.bgc?n.cell.bgc:null,t[ATTR_CELL.TDS_VA]=n.cell[ATTR_CELL.TDS_VA]?n.cell[ATTR_CELL.TDS_VA]:null),t.borders={},U.isEmpty(n.borders)||(t.border[ATTR_BORDERS.BORDER_TOP]=1==rowIndex?n.borders[ATTR_BORDERS.BORDER_TOP]:n.borders.insideH,t.border[ATTR_BORDERS.BORDER_LEFT]=1==cellIndex?n.borders[ATTR_BORDERS.BORDER_LEFT]:n.borders.insideV,t.border[ATTR_BORDERS.BORDER_RIGHT]=cellIndex==colCount?n.borders[ATTR_BORDERS.BORDER_RIGHT]:n.borders.insideV,t.border[ATTR_BORDERS.BORDER_BOTTOM]=rowIndex==rowCount?n.borders[ATTR_BORDERS.BORDER_BOTTOM]:n.borders.insideH),n.tblCellMar)){var i=[ATTR_CELL.TDS_PT,ATTR_CELL.TDS_PB,ATTR_CELL.TDS_PL,ATTR_CELL.TDS_PR];U.each(i,function(e){t[e]=n.tblCellMar[e]?n.tblCellMar[e]:null})}for(var o=cellLocArray.length-1;o>-1;o--){var r=cellLocArray[o],a=TableThemeCSSGenerator.getCellStyles(r);t=Utils.mergeObjs([t,a])}return delete t.para,Utils.mergeObjs([t,cellFormat])},N=function(e,t,n,i){var o=e.attr("*"),r=o[ATTR_TABLE.TBLS_THEME][ATTR_TABLE.TBLS_THEME_OBJECT],a=i?r.sectionName:r;J.isEmptyObject(t)||(a.para=t),J.isEmptyObject(n)||(a.cell=n),e.attr({theme:r})},x=function(e,t){TableTemplate[t]=e;var n={};csrfParamName&&(n[csrfParamName]=getcsrf()),n.TableTemplate=JSON.stringify(TableTemplate),J.post(Utils.getNiceUrlPrefix("user/settings/savetabletemplateinfo"),n,function(){})},k=function(){var e=editor.doc.getSelection(),t=e.parents(NODE_TYPE.TABLE);if(!t)return null;var n={style:t.attr("*"),children:[]},i=t.children();return U.each(i,function(e,t){var i=e.children("*"),o=[];U.each(i,function(e,t){var n=e.attr("*");o.push({style:n,children:[]})}),n.children.push({style:e.attr("*"),children:o})}),n},F=function(e,t){var n=[],i=editor.doc.getSelection(),t=t?t:{type:"paragraph"};n.push({r:i.getStart()},{as:{start:t}},{is:UNICODE.PARA},{as:{end:U.keys(t)}});var o=e.style;n.push({as:{start:o}},{is:UNICODE.TABLE},{as:{end:U.keys(o)}}),U.each(e.children,function(e){n.push({as:{start:e.style}},{is:UNICODE.ROW},{as:{end:U.keys(e.style)}});var i=e.children;U.each(i,function(e){n.push({as:{start:e.style}},{is:UNICODE.CELL},{as:{end:U.keys(e.style)}}),n.push({as:{start:t}},{is:UNICODE.PARA},{as:{end:U.keys(t)}})})}),n.push({is:UNICODE.TABLEEND}),n.push({as:{start:t}},{is:UNICODE.PARA},{as:{end:U.keys(t)}}),Op.processMsg(n)},Y=function(e){var t=e.parentNode(),n=t.children(),o=t.parentNode().children(),r=(n.length,e.attr()),a=null,s=TableUtil.findColIdx(e),l=TableUtil.findRowIdx(t);o.length;if("fc"==e.attr().merge)a=e;else if("hmp"==e.attr().merge)for(j=s-2;j>=0;j--){if("fc"==n[j].attr().merge){a=n[j];break}if("vmp"==n[j].attr().merge)for(i=l-2;i>=0;i--){var d=o[i].children()[j];if("fc"==d.attr().merge)return a=d}}else if("vmp"==r.merge)for(j=l-2;j>=0;j--){var d=o[j].children()[s-1];if("fc"==d.attr().merge){a=d;break}}return a};getBoundaryCellsForTable=function(e){var t,n=e.children(),i=n.length,o=n[0].children(),r=n[i-1].children(),a=[],s=[],l=o.length-1;for(t=0;t<i;t++)a.push(n[t].children()[0]),s.push(n[t].children()[l]);return{firstRowCells:o,lastRowCells:r,firstColCells:a,lastColCells:s}},getSurroundingCells=function(e){var t=TableUtil.findColIdx(e)-1,n=e.parentNode().children(),i=n[t-1]?n[t-1]:void 0,o=n[t+1]?n[t+1]:void 0,r=e.parentNode().previousSibling(),a=r?r.children():[],s=a[t]?a[t]:void 0,l=e.parentNode().nextSibling(),d=l?l.children():[],c=d[t]?d[t]:void 0,u={};return s&&(u.topCell=s),i&&(u.leftCell=i),o&&(u.rightCell=o),c&&(u.bottomCell=c),u},getDTTableStructure=function(e,t){var n=function(e){var t=e.getIndex(),n={};n.type=NODE_TYPE.TABLE,n.styles=editor.doc.getRawFormatAt(t),n.children=[];for(var o=e.children,r=0,a=o.length;r<a;r++){var s=o[r];n.children.push(i(s))}return n},i=function(e){var t=e.getIndex(),n={};n.type=NODE_TYPE.ROW,n.styles=editor.doc.getRawFormatAt(t),n.children=[];for(var i=e.children,r=0,a=i.length;r<a;r++){var s=i[r];n.children.push(o(s))}return n},o=function(e){var i=e.getIndex(),o={};if(o.type=NODE_TYPE.CELL,o.styles=editor.doc.getRawFormatAt(i),o.children=[],!t)for(var a=e.children,s=0,l=a.length;s<l;s++){var d,c=a[s],u=c.type;switch(u){case"para":d=r(c);break;case"table":d=n(c)}o.children.push(d)}return o},r=function(e){var t=e.getEndIndex(),n=e.getIndex(),i={};i.type=NODE_TYPE.PARAGRAPH,i.styles=editor.doc.getRawFormatAt(t),i.children=[];for(var o=e.segments,r=0,a=o.length;r<a;r++){var s=o[r],l=editor.doc.getContent(n+s.start,n+s.end);style=editor.doc.getRawFormatAt(n+s.start);var d={};d.type=style.type,d.str=l,d.style=style,i.children.push(d)}return i};return n(e)};var B=function(e){return TableUtil.getStart(e,UNICODE.TABLE)},H=function(e){var e=TableUtil.getEnd(e,"");if(e>0)return e+1},W=function(e){return TableUtil.getStart(e,UNICODE.ROW)},V=function(e){return TableUtil.getEnd(e,UNICODE.ROW)},G=function(e){return TableUtil.getStart(e,UNICODE.CELL)},z=function(e){return TableUtil.getEnd(e,UNICODE.ROW+"|"+UNICODE.CELL)},X=function(e,t){var n=new Array,i=Utils.nodeNameEquals(e,"table")?e:J(e).parents("table")[0];return J(e).find(t).each(function(){J(this).parents("table")[0]==i&&n.push(this)}),n},K=function(e){for(var t=editor.doc.collabUsers,n=t.length,i=editor.doc.getAllSelections(),o=0;o<n;o++){var r=t[o].uuid,a=i[r];if(editor.uuid!=r&&a){var s=a.getStart(),l=editor.doc.getParents(NODE_TYPE.TABLE,s);if(l){if(e.getStart()==l.getStart())return!0;for(var d=e;TableUtil.isInnerTable(d);)d=editor.doc.getParents(NODE_TYPE.TABLE,d.getStart()-1);for(;TableUtil.isInnerTable(l);)l=editor.doc.getParents(NODE_TYPE.TABLE,l.getStart()-1);if(d.getStart()==l.getStart())return!0}}}return!1},$=function(e){var t=editor.doc.getParents(NODE_TYPE.CELL,e);if(!t)return{};var n=DocTreeManager.getDOMnodeFromDTnode(t.dtNode),i=J(n).css("background-color");return{"background-color":i}},q=function(e){var t,n,i=[],o=e.children(),r=o.length;for(t=0;t<r;t++){var a=o[t],s=a.children(),l=s.length;for(n=0;n<l;n++){var d=s[n];d.parent=a,i.push(d)}}var c={allCells:i};return c};return{getStart:e,getEnd:t,getCols:n,getColumnWidthsInPx:a,getColumnWidthsInPercentage:s,findRowIdx:l,findColIdx:d,getNumberOfColumns:T,getNumberOfRows:_,isVisibleCell:c,isTableWidthInPercentage:u,isCellWidthInPercentage:p,processTableWidth:m,processCellWidth:g,getMaxTableWidth:h,getCellsFromTable:E,getParaStylesFromTableTheme:P,getCellStylesFromTableTheme:L,getTableStylesFromTableTheme:M,updateTableThemeInfo:N,getCellIdx:v,getParentTableWidth:f,setTableAttr:r,getCellWidth:S,getTableTemplateInfo:k,insertTableUsingTemplateInfo:F,isInnerTable:b,updateCurrentColumn:R,getCurrRowsVisibleColWidth:O,calculateTableMarginLeft:D,getTableLeftPosition:y,isVerticalMergedRow:A,isHorizontalyMergedColumn:C,saveTableTemplateInfo:x,getFirstCell:Y,getBoundaryCellsForTable:getBoundaryCellsForTable,getSurroundingCells:getSurroundingCells,getDTTableStructure:getDTTableStructure,getTableStart:B,getTableEnd:H,getRowStart:W,getRowEnd:V,getCellStart:G,getCellEnd:z,findNodesInTable:X,getCellBgcAt:$,isCollabsInTable:K,getTableCells:q}}();DocOpUtil.getTextStyle=function(e){var t,n,i,o={};for(t=e;t>=0;t--)if(n=editor.doc.getRawFormatAt(t)){if(i=n[ATTR_COMMON.TYPE],i==NODE_TYPE.SECTION)break;if(i==NODE_TYPE.PARAGRAPH){editor.doc.getCharAt(e)==UNICODE.PARA&&(o=n[ATTR_PARAGRAPH.PS_TS]||{}),o[ATTR_COMMON.TYPE]=NODE_TYPE.TEXT;break}if(i==NODE_TYPE.TEXT&&n.st!=NODE_TYPE.TAB&&n[ATTR_COMMON.CLS]!=NODE_TYPE.ENDNOTE&&n[ATTR_COMMON.CLS]!=NODE_TYPE.FOOTNOTE){o=DocUtil.copyStyle(n);var r=o[ATTR_COMMON.CLS];r&&r.indexOf("link")==-1&&r.indexOf("comment")==-1&&delete o[ATTR_COMMON.CLS];break}}return o},DocOpUtil.updateStyles=function(e,t){var n=t.type,i=t.st,o=(e[ATTR_TEXT.CLS],!(!e||"body"!==e.type));if(t[ATTR_PARAGRAPH.PS_NULL]&&e[ATTR_COMMON.TYPE]==NODE_TYPE.PARAGRAPH||t[ATTR_TEXT.TS_NULL]&&e[ATTR_COMMON.TYPE]==NODE_TYPE.TEXT)for(var r in e)!e.hasOwnProperty(r)||"type"==r||"id"==r||"cls"==r||r==ATTR_COMMON.FIELDINFO||r==ATTR_LINK.LINK_TYPE||r==ATTR_LINK.LINK_URL||r==ATTR_LINK.LINK_TARGET||r==ATTR_LINK.LINK_TOOLTIP||r==TCConstants.TC||"st"==r&&e.st==NODE_TYPE.TAB||delete e[r];for(var r in t)if(t.hasOwnProperty(r)){var a=t[r];if(r!=ATTR_PARAGRAPH.PS_NULL&&r!=ATTR_TEXT.TS_NULL)if(""===a&&null!=a||r==ATTR_PARAGRAPH.TEXTFORMAT)r==ATTR_IMAGE.I_AL&&(delete e.fid,delete e.pl),delete e[r];else if(n==NODE_TYPE.TEXT&&i!=NODE_TYPE.LINK)if(r==ATTR_TEXT.TS_TD){var s=e[r];s&&"none"!=s?"underline"==s&&"line-through"==a?e[r]=s+" "+a:"line-through"==s&&"underline"==a?e[r]=a+" "+s:e[r]=a:e[r]=a}else if("cls"==r)if("unlink"==a){var l=e.cls;if(l){var d="unlink"==a?NODE_TYPE.LINK:"",c=l.replace(d,"").trim();"unlink"==a&&(delete e[ATTR_LINK.LINK_URL],delete e[ATTR_LINK.LINK_TARGET],delete e[ATTR_LINK.LINK_TOOLTIP]),e[r]=c}}else if(e[r]&&a){var u=e[r].split(" "),p=a.split(" "),h=Utils.commonElementsInArray(u,p);h.length||"endnote"===a||"footnote"===a?e[r]=a:e[r]+=" "+a}else(!e[r]&&a||e[r]&&!a)&&(e[r]=a);else r===TCConstants.TC?DocOpUtil.updateTCStyles(e,t):e[r]=a;else if(n!=NODE_TYPE.PARAGRAPH||r!=ATTR_PARAGRAPH.PS_TYPE&&r!=ATTR_PARAGRAPH.LS_DATA)if(n==NODE_TYPE.PARAGRAPH&&r==ATTR_PARAGRAPH.PS_TS){var a=t[ATTR_PARAGRAPH.PS_TS];e[ATTR_PARAGRAPH.PS_TS]||(e[ATTR_PARAGRAPH.PS_TS]={}),jQuery.isEmptyObject(a)?e[ATTR_PARAGRAPH.PS_TS]=a:DocOpUtil.updateStyles(e[ATTR_PARAGRAPH.PS_TS],a)}else if(r!=TCConstants.TC||n!=NODE_TYPE.TABLE&&n!=NODE_TYPE.ROW&&n!=NODE_TYPE.CELL&&n!=NODE_TYPE.TABLEEND&&n!=NODE_TYPE.TOC&&n!=NODE_TYPE.TOCEND&&n!==NODE_TYPE.COMMENT&&n!==NODE_TYPE.LINK&&n!==NODE_TYPE.AUTOFIELD&&n!==NODE_TYPE.MAILMERGEFIELD&&n!==NODE_TYPE.BOOKMARK&&n!=NODE_TYPE.IMAGE&&n!=NODE_TYPE.PARAGRAPH&&n!==NODE_TYPE.HR&&n!==NODE_TYPE.IFRAME&&n!==NODE_TYPE.FOOTNOTE&&n!==NODE_TYPE.ENDNOTE&&n!==NODE_TYPE.SECTION)if(n==NODE_TYPE.IMAGE&&r===ATTR_IMAGE.I_ROTATE&&0===a)delete e[ATTR_IMAGE.I_ROTATE];else if("st"==r&&"listFormat"==a&&n==NODE_TYPE.BODY)for(var f in t)"st"==f||"type"==f||isNaN(parseInt(f))||"undefined"==typeof t[f]||(editor.doc.bodyFormat.listFormat[f]=t[f],List.listIds[f]=f);else r===ATTR_BODY.TC_ISENABLED?(e[r]=a,e.hasOwnProperty(ATTR_BODY.TC_COLLAB_LIST)&&"true"===a&&(e[ATTR_BODY.TC_COLLAB_LIST]=[])):r===ATTR_BODY.TC_ON_BY_COLLAB?e.hasOwnProperty(ATTR_BODY.TC_COLLAB_LIST)?e[ATTR_BODY.TC_COLLAB_LIST].push(a):e[ATTR_BODY.TC_COLLAB_LIST]=[a]:r===ATTR_BODY.TC_OFF_BY_COLLAB&&e.hasOwnProperty(ATTR_BODY.TC_COLLAB_LIST)?Utils.arrayContains(e[ATTR_BODY.TC_COLLAB_LIST],a)&&e[ATTR_BODY.TC_COLLAB_LIST].splice(e[ATTR_BODY.TC_COLLAB_LIST].indexOf(a),1):r===ATTR_TABLE.TBLS_THEME&&"table"==e.type?(e[ATTR_TABLE.TBLS_THEME]=t[ATTR_TABLE.TBLS_THEME],e[ATTR_COMMON.BORDERS]&&delete e[ATTR_COMMON.BORDERS],e.z_tbl_bgc&&delete e.z_tbl_bgc):"removeBorder"===r&&"cell"==e.type?(e[ATTR_COMMON.BORDERS]&&(delete e[ATTR_COMMON.BORDERS],delete e.removeBorder),e[ATTR_CELL.Z_TD_BGC]&&delete e[ATTR_CELL.Z_TD_BGC]):"id"!=r&&"level"!=r&&"st"!=r&&isNaN(parseInt(r))?(o&&(r===ATTR_BODY.DS_VIEW&&EditorView.setView(a),PubSub.publish("Document/"+r+"/changed",a,e[r])),e[r]=a,r!=ATTR_BODY.DS_THEME&&r!=ATTR_BODY.DS_STYLES||DocUtil.setDocStyleObject()):n==NODE_TYPE.SECTION&&(e[r]=a);else DocOpUtil.updateTCStyles(e,t);else e.ls_data&&parseInt(e.ls_data.id)>=0&&(List.listIds[e.ls_data.id]=e.ls_data.id),t.ls_data&&parseInt(t.ls_data.id)>=0&&(List.listIds[t.ls_data.id]=t.ls_data.id),a&&""!=a&&t.ls_data&&t.ls_data.l>=0?(delete t.ls_data.t,e[r]=a):(delete e[ATTR_PARAGRAPH.LS_DATA],delete e[ATTR_PARAGRAPH.PS_TYPE])}},DocOpUtil.updateTCStyles=function(e,t){var n=e[TCConstants.TC]||[],i=t[TCConstants.TC];if(!jQuery.isArray(n)||!jQuery.isArray(i))throw"Error in TC";for(var o=0;o<i.length;o++){var r=i[o],a=r[TCConstants.TASK];if(a&&a==TCConstants.REMOVE){for(var s=n.length,l=0;l<s;l++){var d=n[l];r[TCConstants.ACTION]==d[TCConstants.ACTION]&&r[TCConstants.ZUID]==d[TCConstants.ZUID]&&(n.splice(l,1),s--,l--)}0==s&&delete e[TCConstants.TC]}else{for(var c=!1,l=0,s=n.length;l<s;l++){var d=n[l];r[TCConstants.ACTION]==d[TCConstants.ACTION]&&(d[TCConstants.ZUID]=r[TCConstants.ZUID],c=!0)}c||(e[TCConstants.TC]||(n=[],e[TCConstants.TC]=n),n.push(r))}}},DocOpUtil.setStylesInRange=function(e,t,n,i){var o=editor.doc.getRawFormatAt(e);if(!o){var r=editor.doc.getCharAt(e);for(var a in n)DOC_CHARS.hasOwnProperty(a)?r==DOC_CHARS[a]&&editor.doc.setFormatAt(e,{type:a}):editor.doc.setFormatAt(e,{type:a})}for(var s,l,d,c={},u=[],p=[],h=e;h<t;h++){var f=editor.doc.getRawFormatAt(h),r=editor.doc.getCharAt(h);if(f&&editor.doc.snapShotManager&&editor.doc.snapShotManager.isSnapShotAllowed()){if(l){i.push({r:h-s});for(var m=0,g=p.length;m<g;m++)i.push({as:{end:DocUtil.getKeys(p[m]),id:u[m]}});u=[],p=[]}s=h;for(var a in n){var T=new DocOp;T.changeStyles(null,n[a]),l=editor.doc.snapShotManager.takeFmtBackup(h,T,!0),p.push(l);var d=Utils.randomString();u.push(d),i.push({as:{start:l,id:d}})}}if(f)if(f.type==NODE_TYPE.TEXT&&n[f.type])DocOpUtil.updateStyles(f,n[f.type]),"none"==n[f.type].link_type&&delete f.st,c&&Utils.compareJSON(c,f)?editor.doc.setFormatAt(h,null):c=f;else if(c=null,f.type==NODE_TYPE.PARAGRAPH&&(n[NODE_TYPE.TEXT]||n[NODE_TYPE.PARAGRAPH])){if(n[NODE_TYPE.TEXT]){var _={},E=DocUtil.copyStyle(n[NODE_TYPE.TEXT]);_.type=NODE_TYPE.PARAGRAPH,E[ATTR_TEXT.TS_NULL]&&delete E[ATTR_TEXT.TS_NULL],_[ATTR_PARAGRAPH.PS_TS]=E,DocOpUtil.updateStyles(f,_)}n[NODE_TYPE.PARAGRAPH]&&DocOpUtil.updateStyles(f,n[NODE_TYPE.PARAGRAPH])}else n[f.type]?DocOpUtil.updateStyles(f,n[f.type]):"footnote"===f.type&&n[NODE_TYPE.ENDNOTE]?DocOpUtil.updateStyles(f,n[NODE_TYPE.ENDNOTE]):"endnote"===f.type&&n[NODE_TYPE.FOOTNOTE]&&DocOpUtil.updateStyles(f,n[NODE_TYPE.FOOTNOTE])}if(l&&editor.doc.snapShotManager&&editor.doc.snapShotManager.isSnapShotAllowed()){i.push({r:t-s});for(var m=0,g=p.length;m<g;m++)i.push({as:{end:DocUtil.getKeys(p[m]),id:u[m]}})}},DocOpUtil.getAnnotationStartOp=function(e){var t,n,i={},o=e.length,r=0;for(r=0;r<o;r++)if(n=DocUtil.copyStyle(e[r]),t=n.type,i[t])for(var a in n)i[t][a]=n[a];else i[t]=n;return i},DocUtil.applyHeadingForSelection=function(e,t){if(t=t||editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH)||[],0!=t.length){var n,i={},o={};"undefined"!=typeof editor.doc.getHeadingListId()&&(n=editor.doc.getSelection().getAllHeadings());for(var r=t.length,a=0;a<r;a++){var s=t[a],l=parseInt(s.attr(ATTR_PARAGRAPH.PS_HD));if(l!=e){var d=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.TEXT,s.getStart(),s.getEnd()-1);o[ATTR_TEXT.TS_NULL]=!0;for(var c=0;c<d.length;c++){var u=d[c];u.attr(o)}var p=s.firstChild(),h=p&&p.type==NODE_TYPE.BOOKMARK&&0==p.id.indexOf("toc_");if("0"==e)h&&p.remove();else if(!h){var f=Utils.randomString();b="toc_"+Utils.randomString();var m={};m[ATTR_COMMON.TYPE]=NODE_TYPE.BOOKMARK,m[ATTR_COMMON.ID]=b,m[ATTR_COMMON.NAME]=f;var g={};g[ATTR_COMMON.TYPE]=NODE_TYPE.BOOKMARK,g[ATTR_COMMON.ID]=b;var T=Utils.randomString(),_=Utils.randomString();Op.processMsg([{r:s.getStart()},{as:{start:m,id:T}},{is:UNICODE.RANGE_START},{as:{end:DocUtil.getKeys(m),id:T}},{r:s.getEnd()-s.getStart()-1},{as:{start:g,id:_}},{is:UNICODE.RANGE_END},{as:{end:DocUtil.getKeys(g),id:_}}])}if("undefined"!=typeof editor.doc.getHeadingListId()){var E=editor.doc.getParaStyles()["h"+e][ATTR_PARAGRAPH.LS_DATA];if(E){var v,S;i[ATTR_PARAGRAPH.LS_DATA]=E,i[ATTR_PARAGRAPH.PS_TYPE]="list";var b=E.id,R=editor.doc.getListObj(b);editor.doc.getListObj(b).level0.htype;if(R.level0.htype!=HLIST_TYPE[18].level0.htype)v=List.getMinmL(n),mL=v,i[ATTR_PARAGRAPH.PS_ML]=mL+"in",i[ATTR_PARAGRAPH.PS_TI]="0in";else{var O;v=List.getMinmLForHeadingList(),S=List.getMinLevel(b),O=0!=S?v-.5*S:v,mL=O+.5*E.l,i[ATTR_PARAGRAPH.PS_ML]=mL+"in",i[ATTR_PARAGRAPH.PS_TI]="0in"}}}i[ATTR_PARAGRAPH.PS_NULL]=!0,i[ATTR_PARAGRAPH.PS_HD]=e,s.attr(i)}}}},DocUtil.copyStyle=function(e){return Utils.clone(e)||{}},DocUtil.copyArray=function(e){return Utils.clone(e)||[]},DocUtil.getStyleIndex=function(e,t,n,i){if("prev"==n){var o=editor.doc.getSectionStart(e);i&&(o=editor.doc.findPreviousIndexOf(CONT_REGEXP.BLOCKSTART,e+1));for(var r=e;r>o;r--){var a=editor.doc.getRawFormatAt(r);if(a&&a.type==t)return r}return editor.doc.getSectionStart(e)+1}if("next"==n){var o=editor.doc.getSectionEnd(e);i&&(o=editor.doc.findNextIndexOf(CONT_REGEXP.BLOCKSTART,e+1));for(var r=e+1;r<o;r++){var a=editor.doc.getRawFormatAt(r);if(a&&a.type==t)return r}return editor.doc.getSectionEnd(e)-1}},DocUtil.getTextStyleEnd=function(e){var t=editor.doc.findNextIndexOf(CONT_REGEXP.PORTION_END,e+1);t<0&&(t=editor.doc.getSectionEnd(e));for(var n=e+1;n<t;n++){var i=editor.doc.getRawFormatAt(n);if(i)return n}return t},DocUtil.getTextStyleStart=function(e){var t=editor.doc.getRawFormatAt(e);if(t)return e;var n=editor.doc.findPreviousIndexOf(CONT_REGEXP.PORTION_END,e-1);n<0&&(n=editor.doc.getSectionStart(e)+1);for(var i=e-1;i>n;i--)if(t=editor.doc.getRawFormatAt(i))return i;return n},DocUtil.isEmpty=function(e){return e.getEnd()-e.getStart()<=1},DocUtil.isList=function(e){return e&&e[ATTR_PARAGRAPH.PS_TYPE]&&"list"==e[ATTR_PARAGRAPH.PS_TYPE]},DocUtil.isHeadingList=function(e){return e&&e[ATTR_PARAGRAPH.LS_DATA]&&0==e[ATTR_PARAGRAPH.LS_DATA].id},DocUtil.getDocElement=function(e){if(!e)return null;var t=DocTreeManager.indexOfElement(e),n=editor.doc.getElementAt(t);return n},DocUtil.deleteTimeStampInTCStyle=function(e){for(var t=0,n=e.length;t<n;t++){var i=e[t];delete i[TCConstants.TIME]}},DocUtil.mergeAdjacentStyles=function(e){for(var t,n,i=0,o=100,r=editor.doc.findPreviousIndexOf(CONT_REGEXP.PORTION_END,e),a=e;a>0;a--){var s=editor.doc.getRawFormatAt(a);s?s.type:"";if(i++,i==o||a==r)break;if(s&&s.type==NODE_TYPE.TEXT){if(t){if(t[TCConstants.TC]&&s[TCConstants.TC]&&(t=DocUtil.copyStyle(t),s=DocUtil.copyStyle(s),DocUtil.deleteTimeStampInTCStyle(t[TCConstants.TC]),DocUtil.deleteTimeStampInTCStyle(s[TCConstants.TC])),!Utils.compareJSON(t,s))break;editor.doc.setFormatAt(n,null)}t=s,n=a}}i=0;var l=editor.doc.getSectionEnd(e);t=void 0,s=void 0,r=editor.doc.findNextIndexOf(CONT_REGEXP.PORTION_END,e);for(var a=e;a<l;a++){var s=editor.doc.getRawFormatAt(a);i++;s?s.type:"";if(i==o||a==r)break;if(s&&s.type==NODE_TYPE.TEXT)if(t){if(t[TCConstants.TC]&&s[TCConstants.TC]&&(t=DocUtil.copyStyle(t),s=DocUtil.copyStyle(s),DocUtil.deleteTimeStampInTCStyle(t[TCConstants.TC]),DocUtil.deleteTimeStampInTCStyle(s[TCConstants.TC])),!Utils.compareJSON(t,s))break;editor.doc.setFormatAt(a,null)}else t=s}},DocUtil.getDOMSourceIndex=function(e,t){var n=editor.doc.findPreviousIndexOf(UNICODE.SECTION_START,e),i=editor.doc.getContent(n+1,e+1),o=i.match(RegExp(t,"g"));return o?o.length-1:-1},DocUtil.mergeStyles=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]?"type"!=n&&e&&e[n]==t[n]&&delete e[n]:e[n]=t[n])},DocUtil.getComputedTextFormat=function(e){var t=editor.doc.getParents(NODE_TYPE.PARAGRAPH,e),n=t.getEnd(),i=DocUtil.getParaFormat(n-1),o=DocUtil.getTextStyle(e);DocUtil.constructRenderingFormat(o);var r=Utils.mergeObjs([i.textFormat,o]);return r=DocUtil.updateWithCharStyle(r)},DocUtil.getFloatElementRange=function(e,t){for(var n=e,i={},o={},r=null,a=null,s=!0,l=t;l<editor.doc.getDocumentLength();){if(l=editor.doc.findNextIndexOf(UNICODE.RANGE_START+"|"+UNICODE.RANGE_END,s?l:l+1),s=!1,l<0)return null;var d=editor.doc.getRawFormatAt(l),c=editor.doc.getCharAt(l);if(c==UNICODE.RANGE_START&&d&&d.type==n&&(i[d.id]=!0),c==UNICODE.RANGE_END&&d&&d.type==n){if(i[d.id])continue;a=l;break}}if(!a)return null;var r=DocUtil.getRangeStart(a);return!r||r<0?null:(o.start=r,o.end=a+1,o)},DocUtil.getTextStyle=function(e,t){for(var n,i,o={},r={},a=e;a>=0;a--)if(editor.doc.getCharAt(a)===UNICODE.RANGE_START&&(n=a),i=editor.doc.getRawFormatAt(a)){if(i.type==NODE_TYPE.SECTION)break;if(i.type==NODE_TYPE.PARAGRAPH&&n){var s=editor.doc.findNextIndexOf(UNICODE.PARA,n),l=DocUtil.getStyleIndex(n,NODE_TYPE.TEXT,"next",!0),d=editor.doc.getRawFormatAt(l);i=d.type==NODE_TYPE.TEXT?d:editor.doc.getRawFormatAt(s)}if(i.type==NODE_TYPE.PARAGRAPH){var c=editor.doc.getRawFormatAt(e);if(c&&"link"===c.type){var u=editor.doc.getParents(NODE_TYPE.LINK,e);if(r[ATTR_COMMON.TYPE]="text",u){var p=u.attr("*");r[ATTR_COMMON.CLS]="link",r[ATTR_LINK.LINK_URL]=p[ATTR_LINK.LINK_URL],r[ATTR_LINK.LINK_TARGET]=p[ATTR_LINK.LINK_TARGET],r[ATTR_LINK.LINK_TYPE]=p[ATTR_LINK.LINK_TYPE]}}if(i[ATTR_PARAGRAPH.PS_TS]){o=DocUtil.copyStyle(i[ATTR_PARAGRAPH.PS_TS]),o.type=NODE_TYPE.TEXT;break}o={type:NODE_TYPE.TEXT};break}if(i.type==NODE_TYPE.TEXT&&i.st!=NODE_TYPE.TAB&&i.cls!=NODE_TYPE.ENDNOTE&&i.cls!=NODE_TYPE.FOOTNOTE){o=DocUtil.copyStyle(i);var h=o.cls;if(h&&h.indexOf("link")>-1){var f=DocUtil.getFloatElementRange(NODE_TYPE.LINK,e);(!f||e>f.end)&&delete o.cls}else h&&(h.indexOf("auto")>-1||h.indexOf(CONST.MERGEFIELD)!=-1||h.indexOf(CONST.NEXTRECORD)!=-1||h.indexOf("placeholder")!=-1)&&!t&&delete o.cls;delete o[ATTR_TEXT.MM_FIELDNAME],delete o[ATTR_TEXT.TS_SP],delete o[ATTR_TEXT.TS_GR],delete o[ATTR_COMMON.FIELDINFO];break}}return jQuery.isEmptyObject(r)||(o=Utils.mergeObjs([o,r])),o},DocUtil.getKeys=function(){return Object.keys?function(e){return e?Object.keys(e):null}:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}}(),DocUtil.getRangeStart=function(e){var t=editor.doc.getRawFormatAt(e);if(!t)return e;for(var n=editor.doc.getSectionStart(e),i=t.id;editor.doc.getCharAt(e)!==UNICODE.RANGE_START||!t||t.id!=i;){if(e=editor.doc.findPreviousIndexOf(UNICODE.RANGE_START,e),e<0||e<=n){e=n+1;break}t=editor.doc.getRawFormatAt(e)}return e},DocUtil.getRangeEnd=function(e){var t=editor.doc.getRawFormatAt(e);if(!t)return e;for(var n=editor.doc.getSectionEnd(e),i=t.id;editor.doc.getCharAt(e)!==UNICODE.RANGE_END||!t||t.id!=i;){if(e=editor.doc.findNextIndexOf(UNICODE.RANGE_END,e+1),e<0||e>=n){e=n;break}t=editor.doc.getRawFormatAt(e)}return e},DocUtil.getVersionNumberDiff=function(e,t){return(e.version-t.version-1)*MAX_REVISION+(MAX_REVISION-t.revision+e.revision)},DocUtil.getVersionFromMsg=function(e){var t=e.VERSION,n=e.REVISION;return{version:t,revision:n}},DocUtil.getCurrentDocVersion=function(){return{version:editor.doc.getDocInfo().VERSION,revision:editor.doc.getDocInfo().REVISION}},DocUtil.getTableStart=function(e){return TableUtil.getStart(e,UNICODE.TABLE)},DocUtil.getRowStart=function(e){return TableUtil.getStart(e,UNICODE.ROW)},DocUtil.getCellStart=function(e){return TableUtil.getStart(e,UNICODE.CELL)},DocUtil.getTableEnd=function(e,t){var e=TableUtil.getEnd(e,[],t);if(e>0)return e+1},DocUtil.getRowEnd=function(e,t){return TableUtil.getEnd(e,[UNICODE.ROW],t)},DocUtil.getCellEnd=function(e,t){return TableUtil.getEnd(e,[UNICODE.ROW,UNICODE.CELL],t)},DocUtil.getParaStyle=function(e){var t={},n=editor.doc.getParents(NODE_TYPE.PARAGRAPH,e);t=n.attr("*");var i=n.getEnd()-1,o=t[ATTR_PARAGRAPH.PS_HD];if(o&&parseInt(o)>0&&e==i){var r=editor.doc.getParaStyles(["h"+t[ATTR_PARAGRAPH.PS_HD]]);for(var a in r)"textFormat"!=a&&delete t[a];delete t[ATTR_PARAGRAPH.PS_HD],delete t[ATTR_PARAGRAPH.PS_TYPE],delete t[ATTR_PARAGRAPH.LS_DATA],delete t[ATTR_PARAGRAPH.PS_TS]}else{var s=DocUtil.getTextStyle(e-1);s&&(delete s.type,t[ATTR_PARAGRAPH.PS_TS]=s)}return t},DocUtil.setIDforExternalImage=function(e){e&&e[ATTR_IMAGE.I_WID]&&e[ATTR_IMAGE.I_SRC]&&0==e[ATTR_IMAGE.I_SRC].indexOf("http")&&!e[ATTR_IMAGE.I_ID]&&(e[ATTR_IMAGE.I_ID]=Utils.randomString())},DocUtil.getStylesWithoutHeadingList=function(){for(var e=editor.doc.getParaStyles(),t=1;t<=6;){var n=e["h"+t];delete n[ATTR_PARAGRAPH.PS_TYPE],delete n[ATTR_PARAGRAPH.LS_DATA],delete n[ATTR_PARAGRAPH.PS_ML],t+=1}var i=editor.doc.getSelection().parents(NODE_TYPE.BODY),o=i.attr(ATTR_BODY.DS_STYLES);return o[ATTR_BODY.DS_PARA]=e,o},DocUtil.updateStylesForHeadingList=function(e,t){var n=DocUtil.copyStyle(OrigDocStyleObject.para);switch(e){case 16:for(var i=1;i<=6;i++){var o,r=n["h"+i];r[ATTR_PARAGRAPH.PS_TYPE]="list",r[ATTR_PARAGRAPH.LS_DATA]={id:t,l:i-1},i>=3?(o=.5,o+=.1*(i-3)):o=0,r[ATTR_PARAGRAPH.PS_ML]=o+"in"}break;case 17:for(var i=1;i<=6;i++){var r=n["h"+i];r[ATTR_PARAGRAPH.PS_TYPE]="list",r[ATTR_PARAGRAPH.LS_DATA]={id:t,l:i-1},r[ATTR_PARAGRAPH.PS_ML]="0in"}break;case 18:for(var i=1;i<=6;i++){var o,r=n["h"+i];r[ATTR_PARAGRAPH.PS_TYPE]="list",r[ATTR_PARAGRAPH.LS_DATA]={id:t,l:i-1};var o=.5*(i-1);r[ATTR_PARAGRAPH.PS_ML]=o+"in"}break;case 19:for(var i=1;i<=6;i++){var r=n["h"+i];r[ATTR_PARAGRAPH.PS_TYPE]="list",r[ATTR_PARAGRAPH.LS_DATA]={id:t,l:i-1},r[ATTR_PARAGRAPH.PS_ML]="0in"}}var a=editor.doc.getSelection().parents(NODE_TYPE.BODY),s=a.attr(ATTR_BODY.DS_STYLES);return s[ATTR_BODY.DS_PARA]=n,s},DocUtil.getParaFormat=function(e){var t=DocUtil.copyStyle(editor.doc.getRawFormatAt(e))||{},n={},i="undefined"!=typeof t[ATTR_PARAGRAPH.PS_HD]&&t[ATTR_PARAGRAPH.PS_HD]?"h"+t[ATTR_PARAGRAPH.PS_HD]:"h0";n=ComputedParaStyleObject[i];var o=TableUtil.getParaStylesFromTableTheme(e);return o&&(n=Utils.mergeObjs([n,o])),n[TCConstants.TC]&&delete n[TCConstants.TC],t[ATTR_PARAGRAPH.PS_TYPE]||(n=DocUtil.copyStyle(n),delete n[ATTR_PARAGRAPH.PS_TYPE],delete n[ATTR_PARAGRAPH.LS_DATA]),t=Utils.mergeObjs([n,t])},DocUtil.createTextElement=function(e,t){var n=editor.doc.getContent(e,t),i=editor.doc.createElement(NODE_TYPE.TEXT,n);return i.setStart(e),i.setEnd(t),i},DocUtil.getComputedParaStyles=function(e,t){var n=editor.doc.getParents(NODE_TYPE.CELL,e);if(n)for(var i in t)t[i][ATTR_PARAGRAPH.PS_LS]="1.0",t[i][ATTR_PARAGRAPH.PS_SA]="0pt",t[i][ATTR_PARAGRAPH.PS_SB]="0pt";return t},DocUtil.getCellPadding=function(e){var t={};return e[ATTR_CELL.TDS_PL]||e[ATTR_CELL.TDS_PR]||e[ATTR_CELL.TDS_PT]||e[ATTR_CELL.TDS_PB]?(t.left=(e[ATTR_CELL.TDS_PL]||"0").convertor().pixels,t.right=(e[ATTR_CELL.TDS_PR]||"0").convertor().pixels,t.top=(e[ATTR_CELL.TDS_PT]||"0").convertor().pixels,t.bottom=(e[ATTR_CELL.TDS_PB]||"0").convertor().pixels,t):t={top:0,right:6,bottom:0,left:6}},DocUtil.formatGenerator=function(){var e={Bold:{name:ATTR_TEXT.TS_FW,value:"bold",off:"none"},Italic:{name:ATTR_TEXT.TS_FS,value:"italic",off:"none"},Superscript:{name:ATTR_TEXT.TS_VA,value:"super",off:"none"},Subscript:{name:ATTR_TEXT.TS_VA,value:"sub",off:"none"},Underline:{name:ATTR_TEXT.TS_TD,value:"underline",off:"none",altvalue:"underline line-through",altoff:"line-through"},Strikethrough:{name:ATTR_TEXT.TS_TD,value:"line-through",off:"none",altvalue:"underline line-through",altoff:"underline"},FontName:{name:ATTR_TEXT.TS_FF},SmallCaps:{name:ATTR_TEXT.TS_FV,value:"small-caps",off:"small-caps"},FontSize:{name:ATTR_TEXT.TS_SIZE},BackColor:{name:ATTR_TEXT.TS_BGC},ForeColor:{name:ATTR_TEXT.TS_FGC},CharSpacing:{name:ATTR_TEXT.TS_CS},CharStyles:{name:ATTR_TEXT.CHAR_STY}},t=["CreateLink","Unlink","FormatBlock","outdent","indent","hlist","removeHeadingList","orderedlist","unorderedlist","inshr","insquote","autofield","instable","applyBorders","applyLineSpacing","applyStyle","applyTab","insertTab","delete","RemoveFormat","delrow","delcolumn","insrowafter","insrowbefore","inscolafter","inscolbefore","splitcells","deltable","instable","setTableTheme","insimg","endnote"],n={JustifyLeft:{name:ATTR_PARAGRAPH.PS_AL,value:0},JustifyCenter:{name:ATTR_PARAGRAPH.PS_AL,value:1},JustifyRight:{name:ATTR_PARAGRAPH.PS_AL,value:2},JustifyFull:{name:ATTR_PARAGRAPH.PS_AL,value:3},ParaBackColor:{name:ATTR_PARAGRAPH.PS_BGC},AddSpaceToParaafter:{name:ATTR_PARAGRAPH.PS_SA,value:"12pt"},RemoveSpaceFromParaafter:{name:ATTR_PARAGRAPH.PS_SA,value:"0pt"},AddSpaceToParabefore:{name:ATTR_PARAGRAPH.PS_SB,value:"12pt"},RemoveSpaceFromParabefore:{name:ATTR_PARAGRAPH.PS_SB,value:"0pt"},direction:{name:ATTR_PARAGRAPH.PS_DIR},SetLineSpacing:{name:ATTR_PARAGRAPH.PS_LS}};return{isTextCommand:function(t){return e.hasOwnProperty(t)},isNodeStyleCommand:function(e){return t.contains(e)},isParaCommand:function(e){return n.hasOwnProperty(e)||n.hasOwnProperty(e+"after")||n.hasOwnProperty(e+"before")},getParaFormat:function(e,t){var i={},o=editor.doc.getSelection(),r=o.parents(NODE_TYPE.PARAGRAPH),a=r&&r.getEnd(),s=DocUtil.getParaFormat(a-1),l=s.dir||"ltr",d=n[e];return l==PARA_DIR.RTL?"JustifyRight"==e?d.value=0:"JustifyLeft"==e&&(d.value=2):"JustifyRight"==e?d.value=2:"JustifyLeft"==e&&(d.value=0),d||(d=n[e+t]),i[d.name]=d.hasOwnProperty("value")?d.value:t,i},getTextFormat:function(t,n,i){var o={type:NODE_TYPE.TEXT},r=e[n];if(i)o[r.name]=i;else if(o[r.name]=r.value,t&&t.type==NODE_TYPE.TEXT){var a=t[r.name]?t[r.name].trim():"";r.value&&a===r.value?o[r.name]=r.off:r.altvalue&&a===r.altvalue?o[r.name]=r.altoff:r.altvalue&&a===r.altoff&&editor.doc.getSelection().isCollapsed()&&(o[r.name]=r.value)}return o}}}(),DocUtil.isNonEditablePortion=function(e){if(!e)return!1;var t=!1;return e=e.toLowerCase(),e.indexOf("auto")!=-1?t=!0:e.indexOf(CONST.MERGEFIELD.toLowerCase())!=-1?t=!0:e.indexOf(CONST.NEXTRECORD.toLowerCase())!=-1?t=!0:e.indexOf("endnote")!=-1?t=!0:e.indexOf("footnote")!=-1?t=!0:e.indexOf("placeholder")!=-1&&(t=!0),t},DocUtil.getSectionOps=function(e,t){var n={},i=[];n.type="section",n.hftype=e,n.sid=e,n.st=e,styKey=DocUtil.getKeys(n);var o=Utils.randomString(),r=Utils.randomString();return i=[{r:t},{as:{start:n,id:o}},{is:UNICODE.SECTION_START},{as:{end:styKey,id:o}},{as:{start:{type:"paragraph"},id:r}},{is:UNICODE.PARA},{as:{end:["type"],id:r}}]},DocUtil.constructRenderingFormat=function(e,t){var n=t?t:Theme;for(var i in e){var o=e[i];if("shapeData"!==i)if("object"==typeof o)DocUtil.constructRenderingFormat(o,n);else if("string"==typeof o){var r=/[z][w](\w|\*|\/)+/,a=/\#(\w|\*|\/)+/,s=r.test(o),l=a.test(o);if(!s&&!l)continue;var d=r.exec(o),c=a.exec(o),u=o,p=s?d[0].substr("zw".length):c[0].substr("#".length);if("major"===p||"minor"===p)u=n.font[p].latin;else{if(!(p.indexOf("accent")>-1||p.indexOf("dark")>-1||p.indexOf("light")>-1||p.indexOf("hlink")>-1||p.indexOf("folHlink")>-1))continue;var h=null,f=null,m=null;p.indexOf("*")>-1?(h=p.split("*")[0],f=parseInt(p.split("*")[1])):p.indexOf("/")>-1?(h=p.split("/")[0],m=parseInt(p.split("/")[1])):h=p,h=n.color[h],u=f||m?f?Utils.getColorAfterShade(h,f):Utils.getColorAfterTint(h,m):h}u=o.replace(s?r:a,u),e[i]=u}}},DocUtil.updateWithCharStyle=function(e){return e.hasOwnProperty(ATTR_TEXT.CHAR_STY)&&(e=Utils.mergeObjs([TextStyleObject[e[ATTR_TEXT.CHAR_STY]],e])),e},DocUtil.setDocStyleObject=function(){OrigDocStyleObject=DocUtil.copyStyle(editor.doc.bodyFormat[ATTR_BODY.DS_STYLES]),Theme=DocUtil.copyStyle(editor.doc.bodyFormat[ATTR_BODY.DS_THEME]),DocStyleObject=DocUtil.copyStyle(editor.doc.bodyFormat[ATTR_BODY.DS_STYLES]),DocUtil.constructRenderingFormat(DocStyleObject),ParaStyleObject=DocUtil.copyStyle(DocStyleObject.para),TextStyleObject=DocUtil.copyStyle(DocStyleObject.char);var e=function(){var e={};for(var t in ParaStyleObject)"h0"!=t?e[t]=Utils.mergeObjs([ParaStyleObject.h0,ParaStyleObject[t]]):e[t]=DocUtil.copyStyle(ParaStyleObject[t]);return e};ComputedParaStyleObject=e()},DocUtil.getFloatElementIdx=function(e,t){var n,i,o,r=0;for(r=editor.doc.findNextIndexOf(UNICODE.RANGE_START,r),e?(i=ATTR_COMMON.ID,o=e):(i=ATTR_COMMON.NAME,o=t);r>0&&(n=editor.doc.getRawFormatAt(r),!n||n[i]!=o);)r=editor.doc.findNextIndexOf(UNICODE.RANGE_START,r+1);return r},DocUtil.getNextFontSize=function(e){var t,n=editor.doc.getDefaultFontSizeList(),i=n.length;for(t=0;t<i;t++)if(n[t]>e)return n[t];return e+=10-e%10},DocUtil.getPrevFontSize=function(e){var t,n=editor.doc.getDefaultFontSizeList(),i=n.length;if(e>n[i-1])return e-=10-e%10;for(t=i-1;t>=0;t--)if(n[t]<e)return n[t];return e-1},DocUtil.increaseOrDecreaseFontSize=function(e,t){for(var n,i,o,r,a=e.getTextPortionsInSelection(),s=a.length,l=1==t,d=0;d<s;d++){var c=DocTreeManager.getTreeNodeAtIndex(a[d].getStart()+1);if(r=c&&c.paraProperties.level,i=editor.doc.getComputedFormatAt(a[d].getStart(),NODE_TYPE.TEXT,r),o=parseInt(i[ATTR_TEXT.TS_SIZE]),n=l?DocUtil.getNextFontSize(o):DocUtil.getPrevFontSize(o),l&&n<=400||!l&&n>0){var u={};u[ATTR_TEXT.TS_SIZE]=n,a[d].attr(u)}}var p=e.getNodesInSelection(NODE_TYPE.PARAGRAPH);if(e.isListItemSelection)i=e.getComputedTextFormat(),o=parseInt(i[ATTR_TEXT.TS_SIZE]),n=l?DocUtil.getNextFontSize(o):DocUtil.getPrevFontSize(o),i[ATTR_TEXT.TS_SIZE]=n,List.updateLevelStyles(e.selectedListID,e.selectedListLevel,i);else for(s=p.length,d=0;d<s;d++)if(i=editor.doc.getComputedFormatAt(p[d].getStart(),NODE_TYPE.PARAGRAPH),"list"==i[ATTR_PARAGRAPH.PS_TYPE]&&(o=i[ATTR_PARAGRAPH.PS_TS]&&i[ATTR_PARAGRAPH.PS_TS][ATTR_TEXT.TS_SIZE]?parseInt(i[ATTR_PARAGRAPH.PS_TS][ATTR_TEXT.TS_SIZE]):parseInt(i[ATTR_PARAGRAPH.TEXTFORMAT][ATTR_TEXT.TS_SIZE]),n=l?DocUtil.getNextFontSize(o):DocUtil.getPrevFontSize(o),l&&n<=400||!n&&o>0)){var u={};u[ATTR_PARAGRAPH.PS_TS]={},u[ATTR_PARAGRAPH.PS_TS][ATTR_TEXT.TS_SIZE]=n,p[d].attr(u)}},DocUtil.isBoundaryChar=function(){var e=RegExp(CONT_REGEXP.PORTION_END);return function(t){var n=e.test(t);return n}}();var extImgCache={};DomUtil.getImageFromCache=function(e){return extImgCache[e]},DomUtil.createParagraph=function(e){var t=document.createElement("p");return t.className="zw-paragraph",DomUtil.setParaStyle(t,e,"",!0),t},DomUtil.createImage=function(e){var t=document.createElement("img");return t.className="zw-image",e&&DomUtil.applyStyleToImage(t,e),e&&e[MAILMERGE.MMINFO]?DomUtil.imageErrorHandler(t,e):t.onerror=function(){DomUtil.imageErrorHandler(t,e)},t},DomUtil.imageErrorHandler=function(e,t){e.onerror=null;var n=e.getAttribute("src");e.setAttribute("data-zw-imagesrc",n),e.setAttribute("src",""),e.setAttribute("alt",J.i18n("writer.common.LOADING"));var i=e.className+" ui-loading-bg";if(t[MAILMERGE.MMINFO]){i=e.className+" ui-mm-img-bg ui-mm-img";var o=t[MAILMERGE.MMINFO],r=o[MAILMERGE.FIELD_NAME],a=o[MAILMERGE.GROUP_NAME];a&&(r=a+"."+r),e.setAttribute("title",UNICODE.MERGEFIELD_START+r+UNICODE.MERGEFIELD_END)}else t.wid>=50&&t.ht>=20&&(i+=" ui-loading-img");editor.isFloatingImage(t)||(i+=" ui-pos-rel",e.style.top=""),e.className=i},DomUtil.createSvgImage=function(e){var t=document.createElement("div");if(t.setAttribute("class","fgImgOuterDiv"),e&&e.src){var n="http",i=document.createElementNS(n+"://www.w3.org/2000/svg","svg");i.setAttributeNS(n+"://www.w3.org/2000/xmlns/","xmlns:xlink",n+"://www.w3.org/1999/xlink");var o=document.createElement("image");i.appendChild(o),t.appendChild(i),o.className="zw-image",DomUtil.applyStyleToSvgImage(o,e)}return t},DomUtil.createDigiSignField=function(e){var t=document.createElement("input");return t.type="checkbox"===e["ds-data"]["field-name"]?"checkbox":"text",DomUtil.setStyleToInput(t,e),t},DomUtil.createIframe=function(e){var t=document.createElement("iframe");t.className="zw-iframe";var n=J(t),i={},o=e[ATTR_WIDGET.SERVICE],r=window.location.protocol+"//",a=r+document.domain;if(o==ATTR_WIDGET.SERVICE_SHEET)i[ATTR_IMAGE.I_SRC]=a+"/sheet/published.do?rid="+e[ATTR_WIDGET.TUBEID]+"&mode=embed";else if(o==ATTR_WIDGET.SERVICE_SHOW)i[ATTR_IMAGE.I_SRC]=a+"/show/publish/"+e[ATTR_WIDGET.TUBEID];else if(o==ATTR_WIDGET.SERVICE_REPORTS){var s=window.location.hostname;s=s.substring(s.indexOf(".")),i[ATTR_IMAGE.I_SRC]=r+"reports"+s+"/ZDBDataSheetView.cc?OBJID="+e[ATTR_WIDGET.TUBEID]+"&STANDALONE=true&ZDB_THEME_NAME=blue&INTERVAL=-1&REMTOOLBAR=true&INCLUDETITLE=true&INCLUDEDESC=false"}else if(o.toUpperCase()==ATTR_WIDGET.SERVICE_YOUTUBE){var l,d;e.src&&(l=e.src.split("/"),d=l[l.length-2]),i[ATTR_IMAGE.I_SRC]=r+"www.youtube.com/embed/"+d+"?wmode=transparent&rel=0&showinfo=0&modestbranding=1&fs=0 allowfullscreen"}else o==ATTR_WIDGET.SERVICE_SHEETEXTERNAL?i[ATTR_IMAGE.I_SRC]=a+"/sheet/publishrange.do?id="+e[ATTR_WIDGET.TUBEID]+"&mode=embed":o==ATTR_WIDGET.SERVICE_SHEETINTRANET?i[ATTR_IMAGE.I_SRC]=a+"/publishrange.org?id="+e[ATTR_WIDGET.TUBEID]+"&mode=embed":o==ATTR_WIDGET.SERVICE_SHEETCHARTIMG?i[ATTR_IMAGE.I_SRC]=a+"/sheet/publicgraphs/"+e[ATTR_WIDGET.TUBEID]+".png":o==ATTR_WIDGET.SERVICE_SHEETCHART?i[ATTR_IMAGE.I_SRC]=a+"/sheet/publicgraphs/"+e[ATTR_WIDGET.TUBEID]:o==ATTR_WIDGET.SERVICE_DOCS&&(i[ATTR_IMAGE.I_SRC]=a+"/file/"+e[ATTR_WIDGET.TUBEID]);i[ATTR_WIDGET.WIDTH]=e[ATTR_WIDGET.WID],i[ATTR_WIDGET.TUBEID]=e[ATTR_WIDGET.TUBEID],i[ATTR_WIDGET.SERVICE]=e[ATTR_WIDGET.SERVICE],i[ATTR_WIDGET.HEIGHT]=e[ATTR_WIDGET.HT];var c={};return c[ATTR_WIDGET.BORDER]="1px solid #F2F2F2",c[ATTR_WIDGET.BORDER_RADIUS]="5px",n.attr(i).css(c),t},DomUtil.createWidget=function(e){var t=document.createElement("iframe");t.className="zw-iframe";var n=J(t),i={};i[ATTR_IMAGE.I_SRC]=e[ATTR_WIDGET.SRC],i[ATTR_WIDGET.WIDTH]=e[ATTR_WIDGET.WID],i[ATTR_WIDGET.WIDTH]=e[ATTR_WIDGET.WID],i[ATTR_WIDGET.HEIGHT]=e[ATTR_WIDGET.HT],i["data-thumbnail"]=e[ATTR_WIDGET.THUMBNAIL];var o={};return o[ATTR_WIDGET.BORDER]="1px solid #F2F2F2",o[ATTR_WIDGET.BORDER_RADIUS]="5px",n.attr(i).css(o),t},DomUtil.createSpan=function(e){var t=document.createElement("span");return t.className="zw-portion",e&&DomUtil.setStyle(t,e),t},DomUtil.createLink=function(e){var t=document.createElement("a"),n={};return n.href=e[ATTR_LINK.LINK_URL],n.target=e[ATTR_LINK.LINK_TARGET],n.title=e[ATTR_LINK.LINK_TOOLTIP],t.attr(n),t},DomUtil.createTable=function(e,t){var n=document.createElement("table");n.className="zw-table";var i=document.createElement("colgroup");return n.appendChild(i),e&&DomUtil.setTableStyle(n,e,t),n},DomUtil.createTbody=function(){var e=document.createElement("tbody");return e.className="zw-tbody",e.style.verticalAlign="top",e},DomUtil.createTR=function(e){var t=document.createElement("tr");return t.className="zw-tr",e&&DomUtil.setRowStyle(t,e),t},DomUtil.createTD=function(e,t,n){var i=document.createElement("td");if(i.className="zw-td",t){var o=document.createElement("div");o.setAttribute("class","zw-cell-container"),J(o).css({position:"relative"}),i.appendChild(o)}return e&&DomUtil.setCellStyle(i,e,t,n),i},DomUtil.createHR=function(e){var t=null;return t=e?document.createElement("div"):document.createElement("hr"),t.className="zw-hr",t},DomUtil.createBR=function(){var e=document.createElement("br");return e.className="zw-br",e},DomUtil.getDigiSignFieldVal=function(e){var t={signature:J.i18n("writer.digisign.SIGNATURE"),signatureblock:J.i18n("writer.digisign.SIGNATURE_BLOCK"),initials:J.i18n("writer.digisign.INITIALS"),title:J.i18n("writer.digisign.TITLE"),company:J.i18n("writer.digisign.COMPANY"),fullname:J.i18n("writer.digisign.SIGNER_NAME"),email:J.i18n("writer.common.EMAIL"),date:J.i18n("writer.common.DATE"),textbox:J.i18n("writer.digisign.TEXT_FIELD"),checkbox:J.i18n("writer.digisign.CHECKBOX")},n=t[e];return n},DomUtil.setStyleToInput=function(e,t){var n,i={},o={};for(n in t)n==ATTR_IMAGE.I_WID?i.width=t[ATTR_IMAGE.I_WID]:n==ATTR_IMAGE.I_HT?i.height=t[ATTR_IMAGE.I_HT]:n==ATTR_IMAGE.I_ML?i["margin-left"]=t[ATTR_IMAGE.I_ML]:n==ATTR_IMAGE.I_MT?i["margin-top"]=t[ATTR_IMAGE.I_MT]:n==ATTR_IMAGE.I_MR?i["margin-right"]=t[ATTR_IMAGE.I_MR]:n==ATTR_IMAGE.I_MB&&(i["margin-bottom"]=t[ATTR_IMAGE.I_MB]);var r=t["ds-data"],a=r["field-name"],s=r["field-value"],l="";if(r&&s){if("checkbox"==a||"textbox"==a)l=J.i18n("writer.common.CUSTOM")+" "+DomUtil.getDigiSignFieldVal(a);else{var d=s.match(/signer[0-9]*/g);l=d[0].charAt(0).toUpperCase()+d[0].substring(1,d[0].length)}o.placeholder=DomUtil.getDigiSignFieldVal(a)+" - "+l,o.title=l,o.name=s+a}i["vertical-align"]="checkbox"==a?"middle":"super",J(e).attr(o).css(i)},DomUtil.applyStyleToImage=function(e,t){if(t&&e)try{t&&t.hasOwnProperty(HISTORY_CONST.ACTION)&&(t=HistoryUtils.getDiffFormat(t));var n=J(e);n.removeAttr("style");var i={},o={};o=DomUtil.getBorderStyles(t);for(var r in t)if(t.hasOwnProperty(r)&&"type"!=r){var a=t[r];if(null!=a&&void 0!=a)if(r==ATTR_IMAGE.I_SRC){var s=DomUtil.processImgSrc(a);i[ATTR_IMAGE.I_SRC]=s}else if(r==ATTR_TEXT.CLS)n.addClass(a);else if(r==ATTR_IMAGE.I_LINKDATA){var l='{"data-link-url":"'+a.url+'","data-link-type":"'+a.type+'"}';n.attr("linkData",l)}else if(r==ATTR_IMAGE.I_WID){var d=t[ATTR_IMAGE.I_WID_UN];d&&(a="%"===d?ViewManager.getColumnWidth()+"px":parseInt(a)+d),n.width(a)}else if(r==ATTR_IMAGE.I_HT){var d=t[ATTR_IMAGE.I_HT_UN];d&&(a="%"===d?n[0].naturalHeight*ViewManager.getColumnWidth()/n[0].naturalWidth+"px":parseInt(a)+d),n.height(a)}else if(r==ATTR_IMAGE.I_OP)e.style.opacity=a/100,editor.browserInfo.is_ie&&(e.style.filter="alpha(opacity="+a+")");else if(r==ATTR_IMAGE.I_AL)i.align=a;else if(r==ATTR_IMAGE.I_IMGSIZE)i.imagesize=a;else if(r==ATTR_IMAGE.I_LATEXEXP)i.latexexpression=a;else if(r==ATTR_IMAGE.I_ID)i.id=a,"dummyEquationImage"===a&&(o.display="inline-block");else if(r==ATTR_IMAGE.I_ALT)i.alt=a;else if(r==ATTR_IMAGE.I_TOOLTIP)i.title=a;else if(r==ATTR_IMAGE.I_ML&&editor.isFloatingImage(t))o["margin-left"]=a;else if(r==ATTR_IMAGE.I_MR&&editor.isFloatingImage(t))o["margin-right"]=a;else if(r==ATTR_IMAGE.I_MT&&editor.isFloatingImage(t))o["margin-top"]=a;else if(r==ATTR_IMAGE.I_MB&&editor.isFloatingImage(t))o["margin-bottom"]=a;else if(r==ATTR_IMAGE.I_TOP)o.top=a;else if(r==ATTR_IMAGE.I_LEFT)o.left=a;else if(r==ATTR_COMMON.BORDERS&&a.top){var c=DomUtil.getBorderStyles(t);n.css(c)}}if(n.attr(i).css(o),t&&t.hasOwnProperty(ATTR_IMAGE.I_ROTATE)){var u="rotate("+t[ATTR_IMAGE.I_ROTATE]+"deg)",o={"-ms-transform":u,"-moz-transform":u,"-webkit-transform":u,"-o-transform":u,transform:u};n.css(o)}}catch(e){}},DomUtil.applyStyleToSvgImage=function(e,t){if(t&&e)try{var n,i={};t&&t.hasOwnProperty(HISTORY_CONST.ACTION)&&(t=HistoryUtils.getDiffFormat(t));var o=J(e),r=J(o[0].parentElement);o.removeClass("ui-mm-img-prop"),o.parent().parent().removeClass("ui-mm-img-outer-div"),o.removeAttr("style"),r.removeAttr("style"),o.parent().parent().removeAttr("style");var a={},s={};for(var l in t)if(t.hasOwnProperty(l)&&"type"!=l){var d=t[l];if(null!=d&&void 0!=d)if(l==ATTR_IMAGE.I_SRC){var c=DomUtil.processImgSrc(d);t[MAILMERGE.MMINFO]&&(c=commonimgStaticURL+"images/common/mail-merge-image_opt1.png"),a["xlink:href"]=c;var u="preserveAspectRatio";a[u]="none"}else if(l==ATTR_TEXT.CLS)o.addClass(d);else if(l==ATTR_IMAGE.I_LINKDATA){var p='{"data-link-url":"'+d.url+'","data-link-type":"'+d.type+'"}';o.attr("linkData",p)}else if(l==ATTR_IMAGE.I_WID){var h=t[ATTR_IMAGE.I_WID_UN],f=Utils.getOrginalHeighWidthOfImage(t);""==t.wid&&""==t.ht&&(f.ht=0,f.wid=0),h&&("%"===h?(d=ViewManager.getColumnWidth()+"px",t.cropRect&&!CropImage.isCropImageActive()&&(d=ViewManager.getColumnWidth()+(t.cropRect.cropLeft+t.cropRect.cropRight))):d=parseInt(f.wid)+h),t[MAILMERGE.MMINFO]?o.attr("width","134"):o.attr("width",d),o.parents("svg").width(d),J(o.parents("div")[0]).width(d)}else if(l==ATTR_IMAGE.I_HT){var h=t[ATTR_IMAGE.I_HT_UN],f=Utils.getOrginalHeighWidthOfImage(t);""==t.wid&&""==t.ht&&(f.ht=0,f.wid=0),h&&("%"===h?(d=t[ATTR_IMAGE.I_ORGINALHT]*ViewManager.getColumnWidth()/t[ATTR_IMAGE.I_ORGINALWID]+"px",t.cropRect&&!CropImage.isCropImageActive()&&(d=t[ATTR_IMAGE.I_ORGINALHT]*ViewManager.getColumnWidth()/t[ATTR_IMAGE.I_ORGINALWID]+(t.cropRect.cropTop+t.cropRect.cropBottom))):d=parseInt(f.ht)+h),t[MAILMERGE.MMINFO]?o.attr("height","58"):o.attr("height",d),o.parents("svg").height(d),J(o.parents("div")[0]).height(d)}else if(l==ATTR_IMAGE.I_OP)J(e).css("opacity",d/100),editor.browserInfo.is_ie&&(e.style.filter="alpha(opacity="+d+")");else if(l==ATTR_IMAGE.I_AL)a.align=d;else if(l==ATTR_IMAGE.I_IMGSIZE)a.imagesize=d;else if(l==ATTR_IMAGE.I_LATEXEXP)a.latexexpression=d;else if(l==ATTR_IMAGE.I_ID)a.id=d,"dummyEquationImage"===d&&(s.display="inline-block");else if(l==ATTR_IMAGE.I_ALT)a.alt=d;else if(l==ATTR_IMAGE.I_TOOLTIP)a.title=d;else if(l==ATTR_IMAGE.I_ML&&editor.isFloatingImage(t))i["margin-left"]=d;else if(l==ATTR_IMAGE.I_MR&&editor.isFloatingImage(t))i["margin-right"]=d;else if(l==ATTR_IMAGE.I_MT&&editor.isFloatingImage(t))i["margin-top"]=d;else if(l==ATTR_IMAGE.I_MB&&editor.isFloatingImage(t))i["margin-bottom"]=d;else if(l==ATTR_IMAGE.I_TOP)s.top=d;else if(l==ATTR_IMAGE.I_LEFT)s.left=d;else if(l==ATTR_IMAGE.I_CROPRECT){spanStyles={};var m=0,g=0;if("%"==t[ATTR_IMAGE.I_WID_UN])m=ViewManager.getColumnWidth(),g=t[ATTR_IMAGE.I_ORGINALHT]*ViewManager.getColumnWidth()/t[ATTR_IMAGE.I_ORGINALWID];else{var f=Utils.getOrginalHeighWidthOfImage(t);m=f.wid,g=f.ht}d=Utils.convertCropDataToPixel(d,g,m),spanStyles["margin-left"]=-d.cropLeft,spanStyles["margin-top"]=-d.cropTop,r.css(spanStyles)}else l==ATTR_COMMON.BORDERS&&d[ATTR_BORDERS.BORDER_TOP]&&(n=DomUtil.getBorderStyles(t),J(o.parents("div")[0]).css(n))}if(o.attr(a).css(s),editor.isFloatingImage(t)&&DocUtil.getKeys(i).length&&J(o.parents("div")[0]).css(i),t&&t.hasOwnProperty(ATTR_IMAGE.I_ROTATE)){var T="rotate("+t[ATTR_IMAGE.I_ROTATE]+"deg)",s={"-ms-transform":T,"-moz-transform":T,"-webkit-transform":T,"-o-transform":T,transform:T};o.parents("div").css(s)}if(t&&t.hasOwnProperty(ATTR_IMAGE.I_CROPRECT)&&t[ATTR_IMAGE.I_CROPRECT]){var _=t[ATTR_IMAGE.I_HT],E=t[ATTR_IMAGE.I_WID],v=J(o.parents("div")[0]),f=Utils.getOrginalHeighWidthOfImage(t),S=Utils.convertCropDataToPixel(t[ATTR_IMAGE.I_CROPRECT],f.ht,f.wid);v.height(_),v.width(E),"%"==t[ATTR_IMAGE.I_WID_UN]&&(v.height(t[ATTR_IMAGE.I_ORGINALHT]*ViewManager.getColumnWidth()/t[ATTR_IMAGE.I_ORGINALWID]-(S.cropTop+S.cropBottom)),v.width(ViewManager.getColumnWidth()-(S.cropTop+S.cropBottom))),v.css("overflow","hidden")}if(t[ATTR_COMMON.BORDERS]&&t[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]){var v=J(o.parents("div")[0]),g=parseFloat(v.height()),b=parseFloat(v.width());v.css("height",g+2*parseInt(t[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH])),v.css("width",b+2*parseInt(t[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]))}t[MAILMERGE.MMINFO]&&(o.addClass("ui-mm-img-prop"),o.parent().parent().addClass("ui-mm-img-outer-div"))}catch(e){}},DomUtil.getStyle=function(e){if(!e)return null;var t={},n="",i={},o={};for(var r in e)if(e.hasOwnProperty(r)&&"type"!=r){var a=e[r];if("cls"==r)n+=" "+a;else if(r==ATTR_TEXT.MM_FIELDNAME)o["data-fieldname"]=a;else if(r==ATTR_TEXT.TS_CS)i.letterSpacing="none"==a?"normal":a;else if("st"==r&&a==NODE_TYPE.TAB)n+=" tab";else if(r==ATTR_TEXT.TS_FW)i.fontWeight="none"==a?"normal":a;else if(r==ATTR_TEXT.TS_FF)i.fontFamily="none"==a?"":Utils.fontFamilyRenderingFix(a);else if(r==ATTR_TEXT.TS_FV)i.fontVariant="none"==a?"":a;else if(r==ATTR_TEXT.TS_FS)i.fontStyle="none"==a?"normal":a;else if(r==ATTR_TEXT.TS_SIZE)i.fontSize="none"==a?"":a+"pt";else if(r==ATTR_TEXT.TS_FGC)i.color="none"==a?"":a;else if(r===ATTR_TEXT.TS_TT)i["text-transform"]=a;else if(r==ATTR_TEXT.TS_BGC)i.backgroundColor="none"==a?"":a;else if(r==ATTR_TEXT.TS_TD)"none"==a?i.textDecoration="none":e.cls&&"link"==e.cls&&a.indexOf("line-through")>-1?i.textDecoration="line-through underline":i.textDecoration=a;else if(r==ATTR_TEXT.TS_VA&&"none"!=a)i.verticalAlign=a;else if(r==ATTR_PARAGRAPH.PS_LS&&"none"!=a)i["line-height"]=a;else if(r==ATTR_PARAGRAPH.PS_PR&&"none"!=a)i["padding-right"]=a;else if("float"==r&&"none"!=a)i.float="left";else if("drop"==r&&"none"!=a)i.drop=a;else if(r==ATTR_PARAGRAPH.PS_ML&&"none"!=a)i["margin-left"]=a;else{if(r==ATTR_TEXT.TS_NULL){a&&(i={});break}r==ATTR_TEXT.CHAR_STY&&(n+="char_sty"+a)}}return e[ATTR_COMMON.BORDERS]&&Utils.mergeJsonObjs(i,DomUtil.getBorderStyles(e)),n&&(o.class=n),t.styles=i,t.attr=o,t},DomUtil.setStyle=function(e,t){try{if(!t||!e)return;var n=DomUtil.getStyle(t);if(jQuery.isEmptyObject(n))return;DomUtil.setStyleData(e,n)}catch(e){}},DomUtil.setStyleData=function(e,t){var n=J(e),i=t.styles;if(jQuery.isEmptyObject(i))e.style="";else{var o,r,a,s=i.verticalAlign;i.fontSize&&(a=i.fontSize,r=DomUtil.getFontSize(a),o=r),"super"!=s&&"sub"!=s||i.fontSize&&(o=Math.round(.7*o)),o&&(i.fontSize=o+"pt")}n.css(i);var l=t.attr;if(!jQuery.isEmptyObject(l)){var d=n.attr("class")||"";d=d.trim();var c=l.class||"";c=c.trim(),d+=d?" "+c:"",l.class=d.trim(),n.attr(l)}},DomUtil.getFontSize=function(e){e+="";var t,n=0;return e.match(/px$/)?(t=e.replace("px",""),n=72*parseFloat(t)/96,n=n%1===.5?n:Math.round(n)):e.match(/pt$/)?n=e.replace("pt",""):e.match(/em$/)||e.match(/%$/)?(t=e.replace("em",""),t.match(/%$/)&&(t=t.replace("%","")/100),n=parseFloat(t)*parseInt(editor.doc.getFontSize(0))):n=e,n},DomUtil.getBorderStyles=function(e){var t={"border-top":"paddingTop","border-left":"paddingLeft","border-right":"paddingRight","border-bottom":"paddingBottom"},n={};if(!e.hasOwnProperty(ATTR_COMMON.BORDERS))return n;var i=e[ATTR_COMMON.BORDERS];for(var o in i)U.isEmpty(i[o])||(i[o][ATTR_BORDERS.WIDTH]&&(n[o]=parseFloat(i[o][ATTR_BORDERS.WIDTH])+"px "+i[o][ATTR_BORDERS.TYPE]+" "+Utils.getColorValFromRefString(i[o][ATTR_BORDERS.COLOR])),i[o][ATTR_BORDERS.SPACE]&&(n[t[o]]=i[o][ATTR_BORDERS.SPACE].convertor().pixels));return n},DomUtil.setBorderStyles=function(e,t){try{var n={};n=DomUtil.getBorderStyles(t),jQuery.isEmptyObject(n)||J(e).css(n)}catch(e){}},DomUtil.setParaStyle=function(e,t,n,i){try{if(!e)return;t||(t={}),(t[ATTR_PARAGRAPH.PS_NULL]||t[ATTR_TEXT.TS_NULL])&&(para.style="");var o="",r=J(e),a=DomUtil.getBorderStyles(t);for(var s in t)t.hasOwnProperty(s)&&"type"!=s&&(o=t[s],s==ATTR_PARAGRAPH.PS_SB&&i?a.marginTop=o:s==ATTR_PARAGRAPH.PS_DIR?a.direction=o:s==ATTR_PARAGRAPH.PS_SA&&i?a.marginBottom=o:s==ATTR_PARAGRAPH.PS_ML?a.marginLeft=o:s==ATTR_PARAGRAPH.PS_MR?a.marginRight=o:s==ATTR_PARAGRAPH.PS_PL?a.paddingLeft=o:s==ATTR_PARAGRAPH.PS_PR?a.paddingRight=o:s==ATTR_PARAGRAPH.PS_PT?a.paddingTop=o:s==ATTR_PARAGRAPH.PS_PB?a.paddingBottom=o:s==ATTR_PARAGRAPH.PS_WS?a.wordSpacing=o:s==ATTR_PARAGRAPH.PS_TI&&i?a.textIndent=o:s==ATTR_PARAGRAPH.PS_BGC?a.backgroundColor="none"==o?"":o:s==ATTR_PARAGRAPH.PS_TPS?e.setAttribute("data-tabPoints",JSON.stringify(o)):s==ATTR_PARAGRAPH.PS_LS?a.lineHeight=o:s==ATTR_PARAGRAPH.PS_AL&&0==o?"rtl"==t.dir?a.textAlign="right":a.textAlign="left":s==ATTR_PARAGRAPH.PS_AL&&1==o?a.textAlign="center":s==ATTR_PARAGRAPH.PS_AL&&2==o?"rtl"==t.dir?a.textAlign="left":a.textAlign="right":s==ATTR_PARAGRAPH.PS_AL&&3==o?a.textAlign="justify":s==ATTR_PARAGRAPH.PS_HD?("undefined"==typeof o&&(o=0),r.attr({"data-header":o}).removeClass().addClass("zw-paragraph heading"+o)):s==ATTR_PARAGRAPH.PS_TS&&DomUtil.isParaEmpty(e)&&DomUtil.setStyle(J(e).find("span.EOP")[0],o),s==ATTR_PARAGRAPH.PS_CODE&&r.attr({"data-codeformat":JSON.stringify(o)}),s==ATTR_PARAGRAPH.PS_TS&&r.attr({"data-textformat":JSON.stringify(o)}));jQuery.isEmptyObject(a)||r.css(a)}catch(e){}},DomUtil.isParaEmpty=function(e){var t=DocTreeManager.getNode(e);return t&&t.end-t.start==1},DomUtil.setTableStyle=function(e,t,n){try{if(!t||!e)return;var i=J(e),o={},r=i.find("colgroup")[0],a=n.cols,s=n.isTableWidthInPercentage,l="",d={};if(a){J(r).empty();for(var c=0;c<a.length;c++){var u=document.createElement("col");s?J(u).css("width",a[c].wt):J(u).css("width",Conversions.toGlobalUnit(a[c].wt).toFixed(2)+Conversions.globalUnit),J(r).append(u)}}t&&t.hasOwnProperty(HISTORY_CONST.ACTION)&&(t=HistoryUtils.getDiffFormat(t));for(var p in t)if(t.hasOwnProperty(p)&&"type"!=p&&(l=t[p],null!=l))switch(p){case ATTR_TABLE.TBLS_AL:if("left"==l)d["margin-left"]=0;else if(n){var h=(ViewManager.getColumnWidth()/Conversions.globalUnitInPx).toFixed(3)+Conversions.globalUnit,f=n.parent;if(f&&"cell"==f.type){var m=editor.doc.getElementAt(f.getIndex()),g=m.parentNode().parentNode().dtNode.cols,T=TableUtil.findColIdx(m);h=Conversions.toGlobalUnit(g[T-1].wt)}var _;_=t[ATTR_TABLE.TBLS_WID].indexOf("%")!=-1?parseFloat(t[ATTR_TABLE.TBLS_WID])*parseFloat(h)/100:Conversions.toGlobalUnit(t[ATTR_TABLE.TBLS_WID]);var E=parseFloat(h)-parseFloat(_);"center"==l?(d["margin-left"]=E/2+Conversions.globalUnit,d["margin-right"]=E/2+Conversions.globalUnit):"right"==l&&(d["margin-left"]=E+Conversions.globalUnit)}else o.align=l;break;case ATTR_TABLE.TBLS_ML:d["margin-left"]=l;break;case"z_tbl_bgc":d.backgroundColor=l;break;case ATTR_TABLE.TBLS_CP:o.cellspacing=l;break;case ATTR_TABLE.TBLS_WID:d.width=l;break;case ATTR_TABLE.TBLS_BGIMG:l=DomUtil.processImgSrc(l),d.background="transparent  url("+l+") 50%",d["background-size"]="100%";break;case ATTR_TABLE.TBLS_DIR:var v=t[ATTR_TABLE.TBLS_DIR]||PARA_DIR.LTR;d.direction=v}i.attr(o),i.css(d),(t[ATTR_TABLE.TBLS_ML]||t[ATTR_TABLE.TBLS_AL])&&PubSub.publish("Table/marginChanged")}catch(e){}},DomUtil.setLineDivStyle=function(e,t){var n={},i={};for(var o in t)o==ATTR_PARAGRAPH.PS_TI?n["margin-left"]=t[o]:"padding-top"==o||"padding-bottom"==o?i[o]=t[o]:"pl"==o?i["padding-left"]=t[o]+"px":"pr"==o&&(i["padding-right"]=t[o]+"px");e.css(n),e.find("div.zw-line-content").css(i)},DomUtil.setHRStyle=function(e,t){try{if(!t||!e)return;var n={},i=J(e);for(var o in t)if(t.hasOwnProperty(o)&&"type"!=o){var r=t[o];switch(o){case ATTR_HR.HR_WID:n.width=r;break;case ATTR_HR.HR_HT:n.height=r;break;case ATTR_HR.HR_AL:0==r?e.setAttribute("align","left"):1==r?e.setAttribute("align","center"):2==r?e.setAttribute("align","right"):3==r&&e.setAttribute("align","justify");break;case"bid":break;case"cls":i.addClass(r)}}i.css(n)}catch(e){}},DomUtil.setCellStyle=function(e,t,n,i){try{if(!t||!e)return;t&&t.hasOwnProperty(HISTORY_CONST.ACTION)&&(t=HistoryUtils.getDiffFormat(t));var o=J(e),r=DomUtil.getBorderStyles(t),a=DocUtil.getCellPadding(t),s="",l=o.parent().children(),d=o;n&&(d=o.children("div.zw-cell-container"));var c={};for(var u in t)if(t.hasOwnProperty(u)&&"type"!=u&&(s=t[u]))switch(u){case"z_td_bgc":r.backgroundColor=s;break;case ATTR_CELL.TDS_BGIMG:s=DomUtil.processImgSrc(s),r.background="transparent  url("+s+") 50%",r["background-size"]="100%";break;case ATTR_CELL.TDS_VA:"baseline"!=s&&(r["vertical-align"]=s);break;case ATTR_CELL.TDS_TXTAL:break;case ATTR_CELL.TDS_MRG:var p=i?i:e.parentElement;if("hmp"==s){if(r.display="none",J(e).attr("merge","hmp"),r["border-right"]&&!e.nextSibling)for(var h=p.children.length-1;h>=0;h--){if("fc"==p.children[h].attributes.merge.value){var f={};f["border-right"]=r["border-right"],J(p.children[h]).css(f);break}if("vmp"==p.children[h].attributes.merge.value)break}}else if("vmp"==s){if(r.display="none",J(e).attr("merge","vmp"),J(e).css("display","none"),r["border-bottom"]&&!p.nextSibling){var m=p.parentElement.parentElement,g=J(m).children()[1].children;for(h=g.length-1;h>=0;h--){if("fc"==g[h].children[e.cellIndex].attributes.merge.value){var f={};f["border-bottom"]=r["border-bottom"],J(g[h].children[e.cellIndex]).css(f);break}if("hmp"==g[h].children[e.cellIndex].attributes.merge.value)break}}}else"fc"==s&&J(e).attr("merge","fc");break;case ATTR_CELL.TDS_CSPAN:r.display&&"none"==r.display||e.setAttribute("colspan",s);break;case ATTR_CELL.TDS_RSPAN:r.display&&"none"==r.display||e.setAttribute("rowspan",s);break;case ATTR_CELL.TDS_HT:r.height=s,J(l).css({height:s});break;case ATTR_CELL.TDS_PL:c.paddingLeft=a.left+"px";break;case ATTR_CELL.TDS_PR:c.paddingRight=a.right+"px";break;case ATTR_CELL.TDS_PT:c.paddingTop=a.top+"px";break;case ATTR_CELL.TDS_PB:c.paddingBottom=a.bottom+"px";break;case"colwidth":s=s.convertor().pixels-1,r.width=s+"px",s-=a.left+a.right,s<0&&(s=0),c.width=s+"px";break;case"fc":r.color=s;break;case ATTR_COMMON.CLS:o.addClass(s)}o.css(r),d.css(c)}catch(e){}},DomUtil.setRowStyle=function(e,t){try{if(!t||!e)return;var n=J(e);t&&t.hasOwnProperty(TCConstants.TC)&&(t=TcView.updateDOMStyles(t)),t&&t.hasOwnProperty(HISTORY_CONST.ACTION)&&(t=HistoryUtils.getDiffFormat(t));var i="",o=DomUtil.getBorderStyles(t),r={};for(var a in t)if(t.hasOwnProperty(a)&&"type"!=a)switch(i=t[a],a){case ATTR_ROW.TRS_HT:break;case ATTR_ROW.TRS_BGC:o.backgroundColor=i;break;case"z_tr_bgc":r.backgroundColor=i}t.hasOwnProperty(ATTR_TEXT.CLS)&&n.addClass(t[ATTR_TEXT.CLS])}catch(e){}if(!jQuery.isEmptyObject(r)){var s=n.find("td");s.css(r)}jQuery.isEmptyObject(o)||n.css(o)},DomUtil.removeCursorNode=function(e,t){t=t?t:"start",e=e?e:editor.uuid;try{if(editor.doc.domCursor[e]){var n=editor.doc.getDomCursorNode(e,null,t);if(n[0]&&e!=editor.uuid){n.remove();var i=editor.doc.getCursorPortionNode(e,t);i&&i.parentNode&&DomUtil.normalizeNode(i.parentNode),delete editor.doc.domCursor[e][t].cursor}}}catch(e){}},DomUtil.normalizeNode=function(){(editor.browserInfo.isWebkit||editor.browserInfo.isGecko||editor.browserInfo.isPresto)&&aNode&&aNode.normalize()},DomUtil.placeNode=function(e,t,n){for(var i,o=!1,r=J(n);e;){if(3==e.nodeType){if(t<e.length){i=e.splitText(t);break}if(e.length==t){i=e,o=!0;break}t-=e.length}else J(e).hasClass("zw-space")&&t--;if(t<=0){i=e,(0!=t||0==t&&J(e).hasClass("zw-space"))&&(o=!0);break}if(!e.nextSibling){i=e,o=!0;break}e=e.nextSibling}return o?r.insertAfter(i):r.insertBefore(i),o?i.nextSibling:i},DomUtil.nodeTypeVsClass={paragraph:"div.zw-paragraph",table:"table.zw-table",tbody:"tbody.zw-tbody",tr:"zw-tr",td:"td.zw-td",link:"span.link",image:"img.zw-image"},DomUtil.getClassForNodeType=function(e){var t=DomUtil.nodeTypeVsClass[e];return t},DomUtil.tagVsClass={p:"div.zw-paragraph",span:"span.zw-portion",table:"table.zw-table",tbody:"tbody.zw-tbody",tr:"tr.zw-tr",td:"td.zw-td",hr:"div.zw-hr",br:".zw-br",image:"image.zw-image"},DomUtil.getTagWithClassName=function(e){var t=DomUtil.tagVsClass[e];return t=t?t:e},DomUtil.getPreviousSibling=function(e){if(!e)return null;for(var t=e.previousSibling;t&&3==t.nodeType;){if(J(t).parents().is("[class^=zw-]"))return t;t=t.parentNode}for(;t&&1==t.nodeType&&!J(t).is("[class^=zw-]");)t=t.previousSibling;return t},DomUtil.getNextSibling=function(e){if(!e)return null;for(var t=e.nextSibling;t&&3==t.nodeType;){if(J(t).parents().is("[class^=zw-]"))return t;t=t.parentNode}for(;t&&1==t.nodeType&&!J(t).is("[class^=zw-]");)t=t.nextSibling;return t},DomUtil.getElementAt=function(e,t,n){var i,o=J(n),r=DomUtil.getTagWithClassName(e);return i=o.hasClass("zw-contentpane")?editor.jeditorPane.find("div.zw-contentpane").find(r)[t]:o.find(r)[t]},DomUtil.addClickEventForLink=function(e,t,n,i){e.on("click",function(e){if(e.preventDefault(),2==t){var i=/^http(s)?:\/\/.*\..*/i,o=/^www\..*\..*/i;i.test(n)||o.test(n)?(o.test(n)&&(n=editor.scheme+"://"+n),Utils.safeWindowOpen(n)):Utils.moveToBookmark(n,!0)}else Utils.safeWindowOpen(n)}),i?e.children().css("cursor","pointer"):e.css("cursor","pointer")},DomUtil.setAnchorForImages=function(e,t){var n=J(t),i=e.type,o=e.url;DomUtil.addClickEventForLink(n,i,o,!0)},DomUtil.setLinkDatas=function(e,t){if(e){var n=J(t),i=e[ATTR_LINK.LINK_TYPE]?e[ATTR_LINK.LINK_TYPE]:"",o=(e[ATTR_IMAGE.I_TOOLTIP]?e[ATTR_IMAGE.I_TOOLTIP]:"",e[ATTR_LINK.LINK_TARGET]?e[ATTR_LINK.LINK_TARGET]:""),r=e[ATTR_LINK.LINK_URL]?e[ATTR_LINK.LINK_URL]:"";n.attr({"data-title":r,"data-href":r,"data-type":i,"data-target":o,title:i&&2!==i?r:""}),r&&(!editor.isEditable()||e.cls&&e.cls.indexOf("autopno_toc")!=-1)&&DomUtil.addClickEventForLink(n,i,r,!1)}},DomUtil.processCommentTime=function(e){return e=moment(parseInt(e)).format("h:mm a MMM D,YYYY")},DomUtil.handleMouseOutForTable=function(){"undefined"==typeof TableResize||TableResize.isInProgress()||(editor.jeditorPane.unbind("mousemove.TableResize"),TableResize.setIsColumnResize(!1),TableResize.setIsRowResize(!1),TableResize.setColSelection(!1),J("div#editorpane, table").children().css({"user-select":"text","-o-user-select":"text","-moz-user-select":"text","-khtml-user-select":"text","-webkit-user-select":"text"}))},DomUtil.handleMouseOverForTable=function(e){"undefined"!=typeof TableResize&&"undefined"!=typeof TableResize&&editor.jeditorPane.bind("mousemove.TableResize",function(e){TableResize.mouseMove(e)});e.srcElement||e.target},DomUtil.processImgSrc=function(e){var t=e;return t?(editor.doc.getRole()==USER_ROLE.PUBLIC?0===e.indexOf("image.do")?t=editor.getBaseURL()+"/"+e:0===e.indexOf("images/")?t=imgStaticURL+e:0===e.indexOf("/images/")&&(t=imgStaticURL+e.substring("/".length)):(ZWOffline.isOfflineSetupDone&&editor.isOffline()&&(t=window.commonimgStaticURL+"images/common/OfflineImage.png"),0!=t.indexOf("image.do")&&0!=t.indexOf("remoteImage.do")||(t=Utils.getContextUrl(t))),t):t},DomUtil.updateImageSrc=function(e){if(e){e=Utils.getContextUrl(e);var t;if(J(editor.clientActiveSection).find("image").each(function(){this.getAttribute("xlink:href")==e&&(t=this)}),t){t.setAttribute("xlink:href",e);var n=J(t);n.removeAttr("alt"),n.removeClass("ui-loading-img ui-loading-bg ui-pos-rel")}}},DomUtil.createLineDiv=function(){var e;e=document.createElement("div"),e.setAttribute("class","zw-line-div"),e.setAttribute("style","white-space:nowrap;position: relative");var t=document.createElement("div");return t.setAttribute("class","zw-line-content"),e.appendChild(t),e},DomUtil.createTOC=function(e){var t=editor.doc.getBodyFormat(),n='<div style="margin:10px;">';editor.isEditable()&&"SHAREDREADCOMMENT"!=editor.doc.getRole()&&"ANYONELINK_SHAREDREADCOMMENT"!=editor.doc.getRole()&&(n+='<span style="display:none;z-index:100;position:relative;" id="'+CONST.TOC_CLOSE+'" class="tocClose ui-toc-close" title="'+J.i18n("common","REMOVE_TOC")+'" onclick="editor.doc.execCmd(\'deletetoc\')">&nbsp;</span><span style="display:none;z-index:100;position:relative;" id="'+CONST.TOC_REGENERATE+'" class="tocRegenerate ui-toc-regenerate" title="'+J.i18n("common","REGENERATE_TOC")+'" onclick="editor.doc.execCmd(\'regeneratetoc\')">&nbsp;</span> <span style="display:none;z-index:100;position:relative;" id="'+CONST.TOC_SETTINGS+'" class="toc-settings ui-toc-settings" title="'+J.i18n("common","TOC_SETTINGS")+'">&nbsp;</span></div>');var i=J(document.createElement("div")).css("border-color",t[ATTR_BODY.DS_BGC]).attr({id:CONST.TOC_MAIN_DIV,bid:"pgbrk",class:"tocClass"}).html(n);return i.find("#"+CONST.TOC_REGENERATE+",#"+CONST.TOC_SETTINGS+",#"+CONST.TOC_CLOSE).on("mouseup",function(e){e.stopPropagation()}),i.find("#"+CONST.TOC_REGENERATE+",#"+CONST.TOC_SETTINGS+",#"+CONST.TOC_CLOSE).on("mousedown",function(e){var t=editor.browserInfo.is_ie?e.srcElement:e.target,n=J(t).parents("div#toc"),i=editor.doc.getSelection().getStart(),o=n.next("div.zw-paragraph")[0];if(o||(o=n.prev("div.zw-paragraph")[0]),o){i=DocUtil.getDocElement(o).getStart();var r=editor.doc.getSelection().getLastRange();r&&r.setStart(i)&&r.setEnd(i)}e.stopPropagation()}),i.find("#"+CONST.TOC_SETTINGS).on("click",function(e){return TocDialog.openTocSettingsDlg(),Utils.stopEvent(e),!1}),i.on("mouseover",function(){var e=J(this);editor.isEditable()&&!DocTreeManager.isSectionBuildInProcess()&&e.css("border-color","#D4D4D4").find("#"+CONST.TOC_CLOSE+",#"+CONST.TOC_REGENERATE+",#"+CONST.TOC_SETTINGS).show()}).on("mouseout",function(){var e=J(this),t=editor.doc.getBodyFormat();e.css("border-color",t[ATTR_BODY.DS_BGC]).find("#"+CONST.TOC_CLOSE+",#"+CONST.TOC_REGENERATE+",#"+CONST.TOC_SETTINGS).hide()}),DomUtil.setTOCStyle(e,i),i[0]},DomUtil.updateMarkingDiv=function(){var e=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start"),t=e.parents(".zw-line-div"),n=t.offset(),i=n.left,o=(n.top,t.children(".zw-line-content")),r=e.offset().left-i;J(".markingDiv").remove(),J(document.createElement("div")).addClass("markingDiv tc-rev-connector-horizontal").css({left:"-20px",width:r+20,position:"absolute","z-index":"2","border-top":"1px dotted #2d6fb9"}).prependTo(o),J(document.createElement("div")).addClass("markingDiv tc-rev-connector-horizontal").css({position:"absolute",width:"10",height:"3","margin-left":r,border:"1px solid #2d6fb9","background-color":"#2d6fb9"}).prependTo(o)},DomUtil.applyDocumentStyle=function(e){if(e){var t=editor.jeditorPane[0];for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];n==ATTR_BODY.DS_ML||n==ATTR_BODY.DS_MR||n==ATTR_BODY.DS_MT||n==ATTR_BODY.DS_MB?PubSub.publish("Document/margin/changed",n,i):n==ATTR_BODY.DS_PS||n==ATTR_BODY.DS_PW||n==ATTR_BODY.DS_PH?PubSub.publish("Document/papersize/changed",n,i):n==ATTR_BODY.DS_TPS?t.setAttribute("tabPoints",e[n]):n==ATTR_BODY.DS_STYLES||n==ATTR_BODY.DS_THEME?(Utils.setDocumentStyle(),PubSub.publish("Document/themeChanged")):n==ATTR_BODY.DS_PADTHEME&&PubSub.publish("Document/PadThemeChanged")}ViewManager.updatePageSettings(),(e[ATTR_BODY.DS_ML]||e[ATTR_BODY.DS_MT]||e[ATTR_BODY.DS_MR]||e[ATTR_BODY.DS_MB]||e[ATTR_BODY.DS_TPS]||e[ATTR_BODY.DS_VIEW]||e[ATTR_BODY.DS_PS])&&(editor.onResize(),TabHandler.updateDefaultValues())}},DomUtil.animateLine=function(e,t){if(!J.browser.msie){var n=Replace.drawLine(e,t);U.each(n,function(e){J(e).addClass("comnt-animated").bind("animationend webkitAnimationEnd MSAnimationEnd oAnimationEnd",function(t){J(e).remove()})})}},DomUtil.isHRDiv=function(e){var t=e?e.className:"";return t&&J(e).hasClass("zw-hr")},DomUtil.setTOCStyle=function(e,t){e&&e.hasOwnProperty(HISTORY_CONST.ACTION)&&(e=HistoryUtils.getDiffFormat(e)),DomUtil.setStyle(t[0],e)},DomUtil.setSpanBg=function(e,t){var n=document.createElement("span");J(n).addClass("zw-portion-bg").css({"background-color":t,"z-index":ZINDEX.TEXT_BACKGROUND}),e.css("position","relative"),e.find(".zw-portion-bg").remove(),e.append(n)},function(e){"use strict";var t="family",n="variants",i=new RegExp("^("+t+"|"+n+")$"),o=function(e){for(var t in e)if(i.test(t)){var o=e[t];if(t===n){var r,a,s={};for(r=4,a;r>0;r--)if(a="n"+r,o.hasOwnProperty(a)){s.n4=s.i4=s.n7=s.i7=o[a],o.hasOwnProperty(a="i"+r)&&(s.i4=o[a]);break}for(r=7,a;r<10;r++)if(a="n"+r,o.hasOwnProperty(a)){s.n7=s.i7=o[a],s.n4||(s.n4=o[a]),s.i4||(s.i4=o[a]),o.hasOwnProperty(a="i"+r)&&(s.i7=o[a]);break}o=s}this[t]=o}};o.prototype.getFontFaceCSS=function(e){var t=this.getFontName(),n=this.getFontURL(e);return"@font-face{font-family:'"+t+"';font-weight:"+(/n7|i7/.test(e)?"bold":"normal")+";font-style:"+(/^i/.test(e)?"italic":"normal")+";src:local('"+t+"'), url('"+n+"') format('"+n.substring(n.lastIndexOf(".")+1)+"');}"},o.prototype.getFontName=function(){return this[t]||""},o.prototype.getFontURL=function(e){return this.variants[e]||""},e.ZWWebFont=o}(window),function(e){"use strict";var t="loading",n="loaded",i="unloaded",o=["n4","n7","i4","i7"],r=function(e,t){if(e){t=t||document;var n=t.getElementById("webfonts-style");n?e=J(n).text()+e:(n=t.createElement(NODE_NAME.STYLE),n.id="webfonts-style",n.type="text/css",J(t.head).append(n)),J(n).text(e)}},a=function(e){return e.fontsToBeLoaded.length?1===e.retryCount++?(e.startTime=(new Date).getTime(),void WebFont.load(e)):(e.retryCount=0,e.startTime=(new Date).getTime(),e.custom={families:[e.fontsToBeLoaded.shift()]},void WebFont.load(e)):e.loadComplete()},s={status:{}};s.loadWebFonts=function(e,s){if(!Array.isArray(e)||!e.length)return"function"==typeof s&&s();for(var l,d,c=[],u="",p=0,h=e.length;p<h;p++){l=e[p],d=l.getFontName();for(var f,m,g,T=0,_=o.length;T<_;T++)f=o[T],m=d+":"+f,g=this.status[m],g!==t&&g!==n&&(u+=l.getFontFaceCSS(f),this.status[m]=t,c.push(m))}if(!c.length)return"function"==typeof s&&s();Utils.log("FontsToBeLoaded: ["+c+"]"),u&&(r(u),r(u,frames.metricsFrame.document));var E=this,v={callback:s,context:frames.metricsFrame,failedWebFonts:{},fontsToBeLoaded:c,fontactive:function(e,t){e=e+":"+t,Utils.log("SUCCESS: "+e+" - "+this.timeTaken+"ms"),delete this.failedWebFonts[e],E.status[e]=n,a(this)},fontinactive:function(e,t){e=e+":"+t,1===++this.retryCount?Utils.log("RETRY: "+e):Utils.log("FAILED: "+e),E.status[e]=i,this.failedWebFonts[e]=1,a(this)},loadComplete:function(){this.loading=this.active=this.inactive=this.fontloading=this.fontactive=this.fontinactive=void 0,"function"==typeof this.callback&&this.callback(Object.keys(this.failedWebFonts))},timeout:2e3};Object.defineProperties(v,{timeTaken:{get:function(){return(new Date).getTime()-this.startTime}}}),a(v)},e.ZWWebFontLoader=s}(window),function(){var e=Array.prototype.slice,t=Object.prototype.toString,n=Object.prototype.hasOwnProperty,i=Array.isArray||function(e){return"[object Array]"==t.call(e)},o=function(e,t,o){if(i(e))for(var r=0,a=e.length;r<a;r++)t.call(o,e[r]);else for(var s in e)n.call(e,s)&&t.call(o,e[s])},r=function(t){var i=e.call(arguments,1);return o(i,function(e){for(var i in e)n.call(e,i)&&(t[i]=e[i])}),t},a=function(e,t,n){return{node:e,op:t,contentIndex:n}},s=function(e,t){return{width:e,height:t}},l=s(0,0),d=function(e){return e[e.length-1]},c=function(e){return e[0]},u=function(e){var t={};for(var n in e)t[n]=e[n];return t},p=function(){var e=[UNICODE.IMAGE,UNICODE.BR,UNICODE.TAB];return function(t){return Utils.arrayContains(e,t)}}(),h=function(e,t,n,i,o,r){n=n||"",this.start=e,this.end=t||e+n.length,this.width=i,this.originalWidth=i,this.height=o,this.fontStringObj=r,this.isRTL=Utils.isStrictRTL(n),this.isNeutralChars=Utils.areNeutralCharacters(n),this.isArabic=Utils.isArabic(n)};h.prototype.getWordWidthAtIndex=function(e){if(e<=this.start)return 0;var t,n,i=this.line.parent,o=i.getIndex(),r=e>this.end?this.end:e,a=0,s=0,l="",d="";for(t=this.start;t<=r;t++){if(t===r){a=FontUtils.getCharSize(l,d),s+=a.width;break}this.fontStringObj&&this.fontStringObj.hasOwnProperty(t)&&(t>0&&this.isArabic&&(l+=FontUtils.ZERO_WID_JOINER),a=FontUtils.getCharSize(l,d),d=this.fontStringObj[t],s+=a.width,l=""),n=editor.doc.getCharAt(o+t)," "==n&&(n=FontUtils.SPACE_CHAR),l+=FontUtils.isCanvasSupported()?n:Utils.encodeHTMLChars(n)}return s},h.prototype.getFontStringObjAtIndex=function(e){if(e<this.start)return this.fontStringObj[this.start];for(var t=e;this.start<t&&!this.fontStringObj.hasOwnProperty(t);)t--;return this.fontStringObj[t]};var f=function(e,t){return t=editor.doc.findNextIndexOf(e,t+1),t<0&&(t=editor.doc.getDocumentLength()),t},m=function(e,t){var n=editor.doc.findPreviousIndexOf(CONT_REGEXP.PARAEND,t);return n<0?n=editor.doc.getSectionStart(t)+1:n+=1,n},g=function(e,t,n){var i;switch(e){case UNICODE.PARA:i=editor.doc.getCharAt(t)==UNICODE.PARA?t:f(CONT_REGEXP.PARAEND,t),i+=1;break;case UNICODE.TABLE:i=TableUtil.getTableEnd(t+1)||f(CONT_REGEXP.SECTIONEND,t);break;case UNICODE.ROW:i=TableUtil.getRowEnd(t+1);break;case UNICODE.CELL:i=TableUtil.getCellEnd(t+1)||f(CONT_REGEXP.SECTIONEND,t);break;case UNICODE.HR:i=t+1;break;case UNICODE.TOCSTART:i=f(UNICODE.TOCEND,t)+1;break;case UNICODE.SECTIONSTART:i=f(UNICODE.SECTION_START,t);break;default:i=f(CONT_REGEXP.PARAEND,t)}return i},T=function(t,n){var i=e.call(arguments,2);return J.Deferred(function(e){var o,r=10,a=0,s=n.length,l=function(){if(a<s){for(o=0;o<chunkSize&&a<s;o+=1,a+=1)e.notifyWith.apply(e,[t,[n[a],a,n].concat(i)]);setTimeout(l,r)}else e.resolveWith(t)};e.start=l})},_=function(e){for(;e.parent;)e=e.parent;return e},E=function(e){return e+"_"+("x"+Math.random()).replace(/\D/g,"")},v=function(e){return U.isEmpty(e)?e:(Object.defineProperties(e,{absEnd:{get:function(){return this.absStart+this.end-this.start}},absStart:{get:function(){var e=0,t=this;do e+=t.start;while(t=t.parent);return e}},content:{get:function(){return this.parent.content().substring(this.start,this.end)}},left:{get:function(){var e=this.parent,t=(e.getEndIndex(),e.paraProperties.paraFormat.dir||PARA_DIR.LTR),n=Math.max(this.style[ATTR_PARAGRAPH.PS_TI]||0,0);return 3===this.align?t===PARA_DIR.LTR?n:this.remainingWidth:this.remainingWidth*(t===PARA_DIR.RTL?2-this.align:this.align)/2+(t===PARA_DIR.LTR?n:0)}},parentStart:{get:function(){return this.parent.getIndex()}},right:{get:function(){var e=this.parent,t=(e.getEndIndex(),this.content),n=Utils.isRTL(t),i=n?c(this.blocks):d(this.blocks);return i?DocTreeManager.getLeftAtIndex(this.parent.getIndex()+i.start)+(n?0:i.width):0}}}),e)},S=function(e){return U.isEmpty(e)?e:(Object.defineProperties(e,{footNoteHeight:{get:function(){for(var e,t=0,n=this.footNotes.length,i=0;i<n;i++)e=NoteViewCollection.getNoteViews(this.footNotes[i].id),e.length&&(t+=e[0].getHeight());return t}}}),e)};r(this,{defineLineProperties:v,defineViewLineProperties:S,extend:r,makeOp:a,dimension:s,emptyDimension:l,firstElementOf:c,lastElementOf:d,clone:u,isSpaceChar:p,LineBlock:h,getEnd:g,getStart:m,asyncFor:T,findNextIndexOf:f,getSection:_,randomId:E})}(),function(){var e=function(e){if(!e.isVisible)return 0;var t,n,i=e.parent.parent,o=i.cols,r=this.getColIdx(e);if(i.isTableWidthInPercentage){for(n=e.cspan,n=n?n:1,t=o[r]?parseFloat(o[r].wt):0;n>1;){r+=1;var a=o[r]?parseFloat(o[r].wt):0;t+=a,n--}t=t*i.width/100}else for(t=o[r]?parseFloat(o[r].wt.convertor().pixels):0,n=e.cspan;n>1;){r+=1;var a=o[r]?parseFloat(o[r].wt.convertor().pixels):0;t+=a,n--}return t||0==t||(t=0),t},t=function(e){for(var t=e.parent.children,n=t.length,i=0,o=0;o<n&&e.id!=t[o].id;o++)i++;return i},n=function(e){for(var t=e.parent.children,n=t.length,i=0,o=0;o<n&&e.id!=t[o].id;o++)i++;return i},i=function(e){var t=DocTreeManager.doc.getComputedFormatAt(e.getIndex(),NODE_TYPE.TABLE),n=t[ATTR_TABLE.TBLS_WID];return!(!n||n.indexOf(UNITS.PERCENTAGE)===-1)},o=function(e){if(!e.merge||"vmp"==!e.merge)return 0;for(var n=t(e),i=e.parent,o=1;i;){if(i=i.prev){var r=i.children[n].merge;"fc"!=r&&"vmp"===r||(i=null)}o++}return o},r=function(e){if(!e.merge||"vmp"!=e.merge)return!1;var t=e.parent,n=t.next;if(n){var i=DTTableUtils.getColIdx(e);return!n.children[i]||"vmp"!=n.children[i].merge}return!0},a=function(e){var t=DocTreeManager.doc.getParents(NODE_TYPE.TABLE,e);return t?t.start:-1},s=function(e){var t=DocTreeManager.doc.getParents(NODE_TYPE.ROW,e);return t?t.start:-1},l=function(e){var t=DocTreeManager.doc.getParents(NODE_TYPE.CELL,e);return t?t.start:-1},d=function(e){var t=DocTreeManager.doc.getParents(NODE_TYPE.TABLE,e);return t?t.end:-1},c=function(e){var t=DocTreeManager.doc.getParents(NODE_TYPE.ROW,e);return t?t.end:-1},u=function(e){var t,n,i,o,r=e.firstRow?e.firstRow:e.band1Horz,a="1px solid black";return r&&r.cell&&r.cell.borders&&r.cell.borders["border-top"]?(t=r.cell.borders["border-top"],t&&(n=t.width,i=t.color,o=t.type,a=n+" "+o+" "+i)):e.tblPr&&e.tblPr.borders&&(t=e.tblPr.borders["border-top"]?e.tblPr.borders["border-top"]:e.tblPr.borders.insideH,t&&(n=t.width,i=t.color,o=t.type,a=n+" "+o+" "+Utils.getColorValFromRefString(i))),a};this.DTTableUtils={getColIdx:t,getRowIdx:n,getTableStart:a,getRowStart:s,getCellStart:l,getTableEnd:d,getRowEnd:c,getCellWidth:e,isLastVmpCell:r,getCellDepth:o,isTableInPercentage:i,getTableTopBorder:u}}();var FontUtils=function(){var e=function(e){return e[e.length-1]},t=function(e,t){return{width:e,height:t}},n={},i=10,o="abcdeijgymw",r=document.createElement("span");r.style.fontFamily="arial",r.style.fontSize="10pt",r.innerHTML=o,document.body.appendChild(r);var a=document.createElement("canvas");document.body.appendChild(a);var s=a.getContext("2d");s.font="10pt arial";var l=s.measureText(o).width,d=r.getBoundingClientRect().width;n.SPAN_WIDTH=d,n.CANVAS_WIDTH=l,s.font="100pt arial";var c=s.measureText(o).width/10;n.CANVAS10X_WIDTH=c,Math.abs(d-l).toFixed(3)>=.1&&Math.abs(d-c).toFixed(3)>=.1&&(n.CANVAS_DIFF=d-l,n.CANVAS10X_DIFF=d-c),r.style.display="none",a.style.display="none";var u=function(){return!1},p=u()?"":"&nbsp;",h=u()?"":"&zwj;",f=t(0,0),m={},g=[],T=[];m[ATTR_TEXT.TS_FW]="font-weight",m[ATTR_TEXT.TS_FS]="font-style",m[ATTR_TEXT.TS_FV]="font-variant",m[ATTR_TEXT.TS_TD]="text-decoration",m[ATTR_TEXT.TS_SIZE]="font-size",m[ATTR_TEXT.TS_FF]="font-family",m[ATTR_TEXT.TS_CS]="letter-spacing",m[ATTR_TEXT.TS_TT]="text-transform",g=Object.keys(m),m[ATTR_TEXT.TS_FGC]="color",m[ATTR_TEXT.TS_BGC]="background-color",T=Object.keys(m);var _,E,v,S=function(){if(0==g.length)for(key in m)m.hasOwnProperty(key)&&(key!=ATTR_TEXT.TS_FGC&&key!=ATTR_TEXT.TS_BGC&&g.push(key),T.push(key));return is_wkhtmltopdf_browser&&(g.splice(g.indexOf(ATTR_TEXT.TS_CS),1),T.splice(T.indexOf(ATTR_TEXT.TS_CS),1)),function(e,t,n,i){var o,r,a,s,l,d=[],c=[];for(e=e||{},t=t||{},t=DocUtil.updateWithCharStyle(t),e=DocUtil.updateWithCharStyle(e),d=n&&i?T:g,o=0,r=d.length;o<r;o++)if(a=d[o],a==ATTR_TEXT.TS_BGC?s=e[a]:a==ATTR_TEXT.TS_FF?s=Utils.fontFamilyRenderingFix(e[a]||t[a]):a!=ATTR_TEXT.TS_SIZE||!e[ATTR_TEXT.TS_VA]||"super"!=e[ATTR_TEXT.TS_VA]&&"sub"!=e[ATTR_TEXT.TS_VA]?(s=u()?e[a]||t[a]||"":e[a]||t[a]||0,!i&&a==ATTR_TEXT.TS_CS&&s&&u()&&(s+="ls")):(s=Math.round(.7*(e[a]||t[a]||0)),e[a]||(e[a]=e[a]||t[a]||0)),s=a==ATTR_TEXT.TS_SIZE?parseFloat(s,10)+"pt":s,l=m[a],"text-decoration"!==l&&"text-transform"!==l&&"font-variant"!==l&&"font-style"!==l||s)if(i||!u())c.push(m[a]+":"+s);else{if("string"==typeof s&&(s=(s||"").trim(),s.indexOf("normal")!=-1||0==s.indexOf("none")||s.indexOf("underline")!=-1||s.indexOf("line-through")!=-1||0==s.indexOf("all-caps")))continue;c.push(s)}return i||!u()?c.join(";").replace(/'/g,'"'):c.join(" ").replace(/"/g,"'")}}(),b={},R={},O='<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head><body style="font-family:Arial;"><span id="zwCharSpan" style="position:absolute;left:-50000px;top:-50000px;z-index:-50000;"><span style="display:inline-block;"></span></span><span id="zwImgSpan" style="position:absolute;left:-50000px;top:-50000px;z-index:-50000"></span></body></html>';O+='<canvas id="zw-char-canvas"></canvas>',E=window.frames.metricsFrame.document,E.open(),E.write(O),E.close(),_=E.getElementById("zwCharSpan"),v=E.getElementById("zw-char-canvas");var D=function(e,n,o){if(u()){var r,a,s,l,d,c,p,h,f=0;c=n.split(" ")||[],n.indexOf("ls")!=-1?(p=c[c.length-1]||"0pt",p=p.replace(/ls/g,""),n.indexOf("ls")!=-1&&(f=p.convertor().pixels*e.length),c.pop()):v.style.letterSpacing="";var m=I(c);a=parseFloat(c[m])||11,c[m]=a*i+"pt",n=c.join(" "),h=e,n.indexOf("uppercase")!=-1&&(e=e.toUpperCase(),n=n.replace(/uppercase/gi,"")),s=v.getContext("2d"),s.font=n,r="\f"==e?0:s.measureText(e).width/i+f,l=1.2*(a+"pt").convertor().pixels,d=t(r,l),o&&(o[h]=d)}else{_=_||E.getElementById("zwCharSpan"),_.innerHTML="<span style='display:inline-block;'><span style='"+n+"'>"+e+"<span></span>";var l,g=_.children[0].children[0].getBoundingClientRect();try{var T=n.split(/font-size\s*:\s*/)[1];l=T?1.2*T.split(";")[0].convertor().pixels:g.height}catch(e){l=g.height}var d=t(g.width,l);o&&(o[e]=d)}return d},y=function(e,t,n){D(e,t,n)},A=function(e){return b[e]={},y(p,e,b[e]),b[e][" "]=b[e][p],y(UNICODE.MULTIBYTE_SPACE,e,b[e]),b[e]},C=function(e,t){var n=b[t]||A(t);return n[e]||y(e,t,n),n[e]},I=function(e){var t,n=e.length;for(t=0;t<n&&(!e[t]||e[t].indexOf("pt")==-1);t++);return t},w=function(){var t=[],n=[],i={},o=-1,r=-1,a=0,s=!1,l=function(a,s,l){o<0&&(o=s,i[s]=l),t.length&&e(t)==l||(t.push(l),i[s]=l,n.push([])),u()?e(n).push(a):e(n).push(Utils.encodeHTMLChars(a)),r=s+1},d=function(){t.splice(0,t.length),n.splice(0,n.length),i={},a=0,o=r=-1},c=function(){for(var e=0,a=0,l="#",d="",c="",u=t.length,p="",g=0;g<u;g++)p+=n[g].join("");if(p=p.replaceAll("&nbsp;"," "),s=!!Utils.isArabic(p),u>1){for(var g=0;g<u;g++)c=n[g].join(""),s&&g!=u-1&&(c+=h),l+=c,d+=t[g]+" "+c+"; ";l+="#"}else d=t[0],l+=n[0].join(""),l+="#";var T=null;return R[d]?T=R[d][l]:R[d]={},T||(T=m(),R[d][l]=T),e=(R[d][l]||f).width,a=(R[d][l]||f).height,0!=e||_.parentNode&&_.parentNode.parentNode||PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.FONT_METRICS_ERROR,errorMsg:"MSG_EDIT_ERROR"}),new LineBlock(o,r,p,e,a,i)},p=function(){return o>=0?o:null},m=function(){var e,i=t.length,o={},r=0,a=0;for(e=0;e<i;e++)o=s&&e!=i-1?D(n[e].join("")+h,t[e]):D(n[e].join(""),t[e]),a+=o.width,r=Math.max(r,o.height);return o={},o.height=r,o.width=a,o},g=function(){return r-o==0};return{addChar:l,getBlock:c,start:p,isEmpty:g,clear:d,calculateMetrics:m}},P=function(e,t){return JSON.stringify(editor.doc.getContent(e||0,t||editor.doc.getDocumentLength()))},M=1,L=function(e){null==e||e.version&&e.version==M||(e={}),R=e||{}},N=function(){return null==R||R.version&&R.version==M||(R.version=M),R},U=function(){b={},R={}},x=function(){return n};return{getTestMetrics:x,getFontString:S,getCharSize:C,isCanvasSupported:u,getWord:w,setFontMetrics:L,getWordMetrics:N,contentBetween:P,clearAllMetrics:U,SPACE_CHAR:p,ZERO_WID_JOINER:h}}();extend(LinkedList.prototype,{addItem:function(e){this.items[e.id]=e,this.length+=1},append:function(e){e.prev=e.next=null,this.last?(this.last.next=e,e.prev=this.last):this.first=e,this.last=e,this.addItem(e)},insertAsFirst:function(e){e.prev=e.next=null,e.next=this.first,e.next&&(e.next.prev=e),this.first=e,!this.last&&(this.last=e),this.addItem(e)},insertAfter:function(e,t){e.prev=e.next=null,e.next=t.next,t.next&&(t.next.prev=e),e.prev=t,t.next=e,!e.next&&(this.last=e),!e.prev&&(this.first=e),this.addItem(e)},remove:function(e){return e.next&&(e.next.prev=e.prev),e.prev&&(e.prev.next=e.next),this.first==e&&(this.first=e.next||null),this.last==e&&(this.last=e.prev||null),e.next=null,e.prev=null,this.items[e.id]&&(this.length-=1),delete this.items[e.id],e},isEmpty:function(){return 0==this.length}});var DTNode=function(){"use strict";function e(e,t,n){for(ZRange.call(this,e,t),this.parent=n,this.next=null,this.prev=null,this.children=[],this.left=n.left||0,this.id="node_"+("x"+Math.random()).replace(/\D/g,"");n.parent;)n=n.parent;this.section=n,this.section.nodes[this.id]=this}return e.prototype=Object.create(ZRange.prototype),e.prototype.constructor=e,extend(e.prototype,{getChildNodes:function(){return this.children},getContent:function(){return editor.doc.getContent(this.getIndex(),this.getEndIndex()+1)},getFirstChild:function(){return e.prototype.firstChild.call(this)},getFormat:function(){return this.format},getLastChild:function(){return e.prototype.lastChild.call(this)},getNextSibling:function(){return this.next},getNodeRange:function(){return new ZRange(this.getIndex(),this.getEndIndex())},getNodeType:function(){return this.type},getOps:function(){var e,t=[],n={};if(this.hasChildNodes()){this.type!==NODE_TYPE.PARA&&(n=this.getFormat(),e=Utils.randomString(),t.push({as:{start:n,id:e}}),t.push({is:UNICODE[this.type.toUpperCase()]}),t.push({as:{end:DocUtil.getKeys(n),id:e}}));for(var i=this.getFirstChild();i;)t=t.concat(i.getOps()),i=i.getNextSibling();this.type===NODE_TYPE.PARA&&(n=this.getFormat(),e=Utils.randomString(),t.push({as:{start:n,id:e}}),t.push({is:UNICODE.PARA}),t.push({as:{end:DocUtil.getKeys(n),id:e}}))}else n=this.getFormat(),e=Utils.randomString(),t.push({as:{start:n,id:e}}),t.push({is:this.getContent()}),t.push({as:{end:DocUtil.getKeys(n),id:e}});return t},getParent:function(){return this.parent},getParents:function(){for(var e=this.getParent(),t=[e];e.type!==NODE_TYPE.SECTION;)t.push(e=e.getParent());return t},getPreviousSibling:function(){return this.prev},isNodeType:function(e){return this.type===e},hasChildNodes:function(){return!!this.children.length},firstChild:function(){if(this.children.length)return this.children[0]},lastChild:function(){var e=this.children.length;if(e)return this.children[e-1]},updateIndex:function(e){this.start+=e,this.end+=e},getIndex:function(){return this.parent.getIndex()+this.start},getEndIndex:function(){return this.parent.getIndex()+this.end-1},addChild:function(e){var t=this.children,n=t[t.length-1]||null;e.prev=n,n&&(n.next=e),t.push(e)},addChildAt:function(e,t){var n=this.children,i=n[t-1]||null,o=n[t]||null;e.prev=i,e.next=o,i&&(i.next=e),o&&(o.prev=e),this.children.splice(t,0,e)},getChildIndex:function(){var e=-1,t=this;if(!t)return e;for(e=0;t=t.prev;)e++;return e},contains:function(e){return this.getIndex()<=e.getIndex()&&e.getEndIndex()<=this.getEndIndex()},deleteChildAt:function(e){var t=this.children,n=t[e],i=n.prev||null,o=n.next||null;i&&(i.next=o),o&&(o.prev=i),this.children.splice(e,1)},updateNode:function(){this.section.nodesToUpdate.push(this.id,makeOp(this,"update"))},create:function(){},remove:function(){for(var e=this.children,t=0;t<e.length;t++)e[t].remove();this.parent.adjustHeight(),this.prev=this.next=this.parent=null,delete this.section.nodes[this.id]},update:function(){},adjustHeight:function(){for(var e=0,t=0,n=this.children.length;t<n;t++)e+=this.children[t].height||0;this.height=e,this.cellPadding&&(this.height+=this.cellPadding.top+this.cellPadding.bottom),this.cellHeight&&(this.height=Math.max(this.cellHeight||0,e)),this.borderProperties&&(this.height+=this.borderProperties.top+this.borderProperties.bottom),this.parent.adjustHeight()}}),e.types={},e}();!function(){"use strict";function e(e,t,n){DTNode.call(this,e,t,n)}function t(t,n,i){e.call(this,t,n,i),this.type=NODE_TYPE.FIELD_START,this.format=editor.doc.getRawFormatAt(this.getEndIndex())||{type:NODE_TYPE.FIELD_START}}function n(t,n,i){e.call(this,t,n,i),this.type=NODE_TYPE.FIELD_END,this.format=editor.doc.getRawFormatAt(this.getEndIndex())||{type:NODE_TYPE.FIELD_END}}NODE_TYPE.FIELD_START="fieldstart",NODE_TYPE.FIELD_END="fieldend",e.prototype=Object.create(DTNode.prototype),e.prototype.constructor=e,e.prototype.getFieldID=function(){var e=this.getFormat();return e&&e.id},e.prototype.getFieldName=function(){var e=this.getFormat();return e&&e.type},e.prototype.getFieldType=function(){var e=this.getFormat();return e&&e.type},t.prototype=Object.create(e.prototype),t.prototype.constructor=t,n.prototype=Object.create(e.prototype),n.prototype.constructor=n,DTNode.types[NODE_TYPE.FIELD_START]=t,DTNode.types[NODE_TYPE.FIELD_END]=n}(),function(){"use strict";function e(e,t,n,i){ZRange.call(this,e,t),this.isRTL=n,this.format=i}function t(e,t,n){DTNode.call(this,e,t,n),this.format=editor.doc.getRawFormatAt(this.getEndIndex()),this.type="para"}t.prototype=Object.create(DTNode.prototype),t.prototype.constructor=t,extend(t.prototype,{getHeadingType:function(){return this.format[ATTR_PARAGRAPH.PS_HD]||0},getTextFormat:function(){return this.format.textFormat},getFloatImageIndex:function(e){var t,n,i;for(t=0,i=this.paraProperties.floatImages.length;t<i;t++)if(n=this.paraProperties.floatImages[t],n.fid==e)return n.index+this.getIndex();return-1},setParaStyles:function(){this.paraStyles=editor.doc.getComputedFormatAt(this.getEndIndex(),NODE_TYPE.PARAGRAPH)},getParaStyles:function(){return this.paraStyles||editor.doc.getComputedFormatAt(this.getEndIndex(),NODE_TYPE.PARAGRAPH)},setParaProperties:function(){var e=this.parent.getIndex(),t=e+this.start,n=e+this.end,i=this.getEndIndex(),o=this.section.doc.getComputedFormatAt(i,NODE_TYPE.PARAGRAPH),r=this.getParaStyles(),a=0;r[ATTR_PARAGRAPH.PS_HD]=o[ATTR_PARAGRAPH.PS_HD],o&&o.hasOwnProperty(ATTR_PARAGRAPH.PS_AL)?a=o[ATTR_PARAGRAPH.PS_AL]:r&&r.hasOwnProperty(ATTR_PARAGRAPH.PS_AL)&&(a=r[ATTR_PARAGRAPH.PS_AL]),a=parseInt(a||"0",10),this.paraProperties=this.paraProperties||{},this.charSizes=this.charSizes||[];var s=DocUtil.copyStyle(o[ATTR_PARAGRAPH.PS_TS]);for(var l in s)s.hasOwnProperty(l)&&s[l]||delete s[l];extend(this.paraProperties,{paraStart:t,paraEnd:n,charSizes:[],textFormat:s,paraFormat:r,lineHeight:o&&o[ATTR_PARAGRAPH.PS_LS]||r[ATTR_PARAGRAPH.PS_LS]||1.2,spaceBeforeParagraph:(o&&o[ATTR_PARAGRAPH.PS_SB]||r[ATTR_PARAGRAPH.PS_SB]||"0").convertor().pixels,spaceAfterParagraph:(o&&o[ATTR_PARAGRAPH.PS_SA]||r[ATTR_PARAGRAPH.PS_SA]||"0").convertor().pixels,tabPoints:TabHandler.getTabPoints(o),align:a,inlineImages:[],floatImages:[],runningHeight:0,isCode:!!o[ATTR_PARAGRAPH.PS_CODE],isQuote:!!o[ATTR_PARAGRAPH.PS_QUOTE],pageBreakBefore:o[ATTR_PARAGRAPH.EN_PB],linesTogether:o[ATTR_PARAGRAPH.EN_BL],widowsOrphan:o[ATTR_PARAGRAPH.EN_WO],codeLanguage:o[ATTR_PARAGRAPH.PS_CODE]&&o[ATTR_PARAGRAPH.PS_CODE].lg,level:parseInt(o&&o[ATTR_PARAGRAPH.PS_HD]||"0",10),comments:[],commentEnds:[],fields:{},tabs:[],isHeading:!1}),o[ATTR_PARAGRAPH.PS_HD]&&parseInt(o[ATTR_PARAGRAPH.PS_HD])>0&&parseInt(o[ATTR_PARAGRAPH.PS_HD])<=9&&(this.paraProperties.isHeading=!0),this.formula=0},setListProperties:function(e){var t,n,i,o,r,a,s,l,d,c,u,p=this.section.lists,h=this.paraProperties.listData,f=e.ls_data,m=!1,g=!1;this.paraProperties.listData=this.paraProperties.listData||{},h=this.paraProperties.listData,n=h.id,n&&n!=f.id&&(this.resetListProperties(),h=this.paraProperties.listData),this.paraProperties.isList=!0,this.paraProperties.isHeadingList=!1;var T=!1;if(e[ATTR_PARAGRAPH.PS_HD]&&parseInt(e[ATTR_PARAGRAPH.PS_HD])>0&&(T=!0),T){var _=editor.doc.getListObj(f.id),E=_.level0.htype;E&&(this.paraProperties.isHeadingList=!0)}for(t=h.listLevel,extend(this.paraProperties.listData,{id:parseInt(f.id),listLevel:parseInt(f.l)}),p[f.id]||(p[f.id]=[],p[f.id].push(this)),i=p[f.id],l=this.paraProperties.paraStart,c=0,u=i.length;c<u;c++){if(o=i[c],o.id==this.id){m=!0,d=c+1;break}if(o.getIndex()>l){m=!0,g=!0,i.splice(c,0,this),d=c+1;break}}m||(i.push(this),d=i.length);var v=d-1,S={},b=h.listLevel,R=b;if(1==i.length||0==v)for(var O=0;O<=h.listLevel;)S["level"+O]=editor.doc.getListStartingNo(this.paraProperties.listData.id,O),O+=1;else{var a=DocUtil.copyStyle(i[v-1].paraProperties.listData),D=a.levelInfo;if(R=a.listLevel,b==R)S=D,S["level"+b]=S["level"+b]+1;else if(b>R){var y=R+1;for(S=D;y<=b;)S["level"+y]=editor.doc.getListStartingNo(this.paraProperties.listData.id,y),y+=1}else if(b<R){var y=R;for(S=D;y>b;)delete S["level"+y],y--;y==b&&(S["level"+y]=S["level"+y]+1)}}this.paraProperties.listData.levelInfo=S,s=editor.doc.getListType(f.id,f.l);var A=DocUtil.copyStyle(h);if((h.listLevel&&t!=f.l||h.listType&&h.listType!=s||g)&&this.updateAllListFromCurrentList(d,i),r=List.getListNumber(s,A.levelInfo["level"+b],A),extend(this.paraProperties.listData,{listType:s,levelInfo:S,listNumberString:r,isChecked:f.isChecked||!1,state:f.state||0}),this.updateListStyles(),0==n){var u=p[n].length;p[n][u-1].getIndex()==this.getIndex()&&0==n&&n!=f.id&&delete this.section.lists[n]}},updateListStyles:function(){var e=this.getEndIndex(),t=this.section.doc.getRawFormatAt(e),n=t[ATTR_PARAGRAPH.PS_TI],i=this.paraProperties.listData;n=Math.abs(n&&n.convertor().pixels||0),n||(n=0);var o=DocUtil.copyStyle(this.paraProperties.textFormat),r=editor.doc.getListObj(i.id),a=r&&r["level"+i.listLevel]||{},s={};a.paraFormat?s=DocUtil.copyStyle(a.paraFormat.textFormat)||{}:a.paraFormat={},i.listType==LIST_TYPE.CHECKLIST&&t.ls_data&&(i.listNumberString=t.ls_data.isChecked?"G":"J"),delete o[ATTR_TEXT.TS_BGC];var l=!0;i.listType!=LIST_TYPE.DISC&&i.listType!=LIST_TYPE.CIRCLE&&i.listType!=LIST_TYPE.BOX||(o.ff="arial");var d=Utils.mergeObjs([this.paraProperties.paraFormat.textFormat,o]),c=FontUtils.getFontString(s,d,l),u=a&&a.hasOwnProperty("img")?{width:a.img.wid,height:a.img.ht}:FontUtils.getCharSize(i.listNumberString,c),p=FontUtils.getFontString(s,d,l,!0);i.listType==LIST_TYPE.CHECKLIST&&t.ls_data&&(u.width=17);var h=u.width,f=0;if(i.listNumOriginalWidth=0,0==i.id||i.listType!=LIST_TYPE.UPPER_ROMAN&&i.listType!=LIST_TYPE.LOWER_ROMAN)if(h>n){var m=0==i.id?TabHandler.getDefaultTabPoints(Conversions.toGlobalUnit("0.25in")):TabHandler.defaultListTabPoints,g=t[ATTR_PARAGRAPH.PS_ML];g=g&&g.convertor().pixels||0;for(var T=TabHandler.paddingLeft+h+g-n,_=0,E=m.length;_<E;_++){var v=m[_].value;if(v>T){f=v-T,i.listNumOriginalWidth=h,h=v-TabHandler.paddingLeft-g+n,i.listRight=v-TabHandler.paddingLeft-(g?g:0)+n;break}}}else f=n-h,h=n,i.listRight=n+(g?g:0);else i.listRight=f=n;t[ATTR_PARAGRAPH.PS_DIR]==PARA_DIR.RTL?i.listStyle=p+";padding-left:"+f+"px;":i.listStyle=p+";padding-right:"+f+"px;",i.listPaddingRight=f,i.listCharSize=dimension(h,u.height)},resetListProperties:function(){var e,t,n,i=this.section.lists,o=i[this.paraProperties.listData.id];for(t=0,n=o.length;t<n;t++)if(e=o[t],e.id==this.id){o.splice(t,1);break}o.length||delete this.section.lists[this.paraProperties.listData.id],this.updateAllListFromCurrentList(t,o),this.paraProperties.isList=!1,this.paraProperties.isHeadingList=!1,this.paraProperties.listData={}},getPrevListInfo:function(e,t,n){var i,o,r,a,s={},l=t,d=null,c={};for(i=0,o=e.length;i<o&&e[i].id!=this.id;i++){if(r=e[i].paraProperties.listData.listLevel,c[r]=c[r]||{},n==r)l++;else if(r<n&&(l=t,d&&r<d.paraProperties.listData.listLevel))for(a=d.paraProperties.listData.listLevel;r<a;)c[a]||(c[a]={}),c[a].listNumber=editor.doc.getListStartingNo(this.paraProperties.listData.id,a)-1,a--;c[r].listNumber||(c[r].listNumber=t),c[r].listNumber=c[r].listNumber+1,d=e[i]}return s.prevList=d,s.listNumber=l,s.listLevelNumbers=c,s},updateAllListFromCurrentList:function(e,t){var n,i,o,r,a,s;for(n=e;n<t.length;n++){i=t[n],o=i.paraProperties.listData;var l={};if(n-1<0)for(var d=0;d<=o.listLevel;)l["level"+d]=editor.doc.getListStartingNo(o.id,d),d+=1;else if(r=t[n-1],a=r.paraProperties.listData,l=DocUtil.copyStyle(a.levelInfo),o.listLevel==a.listLevel)l["level"+o.listLevel]=l["level"+o.listLevel]+1;else if(a.listLevel>o.listLevel){for(s=a.listLevel;s>o.listLevel;)delete l["level"+s],s--;l["level"+s]=l["level"+s]+1,o.levelInfo=l}else{for(s=a.listLevel+1;s<=o.listLevel;)l["level"+s]=editor.doc.getListStartingNo(o.id,s),s++;o.levelInfo=l}o.listType=editor.doc.getListType(o.id,o.listLevel),o.levelInfo=l,i.updateListNumber()}},updateListNumber:function(){var e=this.paraProperties.listData,t=editor.doc.getListObj(e.id),n=t&&t["level"+e.listLevel]||{};e.listNumberString=List.getListNumber(e.listType,e.levelInfo["level"+e.listLevel],e);var i=this.getEndIndex(),o=this.section.doc.getRawFormatAt(i),r=o[ATTR_PARAGRAPH.PS_TI];r=Math.abs(r&&r.convertor().pixels||0),r||(r=0);var a=DocUtil.copyStyle(this.paraProperties.textFormat),s={};n.paraFormat?s=DocUtil.copyStyle(n.paraFormat.textFormat)||{}:n.paraFormat={},e.listType==LIST_TYPE.CHECKLIST&&o.ls_data&&(a[ATTR_TEXT.TS_FF]="zohopad-font",a[ATTR_TEXT.TS_VA]="middle",e.listNumberString=o.ls_data.state?"G":"J"),delete a[ATTR_TEXT.TS_BGC];var l=!0,d=Utils.mergeObjs([this.paraProperties.paraFormat.textFormat,a]),c=FontUtils.getFontString(s,d,l),u=e.listCharSize.width,p=n.hasOwnProperty("img")?e.listCharSize.width:FontUtils.getCharSize(e.listNumberString,c).width;if(this.getTabIndexForListNumbering(p,r)==this.getTabIndexForListNumbering(u,r))this.updateListStyles(),ViewManager.updateListNumber(this);else{if(this.prev&&!this.prev.paraProperties)return;this.update(),PubSub.publish(this.section.name+"/op",makeOp(this,"update"))}},getTabIndexForListNumbering:function(e,t){for(var n=[t],i=Math.floor(t/48)+1,o=0;o<=10;)n.push(48*i++),o++;for(var r,a=0,s=0;r=n[s++];)if(e<=r){a=s;break}return a},updateProperties:function(e,t){var n=this.getEndIndex(),i=this.section.doc.getComputedFormatAt(n,NODE_TYPE.PARAGRAPH),o=!t,r=!!i.ls_data;this.setParaStyles(),this.borderProperties=clone(Utils.getBorderSize(i)),this.setParaProperties(),this.width=this.parent.width-(this.borderProperties[ATTR_BORDERS.BORDER_LEFT]+this.borderProperties[ATTR_BORDERS.BORDER_RIGHT]),this.left=this.parent.left,e&&!o||(r?this.setListProperties(i):this.paraProperties.isList&&!r&&this.resetListProperties()),this.format=editor.doc.getRawFormatAt(n)},getMarginProperties:function(e){var t=0,n=0,i=Utils.getBorderSize(e);return t+=i[ATTR_BORDERS.BORDER_LEFT]+i[ATTR_BORDERS.BORDER_RIGHT],n+=i[ATTR_BORDERS.BORDER_TOP]+i[ATTR_BORDERS.BORDER_BOTTOM],t+=e[ATTR_IMAGE.I_ML]&&e[ATTR_IMAGE.I_ML].convertor().pixels||0,t+=e[ATTR_IMAGE.I_MR]&&e[ATTR_IMAGE.I_MR].convertor().pixels||0,n+=e[ATTR_IMAGE.I_MT]&&e[ATTR_IMAGE.I_MT].convertor().pixels||0,n+=e[ATTR_IMAGE.I_MB]&&e[ATTR_IMAGE.I_MB].convertor().pixels||0,{width:t,height:n}},applyShapeMarginProperty:function(e,t){var n=J.extend(!0,{},e),i=parseInt(t.height),o=parseInt(t.width),r=n.hasOwnProperty(ATTR_IMAGE.I_MT)&&n[ATTR_IMAGE.I_MT].convertor().pixels||0,a=n.hasOwnProperty(ATTR_IMAGE.I_MB)&&n[ATTR_IMAGE.I_MB].convertor().pixels||0,s=n.hasOwnProperty(ATTR_IMAGE.I_ML)&&n[ATTR_IMAGE.I_ML].convertor().pixels||0,l=n.hasOwnProperty(ATTR_IMAGE.I_MR)&&n[ATTR_IMAGE.I_MR].convertor().pixels||0;return o+=l+s,i+=r+a,0!=r&&0!=a?t.top-=r:0!=r&&(t.top-=r),0!=s&&0!=l?t.left-=s:0!=s&&(t.left-=s),{top:t.top,left:t.left,height:i,width:o}},getImageProperties:function(e,t){var n,i,o,r=this.getMarginProperties(e),a=parseFloat(e[ATTR_IMAGE.I_CALC_WID]||e[ATTR_IMAGE.I_WID]||0),s=parseFloat(e[ATTR_IMAGE.I_HT]||0),l=e[ATTR_IMAGE.I_AL],d=editor.doc.getPaperWidth(),c=e[ATTR_COMMON.BORDERS]&&e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]?2*parseInt(e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]):0;if("front"==l||"behind"==l||e.shapeData)return emptyDimension;if(o=window.frames.metricsFrame.document.getElementById("zwCharSpan"),e[ATTR_IMAGE.I_SRC]&&(!a||!s||100==a&&"%"==e[ATTR_IMAGE.I_WID_UN]&&!e[ATTR_IMAGE.I_CALC_WID]||100==s&&"%"==e[ATTR_IMAGE.I_WID_UN])){n=document.createElement("img"),n=J(n);var i=DomUtil.processImgSrc(imgStaticURL+"images/shape-obj.png");n.attr("src",i),o.innerHTML="",J(o).append(n),a=n.width(),s=n.height(),this.section.unknownImages[t]={index:t,src:e.src,para:this}}else if(100===a&&"%"==e[ATTR_IMAGE.I_WID_UN]){n=document.createElement("img"),i=DomUtil.processImgSrc(e.src),n=J(n),n.attr("src",i),o.innerHTML="",J(o).append(n),a=this.width;var u=n.height(),p=n.width();0!=u&&0!=p&&(s=e[ATTR_IMAGE.I_HT]=Math.round(u*this.width/p))}if(a>d&&(s=s*d/a,a=d),e&&e.hasOwnProperty(ATTR_IMAGE.I_ROTATE)){var h=Utils.getTransformedSize(e[ATTR_IMAGE.I_ROTATE],a,s);a=h.width,s=h.height,e.rot_ht=h.height,e.rot_width=h.width,editor.doc.setFormatAt(t,e)}return editor.isFloatingImage(e)&&(s+=r.height,a+=r.width),dimension(a+c,s+c)},getAutoFieldValue:function(e,t){var n="";if(e.indexOf(AUTOFIELD_TYPE.AUTO_DATE)!=-1){var i=Utils.getMomentFmt(t[ATTR_AUTOFIELD.DATEFMT]),o=t[ATTR_AUTOFIELD.ISAUTO];if(editor.options.timeZone&&moment().zone()!=editor.options.timeZone){var r=parseInt(editor.options.timeZone);n=parseInt(o)?moment().zone(r).format(i):moment(t[ATTR_AUTOFIELD.VALUE]).format(i)}else n=parseInt(o)?moment().format(i):moment(t[ATTR_AUTOFIELD.VALUE]).format(i);"undefined"==typeof n&&(n=moment().format("M/D/YY"))}else if(e.indexOf(AUTOFIELD_TYPE.AUTO_DOCNAME)!=-1)n=editor.doc.getDocInfo().DOCUMENT_NAME_HTML;else if(e.indexOf(AUTOFIELD_TYPE.AUTO_DOCVERSION)!=-1)n=t.val;else if(e.indexOf(AUTOFIELD_TYPE.AUTO_AUTHOR)!=-1)n=editor.doc.getDocInfo().CREATOR_HTML;else if(e.indexOf(AUTOFIELD_TYPE.AUTO_FORMULA)!=-1)try{n=Formula.calc(t[ATTR_AUTOFIELD.FORMULA],DocTreeManager.getTableValues(this),DocTreeManager.getCurrentCell(this),DocTreeManager.getTableSize(this))}catch(e){n="0"}return n},clearChildren:function(){for(var e,t=0,n=this.children.length;t<n;t++)e=this.children[t],e.prev=e.next=e.parent=e.section=null,delete this.section.nodes[e.id];this.children.splice(0,this.children.length)},buildSegments:function(){this.clearChildren();var e,t,n,i,o,r,a,s,l,d=[],c=this.getIndex(),u=this.getEndIndex(),p=!1;for(e=c;e<u;e++){if(i=editor.doc.getRawFormatAt(e),t=editor.doc.getCharAt(e),t==UNICODE.IMAGE)if(l=this.getImageProperties(i,e),r=i[ATTR_IMAGE.I_AL],a=i[ATTR_IMAGE.I_SHAPEDATA],s=!(!i[ATTR_COMMON.ST]||"digisign-field"!=i[ATTR_COMMON.ST]),a){i.shapeData.hasOwnProperty("props")||(i.shapeData=JSON.parse(i.shapeData)[0]);var h=i.shapeData;h.hasOwnProperty("props")||(h=JSON.parse(h)[0]),r="cell"==this.parent.type?"square":h.wrapType,i.fid||(i.fid=Utils.randomString()),editor.doc.setFormatAt(e,i);var f=h.props.transform,m={top:f.pos.top,left:f.pos.left,height:f.dim.height,width:f.dim.width};if(f.rotate){var g=Utils.getTransformedSize(f.rotate,f.dim.width,f.dim.height);m.height=g.height,m.width=g.width,m.left-=(g.width-f.dim.width)/2,m.top-=(g.height-f.dim.height)/2}"square"==r&&(m=this.applyShapeMarginProperty(h,m)),this.paraProperties.floatImages.push({height:m.height,width:m.width,align:r,index:e-c,paraStart:c,fid:i.fid,top:m.top,left:m.left,parentId:this.id,shapeData:h,isShape:!0})}else s?(l=dimension(l.width+2,l.height),p=!0):(r||(i.al="bottom"),editor.doc.setFormatAt(e,i),r&&Utils.arrayContains(["left","right","square","front","behind"],r)&&(i.fid||(i.fid=Utils.randomString()),editor.doc.setFormatAt(e,i),this.paraProperties.floatImages.push({index:e-c,fid:i.fid,parentId:this.id}),l=emptyDimension),this.paraProperties.inlineImages.push({index:e-c,height:l.height}),l=dimension(l.width,0),p=!0);if(!J.isEmptyObject(i)){n=i[ATTR_COMMON.CLS];var T=i&&i.hasOwnProperty(ATTR_COMMON.FIELDINFO)?i[ATTR_COMMON.FIELDINFO]:null;if(n&&T){var _=new RegExp(CONT_REGEXP.AUTOFIELD_WITHOUT_PAGENO_COUNT);if(_.test(n)){var E=editor.doc.getRawFormatAt(e-1),v=n.match(_)[0];t=this.getAutoFieldValue(n,E),this.paraProperties.fields[T]=t,"autoformula"==v&&(this.formula=t)}else if(n.indexOf(CONST.NEXTRECORD)!=-1){var E=editor.doc.getRawFormatAt(e-1);t=UNICODE.MERGEFIELD_START+E[MAILMERGE.MMINFO][MAILMERGE.FIELD_NAME]+UNICODE.MERGEFIELD_END,this.paraProperties.fields[T]=t}}if(o){var S=new DTNode.types.run(o-c,e-c,this);this.addChild(S),d.push({start:o-c,end:e-c})}o=e}}if(o){var S=new DTNode.types.run(o-c,u-c,this);this.addChild(S),d.push({start:o-c,end:u-c})}if(this.isCode()){var b=this.paraProperties.codeLanguage;this.codeSegments=ZWPR.prettyTokens(editor.doc.getContent(c,u),b)}this.segments=d},buildBlocks:function(){this.clearChildren();var t,n,i,o,r,a,s,l,d,c,u,p,h,f,m,g,T=[],_=FontUtils.getWord(),E=(this.lineProperties,this.paraProperties),v=this.getIndex(),S=this.getEndIndex(),b=E.paraFormat.textFormat,R="",O={},D=!1,y=[],A=v,C=[],I=!1,w=editor.doc.getTrackChangeDetails().getDisplayMode(),P=0;for(y=Utils.getWordBreakIndex(v,S),t=0,h=y.length;t<h;t++){for(p=y[t],O={},_.clear(),D=!1,n=A;n<p;n++){if(I=!1,i=editor.doc.getCharAt(n),o=editor.doc.getRawFormatAt(n),o=o&&!J.isEmptyObject(o)?this.section.doc.getComputedFormatAt(n,NODE_TYPE.TEXT,E.paraFormat[ATTR_PARAGRAPH.PS_HD]):{},r=(o&&o[ATTR_TEXT.CLS]||"").toLowerCase(),d=J.isEmptyObject(o),R=o&&!d?FontUtils.getFontString(o,b):R,o[ATTR_TEXT.TS_VA]&&("super"==o[ATTR_TEXT.TS_VA]||"sub"==o[ATTR_TEXT.TS_VA])){var M=editor.doc.getRawFormatAt(n);M[ATTR_TEXT.TS_SIZE]=o[ATTR_TEXT.TS_SIZE]}if(i==UNICODE.RANGE_START||i==UNICODE.RANGE_END)if(a=dimension(0,0),D=!0,i==UNICODE.RANGE_START)if("endnote"==o.type||"footnote"==o.type){var L=DocTreeManager.getMetaSection(o.id||o.sid);L.setRangeIndex(n+1)}else"bookmark"==o.type&&o.id.indexOf("toc_")==-1?editor.bookmarks[o.id]={name:o.name}:"comment"===o.type&&this.paraProperties.comments.push(o.id);else"comment"===o.type&&this.paraProperties.commentEnds.push({id:o.id,index:n});else if(i==UNICODE.TAB){if(d){o={st:"tab",type:"text"},editor.doc.setFormatAt(n,o);var N=new RegExp(CONT_REGEXP.PORTION_END,"g");!N.test(editor.doc.getCharAt(n+1))&&J.isEmptyObject(editor.doc.getRawFormatAt(n+1))&&editor.doc.setFormatAt(n+1,{type:"text"}),d=!1}a={width:0,height:0},D=!0}else if(i==UNICODE.IMAGE)if(a=this.getImageProperties(o,n),D=!0,l=o[ATTR_IMAGE.I_AL],u=o[ATTR_IMAGE.I_SHAPEDATA],c=!(!o[ATTR_COMMON.ST]||"digisign-field"!=o[ATTR_COMMON.ST]),u){o.shapeData.hasOwnProperty("props")||(o.shapeData=JSON.parse(o.shapeData)[0]);var U=o.shapeData;U.hasOwnProperty("props")||(U=JSON.parse(U)[0]),l="cell"==this.parent.type?"square":U.wrapType,o.fid||(o.fid=Utils.randomString()),editor.doc.setFormatAt(n,o);var x=U.props.transform,k={top:x.pos.top,left:x.pos.left,height:x.dim.height,width:x.dim.width};if(x.rotate){var F=Utils.getTransformedSize(x.rotate,x.dim.width,x.dim.height);k.height=F.height,k.width=F.width,k.left-=(F.width-x.dim.width)/2,k.top-=(F.height-x.dim.height)/2}"square"==l&&(k=this.applyShapeMarginProperty(U,k)),this.paraProperties.floatImages.push({height:k.height,width:k.width,align:l,index:n-v,paraStart:v,fid:o.fid,top:k.top,left:k.left,parentId:this.id,shapeData:U,isShape:!0})}else c?(a=dimension(a.width+2,a.height),D=!0):(l||(o.al="bottom"),editor.doc.setFormatAt(n,o),l&&Utils.arrayContains(["left","right","square","front","behind"],l)&&(o.fid||(o.fid=Utils.randomString()),editor.doc.setFormatAt(n,o),this.paraProperties.floatImages.push({index:n-v,fid:o.fid,parentId:this.id}),a=emptyDimension),this.paraProperties.inlineImages.push({index:n-v,height:a.height}),a=dimension(a.width,0),D=!0);else if(i==UNICODE.BR)a=dimension(0,0),D=!0;else{var Y=o&&o.hasOwnProperty(ATTR_COMMON.FIELDINFO)?o[ATTR_COMMON.FIELDINFO]:null;if(r&&Y){var B=new RegExp(CONT_REGEXP.AUTOFIELD_WITHOUT_PAGENO_COUNT);if(B.test(r)){var H=editor.doc.getRawFormatAt(n-1),W=r.match(B)[0];i=this.getAutoFieldValue(r,H),this.paraProperties.fields[Y]=i,"autoformula"==W&&(this.formula=i)}else if(r.indexOf(CONST.NEXTRECORD)!=-1){var H=editor.doc.getRawFormatAt(n-1);i=UNICODE.MERGEFIELD_START+H[MAILMERGE.MMINFO][MAILMERGE.FIELD_NAME]+UNICODE.MERGEFIELD_END,this.paraProperties.fields[Y]=i}}var V=!1;w!==TCConstants.ALL_MARKUP_VIEW&&o[TCConstants.TC]&&(V=TcView.isCharSizeZero(o))," "==i&&(I=!0,i=FontUtils.isCanvasSupported()?"":"&nbsp;")}var G=new RegExp(CONT_REGEXP.AUTOFIELD_WITHOUT_PAGENO_COUNT_FORMULA),z=n-v;if(isSpaceChar(i)||r&&G.test(r)){if(_.isEmpty()||T.push(_.getBlock()),_.clear(),O[z]=R,D){var Z=editor.doc.getContent(v+z,v+z+1);T.push(new LineBlock(z,z+1,Z,a.width,a.height,O))}else _.addChar(i,z,R,a),T.push(_.getBlock());_.clear()}else _.addChar(i,z,R,a);if(m=void 0,g=0,!I){if(P&&!Utils.isStrictRTL(i)){if(P=0,f){var j=new DTNode.types.run(f-v,n-v,this);this.addChild(j);var X=editor.doc.getContent(f,n),K=Utils.isStrictRTL(X);m=new e(f-v,n-v,K,s)}f=n,g=1}if(!P&&(P=Utils.isStrictRTL(i),!g&&P)){if(f){var j=new DTNode.types.run(f-v,n-v,this);this.addChild(j);var X=editor.doc.getContent(f,n),K=Utils.isStrictRTL(X);m=new e(f-v,n-v,K,s)}f=n,g=1}}if(!g&&!d&&o){if(s=DocUtil.copyStyle(o),f){var X=editor.doc.getContent(f,n),K=(editor.doc.getRawFormatAt(f),Utils.isStrictRTL(X)),$=NODE_TYPE.RUN;X===UNICODE.RANGE_START&&($=NODE_TYPE.FIELD_START),X===UNICODE.RANGE_END&&($=NODE_TYPE.FIELD_END),X===UNICODE.IMAGE&&($=NODE_TYPE.IMAGE);var j=new DTNode.types[$](f-v,n-v,this);this.addChild(j),m=new e(f-v,n-v,K,s)}f=n,g=1}m&&C.push(m)}if(A=p,!_.isEmpty())if(D){var Z=editor.doc.getContent(v+z,v+z+1);T.push(new LineBlock(z,z+1,Z,a.width,a.height,O)),_.clear()}else T.push(_.getBlock())}if(f){var X=editor.doc.getContent(f,S),K=Utils.isStrictRTL(X),$=NODE_TYPE.RUN;X===UNICODE.RANGE_START&&($=NODE_TYPE.FIELD_START),X===UNICODE.RANGE_END&&($=NODE_TYPE.FIELD_END),X===UNICODE.IMAGE&&($=NODE_TYPE.IMAGE);var j=new DTNode.types[$](f-v,S-v,this);this.addChild(j),C.push(new e(f-v,S-v,K,s))}if(this.segments=C,this.codeSegments=[],this.isCode()){var q=this.paraProperties.codeLanguage;this.codeSegments=ZWPR.prettyTokens(editor.doc.getContent(v,S),q)}return T},create:function(){this.updateProperties(),PubSub.publish("Para/Create",this)},update:function(e,t){this.updateProperties(e,t),PubSub.publish("Para/Update",this)},modify:function(){var e=!0;this.updateProperties(e),PubSub.publish("Para/Modify",this)},remove:function(){this.paraProperties&&this.paraProperties.isList&&this.resetListProperties(),this.parent.adjustHeight(),PubSub.publish("Para/Remove",this),this.prev=this.next=this.parent=null,delete this.section.nodes[this.id]},content:function(){var e=this.parent.getIndex(),t=e+this.start,n=e+this.end;return editor.doc.getContent(t,n)},isHeading:function(){return this.paraProperties.level>0},headingLevel:function(){return this.paraProperties.level},isCode:function(){return this.paraProperties&&this.paraProperties.isCode},getCodeTheme:function(){var e;if(this.isCode()){var t=this.paraProperties.paraFormat.code||{};e=t.theme}return e},getCodeLanguage:function(){return this.isCode()?this.paraProperties.codeLanguage:""},getCodeProperties:function(){return this.isCode()&&this.format[ATTR_PARAGRAPH.PS_CODE]?this.format[ATTR_PARAGRAPH.PS_CODE]:{}},getComments:function(){return this.paraProperties.comments},getCommentEnds:function(){return this.paraProperties.commentEnds},getTabIndexes:function(){return this.paraProperties.tabs},getTopAtIndex:function(e){var t,n,i,o=0,r=this.getIndex();for(t=0,i=this.children.length;t<i&&(n=this.children[t],!(e<=r+n.end));t++)o+=n.height;return o}}),DTNode.types[UNICODE.PARA]=t}(),function(){"use strict";function e(e,t,n){DTNode.call(this,e,t,n),this.format=editor.doc.getRawFormatAt(this.getIndex()),this.type=NODE_TYPE.RUN}e.prototype=Object.create(DTNode.prototype),e.prototype.constructor=e,DTNode.types[NODE_TYPE.RUN]=e}(),function(){"use strict";function e(e,t,n){DTNode.call(this,e,t,n),this.format=editor.doc.getRawFormatAt(this.getIndex()),this.type=NODE_TYPE.IMAGE}e.prototype=Object.create(DTNode.prototype),e.prototype.constructor=e,DTNode.types[NODE_TYPE.IMAGE]=e}(),function(){"use strict";function e(e,t,n){DTNode.call(this,e,t,n),this.format=editor.doc.getRawFormatAt(this.getIndex()),this.type=NODE_TYPE.CELL;var i,o,r,a,s,l=this.start,d=this.end,c=this.parent.getIndex(),u=c+this.start;for(l+=c,d+=c,i=l+1;i<d;)o=editor.doc.getCharAt(i),DTNode.types[o]?o==UNICODE.PARA?(a=getStart(UNICODE.PARA,i)-u,s=getEnd(UNICODE.PARA,i)-u,r=new DTNode.types[UNICODE.PARA](a,s,this),this.addChild(r),this.section.nodesToUpdate.push(r.id,makeOp(r,"create")),i=u+r.end):o!=UNICODE.TABLE&&o!=UNICODE.HR&&o!=UNICODE.TOCSTART||(a=i-u,s=getEnd(o,i)-u,r=new DTNode.types[o](a,s,this),this.addChild(r),this.section.nodesToUpdate.push(r.id,makeOp(r,"create")),i=u+r.end):i+=1}e.prototype=Object.create(DTNode.prototype),e.prototype.constructor=e,extend(e.prototype,{addToCell:function(e,t){var n,i,o,r,a,s,l,d=this.children,c=this.getIndex();for(this.end+=t-e,a=d.length-1;a>=0&&(n=d[a],r=a,!(e>=n.start+c));a-=1)n.updateIndex(t-e);if(n&&"table"==n.type)return void n.addToTable(e,t);for(n&&e==n.end+c?("para"==n.type&&(n.start=getStart(UNICODE.PARA,n.start+c)-c,n.end=getEnd(UNICODE.PARA,n.start+c)-c),l=makeOp(n,"modify"),this.section.nodesToUpdate.push(l.node.id,l),r++):n&&(e=n.start+c,"para"==n.type&&(n.start=getStart(UNICODE.PARA,t)-c,n.end=getEnd(UNICODE.PARA,t)-c,l=makeOp(n,"modify"))),n||r||(r=0),a=e;a<t;)s=editor.doc.getCharAt(a),DTNode.types[s]?(s==UNICODE.PARA?(i=getStart(UNICODE.PARA,a)-c,o=getEnd(UNICODE.PARA,a)-c):s!=UNICODE.TABLE&&s!=UNICODE.HR&&s!=UNICODE.TOCSTART||(i=a-c,o=getEnd(s,a)-c),n=new DTNode.types[s](i,o,this),this.section.nodesToUpdate.push(n.id,makeOp(n,"create")),this.addChildAt(n,r),r++,a=c+n.end):a+=1;l&&this.section.nodesToUpdate.push(l.node.id,l)},deleteFromCell:function(e,t,n){var i,o,r,a=this.children,s=this.getIndex();for(this.end-=t-e,r=0;r<a.length;r++){if(i=a[r],o=r,i.start+s>e){o=r-1,i=i.prev||i;break}if("para"!=i.type&&i.start+s==e)break}if("table"==i.type&&i.start+s!=e)i.deleteFromTable(e,t,n);else{for(;i&&i.end+s<=t;)this.section.nodesToUpdate.push(i.id,makeOp(i,"remove")),this.deleteChildAt(o),i=i.next;i&&("para"==i.type?(i.end=getEnd(UNICODE.PARA,e)-s,i.start=getStart(UNICODE.PARA,e)-s,this.section.nodesToUpdate.push(i.id,makeOp(i,"modify"))):this.section.nodesToUpdate.push(i.id,makeOp(i,"update")))}for(r=a.length-1;r>=0&&(i=a[r],!(e>=i.start+s));r-=1)i.updateIndex(e-t)},updateNode:function(e,t){var n,i,o,r,a,s=this.children,l=this.getIndex();if((l==e||l==t-1)&&(this.section.nodesToUpdate.push(this.id,makeOp(this,"update")),t-e==1||l==t-1)){for(o=0;o<s.length;o++)this.section.nodesToUpdate.push(s[o].id,makeOp(s[o],"update"));return void(editor.browserInfo.is_firefox&&(a=this.parent.parent,this.section.nodesToUpdate.push(a.id,makeOp(a,"adjustBorder"))))}for(o=s.length-1;o>=0&&(n=s[o],i=o,!(e>=n.start+l));o-=1);if(t<l+n.end)return void n.updateNode(e,t);for("para"!=n.type&&n.updateNode(n.start+l,n.end+l),this.section.nodesToUpdate.push(n.id,makeOp(n,"update")),o=n.end+l;o<t;)r=editor.doc.getCharAt(o),DTNode.types[r]?r!=UNICODE.PARA&&r!=UNICODE.TABLE&&r!=UNICODE.HR&&r!=UNICODE.TOCSTART||(n=n.next,"para"!=n.type&&n.updateNode(n.start+l,Math.min(n.end+l,t)),this.section.nodesToUpdate.push(n.id,makeOp(n,"update")),o=n.end+l):(n=n.next,this.section.nodesToUpdate.push(n.id,makeOp(n,"update")),o=n.end+l)},getCellWidth:function(){return DTTableUtils.getCellWidth(this)},updateProperties:function(){var e=editor.doc.getThemeStyleFormatAt(this.getIndex()),t=e[ATTR_CELL.TDS_MRG];this.matrixPosition=this.getMatrixPosition(),this.merge=t,this.isVisible=!t||"fc"===t,this.rspan=e[ATTR_CELL.TDS_RSPAN]||void 0,this.cspan=e[ATTR_CELL.TDS_CSPAN]||void 0,this.borderProperties=Utils.getBorderSize(e),this.cellPadding=DocUtil.getCellPadding(e),this.cell_ht=e.ht&&e.ht.convertor().pixels||0,this.width=this.getCellWidth(),this.actualWidth=this.width,this.width=this.width-(this.borderProperties[ATTR_BORDERS.BORDER_LEFT]+this.borderProperties[ATTR_BORDERS.BORDER_RIGHT])-(this.cellPadding.left+this.cellPadding.right),this.width<=0&&(this.width=20),this.prev?this.left=this.prev.left+this.prev.width:this.left=this.parent.left||0,this.format=editor.doc.getRawFormatAt(this.getIndex())},create:function(){this.updateProperties()},update:function(){this.updateProperties()},getMatrixPosition:function(){return[this.parent.getChildIndex(),this.getChildIndex()]},getRootMergeCell:function(){for(var e=this,t=e.parent;e&&!e.isVisible&&e.merge;)if("hmp"===e.merge)e=e.prev;else if("vmp"===e.merge){if(t=t.prev,!t)break;e=t.children[e.getChildIndex()]}return e},getMergeCells:function(){if("fc"!==this.merge)return[];for(var e=this,t=e.parent,n=t.parent,i=e.getMatrixPosition(),o=i[0],r=i[1],a=o+e.rspan-1,s=r+e.cspan-1,l=[],d=o;d<=a;d++){t=n.children[d];for(var c=r;c<=s;c++)e=t.children[c],l.push(e)}return l}}),DTNode.types[UNICODE.CELL]=e}(),function(){"use strict";function e(e,t,n){DTNode.call(this,e,t,n),this.format=editor.doc.getRawFormatAt(this.getIndex()),this.type=NODE_TYPE.ROW;var i,o,r,a,s=this.start,l=this.end,d=this.parent.getIndex(),c=d+this.start;for(s+=d,l+=d,i=s+1;i<l;)r=i-c,a=getEnd(UNICODE.CELL,i,this.section.end)-c,o=new DTNode.types[UNICODE.CELL](r,a,this),this.addChild(o),this.section.nodesToUpdate.push(o.id,makeOp(o,"create")),i=c+o.end}e.prototype=Object.create(DTNode.prototype),e.prototype.constructor=e,extend(e.prototype,{addToRow:function(e,t){var n,i,o,r,a,s,l,d=this.children,c=-1,u=this.getIndex(),p=!1;for(this.end+=t-e,l=editor.doc.getCharAt(e),r=d.length-1;r>=0;r--){if(n=d[r],l==UNICODE.CELL&&e==u+n.end){c=r,p=!0;break}if(e>n.start+u){n.addToCell(e,t);break}n.updateIndex(t-e)}if(p||e==u+1&&l==UNICODE.CELL){for(a=e;a<t;){s=editor.doc.getCharAt(a),i=a-u,o=getEnd(UNICODE.CELL,a)-u,n=new DTNode.types[UNICODE.CELL](i,o,this),c++,this.addChildAt(n,c),this.section.nodesToUpdate.push(n.id,makeOp(n,"create"));for(var h=d.length,f=0;f<h;f++)d[f].updateNode(d[f].getIndex(),d[f].getIndex()+1);a=u+n.end}editor.browserInfo.is_firefox&&this.section.nodesToUpdate.push(this.parent.id,makeOp(this.parent,"adjustBorder"))}},deleteFromRow:function(e,t,n){var i,o,r,a,s,l=this.children,d=this.getIndex(),c=n.charAt(0);for(this.end-=t-e,r=l.length-1;r>=0;r--){if(i=l[r],i.start+d==e&&c==UNICODE.CELL){for(o=r,a=e;a<t;)s=n.charAt(a-e),i=l[o],a+=i.end-i.start,this.section.nodesToUpdate.push(i.id,makeOp(i,"remove")),this.deleteChildAt(o);editor.browserInfo.is_firefox&&this.section.nodesToUpdate.push(this.parent.id,makeOp(this.parent,"adjustBorder"));break}if(e>i.start+d){i.deleteFromCell(e,t,n);break}i.start+d>=t&&i.updateIndex(e-t)}if(c==UNICODE.CELL){var r,u=l.length;for(r=0;r<u;r++)l[r].updateNode(l[r].getIndex(),l[r].getIndex()+1)}},updateNode:function(e,t){var n,i,o,r,a,s=this.children,l=this.getIndex();if(this.section.nodesToUpdate.push(this.id,makeOp(this,"update")),l!=e||t-e!=1){for(o=s.length-1;o>=0&&(n=s[o],i=o,!(e>=n.start+l));o-=1);if(t<=l+n.end)return void n.updateNode(e,t);for(n.updateNode(n.start+l,n.end+l),this.section.nodesToUpdate.push(n.id,makeOp(n,"update")),o=n.end+l;o<t;)n=n.next,n.updateNode(n.start+l,Math.min(n.end+l,t)),this.section.nodesToUpdate.push(n.id,makeOp(n,"update")),o=n.end+l}else{var d=this.parent.fullRerender;if(d)for(o=0,a=s.length;o<a;o++)s[o].updateNode(s[o].getIndex(),s[o].getIndex()+1);else{var c=this.parent.affectedCols;if(c.length>0)for(o=0,a=s.length;o<a;o++)if(null!=c[o])if("hmp"==s[o].merge)for(var r=o;r>=0;){if(r--,"fc"==s[r].merge){s[r].updateNode(s[r].getIndex(),s[r].getIndex()+1);break}if("vmp"==s[r].merge)break}else{if("vmp"==s[o].merge)continue;s[o].updateNode(s[o].getIndex(),s[o].getIndex()+1)}}}},updateProperties:function(){this.width=this.parent.width,this.left=this.parent.left,this.height=22,this.format=editor.doc.getRawFormatAt(this.getIndex())},create:function(){this.updateProperties()},update:function(){this.updateProperties()},adjustHeight:function(){var e,t=this.children,n=0;for(e=0;e<t.length;e++)n=Math.max(n,t[e].height||0);this.height=n,this.parent.adjustHeight()}}),DTNode.types[UNICODE.ROW]=e}(),function(){"use strict";function e(e,t,n){DTNode.call(this,e,t,n),this.format=editor.doc.getRawFormatAt(this.getIndex()),this.type=NODE_TYPE.TABLE;var i,o,r,a,s=this.start,l=this.end,d=this.getIndex(),c=this.parent.getIndex();for(s+=c,l+=c,i=s+1;i<l-1;)r=i-d,a=getEnd(UNICODE.ROW,i,this.section.end)-d,o=new DTNode.types[UNICODE.ROW](r,a,this),this.addChild(o),this.section.nodesToUpdate.push(o.id,makeOp(o,"create")),i=d+o.end;editor.browserInfo.is_firefox&&this.section.nodesToUpdate.push(this.id,makeOp(this,"adjustBorder"))}e.prototype=Object.create(DTNode.prototype),e.prototype.constructor=e,extend(e.prototype,{addToTable:function(e,t){var n,i,o,r,a,s,l,d=this.children,c=-1,u=this.getIndex(),p=!1;for(this.end+=t-e,l=editor.doc.getCharAt(e),r=d.length-1;r>=0;r--){if(n=d[r],l==UNICODE.ROW&&e==n.end+u){c=r,p=!0;break}if(e>n.start+u){n.addToRow(e,t);break}n.updateIndex(t-e)}if(p||e==u+1&&l==UNICODE.ROW){for(a=e;a<t;)s=editor.doc.getCharAt(a),i=a-u,o=getEnd(UNICODE.ROW,a)-u,n=new DTNode.types[UNICODE.ROW](i,o,this),c++,this.addChildAt(n,c),this.section.nodesToUpdate.push(n.id,makeOp(n,"create")),a=u+n.end;editor.browserInfo.is_firefox&&this.section.nodesToUpdate.push(this.id,makeOp(this,"adjustBorder"))}},deleteFromTable:function(e,t,n){var i,o,r,a,s,l=this.children,d=this.getIndex(),c=n.charAt(0);for(this.end-=t-e,r=l.length-1;r>=0;r--){if(i=l[r],i.start+d==e&&c==UNICODE.ROW){for(o=r,a=e;a<t;)s=n.charAt(a-e),i=l[o],a+=i.end-i.start,this.section.nodesToUpdate.push(i.id,makeOp(i,"remove")),this.deleteChildAt(o);editor.browserInfo.is_firefox&&this.section.nodesToUpdate.push(this.id,makeOp(this,"adjustBorder"));break}if(e>i.start+d){i.deleteFromRow(e,t,n);break}i.updateIndex(e-t)}},updateNode:function(e,t){var n,i,o,r=this.children,a=this.getIndex();if(a!=e||(this.updateProperties(),this.section.nodesToUpdate.push(this.id,makeOp(this,"update")),t-e!=1)){for(o=r.length-1;o>=0&&(n=r[o],i=o,!(e>=n.start+a));o-=1);if(t<=a+n.end)return void n.updateNode(e,t);for(n.updateNode(n.start+a,n.end+a),this.section.nodesToUpdate.push(n.id,makeOp(n,"update")),o=n.end+a;o<t;)n=n.next,n?(n.updateNode(n.start+a,Math.min(n.end+a,t)),this.section.nodesToUpdate.push(n.id,makeOp(n,"update")),o=n.end+a):o++}else for(o=0;o<r.length;o++)r[o].updateNode(r[o].getIndex(),r[o].getIndex()+1)},updateProperties:function(){var e=this.getIndex();this.rawFormat=editor.doc.getRawFormatAt(e),this.borderProperties=Utils.getBorderSize(this.rawFormat),this.affectedCols=[],this.left=this.parent.left;var t=this.rawFormat[ATTR_TABLE.TBLS_WID],n=!0;this.rawFormat[ATTR_TABLE.TBLS_THEME]?this.theme=this.rawFormat[ATTR_TABLE.TBLS_THEME]:(this[ATTR_TABLE.TBLS_THEME]={},this[ATTR_TABLE.TBLS_THEME][ATTR_TABLE.TBLS_THEME_OBJECT]={tblPr:{cell:{borders:{"border-top":{type:"solid",width:"1px",color:"rgb(0,0,0)"},"border-left":{type:"solid",width:"1px",color:"rgb(0,0,0)"},"border-bottom":{type:"solid",width:"1px",color:"rgb(0,0,0)"},"border-right":{type:"solid",width:"1px",color:"rgb(0,0,0)"}}}}},this[ATTR_TABLE.TBLS_THEME][ATTR_TABLE.TBLS_THEMENAME]="theme1"),t&&t.indexOf("%")!=-1||(n=!1),this.isTableWidthInPercentage=n,this.fullRerender=!0;var i=this.rawFormat[ATTR_TABLE.TBLS_COLS];if(i&&this.rawFormat[ATTR_TABLE.TBLS_VER]&&"4.0"==this.rawFormat[ATTR_TABLE.TBLS_VER]){var o=i.length,r=this.cols,a=!1;if(r&&r.length===o)for(p=0;p<o;p++)r[p].wt!=i[p].wt||this.oldWidth!=t?(this.affectedCols.push(p),a=!0):this.affectedCols.push(null),this.fullRerender=!1;else r&&r.length!=o&&(this.fullRerender=!1,a=!0)}else{i=this.getCols();var s=i.length;for(p=0;p<s;p++)this.affectedCols.push(p)}var l,d=!1,o=i.length,c=ViewManager.getColumnWidth()/Conversions.globalUnitInPx;if(i[0].wt.indexOf("%")!=-1){var u=Conversions.toGlobalValue(this.actualWidth+UNITS.PIXELS);l=(c/o/parseFloat(u)*100).toFixed(3)+UNITS.PERCENTAGE}else l=(c/o).toFixed(3)+Conversions.globalUnit;for(var p=0;p<i.length;p++)(0==Object.keys(i[p]).length||isNaN(parseFloat(i[p].wt)))&&(d||(Utils.sendErrorDetails("AbnormalColsFromDttableUpdateProperties<ZWERROR>"+editor.doc.getDocInfo().VERSION+"."+editor.doc.getDocInfo().REVISION+"."+editor.doc.getDocInfo().RID+"<ZWERROR>\n Error Log Start \n buildLabel: "+buildLabel+"\n OldCols: "+JSON.stringify(this.cols)+"\n NewCols:"+JSON.stringify(i)+" Error Log End \n <ZWERROR>#### EmptyColsFromDttableUpdateProperties: \n\n AditionalInfo: AbnormalColsFromDttableUpdateProperties #####"),d=!0),i[p].wt=l);this.cols=i;var h=this.rawFormat;if(!t){var p,f=i.length;for(t=0,p=0;p<f;p++)t=parseFloat(i[p].wt)+t;t+=Conversions.globalUnit,h[ATTR_TABLE.TBLS_WID]=t}this.oldWidth=t,h=TableUtil.processTableWidth(this.getIndex(),h),this.width=h[ATTR_TABLE.TBLS_WID]&&h[ATTR_TABLE.TBLS_WID].convertor().pixels||this.parent.width,this.actualWidth=this.width,this.width-=this.borderProperties[ATTR_BORDERS.BORDER_LEFT]+this.borderProperties[ATTR_BORDERS.BORDER_RIGHT],this.format=editor.doc.getRawFormatAt(this.getIndex()),a&&PubSub.publish("Document/TableStructureModified")},create:function(){this.updateProperties()},update:function(){this.updateProperties()},adjustBorder:function(){},getRootMergeCells:function(){var e,t,n,i,o=0,r=0,a=[];for(t=this.children.length;o<t;o++)for(e=this.children[o],r=0,i=e.children.length;r<i;r++)n=e.children[r],(n.rspan||n.cspan)&&a.push(n);return a},getCols:function(){return this.createCols()},createCols:function(){var e,t,n=this.children,i=n.length,o=[],r=0;for(e=0;e<i;e++){var t,a=n[e].children,s=a.length,l=0;for(t=0;t<s;t++){var d=DocTreeManager.doc.getComputedFormatAt(a[t].getIndex(),NODE_TYPE.CELL);d.merge||l++}if(l==s){r=e;break}}var a=n[r].children,c=a.length,u=[],p=[],h=0,f="5%";for(e=0;e<c;e++){var d=DocTreeManager.doc.getComputedFormatAt(a[e].getIndex(),NODE_TYPE.CELL),m=d[ATTR_CELL.TDS_WID];m||(m=f),u.push(m),(this.isTableWidthInPercentage&&m.indexOf("%")!=-1||!this.isTableWidthInPercentage&&m.indexOf("%")==-1)&&h++}if(c==h)p=u;else{var g=(editor.doc.getPaperWidth()/Conversions.globalUnitInPx).toFixed(3)+Conversions.globalUnit;if(this.isTableWidthInPercentage){var T=parseFloat(this.rawFormat[ATTR_TABLE.TBLS_WID])*parseFloat(g)/100;for(e=0;e<c;e++)u[e].indexOf("%")!=-1?p.push(u[e]):p.push(Conversions.toGlobalUnit(u[e])/parseFloat(T)*100+UNITS.PERCENTAGE)}else{var T;for(T=this.rawFormat[ATTR_TABLE.TBLS_WID]?parseFloat(Conversions.toGlobalUnit(this.rawFormat[ATTR_TABLE.TBLS_WID])):parseFloat(g),e=0;e<c;e++)u[e].indexOf("%")==-1?p.push(u[e]):p.push(parseFloat(u[e])/100*parseFloat(T)+Conversions.globalUnit)}}for(e=0;e<c;e++){var d=DocTreeManager.doc.getComputedFormatAt(a[e].getIndex(),NODE_TYPE.CELL),m=p[e];if(!d.cspan||d.cspan<=1){m||(m=this.isTableWidthInPercentage?f:Conversions.toGlobalValue(20+UNITS.PIXELS));var _={wt:m};o.push(_)}else{var E=d.cspan;m||(m=this.isTableWidthInPercentage?parseFloat(f)*E+UNITS.PERCENTAGE:Conversions.toGlobalValue(20*E+UNITS.PIXELS)),m=m&&m.indexOf(UNITS.PERCENTAGE)==-1?Conversions.toGlobalValue(Conversions.toPixels(m)/E+UNITS.PIXELS):parseFloat(m)/E+UNITS.PERCENTAGE;for(var t=0;t<E;t++){var _={wt:m};o.push(_)}e+=E-1}}for(var e=0;e<o.length;e++)if(0==Object.keys(o[e]).length||isNaN(parseFloat(o[e].wt))){Utils.sendErrorDetails("EmptyColsFromCreateCols<ZWERROR>"+editor.doc.getDocInfo().VERSION+"."+editor.doc.getDocInfo().REVISION+"."+editor.doc.getDocInfo().RID+"<ZWERROR>\n Error Log Start \n buildLabel: "+buildLabel+"\n Error Log End \n <ZWERROR>#### EmptyColsFromCreateCols: \n\n AditionalInfo: EmptyColsFromCreateCols #####");break}return o}}),DTNode.types[UNICODE.TABLE]=e}(),function(){"use strict";function e(e,t,n){DTNode.call(this,e,t,n),this.format=editor.doc.getRawFormatAt(this.getIndex()),this.type=NODE_TYPE.HR}e.prototype=Object.create(DTNode.prototype),e.prototype.constructor=e,DTNode.types[UNICODE.HR]=e}(),DTUpdateQueue.prototype.priorityTable={remove:10,create:9,update:8,modify:7,adjustBorder:6},DTUpdateQueue.prototype.push=function(e,t){t.contentIndex=t.contentIndex||0;var n=this.nodesMap[e]||null;if(n){var i=this.priorityTable[n.op],o=this.priorityTable[t.op],r=this.nodesMap[e].contentIndex,a=t.contentIndex;return t.contentIndex=Math.min(r,a),(o>i||"done"==n.state)&&(this.nodesMap[e]=t,!0)}return this.nodesMap[e]=t,this.length++,!0},DTUpdateQueue.prototype.get=function(){for(var e in this.nodesMap){var t=this.nodesMap[e];"remove"===t.op&&"para"!=t.node.type&&this.removeChildren(t.node.children)}var n=[];return U.each(this.nodesMap,function(e,t){n.push(e)}),n=n.sort(function(e,t){return e.node.getIndex()-t.node.getIndex()})},DTUpdateQueue.prototype.remove=function(e){this.nodesMap[e]&&(delete this.nodesMap[e],this.length--)},DTUpdateQueue.prototype.removeChildren=function(e){for(var t=e&&e.length||0,n=0;n<t;n++){var i=e[n];this.remove(i.id),"para"!=i.type&&this.removeChildren(i.children)}},DTUpdateQueue.prototype.clear=function(){this.nodesMap={},this.length=0},extend(DTSection.prototype,{hasChildNodes:function(){return!!this.children.length},getFirstChild:function(){return this.children[0]},getIndex:function(){return this.start},getEndIndex:function(){return this.end},changeSectionType:function(e){var t=this.name;this.name=e,PubSub.publish("Section/TypeChange",this,t,e)},addToSection:function(e,t){var n,i,o,r,a,s,l,d,c=this.children,u=editor.doc.getContent(e,t);for(this.end+=t-e,d=e,a=c.length-1;a>=0&&(n=c[a],r=a,!(e>=n.start+this.start));a-=1)n.updateIndex(t-e);if(n){if("table"==n.type)return void n.addToTable(e,t);if("toc"==n.type)return void n.addToToc(e,t);e=n.start+this.start,"para"==n.type?(n.start=getStart(UNICODE.PARA,t)-this.start,n.end=getEnd(UNICODE.PARA,t)-this.start,l=u==UNICODE.PARA?makeOp(n,"update"):makeOp(n,"modify",d)):l=makeOp(n,"notify")}else this.nodelessRange?this.nodelessRange.to<t&&(this.nodelessRange.to=t):this.nodelessRange={from:e,to:t},e=this.nodelessRange.from,t=this.nodelessRange.to;for(a=e;a<t;)s=editor.doc.getCharAt(a),DTNode.types[s]?(s==UNICODE.PARA?(i=getStart(UNICODE.PARA,a)-this.start,o=getEnd(UNICODE.PARA,a)-this.start,this.nodelessRange=null):s!=UNICODE.TABLE&&s!=UNICODE.HR&&s!=UNICODE.TOCSTART||(i=a-this.start,o=getEnd(s,a)-this.start),n=new DTNode.types[s](i,o,this),this.nodesToUpdate.push(n.id,makeOp(n,"create")),this.addChildAt(n,r),r++,a=this.start+n.end):a+=1;l&&this.nodesToUpdate.push(l.node.id,l)},setRangeIndex:function(e){this.rangeIndex=e},getRangeIndex:function(){return this.rangeIndex},remove:function(){for(var e,t=this.children[0];t;)e=t,t=t.next,e.remove.call(e),this.deleteChildAt(0);this.nodesToUpdate.clear(),this.nodesToUpdate=null,this.nodelessRange=null,this.view={},this.doc=null,this.lists={},this.nodes={},this.def=null,PubSub.publish("Section/Remove",this)},deleteFromSection:function(e,t,n){var i,o,r,a,s=this.children;for(this.end-=t-e,i=0,a=s.length;i<a;i++){if(o=s[i],r=i,o.start+this.start>e){r=i-1,o=o.prev||o;break}if("para"!=o.type&&o.start+this.start==e)break}if(o){if("table"==o.type&&o.start+this.start!=e)o.deleteFromTable(e,t,n);else if("toc"==o.type&&o.start+this.start!=e)o.deleteFromToc(e,t,n);else{for(;o&&o.end+this.start<=t;)this.nodesToUpdate.push(o.id,makeOp(o,"remove")),this.deleteChildAt(r),o=o.next;o&&("para"==o.type?(o.end=getEnd(UNICODE.PARA,e)-this.start,o.start=getStart(UNICODE.PARA,e)-this.start,n==UNICODE.PARA?this.nodesToUpdate.push(o.id,makeOp(o,"update")):this.nodesToUpdate.push(o.id,makeOp(o,"modify"))):this.nodesToUpdate.push(o.id,makeOp(o,"update")))}for(i=s.length-1;i>=0&&(o=s[i],!(e>=o.start+this.start));i-=1)o.updateIndex(e-t)}else this.nodelessRange&&(this.nodelessRange.to-=t-e,this.nodelessRange.from>=this.nodelessRange.to&&(this.nodelessRange=null))},updateSection:function(e,t){var n,i,o,r,a=this.children;for(this.width=this.doc.width,o=a.length-1;o>=0&&(n=a[o],i=o,!(e>=n.start+this.start));o-=1);if("para"==n.type&&(n.end=getEnd(UNICODE.PARA,n.start+this.start)-this.start),t<this.start+n.end)return void n.updateNode(e,t);for("para"!=n.type&&n.updateNode(e,n.end+this.start),this.nodesToUpdate.push(n.id,makeOp(n,"update")),o=n.end+this.start;o<t;)r=editor.doc.getCharAt(o),DTNode.types[r]?r!=UNICODE.PARA&&r!=UNICODE.TABLE&&r!=UNICODE.HR&&r!=UNICODE.TOCSTART||(n=n.next,this.nodesToUpdate.push(n.id,makeOp(n,"update")),"para"!=n.type&&n.updateNode(this.start+n.start,Math.min(n.end+this.start,t)),o=n.end+this.start):(n=n.next,this.nodesToUpdate.push(n.id,makeOp(n,"update")),o=n.end+this.start)},updateIndex:function(e){this.start+=e,this.end+=e},addChild:function(e){var t=this.children,n=t[t.length-1]||null;e.prev=n,n&&(n.next=e),t.push(e)},addChildAt:function(e,t){var n=this.children,i=n[t-1]||null,o=n[t]||null;e.prev=i,e.next=o,i&&(i.next=e),o&&(o.prev=e),this.children.splice(t,0,e)},deleteChildAt:function(e){var t=this.children,n=t[e],i=n.prev||null,o=n.next||null;i&&(i.next=o),o&&(o.prev=i),this.children.splice(e,1)},handleUnknownImages:function(e){if(J.isEmptyObject(this.unknownImages))return void(e&&e.resolve());e&&e.reject();var t=0,n=[],i=[],o=window.frames.metricsFrame.document.getElementById("zwImgSpan"),r=this;for(var a in r.unknownImages)n[t]=J.Deferred(),function(e,t){var n=document.createElement("img");J(o).append(n),J(n).load(function(){var o=editor.doc.getRawFormatAt(e.index),r=parseFloat(o[ATTR_IMAGE.I_WID]||0),a=parseFloat(o[ATTR_IMAGE.I_HT]||0),s=editor.doc.getPaperWidth(),l=n.height,d=n.width;if(d>s&&(l=l/d*s,d=s),(!r||100==r&&"%"==o[ATTR_IMAGE.I_WID_UN])&&(o[ATTR_IMAGE.I_WID]=d,o[ATTR_IMAGE.I_ORGINALWID]=d),(!a||100==a&&"%"==o[ATTR_IMAGE.I_WID_UN])&&(o[ATTR_IMAGE.I_HT]=l,o[ATTR_IMAGE.I_ORGINALHT]=l),100==r&&"%"==o[ATTR_IMAGE.I_WID_UN]){var c=ViewManager.getColumnWidth();o[ATTR_IMAGE.I_HT]=o[ATTR_IMAGE.I_HT]*c/o[ATTR_IMAGE.I_WID],o[ATTR_IMAGE.I_CALC_WID]=c}if(o&&o.hasOwnProperty(ATTR_IMAGE.I_ROTATE)){var u=Utils.getTransformedSize(o[ATTR_IMAGE.I_ROTATE],o[ATTR_IMAGE.I_WID],o[ATTR_IMAGE.I_HT]);r=u.width,a=u.height,o.rot_ht=u.height,o.rot_width=u.width}i.push({para:e.para}),t.resolve()}).error(function(){var n=editor.doc.getRawFormatAt(e.index);n[ATTR_IMAGE.I_WID]=n[ATTR_IMAGE.I_ORGINALWID]=n[ATTR_IMAGE.I_HT]=n[ATTR_IMAGE.I_ORGINALHT]=.01,t.resolve()});var r=DomUtil.processImgSrc(e.src);J(n).attr("src",r),setTimeout(function(){t.resolve()},1e4)}(r.unknownImages[a],n[t]),t++;r.unknownImages={},J.when.apply(J,n).done(function(){for(o.innerHTML="",t=0;t<i.length;t++)r.doc.updateDocument(i[t].para.getIndex(),i[t].para.getEndIndex());if(r.doc.docopBuilder){var e=new DocOpBuilder;e.operation=r.doc.docopBuilder.operation,r.doc.docopBuilder.cursorStart&&(e.cursorStart=r.doc.docopBuilder.cursorStart,e.cursorEnd=r.doc.docopBuilder.cursorEnd,e.cursor.push({start:e.cursorStart,end:e.cursorEnd})),editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!0),e.applyTo(),editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!1)}else r.doc.applyChanges(),r.doc.buildChanges();r.doc.clearCurrentOp()})},updateList:function(e){var t=this.lists[e];t[0].updateAllListFromCurrentList(0,t)},buildNode:function(e,t,n,i){var o,r;o=e.node,"done"!=e.state&&(r=e.op,o[r].call(o),e.state="done",this.nodesToUpdate.remove(o.id),PubSub.publish(this.name+"/op",e),"para"==o.type&&i&&i.notify(o))},build:function(e,t,n){var i,o,r=this;PubSub.publish(this.name+"/started");var a=this.nodesToUpdate.get(),s=0,l=!1;if(editor.browserInfo.is_chrome){var o=0,d=a.length;for(o=0;o<d;o++){var c=a[o];if(!("table"!=c.node.type&&"row"!=c.node.type||"create"!=c.op&&"update"!=c.op)){chunkSize=1e3,l=!0;break}}}for(i=0;i<a.length;i++)"remove"==a[i].op?this.buildNode(a[i]):"para"==a[i].node.type&&(a[i].collabop=n&&"collabop"===n.operation||!1,a[i].triggerPagination=n&&n.triggerPagination||!1,s++);if(this.doc.docopBuilder=n,"content"!=this.name||!(s>5||a.length>10)||is_phantom_browser||is_wkhtmltopdf_browser){for(i=0;i<a.length;i++)this.buildNode(a[i]),0==i&&n&&"load"==n.operation&&(editor.isHardReload&&(PubSub.publish("Document/FirstTimeLoadingStart"),editor.isHardReload=!1),PubSub.publish("Document/LoadingStart"));PubSub.publish(this.name+"/complete",a.length),this.handleUnknownImages(e)}else{if(!editor.isHardReload&&!l){var u;this.doc.docopBuilder&&(u=this.doc.docopBuilder.operation),"InsertChar"==u?chunkSize=1:chunkSize=5}this.def=asyncFor(r,a,t).progress(r.buildNode).progress(r.trackProgress).done(function(){PubSub.publish(this.name+"/complete",a.length),r.handleUnknownImages(e)}).done(r.trackProgressDone).fail(function(){e.reject()}),this.def.start(),n&&"load"==n.operation&&(editor.isHardReload&&(PubSub.publish("Document/FirstTimeLoadingStart",a.length,s),editor.isHardReload=!1),PubSub.publish("Document/LoadingStart"))}},stopRendering:function(){this.def&&this.def.reject()},adjustHeight:function(){}}),extend(MetaElement.prototype,{updateIndex:function(e){this.start+=e,this.end+=e},create:function(){},resolve:function(){},reOpen:function(){},update:function(){},remove:function(){},content:function(){return editor.doc.getContent(this.parent.index+this.start+1,this.parent.index+this.end)},getIndex:function(){return this.parent.index+this.start},adjustHeight:function(){for(var e=0,t=0,n=this.children.length;t<n;t++)e+=this.children[t].height||0;this.height=e}});var DTDocument=function(e){var t,n=[],i={},o=null,r=!1,a={},s="clean";extend(a,e);var l=function(e){var t=editor.doc.getRawFormatAt(e);return t?t:{}},d=function(e){var t=editor.doc.getThemeStyleFormatAt(e);return t?t:{}},c=function(e,t){return editor.doc.getComputedFormatAt(e,t,arguments[2])},u=function(e){var t=editor.doc.getRawFormatAt(e);return!t||(t.cls||"").indexOf("autopcnt")===-1&&(t.cls||"").indexOf("autopno")===-1?!t||"endnote"!==t.cls&&"footnote"!==t.cls?void 0:NoteViewCollection.getNoteViewRangeElement(t.id):editor.doc.getPortionData(e+1,editor.getPageID()).node},p=function(){var e,t=0,n=0,i=editor.doc.getDocumentLength();do e=l(t),n=findNextIndexOf(CONT_REGEXP.SECTIONEND,t),!e.st||"header_primary"==e.st||"footer_primary"==e.st||e.hasOwnProperty("hftype")&&e.hftype!=-1?h(t,n):h(t,n,e.sid,!0),t=n;while(t<i)},h=function(e,o,r,s){var l=new DTSection(e,o,a);r&&(l.sid=r,l.id=r),n.push(l),n.sort(f),s?i[r]=l:(a[l.name]=l,(!t||t.end<l.start)&&(t=l))},f=function(e,t){return e.start-t.start},f=function(e,t){return e.start-t.start},m=function(e,t,n){t&&(section=he(e),section.changeSectionType(n))},g=function(e,t,n){t&&(section=he(e),PubSub.publish("Section/Updated",section))},T=function(){o=null},_=function(){r&&O();DocTreeManager.doc.currentDocopBuilder;try{var e,t,a;if("dirty"==s&&n[0].stopRendering(),s="dirty",o)if("insert"!=o.type&&"update"!=o.type||editor.doc.getCharAt(o.from)!=UNICODE.SECTION_START)if("delete"==o.type&&o.deletedString&&o.deletedString.charAt(0)===UNICODE.SECTION_START)for(var l,d=o.to,c=o.deletedString;o.from<d;){for(l=c.indexOf(UNICODE.SECTION_START,1),l==-1&&(l=c.length),e=n.length-1;e>=0;e-=1){if(t=n[e],t.start==o.from){t.remove(),n.splice(e,1),delete i[t.sid];break}t.updateIndex(-l)}d-=l,c=c.substr(l)}else switch(a=o.to-o.from,o.type){case"insert":for(e=n.length-1;e>=0;e-=1){if(t=n[e],t.start<o.from){t.addToSection(o.from,o.to);break}t.updateIndex(a)}break;case"delete":for(e=n.length-1;e>=0;e-=1){if(t=n[e],t.start<o.from){t.deleteFromSection(o.from,o.to,o.deletedString);break}t.updateIndex(-a)}break;case"update":for(e=n.length-1;e>=0;e-=1)t=n[e],o.from<=t.start&&o.to>=t.end?t.updateSection(t.start,t.end):t.start<=o.from&&t.end>=o.to&&t.updateSection(o.from,o.to)}else for(var u,p,f,T,_=o.from,E=editor.doc.getContent(o.from,o.to);_<o.to;){if(T=E.indexOf(UNICODE.SECTION_START,1),T==-1&&(T=E.length),u=editor.doc.getRawFormatAt(_)||{},p=u.sid,f=!(!u.st||"endnote"!=u.st&&"footnote"!=u.st),"update"==o.type){for(e=n.length-1;e>=0&&(t=n[e],t.start!=o.from);e-=1);t.name!==u.st?m(p,f,u.st):g(p,f,u.st)}else{for(e=n.length-1;e>=0&&(t=n[e],!(t.start<_));e-=1)t.updateIndex(T);h(_,_+T,p,f)}_+=T,E=E.substr(T)}o=null}catch(e){Utils.log("Exception @applyChanges");var v=e.message;throw v===ZWCollaboration.SHOW_CARET_GETPORTION_ERROR||v===ZWCollaboration.SHOW_CARET_SELECTION_ERROR||v===ZWCollaboration.SHOW_CARET_PLACENODE_ERROR||v===ZWCollaboration.SET_CURSOR_ERROR||v===ZWCollaboration.SET_COLLAB_CURSOR_ERROR?e:(Utils.log("_ERROR_IN_DOM_APPLYTO_ Exception: "+e.stack),"error in dom applyTo")}},E=function(e){var t=DocTreeManager.doc.currentDocopBuilder,n=editor.doc.getBodyFormat()[ATTR_BODY.DS_HF_TYPE];n&&n!=HEADER_FOOTER_TYPE.PRIMARY?n==HEADER_FOOTER_TYPE.DIFF_ODD_EVEN_PAGE?(a.header_odd.build(),a.footer_odd.build(),a.header_even.build(),a.footer_even.build()):n==HEADER_FOOTER_TYPE.DIFF_FIRST_PAGE?(a.header_first.build(),a.footer_first.build(),a.header.build(),a.footer.build()):n==HEADER_FOOTER_TYPE.DIFF_FIRST_ODD_EVEN_PAGE&&(a.header_odd.build(),a.footer_odd.build(),a.header_even.build(),a.footer_even.build(),a.header_first.build(),a.footer_first.build()):(a.header.build(),a.footer.build());var o=J.Deferred().done(function(){PubSub.publish("applyChanges/complete");for(var t in i)i[t].build();PubSub.publish("meta/complete"),e&&e.resolve(),s="clean"}).fail(function(){e&&e.reject()});a.content.build(o,e,t)},v=function(e,t){if(!r)try{var n=!0;o&&("insert"==o.type&&o.to==e?(o.to=t,n=!1):_()),n&&(o={type:"insert",from:e,to:t})}catch(e){throw Utils.log("Stack "+e.stack),"error in addToDocument"}},S=function(e,t,n){if(!r)try{var i=!0;o&&("delete"==o.type&&o.to==e+(o.to-o.from)?(o.to+=t-e,o.deletedString+=n,i=!1):_()),i&&(o={type:"delete",from:e,to:t,deletedString:n})}catch(e){throw Utils.log("Stack "+e.stack),"error in deleteFromDocument"}},b=function(e,t){var n,i=!1,o=!1,a=!1;if(t&&"listFormat"==t.st){o=!0;for(var s in t)if("st"!=s&&"type"!=s&&editor.doc.getListObj(s)){var l=e.listFormat[s];"number"==typeof format&&(l=LIST_STYLE_OBJECT[format]);var d=List.getChangedListLevel(l,t[s]);(d.length||"object"!=typeof t[s])&&(n=s)}}else if(t.view){var c=e.view;a=!0,"Web View"!=c&&"Web View"!=t.view||(i=!0)}else if(t[ATTR_BODY.DS_BGC]){for(var s in t)if("type"!=s&&s!=ATTR_BODY.DS_BGC){i=!0;break}}else t.hasOwnProperty("endnote")||t.hasOwnProperty("footnote")?(e.hasOwnProperty("endnote")&&t.hasOwnProperty("endnote")||e.hasOwnProperty("footnote")&&t.hasOwnProperty("footnote"))&&(i=!0):t.hasOwnProperty(ATTR_BODY.TC_ISENABLED)||t.hasOwnProperty(ATTR_BODY.TC_ON_BY_COLLAB)||t.hasOwnProperty(ATTR_BODY.TC_OFF_BY_COLLAB)||t.hasOwnProperty(ATTR_BODY.DS_SPLANG)||t.hasOwnProperty("mm_removeBlankLines")||(i=!0);t.hasOwnProperty(ATTR_BODY.TC_ISENABLED)||t.hasOwnProperty(ATTR_BODY.TC_ON_BY_COLLAB)||t.hasOwnProperty(ATTR_BODY.TC_OFF_BY_COLLAB)?(editor.doc.initTrackChangeDetails(),PubSub.publish("Document/TCPropertiesChanged"),editor.doc.snapShotManager.resetSnapShotManager()):(i&&ViewManager.init(),o||(DomUtil.applyDocumentStyle(t),a&&"Fixed View"===t.view&&ViewManager.pages&&ViewManager.pages.last&&ViewManager.pages.last.el&&J(ViewManager.pages.last.el).find("div.zw-contentpane").css({height:ViewManager.pages.last.getContentHeight()})),n&&!i&&DocTreeManager.updateList(parseInt(n))),r=i},R=function(e,t,n,i){if(!r){if(n&&n.type==NODE_TYPE.BODY||i&&i[NODE_TYPE.BODY])return void b(n,i[NODE_TYPE.BODY]);try{var a=!0;o&&("insert"==o.type?o.from<=e&&o.to==t?a=!1:_():"delete"==o.type?_():"update"==o.type&&(o.to==e?(o.to=t,a=!1):o.from==e&&o.to==t?a=!1:_())),a&&(o={type:"update",from:e,to:t})}catch(e){throw"error in updateDocument"}}},O=function(){t=null,this.width=editor.doc.getPaperWidth(),DocTreeManager.doc.sections.splice(0,DocTreeManager.doc.sections.length),TabHandler.updateDefaultListTabWidth(),T(),DocumentMap.clearParas(),p(0,editor.doc.getDocumentLength()),r=!1},D=function(){o&&"delete"==o.type&&_()},y=function(e){var t,i;for(i=n.length-1;i>=0;i--)if(t=n[i],e>t.start)return t;return null},A=function(e,t){var n=y(e),i=y(t);return n.name===i.name},C=function(e){var t,n,i=e.getIndex(),o=[],r=0,a=ViewManager.getLinesInNode(e);for(r=0,t=a.length;r<t;r++)n=a[r],o.push({start:i+n.start,end:i+n.end,height:n.height,outerHeight:n.outerHeight,contentHeight:n.contentHeight,style:n.style,remainingWidth:n.remainingWidth,width:n.width,align:n.align,el:n.el,viewLine:n.viewLine,segments:n.segments,blocks:n.blocks,imagePaddingLeft:n.imagePaddingLeft,renderedSpaceWidths:n.renderedSpaceWidths,parent:n.parent,lastLineInPara:!1,left:n.left,right:n.right,spWords:n.spWords,type:"line"});var s,l=ViewManager.getViews(e)||[];if(!(s=l[0]))return o;var d=(e.getEndIndex(),e.getParaStyles()),c=d&&d[ATTR_PARAGRAPH.PS_DIR]===PARA_DIR.RTL||!1;s.node.paraProperties&&s.node.paraProperties.listData&&s.node.paraProperties.listData.listCharSize&&(o[0].listWidth=s.node.paraProperties.listData.listCharSize.width,o[0].listRight=s.node.paraProperties.listData.listRight,o[0].left=c?o[0].left||0:(o[0].left||0)+o[0].listRight);var u=NoteViewCollection.getNoteViews(s.node.section.sid)[0];return u&&u.isFirstView(s)&&(o[0].left+=u.referenceCharWidth),s.lines.length&&(o[s.lines.length-1].lastLineInPara=!0),o},I=function(e){return C(ee(e))},w=function(e){var t=n[0].itemUnderProgress;t?Utils.log("line index ::: "+e+"  op:"+t.item.op+", node index:"+t.item.node.getIndex()+", nth node: "+t.i+", total nodes: "+t.total+", lastNodeIndex: "+t.lastNodeIndex):Utils.log("No rendering in progress")},P=function(e,t){try{if(!e)return Utils.log("Error at finding lineAtIndex. Passed index has null value."),null;var n,i,o,r=0;i=editor.doc.getCharAt(e),editor.doc.getCharAt(e-1)!==UNICODE.PARA||i!==UNICODE.CELL&&i!==UNICODE.ROW&&i!==UNICODE.TABLEEND&&i!==UNICODE.TABLE&&i!==UNICODE.HR&&i!==UNICODE.TOCSTART&&i!==UNICODE.TOCEND||e--;var n=y(e);if(n&&n.getEndIndex()<e)return null;for(var o=n,a=function(e,t){return t>=e.start&&t<e.end?0:t<e.start?1:-1};o.children&&(o=Utils.binarySearch(o.children,a,e-=o.start),"para"!=o.type););o=Utils.binarySearch(ViewManager.getLinesInNode(o),a,e-=o.start);var s=o;if(s||w(e),"content"!=n.name&&t){for(;s.prev;)r++,s=s.prev;var l=extend({},o);return defineLineProperties(l),l.el=ViewManager.getLine(o.parent,t,r)||o.el,l}return o.isFirstLineOfPara=!o.prev,o}catch(e){return null}},M=function(e,t){var n=t.parent,i=n.getIndex(),o=t.blocks.length,r=n.getParaStyles();if(!o)return i+t.start;var a=r&&r[ATTR_PARAGRAPH.PS_DIR]===PARA_DIR.RTL||!1,s=0;if(a&&e>ViewManager.getColumnWidth(editor.currentColumnIndex))return i+t.start;var l=t.align||0,d=Math.max(t.style.ti||0,0),c=a?0:d,p=Utils.getBorderSize(t.view.getParaStyles());c+=parseInt(p[ATTR_BORDERS.BORDER_LEFT]||0),c+=t.style[ATTR_COMMON.BORDERS]&&t.style[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT]&&parseInt(t.style[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.SPACE])||0,a?2==l?s=0:0==l||3==l?s=t.remainingWidth:1==l&&(s=t.remainingWidth*l/2):(s+=t.width&&t.listRight||0,s+=3===l?0:t.remainingWidth*l/2),c+=s;var h,f,m,g,T,_=0,E=new RegExp("autopcnt|autopno|endnote|footnote"),v=U.clone(t.blocks);for(a?Array.prototype.sort.call(v,function(e,t){return t.visualLeft-e.visualLeft}):Array.prototype.sort.call(v,function(e,t){return e.visualLeft-t.visualLeft});_<o&&(f=v[_++])&&(!a&&c+f.visualLeft+f.width<e||a&&c+f.width<e);)h=i+f.start,a&&(c+=f.width),(m=u(h))&&(c+=m.getBoundingClientRect().width,(g=editor.doc.getRawFormatAt(h))&&E.test(g.cls)&&(T=FontUtils.getCharSize("autopcnt"===g.cls?"##":"#",f.fontStringObj[f.start]),c-=T.width));var S=0,b=0,R=editor.doc.getFormats()[i+f.start];if(R&&R.hasOwnProperty("fieldinfo"))f=t.blocks[_-2];else if(editor.doc.getCharAt(i+f.start)!==UNICODE.IMAGE){var O,D,y,A=editor.doc.getContentIterator(i+f.start,i+f.end),C=0;for(a||(c+=f.visualLeft);(b=A.next())!==-1;){if(O=f.getWordWidthAtIndex(f.start+b),f.isRTL&&(D=c+f.width-O-e),(a&&!f.isRTL||!f.isRTL)&&(D=c+O-e),y=O-C,D>0&&!f.isRTL||f.isRTL&&D<0){y/2>y-D&&(b=S);break}S=b,C=O}}return i+f.start+Math.max(S,b,0)},L=function(e){var t=P(e);if(!t)return 0;var n,i,o,r,a,s,l,d,c=t.parent,p=c.getIndex(),h=(c.getEndIndex(),0),f=t.blocks,m=f.length,g=0,T=0,_=c.paraProperties.listData,E=_&&(_.listType==LIST_TYPE.LOWER_ROMAN||_.listType==LIST_TYPE.UPPER_ROMAN&&!c.paraProperties.isHeadingList),v=new RegExp("autopcnt|autopno|endnote|footnote");for(e-=p;h<m&&(i=f[h++])&&i.end<=e;)n=p+i.start,(r=u(n))&&(g+=r.getBoundingClientRect().width,(a=editor.doc.getRawFormatAt(n))&&v.test(a.cls)&&(s=FontUtils.getCharSize("autopcnt"===a.cls?"##":"#",i.fontStringObj[i.start]),g-=s.width));l=c.getParaStyles(),d=l&&l[ATTR_PARAGRAPH.PS_DIR]===PARA_DIR.RTL||!1;var S=t.style[ATTR_COMMON.BORDERS]&&t.style[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT]&&parseInt(t.style[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.SPACE]);T=d?i?t.width-i.visualLeft:t.width:(i&&i.visualLeft||0)+g+(S||0);var b=t.align||0,R=i&&i.isRTL||!1,o=f[h],O=f[h-2];i&&i.isNeutralChars&&O&&O.isRTL?R=!0:!O&&i&&i.isNeutralChars&&(R=d),t.style.ti>0&&(d||(T+=t.style.ti));var D=0;d?2==b?D=0:0==b||3==b?D=t.remainingWidth:1==b&&(D=t.remainingWidth*b/2):(D+=t.listRight||0,D+=3===b?0:t.remainingWidth*b/2),T+=D,t.remainingWidth&&(d&&0==b||!d&&2==b)&&(E?T-=t.listRight-c.paraProperties.listData.listCharSize.width:0);var y=NoteViewCollection.getNoteViews(c.section.sid)[0];if(t.prev||!y||c.prev||d||(T+=y.referenceCharWidth),!i)return T;if(i.end!==e||R)if(R){var A=i.getFontStringObjAtIndex(e),C=0;A&&(C=FontUtils.getCharSize(editor.doc.getCharAt(p+e),A).width),i.start<=e&&i.end>e&&(T+=i.width-(i.getWordWidthAtIndex(e+1,t)-C))}else T+=i.getWordWidthAtIndex(e,t);else!d&&o&&o.visualLeft!=T+i.width&&o.visualLeft===o.left?(T-=i.visualLeft,T+=o.visualLeft):T+=i.width;return T},N=function(e){for(var t=P(e),n=t&&t.blocks,i=t&&t.parent.getIndex(),o=n&&n.length||0,r=0,a=n&&n[r];r<o&&a.end+i<=e;)a=n[r++];return a},x=function(e,t){for(var n,i,o,r=F(e,t),a=[],s=N(e),l=N(t),d=s&&s.start+P(e).parent.getIndex()||0,c=l&&l.end+P(t).parent.getIndex()||0,u=0;u<r.length;u++){n=r[u],i=n.parent.getIndex(),o=n.blocks;for(var p,h=0,f=o.length;h<f;h++)p=o[h],p.start+i>=d&&p.end+i<=c&&a.push(p)}return a},k=function(e,t,n){var i,o,r,a,s,l,d=[],c=n.getIndex(),u=n.children;for(i=u.length-1;i>=0;i--)if(n=u[i],n.start+c<t){r=i+1;break}for(a=u.length-1,i=0;i<u.length;i++)if(n=u[i],n.start+c>=e){a=i?i-1:i;break}for(i=a;i<r;i++)if(n=u[i],"para"==n.type){s=C(n),o=s.length,o&&e==s[o-1].end&&d.push(s[o-1]);for(var p=0;p<o&&(l=s[p],(l.start<=e&&e<l.end||e<l.start&&l.end<=t||l.start<t&&t<l.end)&&d.push(s[p]),!(s[p].end>t));p++);}else{var h=k(e,t,n);for(p=0;p<h.length;p++)d.push(h[p])}return d},F=function(e,t){var n=y(e),i=k(e,t,n),o=P(e);return 0==i.length?i:(o.lineStart<i[0].start&&i.splice(0,0,o.line),i)},Y=function(e,t,n,i){return e<=n&&n<t||n<e&&t<=i||e<i&&i<t},B=function(e,t,n){var i,o,r,a,s,l,d,c,u,p,h,f,m,g,T=n.getIndex(),_=n.children,E=[];for(f=_.length-1;f>=0;f--)if(n=_[f],n.start+T<t){o=f+1;break}for(i=_.length-1,f=0;f<_.length;f++)if(n=_[f],n.start+T>=e){i=f?f-1:f;break}for(f=i;f<o;f++)if((n=_[f])&&"para"==n.type)for(p=C(n),g=p.length,g&&e==p[g-1].end&&E.push(p[g-1]),m=0;m<g&&(h=p[m],Y(h.start,h.end,e,t)&&E.push(h),!(h.end>t));m++);else if(l=n.parent.getIndex(),r=l+n.start,a=l+n.end,e<r&&a<t)if("table"==n.type)for(m=0;m<n.children.length;m++)d=n.children[m],c=r+d.start,u=r+d.end,Y(c,u,e,t)&&E.push(d);else"row"==n.type?Y(r,a,e,t)&&E.push(n):"cell"==n.type&&Y(r,a,e,t)&&E.push(n.parent);else(e<r||a<t)&&"cell"==n.type?Y(r,a,e,t)&&E.push(n.parent):(s=B(e,t,n),E=E.concat(s));return E},H=function(e,t){var n=y(e),i=y(t);return"endnote"===n.name&&"endnote"===i.name||"footnote"===n.name&&"footnote"===i.name},W=function(e,t){var n,i,o,r=y(e),a=(y(t),[]),s={};A(e,t);a=B(e,t,r);for(var o=a.length-1;o>=0;o--)n=a[o],"row"==n.type&&(i=n.getIndex(),s[i]?a.splice(o,1):s[i]=1);return a},V=function(e,t){var i,o;for(i=n.length-1;i>=0;i-=1)if(o=n[i],o.nodes[e])return o.nodes[e].getFloatImageIndex(t);return-1},G=function(e){var t,i;for(t=n.length-1;t>=0;t-=1)if(i=n[t],i.lists[e]){i.updateList(e);break}},z=function(e){var t,i,o,r=J(e).data("nodeId");for(t=0;t<n.length;t++)if(i=n[t],o=i.nodes[r])return o;return null},Z=function(e){var t=z(e);return"para"==t.type?t.getEndIndex():t.getIndex()},j=function(e){var t=z(e);return"para"==t.type?t.getEndIndex():t.parent.getIndex()+t.end},X=function(e){var t,n,i=J(e).closestParent(".zw-paragraph"),o=(i.data("nodeId"),ViewManager.getView(i)),r=0;return r=i.children(".zw-line-div").index(e),t=o.node,n=o.nodeLines[r]},K=function(e){var t=X(e);if(t&&t.parent){var n=t.parent.getIndex();return n+=t.start}return-1},$=function(e){var t=X(e);if(t&&t.parent){var n=t.parent.getIndex();return n+=t.end}return-1},q=function(e,t){for(var n,i=e.children,o=i.length-1;o>=0;o--){var r=i[o],a=r.getIndex();if(t===a?n=r:t>a&&(n=r.children.length>0&&"para"!==r.type?q(r,t):r),n)break}return n},Q=function(e){var t=y(e);return q(t,e)},ee=function(e){for(var t,n,i,o,r,a=y(e);;){for(t=a.children,o=!1,r=t.length-1;r>=0;r--)if(n=t[r],i=n.getIndex(),childEnd=n.getEndIndex(),e>=i){"para"===n.type&&(o=!0);break}if(a=n,o)break}return a},te=function(e){var t=Q(e);return ne(t)},ne=function(e){return ViewManager.getViews(e)[0].el},ie=function(e){var t=[];do e.type===NODE_TYPE.CELL&&t.push(e);while(e=e.parent);return t},oe=function(e){for(var t,n=[];t=this.getParents(NODE_TYPE.TABLE,t&&t.getIndex()-1||e);)n.push(t);return n},re=function(e){for(var t,n,i,o,r,a,s,l,d,c=e,u={},p=1;"table"!=c.type;)c=c.parent;for(t=c,n=0;n<t.children.length;n++){for(r=t.children[n],d="A",i=0;i<r.children.length;i++)a=r.children[i],l=p+d,o=a.children[0],s=o.formula?o.formula:o.content(),u[d+p]=s,d+=1,d=String.fromCharCode(d.charCodeAt()+1);p+=1}return u},ae=function(e){var t,n,i,o=0,r=0;for(i=e;"cell"!=i.type;)i=i.parent;for(t=i,n=t.parent;t;)o+=1,t=t.prev;for(;n;)r+=1,n=n.prev;return String.fromCharCode("A".charCodeAt()+o-1)+r},se=function(e){var t,n,i;for(i=e;"row"!=i.type;)i=i.parent;return t=i,n=t.parent,{rows:n.children.length,cols:t.children.length}},le=function(e){this.currentDocopBuilder=e},de=function(e){for(var t,n,i,o,r,a,s=Q(e).parent;;){for(t=s.children,r=t.length-1;r>=0&&(n=t[r],i=n.getIndex(),!(e>=i));r--);if(s=n,"para"==s.type){s=s.parent;break}}for(r=0;r<s.children.length;r++)if(n=s.children[r],"para"==n.type)for(a=n.getIndex();a<n.getEndIndex();a++)if(o=l(a),o[ATTR_AUTOFIELD.FORMULA])return{text:o[ATTR_AUTOFIELD.FORMULA],index:a};return{text:"",index:-1}},ce=function(e,t){var n=DocTreeManager.getTreeNodeAtIndex(t),i=n.type;switch(e){case NODE_TYPE.PARAGRAPH:return n;case NODE_TYPE.CELL:case NODE_TYPE.ROW:case NODE_TYPE.TABLE:for(;n&&e!=i;)n=n.parent,i=n?n.type:"";return n;default:return null}},ue=function(e,t,n,i){var o,r,a,s,l,d,c=0,u=[];for(d=[],i=i||y(t),s=i.children,l=s.length,c=0;c<l;c++)if(o=s[c],r=o.getIndex(),a=o.getEndIndex()+1,!(a<=t)){if(r>=n&&r>t)break;o.type==e&&d.push(o),"para"!=o.type&&o.children&&(u=ue(e,t,n,o),d=d.concat(u))}return d},pe=function(e){var t,n,i,o=y(e),r=o.children,a=0;for(i=0;i<r.length&&(t=r[i],n=t.getEndIndex(),n<e);i++)a+=t.height;return a+=t.getTopAtIndex(e)},he=function(e){return i[e]},fe=function(){return t},me=function(e){var t,n,o=[];for(n in i)t=i[n],t.name==e&&o.push(t);return o},ge=function(){return me("endnote")},Te=function(){return me("footnote")},_e=function(){var e,t,n=0;for(t in i)e=i[t],"endnote"==e.name&&n++;return n},Ee=function(){var e,t,n=0;for(t in i)e=i[t],"footnote"==e.name&&n++;return n},ve=function(e,t){var n=[];return"para"===e.type?n:(U.each(e.children,function(e){n=n.concat(ve(e,t)),t&&"*"!==t&&t!==e.type||n.push(e)}),n)},Se=function(){var e=n[0];return e.children};return extend(a,{width:0,addToDocument:v,deleteFromDocument:S,updateDocument:R,refreshTree:O,checkDeleteOp:D,applyChanges:_,buildChanges:E,updateList:G,clearCurrentOp:T,updateDocOpBuilder:le,getLines:I,lineAtIndex:P,getIndexAtLeft:M,getLeftAtIndex:L,linesBetween:F,getNodesToDrawSelection:W,getFloatImageIndex:V,indexOfElement:Z,endIndexOfElement:j,getStartIndex:K,getEndIndex:$,getRawFormatAt:l,getComputedFormatAt:c,getThemeStyleFormatAt:d,getTreeNodeAtIndex:Q,getNodeAtIndex:te,getNodesBetweenIndex:ue,getDOMnodeFromDTnode:ne,getNode:z,getParents:ce,getAllChildren:ve,getParentCells:ie,getParentTables:oe,getTableValues:re,getCurrentCell:ae,getTableSize:se,getFormulaAtIndex:de,getSection:y,getBlocksBetween:x,blockAtIndex:N,isEndNoteOrFootNoteSection:H,getMetaSection:he,getLastNonMetaSection:fe,getTopAtIndex:pe,getAllContentNodes:Se,getEndNoteCount:_e,getFootNoteCount:Ee,getAllEndNotes:ge,getAllFootNotes:Te,sections:n,metaSections:i}),a};!function(){"use strict";function e(e,t,n){DTNode.call(this,e,t,n),this.format=editor.doc.getRawFormatAt(this.getIndex()),this.type=NODE_TYPE.TOC;var i,o,r,a,s,l=this.start,d=this.end,c=this.parent.getIndex(),u=c+this.start;for(l+=c,d+=c,i=l+1;i<d-1;)s=editor.doc.getCharAt(i),DTNode.types[s]?s==UNICODE.PARA?(r=getStart(UNICODE.PARA,i)-u,a=getEnd(UNICODE.PARA,i)-u,o=new DTNode.types[UNICODE.PARA](r,a,this),this.addChild(o),this.section.nodesToUpdate.push(o.id,makeOp(o,"create")),i=u+o.end):s!==UNICODE.TABLE&&s!==UNICODE.HR||(r=i-u,a=getEnd(s,i)-u,o=new DTNode.types[s](r,a,this),this.addChild(o),this.section.nodesToUpdate.push(o.id,makeOp(o,"create")),i=u+o.end):i+=1}e.prototype=Object.create(DTNode.prototype),e.prototype.constructor=e,extend(e.prototype,{addToToc:function(e,t){var n,i,o,r,a,s,l,d=this.children,c=this.getIndex();for(this.end+=t-e,a=d.length-1;a>=0&&(n=d[a],r=a,!(e>=n.start+c));a-=1)n.updateIndex(t-e);if(n&&"table"===n.type)return void n.addToTable(e,t);for(e=n.start+c,"para"==n.type&&(n.start=getStart(UNICODE.PARA,t)-c,n.end=getEnd(UNICODE.PARA,t)-c,l=makeOp(n,"modify")),a=e;a<t;)s=editor.doc.getCharAt(a),DTNode.types[s]?(s==UNICODE.PARA?(i=getStart(UNICODE.PARA,a)-c,o=getEnd(UNICODE.PARA,a)-c):s!=UNICODE.TABLE&&s!=UNICODE.HR||(i=a-c,o=getEnd(s,a)-c),n=new DTNode.types[s](i,o,this),this.section.nodesToUpdate.push(n.id,makeOp(n,"create")),this.addChildAt(n,r),r++,a=c+n.end):a+=1;this.section.nodesToUpdate.push(l.node.id,l)},deleteFromToc:function(e,t,n){var i,o,r,a=this.children,s=this.getIndex();for(this.end-=t-e,r=0;r<a.length;r++){if(i=a[r],o=r,i.start+s>e){i=i.prev||i,o=r-1;break}if("para"!=i.type&&i.start+s==e)break}if("table"==i.type)i.deleteFromTable(e,t,n);else{for(;i&&i.end+s<=t;)this.section.nodesToUpdate.push(i.id,makeOp(i,"remove")),this.deleteChildAt(o),i=i.next;i&&("para"==i.type?(i.end=getEnd(UNICODE.PARA,e)-s,i.start=getStart(UNICODE.PARA,e)-s,this.section.nodesToUpdate.push(i.id,makeOp(i,"modify"))):this.section.nodesToUpdate.push(i.id,makeOp(i,"update")))}for(r=a.length-1;r>=0&&(i=a[r],!(e>=i.start+s));r-=1)i.updateIndex(e-t)},updateNode:function(e,t){var n,i,o,r,a=this.children,s=this.getIndex();if(s!=e||t-e!=1){for(o=a.length-1;o>=0&&(n=a[o],i=o,!(e>=n.start+s));o-=1);if(t<s+n.end)return void n.updateNode(e,t);for("para"!=n.type&&n.updateNode(e,n.end+s),this.section.nodesToUpdate.push(n.id,makeOp(n,"update")),o=n.end+s;o<t-1;)r=editor.doc.getCharAt(o),DTNode.types[r]?r!=UNICODE.PARA&&r!=UNICODE.TABLE&&r!=UNICODE.HR||(n=n.next,"para"!=n.type&&n.updateNode(n.start,Math.min(n.end+s,t)),this.section.nodesToUpdate.push(n.id,makeOp(n,"update")),o=n.end+s):(n=n.next,this.section.nodesToUpdate.push(n.id,makeOp(n,"update")),o=getEnd(UNICODE.PARA,n.start+s)+s)}else for(o=0;o<a.length;o++)this.section.nodesToUpdate.push(a[o].id,makeOp(a[o],"update"))},updateProperties:function(){this.width=this.parent.width-2,this.format=editor.doc.getRawFormatAt(this.getIndex())},create:function(){this.updateProperties()},update:function(){this.updateProperties()}}),DTNode.types[UNICODE.TOCSTART]=e}();var DocTreeManager=function(){var e;return{init:function(){var t={showBookMark:!0},n=editor.doc.getRole();n==USER_ROLE.PUBLIC&&(t.showBookMark=!1),ViewManager.init(),e=new DTDocument(t),this.doc=e},addToTree:function(t,n){e.addToDocument(t,n)},deleteFromTree:function(t,n,i){e.deleteFromDocument(t,n,i)},updateTree:function(t,n,i,o){e.updateDocument(t,n,i,o)},refreshTree:function(){e.refreshTree()},checkDeleteOp:function(){e.checkDeleteOp()},applyChanges:function(){e.applyChanges()},buildChanges:function(t){e.buildChanges(t)},updateDocOpBuilder:function(t){e.updateDocOpBuilder(t)},getLines:function(t){return e.getLines(t)},lineAtIndex:function(t,n){return e.lineAtIndex(t,n)},getIndexAtLeft:function(t,n){return e.getIndexAtLeft(t,n)},getLeftAtIndex:function(t){return e.getLeftAtIndex(t)},linesBetween:function(t,n){return e.linesBetween(t,n)},blockAtIndex:function(t){return e.blockAtIndex(t)},getBlocksBetween:function(t,n){return e.getBlocksBetween(t,n)},getNodesBetweenIndex:function(t,n,i){return e.getNodesBetweenIndex(t,n,i)},getNodesToDrawSelection:function(t,n){return e.getNodesToDrawSelection(t,n)},isEndNoteOrFootNoteSection:function(t,n){return e.isEndNoteOrFootNoteSection(t,n)},topAtIndex:function(t){return e.getLines(t)},getFloatImageIndex:function(t,n){return e.getFloatImageIndex(t,n)},updateList:function(t){return e.updateList(t)},isSectionBuildInProcess:function(t){for(var n=e.sections,i=n.length,o=t?t:"content",r=0;r<i;r++){var a=n[r].name;if(a.indexOf(o)!=-1)return n[r].nodesToUpdate.length>0}},indexOfElement:function(t){return e.indexOfElement(t)},endIndexOfElement:function(t){return e.endIndexOfElement(t)},getStartIndex:function(t){return e.getStartIndex(t)},getEndIndex:function(t){return e.getEndIndex(t)},getTreeNodeAtIndex:function(t){return e.getTreeNodeAtIndex(t)},getNodeAtIndex:function(t){return e.getNodeAtIndex(t)},getDOMnodeFromDTnode:function(t){return e.getDOMnodeFromDTnode(t)},getNode:function(t){return e.getNode(t)},getParents:function(t,n){return e.getParents(t,n)},getParentCells:function(t){return e.getParentCells(t)},getParentTables:function(t){return e.getParentTables(t)},getMetaSections:function(){return this.doc.metaSections},getMetaSection:function(e){return this.doc.getMetaSection(e)},getLastNonMetaSection:function(){return this.doc.getLastNonMetaSection()},getAllEndNotes:function(){return this.doc.getAllEndNotes()},getAllFootNotes:function(){return this.doc.getAllFootNotes()},getEndNoteCount:function(){return this.doc.getEndNoteCount()},getFootNoteCount:function(){return this.doc.getFootNoteCount()},getTableValues:function(e){return this.doc.getTableValues(e)},getCurrentCell:function(e){return this.doc.getCurrentCell(e)},getTableSize:function(e){return this.doc.getTableSize(e)},getFormulaAtIndex:function(e){return this.doc.getFormulaAtIndex(e)},getTopAtIndex:function(e){return this.doc.getTopAtIndex(e)},getFirstPara:function(){return this.doc.getFirstPara()},getAllContentNodes:function(){return this.doc.getAllContentNodes()},doc:e}}();PubSub.subscribe("Document/StyleChanged",DocTreeManager.updateTree),PubSub.subscribe("Document/ContentAdded",DocTreeManager.addToTree),PubSub.subscribe("Document/ContentDeleted",DocTreeManager.deleteFromTree),PubSub.subscribe("Document/BeforeModelUpdation",DocTreeManager.updateDocOpBuilder),PubSub.subscribe("Document/ContentMasked",DocTreeManager.updateTree),PubSub.subscribe("Document/ContentUnMasked",DocTreeManager.updateTree),extend(HeaderView.prototype,{create:function(){var e;if(PubSub.subscribe("header/changed",this.update,{context:this}),PubSub.subscribe("header/updateAutoFields",this.updateAutoFields,{context:this}),e=this.getHeader()){this.container=J(e.container).clone(!0).show()[0],this.el=J(this.container).find("div.header_content")[0],this.content=this.el.parentNode,editor.prepareDraggables(this.content),e.page=this.page,this.page.el.appendChild(this.container),this.height=e.height,this.paddingTop=e.paddingTop,this.pageNumberFields=J(this.el).find("span.autopno"),this.pageCountFields=J(this.el).find("span.autopcnt"),this.updateHeader();var t=editor.clientActiveSection?editor.clientActiveSection.className.toLowerCase():"";t&&t.indexOf("zw-contentpane")==-1&&t.indexOf("zw-footnotepane")==-1&&t.indexOf("zw-endnotepane")==-1?J(this.container).addClass("selectableSection ui-hf-border-blue").find("#header_flag").css("display","block"):J(this.container).addClass("unselectableSection")}0===this.height&&J(this.container).hide()},remove:function(){PubSub.unsubscribe("header/changed",this.update,{context:this}),PubSub.unsubscribe("header/updateAutoFields",this.updateAutoFields,{context:this}),J(this.container).remove()},getHeader:function(){var e,t;return e=editor.doc.getHeaderType(),e&&e!=HEADER_FOOTER_TYPE.PRIMARY?e==HEADER_FOOTER_TYPE.DIFF_ODD_EVEN_PAGE?t=this.page.pageNumber%2==0?ViewManager.getEvenPageHeader():ViewManager.getOddPageHeader():e==HEADER_FOOTER_TYPE.DIFF_FIRST_PAGE?t=1==this.page.pageNumber?ViewManager.getFirstPageHeader():ViewManager.getPrimaryHeader():e==HEADER_FOOTER_TYPE.DIFF_FIRST_ODD_EVEN_PAGE&&(t=1==this.page.pageNumber?ViewManager.getFirstPageHeader():this.page.pageNumber%2==0?ViewManager.getEvenPageHeader():ViewManager.getOddPageHeader()):t=ViewManager.getPrimaryHeader(),t},updateHeader:function(){var e=ViewManager.getColCount()||1,t=J(this.container).find("span.zw-portion"),n=0==t.length&&0==this.height;n||0!=this.height||(this.height=J(this.container).height()),this.page.prev?!n&&(editor.doc.getRole()===USER_ROLE.PUBLIC&&e>1||EditorView.isPageView()||"undefined"!=typeof PrintPreview&&PrintPreview.isPrintPreview())?this.container.style.display="block":this.container.style.display="none":n||(this.container.style.display="block")},update:function(){var e=this.getHeader();this.height=e.height;var t=J(e.content).clone(!0)[0];editor.prepareDraggables(t),this.container.appendChild(t),J(this.content).remove(),this.content=t,this.el=t.firstChild,this.pageNumberFields=J(this.el).find("span.autopno"),this.pageCountFields=J(this.el).find("span.autopcnt"),this.updateHeader(),this.updateAutoFields()},updateAutoFields:function(){var e=editor.doc.getBodyFormat(),t=e[ATTR_BODY.DS_PAGENUMBER],n=this.page.pageNumber;t&&("undefined"!=typeof t[ATTR_BODY.DS_PAGENUMBER_STARTS_AT]&&(n+=t[ATTR_BODY.DS_PAGENUMBER_STARTS_AT],n-=1),"undefined"!=typeof t[ATTR_BODY.DS_PAGENUMBER_FORMAT]&&(n=List.getListNumber(t[ATTR_BODY.DS_PAGENUMBER_FORMAT],n,null,!0))),this.pageNumberFields.find("div."+CONST.FIELD_TEXT_NODE).text(n),this.pageCountFields.find("div."+CONST.FIELD_TEXT_NODE).text(ViewManager.getPageCount())},appendView:function(e){this.el.appendChild(e.el)},getHeight:function(){var e,t=0;for(e=this.views.first;e;)t+=e.getHeight(),e=e.next;return t+this.padding.top.pixels+this.padding.bottom.pixels}}),extend(HeaderView_Primary.prototype,{create:function(){this.container=J("div.header_primary")[0];var e={position:"relative"},t="header_primary ui-hf-container",n=J("<div>").attr({class:"ui-hdr-ftr-exit",onclick:"PanelUtil.closeHeaderFooter(this, event)"}).html(J.i18n("writer.common.EXIT")),i=J("<div>").attr({class:"ui-hf-options"}).append(J("<span>").attr({id:"headeredit",class:"ui-hdr-ftr-opt",onclick:"PanelUtil.toggleHeaderFooter();"}).html(J.i18n("writer.common.HEADER_OPTIONS"))).append(J("<span>").attr({class:"ui-header-seprate"})).append(n),o=J("<div>").attr("class","ui-hf-dbl-clk");o.text(J.i18n("writer.common.DOUBLE_CLICK_TO_EDIT_HEADER")),J(this.container).attr({class:t}).css(e).append(i,o),this.createContentDiv()},addView:function(e){var t,n,i,o,r=e.node,a=r.prev,s=r.parent,l=this;if(e.section=this,e.page=this.page||ViewManager.pages.first,a){a=r.prev;do t=ViewManager.getViews(a),a=a.prev;while(a&&!t);t.length?(n=t[0],o=this.viewMap[n.id],o.insertAfter(e,n)):(o=this.views,o.insertAsFirst(e))}else"section"===r.parent.type?o=this.views:(i=ViewManager.getViews(s),l=i[0],o=l.views),o.insertAsFirst(e);return this.viewMap[e.id]=o,l},removeView:function(e){var t=this.viewMap[e.id];if(e.views)for(;e.views.last;)this.removeView(e.views.last);t.remove(e),delete this.viewMap[e.id],ViewManager.removeViewDetails(e),e.remove()},createContentDiv:function(){var e=document.createElement("div");this.content=document.createElement("div"),J(this.content).append(e).attr("class","header_content_wrapper"),this.el=e,J(e).attr({class:"header_content"}),J(this.container).append(this.content)},remove:function(){PubSub.unsubscribe("header/changed",this.update,{context:this}),PubSub.unsubscribe("header/updateAutoFields",this.updateAutoFields,{context:this}),J(this.container).remove()},setStyle:function(){var e=editor.doc.getBodyFormat(),t=(e[ATTR_BODY.DS_ML]||"0in").convertor().pixels,n=(e[ATTR_BODY.DS_MT]||"0in").convertor().pixels,i=(e[ATTR_BODY.DS_MR]||"0in").convertor().pixels,o=(e[ATTR_BODY.DS_HT]||"0in").convertor().pixels,r=(ViewManager.getPageWidth()-t-i,!1),a={},s=0;n<o&&(o=0),this.paddingTop=o;for(var l=this.views.first;l;)s+=l.getHeight(),l=l.next;s+=o,s=Math.max(s,n),0==n?(extend(a,{"min-height":"0px",border:"",padding:"0px "+i+"px 0px "+t+"px"}),r=!0):extend(a,{height:s,padding:"0px "+i+"px 0px "+t+"px"}),a["max-height"]=.4*ViewManager.getPageHeight(),J(this.content).css(a),J(".header_content").css("padding-top",o),J(this.container).show(),r?this.height=0:this.height=J(this.content).height(),J(this.container).hide()},update:function(){var e=J(this.page.prev.header.content).clone(!0)[0];EditorView.isPageView()||"undefined"!=typeof PrintPreview&&PrintPreview.isPrintPreview()?0!==this.header.height&&(this.container.style.display="block"):this.container.style.display="none",this.container.appendChild(e),J(this.content).remove(),this.content=e,this.el=e.firstChild,this.pageNumberFields=J(this.el).find("span.autopno"),this.pageCountFields=J(this.el).find("span.autopcnt")},updateAutoFields:function(){this.pageNumberFields.find("div."+CONST.FIELD_TEXT_NODE).text(this.page.pageNumber),this.pageCountFields.find("div."+CONST.FIELD_TEXT_NODE).text(ViewManager.getPageCount())},addDOMView:function(e,t){this.isPageRendered=!0,e.createView(),e.prev?J(e.el).insertAfter(e.prev.el):e.next?J(e.el).insertBefore(e.next.el):t.appendView(e)},appendView:function(e){this.el.appendChild(e.el)}}),extend(HeaderView_Odd.prototype,{create:function(){this.container=J("div.odd_header_primary")[0];var e={position:"relative"},t="header_primary ui-hf-container odd_header_primary",n=J("<div>").attr({class:"ui-hdr-ftr-exit",onclick:"PanelUtil.closeHeaderFooter(true,event)"}).html(J.i18n("writer.common.EXIT")),i=J("<div>").attr({class:"ui-hf-options"}).append(J("<span>").attr({id:"headeredit",class:"ui-hdr-ftr-opt",onclick:"PanelUtil.toggleHeaderFooter();"}).html(J.i18n("writer.common.HEADER_ODD"))).append(J("<span>").attr({class:"ui-header-seprate"})).append(n),o=J("<div>").attr("class","ui-hf-dbl-clk");o.text(J.i18n("writer.common.DOUBLE_CLICK_TO_EDIT_HEADER")),J(this.container).attr({class:t}).css(e).append(i,o),this.createContentDiv()},addView:function(e){var t,n,i,o,r=e.node,a=r.prev,s=r.parent,l=this;if(e.section=this,e.page=this.page||ViewManager.pages.first,a){a=r.prev;do t=ViewManager.getViews(a),a=a.prev;while(a&&!t);t.length?(n=t[0],o=this.viewMap[n.id],o.insertAfter(e,n)):(o=this.views,o.insertAsFirst(e))}else"section"===r.parent.type?o=this.views:(i=ViewManager.getViews(s),l=i[0],o=l.views),o.insertAsFirst(e);return this.viewMap[e.id]=o,l},removeView:function(e){var t=this.viewMap[e.id];if(e.views)for(;e.views.last;)this.removeView(e.views.last);t.remove(e),delete this.viewMap[e.id],ViewManager.removeViewDetails(e),e.remove()},createContentDiv:function(){var e=document.createElement("div");this.content=document.createElement("div"),J(this.content).append(e).attr("class","header_content_wrapper"),this.el=e,J(e).attr({class:"header_content"}),J(this.container).append(this.content)},remove:function(){PubSub.unsubscribe("header/changed",this.update,{context:this}),PubSub.unsubscribe("header/updateAutoFields",this.updateAutoFields,{context:this}),J(this.container).remove()},setStyle:function(){var e=editor.doc.getBodyFormat(),t=(e[ATTR_BODY.DS_ML]||"0in").convertor().pixels,n=(e[ATTR_BODY.DS_MT]||"0in").convertor().pixels,i=(e[ATTR_BODY.DS_MR]||"0in").convertor().pixels,o=(e[ATTR_BODY.DS_HT]||"0in").convertor().pixels,r=(ViewManager.getPageWidth()-t-i,!1),a={},s=0;n<o&&(o=0),this.paddingTop=o;for(var l=this.views.first;l;)s+=l.getHeight(),l=l.next;s+=o,s=Math.max(s,n),0==n?(extend(a,{"min-height":"0px",border:"",padding:"0px "+i+"px 0px "+t+"px"}),r=!0):extend(a,{height:s,padding:"0px "+i+"px 0px "+t+"px"}),a["max-height"]=.4*ViewManager.getPageHeight(),J(this.content).css(a),J(".header_content").css("padding-top",o),J(this.container).show(),r?this.height=0:this.height=J(this.content).height(),J(this.container).hide()},update:function(){var e=J(this.page.prev.header.content).clone(!0)[0];EditorView.isPageView()||"undefined"!=typeof PrintPreview&&PrintPreview.isPrintPreview()?0!==this.header.height&&(this.container.style.display="block"):this.container.style.display="none",this.container.appendChild(e),J(this.content).remove(),this.content=e,this.el=e.firstChild,this.pageNumberFields=J(this.el).find("span.autopno"),this.pageCountFields=J(this.el).find("span.autopcnt")},addDOMView:function(e,t){this.isPageRendered=!0,e.createView(),e.prev?J(e.el).insertAfter(e.prev.el):e.next?J(e.el).insertBefore(e.next.el):t.appendView(e)},appendView:function(e){this.el.appendChild(e.el)}}),extend(HeaderView_Even.prototype,{create:function(){this.container=J("div.even_header_primary")[0];var e={position:"relative"},t="header_primary ui-hf-container even_header_primary",n=J("<div>").attr({class:"ui-hdr-ftr-exit",onclick:"PanelUtil.closeHeaderFooter(true,event)"}).html(J.i18n("writer.common.EXIT")),i=J("<div>").attr({class:"ui-hf-options"}).append(J("<span>").attr({id:"headeredit",class:"ui-hdr-ftr-opt",onclick:"PanelUtil.toggleHeaderFooter();"}).html(J.i18n("writer.common.HEADER_EVEN"))).append(J("<span>").attr({class:"ui-header-seprate"})).append(n),o=J("<div>").attr("class","ui-hf-dbl-clk");o.text(J.i18n("writer.common.DOUBLE_CLICK_TO_EDIT_HEADER")),J(this.container).attr({class:t}).css(e).append(i,o),this.createContentDiv()},addView:function(e){var t,n,i,o,r=e.node,a=r.prev,s=r.parent,l=this;if(e.section=this,e.page=this.page||ViewManager.pages.first,a){a=r.prev;do t=ViewManager.getViews(a),a=a.prev;while(a&&!t);t.length?(n=t[0],o=this.viewMap[n.id],o.insertAfter(e,n)):(o=this.views,o.insertAsFirst(e))}else"section"===r.parent.type?o=this.views:(i=ViewManager.getViews(s),l=i[0],o=l.views),o.insertAsFirst(e);return this.viewMap[e.id]=o,l},removeView:function(e){var t=this.viewMap[e.id];if(e.views)for(;e.views.last;)this.removeView(e.views.last);t.remove(e),delete this.viewMap[e.id],ViewManager.removeViewDetails(e),e.remove()},createContentDiv:function(){var e=document.createElement("div");this.content=document.createElement("div"),J(this.content).append(e).attr("class","header_content_wrapper"),this.el=e,J(e).attr({class:"header_content"}),J(this.container).append(this.content)},remove:function(){PubSub.unsubscribe("header/changed",this.update,{context:this}),PubSub.unsubscribe("header/updateAutoFields",this.updateAutoFields,{context:this}),J(this.container).remove()},setStyle:function(){var e=editor.doc.getBodyFormat(),t=(e[ATTR_BODY.DS_ML]||"0in").convertor().pixels,n=(e[ATTR_BODY.DS_MT]||"0in").convertor().pixels,i=(e[ATTR_BODY.DS_MR]||"0in").convertor().pixels,o=(e[ATTR_BODY.DS_HT]||"0in").convertor().pixels,r=(ViewManager.getPageWidth()-t-i,!1),a={},s=0;n<o&&(o=0),this.paddingTop=o;for(var l=this.views.first;l;)s+=l.getHeight(),l=l.next;s+=o,s=Math.max(s,n),0==n?(extend(a,{"min-height":"0px",border:"",padding:"0px "+i+"px 0px "+t+"px"}),r=!0):extend(a,{height:s,padding:"0px "+i+"px 0px "+t+"px"}),a["max-height"]=.4*ViewManager.getPageHeight(),J(this.content).css(a),J(".header_content").css("padding-top",o),J(this.container).show(),r?this.height=0:this.height=J(this.content).height(),J(this.container).hide()},update:function(){var e=J(this.page.prev.header.content).clone(!0)[0];EditorView.isPageView()||"undefined"!=typeof PrintPreview&&PrintPreview.isPrintPreview()?0!==this.header.height&&(this.container.style.display="block"):this.container.style.display="none",this.container.appendChild(e),J(this.content).remove(),this.content=e,this.el=e.firstChild,this.pageNumberFields=J(this.el).find("span.autopno"),this.pageCountFields=J(this.el).find("span.autopcnt")},addDOMView:function(e,t){this.isPageRendered=!0,e.createView(),e.prev?J(e.el).insertAfter(e.prev.el):e.next?J(e.el).insertBefore(e.next.el):t.appendView(e)},appendView:function(e){this.el.appendChild(e.el)}}),extend(HeaderView_First.prototype,{create:function(){this.container=J("div.fst_header_primary")[0];var e={position:"relative"},t="header_primary ui-hf-container fst_header_primary",n=J("<div>").attr({class:"ui-hdr-ftr-exit",onclick:"PanelUtil.closeHeaderFooter(true,event)"}).html(J.i18n("writer.common.EXIT")),i=J("<div>").attr({class:"ui-hf-options"}).append(J("<span>").attr({id:"headeredit",class:"ui-hdr-ftr-opt",onclick:"PanelUtil.toggleHeaderFooter();"}).html(J.i18n("writer.common.HEADER_FIRST_PAGE"))).append(J("<span>").attr({class:"ui-header-seprate"})).append(n),o=J("<div>").attr("class","ui-hf-dbl-clk");o.text(J.i18n("writer.common.DOUBLE_CLICK_TO_EDIT_HEADER")),J(this.container).attr({class:t}).css(e).append(i,o),this.createContentDiv()},addView:function(e){var t,n,i,o,r=e.node,a=r.prev,s=r.parent,l=this;if(e.section=this,e.page=this.page||ViewManager.pages.first,a){a=r.prev;do t=ViewManager.getViews(a),a=a.prev;while(a&&!t);t.length?(n=t[0],o=this.viewMap[n.id],o.insertAfter(e,n)):(o=this.views,o.insertAsFirst(e))}else"section"===r.parent.type?o=this.views:(i=ViewManager.getViews(s),l=i[0],o=l.views),o.insertAsFirst(e);return this.viewMap[e.id]=o,l},removeView:function(e){var t=this.viewMap[e.id];if(e.views)for(;e.views.last;)this.removeView(e.views.last);t.remove(e),delete this.viewMap[e.id],ViewManager.removeViewDetails(e),e.remove()},createContentDiv:function(){var e=document.createElement("div");this.content=document.createElement("div"),J(this.content).append(e).attr("class","header_content_wrapper"),this.el=e,J(e).attr({class:"header_content"}),J(this.container).append(this.content)},remove:function(){PubSub.unsubscribe("header/changed",this.update,{context:this}),PubSub.unsubscribe("header/updateAutoFields",this.updateAutoFields,{context:this}),J(this.container).remove()},setStyle:function(){var e=editor.doc.getBodyFormat(),t=(e[ATTR_BODY.DS_ML]||"0in").convertor().pixels,n=(e[ATTR_BODY.DS_MT]||"0in").convertor().pixels,i=(e[ATTR_BODY.DS_MR]||"0in").convertor().pixels,o=(e[ATTR_BODY.DS_HT]||"0in").convertor().pixels,r=(ViewManager.getPageWidth()-t-i,!1),a={},s=0;n<o&&(o=0),this.paddingTop=o;for(var l=this.views.first;l;)s+=l.getHeight(),l=l.next;s+=o,s=Math.max(s,n),0==n?(extend(a,{"min-height":"0px",border:"",padding:"0px "+i+"px 0px "+t+"px"}),r=!0):extend(a,{height:s,padding:"0px "+i+"px 0px "+t+"px"}),a["max-height"]=.4*ViewManager.getPageHeight(),J(this.content).css(a),J(".header_content").css("padding-top",o),J(this.container).show(),r?this.height=0:this.height=J(this.content).height(),J(this.container).hide()},update:function(){var e=J(this.page.prev.header.content).clone(!0)[0];EditorView.isPageView()||"undefined"!=typeof PrintPreview&&PrintPreview.isPrintPreview()?this.container.style.display="block":this.container.style.display="none",this.container.appendChild(e),J(this.content).remove(),this.content=e,this.el=e.firstChild,this.pageNumberFields=J(this.el).find("span.autopno"),this.pageCountFields=J(this.el).find("span.autopcnt")},addDOMView:function(e,t){this.isPageRendered=!0,e.createView(),e.prev?J(e.el).insertAfter(e.prev.el):e.next?J(e.el).insertBefore(e.next.el):t.appendView(e)},appendView:function(e){this.el.appendChild(e.el)}}),extend(FooterView.prototype,{create:function(){var e,t;PubSub.subscribe("footer/changed",this.update,{context:this}),PubSub.subscribe("footer/updateAutoFields",this.updateAutoFields,{context:this}),e=this.getFooter(),this.container=J(e.container).clone(!0).show()[0],t=J(this.container),this.el=t.find("div.footer_content")[0],e.page=this.page,this.content=this.el.parentNode,editor.prepareDraggables(this.content),this.page.el.appendChild(this.container),this.height=e.height,this.paddingBottom=e.paddingBottom,this.pageNumberFields=J(this.el).find("span.autopno"),this.pageCountFields=J(this.el).find("span.autopcnt");var n=editor.clientActiveSection?editor.clientActiveSection.className.toLowerCase():"";n&&n.indexOf("zw-contentpane")==-1&&n.indexOf("zw-footnotepane")==-1&&n.indexOf("zw-endnotepane")==-1?J(this.container).addClass("selectableSection ui-hf-border-blue").find("#footer_flag").css("display","block"):J(this.container).addClass("unselectableSection"),0===this.height&&J(this.container).hide(),this.updateFooter()},remove:function(){PubSub.unsubscribe("footer/changed",this.update,{context:this}),PubSub.unsubscribe("footer/updateAutoFields",this.updateAutoFields,{context:this}),J(this.container).remove()},getFooter:function(){var e,t;return e=editor.doc.getHeaderType(),e&&e!=HEADER_FOOTER_TYPE.PRIMARY?e==HEADER_FOOTER_TYPE.DIFF_ODD_EVEN_PAGE?t=this.page.pageNumber%2==0?ViewManager.getEvenPageFooter():ViewManager.getOddPageFooter():e==HEADER_FOOTER_TYPE.DIFF_FIRST_PAGE?t=1==this.page.pageNumber?ViewManager.getFirstPageFooter():ViewManager.getPrimaryFooter():e==HEADER_FOOTER_TYPE.DIFF_FIRST_ODD_EVEN_PAGE&&(t=1==this.page.pageNumber?ViewManager.getFirstPageFooter():this.page.pageNumber%2==0?ViewManager.getEvenPageFooter():ViewManager.getOddPageFooter()):t=ViewManager.getPrimaryFooter(),t},updateFooter:function(){var e=J(this.container).find("span.zw-portion"),t=ViewManager.getColCount()||1,n=0==e.length&&0==this.height;n||0!=this.height||(this.height=J(this.container).height()),this.page.prev&&(!n&&(editor.doc.getRole()===USER_ROLE.PUBLIC&&t>1||EditorView.isPageView()||"undefined"!=typeof PrintPreview&&PrintPreview.isPrintPreview())?this.page.prev.footer.showFooter():this.page.prev.footer.hideFooter())},update:function(){var e,t;e=this.getFooter();var n=J(e.content).clone(!0)[0];this.container.appendChild(n),J(this.content).remove(),editor.prepareDraggables(n),this.content=n,this.el=n.firstChild,this.pageNumberFields=J(this.el).find("span.autopno"),this.pageCountFields=J(this.el).find("span.autopcnt"),t=J(this.container),this.height=e.height,this.updateFooter(),this.updateAutoFields()},updateAutoFields:function(){var e=editor.doc.getBodyFormat(),t=e[ATTR_BODY.DS_PAGENUMBER],n=this.page.pageNumber;t&&("undefined"!=typeof t[ATTR_BODY.DS_PAGENUMBER_STARTS_AT]&&(n+=t[ATTR_BODY.DS_PAGENUMBER_STARTS_AT],n-=1),"undefined"!=typeof t[ATTR_BODY.DS_PAGENUMBER_FORMAT]&&(n=List.getListNumber(t[ATTR_BODY.DS_PAGENUMBER_FORMAT],n,null,!0))),this.pageNumberFields.find("div."+CONST.FIELD_TEXT_NODE).text(n),this.pageCountFields.find("div."+CONST.FIELD_TEXT_NODE).text(ViewManager.getPageCount())},hideFooter:function(){J(this.container).hide()},showFooter:function(){J(this.container).show()},appendView:function(e){this.el.appendChild(e.el)},getHeight:function(){var e,t=0;for(e=this.views.first;e;)t+=e.getHeight(),e=e.next;return t+this.padding.top.pixels+this.padding.bottom.pixels}}),extend(FooterView_Primary.prototype,{create:function(){this.container=J("div.footer_primary")[0];var e={position:"relative"},t="footer_primary ui-hf-container",n=J("<div>").attr({class:"ui-hdr-ftr-exit",onclick:"PanelUtil.closeHeaderFooter(true,event)"}).html(J.i18n("writer.common.EXIT")),i=J("<div>").attr({class:"ui-hf-options"}).append(J("<span>").attr({id:"footeredit",class:"ui-hdr-ftr-opt",onclick:"PanelUtil.toggleHeaderFooter();"}).html(J.i18n("writer.common.FOOTER_OPTIONS"))).append(J("<span>").attr({class:"ui-header-seprate"})).append(n),o=J("<div>").attr("class","ui-hf-dbl-clk");o.text(J.i18n("writer.common.DOUBLE_CLICK_TO_EDIT_FOOTER")),J(this.container).attr({class:t}).css(e).append(i,o),this.createContentDiv()},addView:function(e){var t,n,i,o,r=e.node,a=r.prev,s=r.parent,l=this;if(e.section=this,e.page=this.page||ViewManager.pages.first,a){a=r.prev;do t=ViewManager.getViews(a),a=a.prev;while(a&&!t);t.length?(n=t[0],o=this.viewMap[n.id],o.insertAfter(e,n)):(o=this.views,o.insertAsFirst(e))}else"section"===r.parent.type?o=this.views:(i=ViewManager.getViews(s),l=i[0],o=l.views),o.insertAsFirst(e);return this.viewMap[e.id]=o,l},removeView:function(e){var t=this.viewMap[e.id];if(e.views)for(;e.views.last;)this.removeView(e.views.last);t.remove(e),delete this.viewMap[e.id],ViewManager.removeViewDetails(e),e.remove()},createContentDiv:function(){var e=document.createElement("div");this.content=document.createElement("div"),J(this.content).append(e).attr("class","footer_content_wrapper"),this.el=e,J(e).attr({class:"footer_content"}),J(this.container).append(this.content)},remove:function(){PubSub.unsubscribe("footer/changed",this.update,{context:this}),PubSub.unsubscribe("footer/updateAutoFields",this.updateAutoFields,{context:this}),J(this.container).remove()},setStyle:function(){var e=editor.doc.getBodyFormat(),t=(e[ATTR_BODY.DS_ML]||"0in").convertor().pixels,n=(e[ATTR_BODY.DS_MR]||"0in").convertor().pixels,i=(e[ATTR_BODY.DS_MB]||"0in").convertor().pixels,o=(e[ATTR_BODY.DS_FB]||"0in").convertor().pixels,r=(ViewManager.getPageWidth()-t-n,!1),a={},s={},l=0;i<o&&(o=0),this.paddingBottom=o;for(var d=this.views.first;d;)l+=d.getHeight(),d=d.next;l+=o,l=Math.max(l,i),0==i&&(r=!0),extend(a,{height:l,padding:"0px "+n+"px 0px "+t+"px"}),extend(s,{padding:"0px "+n+"px 0px "+t+"px"}),a["max-height"]=.4*ViewManager.getPageHeight(),J(this.content).css(a),J(".footer_content").css("padding-bottom",o),J(this.container).show(),r?this.height=0:this.height=J(this.content).height(),J(this.container).hide()},update:function(){var e=J(this.page.prev.footer.content).clone(!0)[0];EditorView.isPageView()||"undefined"!=typeof PrintPreview&&PrintPreview.isPrintPreview()?this.page.prev.footer.showFooter():this.page.prev.footer.hideFooter(),this.container.appendChild(e),J(this.content).remove(),this.content=e,this.el=e.firstChild,this.pageNumberFields=J(this.el).find("span.autopno"),this.pageCountFields=J(this.el).find("span.autopcnt")},updateAutoFields:function(){this.pageNumberFields.find("div."+CONST.FIELD_TEXT_NODE).text(this.page.pageNumber),this.pageCountFields.find("div."+CONST.FIELD_TEXT_NODE).text(ViewManager.getPageCount())},hideFooter:function(){J(this.container).hide()},showFooter:function(){0!==this.footer.height&&J(this.container).show()},addDOMView:function(e,t){this.isPageRendered=!0,e.createView(),e.prev?J(e.el).insertAfter(e.prev.el):e.next?J(e.el).insertBefore(e.next.el):t.appendView(e)},appendView:function(e){this.el.appendChild(e.el)}}),extend(FooterView_Odd.prototype,{create:function(){this.container=J("div.odd_footer_primary")[0];var e={position:"relative"},t="footer_primary ui-hf-container odd_footer_primary",n=J("<div>").attr({class:"ui-hdr-ftr-exit",onclick:"PanelUtil.closeHeaderFooter(true,event)"}).html(J.i18n("writer.common.EXIT")),i=J("<div>").attr({class:"ui-hf-options"}).append(J("<span>").attr({id:"footeredit",class:"ui-hdr-ftr-opt",onclick:"PanelUtil.toggleHeaderFooter();"}).html(J.i18n("writer.common.FOOTER_ODD"))).append(J("<span>").attr({class:"ui-header-seprate"})).append(n),o=J("<div>").attr("class","ui-hf-dbl-clk");o.text(J.i18n("writer.common.DOUBLE_CLICK_TO_EDIT_FOOTER")),J(this.container).attr({class:t}).css(e).append(i,o),this.createContentDiv()},addView:function(e){var t,n,i,o,r=e.node,a=r.prev,s=r.parent,l=this;if(e.section=this,e.page=this.page||ViewManager.pages.first,a){a=r.prev;do t=ViewManager.getViews(a),a=a.prev;while(a&&!t);t.length?(n=t[0],o=this.viewMap[n.id],o.insertAfter(e,n)):(o=this.views,o.insertAsFirst(e))}else"section"===r.parent.type?o=this.views:(i=ViewManager.getViews(s),l=i[0],o=l.views),o.insertAsFirst(e);return this.viewMap[e.id]=o,l},removeView:function(e){var t=this.viewMap[e.id];if(e.views)for(;e.views.last;)this.removeView(e.views.last);t.remove(e),delete this.viewMap[e.id],ViewManager.removeViewDetails(e),e.remove()},createContentDiv:function(){var e=document.createElement("div");this.content=document.createElement("div"),J(this.content).append(e).attr("class","footer_content_wrapper"),this.el=e,J(e).attr({class:"footer_content"}),J(this.container).append(this.content)},remove:function(){PubSub.unsubscribe("footer/changed",this.update,{context:this}),PubSub.unsubscribe("footer/updateAutoFields",this.updateAutoFields,{context:this}),J(this.container).remove()},setStyle:function(){var e=editor.doc.getBodyFormat(),t=(e[ATTR_BODY.DS_ML]||"0in").convertor().pixels,n=(e[ATTR_BODY.DS_MR]||"0in").convertor().pixels,i=(e[ATTR_BODY.DS_MB]||"0in").convertor().pixels,o=(e[ATTR_BODY.DS_FB]||"0in").convertor().pixels,r=(ViewManager.getPageWidth()-t-n,!1),a={},s={},l=0;i<o&&(o=0),this.paddingBottom=o;for(var d=this.views.first;d;)l+=d.getHeight(),d=d.next;l+=o,l=Math.max(l,i),0==i&&(r=!0),extend(a,{height:l,padding:"0px "+n+"px 0px "+t+"px"}),extend(s,{padding:"0px "+n+"px 0px "+t+"px"}),a["max-height"]=.4*ViewManager.getPageHeight(),J(this.content).css(a),J(".footer_content").css("padding-bottom",o),J(this.container).show(),r?this.height=0:this.height=J(this.content).height(),J(this.container).hide()},update:function(){var e=J(this.page.prev.footer.content).clone(!0)[0];EditorView.isPageView()||"undefined"!=typeof PrintPreview&&PrintPreview.isPrintPreview()?this.page.prev.footer.showFooter():this.page.prev.footer.hideFooter(),this.container.appendChild(e),J(this.content).remove(),this.content=e,this.el=e.firstChild,this.pageNumberFields=J(this.el).find("span.autopno"),this.pageCountFields=J(this.el).find("span.autopcnt")},updateAutoFields:function(){this.pageNumberFields.find("div."+CONST.FIELD_TEXT_NODE).text(this.page.pageNumber),this.pageCountFields.find("div."+CONST.FIELD_TEXT_NODE).text(ViewManager.getPageCount())},hideFooter:function(){J(this.container).hide()},showFooter:function(){J(this.container).show()},addDOMView:function(e,t){this.isPageRendered=!0,e.createView(),e.prev?J(e.el).insertAfter(e.prev.el):e.next?J(e.el).insertBefore(e.next.el):t.appendView(e)},appendView:function(e){this.el.appendChild(e.el)}}),extend(FooterView_Even.prototype,{create:function(){this.container=J("div.even_footer_primary")[0];var e={position:"relative"},t="footer_primary ui-hf-container even_footer_primary",n=J("<div>").attr({class:"ui-hdr-ftr-exit",onclick:"PanelUtil.closeHeaderFooter(true,event)"}).html(J.i18n("writer.common.EXIT")),i=J("<div>").attr({class:"ui-hf-options"}).append(J("<span>").attr({id:"footeredit",class:"ui-hdr-ftr-opt",onclick:"PanelUtil.toggleHeaderFooter();"}).html(J.i18n("writer.common.FOOTER_EVEN"))).append(J("<span>").attr({class:"ui-header-seprate"})).append(n),o=J("<div>").attr("class","ui-hf-dbl-clk");o.text(J.i18n("writer.common.DOUBLE_CLICK_TO_EDIT_FOOTER")),J(this.container).attr({class:t}).css(e).append(i,o),this.createContentDiv()},addView:function(e){var t,n,i,o,r=e.node,a=r.prev,s=r.parent,l=this;if(e.section=this,e.page=this.page||ViewManager.pages.first,a){a=r.prev;do t=ViewManager.getViews(a),a=a.prev;while(a&&!t);t.length?(n=t[0],o=this.viewMap[n.id],o.insertAfter(e,n)):(o=this.views,o.insertAsFirst(e))}else"section"===r.parent.type?o=this.views:(i=ViewManager.getViews(s),l=i[0],o=l.views),o.insertAsFirst(e);return this.viewMap[e.id]=o,l},removeView:function(e){var t=this.viewMap[e.id];if(e.views)for(;e.views.last;)this.removeView(e.views.last);t.remove(e),delete this.viewMap[e.id],ViewManager.removeViewDetails(e),e.remove()},createContentDiv:function(){var e=document.createElement("div");this.content=document.createElement("div"),J(this.content).append(e).attr("class","footer_content_wrapper"),this.el=e,J(e).attr({class:"footer_content"}),J(this.container).append(this.content)},remove:function(){PubSub.unsubscribe("footer/changed",this.update,{context:this}),PubSub.unsubscribe("footer/updateAutoFields",this.updateAutoFields,{context:this}),J(this.container).remove()},setStyle:function(){var e=editor.doc.getBodyFormat(),t=(e[ATTR_BODY.DS_ML]||"0in").convertor().pixels,n=(e[ATTR_BODY.DS_MR]||"0in").convertor().pixels,i=(e[ATTR_BODY.DS_MB]||"0in").convertor().pixels,o=(e[ATTR_BODY.DS_FB]||"0in").convertor().pixels,r=(ViewManager.getPageWidth()-t-n,!1),a={},s={},l=0;i<o&&(o=0),this.paddingBottom=o;for(var d=this.views.first;d;)l+=d.getHeight(),d=d.next;l+=o,l=Math.max(l,i),0==i&&(r=!0),extend(a,{height:l,padding:"0px "+n+"px 0px "+t+"px"}),extend(s,{padding:"0px "+n+"px 0px "+t+"px"}),a["max-height"]=.4*ViewManager.getPageHeight(),J(this.content).css(a),J(".footer_content").css("padding-bottom",o),J(this.container).show(),r?this.height=0:this.height=J(this.content).height(),J(this.container).hide()},update:function(){var e=J(this.page.prev.footer.content).clone(!0)[0];EditorView.isPageView()||"undefined"!=typeof PrintPreview&&PrintPreview.isPrintPreview()?this.page.prev.footer.showFooter():this.page.prev.footer.hideFooter(),this.container.appendChild(e),J(this.content).remove(),this.content=e,this.el=e.firstChild,this.pageNumberFields=J(this.el).find("span.autopno"),this.pageCountFields=J(this.el).find("span.autopcnt")},updateAutoFields:function(){this.pageNumberFields.find("div."+CONST.FIELD_TEXT_NODE).text(this.page.pageNumber),this.pageCountFields.find("div."+CONST.FIELD_TEXT_NODE).text(ViewManager.getPageCount())},hideFooter:function(){J(this.container).hide()},showFooter:function(){J(this.container).show()},addDOMView:function(e,t){this.isPageRendered=!0,e.createView(),e.prev?J(e.el).insertAfter(e.prev.el):e.next?J(e.el).insertBefore(e.next.el):t.appendView(e)},appendView:function(e){this.el.appendChild(e.el)}}),extend(FooterView_First.prototype,{create:function(){this.container=J("div.fst_footer_primary")[0];var e={position:"relative"},t="footer_primary ui-hf-container fst_footer_primary",n=J("<div>").attr({class:"ui-hdr-ftr-exit",onclick:"PanelUtil.closeHeaderFooter(true,event)"}).html(J.i18n("writer.common.EXIT")),i=J("<div>").attr({class:"ui-hf-options"}).append(J("<span>").attr({id:"footeredit",class:"ui-hdr-ftr-opt",onclick:"PanelUtil.toggleHeaderFooter();"}).html(J.i18n("writer.common.FOOTER_FIRST_PAGE"))).append(J("<span>").attr({class:"ui-header-seprate"})).append(n),o=J("<div>").attr("class","ui-hf-dbl-clk");o.text(J.i18n("writer.common.DOUBLE_CLICK_TO_EDIT_FOOTER")),J(this.container).attr({class:t}).css(e).append(i,o),this.createContentDiv()},addView:function(e){var t,n,i,o,r=e.node,a=r.prev,s=r.parent,l=this;if(e.section=this,e.page=this.page||ViewManager.pages.first,a){a=r.prev;do t=ViewManager.getViews(a),a=a.prev;while(a&&!t);t.length?(n=t[0],o=this.viewMap[n.id],o.insertAfter(e,n)):(o=this.views,o.insertAsFirst(e))}else"section"===r.parent.type?o=this.views:(i=ViewManager.getViews(s),l=i[0],o=l.views),o.insertAsFirst(e);return this.viewMap[e.id]=o,l},removeView:function(e){var t=this.viewMap[e.id];if(e.views)for(;e.views.last;)this.removeView(e.views.last);t.remove(e),delete this.viewMap[e.id],ViewManager.removeViewDetails(e),e.remove()},createContentDiv:function(){var e=document.createElement("div");this.content=document.createElement("div"),J(this.content).append(e).attr("class","footer_content_wrapper"),this.el=e,J(e).attr({class:"footer_content"}),J(this.container).append(this.content)},remove:function(){PubSub.unsubscribe("footer/changed",this.update,{context:this}),PubSub.unsubscribe("footer/updateAutoFields",this.updateAutoFields,{context:this}),J(this.container).remove()},setStyle:function(){var e=editor.doc.getBodyFormat(),t=(e[ATTR_BODY.DS_ML]||"0in").convertor().pixels,n=(e[ATTR_BODY.DS_MR]||"0in").convertor().pixels,i=(e[ATTR_BODY.DS_MB]||"0in").convertor().pixels,o=(e[ATTR_BODY.DS_FB]||"0in").convertor().pixels,r=(ViewManager.getPageWidth()-t-n,!1),a={},s={},l=0;i<o&&(o=0),this.paddingBottom=o;for(var d=this.views.first;d;)l+=d.getHeight(),d=d.next;l+=o,l=Math.max(l,i),0==i&&(r=!0),extend(a,{height:l,padding:"0px "+n+"px 0px "+t+"px"}),extend(s,{padding:"0px "+n+"px 0px "+t+"px"}),a["max-height"]=.4*ViewManager.getPageHeight(),J(this.content).css(a),J(".footer_content").css("padding-bottom",o),J(this.container).show(),r?this.height=0:this.height=J(this.content).height(),J(this.container).hide()},update:function(){var e=J(this.page.prev.footer.content).clone(!0)[0];EditorView.isPageView()||"undefined"!=typeof PrintPreview&&PrintPreview.isPrintPreview()?this.page.prev.footer.showFooter():this.page.prev.footer.hideFooter(),this.container.appendChild(e),J(this.content).remove(),this.content=e,this.el=e.firstChild,this.pageNumberFields=J(this.el).find("span.autopno"),this.pageCountFields=J(this.el).find("span.autopcnt")},updateAutoFields:function(){this.pageNumberFields.find("div."+CONST.FIELD_TEXT_NODE).text(this.page.pageNumber),this.pageCountFields.find("div."+CONST.FIELD_TEXT_NODE).text(ViewManager.getPageCount())},hideFooter:function(){J(this.container).hide()},showFooter:function(){J(this.container).show()},addDOMView:function(e,t){this.isPageRendered=!0,e.createView(),e.prev?J(e.el).insertAfter(e.prev.el):e.next?J(e.el).insertBefore(e.next.el):t.appendView(e)},appendView:function(e){this.el.appendChild(e.el)}}),extend(ContentView.prototype,{create:function(){var e=editor.doc.getPaperWidth();this.el=document.createElement("div"),this.el.appendChild(document.createElement("div")),J(this.el.children[0]).css({width:e}),this.createColumns(),J(this.el).css({position:"relative"}).attr({class:"zw-contentpane"}),this.setStyle();var t=editor.clientActiveSection?editor.clientActiveSection.className.toLowerCase():"";t&&t.indexOf("zw-contentpane")===-1&&t.indexOf("zw-footnotepane")===-1&&t.indexOf("zw-endnotepane")===-1?J(this.el).addClass("unselectableSection"):J(this.el).addClass("selectableSection"),J(this.el).insertAfter(this.page.header.container),PubSub.subscribe("content/setStyle",this.setStyle,{context:this})},remove:function(){PubSub.unsubscribe("content/setStyle",this.setStyle,{context:this});for(var e=this.columns.first;e;)e.remove(),PubSub.publish("column/removed",e),e=e.next;J(this.el).remove()},setStyle:function(){var e,t=editor.doc.getBodyFormat(),n=t[ATTR_BODY.DS_ML],i=t[ATTR_BODY.DS_MR],o=EditorView.isPageView()?"0px":"-1px",r={"margin-left":n,"margin-right":i,"margin-top":o,position:"relative"};for(!EditorView.isWebView()&&(EditorView.isPageView()||!this.page.next||EditorView.isFixedView()&&EditorView.isPrintView())&&(this.minHeight=ViewManager.getContentHeight(),r.height=this.minHeight),J(this.el).removeAttr("style").css(r).addClass("selectableSection zw-contentpane"),e=this.columns.first;e;)e.setStyle(),e=e.next},createColumns:function(){for(var e=ViewManager.getColCount(),t=0;t<e;t++)this.createColumn()},createColumn:function(){var e=new ColumnView(this);this.columns.append(e),e.create()},removeColumn:function(e){var t=e.next;if(e.remove(),this.columns.remove(e),PubSub.publish("column/removed",e),t)for(var n,i,o=t;o;)n=o.width,o.setStyle(),i=o.width,n!=i&&this.reflowAllColumnViews(o),o=o.next;this.columns.isEmpty()&&ViewManager.removePage(this.page)},reflowAllColumnViews:function(e){for(var t=e.views.first;t;){if("para"==t.type&&!t.parent&&!t.isInDirtyNode()){views=ViewManager.getViews(t.node);for(var n=0;n<views.length;n++)views[n].start<t.start||t.start==views[n].start&&views[n].reflow()}t=t.next}},hasLessColumns:function(){var e=ViewManager.getColCount()||1;return this.columns.length<e},findColumn:function(e){var t,n,i,o,r=e.node,a=r.prev,s=r.parent;return a?(t=ViewManager.getViews(a),n="cell"==r.type?t[0]:lastElementOf(t),o=n.column):"section"==r.parent.type?o=this.columns.first:(t=ViewManager.getViews(s),i=t[0],o=i.column),o},addView:function(e){var t=this.findColumn(e);return t.addView(e)},removeView:function(e){e.column.removeView(e)},moveColumn:function(e){var t=this.page,n=e.content.page;e.content.columns.remove(e),t.before(n)?(this.columns.append(e),J(this.el.children[0]).append(e.container)):(this.columns.insertAsFirst(e),J(this.el.children[0]).prepend(e.container)),e.content=this;var i=e.width;e.setStyle();var o=e.width;i!=o&&this.reflowAllColumnViews(e),PubSub.publish("column/removed",e);for(var r=e?e.next:null,a=ViewManager.getColCount();r&&r.columnNumber<=a;){var i=r.width;r.setStyle();var o=r.width;i!=o&&this.reflowAllColumnViews(r),r=r.next}},moveColumnsFromNextPage:function(){for(var e,t=ViewManager.getColCount()||1,n=this.page.next;n&&this.columns.length<t;){for(;n.content.columns.first&&this.columns.length<t;)this.moveColumn(n.content.columns.first);if(e=n,n=n.next,e.content.columns.isEmpty()&&ViewManager.removePage(e),e)for(var i=e.content.columns.first;i;){var o=i.width;i.setStyle();var r=i.width;o!=r&&this.reflowAllColumnViews(i),i=i.next}}0==this.columns.length&&this.createColumn()},moveColumnsToNextPage:function(e){var t,n=e;for(n||(n=ViewManager.getColCount()||1),this.page.next||ViewManager.createPage(),t=this.page.next;this.columns.length>n;){var i=this.page.floatImages;if(i.length>0)for(var o=this.columns.last.views.first;o;){for(var r=0;r<i.length;r++){var a=i[r].affectedNodes;a.contains(o.node.id)&&a.splice(a.indexOf(o.node.id),1)}o=o.next}t.content.moveColumn(this.columns.last)}},balanceColumns:function(e){var t=e;t||(t=ViewManager.getColCount()||1),this.columns.length<t?this.moveColumnsFromNextPage():this.columns.length>t&&this.moveColumnsToNextPage(t)},paginate:function(e){this.updateHeight();for(var t,n,i,o,r,a=0,s=!1,t=this.columns.first;t;){for(r=t.views.first;r;){if(n=editor.doc.getRawFormatAt(r.node.getIndex()),n&&"pgbrk"==n.cls){s=!0;break}r=r.next}if(a+=1,s)break;t=t.next}for(nColumns=s?a:ViewManager.getColCount()||1,this.balanceColumns(nColumns),e=e||0,a=0,t=this.columns.first;t&&a<e;)t=t.next,a++;t||(t=this.columns.first);do i=t.next,o=t.paginate(),t=t.next;while(t&&o);return this.columns.length<nColumns&&this.page.next?this.paginate():o},updateHeight:function(){var e={},t=(editor.doc.getBodyFormat(),ViewManager.getColCount()||1);e.height="",editor.doc.getRole()===USER_ROLE.PUBLIC&&1==t?e["min-height"]=this.columns.first.getHeight():(EditorView.isPageView()||t>1||EditorView.isFixedView()&&"undefined"!=typeof PrintPreview&&PrintPreview.isPrintPreview())&&(this.minHeight=this.page.getContentHeight(),e.height=this.minHeight),J(this.el).css(e)},showEndNote:function(){J(this.endNote.container).show()},hideEndNote:function(){J(this.endNote.container).hide()},appendView:function(e){J(e.el).insertBefore(this.endNote.container)},getSeparatorHeight:function(){return this.separatorHeight=this.separatorHeight||this.endNote.separator.offsetHeight,this.separatorHeight}}),extend(ColumnView.prototype,{create:function(){this.container=document.createElement("div"),this.createBody(),this.setColumnNumber(),PubSub.subscribe("column/removed",this.setColumnNumber,{context:this}),PubSub.subscribe("column/moved",this.setColumnNumber,{context:this}),this.setStyle(),J(this.content.el.children[0]).append(this.container)},remove:function(){PubSub.unsubscribe("column/removed",this.setColumnNumber,{context:this}),PubSub.unsubscribe("column/moved",this.setColumnNumber,{context:this}),J(this.container).remove()},createBody:function(){this.el=document.createElement("div"),J(this.el).addClass("zw-column").data("id",this.id),J(this.container).append(this.el),this.createEndNoteDiv(),this.createFootNoteDiv()},setColumnNumber:function(){for(var e=0,t=this;t.prev;)e++,t=t.prev;this.columnNumber=e+1,this.setColumnLeft()},setColumnLeft:function(){var e=this.prev;if(e){var t=e.columnNumber-1||0,n=ViewManager.getColumnWidthArray(),i=ViewManager.getColumnSpaceArray();this.left=e.left+(n[t]||"0in").convertor().pixels+(i[t]||"0in").convertor().pixels}else this.left=0},createEndNoteDiv:function(){var e=document.createElement("div"),t=document.createElement("div"),n=this.createSeparator();J(e).append(n).append(t).addClass("zw-endnotecontainer").hide(),this.endNote={container:e,el:t,separator:n},J(this.el).append(e)},updateHeight:function(){var e;for(this.content.height=0,e=this.views.first;e;)this.content.height+=e.getHeight(),e=e.next},createFootNoteDiv:function(){var e=document.createElement("div"),t=document.createElement("div"),n=this.createSeparator();J(e).addClass("zw-footnotecontainer").append(n).append(t).hide(),this.footNote={container:e,el:t,separator:n},J(this.container).append(e)},createSeparator:function(){var e=document.createElement("div");return J(e).addClass("endnotestyl"),e},setStyle:function(){var e=ViewManager.getColumnFormat(),t=this.getMaxColumnHeight(),n=editor.doc.getPaperWidth(),i={},o={},r=0;if(i.overflow="",i.display="block",e.count>1?(this.prev?(r=this.prev.columnNumber,o.width=(e.width[r]||"0in").convertor().pixels,this.left+o.width>n&&!e.iseqwidth?i.width=n-this.left:i.width=(e.width[r]||"0in").convertor().pixels+(e.space[r-1]||"0in").convertor().pixels/2,i["margin-left"]=(e.space[r-1]||"0in").convertor().pixels/2,o["margin-left"]=(e.space[r-1]||"0in").convertor().pixels/2,"1"==e.seperator?(o.width=o.width-1,i.width=i.width-1,i["border-left"]="1px solid #ccc"):i["border-left"]=""):(i["margin-left"]="0px",o.width=e.width[r].convertor().pixels,o.width>n?i.width=n:i.width=e.width[r].convertor().pixels),this.left+o.width>n&&(i.overflow="hidden",this.left>n&&(i.display="none"))):(i.width=e.width[r].convertor().pixels,o.width=e.width[r].convertor().pixels),this.width=o.width,EditorView.isPageView()||"undefined"!=typeof PrintPreview&&PrintPreview.isPrintPreview()){var a=this.getHeight();i.minHeight=a,o.minHeight=a,i.height=t,o.height=t}i.float="left",J(this.el).removeAttr("style").css(o),J(this.container).removeAttr("style").css(i)},addDOMView:function(e,t){var n,i;e.isInVisiblePage()&&(n=e.prev,i=e.next,n&&n.el?(this.content.page.isPageRendered=!0,e.el||("cell"==e.type?e.createView(t.el):e.createView()),J(e.el).insertAfter(n.el)):i&&i.el?(this.content.page.isPageRendered=!0,e.el||e.createView(),J(e.el).insertBefore(i.el)):t.el&&(this.content.page.isPageRendered=!0,e.el||e.createView(),t.appendView(e)))},addViewTo:function(e,t,n,i){var o,r,a,s,l,d,c=e.node,u=ViewManager.getViews(c);if(e.column=this,"section"==c.parent.type){s=ViewManager.getViews(c);var p;for(d=0;d<s.length;d++)if(this.viewMap[s[d].id]){p=s[d];break}if(p)s=this.viewMap[p.id],p.prev?s.insertAfter(e,p):s.insertAsFirst(e),this.viewMap[e.id]=s;else if(c.prev){o=c.prev;do u=ViewManager.getViews(o),o=o.prev;while(o&&!u);a=lastElementOf(u),a&&this.viewMap[a.id]?(s=this.viewMap[a.id],s.insertAfter(e,a)):(s=t,s.insertAsFirst(e))}else s=t,s.insertAsFirst(e);this.viewMap[e.id]=s}else{if(r=c.parent,u=ViewManager.getViews(r),n=e.parent,!n||i)for(d=0;d<u.length;d++)if(this.viewMap[u[d].id]){n=u[d];break}if(l=n.views,c.prev){if("cell"==c.type)if(null!=l.last&&l.last.node.id==e.node.prev.id)a=l.last;else{var h=ViewManager.getViews(c.prev);h&&(a=h[0])}else{for(o=c.prev,u=ViewManager.getViews(o);!u&&o;)u=ViewManager.getViews(o),o=o.prev;a=lastElementOf(u)}a&&(s=this.viewMap[a.id]),s?s.insertAfter(e,a):(s=l,s.insertAsFirst(e)),this.viewMap[e.id]=s}else l.insertAsFirst(e),this.viewMap[e.id]=l;e.parent=n}return this.content.updateHeight(),n},addView:function(e,t){return this.addViewTo(e,this.views,this,t)},appendView:function(e){J(e.el).insertBefore(this.endNote.container)},removeView:function(e){if(e.views)for(;e.views.last;)this.removeView(e.views.last);this.removeViewMapping(e),ViewManager.removeViewDetails(e),e.remove()},removeViewMapping:function(e){var t=this.viewMap[e.id];t&&(t.remove(e),delete this.viewMap[e.id])},getPageNumber:function(){return this.content.page.pageNumber},getPrevColumn:function(){return this.prev||this.columnInPrevPage()},getNextColumn:function(){return this.next||this.columnInNextPage()},moveView:function(e,t,n){var i,o,r,a,s=!1,l=!1,d=[];n=n!==!1,s=ViewManager.isFloatImageArea(e),a=e.column.content.page.floatImages,editor.isEditable()&&(e.isInVisiblePage()&&!editor.visiblePageNumbers.contains(this.getPageNumber())||!e.isInVisiblePage()&&editor.visiblePageNumbers.contains(this.getPageNumber()))&&(e.remove(),e.el=null),t.removeViewMapping(e);var c=this.addView(e,n);if("para"==e.type){if(e.floatImages.length>0)for(var r=0;r<e.floatImages.length;r++)if(!(e.floatImages[r].index<e.node.getIndex()))for(var u=0;u<a.length;u++)e.floatImages[r].fid==a[u].fid&&(a[u].pageTop=ViewManager.getViewTop(e)+a[u].top,d.push(a.splice(u,1)));e.moveFootNotesInPara()}if(l=ViewManager.isFloatImageArea(e),"para"!=e.type||e.parent||this.width==t.width&&!s&&!l||e.isInDirtyNode())d.length>0&&(e.column.content.page.floatImages=e.column.content.page.floatImages.concat(d[0]),d=[]);else for(i=ViewManager.getViews(e.node),r=0;r<i.length;r++)i[r].start<e.start||e.start==i[r].start&&(i[r].reflow(),i[r].isReflow=!0);this.addDOMView(e,c),"para"==e.type&&(e.adjustLineSpaces(),e.setLineSpaceStyle(),e.updateBorderStyles(),e.setBorderStyle(),e.setHeight());var p=e.prev;if(p&&"para"==p.type&&(p.adjustLineSpaces(),p.setLineSpaceStyle(),p.updateBorderStyles(),p.setBorderStyle(),p.setHeight()),e.views){for(i=[],o=e.views.first;o;)i.push(o),o=o.next;for(r=0;r<i.length;r++)this.moveView(i[r],t)}},mergeViews:function(e){var t=this.views.last;t.id!=e.id&&t.node.id==e.node.id&&(t.merge(e,this),t&&"para"==t.type&&(t.adjustLineSpaces(),t.setLineSpaceStyle(),t.updateBorderStyles(),t.setBorderStyle()))},paginate:function(){var e,t,n,i,o,r,a=0,s=0,l=!1,d=!1,c=0;this.updateHeight(),this.setStyle(),this.clearOutGoingFootNotes();var u=this.getPrevColumn();if(n=ViewManager.getContentHeight(this.content.page),u){var p=u.getOutGoingFootnoteHeight();p>n?(this.carryOutGoingFootNotesToNextColumn(n),n=0):n-=p}for(e=this.views.first;e;){if(i=!!e.node.paraProperties&&e.node.paraProperties.pageBreakBefore,c=ViewManager.getViewHeight(e,!0),a+c>n||"hr"==e.node.type&&(e.isPageBreakHr()||e.isColumnBreakHr())||i){if(!i){l=!0;break}if(e.prev){l=!0,e=e.prev,a=0;break}if(a+c>n){l=!0;break}}a+=c,e=e.next}if(!l&&!this.endNoteViews.isEmpty())for(e=this.endNoteViews.first,a+=this.getSeparatorHeight();e;){if(a+e.getHeight()>n&&(e!==this.endNoteViews.first||0!==this.views.length)){l=!0;break}a+=e.getHeight(),e=e.next}if(s=n-a,0==a&&this.prev&&!l)return this.content.removeColumn(this),!0;if(l)return this.splitColumn(e,s),!0;if(this.next||this.content.page.next){if(a<=n){for(r=this.next||this.columnInNextPage();r&&r.views.isEmpty()&&r.footNoteViews.isEmpty();)r.endNoteViews.isEmpty()||(this.moveEndNotes(r.endNoteViews.first),d=!0),o=r.next||r.columnInNextPage(),r.content.removeColumn(r),r=o;if(r){for(e=r.views.first,c=ViewManager.getViewHeight(e,!0),!this.views.isEmpty()&&e&&e.node.id===this.views.last.node.id&&(s-=c,t=e.next,this.mergeViews(e),e=t,c=ViewManager.getViewHeight(e,!0),d=!0);e&&c<s;)this.moveView(e,r),s-=c,e=r.views.first,c=ViewManager.getViewHeight(e,!0),d=!0;e&&(this.moveView(e,r),d=!0)}}if(o=this.next||this.columnInNextPage(),o&&o.views.isEmpty()&&o.footNoteViews.isEmpty()&&o.endNoteViews.isEmpty()&&o.content.removeColumn(o),d)return this.paginate()}return!1},columnInNextPage:function(){return this.content.page.next&&this.content.page.next.content.columns.first},columnInPrevPage:function(){return this.content.page.prev&&this.content.page.prev.content.columns.last},splitColumn:function(e,t){var n,i,o,r,a;if("hr"!=e.node.type||"hr"==e.node.type&&e.isColumnBreakHr()?this.next?n=this.next:this.content.hasLessColumns()?(this.content.createColumn(),n=this.next):(this.content.page.next||ViewManager.createPage(),n=this.columnInNextPage()):(this.content.page.next||ViewManager.createPage(),n=this.columnInNextPage()),"endnote"===e.type)n.moveEndNotes(e);else{if(this.views.last.id==e.id&&"table"!=this.views.last.type||!n.views.first||this.views.last.node.id!=n.views.first.node.id||this.mergeViews(n.views.first),i=e.split(t,n,this,{considerFootNotes:!0}),i||"hr"==e.node.type&&e.isColumnBreakHr()){for(;e.next;)n.moveView(e.next,this);if(0==ViewManager.getViewHeight(e,!0)){var s=e.prev;this.removeView(e),s&&"para"==s.type&&(s.adjustLineSpaces(),s.setLineSpaceStyle(),s.updateBorderStyles(),s.setBorderStyle(),s.publishLineEvents(),s.setHeight())}(i&&0==ViewManager.getViewHeight(i,!0)||i&&i.views&&i.views.isEmpty())&&n.removeView(i),this.endNoteViews.isEmpty()||n.moveEndNotes(this.endNoteViews.first)}if("hr"==e.node.type&&e.isPageBreakHr())for(o=e.column,a=e,r=e.next;o;){for(;r;)n.moveView(r,o),r=e.next;0==ViewManager.getViewHeight(a,!0)&&this.removeView(a),this.endNoteViews.isEmpty()||n.moveEndNotes(this.endNoteViews.first),o=o.next,o&&(r=o.views.first)}var l=i;if(l=l&&l.next?l.next:l&&l.column.next?l.column.next.views.first:null)for(var d=i.column.content.page.floatImages;d.length>0&&l;){for(var c=0;c<d.length;c++)for(var u=0;u<d[c].affectedNodes.length;u++)l.node.id==d[c].affectedNodes[u]&&(d[c].removedAffectedNodes.push(d[c].affectedNodes[u]),d[c].affectedNodes.splice(u,1));l=l.next?l.next:l.column.next?l.column.next.views.first:null}}this.endNoteViews.isEmpty()&&this.hideEndNote(),this.setStyle()},getMaxColumnHeight:function(){return ViewManager.getContentHeight(this.content.page)-this.getFootNoteHeight()},getHeight:function(){for(var e=this.views.first,t=0;e;)t+=e.getHeight(),e=e.next;return t},getPage:function(){return this.content.page},addFootNoteView:function(e,t){var n;if(e.column=this,this.showFootNote(),this.footNoteViews.first)if(n=this.footNoteViews.first,n.number>e.number)this.footNoteViews.insertAsFirst(e),J(e.el).insertBefore(n.el);else for(n=this.footNoteViews.last;n;){if(n.number<e.number){this.footNoteViews.insertAfter(e,n),J(e.el).insertAfter(n.el);break}n=n.prev}else this.footNoteViews.insertAsFirst(e),this.footNote.el.appendChild(e.el);this.viewMap[e.id]=this.footNoteViews},showFootNote:function(){J(this.footNote.separator).show(),J(this.footNote.container).show()},removeNoteView:function(e){this.removeViewMapping(e),ViewManager.removeViewDetails(e),e.remove()},getFootNoteTop:function(e,t){var n,i,o,r=0,a=0;for(n=0;n<e.lines.length;n++)if(r+=e.lines[n].height,t==e.lines[n]){a=r-e.lines[n].height;break}for(;e;){for(e.parent||(o=e),i=e.parent,e=e.prev;e;)r+=e.getHeight(),e=e.prev;e=i}return{view:o,top:r,remainingHeight:a}},getFootNoteHeight:function(){var e=this.footNoteViews.first,t=0;for(e&&(t+=this.getSeparatorHeight());e;)t+=e.getHeight(),e=e.next;return t},moveViewToFootNote:function(e,t){t.removeViewMapping(e),this.addFootNoteView(e);t.footNoteViews.isEmpty()&&J(t.el).parent().find("div.endnotestyl").eq(1).hide(),this.footNoteViews.isEmpty()||J(this.el).parent().find("div.endnotestyl").eq(1).show()},addToOutGoingFootNotes:function(e,t,n){var i=NoteViewCollection.getNoteViews(e)[0],o={footNoteView:i,containingPara:t};this.outgoingFootnotes.references[e]=o,this.outgoingFootnotes.ids.push(e),n.moveViewToFootNote(i,i.column)},clearOutGoingFootNotes:function(){var e,t,n=this.outgoingFootnotes.references;for(var e in n)t=n[e].footNoteView,this.moveViewToFootNote(t,t.column),this.removeFromOutGoingFootNotes(e);this.outgoingFootnotes={references:{},ids:[]}},carryOutGoingFootNotesToNextColumn:function(e){var t,n,i,o,r,a=0,s=this.getPrevColumn(),l=this.getNextColumn();l||(this.content.page.next||ViewManager.createPage(),l=this.columnInNextPage());for(var d=s.outgoingFootnotes.ids,c=s.outgoingFootnotes.references,u=!1,p=0,h=d.length;p<h;p++)t=d[p],o=c[t],n=o.footNoteView,r=n.getHeight(),!u&&a+r<e?a+=r:(u=!0,i=o.containingPara,this.addToOutGoingFootNotes(t,i,l));return a},getOutGoingFootnoteHeight:function(){for(var e,t,n=0,i=this.outgoingFootnotes.ids,o=0,r=i.length;o<r;o++)e=i[o],t=this.outgoingFootnotes.references[e].footNoteView,n+=t.getHeight();return n},removeFromOutGoingFootNotes:function(e){for(var t,n,i=this;i&&i.isAnOutGoingFootNote(e);){for(delete i.outgoingFootnotes.references[e],t=i.outgoingFootnotes.ids,n=0,len=t.length;n<len;n++)if(t[n]===e){i.outgoingFootnotes.ids.splice(n,1);break}i=i.getNextColumn()}},isAnOutGoingFootNote:function(e){return!!this.outgoingFootnotes.references[e]},getSeparatorHeight:function(){var e;return this.separatorHeight||(e=this.prev||this.columnInPrevPage(),e?this.separatorHeight=e.getSeparatorHeight():this.separatorHeight=this.footNote.separator.offsetHeight),this.separatorHeight},addEndNoteView:function(e){var t;this.showEndNote(),e.column=this,e.updateColumnofViews(e.views.first);var n=NoteViewCollection.getOrderedEndNoteViews();n.length>1&&(t=n[e.number-1]),t&&t.el&&t.column.id==this.id?(this.endNoteViews.insertAfter(e,t),J(e.el).insertAfter(t.el)):(this.endNoteViews.insertAsFirst(e),J(this.endNote.el).prepend(e.el)),this.viewMap[e.id]=this.endNoteViews},showEndNote:function(){J(this.endNote.container).show()},hideEndNote:function(){J(this.endNote.container).hide()},hasEndnotes:function(){return!this.endNoteViews.isEmpty()},hasFootNotes:function(){return!this.footNoteViews.isEmpty()},moveEndNotes:function(e){for(var t,n=e.column;e;)t=e.next,e=n.endNoteViews.remove(e),delete n.viewMap[e.id],this.addEndNoteView(e),e=t}}),extend(PageView.prototype,{create:function(){this.constructPage(),this.header.create(),this.footer.create(),this.content.create()},setStyle:function(){var e,t=editor.doc.getBodyFormat(),n=ViewManager.getPageWidth();is_wkhtmltopdf_browser||(n+=PAGE_BORDER_WIDTH),e={width:n+"px",position:"relative"},(EditorView.isPageView()||"undefined"!=typeof PrintPreview&&PrintPreview.isPrintPreview())&&(e.height=ViewManager.getPageHeight()+"px"),EditorView.isPageView()?(J(this.el).removeClass("zw-fixedview"),J(this.el).addClass("zw-paginated")):(e.height="",e["min-height"]=ViewManager.getContentHeight(),J(this.el).removeClass("zw-paginated").addClass("zw-fixedview"),this.prev&&EditorView.isWebView()&&J(this.el).addClass("zw-webview"),EditorView.isWebView()&&(e.width=editor.doc.getPaperWidth(!0)+"px")),EditorView.isWebView()?e["margin-left"]="0px":e["margin-left"]="auto",this.el.style.background="none",t[ATTR_BODY.DS_BGC]?e.backgroundColor=t[ATTR_BODY.DS_BGC]:e.backgroundColor="rgb(255, 255, 255)",t[ATTR_BODY.WM_URL]&&!editor.isOffline()&&(this.el.style.background="transparent url("+DomUtil.processImgSrc(t[ATTR_BODY.WM_URL])+") no-repeat 50%"),DocUtil.constructRenderingFormat(e),J(this.el).css(e),PubSub.publish("Document/publish",this.el)},setPageNumber:function(){this.pageNumber=(this.prev&&this.prev.pageNumber||0)+1;var e=ViewManager.pageIsInVisibleRange(this.el,this.pageNumber);e&&editor.visiblePageNumbers.push(this.pageNumber),editor.visiblePageNumbers&&editor.visiblePageNumbers.contains(this.pageNumber)&&this.content&&this.content.el&&(this.content.el.style.display="block")},remove:function(){this.prev||(this.removeViews(this.headerViews),this.removeViews(this.footerViews)),this.floatImages=[];for(var e=this.content.columns.first;e;)this.removeViews(e.views),e=e.next;PubSub.unsubscribe("page/removed",this.setPageNumber,{context:this}),PubSub.unsubscribe("page/setStyle",this.setStyle,{context:this}),this.header.remove(),this.footer.remove(),this.content.remove(),J(this.el).remove()},removeViews:function(e){for(var t;e.last;)t=e.last,t.views&&this.removeViews(t.views),this.removeView(t)},after:function(e){return!!e&&this.pageNumber>e.pageNumber},before:function(e){return e&&!this.after(e)},addViewToHeader:function(e){this.header.addView(e)},addViewToContent:function(e){return this.content.addView(e)},addViewToFooter:function(e){this.footer.addView(e)},paginate:function(e,t){var n=this.content.paginate(t)||this.next&&this.next.content.columns.length!=(ViewManager.getColCount()||1);e&&e.resolve(this,n?this.next:null)},removeView:function(e){(e.section||e.column).removeView(e)},updateHeight:function(){var e;for(this.content.height=0,e=this.views.first;e;)this.content.height+=e.getHeight(),e=e.next;this.remainingHeight=this.getContentHeight()-this.height},getViewsFrom:function(e,t){var n,i=[];for(n=e.first;n;)n.type==t&&i.push(n),n.views&&(i=i.concat(this.getViewsFrom(n.views,t))),n=n.next;return i},getContentHeight:function(){return ViewManager.getContentHeight(this)},getHeaderHeight:function(){return this.getHeight(this.headerViews)+this.header.paddingTop},getFooterHeight:function(){return this.getHeight(this.footerViews)+this.footer.paddingBottom},renderShapes:function(e){var t,n;n=this.getViewsFrom(e.views,"para"),InsertShape.createShape("modify",t?t.node:null,n)},renderView:function(){var e=this.content.columns.first;if(!this.isPageRendered){for(;e;)e.el.innerHTML="",e.el.appendChild(e.fragment),e.el.appendChild(e.endNote.container),this.renderShapes(e),e.footNote.el.appendChild(e.fragment),e.endNote.el.appendChild(e.fragment),e=e.next;J(this.header.container).after(this.content.el),this.isPageRendered=!0}},createContentFragments:function(){for(var e,t=0,n=this.content.columns.first;n;)e=n.views,e&&(t+=ViewManager.getViewsLength(e)),n=n.next;if(this.isPageRendered){for(var i=this.content.columns.last.endNoteViews,o=i.first,r=0;o;)r+=o.getAllViewCount(),o=o.next;if(t+r==J(this.content.el).find("div.zw-column").find("div.zw-paragraph,div.zw-hr,table.zw-table,tr.zw-tr,td.zw-td,div#toc").length)return;this.isPageRendered=!1}var a,s,n;n=this.content.columns.first;for(var l=function(e){U.each(e,function(e){PubSub.publish(e.type+"view/before/remove",[e])})};n;){var e=this.getViewsFrom(n.views,"para");l(e),n=n.next}for(n=this.content.columns.first;n;){for(n.el.innerHTML="",a=n.views.first;a;)a.createView(n.fragment),s=a.node,PubSub.publish(s.type+"view/create",s),a=a.next;n=n.next}},createFootNoteFragments:function(e){if(!this.isPageRendered)for(var t,n=e.footNoteViews.first;n;){for(t=n.views.first;t;)t.createView(n.el),t=t.next;NoteViewCollection.updateNoteNumbers("footnote"),n=n.next}},createEndNoteFragments:function(e){if(!this.isPageRendered){var t,n;for(t=e.endNoteViews.first,e.endNote.el.innerHTML="";t;){for(n=t.views.first,t.el.innerHTML="",e.fragment.appendChild(t.el);n;)n.createView(t.el),n=n.next;NoteViewCollection.updateNoteNumbers("endnote"),t=t.next}}},forceToRender:function(){this.isPageRendered=!1,this.createContentFragments(),this.renderView()},constructPage:function(){this.el=document.createElement("div"),this.setPageNumber(),this.setStyle(),J(this.el).addClass("zw-page").data("id",this.id).appendTo(editor.jeditorPane);var e=editor.doc.getRole(),t="SHAREDREADCOMMENT"==e||"ANYONELINK_SHAREDREADCOMMENT"==e||"SHAREDREAD"===e;EditorView.isWebView()||is_wkhtmltopdf_browser||!t&&!editor.isEditable()||J(document.createElement("div")).addClass("ui-page-collapse-div").append(J(document.createElement("span")).attr("class",("Fixed View"==EditorView.getView()?"ui-icon-page-expand-sm":"ui-icon-page-collapse-sm")+" js-collpse-span js-collpse-span ui-button-icon-primary ui-icon ui-writer-menu-icons ui-icon-sprit-image-blue")).appendTo(this.el),PubSub.subscribe("page/removed",this.setPageNumber,{context:this}),PubSub.subscribe("page/setStyle",this.setStyle,{context:this})},getHeight:function(e){var t,n=0;if(!e.isEmpty())for(t=e.first;t;)n+=t.getHeight(),t=t.next;return n}});var CellView=function(e){this.id=randomId("cell"),this.node=e,this.height=e.cell_ht,this.floatImageHeight={},ViewManager.addViewDetails(this),this.type="cell",this.views=new LinkedList,this.minCellHeight=0};extend(CellView.prototype,{create:function(){var e=editor.doc.getThemeStyleFormatAt(this.node.getIndex());this.setMinHeight(e)},remove:function(){this.isInVisiblePage()?(J(this.el).remove(),"content"==this.node.section.name&&(this.column.content.page.isPageRendered=!0)):this.column.content.page.isPageRendered=!1},getContentHeight:function(){var e,t=this.node.cellPadding.top+this.node.borderProperties[ATTR_BORDERS.BORDER_TOP];for(view=this.views.first;view;)e=view.getHeight(),t+=e,view=view.next;return t},isInnerTabale:function(){for(var e=this.parent;e&&"table"!=e.type;)e=e.parent;return e&&e.parent&&"content"!=e.parent.type},split:function(e,t,n,i){var o,r,a,s,l,d=new CellView(this.node);if(d.create(),d.parent=i.parent,r=this.views.first,a=this.node.cellPadding.top+this.node.cellPadding.bottom+this.node.borderProperties[ATTR_BORDERS.BORDER_TOP]+this.node.borderProperties[ATTR_BORDERS.BORDER_BOTTOM],o=a,this.minCellHeight>e&&e!=ViewManager.getContentHeight(this.page)&&!this.isInnerTabale())l=r,a=Math.max(a,this.minCellHeight);else for(;r;){if(s=ViewManager.getViewHeight(r,i.considerFootNotes),a+s>e){l=r;break}a+=s,r=r.next}var c=t.addView(d);if(t.addDOMView(d,c),!l&&a+this.node.cellPadding.bottom+(this.node.borderProperties[ATTR_BORDERS.BORDER_BOTTOM]||1)>e&&(l=this.views.last,a-=s-this.node.cellPadding.bottom-(this.node.borderProperties[ATTR_BORDERS.BORDER_BOTTOM]||1)),l){for(var u=l.split(e-a,t,n,{parent:d,borderHeight:o,considerFootNotes:i.considerFootNotes});l.next;)t.moveView(l.next,n);u&&0==ViewManager.getViewHeight(u,!0)&&t.removeView(u),0==ViewManager.getViewHeight(l,!0)&&n.removeView(l)}return d},merge:function(e,t){var n,i,o,r=[];for(i=e.views.first,i&&this.views.last&&i.node.id===this.views.last.node.id&&this.views.last.merge(i,t),o=e.views.first;o;)r.push(o),o=o.next;for(n=0;n<r.length;n++)r[n].parent=this,t.moveView(r[n],r[n].column,!1);e.column.removeView(e)},setHeight:function(){},getHeight:function(){var e,t=0,n=this.node,i=n.merge;if(i&&("hmp"==i||"vmp"==i&&!DTTableUtils.isLastVmpCell(n)))return 0;if(!this.views.isEmpty())for(e=this.views.first;e;)t+=e.getHeight(),e=e.next;if("fc"==n.merge&&n.rspan>1)return n.parasHt=t,this.minCellHeight;if(t+=n.cellPadding.top+n.cellPadding.bottom+n.borderProperties[ATTR_BORDERS.BORDER_TOP]+(n.borderProperties[ATTR_BORDERS.BORDER_BOTTOM]||1),DTTableUtils.isLastVmpCell(n)){for(var o=DTTableUtils.getCellDepth(n),r=DTTableUtils.getColIdx(n),a=n.parent,s=0;o>1;)o--,a=a.prev,s+=a.height;if(t=a.children[r].parasHt-s,isNaN(t))return 15}return Math.max(t,this.minCellHeight)},getFootNoteHeight:function(){var e,t=0;if(!this.views.isEmpty())for(e=this.views.first;e;)t+=e.getFootNoteHeight(),e=e.next;return t},setMinHeight:function(e){this.minCellHeight=e.ht&&e.ht.convertor().pixels||0},appendView:function(e){this.el.firstChild.appendChild(e.el)},getFirstLineHeight:function(){var e=this.node.cellPadding.top+this.node.borderProperties[ATTR_BORDERS.BORDER_TOP];return"para"==this.views.first.type&&(e+=this.views.first.lines[0].height,1==this.views.length&&1==this.views.first.lines.length&&(e+=this.node.cellPadding.bottom+(this.node.borderProperties[ATTR_BORDERS.BORDER_BOTTOM]||1))),e},createView:function(e){var t=this.node,n=editor.doc.getThemeStyleFormatAt(t.getIndex());this.setMinHeight(n),n.colwidth=this.node.actualWidth,n.ht=Math.max(t.cell_ht,t.parent.height),this.el=DomUtil.createTD(n,!0,e);var i=J(this.el);if(i.data({nodeId:this.node.id,viewId:this.id}),e){var o=this.views,r=o&&o.first;if(this.el){for(;r;)r.createView(this.el.firstChild),node=r.node,PubSub.publish(node.type+"view/create",node),r=r.next;e.appendChild(this.el)}}},update:function(){var e=this.node,t=editor.doc.getThemeStyleFormatAt(e.getIndex());if(this.setMinHeight(t),this.isInVisiblePage()){var n=J(this.el);n.removeAttr("style"),n.removeAttr("rowspan"),n.removeAttr("colspan"),t.colwidth=this.node.actualWidth,t.ht=Math.max(e.cell_ht,e.parent.height),DomUtil.setCellStyle(this.el,t,!0)}},isInVisiblePage:function(){return!editor.isEditable()||!this.column||editor.visiblePageNumbers.contains(this.column.content.page.pageNumber)||this.node.section.name&&"content"!=this.node.section.name}});var RowView=function(e){this.id=randomId("row"),this.node=e,this.height=0,ViewManager.addViewDetails(this),this.type="row",this.views=new LinkedList};extend(RowView.prototype,{create:function(){},remove:function(){this.isInVisiblePage()?(J(this.el).remove(),"content"==this.node.section.name&&(this.column.content.page.isPageRendered=!0)):this.column.content.page.isPageRendered=!1},findSplitHeight:function(e,t){for(var n,i,o,r,a,s,l,d,c,u,p,h,f,m,g=ViewManager.getViewTop(this)+e,T=e,_=this.views.first,E=this.column,v=E.getPage(),S=!1;_;){for(l=v.getViewsFrom(_.views,"para"),n=0,r=l.length;n<r;n++){for(d=l[n],p=ViewManager.getViewTop(d),h=p,c=d.lines,i=0,a=c.length;i<a;i++)if(u=c[i],f=u.footNotes,s=f.length,h+=u.height,T<=0){if(!(h<=g)){S=!0;break}for(o=0;o<s;o++)E.addToOutGoingFootNotes(f[o].id,d,t)}else{if(h<=g){for(o=0;o<s&&(footNoteView=NoteViewCollection.getNoteViews(f[o].id)[0],m=footNoteView?footNoteView.getHeight():0,m<=T&&h<=g-m);o++)g-=m,e-=m,T=Math.min(g-h,T-m);if(o<s)for(T=0;o<s;o++)E.addToOutGoingFootNotes(f[o].id,d,t);continue}if(f.length){T=0,S=!0;break}}if(S){S=!1;break}}_=_.next}return e},split:function(e,t,n,i){var o,r=new RowView(this.node);r.create(),r.parent=i.parent;var a=t.addView(r);for(t.addDOMView(r,a),i.considerFootNotes&&(e=this.findSplitHeight(e,t)),o=this.views.first;o;){o.split(e,t,n,{parent:r,considerFootNotes:!1});o=o.next}return r},isEmptyRow:function(){for(var e=this.views.first,t=!0;e;){if(!e.views.isEmpty()){t=!1;break}e=e.next}return t},clearRow:function(){for(var e=[],t=this.views.first;t;)e.push(t),t=t.next;for(var n=0;n<e.length;n++)e[n].column.removeView(e[n]);this.column.removeView(this)},merge:function(e,t){for(var n,i=this.views.first;i;){for(n=e.views.first;n;)n.node.id==i.node.id&&i.merge(n,t),n=n.next;i=i.next}e.column.removeView(e)},setHeight:function(){},getHeight:function(){var e,t=0,n=23;if(!this.views.isEmpty())for(e=this.views.first;e;)t=Math.max(e.getHeight(),t),e=e.next;return Math.max(t,n)},getFootNoteHeight:function(){var e,t=0;if(!this.views.isEmpty())for(e=this.views.first;e;)t+=e.getFootNoteHeight(),e=e.next;return t},appendView:function(e){this.el.appendChild(e.el)},createView:function(e){var t,n;t=editor.doc.getRawFormatAt(this.node.getIndex()),this.el=DomUtil.createTR(t);var i=J(this.el);if(i.data("nodeId",this.node.id),e){for(var o=this.views,r=o&&o.first;r;)r.createView(this.el),n=r.node,PubSub.publish(n.type+"view/create",n),r=r.next;e.appendChild(this.el)}},update:function(){if(this.isInVisiblePage()){var e=editor.doc.getThemeStyleFormatAt(this.node.getIndex()),t=J(this.el);t.removeAttr("style"),t.removeAttr("class"),t.attr({class:"zw-tr"}),DomUtil.setRowStyle(this.el,e)}},isInVisiblePage:function(){return!editor.isEditable()||!this.column||editor.visiblePageNumbers.contains(this.column.content.page.pageNumber)||this.node.section.name&&"content"!=this.node.section.name;}});var TableView=function(e){this.id=randomId("table"),this.node=e,this.height=0,ViewManager.addViewDetails(this),this.type="table",this.rowStart=0,this.views=new LinkedList,this.rowsHeight=[]};extend(TableView.prototype,{create:function(){},remove:function(){this.isInVisiblePage()?(J(this.el).remove(),"content"==this.node.section.name&&(this.column.content.page.isPageRendered=!0)):this.column.content.page.isPageRendered=!1},addRow:function(){var e=document.createElement("tr"),t=document.createElement("td");e.appendChild(t),e.style.display="none",J(this.el).children("tbody:first").append(e)},addDummyRow:function(e){0!=e&&(this.addRow(),e%2==0&&this.addRow())},split:function(e,t,n,i){var o,r,a,s,l,d=0,c=-1;for(r=this.views.first,l=editor.doc.getRawFormatAt(this.node.getIndex())[ATTR_BODY.DS_THEME];r;){if(a=ViewManager.getViewHeight(r,i.considerFootNotes),c++,d+a>e){s=r;break}d+=a,r=r.next}if(s&&s.node.children.length===s.views.length){o=new TableView(this.node),o.create(),o.rowStart=c,i&&i.parent&&(o.parent=i.parent);var u=t.addView(o);t.addDOMView(o,u);for(s.split(e-d,t,n,{parent:o,tableTheme:l,childIdx:c+1,considerFootNotes:i.considerFootNotes});s.next;)t.moveView(s.next,n);o.views.isEmpty()||(o.views.first.isEmptyRow()?o.views.first.clearRow():s.isEmptyRow()&&n.removeView(s)),o.views&&!o.views.isEmpty()&&o.checkMerge(),o.isSplitTable=!0}else for(;this.next;)t.moveView(this.next,n);return o},checkMerge:function(){this.next&&this.column.viewMap[this.next.id]&&this.node.id==this.next.node.id&&this.merge(this.next,this.column),this.prev&&this.column.viewMap[this.prev.id]&&this.node.id==this.prev.node.id&&this.prev.merge(this.prev,this.column)},merge:function(e,t){var n,i,o,r=[];for(i=e.views.first,this.views.isEmpty()||e.views.isEmpty()||i.node.id!==this.views.last.node.id||this.views.last.merge(i,t),o=e.views.first;o;)r.push(o),o=o.next;for(n=0;n<r.length;n++)r[n].parent=this,t.moveView(r[n],r[n].column,!1);e.column.removeView(e)},setHeight:function(){},getHeight:function(){var e,t=0,n=this.node;if(!this.views.isEmpty())for(e=this.views.first;e;){var i=e.getHeight();t+=i,e=e.next}return t+=n.borderProperties[ATTR_BORDERS.BORDER_TOP]+n.borderProperties[ATTR_BORDERS.BORDER_BOTTOM],t!=this.height&&PubSub.publish("Document/TableStructureModified"),this.height=t,t},getFootNoteHeight:function(){var e,t=0;if(!this.views.isEmpty())for(e=this.views.first;e;)t+=e.getFootNoteHeight(),e=e.next;return t},update:function(){var e=editor.doc.getThemeStyleFormatAt(this.node.getIndex());J(this.el).removeAttr("style"),e=TableUtil.processTableWidth(this.node.getIndex(),e),TableThemeCSSGenerator.setStyleTag(e,this.node),DomUtil.setTableStyle(this.el,e,this.node),this.isSplitTable&&this.applyTopBorder()},adjustBorder:function(){var e=this.el;J(e).css({"border-collapse":""}),setTimeout(function(){J(e).css({"border-collapse":"collapse"})},10)},appendView:function(e){var t=J(this.el),n=t.children("tbody:first");J(n).append(e.el)},createView:function(e){var t,n,i;t=editor.doc.getRawFormatAt(this.node.getIndex()),t=TableUtil.processTableWidth(this.node.getIndex(),t),t=editor.doc.getThemeStyleFormatAt(this.node.getIndex()),this.el=DomUtil.createTable(t,this.node);var o=J(this.el);if(o.data({nodeId:this.node.id,viewId:this.id}),n=DomUtil.createTbody(),this.el.appendChild(n),o.attr({"data-node-id":this.node.id}),TableThemeCSSGenerator.setStyleTag(t,this.node),"SHAREDREADCOMMENT"!=editor.doc.getRole()&&"ANYONELINK_SHAREDREADCOMMENT"!=editor.doc.getRole()&&o.bind("mouseover",function(e){DomUtil.handleMouseOverForTable(e)}).bind("mouseout",function(e){DomUtil.handleMouseOutForTable(e)}),this.rowStart>0&&(this.addDummyRow(this.rowStart),this.applyTopBorder()),e){for(var r=this.views,a=r&&r.first;a;)a.createView(n),i=a.node,PubSub.publish(i.type+"view/create",i),a=a.next;e.appendChild(this.el)}},applyTopBorder:function(){if(this.isInVisiblePage()&&this.el){var e=this.el.className;if(e){e.split(" ")[1];if(this.node.theme.themeObj){var t=DTTableUtils.getTableTopBorder(this.node.theme.themeObj);J(this.el).css({"border-top":t})}}}},getRowsHeight:function(){for(var e=this.views,t=e.first,n=[],i=0;t;)n[i]={ht:t.getHeight()},i++,t=t.next;return n},getRowsHeight:function(){for(var e=this.views,t=e.first,n=[],i=0;t;)n[i]={ht:t.getHeight()},i++,t=t.next;return n},isInVisiblePage:function(){return!editor.isEditable()||!this.column||editor.visiblePageNumbers.contains(this.column.content.page.pageNumber)||this.node.section.name&&"content"!=this.node.section.name}});var HrView=function(e){this.id=randomId("hr"),this.node=e,this.height=0,ViewManager.addViewDetails(this),this.type="hr",this.views=new LinkedList,this.isPageBreak=!1,this.isColumnBreak=!1};extend(HrView.prototype,{create:function(){var e=editor.doc.getRawFormatAt(this.node.getIndex());this.isPageBreak=e&&"pgbrk"==e.cls,this.isColumnBreak=e&&"colbrk"==e.cls},remove:function(){this.isInVisiblePage()?(J(this.el).remove(),"content"==this.node.section.name&&(this.column.content.page.isPageRendered=!0)):this.column.content.page.isPageRendered=!1},split:function(e,t,n,i){if(!this.isPageBreakHr()&&this.getHeight()>e){var o=new HrView(this.node);o.create(),i&&i.parent&&(o.parent=i.parent),t.addView(o),n.removeView(this)}},isPageBreakHr:function(){return this.isPageBreak&&"cell"!=this.node.parent.type},isColumnBreakHr:function(){return this.isColumnBreak&&"cell"!=this.node.parent.type},getHeight:function(){return this.height=this.height||this.el&&this.el.offsetHeight||7,this.height},getFootNoteHeight:function(){var e=0;return e},update:function(){var e=editor.doc.getRawFormatAt(this.node.getIndex());DomUtil.setHRStyle(this.el,e)},createView:function(e,t){var n,i=void 0==t||t,o={};n=editor.doc.getRawFormatAt(this.node.getIndex()),this.el=DomUtil.createHR(i),J(this.el).data("nodeId",this.node.id),DomUtil.setHRStyle(this.el,n),o["margin-top"]="0px",o["margin-bottom"]="0px",this.isPageBreak=n&&"pgbrk"==n.cls,this.isColumnBreak=n&&"colbrk"==n.cls,this.isPageBreak||this.isColumnBreak||("HR"==this.el.tagName&&(o["border-width"]="1px 0px 0px 0px"),o["border-top"]="1px solid",o.height="2px"),J(this.el).css(o),e&&e.appendChild(this.el)},isInVisiblePage:function(){return!editor.isEditable()||!this.column||editor.visiblePageNumbers.contains(this.column.content.page.pageNumber)||this.node.section.name&&"content"!=this.node.section.name}});var TocView=function(e){this.id=randomId("toc"),this.node=e,this.height=0,ViewManager.addViewDetails(this),this.type="toc",this.isSplit=!1,this.views=new LinkedList};extend(TocView.prototype,{create:function(){},remove:function(){this.isInVisiblePage()?(J(this.el).remove(),"content"==this.node.section.name&&(this.column.content.page.isPageRendered=!0)):this.column.content.page.isPageRendered=!1},split:function(e,t,n,i){var o,r,a,s,l,d,c,u=40;for(a=this.views.first;a;){if(s=ViewManager.getViewHeight(a,i.considerFootNotes),u+s>e){l=a;break}u+=s,a=a.next}if(l){o=new TocView(this.node),o.isSplit=!0,o.create();var p=J(o.el);p.find("#zwTOCDiv,#tocClose,#tocRegenerate,#tocSettings").remove(),i&&i.parent&&(o.parent=i.parent);var h=t.addView(o);if(t.addDOMView(o,h),ViewManager.getViewHeight(l,i.considerFootNotes)>e-u){for(var f=l.split(e-u,t,n,{parent:o,considerFootNotes:i.considerFootNotes});l.next;)t.moveView(l.next,n);f&&0===ViewManager.getViewHeight(f,!0)&&t.removeView(f),0==ViewManager.getViewHeight(l,!0)&&n.removeView(l)}else if(l=l.prev)for(;l.next;)l.next.parent=o,t.moveView(l.next,n);else{for(d=[],c=this.views.first;c;)d.push(c),c=c.next;for(r=0;r<d.length;r++)d[r].parent=o,t.moveView(d[r],n)}o.checkMerge()}return o},checkMerge:function(){this.next&&this.column.viewMap[this.next.id]&&this.node.id==this.next.node.id&&this.merge(this.next,this.column),this.prev&&this.column.viewMap[this.prev.id]&&this.node.id==this.prev.node.id&&this.prev.merge(this.prev,this.column)},merge:function(e,t){var n,i,o,r=[];for(i=e.views.first,!this.views.isEmpty()&&i&&i.node.id===this.views.last.node.id&&this.views.last.merge(i,t),o=e.views.first;o;)r.push(o),o=o.next;for(n=0;n<r.length;n++)r[n].parent=this,t.moveView(r[n],r[n].column);e.column.removeView(e)},setHeight:function(){},getHeight:function(){var e,t=0;if(!this.views.isEmpty())for(e=this.views.first;e;)t+=e.getHeight(),e=e.next;return t&&this.prev&&"toc"!=this.prev.type&&(t+=42),t},getFootNoteHeight:function(){var e,t=0;if(!this.views.isEmpty())for(e=this.views.first;e;)t+=e.getFootNoteHeight(),e=e.next;return t},update:function(){},createView:function(e){var t,n=editor.doc.getRawFormatAt(this.node.getIndex());this.el=DomUtil.createTOC(n);var i=J(this.el);if(i.data("nodeId",this.node.id),e){for(var o=this.views,r=o&&o.first;r;)r.createView(this.el),t=r.node,PubSub.publish(t.type+"view/create",t),r=r.next;e.appendChild(this.el)}},appendView:function(e){this.el.appendChild(e.el)},isInVisiblePage:function(){return!editor.isEditable()||!this.column||editor.visiblePageNumbers.contains(this.column.content.page.pageNumber)||this.node.section.name&&"content"!=this.node.section.name}}),extend(NoteView.prototype,{create:function(){this.el=document.createElement("div"),this.el.className=this.className;var e=editor.clientActiveSection?editor.clientActiveSection.className.toLowerCase():"";e&&e.indexOf("zw-contentpane")===-1&&e.indexOf("zw-footnotepane")===-1&&e.indexOf("zw-endnotepane")===-1?J(this.el).addClass("unselectableSection"):J(this.el).addClass("selectableSection")},remove:function(){this.removeAllViews(),this.containingParaReference={},this.rangeElement=null,this.node=null,J(this.el).remove(),NoteViewCollection.updateNoteNumbers(this.type)},removeViewMapping:function(e){var t=this.viewMap[e.id];t&&(t.remove(e),delete this.viewMap[e.id])},removeView:function(e){if(e.views)for(;e.views.last;)this.removeView(e.views.last);this.removeViewMapping(e),ViewManager.removeViewDetails(e),e.remove()},removeAllViews:function(){for(;this.views.last;)this.removeView(this.views.last)},addView:function(e){return this.addViewTo(e,this.views,this)},addViewTo:function(e,t,n){var i,o,r,a,s,l,d=e.node,c=ViewManager.getViews(d);if(e.column=this.column,e.page=this.column.getPage(),"section"==d.parent.type){a=ViewManager.getViews(d);var u;for(l=0;l<a.length;l++)if(this.viewMap[a[l].id]){u=a[l];break}if(u)a=this.viewMap[u.id],u.prev?a.insertAfter(e,u):a.insertAsFirst(e),this.viewMap[e.id]=a;else if(d.prev){i=d.prev;do c=ViewManager.getViews(i),i=i.prev;while(i&&!c);r=lastElementOf(c),r&&this.viewMap[r.id]?(a=this.viewMap[r.id],a.insertAfter(e,r)):(a=t,a.insertAsFirst(e))}else a=t,a.insertAsFirst(e);this.viewMap[e.id]=a}else{if(o=d.parent,c=ViewManager.getViews(o),n=e.parent,!n)for(l=0;l<c.length;l++)if(this.viewMap[c[l].id]){n=c[l];break}if(s=n.views,d.prev){if("cell"==d.type)if(null!=s.last&&s.last.node.id==e.node.prev.id)r=s.last;else{var p=ViewManager.getViews(d.prev);p&&(r=p[0])}else{for(i=d.prev,c=ViewManager.getViews(i);!c&&i;)c=ViewManager.getViews(i),i=i.prev;r=lastElementOf(c)}r&&(a=this.viewMap[r.id]),a?a.insertAfter(e,r):(a=s,a.insertAsFirst(e)),this.viewMap[e.id]=a}else s.insertAsFirst(e),this.viewMap[e.id]=s;e.parent=n}return n},addDOMView:function(e,t){var n,i;e.isInVisiblePage()&&(n=e.prev,i=e.next,n&&n.el?(e.el||(e.createView(),NoteViewCollection.updateNoteNumbers(this.type)),J(e.el).insertAfter(n.el)):i&&i.el?(e.el||(e.createView(),NoteViewCollection.updateNoteNumbers(this.type)),i.removeNoteReferenceChar(),J(e.el).insertBefore(i.el)):t.el&&(e.el||(e.createView(),NoteViewCollection.updateNoteNumbers(this.type)),t.appendView(e)))},updateColumnofViews:function(e){if(e){if(e.column=this.column,e.page=this.column.getPage(),e.views){var t=e.views.first;this.updateColumnofViews(t)}this.updateColumnofViews(e.next)}},getHeight:function(){var e,t=0;if(!this.views.isEmpty())for(e=this.views.first;e;)t+=e.getHeight(),e=e.next;return t},getReferenceChar:function(){return this.referenceChar},getAllViewCount:function(){return Object.keys(this.viewMap).length},setRangeElement:function(e){var t=this.rangeElement;if(t){var n=J(t);J(e).append(n.children())}this.rangeElement=e},setContainingParaReference:function(e,t){this.containingParaReference.viewId=e,this.containingParaReference.nodeId=t},getContainingPara:function(){for(var e=ViewManager.getNodeById(this.containingParaReference.nodeId),t=null,n=ViewManager.getViews(e),i=0,o=n.length;i<o;i++)if(n[i].id===this.containingParaReference.viewId){t=n[i];break}return t},getRangeElement:function(){return this.rangeElement},updateNoteReferenceChar:function(){var e=({fid:this.node.sid,type:this.type},this.getReferenceChar()),t=CONST.ZERO_WIDTH_SPACE+"<div class='"+CONST.FIELD_TEXT_NODE+"'style='display:inline-block;font-size:inherit;'>"+e+"</div>";J(this.rangeElement).html(t).attr({fid:this.node.sid}).css({display:"inline-block"}).unbind("click").click(function(){Note.moveToSection(J(this).attr("fid"))});var n=this.views.first;n&&n.updateNoteReferenceChar(e)},isFirstView:function(e){return this.views.first==e},getFontString:function(){var e={type:"text",ff:"arial,helvetica,sans-serif",size:12,va:"super"},t=FontUtils.getFontString(e);return function(){return t}}(),appendView:function(e){this.el.appendChild(e.el)}}),EndNoteView.prototype=Object.create(NoteView.prototype),EndNoteView.prototype.constructor=EndNoteView,EndNoteView.prototype.remove=function(){NoteView.prototype.remove.call(this),this.column.endNoteViews.isEmpty()&&this.column.hideEndNote()},FootNoteView.prototype=Object.create(NoteView.prototype),FootNoteView.prototype.constructor=FootNoteView,FootNoteView.prototype.remove=function(){NoteView.prototype.remove.call(this),this.column.footNoteViews.isEmpty()&&J(this.column.footNote.container).hide()};var XFormMap=function(e){"use strict";var t=function(){this.map={}};return t.prototype.applyOp=function(e){if(!e||!e.length())return e;for(var t in this.map){var n=DocOpBuilder.xform(e,this.map[t]);this.map[t]=DocOpBuilder.concise(n.second)}},t.prototype.disableAutoUpdate=function(){PubSub.unsubscribe("Document/AfterModelUpdation",this.applyOp,{context:this})},t.prototype.enableAutoUpdate=function(){PubSub.subscribe("Document/AfterModelUpdation",this.applyOp,{context:this})},t.prototype.flushOp=function(e){this.map={}},t.prototype.getOp=function(e){return this.map[e]},t.prototype.putOp=function(e,t){this.map[t]=e},t.prototype.removeOp=function(e){delete this.map[e]},t}(),XFormStack=function(e){"use strict";var t=function(){};return t.prototype.forEach=Array.prototype.forEach,t.prototype.length=0,t.prototype.pushOp=Array.prototype.push,t.prototype.splice=Array.prototype.splice,t.prototype.applyOp=function(e){if(!e||!e.length())return e;this.forEach(function(t,n,i){var o=DocOpBuilder.xform(e,t);i[n]=DocOpBuilder.concise(o.second)})},t.prototype.disableAutoUpdate=function(){PubSub.unsubscribe("Document/AfterModelUpdation",this.applyOp,{context:this})},t.prototype.enableAutoUpdate=function(){PubSub.subscribe("Document/AfterModelUpdation",this.applyOp,{context:this})},t.prototype.flushOp=function(e){this.length=0},t.prototype.getOp=function(e){return this[e]},t.prototype.removeOp=function(e){this.splice(e,1)},t}();List.prevListmLFlag=0,List.prevListmL=0,List.listIds={},List.removeIds={},List.numberToAlpha=function(e){for(var t="",n=e;e>0;)n=e%26,e=parseInt(e/26),0==n&&(e-=1,n=26),t=String.fromCharCode(n+64)+t;return t},List.AlphatoNumber=function(e){var t,n,i=0;e=e.toUpperCase();var o=e.length-1;for(t=0;t<e.length;t++)n=e.charCodeAt(t)-64,t!=o&&(n*=Math.pow(26,o-t)),i+=n;return i},List.AlphatoRoman=function(e){e=e.toUpperCase();var t,n=e.replace("XL","XXXX"),i=n.replace("XC","LXXXX"),o=i.replace("CD","CCCC"),r=o.replace("CM","DCCCC"),a=r.replace("IV","IIII"),s=a.replace("IX","VIIII"),l=0,d=s.length,c=0;for(t=0;t<d;t++)l=s.charAt(t),"M"==l&&(c+=1e3),"D"==l&&(c+=500),"C"==l&&(c+=100),"L"==l&&(c+=50),"X"==l&&(c+=10),"V"==l&&(c+=5),"I"==l&&(c+=1);return c},List.numberToRoman=function(e,t,n,i,o,r){for(r=e/1e3|0,e%=1e3,t=n="",i=5;e;n++,i^=7)for(o=e%i,e=e/i^0;o--;)t="IVXLCDM".charAt(o>2?n+e-(e&=-2)+(o=1):n)+t;return Array(r+1).join("M")+t},List.getListNoByFormatInfo=function(e,t,n,i){var o=editor.doc.getListChar(e,t),r=editor.doc.getListType(e,t);if(n=List.getListNumber(r,n),o){for(var a=t-1;a>-1&&i;){if(o.indexOf(ListLevelNo[a])!=-1){var s=i[a];r=editor.doc.getListType(e,a),o=o.replace(ListLevelNo[a],List.getListNumber(r,s))}a--}n=o.replace(ListLevelNo[t],n)}else!o&&r<=4&&(n+=".");return n},List.getStartsWith=function(e,t,n){if(n){n.id,n.listLevel,n.levelInfo;if(isNaN(t))return t}var i;switch(e){case LIST_TYPE.NONE:i="";break;case LIST_TYPE.DECIMAL:i=t;break;case LIST_TYPE.LOWER_ALPHA:case LIST_TYPE.UPPER_ALPHA:var o=List.numberToAlpha(parseInt(t));i=e==LIST_TYPE.UPPER_ALPHA?o:o.toLowerCase();break;case LIST_TYPE.LOWER_ROMAN:case LIST_TYPE.UPPER_ROMAN:var r=List.numberToRoman(parseInt(t));i=e==LIST_TYPE.UPPER_ROMAN?r:r.toLowerCase();break;case 22:break;default:i=""}return i},List.fixedFromCharCode=function(e){return e>65535?(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e))):String.fromCharCode(e)},List.getListNumber=function(e,t,n,i){var o="";if(n){var r=n.id,a=n.listLevel;n.levelInfo;o=editor.doc.getListChar(r,a);for(var s,l=-1,d=0;(s=ListLevelNo[d++])&&(l=J.inArray(s,o),!(l>-1)););l==-1&&(o=null)}i||(i=!1);var c;switch(e){case LIST_TYPE.NONE:c="";break;case LIST_TYPE.DECIMAL:c=t;break;case LIST_TYPE.LOWER_ALPHA:case LIST_TYPE.UPPER_ALPHA:var u=List.numberToAlpha(parseInt(t));c=e==LIST_TYPE.UPPER_ALPHA?u:u.toLowerCase();break;case LIST_TYPE.LOWER_ROMAN:case LIST_TYPE.UPPER_ROMAN:var p=List.numberToRoman(parseInt(t));c=e==LIST_TYPE.UPPER_ROMAN?p:p.toLowerCase();break;case LIST_TYPE.DISC:c=List.fixedFromCharCode("0x25cf"),c="";break;case LIST_TYPE.CIRCLE:c=List.fixedFromCharCode("0x25cb"),c="";break;case LIST_TYPE.BOX:c=List.fixedFromCharCode("0x25a0"),c="";break;case 22:c=t>9?t:"0"+t;break;default:c=""}return e<=4&&!i&&(c+="."),o?List.getListNoByLevelInfo(o,t,n):c},List.getListNoByLevelInfo=function(e,t,n){n=DocUtil.copyStyle(n);for(var i=n.id,o=n.listLevel,r=n.levelInfo,a=editor.doc.getListType(i,o),s=o;s>-1&&r;){if(e.indexOf(ListLevelNo[s])!=-1){var l=r["level"+s];a=editor.doc.getListType(i,s),e=e.replace(ListLevelNo[s],List.getListNumber(a,l,null,!0))}s--}return e},List.getListType=function(e){switch(e){case"decimal":return LIST_TYPE.DECIMAL;case"lower-alpha":return LIST_TYPE.LOWER_ALPHA;case"upper-alpha":return LIST_TYPE.UPPER_ALPHA;case"lower-roman":return LIST_TYPE.LOWER_ROMAN;case"upper-roman":return LIST_TYPE.UPPER_ROMAN;case"disc":return LIST_TYPE.DISC;case"circle":return LIST_TYPE.CIRCLE;case"square":return LIST_TYPE.BOX;default:return 1}},List.getHTMLListType=function(e){switch(e){case LIST_TYPE.DECIMAL:return"decimal";case LIST_TYPE.LOWER_ALPHA:return"lower-alpha";case LIST_TYPE.UPPER_ALPHA:return"upper-alpha";case LIST_TYPE.LOWER_ROMAN:return"lower-roman";case LIST_TYPE.UPPER_ROMAN:return"upper-roman";case LIST_TYPE.DISC:return"disc";case LIST_TYPE.CIRCLE:return"circle";case LIST_TYPE.BOX:return"square";case LIST_TYPE.NONE:return"none"}},List.getNextListType=function(e){switch(e){case LIST_TYPE.DECIMAL:return LIST_TYPE.LOWER_ALPHA;case LIST_TYPE.LOWER_ALPHA:return LIST_TYPE.LOWER_ROMAN;case LIST_TYPE.LOWER_ROMAN:return LIST_TYPE.DECIMAL;case LIST_TYPE.UPPER_ROMAN:case LIST_TYPE.UPPER_ALPHA:return LIST_TYPE.LOWER_ROMAN;case LIST_TYPE.DISC:return LIST_TYPE.CIRCLE;case LIST_TYPE.CIRCLE:return LIST_TYPE.BOX;case LIST_TYPE.BOX:return LIST_TYPE.DISC;case LIST_TYPE.CHECKLIST:return LIST_TYPE.CHECKLIST;default:return LIST_TYPE.DISC}},List.getListLevels=function(e){if(LIST_STYLE_OBJECT.hasOwnProperty(e))return e;for(var t={},n=0;n<=8;n++)0!=n&&(e=List.getNextListType(e)),t["level"+n]={type:e,startsWith:1};return t},List.getListData=function(e){return e&&e.attr(ATTR_PARAGRAPH.PS_TYPE)?e&&"list"==e.attr(ATTR_PARAGRAPH.PS_TYPE)?(ls_data=e.attr(ATTR_PARAGRAPH.LS_DATA),ls_data.t=editor.doc.getListType(ls_data.id,ls_data.l),ls_data):void 0:null},List.updateListData=function(e,t,n,i,o){var r={},a=editor.doc.getHeadingListId();if(r[ATTR_PARAGRAPH.PS_TYPE]="list",r[ATTR_PARAGRAPH.LS_DATA]=e,"undefined"==typeof i&&(i=!0),"undefined"==typeof a||"undefined"!=typeof a&&e.id!=a)if(i&&e&&e.l>=0){if(r[ATTR_PARAGRAPH.PS_ML]=List.getMarginLeft(t,e.l,n),r[ATTR_PARAGRAPH.PS_TI]="-0.25in","list"!=t.attr(ATTR_PARAGRAPH.PS_TYPE)){0==List.prevListmLFlag&&"cell"!=t.parentNode().type?List.prevListmL=List.getMarginLeftOfLevelZero(t):List.prevListmL=.5;var s,l;if(l=List.RemoveTabSpaces(t),l>0?s=.5*l:(s=t.attr(ATTR_PARAGRAPH.PS_ML)||0,s="string"==typeof s?s.convertor().inches:s,s=void 0==s?0:s),s<=List.prevListmL){r[ATTR_PARAGRAPH.PS_ML]=List.prevListmL+"in";var d=0;r[ATTR_PARAGRAPH.LS_DATA].l=d}else level_change=parseInt(o/.5),s%.5==0?(s+=.5,d=s/.5-level_change,r[ATTR_PARAGRAPH.PS_ML]=s+"in",r[ATTR_PARAGRAPH.LS_DATA].l=d):(s=.5*(parseInt(s/.5)+1),d=s/.5-level_change,r[ATTR_PARAGRAPH.PS_ML]=s+"in",r[ATTR_PARAGRAPH.LS_DATA].l=d)}}else e&&e.l<0&&(List.removeIds["Id-"+e.id]=e.id,i&&(r[ATTR_PARAGRAPH.PS_ML]=List.getMarginLeft(t,e.l)),r[ATTR_PARAGRAPH.PS_TI]="0in");t.attr(r)},List.getMarginLeft=function(e,t,n){if(e){var i=e.attr(ATTR_PARAGRAPH.PS_ML)||0;if(i="string"==typeof i?i.convertor().inches:i,t>=0){var o=n?"indent"==n?.5:-.5:.5;isNaN(i)||0==i?i=(t+1)*o:i+=o}else i-=.5,i<0&&(i=0);return i+"in"}},List.getTextIndent=function(e,t){if(e){var n=parseFloat(e.attr(ATTR_PARAGRAPH.PS_TI));return isNaN(n)||e.attr(ATTR_PARAGRAPH.PS_TYPE)&&"list"==e.attr(ATTR_PARAGRAPH.PS_TYPE)?n=-.25:n+=-.25,n+"in"}},List.isSameLevel=function(e){for(var t,n=0;n<e.length;n++){var i=e[n],o=i.attr(ATTR_PARAGRAPH.PS_ML)||0;o="string"==typeof o?o.convertor().inches:o;var r=o>0?Math.floor(o/.5):0;if(t||(t=r),t!=r)return!1}return!0},List.createList=function(e,t,n){for(var i,o=!1,r=!1,a=List.getMinmL(t),s=0;s<t.length&&(r||"list"!=t[s].attr(ATTR_PARAGRAPH.PS_TYPE)||(r=!0),o||"list"==t[s].attr(ATTR_PARAGRAPH.PS_TYPE)||(o=!0),!o||!r);s++);if(e[ATTR_PARAGRAPH.PS_SB]=e[ATTR_PARAGRAPH.PS_SA]="0pt",List.createListFormat(e,n),n&&"hlist"==n[0])List.createHeadingList(e,t,n);else for(var l=List.isSameLevel(t),d=0;d<t.length;d++){var c=t[d];if(c.attr(ATTR_PARAGRAPH.PS_TYPE)&&"list"==c.attr(ATTR_PARAGRAPH.PS_TYPE)){var u=c.attr(ATTR_PARAGRAPH.LS_DATA),p=c.attr(ATTR_PARAGRAPH.PS_ML)||0;p="string"==typeof p?p.convertor().inches:p,r&&p%.25==0&&p%.5!=0&&(p+=.25),a%.25==0&&a%.5!=0&&(a-=.25);var h=a/.5,f=p>0?Math.floor(p/.5):0;f-=h,u.id=e.ls_data.id,e[ATTR_PARAGRAPH.LS_DATA]=u,e[ATTR_PARAGRAPH.PS_ML]=p+"in",e[ATTR_PARAGRAPH.LS_DATA].l=f-1}else{var u,m,g;c=t[d],i=editor.doc.getRawFormatAt(c.getStart()-1);var T=i.ps_type;if("list"==T){var s,_=d,E=e[ATTR_PARAGRAPH.LS_DATA].t;for(s=_;s<t.length;s++){if(c=t[d],d++,u=i.ls_data,m=u.id,u.t=editor.doc.getListType(u.id,u.l),0==u.l)if("string"==typeof i.ps_type&&"list"==i.ps_type&&i.ls_data.t==E){e[ATTR_PARAGRAPH.LS_DATA]=u,e[ATTR_PARAGRAPH.PS_TI]="-0.25in",g=List.RemoveTabSpaces(c);var v=i.ml;e[ATTR_PARAGRAPH.PS_ML]=v,e[ATTR_PARAGRAPH.LS_DATA].l=u.l}else List.createListFromTabs(e,c,n,l,a);else{var S=List.getLevelZeroType(u);if("string"==typeof i.ps_type&&"list"==i.ps_type&&S==E){e[ATTR_PARAGRAPH.LS_DATA]=u,e[ATTR_PARAGRAPH.PS_TI]="-0.25in",g=List.RemoveTabSpaces(c);var v=i.ml;e[ATTR_PARAGRAPH.PS_ML]=v}else List.createListFromTabs(e,c,n,l,a)}c.attr(e)}break}List.createListFromTabs(e,c,n,l,a)}c.attr(e)}},List.updateMarginLeftAndLevel=function(e,t,n){e[ATTR_PARAGRAPH.PS_ML]=t+"in",e[ATTR_PARAGRAPH.LS_DATA].l=n},List.createListFromTabs=function(e,t,n,i,o){e[ATTR_PARAGRAPH.PS_TI]="-0.25in";var r=t.attr(ATTR_PARAGRAPH.PS_ML)||0;r="string"==typeof r?r.convertor().inches:r,r<0&&(r=0);var a=0;if(0==o){if(a=List.RemoveTabSpaces(t),a>0)return r=.5*(a+1),level=parseInt(r/.5-1),void List.updateMarginLeftAndLevel(e,r,level);void 0==r&&(r=0),r%.5==0?(r+=.5,r>=4.5&&(r=4.5),level=parseInt(r/.5-1),List.updateMarginLeftAndLevel(e,r,level)):(r=.5*(parseInt(r/.5)+1),r>=4.5&&(r=4.5),level=parseInt(r/.5-1),List.updateMarginLeftAndLevel(e,r,level)),i||(e[ATTR_PARAGRAPH.LS_DATA].l=level)}else{o%.25==0&&o%.5!=0&&(o-=.25),o>=4.5&&(o=4.5);var s=parseInt(o/.5);if(a=List.RemoveTabSpaces(t),a>0)return r=.5*(a+1),r>=4.5&&(r=4.5),level=parseInt(r/.5-s-1),level<0&&(level=0),void List.updateMarginLeftAndLevel(e,r,level);void 0==r&&(r=0),r%.5==0?(r+=.5,r>=4.5&&(r=4.5),level=parseInt(r/.5-s-1),level<0&&(level=0),List.updateMarginLeftAndLevel(e,r,level)):(r=.5*(parseInt(r/.5)+1),r>=4.5&&(r=4.5),level=parseInt(r/.5-s-1),level<0&&(level=0),List.updateMarginLeftAndLevel(e,r,level)),i||(e[ATTR_PARAGRAPH.LS_DATA].l=level)}},List.RemoveTabSpaces=function(e){for(var t=0,n=e.getStart(),i=e.getEnd();"tab"==editor.doc.getRawFormatAt(n+t).st&&t<i;){var o=[{r:n+t},{ds:UNICODE.TAB}];Op.processMsg(o),t++}var r=7;return t>r?r:t},List.createHeadingList=function(e,t,n){for(var i=0;i<t.length;i++){var o,r=t[i],a=0,s=parseInt(r.attr(ATTR_PARAGRAPH.PS_HD));if(s&&s<=9){e[ATTR_PARAGRAPH.LS_DATA].l=s-1,a=e[ATTR_PARAGRAPH.LS_DATA].l;var l=n[1];l!=H_LIST_TYPE.LIST_STYLE?(o=0,e[ATTR_PARAGRAPH.PS_ML]=o+"in",e[ATTR_PARAGRAPH.PS_TI]="0in"):(o=.5*a,e[ATTR_PARAGRAPH.PS_ML]=o+"in",e[ATTR_PARAGRAPH.PS_TI]="0in")}else e[ATTR_PARAGRAPH.LS_DATA].l=0;r.attr(e)}},List.updateLevelStyles=function(e,t,n){var i=editor.doc.getListObj(e);if(i&&!(t<0)){DocUtil.constructRenderingFormat(n);var o=DocUtil.copyStyle(i);n.hasOwnProperty(ATTR_TEXT.TS_NULL)&&1==n[ATTR_TEXT.TS_NULL]?i["level"+t].paraFormat.textFormat={}:("text"==n.type?(delete n.type,i["level"+t].paraFormat||(i["level"+t].paraFormat={}),i["level"+t].paraFormat.textFormat=n):i["level"+t].paraFormat=n,i=Utils.mergeObjs([o,i])),Utils.addToStatistics("List-Sel-Styles-Updation"),List.setBodyFormat(e,i)}},List.updateLevelType=function(e,t,n){var i=editor.doc.getListObj(e);if(i){i["level"+t].type=n;var o="level"+t,r=LIST_STYLE_OBJECT[n][o].c;i["level"+t].c=r,List.setBodyFormat(e,i)}},List.updateListType=function(e,t){var n=List.getListLevels(t);List.setBodyFormat(e,n)},List.updateListPrefixAndSuffix=function(e){if(0!=e.length){var t,n=e[0],i=e[1],o=e[2],r=e[3],a=e[4],s=editor.doc.getListChar(n,i),l=editor.doc.getListObj(n),d=-1;if(void 0!=o&&null!=o||(o=""),void 0!=r&&null!=r||(r=""),a){for(var c=0;c<ListLevelNo.length;c++)t=o+ListLevelNo[c]+r,l["level"+c].c=t;List.setBodyFormat(n,l),Utils.addToStatistics("Prefix - Suffix Updation")}else for(var u,p=0;u=ListLevelNo[p++];)if(d=J.inArray(u,s),d>-1){t=o+ListLevelNo[i]+r,l["level"+i].c=t,List.setBodyFormat(n,l),Utils.addToStatistics("Prefix - Suffix Updation");break}}},List.updateLevelNumbering=function(e){if(0!=e.length){var t=e[0],n=e[1],i=e[2],o=editor.doc.getListObj(t);o["level"+n].startsWith=i,List.setBodyFormat(t,o)}},List.setBodyFormat=function(e,t){if("undefined"!=typeof e&&"undefined"!=typeof t){var n=editor.doc.getSelection().parents(NODE_TYPE.BODY),i={st:"listFormat"};i[""+e]=t,n.attr(i)}},List.init=function(e,t,n){if(t.length){List.prevListmLFlag=0,List.prevListmL=0;var i,o=!1,r=!1,a=!1,s=t[0];s.dtNode.paraProperties.isHeadingList&&(a=!0),s.dtNode.paraProperties.isHeading&&(r=!0),(a||r)&&(t=editor.doc.getSelection().getAllHeadings()),s=t[0];var l=List.getListData(s);if(l)var d=l.id;s=t[t.length-1];var c=List.getListData(s);if(c)var u=c.id;if(n&&n[0]){if("hlist"==n[0])return t=editor.doc.getSelection().getAllHeadings(),void List.createList(e,t,n);if("removeHeadingList"==n[0]){for(var p=0;p<t.length;p++)List.updateListData(e.ls_data,t[p]);return void List.updateTheme("remove")}}if(!l&&!c)return void List.createList(e,t,n);if(l&&c&&d==u&&e.ls_data.t==l.t&&!a&&(o=!0),o){var h=List.getListData(t[0]).id;i=!1;for(var f=0;f<t.length;f++){var s=t[f],m=List.getListData(s);if(!m||m&&m.id!=h){i=!0;break}}var g=editor.doc.getSelection();if(i||g.isListItemSelection){for(var T=List.getMinmL(t),f=0;f<t.length;f++){var s=t[f],m=List.getListData(s);m?m&&m.id!=h&&(m.id=l.id,e.ls_data=m,List.updateListData(e.ls_data,s,null,!1,T)):(e.ls_data=l,List.updateListData(e.ls_data,s,null,!0,T))}return}l.l=-1;for(var p=0;p<t.length;p++)List.updateListData(l,t[p])}else if(editor.doc.getSelection().isCollapsed()&&!a&&!r||editor.doc.getSelection().isListItemSelection){for(var s=t[0],_=DocTreeManager.doc.getSection(editor.doc.getSelection().getStart()).lists[List.getListData(s).id],E=!0,p=0;p<_.length;p++){var v=_[p].paraProperties.listData;if(0!=v.listLevel){E=!1;break}}E?List.updateListType(l.id,e.ls_data.t):List.updateLevelType(l.id,l.l,e.ls_data.t)}else{List.createListFormat(e);for(var T=List.getMinmL(t),f=0;f<t.length;f++){var S=!1,s=t[f],m=List.getListData(s);if(J.isEmptyObject(m))m=e.ls_data,S=!0;else if(0==m.l)0!=f&&(m.id=e.ls_data.id),e.ls_data.t!=m.t||a?m.id=e.ls_data.id:e.ls_data.id=m.id;else{var b=List.getLevelZeroType(m);e.ls_data.t==b?a?m.id=e.ls_data.id:e.ls_data.id=m.id:m.id=e.ls_data.id}a?List.updateListData(m,s,null,!0,T):List.updateListData(m,s,null,S,T)}}}},List.isSameType=function(e,t){return e==t},List.updateTheme=function(e,t){if(e){var n,i;if(e&&e[0]&&"hlist"==e[0]){var o=parseInt(e[1]);i=HLIST_TYPE[o],n=DocUtil.updateStylesForHeadingList(o,t.ls_data.id)}else e&&"remove"==e&&(n=DocUtil.getStylesWithoutHeadingList());var r=editor.doc.getSelection().parents(NODE_TYPE.BODY),a={};return a[ATTR_BODY.DS_STYLES]=n,r.attr(a),i?i:void 0}},List.createListFormat=function(e,t){if(e){var n;n=e.ls_data.t===LIST_TYPE.TOC_TYPE_1?HLIST_TYPE[17]:List.getListLevels(e.ls_data.t,e.ls_data.id),t&&(n=List.updateTheme(t,e)),List.setBodyFormat(e.ls_data.id,n)}},List.applyListStyle=function(e){var t={};t[ATTR_PARAGRAPH.PS_TYPE]="list",t[ATTR_PARAGRAPH.LS_DATA]={t:e,l:0,id:editor.doc.getNewListId()};var n;e==LIST_TYPE.DISC||e==LIST_TYPE.BOX||e==LIST_TYPE.CIRCLE||e==LIST_TYPE.NONE?(LIST_TYPE.RECENT_UNORDER=e,n="unorderedlist"):(LIST_TYPE.RECENT_ORDER=e,n="orderedlist"),editor.doc.execCmd(n,e)},List.getListParents=function(e){for(var t=e,n=[];t;)Utils.nodeNameEquals(t,"ul|ol")&&n.push(t),t=t.parentNode;return n.reverse()},List.hasHeadingList=function(){for(var e=DocUtil.getAllHeadings(),t=0;t<e.length;t++){var n=e[t];if("list"==n.attr(ATTR_PARAGRAPH.PS_TYPE)&&0==n.attr(ATTR_PARAGRAPH.LS_DATA).id)return!0}return!1},List.getChangedListLevel=function(e,t){var n=[];for(var i in e){var o=!U.isEqual(e[i],t[i]);o&&n.push(parseInt(i.substring(5)))}return n},List.getNonEmptyParas=function(e){var t,n=[],i=0,o=e.length;if(1===o)return e;for(i=0;i<o;i++)t=List.getListData(e[i]),(e[i].getEnd()-e[i].getStart()>1||!J.isEmptyObject(t)||"cell"==e[i].dtNode.parent.type)&&n.push(e[i]);return n},List.createNewList=function(e,t){var n={};n[ATTR_PARAGRAPH.PS_TYPE]="list",n[ATTR_PARAGRAPH.LS_DATA]={t:e,l:0,id:editor.doc.getNewListId()},e==LIST_TYPE.CHECKLIST?n[ATTR_PARAGRAPH.LS_DATA].state=0:t=List.getNonEmptyParas(t),List.init(n,t)},List.bullet_str=function(e,t){if("num"==t?t="1":"alphasml"==t?t="2":"alphacap"==t?t="3":"romansml"==t?t="4":"romancap"==t&&(t="5"),0==e)return e;var n="",i=0,o=new Array("IIII","V","XXXX","L","CCCC","D","MMMM");if(4==t||5==t){for(var r=0;r<o.length;r++){var a=o[r].length+1,s=e%a;n=o[r].substr(0,s)+n,e=(e-s)/a}n=n.replace(/DCCCC/g,"CM").replace(/CCCC/g,"CD").replace(/LXXXX/g,"XC"),n=n.replace(/XXXX/g,"XL").replace(/VIIII/g,"IX").replace(/IIII/g,"IV")}else if(2==t||3==t){do i=e%26,0==i&&(i=26,e-=1),n=String.fromCharCode(i+64)+n;while(0!=(e=parseInt(e/26)))}else 1==t&&(n=""+e);return 2==t||4==t?n.toLowerCase():n},List.indentFirstObject=function(e,t){var n={},i=editor.doc.getHeadingListId();if(n[ATTR_PARAGRAPH.PS_TYPE]="list",n[ATTR_PARAGRAPH.LS_DATA]=e,t.length||(t=new Array(t)),t.length)for(var o=0;o<t.length;o++){var r=t[o];if("undefined"==typeof i||"undefined"!=typeof i&&e.id!=i){if(e&&e.l>=0){var a=r.attr(ATTR_PARAGRAPH.PS_ML)||0;a="string"==typeof a?a.convertor().inches:a,a+=.25,n[ATTR_PARAGRAPH.PS_ML]=a+"in",n[ATTR_PARAGRAPH.PS_TI]="-0.25in"}}else if(i==e.id){var a=r.attr(ATTR_PARAGRAPH.PS_ML)||0;a="string"==typeof a?a.convertor().inches:a,a+=.5,n[ATTR_PARAGRAPH.PS_ML]=a+"in",n[ATTR_PARAGRAPH.PS_TI]="0in"}r.attr(n)}List.prevListmL=0,List.prevListmLFlag=0},List.outdentList=function(e,t){var n={},i=editor.doc.getHeadingListId();if(n[ATTR_PARAGRAPH.PS_TYPE]="list",n[ATTR_PARAGRAPH.LS_DATA]=e,t.length||(t=new Array(t)),t.length)for(var o=0;o<t.length;o++){var r=t[o];if("undefined"==typeof i||"undefined"!=typeof i&&e.id!=i){var a=r.attr(ATTR_PARAGRAPH.PS_ML)||0;a="string"==typeof a?a.convertor().inches:a,a-=.25,n[ATTR_PARAGRAPH.PS_ML]=a+"in",n[ATTR_PARAGRAPH.PS_TI]="-0.25in"}else if(i==e.id){var a=r.attr(ATTR_PARAGRAPH.PS_ML)||0;a="string"==typeof a?a.convertor().inches:a,a-=.5,n[ATTR_PARAGRAPH.PS_ML]=a+"in",n[ATTR_PARAGRAPH.PS_TI]="0in"}r.attr(n)}List.prevListmLFlag=0,List.prevListmL=0},List.getLevelZeroType=function(e){var t=0,n=editor.doc.getListType(e.id,t);return n},List.getMarginLeftOfLevelZero=function(e){var t,n,i,o,r=editor.doc.getRawFormatAt(e.getStart()-1),a=editor.doc.getParents(NODE_TYPE.PARAGRAPH,e.getEnd()+1);if("list"==r.ps_type)0==r.ls_data.l?n=r.ml:(i=r.ls_data.l,o=r.ml,o="string"==typeof o?o.convertor().inches:o,n=o-.5*i),t="string"==typeof n?n.convertor().inches:n;else{for(var s=DocTreeManager.doc.getSection(e.getEnd()),l=s.end;"list"!=a.attr(ATTR_PARAGRAPH.PS_TYPE)&&a.getEnd()<=l;)a=editor.doc.getParents(NODE_TYPE.PARAGRAPH,a.getEnd()+1);"list"==a.attr(ATTR_PARAGRAPH.PS_TYPE)&&(0==a.attr(ATTR_PARAGRAPH.LS_DATA).l?n=a.attr(ATTR_PARAGRAPH.PS_ML)||0:(i=a.attr(ATTR_PARAGRAPH.LS_DATA).l,o=a.attr(ATTR_PARAGRAPH.PS_ML)||0,o="string"==typeof o?o.convertor().inches:o,n=o-.5*i),t="string"==typeof n?n.convertor().inches:n)}return List.prevListmLFlag++,t||.5},List.getMinmL=function(e){for(var t,n,i,o=0,r=0,a=0;a<e.length;a++){i=e[a];for(var s=i.getStart(),l=i.getEnd(),r=0;"tab"==editor.doc.getRawFormatAt(s+r).st&&r<l;)o++,r++;o>0?n=.5*o:(n=e[a].attr(ATTR_PARAGRAPH.PS_ML)||0,n="string"==typeof n?n.convertor().inches:n),void 0==n&&(n=0),0==a&&(t=n),n<=t&&(t=n)}return void 0==t&&(t=0),t<0&&(t=0),t},List.getMinmLForHeadingList=function(){for(var e=0,t=0,n=editor.doc.getSelection().getAllHeadings(),i=0;i<n.length;i++)t=n[i].attr(ATTR_PARAGRAPH.PS_ML)||0,t="string"==typeof t?t.convertor().inches:t,t<=e&&(e=t);return e},List.getMinLevel=function(e){var t=0,n=0;if(void 0==DocTreeManager.doc.sections[0].lists[e])return 0;for(var i=DocTreeManager.doc.sections[0].lists[e].length,o=0;o<i;o++)t=DocTreeManager.doc.sections[0].lists[e][o].paraProperties.listData.listLevel,t<=n&&(n=t);return n},List.removeList=function(){var e=editor.doc.getSelection(),t=e.getNodesInSelection(NODE_TYPE.PARAGRAPH),n=List.getListData(t[0]);n.l=-1;for(var i=0;i<t.length;i++)List.updateListData(n,t[i]);var o=t[0].getStart(),r=editor.doc.createRange(o);e.isListItemSelection=!1,e.removeAllRanges().showCaret(r)},PageLayout.prototype={Paper:{A4:{Portrait:{height:{pixel:1122.24,inch:11.69,mm:parseFloat(296.926.toFixed(3))},width:{pixel:793.92,inch:8.27,mm:parseFloat((8.27*25.4).toFixed(3))}},Landscape:{height:{pixel:793.92,inch:8.27,mm:parseFloat((8.27*25.4).toFixed(3))},width:{pixel:1122.24,inch:11.69,mm:parseFloat(296.926.toFixed(3))}}},Letter:{Portrait:{height:{pixel:1056,inch:11,mm:parseFloat(279.4.toFixed(3))},width:{pixel:816,inch:8.5,mm:parseFloat((8.5*25.4).toFixed(3))}},Landscape:{height:{pixel:816,inch:8.5,mm:parseFloat((8.5*25.4).toFixed(3))},width:{pixel:1056,inch:11,mm:parseFloat(279.4.toFixed(3))}}},Legal:{Portrait:{height:{pixel:1344,inch:14,mm:parseFloat((14*25.4).toFixed(3))},width:{pixel:816,inch:8.5,mm:parseFloat((8.5*25.4).toFixed(3))}},Landscape:{height:{pixel:816,inch:8.5,mm:parseFloat((8.5*25.4).toFixed(3))},width:{pixel:1344,inch:14,mm:parseFloat((14*25.4).toFixed(3))}}},Executive:{Portrait:{height:{pixel:1008,inch:10.5,mm:parseFloat(266.7.toFixed(3))},width:{pixel:696,inch:7.25,mm:parseFloat((7.25*25.4).toFixed(3))}},Landscape:{height:{pixel:696,inch:7.25,mm:parseFloat((7.25*25.4).toFixed(3))},width:{pixel:1008,inch:10.5,mm:parseFloat(266.7.toFixed(3))}}},Envelope_10:{Portrait:{height:{pixel:912,inch:9.5,mm:parseFloat((9.5*25.4).toFixed(3))},width:{pixel:396,inch:4.125,mm:parseFloat((4.125*25.4).toFixed(3))}},Landscape:{height:{pixel:396,inch:4.125,mm:parseFloat((4.125*25.4).toFixed(3))},width:{pixel:912,inch:9.5,mm:parseFloat((9.5*25.4).toFixed(3))}}},Custom:{Portrait:{height:{pixel:1056,inch:11,mm:parseFloat(279.4.toFixed(3))},width:{pixel:816,inch:8.5,mm:parseFloat((8.5*25.4).toFixed(3))}},Landscape:{height:{pixel:816,inch:8.5,mm:parseFloat((8.5*25.4).toFixed(3))},width:{pixel:1056,inch:11,mm:parseFloat(279.4.toFixed(3))}}},Tabloid:{Portrait:{height:{pixel:1632,inch:17,mm:parseFloat((17*25.4).toFixed(3))},width:{pixel:1056,inch:11,mm:parseFloat(279.4.toFixed(3))}},Landscape:{height:{pixel:1056,inch:11,mm:parseFloat(279.4.toFixed(3))},width:{pixel:1632,inch:17,mm:parseFloat((17*25.4).toFixed(3))}}},Statement:{Portrait:{height:{pixel:816,inch:8.5,mm:parseFloat((8.5*25.4).toFixed(3))},width:{pixel:528,inch:5.5,mm:parseFloat(139.7.toFixed(3))}},Landscape:{height:{pixel:528,inch:5.5,mm:parseFloat(139.7.toFixed(3))},width:{pixel:816,inch:8.5,mm:parseFloat((8.5*25.4).toFixed(3))}}},Folio:{Portrait:{height:{pixel:1248,inch:13,mm:parseFloat(330.2.toFixed(3))},width:{pixel:768,inch:8,mm:parseFloat(203.2.toFixed(3))}},Landscape:{height:{pixel:768,inch:8,mm:parseFloat(203.2.toFixed(3))},width:{pixel:1248,inch:13,mm:parseFloat(330.2.toFixed(3))}}},A3:{Portrait:{height:{pixel:1587.84,inch:16.54,mm:parseFloat((16.54*25.4).toFixed(3))},width:{pixel:1122.24,inch:11.69,mm:parseFloat(296.926.toFixed(3))}},Landscape:{height:{pixel:1122.24,inch:11.69,mm:parseFloat(296.926.toFixed(3))},width:{pixel:1587.84,inch:16.54,mm:parseFloat((16.54*25.4).toFixed(3))}}},A5:{Portrait:{height:{pixel:793.92,inch:8.27,mm:parseFloat((8.27*25.4).toFixed(3))},width:{pixel:5.83*96,inch:5.83,mm:parseFloat(148.082.toFixed(3))}},Landscape:{height:{pixel:5.83*96,inch:5.83,mm:parseFloat(148.082.toFixed(3))},width:{pixel:793.92,inch:8.27,mm:parseFloat((8.27*25.4).toFixed(3))}}},B4:{Portrait:{height:{pixel:1375.68,inch:14.33,mm:parseFloat((14.33*25.4).toFixed(3))},width:{pixel:971.52,inch:10.12,mm:parseFloat((10.12*25.4).toFixed(3))}},Landscape:{height:{pixel:971.52,inch:10.12,mm:parseFloat((10.12*25.4).toFixed(3))},width:{pixel:1375.68,inch:14.33,mm:parseFloat((14.33*25.4).toFixed(3))}}},B5:{Portrait:{height:{pixel:971.52,inch:10.12,mm:parseFloat((10.12*25.4).toFixed(3))},width:{pixel:7.17*96,inch:7.17,mm:parseFloat(182.118.toFixed(3))}},Landscape:{height:{pixel:7.17*96,inch:7.17,mm:parseFloat(182.118.toFixed(3))},width:{pixel:971.52,inch:10.12,mm:parseFloat((10.12*25.4).toFixed(3))}}}}},PageLayout.prototype.getPaperSize=function(e,t,n){"undefined"!=typeof n&&"Inches"!=n&&"in"!=n||(n="inch");var i=PageLayout.Paper,o=editor.doc.getBodyFormat(),r=o[ATTR_BODY.DS_OR];e=parseFloat(e||i.Letter[r].width.unit).toFixed(3),t=parseFloat(t||i.Letter[r].height.unit).toFixed(3);for(var a in i){var s=i[a],l=s[r].width[n].toFixed(3),d=s[r].height[n].toFixed(3);if(l==e&&d==t||l==t&&d==e)return a}return"Custom"},PageLayout.prototype.getBodyHeight=function(e){var t=editor.doc.getBodyFormat(),n=Conversions.toGlobalUnit(t[ATTR_BODY.DS_PH])+w_usersettings[ATTR_BODY.DS_UN];return n="in"==w_usersettings[ATTR_BODY.DS_UN]?Conversions.inchToPx(n):Conversions.mmToPx(n),e||(n-=t[ATTR_BODY.DS_MT].convertor().pixels+t[ATTR_BODY.DS_MB].convertor().pixels),n},PageLayout.prototype.getBodyHeight=function(e){var t=editor.doc.getBodyFormat(),n=Conversions.toGlobalUnit(t[ATTR_BODY.DS_PH])+w_usersettings[ATTR_BODY.DS_UN];return n="in"==w_usersettings[ATTR_BODY.DS_UN]?Conversions.inchToPx(n):Conversions.mmToPx(n),e||(n-=t[ATTR_BODY.DS_MT].convertor().pixels+t[ATTR_BODY.DS_MB].convertor().pixels),n},PageLayout=new PageLayout,PUtil.containsOffset=function(e,t){var n=PUtil.offsetTop(e),i=PUtil.offsetHeight(e);return n<t&&t<i+n},PUtil.nodeCompare=function(e,t){var n=PUtil.offsetTop(e);return PUtil.containsOffset(e,t)?0:n<t?-1:1},PUtil.getElementAtOffset=function(e,t){var n=J(e).contents().not("[nodeType=8], #"+CONST.PG_SPLIT_LAYER+", ."+CONST.PG_SPLIT_NODE+", #"+CONST.FTR_LAYER+", #"+CONST.FN_LAYER+", #"+CONST.HDR_LAYER);if(0==n.length||Utils.nodeNameEquals(e,"#text"))return e;var i=Utils.binarySearch(n,PUtil.nodeCompare,t);return null===i?e:3==i.nodeType?i:PUtil.getElementAtOffset(i,t)},PUtil.insertBefore=function(e,t){if(e&&t){var n=t.parentNode;n&&n.insertBefore(e,t)}},PUtil.getMargin=function(){var e=editor.doc.getBodyFormat(),t=0,n=0;return t=e[ATTR_BODY.DS_MT],t=parseFloat(t.convertor().pixels)+29+"px",n=e[ATTR_BODY.DS_MB],n=parseFloat(n.convertor().pixels)+29+"px",{top:t,right:e[ATTR_BODY.DS_MR],bottom:n,left:e[ATTR_BODY.DS_ML]}},PUtil.offsetHeight=function(e){if(null==e)return 0;var t,n=J(e).parents("div.zw-page"),i=!0;Utils.isEditableMode()&&(t=n.children("div.zw-contentpane"),i=t.is(":visible"));var o=0;if(i||t.show(),3==e.nodeType){var r=J(document.createElement("span")).html(CONST.ZERO_WIDTH_SPACE).get(0);null==e.parentNode&&(o=e.offsetHeight),PUtil.insertBefore(r,e);var a=PUtil.offsetTop(r),s=e.nextSibling;null==s&&e.parentNode.appendChild(r),PUtil.insertBefore(r,s);var l=PUtil.offsetTop(r);o=l-a+r.offsetHeight,J(r).remove()}else if("br"==e.nodeName.toLowerCase()||"span"==e.nodeName.toLowerCase()&&Utils.isEmpty(e)){var r=J(document.createElement("span")).html(CONST.ZERO_WIDTH_SPACE)[0];J(e).before(r),o=e.offsetHeight,J(r).remove()}else o=e.offsetHeight;return i||t.hide(),o},PUtil._offset=function(e){var t=0,n=0;if(null==e)return{top:n,left:t};n=e.offsetTop;var i=editor.jeditorPane[0];for(t=e.offsetLeft+editor.jeditorPane.offset().left+Z("ui-editor-outer-div").scrollLeft(),e=e.offsetParent;e&&e!=i;)n+=e.offsetTop,t+=e.offsetLeft,e=e.offsetParent;return{top:n,left:t}},PUtil.offset=function(e){if(null==e)return 0;var t,n=J(e).parents("div.zw-page"),i=!0;Utils.isEditableMode()&&(t=n.children("div.zw-contentpane"),i=t.is(":visible"));var o={};if(i||t.show(),3==e.nodeType||3!=e.nodeType&&!PUtil.offsetHeight(e)){var r=J(document.createElement("span")).html(CONST.ZERO_WIDTH_SPACE)[0];null==e.parentNode&&(o={top:e.offsetTop,left:e.offsetLeft}),PUtil.insertBefore(r,e),o=PUtil._offset(r),J(r).remove()}else o=PUtil._offset(e);return i||t.hide(),o},PUtil._offsetWidth=function(e,t){var n=0;if(null==e)return n;n=e.offsetWidth;t?t:editor.jeditorPane[0];return e=e.offsetParent,n},PUtil._offsetTop=function(e,t){var n=0;if(null==e)return n;n=e.offsetTop;var i=t?t:editor.jeditorPane[0];for(e=e.offsetParent;e&&e!=i;)n+=e.offsetTop,e=e.offsetParent;return n},PUtil.offsetWidth=function(e,t){if(null==e)return 0;var n,i=J(e).parents("div.zw-page"),o=!0;Utils.isEditableMode()&&(n=i.children("div.zw-contentpane"),o=n.is(":visible"));var r=0;if(o||n.show(),3==e.nodeType){var a=J(document.createElement("span")).html(CONST.ZERO_WIDTH_SPACE)[0];null==e.parentNode&&(offsetTop=e.offsetTop),PUtil.insertBefore(a,e);var s=PUtil._offsetTop(a,t);J(a).remove(),offsetTop=s}else r=PUtil._offsetWidth(e,t);return o||n.hide(),r},PUtil.offsetTop=function(e,t){if(null==e)return 0;var n,i=J(e).parents("div.zw-page"),o=!0;Utils.isEditableMode()&&(n=i.children("div.zw-contentpane"),o=n.is(":visible"));var r=0;if(o||n.show(),3==e.nodeType){var a=J(document.createElement("span")).html(CONST.ZERO_WIDTH_SPACE)[0];null==e.parentNode&&(r=e.offsetTop),PUtil.insertBefore(a,e);var s=PUtil._offsetTop(a,t);J(a).remove(),r=s}else r=PUtil._offsetTop(e,t);return o||n.hide(),r},PUtil._offsetLeft=function(e,t){var n=0;if(null==e)return n;n=e.offsetLeft;var i=t?t:editor.jeditorPane[0];for(e=e.offsetParent;e&&e!=i;)n+=e.offsetLeft,e=e.offsetParent;return n},PUtil.offsetLeft=function(e,t){if(null==e)return 0;var n,i=J(e).parents("div.zw-page"),o=!0;Utils.isEditableMode()&&(n=i.children("div.zw-contentpane"),o=n.is(":visible"));var r=0;if(o||n.show(),3==e.nodeType){var a=J(document.createElement("span")).html(CONST.ZERO_WIDTH_SPACE)[0];null==e.parentNode&&(r=e.offsetLeft),PUtil.insertBefore(a,e);var s=PUtil._offsetLeft(a);J(a).remove(),r=s}else r=PUtil._offsetLeft(e,t);return o||n.hide(),r},TabHandler=function(){},TabHandler={grayArea:0,def_pt_len:0,editorPaneOffset:null,defaultTabPoints:null,bodyRight:null,paddingLeft:null,defaultListTabPoints:[],paddingRight:null},TabHandler.updateDefaultValues=function(){var e=(editor.jeditorPane.css("padding-right"),editor.doc.bodyFormat);TabHandler.def_pt_len=Conversions.toGlobalUnit(e[ATTR_BODY.DS_TPS]),TabHandler.bodyRight=e[ATTR_BODY.DS_PW].convertor().pixels,TabHandler.paddingLeft=e[ATTR_BODY.DS_ML].convertor().pixels,TabHandler.paddingRight=e[ATTR_BODY.DS_MR].convertor().pixels,TabHandler.defaultTabPoints=TabHandler.getDefaultTabPoints(TabHandler.def_pt_len)},TabHandler.arrangeTabPoints=function(e){var t=e.length;for(k=0;k<t;k++)for(j=t-1;j>k;j--)if(e[j-1].value>e[j].value){var n=e[j-1];e[j-1]=e[j],e[j]=n}},TabHandler.getTabPoints=function(e){var t,n,i,o,r=[];if(e&&e[ATTR_PARAGRAPH.PS_TPS]&&(t=e[ATTR_PARAGRAPH.PS_TPS]),e&&e[ATTR_PARAGRAPH.PS_PL]&&(n=e[ATTR_PARAGRAPH.PS_PL]),e&&e[ATTR_PARAGRAPH.PS_ML]&&(i=e[ATTR_PARAGRAPH.PS_ML]),e&&e[ATTR_PARAGRAPH.PS_TI]&&(o=e[ATTR_PARAGRAPH.PS_TI]),t&&"object"==typeof t)for(var a=t.length,s=0;s<a;s++){var l=Conversions.toGlobalUnit(t[s].point)*Conversions.globalUnitInPx+TabHandler.paddingLeft+TabHandler.grayArea;r[s]={value:l,align:t[s].align,style:t[s].leader}}if(Conversions.toGlobalUnit(o)*Conversions.globalUnitInPx<0){var d=Conversions.toGlobalUnit(i)*Conversions.globalUnitInPx;n&&(d+=Conversions.toGlobalUnit(n)*Conversions.globalUnitInPx);var c={value:d+TabHandler.paddingLeft+TabHandler.grayArea,align:0,style:0};r.push(c)}TabHandler.arrangeTabPoints(r);var u=TabHandler.defaultTabPoints,p=r.length;if(p>0){u=[];for(var h=0;h<p;h++)u[h]=r[h].value;var f=Math.max.apply(Math,u);u=r,p=TabHandler.defaultTabPoints.length;for(var h=0;h<p;h++){var d=TabHandler.defaultTabPoints[h];d.value>f&&u.push(d)}}return delete r,u},TabHandler.getDefaultTabPoints=function(e){var t=[];if(e<=0)return t;for(var n=TabHandler.paddingLeft+TabHandler.grayArea,i=(TabHandler.paddingRight,e*Conversions.globalUnitInPx),o=TabHandler.bodyRight;n+i<o;)n+=i,t.push({value:n,align:"0",style:"0"});return t},TabHandler.getNextTabPoint=function(e){for(var t=J(e).position().left,n=TabHandler.tabPoints.length,i=0;i<n;i++){var o=TabHandler.tabPoints[i];if(parseInt(o.value)>t)return o}},TabHandler.getParentBlock=function(e){for(var t=e.parentNode;t;){var n=J(t.parentNode).is(":hidden");if(!n)break;t=t.parentNode}return t},TabHandler.getLeaderStyle=function(e){var t="";return"1"==e?t="1px dotted #000000":"2"==e||"5"==e?t="1px dashed #000000":"3"!=e&&"4"!=e||(t="1px solid #000000"),t},TabHandler.updateDefaultListTabWidth=function(){TabHandler.defaultListTabPoints=TabHandler.getDefaultTabPoints(.5)},TimerUtil=function(){var e=Array.prototype.slice,t=function(t,n){var i=e.call(arguments,2);return setTimeout(function(){return t.apply(t,i)},n)},n=function(e,t,i,o){t.call(e)?i.call(o):setTimeout(function(){n(e,t,i,o)},10)};return{throttleAndQueue:function(i,o,r){var a,s=[],l=function(){var d=this;s.length?(a=!0,t(function(){var t=s.pop(),o=t[0];i.apply(o,e.call(t,1)),r?n(o,r,l,d):l()},o)):a=!1};return function(){var t=this;s.push([t].concat(e.apply(arguments))),a||l()}}}}(),WordComplete=function(){var e,t,n={},i="",o=!1,r=function(){var e=editor.doc.getSelection().getWord();return e.getEnd()==editor.doc.getSelection().getStart()?editor.doc.contStr.substring(e.getStart(),e.getEnd()):null},a=function(){var t=editor.doc.getSelection(),n=t.getLastRange(),r=n&&n.getStartPortionData(),a=r&&r.node;e=J(document.createElement("span")).css({color:"grey",border:"1px dashed black","font-size":"inherit"}).text(i),DomUtil.placeNode(a.firstChild,r.cursorPos,e[0]),o=!0,t.removeAllRanges().showCaret(editor.doc.createRange(n.start))},s=function(){i="",o=!1},l=function(){t=J("#editorpane")},d=function(e){var t,i,o,r,a,s;for(e=e.toLowerCase(),t=e.split(""),o=n,a=0,s=t.length;a<s;a++)i=t[a],r=o[i],null==r&&(o[i]={}),a==s-1&&(o[i].end=1),o=o[i]},c=function(){if(!(editor.doc.collabUsers.length>0)&&parseInt(w_usersettings[ATTR_BODY.DS_AUTOCOMPLETE])){s();var e=r();if(e&&!(e.length<3)){var t,o,l,d;for(d=n,t=0;t<e.length;t++){if(o=e[t],l=d[o],!l)return;d=l}if(d.end)for(o in d)"end"!==o&&(i=o,d=d[o]);for(;!d.end;)for(o in d){i+=o,d=d[o];break}i&&a(i)}}},u=function(){editor.addChar(i),s()},p=function(){e&&J(e).remove(),s()},h=function(){return o};return{init:l,addWord:d,lookupWord:c,insertSuggestion:u,removeSuggestion:p,isSuggestionShown:h,dict:n}}(),WC=function(e){var t=e.TABLE+"|"+e.TABLEEND+"|"+e.ROW+"|"+e.CELL+"|"+e.BR+"|"+e.TAB+"|"+e.IMAGE+"|"+e.RANGE_START+"|"+e.RANGE_END+"|"+e.SECTION_START+"|"+e.HR+"|"+e.TOCSTART+"|"+e.TOCEND,n=t+"|"+e.PARA,i=n+"|"+e.SPACE+"|"+e.MULTIBYTE_SPACE,o=function(){var e={},t=editor.doc.getSectionContent(0);e.wordcount=a(t),e.charCountWithSpaces=s(t),e.charCountWithoutSpaces=l(t);var n=editor.doc.getSelection().getStart();if(editor.doc.getSelection().isCollapsed()||0!=editor.doc.getSectionStart(n))e.sel_wordcount=0,e.sel_charcount_withspaces=0,e.sel_charcount_withoutspaces=0;else{var i=editor.doc.getSelection().getEnd(),t=editor.doc.getContent(n,i);e.sel_wordcount=a(t),e.sel_charcount_withspaces=s(t),e.sel_charcount_withoutspaces=l(t)}return e},r=function(e){return e=e.replace(/\xa0/," "),e=e.replace(/\s{2,}/g," "),e=e.replace(/^\s+/,""),e=e.replace(/\s+$/,"")},a=function(e){var n=RegExp(t,"g");e=e.replace(n,""),e=r(e);var i=e.split(/\s+/g),o=i.length;return""==i[o-1]&&0!=o&&o--,""==i[0]&&0!=o&&o--,o},s=function(e){var t=RegExp(n,"g"),i=e.replace(t,""),o=i.length;return o},l=function(e){var t=RegExp(i,"g"),n=e.replace(t,""),o=n.length;return o};return{getWordCountDetails:o}}(UNICODE),ZWOffline.newDocContent={content:"\n\n\n",defaults:{autolink:"0",colsp:"0.5in",AUDIO:"1",bannerver:"0.9",type:"body",hideruler:"false",smarttoolbar:"0",savver:"1",autocaps:"0",splang:"locale",mb:"1in",SOUNDPREF:"xylo",bgc:"rgb(255, 255, 255)",pasteOptions:"0",ml:"1in",inspl:"true",ds_pref:"1",comm:"1",pgbrk:"1",mr:"1in",mt:"1in",or:"Portrait",theme:{style:{},color:{},font:{h5:{textFormat:{fw:"bold",size:"11"}},h4:{textFormat:{fw:"bold",size:"12"}},h7:{textFormat:{fs:"italic"}},h6:{textFormat:{fw:"bold",size:"10"}},h1:{textFormat:{fw:"bold",size:"24"}},h0:{textFormat:{ff:"arial,helvetica,sans-serif",size:11},ls:"1.2",dir:"ltr"},h3:{textFormat:{fw:"bold",size:"14"}},h2:{textFormat:{fw:"bold",size:"18"}}}},autolist:"1",un:"in",autocorrects:"{}",SORTBY:"LastModified",pw:"8.5in",view:"Normal View",ph:"11in",cc:"1",ps:"Letter",tps:"1in"},sections:[{sid:1,hftype:1,st:1,si:"1"},{sid:3,hftype:3,st:3,si:"3"}],rev:0,styles:[{sid:"main",type:"section"},{type:"paragraph"},{sid:1,hftype:1,st:1,type:"section"},{type:"paragraph"},{sid:3,hftype:3,st:3,type:"section"},{type:"paragraph"}],ver:1},ZWOffline.newDocInfo={AUTHOR:"Unknown",LAST_MODIFIED_TIME:"0",PERMISSION:"false",AUTHOR_HTML:"Unknown",RID:"",STATUS:"0",EMAIL_NOTICATION:"false",AUTHOR_ZUID:"0",CREATED_DATE:"",CATEGORY:"TRASHED",CO_OWNER:"false",VERSION:1,REVISION:0,CREATED_DATE_LONG:1392288758838,newDoc:!0,DOCUMENT_NAME:"Untitled",AUTHOR_JS:"Unknown",LASTMODIFIEDBY_ZUID:"0",COLLAB_ID:"0",NOTIFY_RULE:"3",LASTMODIFIEDBY:"Unknown",DOCUMENT_NAME_HTML:"Untitled",DOCUMENT_ID:"0",DOCUMENT_NAME_URL:"",LAST_MODIFIED_TIME_LONG:1392288758838,DOCUMENT_NAME_JS:"Untitledt"},ZWOffline.getNewDocumentContent=function(){var e={};return e.docContent=ZWOffline.newDocContent,e.docInfo=ZWOffline.newDocInfo,e.ver=ZWOffline.newDocInfo.VERSION,e.rev=ZWOffline.newDocInfo.REVISION,e},ZWOffline.readOnly=function(){try{var e=J("#banner-temp-offline-cont"),t=J("#banner-temp-offline-txt");if(editor.setEditable(!1),editor.isOffline()?e.hide():editor.setOffline(!0),editor.removeDOMCursor(),J("#topband-savestatus").hide(),0===J("#readOnlyModeMsg").length){var n="<span class='ui-znotifier-message'><span class='ui-components-icon ui-state-info-icon'></span><span id='readOnlyModeMsg'>"+J.i18n("writer.common.OFFLINE_SAMEDOCOPENED_INANOTHERTAB")+"</span></span>";e.show(),t.html(""),t.attr("style","border:1px;color:rgb(0,0,0)"),t.append(n)}}catch(e){}},ZWOffline.removeCollaboratorCursors=function(){for(var e in editor.doc.domCursor)e!==editor.uuid&&(DomUtil.removeCursorNode(e,"start"),DomUtil.removeCursorNode(e,"end"))},ZWOffline.disableOnlineFeatures=function(){Utils.log("Offline Enabled"),editor.setOffline(!0),ZWOffline.removeCollaboratorCursors(),window.localStorage.setItem("ZW_"+ZWOffline.RID,"locked");var e={"background-color":"#FFD6BE",border:"1px solid #FF4F4C",color:"#EE2A2A"};UIUtils.showBanner(J.i18n("writer.common.OFFLINEMODE"),e),ZWOffline.toggleDisableList("disable")},ZWOffline.toggleDisableList=function(e){for(var t=["#filemenu-newdoc","#filemenu-newfromtemplate","#filemenu-recentdocs","#filemenu-uploadfile","#filemenu-saveas","#filemenu-export","#filemenu-saveastemplate","#filemenu-marknewversion","#filemenu-viewhistory","#filemenu-shareinvite","#filemenu-publish","#filemenu-print","#fmt-lpnl-cut","#fmt-lpnl-copy","#fmt-lpnl-paste","#fmt-lpnl-quickbtn","#fmt-lpnl-setfontdefault","#ins-lpnl-img","#ins-lpnl-embed","#ins-lpnl-object","#ins-lpnl-equation","#ins-lpnl-shapes","#ins-lpnl-txtbox","#ins-lpnl-cmnt","#smarttoolbar-addcomment-btn","#microtool-img","#microtool-cmt","#inlineinsert-img","#inlineinsert-cmt","#ins_insertimage","#contentHeadingCustomize","#review-tb-tcswitch-outer","#review-tb-tcallmarkup","#review-tb-usercolor","#review-tb-showcomment","#review-tb-showhistory","#review-tb-lock","#review-tb-follow","#review-tb-emailcollab","#review-tb-collablist","#review-tb-pausecollab","#complete-tb-markasfinal","#complete-tb-publish","#complete-tb-email","#complete-tb-mailmerge","#complete-tb-digisign","#complete-tb-download"],n="#topband-savestatus,#topband-settings,#topband-info,#topband-userinfo,#menu-tools-parent,#page-lpnl-default,#autocorrect_in_splchar,#bbar-chat,#bbar-spellcheck,#cell-img-container,#tbl-img-container,#moreOptions,#collaboratorPanelDiv,#li-review-tab-header,#ztab_changes,#watermark-div,#bbar-tcswitch-outer",i=0;i<t.length;i++)J(t[i])[e]();"disable"===e?(J(n).hide(),CommentManager.enableOfflineMode()):(J(n).show(),CommentManager.disableOfflineMode())},ZWOffline.enableOnlineFeatures=function(){editor.setOffline(!1),window.localStorage.removeItem("ZW_"+ZWOffline.RID),UIUtils.hideBanner(),ZWOffline.toggleDisableList("enable")},ZWOffline.networkUp=function(){ZWCollaboration.LASTREQUEST_TIMESTAMP=(new Date).getTime(),editor.isOffline()&&ZWOffline.enableOnlineFeatures(),ZWOffline.isSyncing=!0,ZWCollaboration.msgQueue.msgQueueSwap(),PubSub.publish("System/NetworkUp")},ZWOffline.fetchSessionId=function(e){var t={};t.rid=ZWOffline.RID,t.action="createSessionId",ZWCollaboration.msgQueue.isAckPending()&&(t.sid=editor.uuid),Utils.setCsrfParam(t),J.ajax({type:"POST",dataType:"json",url:Utils.getContextUrl("offlineServices.do"),data:t,success:function(t){t&&"SUCCESS"===t.STATUS&&(editor.doc.setUserData(t.userdata),ZWOffline.createNewCursor(t.uuid),PubSub.publish("Document/UserDataFetched"),Utils.setEditorHht(),initWMS(),e())},error:function(e,t,n){var i=e.getResponseHeader("Content-Type");200==e.status&&i.toLowerCase().indexOf("text/html")>=0&&(PubSub.publish("User/SignedOut"),clearTimeout(ZWCollaboration.slowRespTimer))}})},ZWOffline.createNewCursor=function(e){var t={};t.start=editor.doc.getSelection().getStart(),t.end=editor.doc.getSelection().getEnd(),t.uuid=editor.uuid,editor.uuid=e,DomUtil.removeCursorNode(t.uuid,"start"),DomUtil.removeCursorNode(t.uuid,"end"),delete editor.doc.domCursor[t.uuid],editor.doc.createDomCursor(editor.uuid,editor.zuid),editor.doc.createSelection(editor.uuid);var n=editor.doc.getSelection(),i=editor.doc.createRange(t.start,t.end);n.removeAllRanges().addRange(i)},ZWOffline.pushDocFromLSToIDB=function(){var e,t=[];for(e in window.localStorage)if(e.indexOf("_chg")!=-1){var n={};n.docObject=jQuery.parseJSON(window.localStorage.getItem(e)),n.RID=e.substring(3,e.length-4),t.push(n)}if(t.length>0){var i=ZWOffline.db.transaction(["ZW_DocumentTable"],"readwrite"),o=i.objectStore("ZW_DocumentTable");ZWOffline.pushDocFromLSToIDBCallback(o,t,0),i.oncomplete=function(){ZWOffline.clearDocumentsInLocalStorage()}}},ZWOffline.pushDocFromLSToIDBCallback=function(e,t,n){if(n<t.length){var i=e.put({RID:t[n].RID,docObject:t[n].docObject});i.onsuccess=function(i){n++,ZWOffline.pushDocFromLSToIDBCallback(e,t,n)},i.onerror=function(i){ZWOffline.pushDocFromLSToIDBCallback(e,t,n)}}},ZWOffline.removeIdsBasedOnRole=function(){var e=window.notAllowedIds[ZWOffline.role];if(void 0!==e&&null!==e)for(var t=0;t<e.length;t++)J("#"+e[t].trim()).remove()},ZWOffline.SyncDocuments=function(){ZWOffline.offlineListDialogClose(),ZWOffline.isSyncProgress=!0,ZWOffline.openOfflineListDialog(J.i18n("writer.common.OFFLINE_HEADING_SYNC")),ZWOffline.getDocList(ZWOffline.fetchOtherDocOfflineOps)},ZWOffline.fetchOtherDocOfflineOps=function(e){var t=new Array,n=ZWOffline.db.transaction(["ZW_OfflineOpsTable"],"readonly"),i=n.objectStore("ZW_OfflineOpsTable"),o=i.openCursor();o.onsuccess=function(n){var i=n.target.result;i?(t.push(i.value),i.continue()):(ZWOffline.prepareDocListForSync(t,e),ZWOffline.offlineFileOpenListInitialize(),ZWOffline.showListCancelButton(),ZWOffline.sendAndDeleteNextDocOfflineOps(t,0))},o.onerror=function(e){},n.oncomplete=function(e){}},ZWOffline.prepareDocListForSync=function(e,t){try{ZWOffline.list_Array=[];for(var n=0;n<e.length;)ZWOffline.list_Array[n]=ZWOffline.docMetaArray[e[n].RID],n++;for(var i in ZWOffline.docMetaArray)"failed"===ZWOffline.docMetaArray[i].docSyncStatus&&(ZWOffline.list_Array[n]=ZWOffline.docMetaArray[i],n++);if(t.length>0)for(docListIndx=0;docListIndx<t.length;docListIndx++){var o=t[docListIndx];void 0!==ZWOffline.docMetaArray[o.RID]&&"completed"!==ZWOffline.docMetaArray[o.RID].docSyncStatus||(ZWOffline.addMetaToDocMetaArray(o,o.SCOPE,o.ROLE,o.editor_mode),ZWOffline.list_Array[n]=ZWOffline.docMetaArray[o.RID],n++)}}catch(e){ZWOffline.errorDuringSetup_SyncHandler(J.i18n("writer.common.OFFLINE_ERROR_MSG"))}},ZWOffline.sendAndDeleteNextDocOfflineOps=function(e,t){t<e.length?ZWOffline.sendOtherDocumentOpsToServer(e,t):ZWOffline.iterateToNextDocument()},ZWOffline.sendOtherDocumentOpsToServer=function(e,t){var n={},i=e[t];n.action="syncOps",n.rid=i.RID,n.version=i.version,n.revision=i.revision,n.ops=JSON.stringify(i.changeset),n.sid=i.sid,Utils.setCsrfParam(n),J.ajax({type:"POST",global:!1,dataType:"json",url:Utils.getContextUrl("offlineServices.do"),data:n,timeout:15e3,success:function(n){var i=n.UPDATE;"CHECKEDOUT"===i&&(i=J.i18n("writer.common.CHECKEDOUTBY")+" "+n.CHECKEDOUTBY),J("#offdlg_syncstatus_"+e[t].RID).attr("data-info",i),null!==n&&"SUCCESS"===n.UPDATE?(ZWOffline.removeOfflineOps(e[t].RID),t++,ZWOffline.sendAndDeleteNextDocOfflineOps(e,t)):(t++,ZWOffline.sendAndDeleteNextDocOfflineOps(e,t))},error:function(n,i){J("#offdlg_syncstatus_"+e[t].RID).attr("data-info",jQuery.parseJSON(n.responseText).errorMessage),0===n.status&&"timeout"!==i||404===n.status?ZWOffline.errorDuringSetup_SyncHandler():(t++,ZWOffline.sendAndDeleteNextDocOfflineOps(e,t))}})},ZWOffline.clearDocumentsInLocalStorage=function(){var e;for(e in window.localStorage)e.indexOf("_chg")!=-1&&window.localStorage.removeItem(e)},ZWOffline.handleEditorInit=function(e){!window.indexedDB||navigator.userAgent.indexOf("MSIE")>=0||(ZWOffline.isOfflineSetupDoneForZUID(e),ZWOffline.bindOfflineEvents(),ZWOffline.setRID())},ZWOffline.isOfflineSetupDoneForZUID=function(e){try{"true"===window.localStorage.getItem("ZW_isOfflineSetupDone")&&window.localStorage.getItem("ZW_user_ZUID")===e?ZWOffline.isOfflineSetupDone=!0:ZWOffline.isOfflineSetupDone=!1}catch(e){ZWOffline.isOfflineSetupDone=!1}return ZWOffline.isOfflineSetupDone},ZWOffline.bindOfflineEvents=function(){window.addEventListener("storage",ZWOffline.onLocalStorageEvent,!1)},ZWOffline.setRID=function(){var e=location.href,t=e.indexOf("/open/");t!==-1?(e=e.slice(t+6),ZWOffline.RID=e.split("/")[0]):ZWOffline.RID=null},ZWOffline.handleOfflineDocument=function(e){ZWOffline.isOfflineSetupDone&&ZWOffline.openDatabase(ZWOffline.fetchAndProcessMetaData,e)},ZWOffline.fetchAndProcessMetaData=function(e){try{var t=ZWOffline.db.transaction(["ZW_DocMetaTable"],"readonly").objectStore("ZW_DocMetaTable"),n=t.get("META_DATA");n.onsuccess=function(t){try{var n=t.target.result;if(ZWOffline.docMetaArray=n.ZW_DOC_METAARRAY,ZWOffline.userDetails=n.USERDATA,ZWOffline.pendingImageArray=n.PENDINGIMAGEARRAY,null!==ZWOffline.RID)if(void 0!==ZWOffline.docMetaArray[ZWOffline.RID]&&"failed"!==ZWOffline.docMetaArray[ZWOffline.RID].docSyncStatus)window.isOfflineRequest&&(ZWOffline.role=ZWOffline.docMetaArray[ZWOffline.RID].role),ZWOffline.openOfflineDoc(e);else{if(!window.isOfflineRequest)return ZWOffline.currentDocNotInIDB=!0,ZWOffline.docResp=null,ZWOffline.pendingOfflineOps=[],void e();ZWOffline.resetURL=!0,ZWOffline.errorMessage(J.i18n("writer.common.OFFLINE_DOCUMENT_NOT_AVAILABLE"))}else if(null===ZWOffline.RID){if(!window.isOfflineRequest)return void e();ZWOffline.offlineFileOpen(),ZWOffline.db.close()}}catch(t){ZWOffline.handleOfflineDocumentError(e,t,"fetchAndProcessMetaData")}},n.onerror=function(t){ZWOffline.handleOfflineDocumentError(e,t,"fetchAndProcessMetaData")}}catch(t){ZWOffline.handleOfflineDocumentError(e,t,"fetchAndProcessMetaData")}},ZWOffline.handleOfflineDocumentError=function(e,t,n){null!==ZWOffline.db&&ZWOffline.db.close(),ZWOffline.isOfflineSetupDone=!1,void 0!==e&&e()},ZWOffline.openOfflineDoc=function(e){var t=ZWOffline.db.transaction(["ZW_DocumentTable","ZW_OfflineOpsTable"],"readonly"),n=t.objectStore("ZW_OfflineOpsTable"),i=n.get(ZWOffline.RID);i.onsuccess=function(n){var i=n.target.result;void 0!==i?(ZWOffline.pendingOfflineOps=i.changeset,ZWOffline.sessionId=i.sid):ZWOffline.pendingOfflineOps=[];var o=t.objectStore("ZW_DocumentTable"),r=o.get(ZWOffline.RID);r.onsuccess=function(t){void 0===t.target.result||void 0===t.target.result.docObject||J.isEmptyObject(t.target.result.docObject)?ZWOffline.docResp=null:ZWOffline.docResp=t.target.result.docObject;var n=window.localStorage.getItem("ZW_"+ZWOffline.RID+"_chg");null!==n&&(ZWOffline.docResp=jQuery.parseJSON(n)),window.isOfflineRequest?(null===ZWOffline.docResp&&(ZWOffline.resetURL=!0,ZWOffline.errorMessage(J.i18n("writer.common.OFFLINE_DOCUMENT_NOT_AVAILABLE"))),"locked"===window.localStorage.getItem("ZW_"+ZWOffline.RID)?ZWOffline.isReadOnly=!0:window.localStorage.setItem("ZW_"+ZWOffline.RID,"locked"),docProps=docProps||{},docProps.collabUsersDetails=ZWOffline.getUserDetails(),null!=ZWOffline.docResp&&(docProps.info=ZWOffline.docResp.docInfo,docProps.content=ZWOffline.docResp.docContent,docProps.content.defaults.view="Page View"),editorProps.userInfo.uuid=ZWOffline.sessionId,editorProps.userInfo.role=ZWOffline.role,e(),editor.setOffline(!0)):(0===ZWOffline.pendingOfflineOps.length?ZWOffline.docResp=null:null!=ZWOffline.docResp&&(docProps.info=ZWOffline.docResp.docInfo,docProps.content=ZWOffline.docResp.docContent,docProps.content.defaults.view="Page View"),e())},r.onerror=function(e){}},i.onerror=function(e){},t.oncomplete=function(e){},t.error=function(t){ZWOffline.handleOfflineDocumentError(e,ex,"fetchAndProcessMetaData")}},ZWOffline.handleAfterInit=function(){ZWOffline.isOfflineSetupDone&&(window.localStorage.removeItem("ZW_"+ZWOffline.RID+"_chg"),ZWOffline.pushDocFromLSToIDB(),ZWOffline.restoreMsgQueue())},ZWOffline.handleAfterComponentInit=function(){var e=editor.doc.getRole();"OWNER"!==e&&"COOWNER"!==e&&"SHAREDREADWRITE"!==e&&"SHAREDREAD"!==e&&"SHAREDREADCOMMENT"!==e||ZWOffline.updateOfflineMenu(),editor.isOffline()&&(ZWOffline.removeIdsBasedOnRole(),ZWOffline.disableOnlineFeatures())},ZWOffline.restoreMsgQueue=function(){if(ZWOffline.isOfflineSetupDone&&"TEMPLATE_USER"!==editor.doc.getRole()&&!editor.doc.getDocInfo().CHECKEDOUT){if(window.isOfflineRequest&&(document.title=editor.doc.getDocInfo().DOCUMENT_NAME,ZWOffline.isReadOnly&&"SHAREDREAD"!==editor.doc.getRole))return void ZWOffline.readOnly();ZWOffline.pendingOfflineOps.length>0&&ZWCollaboration.msgQueue.msgQueueInitialize(ZWOffline.pendingOfflineOps),Utils.retryNetwork()}},ZWOffline.CurrentDocSyncComplete=function(){ZWOffline.isSyncing=!1,ZWOffline.loadOfflineEditorInIframe(),ZWOffline.pendingOfflineOps.length>0&&(ZWOffline.pendingOfflineOps=[],ZWOffline.removeOfflineOps(ZWOffline.RID)),"MAILMERGE_LIBRARY"!==editor.doc.getRole()&&"CRM_VERTICAL_MAILMERGE_LIBRARY"!==editor.doc.getRole()&&"ZFORMS_TEMPLATE"!==editor.doc.getRole()&&"WORKSPACE_CRMLIB_EDITOR"!==editor.doc.getRole()&&ZWOffline.saveCurrentDocument()},ZWOffline.saveCurrentDocument=function(){var e=editor.doc.getDocInfo(),t=editor.doc.getUserData()[editor.zuid].editor_mode,n="false"===e.ISSHARED?0:1;ZWOffline.addMetaToDocMetaArray(e,n,editor.doc.getRole(),t),ZWOffline.currentDocNotInIDB?(ZWOffline.currentDocNotInIDB=!1,1==e.VERSION&&0==e.REVISION?ZWOffline.updateDocFromEditorToDB(ZWOffline.RID,ZWOffline.constructDocObject()):ZWOffline.getDocument(ZWOffline.RID,ZWOffline.insertServerDoc_ToIDB,0)):(1==e.VERSION&&0==e.REVISION||ZWCollaboration.checkServerVersion(),ZWOffline.updateDocFromEditorToDB(ZWOffline.RID,ZWOffline.constructDocObject()))},ZWOffline.removeOfflineOps=function(e){var t=ZWOffline.db.transaction(["ZW_OfflineOpsTable"],"readwrite"),n=t.objectStore("ZW_OfflineOpsTable"),i=n.delete(e);i.onsuccess=function(t){ZWOffline.setDocOfflineOpsStatus(e,!1)},i.onerror=function(e){}},ZWOffline.addMetaToDocMetaArray=function(e,t,n,i){ZWOffline.docMetaArray[e.RID]={RID:e.RID,docName:e.DOCUMENT_NAME,docName_html:e.DOCUMENT_NAME_HTML,modifiedBy:e.LASTMODIFIEDBY,modifiedBy_html:e.LASTMODIFIEDBY_HTML,modifiedDate:e.LAST_MODIFIED_TIME_LONG,creatorName:e.CREATOR,creatorName_html:e.CREATOR_HTML,creatorZUID:e.CREATOR_ZUID,scope:t,role:n,editor_mode:i,imageArray:[],offlineOps:!1,docSyncStatus:"",lastSyncDate:0}},ZWOffline.insertServerDoc_ToIDB=function(e,t,n){try{var i;if(J.isEmptyObject(t))ZWOffline.updateMetaTable();else{i=ZWOffline.db.transaction(["ZW_DocumentTable"],"readwrite");var o=i.objectStore("ZW_DocumentTable"),r=o.put({RID:e,docObject:t.docObject});r.onsuccess=function(){try{ZWOffline.pendingImageArray[e]=t.docImages,ZWOffline.updateDocumentSyncStatusInMeta(e)}catch(e){ZWOffline.updateMetaTable()}},r.onerror=function(e){ZWOffline.updateMetaTable()},i.oncomplete=function(){ZWOffline.updateMetaTable()}}}catch(e){ZWOffline.updateMetaTable()}},ZWOffline.constructDocObject=function(){var e=editor.doc.getDocInfo(),t={content:editor.doc.getDocumentContent(),defaults:editor.doc.getBodyFormat(),rev:e.REVISION,ver:e.VERSION,styles:editor.doc.getFormats(),comments:{comment_sequence_number:CommentModels.comment_sequence_number,comments:CommentManager.constructCommentsJSON()}};return{docInfo:e,docContent:t}},ZWOffline.updateDocFromEditorToDB=function(e,t){var n=ZWOffline.db.transaction(["ZW_DocumentTable"],"readwrite"),i=n.objectStore("ZW_DocumentTable"),o=i.put({RID:e,docObject:t});o.onsuccess=function(t){ZWOffline.updateDocumentSyncStatusInMeta(e)},o.onerror=function(e){},n.oncomplete=function(){ZWOffline.updateMetaTable()}},ZWOffline.storeOfflineOps=function(e){try{ZWOffline.docMetaArray[ZWOffline.RID].offlineOps!==!1&&"completed"!==ZWOffline.docMetaArray[ZWOffline.RID].docSyncStatus||ZWOffline.setDocOfflineOpsStatus(ZWOffline.RID,!0),e&&ZWCollaboration.msgQueue.add(e);var t=new Array(2);t[0]=ZWCollaboration.msgQueue.getAckPendingEdit(),t[1]=ZWCollaboration.msgQueue.getPendingToPushEdit(),ZWOffline.pendingOfflineOps[0]=t[0]?t[0].toString():void 0,ZWOffline.pendingOfflineOps[1]=t[1]?t[1].toString():void 0;var n=ZWOffline.db.transaction(["ZW_OfflineOpsTable"],"readwrite"),i=n.objectStore("ZW_OfflineOpsTable"),o=i.put({RID:ZWOffline.RID,changeset:ZWOffline.pendingOfflineOps,version:ZWCollaboration.MUTATION_SEND_VERSION,revision:ZWCollaboration.MUTATION_SEND_REVISION,sid:editor.uuid});o.onsuccess=function(e){},o.onerror=function(e){},n.oncomplete=function(e){}}catch(e){}},ZWOffline.setupOffline=function(){"true"===window.localStorage.getItem("ZW_isOfflineSetupDone")?window.localStorage.getItem("ZW_user_ZUID")!==editor.zuid?ZWOffline.openOfflineMsgDialog(J.i18n("writer.common.OFFLINE_ALREADYSETUPDONE_MSG"),"Close",J.i18n("writer.common.OFFLINE_HEADING_MESSAGE"),!1):ZWOffline.errorMessage(""):ZWOffline.openOfflineMsgDialog(J.i18n("writer.common.OFFLINE_SETUP_CONFIRM"),"Proceed",J.i18n("writer.common.OFFLINE_HEADING_CONFIRMATION"),!0)},ZWOffline.offlineInitialize=function(){window.localStorage.clear(),ZWOffline.isOfflineSetupDone=!0,ZWOffline.isSetupProgress=!0,ZWOffline.openOfflineListDialog(J.i18n("writer.common.OFFLINE_HEADING_SETUP")),ZWOffline.loadOfflineEditorInIframe(),ZWOffline.openDatabase(ZWOffline.getDocList,ZWOffline.storeDocuments)},ZWOffline.updateOfflineMenu=function(){ZWOffline.isOfflineSetupDone?(J("#topband-setupoffline").hide().disable(),J("#topband-offlineoptions").show().enable()):(J("#topband-offlineoptions").hide().disable(),navigator.userAgent.indexOf("MSIE")>=0||!window.indexedDB?J("#topband-setupoffline").hide().disable():J("#topband-setupoffline").show().enable())},ZWOffline.loadOfflineEditorInIframe=function(){J("#offlineFrame").attr("src",editor.getBaseURL()+"/offline.do")},ZWOffline.openDatabase=function(e,t){if(window.indexedDB){var n=window.indexedDB.open("ZDocsOffline",ZWOffline.idbversion);n.onblocked=function(e){},n.onerror=function(e){},n.onupgradeneeded=function(e){try{var t=e.target.result;if(!t.objectStoreNames.contains("ZW_DocumentTable")){var n=t.createObjectStore("ZW_DocumentTable",{keyPath:"RID",autoIncrement:!1});n=t.createObjectStore("ZW_ImageTable",{keyPath:"imageURL",autoIncrement:!1}),n=t.createObjectStore("ZW_OfflineOpsTable",{keyPath:"RID",autoIncrement:!1}),n=t.createObjectStore("ZW_DocMetaTable",{keyPath:"keyId",autoIncrement:!1})}}catch(e){ZWOffline.errorDuringSetup_SyncHandler(J.i18n("writer.common.OFFLINE_ERROR_MSG"))}},n.onsuccess=function(n){try{ZWOffline.db=n.target.result,void 0===t?e():e(t)}catch(e){ZWOffline.errorDuringSetup_SyncHandler(J.i18n("writer.common.OFFLINE_ERROR_MSG"))}}}else ZWOffline.errorDuringSetup_SyncHandler(J.i18n("writer.common.OFFLINE_UNSUPPORTED_BROWSER"))},ZWOffline.getDocList=function(e){try{var t=window.localStorage.getItem("ZW_LastSyncDate"),n=null!==t?parseInt(t):0,i={};if(i.action="fetchDocumentsList",i.modifiedtime=n,ZWOffline.isSyncProgress){var o=ZWOffline.getOfflineDocumentsRIDsAsJSONArray();i.ridList=JSON.stringify(o)}var r=[];J.ajax({type:"POST",dataType:"json",url:Utils.getContextUrl("offlineServices.do"),data:i,timeout:25e3,success:function(t){try{null!==t&&"SUCCESS"===t.STATUS?(void 0!==t.ACTIVEFILES&&(r=t.ACTIVEFILES),ZWOffline.currentSyncDate=t.SYNCDATE,ZWOffline.oldFilesMeta=t.OLDFILESMETA,e(r)):ZWOffline.errorDuringSetup_SyncHandler()}catch(e){ZWOffline.errorDuringSetup_SyncHandler(J.i18n("writer.common.OFFLINE_ERROR_MSG"))}},error:function(e){ZWOffline.errorDuringSetup_SyncHandler()}})}catch(e){ZWOffline.errorDuringSetup_SyncHandler(J.i18n("writer.common.OFFLINE_ERROR_MSG"))}},ZWOffline.errorDuringSetup_SyncHandler=function(e){void 0===e&&(e=J.i18n("writer.common.OFFLINE_NETWORKERROR"));var t=J.i18n("writer.common.ERROR");ZWOffline.isSetupProgress?(e=e+" "+J.i18n("writer.common.OFFLINE_SETUP_FAILED"),ZWOffline.offlineSetupCancel(e,t)):ZWOffline.isSyncProgress?(e=J.i18n("writer.common.OFFLINE_SYNC_FAILED"),ZWOffline.offlineSyncCancel(e,t)):ZWOffline.openOfflineMsgDialog(e,"Close",t,!1)},ZWOffline.storeDocuments=function(e){try{if(e.length>0){for(docListIndx=0;docListIndx<e.length;docListIndx++){var t=e[docListIndx];ZWOffline.addMetaToDocMetaArray(t,t.SCOPE,t.ROLE,t.editor_mode)}ZWOffline.createlist_arrayfromdocMetaArray(ZWOffline.docMetaArray),ZWOffline.offlineFileOpenListInitialize(),ZWOffline.showListCancelButton(),ZWOffline.iterateToNextDocument()}else ZWOffline.offlineSetupComplete()}catch(e){ZWOffline.errorDuringSetup_SyncHandler(J.i18n("writer.common.OFFLINE_ERROR_MSG"))}},ZWOffline.getDocument=function(e,t,n){try{var i={};i.rid=e,i.action="fetchDocContent";var o={};J.ajax({type:"GET",dataType:"json",url:Utils.getContextUrl("offlineServices.do"),data:i,timeout:3e4,success:function(i){null!==i&&"SUCCESS"===i.STATUS&&(o=i),t(e,o,n)},error:function(i,r){t(e,o,n)}})}catch(e){ZWOffline.errorDuringSetup_SyncHandler(J.i18n("writer.common.OFFLINE_ERROR_MSG"))}},ZWOffline.putDocumentInIDB=function(e,t,n){try{var i;if(J.isEmptyObject(t))ZWOffline.iterateToNextDocument(n,J.i18n("writer.common.DOCUMENT_FETCH_FAILED"));else{i=ZWOffline.db.transaction(["ZW_DocumentTable"],"readwrite");var o=i.objectStore("ZW_DocumentTable"),r=o.put({RID:e,docObject:t.docObject});r.onsuccess=function(){try{ZWOffline.pendingImageArray[e]=t.docImages,ZWOffline.updateDocumentSyncStatusInMeta(e),ZWOffline.updateDocumentSyncStatusInListDialog(e),ZWOffline.iterateToNextDocument(n)}catch(e){ZWOffline.iterateToNextDocument(n,J.i18n("writer.common.INTERNAL_ERROR"))}},r.onerror=function(e){ZWOffline.iterateToNextDocument(n,J.i18n("writer.common.DOCUMENT_SAVE_FAILED"))}}}catch(e){ZWOffline.iterateToNextDocument(n,J.i18n("writer.common.INTERNAL_ERROR"))}},ZWOffline.updateDocumentSyncStatusInMeta=function(e){ZWOffline.docMetaArray[e].lastSyncDate=(new Date).getTime(),ZWOffline.docMetaArray[e].docSyncStatus="completed"},ZWOffline.updateDocumentSyncStatusInListDialog=function(e){J("#offdlg_syncstatus_"+e).html(J.i18n("writer.common.COMPLETED"))},ZWOffline.iterateToNextDocument=function(e,t){try{if(ZWOffline.isSetupProgress||ZWOffline.isSyncProgress){if(void 0===e)e=0;else{if("completed"===ZWOffline.docMetaArray[ZWOffline.list_Array[e].RID].docSyncStatus){var n=parseInt(J("#completedFilesCount").html());n++,J("#completedFilesCount").html(n)}else{"pending"!==ZWOffline.docMetaArray[ZWOffline.list_Array[e].RID].docSyncStatus&&(ZWOffline.docMetaArray[ZWOffline.list_Array[e].RID].docSyncStatus="failed");var i=J("#offdlg_syncstatus_"+ZWOffline.list_Array[e].RID),o=window.WRITER_BASE_URL+"/open/"+ZWOffline.list_Array[e].RID,r="<a class='ui-offline-doc-name-link' href='"+o+"' target='_blank'>"+J.i18n("writer.common.TRYAGAIN")+'</a><em title="'+t+"\" class='ui-components-icon ui-state-info-icon' style='float: right;position: relative;'></em>";i.html(r);var a=parseInt(J("#failedFilesCount").html());a++,J("#failedFilesCount").html(a)}e++}if(e<ZWOffline.list_Array.length){"completed"===ZWOffline.docMetaArray[ZWOffline.list_Array[e].RID].docSyncStatus&&(ZWOffline.docMetaArray[ZWOffline.list_Array[e].RID].docSyncStatus="failed");var s=ZWOffline.list_Array[e].RID;ZWOffline.isSyncProgress&&1==ZWOffline.docMetaArray[s].offlineOps?ZWOffline.iterateToNextDocument(e,J("#offdlg_syncstatus_"+ZWOffline.list_Array[e].RID).attr("data-info")):ZWOffline.getDocument(s,ZWOffline.putDocumentInIDB,e)}else if(ZWOffline.isSyncProgress){var l=J.i18n("writer.common.OFF_SYNC_SUCCESS");0===e&&(l=J.i18n("writer.common.OFF_NODOCTOSYNC")),ZWOffline.offlineSyncComplete(l)}else{var l=J.i18n("writer.common.OFF_INIT_SUCCESS");0===e&&(l+=J.i18n("writer.common.OFF_NODOCTOSetup")),ZWOffline.offlineSetupComplete(l)}}else ZWOffline.isOfflineSetupDone?ZWOffline.offlineSyncCancel(J.i18n("writer.common.OFFLINE_SYNCCANCEL_MSG"),J.i18n("writer.common.OFFLINE_HEADING_MESSAGE")):ZWOffline.offlineSetupCancel(J.i18n("writer.common.OFFLINE_SETUPCANCEL_MSG"),J.i18n("writer.common.OFFLINE_HEADING_MESSAGE"))}catch(e){ZWOffline.errorDuringSetup_SyncHandler(J.i18n("writer.common.OFFLINE_ERROR_MSG"))}},ZWOffline.offlineSyncComplete=function(e){ZWOffline.isSyncProgress=!1,ZWOffline.setUserDetails(),ZWOffline.updateMetaTable(),ZWOffline.clearDocumentsInLocalStorage(),ZWOffline.updateOfflineListDialogAfterSuccess(e),ZWOffline.handlePostSyncComplete()},ZWOffline.offlineSetupComplete=function(e){WebMessanger.disableNetworkDownBanner(),ZWOffline.setUserDetails(),ZWOffline.updateMetaTable(),window.localStorage.setItem("ZW_isOfflineSetupDone","true"),window.localStorage.setItem("ZW_user_ZUID",editor.zuid),window.localStorage.setItem("ZW_LastSyncDate",ZWOffline.currentSyncDate),ZWOffline.updateOfflineListDialogAfterSuccess(e)},ZWOffline.offlineSyncCancel=function(e,t){ZWOffline.isSyncProgress=!1,ZWOffline.updateMetaTable(),ZWOffline.offlineListDialogClose(),ZWOffline.openOfflineMsgDialog(e,"Close",t,!1)},ZWOffline.offlineSetupCancel=function(e,t){ZWOffline.isSetupProgress=!1,ZWOffline.removeOfflineSetup(),ZWOffline.offlineListDialogClose(),ZWOffline.openOfflineMsgDialog(e,"Close",t,!1)},ZWOffline.updateOfflineListDialogAfterSuccess=function(e){ZWOffline.hideListDialogButtons(),ZWOffline.showListCloseButton(),J("#statusMsg").html(e),J("#statusDivInfoIcon,#offlineprogressbar").hide(),J("#statusDivStatusIcon").show()},ZWOffline.setDocOfflineOpsStatus=function(e,t){t===!0?ZWOffline.docMetaArray[e].docSyncStatus="pending":ZWOffline.docMetaArray[e].docSyncStatus="completed",ZWOffline.docMetaArray[e].offlineOps=t,ZWOffline.updateMetaTable()},ZWOffline.updateMetaTable=function(){var e={keyId:"META_DATA",ZW_DOC_METAARRAY:ZWOffline.docMetaArray,USERDATA:ZWOffline.userDetails,PENDINGIMAGEARRAY:ZWOffline.pendingImageArray};window.localStorage.setItem("ZW_METADATA",JSON.stringify(e));var t=ZWOffline.db.transaction(["ZW_DocMetaTable"],"readwrite").objectStore("ZW_DocMetaTable"),n=t.put(e);n.onsuccess=function(){},n.onerror=function(e){}},ZWOffline.setUserDetails=function(){ZWOffline.userDetails={},ZWOffline.userDetails.zuid=editor.zuid;var e=editor.doc.getUserData()[editor.zuid];ZWOffline.userDetails.userData={color:"",cstatus:"0",fname:e.fname,fname_HTML:e.fname_HTML,fname_JS:e.fname_JS,uuids:""}},ZWOffline.getUserDetails=function(){var e={};for(var t in ZWOffline.userDetails.userData)e[t]=ZWOffline.userDetails.userData[t];void 0===ZWOffline.sessionId&&(ZWOffline.sessionId=Utils.randomString()),e.uuids=ZWOffline.sessionId;var n=EDITOR_MODES.COMPOSE;try{n=ZWOffline.docMetaArray[ZWOffline.RID].editor_mode}catch(e){}e.editor_mode=n||EDITOR_MODES.COMPOSE;var i={};return i[ZWOffline.userDetails.zuid]=e,i},ZWOffline.createlist_arrayfromdocMetaArray=function(e){ZWOffline.list_Array=[];for(var t in e)ZWOffline.list_Array.push(e[t])},ZWOffline.offlineFileOpenListInitialize=function(){J("#offlineDocListitems").empty(),J("#totalFilesCount").html(ZWOffline.list_Array.length);for(var e=0;e<ZWOffline.list_Array.length;e++){var t,n=window.WRITER_BASE_URL+"/open/"+ZWOffline.list_Array[e].RID,i=ZWOffline.list_Array[e].docName_html,o=ZWOffline.list_Array[e].creatorName_html;new Date(ZWOffline.list_Array[e].modifiedDate).toUTCString();t=ZWOffline.isSetupProgress||ZWOffline.isSyncProgress?"":"completed"===ZWOffline.list_Array[e].docSyncStatus?J.i18n("writer.common.COMPLETED"):"pending"===ZWOffline.list_Array[e].docSyncStatus?J.i18n("writer.common.PENDING"):J.i18n("writer.common.FAILED");var r="<div id='RID_"+ZWOffline.list_Array[e].RID+"'><span class='ui-offline-doc-name' noi18n='true'><a class='ui-offline-doc-name-link ui-semibold' href="+n+" target='_blank'>"+i+"</a></span><span noi18n='true'>"+o+"</span><span style='margin-left: 0px; text-align: center; width:22%;' id='offdlg_syncstatus_"+ZWOffline.list_Array[e].RID+"' >"+t+"</span></div>";J("#offlineDocListitems").append(r)}},ZWOffline.onLocalStorageEvent=function(e){if("MAILMERGE_LIBRARY"!==editor.doc.getRole()&&"CRM_VERTICAL_MAILMERGE_LIBRARY"!==editor.doc.getRole()&&"ZFORMS_TEMPLATE"!==editor.doc.getRole()&&"WORKSPACE_CRMLIB_EDITOR"!==editor.doc.getRole())if("ZW_isOfflineSetupDone"===e.key)"true"===e.newValue?ZWOffline.showReloadMsgDialog(J.i18n("writer.common.OFFLINESETUP_DONE_INANOTHERTAB")):(ZWOffline.db&&ZWOffline.db.close(),ZWOffline.showReloadMsgDialog(J.i18n("writer.common.OFFLINESETUP_REMOVED_INANOTHERTAB")));else if(e.key==="ZW_"+ZWOffline.RID&&"SHAREDREAD"!==editor.doc.getRole)ZWOffline.isReadOnly=!0,ZWOffline.readOnly();else if("ZW_METADATA"===e.key&&!ZWOffline.isSyncProgress){var t=jQuery.parseJSON(window.localStorage.getItem("ZW_METADATA"));ZWOffline.docMetaArray=t.ZW_DOC_METAARRAY,ZWOffline.userDetails=t.USERDATA,ZWOffline.pendingImageArray=t.PENDINGIMAGEARRAY}},ZWOffline.showReloadMsgDialog=function(e){ZWOffline.openOfflineMsgDialog(e,"Reload",J.i18n("writer.common.OFFLINE_HEADING_MESSAGE"),!1)},ZWOffline.offlineFileOpen=function(){ZWOffline.openOfflineListDialog(J.i18n("writer.common.OFFLINE_HEADING_DOC_LIST")),null!==ZWOffline.RID&&(ZWOffline.showListCloseButton(),editor.isOffline()||ZWOffline.showListSyncDocumentsButton()),ZWOffline.createlist_arrayfromdocMetaArray(ZWOffline.docMetaArray),ZWOffline.offlineFileOpenListInitialize()},ZWOffline.showListSyncDocumentsButton=function(){J("#syncDocument").unbind("click"),J("#syncDocument").click(ZWOffline.SyncDocuments),J("#syncDocument").show()},ZWOffline.openOfflineListDialog=function(e){var t=jQuery.parseJSON(J("#offlineListDialog").attr("data"));if(t.title=e,J("#offlineListDialog").dialog(t),J("#offlineDocListitems").empty(),J("#totalFilesCount").html("0"),ZWOffline.isSyncProgress||ZWOffline.isSetupProgress){J("#statusDiv,#statusDivInfoIcon,#offlineprogressbar").show(),J("#statusDivStatusIcon").hide(),J("#completedFilesCount").html("0"),J("#failedFilesCount").html("0");var n=ZWOffline.isSyncProgress?J.i18n("writer.common.OFF_SYNC"):J.i18n("writer.common.OFF_INIT");J("#statusMsg").html(n)}else J("#statusDiv").hide();ZWOffline.hideListDialogButtons()},ZWOffline.hideListDialogButtons=function(){J("#offListButCancel").hide(),J("#offListButClose").hide(),J("#syncDocument").hide(),J(".ui-dialog-titlebar-close").hide()},ZWOffline.showListCloseButton=function(){J("#offListButClose").unbind("click"),J("#offListButClose").click(ZWOffline.offlineListDialogClose),J("#offListButClose").show()},ZWOffline.showListCancelButton=function(){J("#offListButCancel").unbind("click"),J("#offListButCancel").click(ZWOffline.offlineListDialogCancel),J("#offListButCancel").show()},ZWOffline.offlineListDialogCancel=function(){"true"===window.localStorage.getItem("ZW_isOfflineSetupDone")?ZWOffline.isSyncProgress=!1:(ZWOffline.isOfflineSetupDone=!1,ZWOffline.isSetupProgress=!1)},ZWOffline.offlineListDialogClose=function(){J("#syncDocument,#offlineprogressbar").hide(),J("#offlineListDialog").dialog("close"),ZWOffline.isSetupProgress&&(ZWOffline.isSetupProgress=!1,ZWOffline.showReloadMsgDialog(J.i18n("writer.common.OFFLINESETUP_COMPLETED_RELOAD")))},ZWOffline.openOfflineMsgDialog=function(e,t,n,i){var o=jQuery.parseJSON(J("#offlineMsgDialog").attr("data"));o.title=n,J("#offlineMsgDialog").dialog(o),ZWOffline.hideMsgDialogButtons(),i?ZWOffline.showOfflineWarningMessage(e):J("#offMsg").html(e),"Cancel"===t?ZWOffline.showMsgCancelButton():"Close"===t?ZWOffline.showMsgCloseButton():"Reload"===t?ZWOffline.showMsgReloadButton():"Proceed"===t&&(ZWOffline.showMsgProceedButton(),ZWOffline.showMsgCancelButton())},ZWOffline.hideMsgDialogButtons=function(){J("#offMsgButCancel").hide(),J("#offMsgButClose").hide(),J("#offMsgButReload").hide(),J("#offMsgButProceed").hide(),J(".ui-dialog-titlebar-close").hide()},ZWOffline.showMsgCloseButton=function(){J("#offMsgButClose").unbind("click"),J("#offMsgButClose").click(ZWOffline.offlineMsgDialogClose),J("#offMsgButClose").show()},ZWOffline.showMsgCancelButton=function(){J("#offMsgButCancel").unbind("click"),J("#offMsgButCancel").click(ZWOffline.offlineMsgDialogCancel),J("#offMsgButCancel").show()},ZWOffline.showMsgReloadButton=function(){J("#offMsgButReload").unbind("click"),J("#offMsgButReload").click(ZWOffline.offlineMsgDialogReload),J("#offMsgButReload").show()},ZWOffline.showMsgProceedButton=function(){J("#offMsgButProceed").unbind("click"),J("#offMsgButProceed").click(ZWOffline.offlineMsgDialogProceed),J("#offMsgButProceed").show()},ZWOffline.offlineMsgDialogClose=function(){J("#offlineWarningDiv").is(":visible")&&(J("#offlineWarningDiv").hide(),J("#offlineMsgDiv").show()),J("#offlineMsgDialog").dialog("close"),ZWOffline.resetURL&&(ZWOffline.resetURL=!1,ZWOffline.resetCurrentURL())},ZWOffline.offlineMsgDialogReload=function(){ZWOffline.UnloadHandler=ZWOffline.emptyfn,location.reload()},ZWOffline.offlineMsgDialogProceed=function(){ZWOffline.offlineMsgDialogClose(),ZWOffline.isOfflineSetupDone?ZWOffline.removeOfflineSetup(J.i18n("writer.common.OFF_REMOVE_SUCCESS")):(1==editor.doc.getDocInfo().VERSION&&0==editor.doc.getDocInfo().REVISION||WebUtil.saveDocumentCurrentVersions(null),ZWOffline.offlineInitialize())},ZWOffline.showOfflineWarningMessage=function(e){J("#offWarningMsg").html(e),J("#offlineWarningDiv").show(),J("#offlineMsgDiv").hide()},ZWOffline.offlineMsgDialogCancel=function(){ZWOffline.offlineMsgDialogClose()},ZWOffline.disableOffline=function(){try{var e=ZWOffline.isOfflineOpsPendingforSync();e===!0?ZWOffline.openOfflineMsgDialog(J.i18n("writer.common.OFFLINE_PENDINGEDITS_WARNINGMSG"),"Proceed",J.i18n("writer.common.OFFLINE_HEADING_CONFIRMATION"),!0):ZWOffline.openOfflineMsgDialog(J.i18n("writer.common.OFFLINE_REMOVAL_CONFIRM"),"Proceed",J.i18n("writer.common.OFFLINE_HEADING_CONFIRMATION"),!0)}catch(e){ZWOffline.errorMessage(e)}},ZWOffline.isOfflineOpsPendingforSync=function(){for(var e in ZWOffline.docMetaArray)if(ZWOffline.docMetaArray[e].offlineOps===!0)return!0;return!1},ZWOffline.isOfflineDocPendingforSync=function(){for(var e in ZWOffline.docMetaArray)if("pending"===ZWOffline.docMetaArray[e].docSyncStatus||"failed"===ZWOffline.docMetaArray[e].docSyncStatus)return!0;return!1},ZWOffline.resetCurrentURL=function(){window.location=window.WRITER_BASE_URL+"/offline"},ZWOffline.removeOfflineSetup=function(e){ZWOffline.isOfflineSetupDone=!1,ZWOffline.docMetaArray={},ZWOffline.clearLocalStorageValues(),"undefined"!=typeof WebMessanger&&(WebMessanger.disablenetworkdownbanner=!1),ZWOffline.db&&ZWOffline.db.close();var t=window.indexedDB.deleteDatabase("ZDocsOffline");t.onsuccess=function(t){void 0!==e&&(ZWOffline.openOfflineMsgDialog(e,"Close",J.i18n("writer.common.OFFLINE_HEADING_MESSAGE"),!1),PubSub.publish("Document/offlineSetupRemoved"))},t.onerror=function(e){ZWOffline.errorMessage("")}},ZWOffline.clearLocalStorageValues=function(){for(var e in window.localStorage)e.indexOf("ZW_")>=0&&window.localStorage.removeItem(e);window.localStorage.setItem("ZW_isOfflineSetupDone","false")},ZWOffline.errorMessage=function(e){ZWOffline.openOfflineMsgDialog(J.i18n("writer.common.OFFLINE_ERROR_MSG")+e,"Close",J.i18n("writer.common.ERROR"),!1)},ZWOffline.UnloadHandler=function(){if(ZWOffline.isOfflineSetupDone){if("TEMPLATE_USER"!==editor.doc.getRole()){editor.isOffline()&&(ZWOffline.isReadOnly||window.localStorage.removeItem("ZW_"+ZWOffline.RID));var e={};e=ZWOffline.constructDocObject(),window.localStorage.setItem("ZW_"+ZWOffline.RID+"_chg",JSON.stringify(e))}ZWOffline.db&&ZWOffline.db.close()}},ZWOffline.getOfflineDocumentsRIDsAsJSONArray=function(){var e=[];for(var t in ZWOffline.docMetaArray)e.push(t);return e},ZWOffline.handlePostSyncComplete=function(){ZWOffline.updateRoleAndStatusOfOfflineDocs()},ZWOffline.updateRoleAndStatusOfOfflineDocs=function(){for(var e=[],t=0;t<ZWOffline.oldFilesMeta.length;t++){var n=ZWOffline.oldFilesMeta[t];void 0!=ZWOffline.docMetaArray[n.RID]&&(null!=n.ROLE&&(ZWOffline.docMetaArray[n.RID].role=n.ROLE),null!=n.editor_mode&&(ZWOffline.docMetaArray[n.RID].editor_mode=n.editor_mode)),null!=n.ROLE&&n.TRASHED!==!0||(e.push(n.RID),delete ZWOffline.docMetaArray[n.RID])}ZWOffline.updateMetaTable(),ZWOffline.removeTrashedDocsfromIDB(e,0)},ZWOffline.removeTrashedDocsfromIDB=function(e,t){if(t<e.length){var n=ZWOffline.db.transaction(["ZW_DocumentTable","ZW_OfflineOpsTable"],"readwrite"),i=n.objectStore("ZW_OfflineOpsTable"),o=i.delete(RID);o.onsuccess=function(i){ZWOffline.setDocOfflineOpsStatus(RID,!1);var o=n.objectStore("ZW_DocumentTable"),r=o.delete(RID);r.onsuccess=function(n){t++,ZWOffline.removeTrashedDocsfromIDB(e,t)},r.onerror=function(e){}},o.onerror=function(e){},n.oncomplete=function(e){},n.error=function(n){t++,ZWOffline.removeTrashedDocsfromIDB(e,t)}}else window.localStorage.setItem("ZW_LastSyncDate",ZWOffline.currentSyncDate)},ZWOffline.handleEditorModeChange=function(e){null!=ZWOffline.RID&&(ZWOffline.docMetaArray[ZWOffline.RID].editor_mode=e,ZWOffline.updateMetaTable())},PubSub.subscribe("Document/offlineSetupRemoved",ZWOffline.updateOfflineMenu),PubSub.subscribe("Document/FirstTimeComponentReady",ZWOffline.handleAfterComponentInit),ZWOffline.emptyfn=function(){},ZWOffline.pendingOfflineOps=[],ZWOffline.RID=null,ZWOffline.isOfflineSetupDone=!1,ZWOffline.docResp=null,ZWOffline.idbversion=1,ZWOffline.isSyncing=!1,ZWOffline.db=null,ZWOffline.docObject={},ZWOffline.list_Array=[],ZWOffline.pendingImageArray=[],ZWOffline.docMetaArray={},ZWOffline.oldFilesMeta=[],ZWOffline.userDetails={},ZWOffline.currentDocNotInIDB=!1,ZWOffline.zuid="",ZWOffline.isReadOnly=!1;ZWOffline.isSyncProgress=!1;ZWOffline.isSetupProgress=!1,ZWOffline.wmsRegistered=!1,ZWOffline.currentSyncDate=0,ZWOffline.sessionId=void 0,ZWOffline.resetURL=!1,MsgHandler.logger=new ZWLogger,MsgHandler.handleJoin=function(e){WebMessanger.join(e)},MsgHandler.handlePresence=function(e,t,n,i,o){var r=editor.doc.getDocInfo();if(e==r.COLLAB_ID)if(n=n||t,"1"==o){MsgHandler.logger.log("@handlePresence",e,t,n,i,o);var a=function(e,t){MsgHandler.logger.log("@handlePresenceCallback",e,t),PubSub.publish("Collaboration/UserAdded",t,e[t]),e[t]&&e[t].unique_userid&&(t=e[t].unique_userid,editor.doc.updateUserData(t,e[t])),editor.isEditable()&&ZWCollaboration.sendCursorMutation()};Utils.getUserMode(editor.zuid,r.DOCUMENT_ID,a,n)}else{PubSub.publish("Collaboration/UserRemoved",n);var s=editor.doc.getUserData();s[n]&&s[n].unique_userid&&(n=s[n].unique_userid,editor.doc.removeUserData(n))}},MsgHandler.handleServerDown=function(){ZWOffline.isOfflineSetupDone&&"SHAREDREAD"===editor.doc.getRole()&&"TEMPLATE_USER"!==editor.doc.getRole()&&(J("#home_ro_toolbar").remove(),ZWOffline.disableOnlineFeatures(),Utils.retryNetwork())},MsgHandler.handleServerUp=function(){if(EditorUtil.joinCollaboration(),ZWCollaboration.serverupInvoked){if(!editor.isEditable())return;return ZWCollaboration.LASTREQUEST_TIMESTAMP=(new Date).getTime(),void ZWCollaboration.checkForResend()}ZWCollaboration.serverupInvoked=!1,ZWCollaboration.serverupInvoked=!0},MsgHandler.handleBroadcastMessage=function(e,t,n,i,o){var r=editor.doc.getDocInfo();if("CREATE_VERSION"==o.ACTION)return void editor.doc.setDocInfo({DOCS_VERSION:o.DOCS_VERSION});if(e==r.COLLAB_ID){var a=o.ACTION;if(n||(n=i,i=editor.doc.getUserData()[n].fname),"DOCUMENT_FINAL_STATE_UPDATE"==o.ACTION)return void PubSub.publish("Document/FinalStateUpdated",o.docInfo);if("IMAGESAVE"==o.ACTION)return void(o.SESSIONID!=editor.uuid&&DomUtil.updateImageSrc(o.IMGSRC));if("DOCUMENT_PUBLISH"==o.ACTION)Publish.wmsMsgHandler(o.data);else{if("CHANGEPERMISSION"==o.ACTION)return void PubSub.publish("Collaboration/DocPermissionChanged",o.OWNER);if("REVERT"==a)return void(editor.isEditable()||r.CREATOR_ZUID==editor.zuid?PubSub.publish("Collaboration/DocumentReverted",i,moment(o.UPDATED_TIME).format("llll"),n,o):UIUtils.showMessage("info",J.i18n("common","REVERTED_INFO",[i,moment(o.UPDATED_TIME).format("MMM DD YYYY, hh:mm A")]),"showclose","normalfont",5e3));if("csv_update"==o.ACTION)return void UIUtils.showMessagePopup(o.MSG,J.i18n("common","ALERT"),"info",function(){document.location.reload()},!0);if("REMIGRATE"==a)return void PubSub.publish("Collaboration/DocumentMigratedTo3.0");if("VERSION_UPLOAD"==a)return void PubSub.publish("Document/Warning",WARNING_MSG.NEW_VERSION_UPLOADED);if("MailMergeFieldAdded"==a){var s=o.mminfo;return MailMergeDataModel.addField(s),void MailMerge.addMergeField(s)}if("MailMergeFieldUpdated"==a){var s=o.mminfo;return MailMerge.modifyMergeField(s),void MailMergeDataModel.modifyField(s,!0)}if("MailMergeFieldDeleted"==a){var s=o.mminfo;return MailMerge.removeMergeField(s),void MailMergeDataModel.modifyField(s,!1)}}if(ZWCollaboration.syncSent||Utils.isNonEditableView()||ZWCollaboration.stopUpdates||e!==r.COLLAB_ID)return void Utils.log("Return broadcast msg:"+ZWCollaboration.syncSent);if("CHAT"==a)n!=editor.zuid&&CollabPanelHandler.addChatMessage(i,o.MESSAGE);else if("UPDATESEG"==a){var l=o.VERSION,d=o.SESSIONID,c=o.REVISION,u={version:parseInt(l),revision:parseInt(c)},p={version:parseInt(r.VERSION),revision:parseInt(r.REVISION)},h=DocUtil.getVersionNumberDiff(u,p);if(d==editor.uuid)return;if(h<0)return;if(0==h){if(d!=editor.uuid&&o.mc)for(var f,m=jQuery.parseJSON(o.mc),g=0,T=m.length,_=editor.doc.getSelection();g<T;g++)f=_.createCursorOp(m[g].si,m[g].ei,n),f=DocOpBuilder.build(f),ZWCollaboration.applyCollaboratorsMutation(f,o,d,n,!0,i,g);return}if(1==h){if(d!=editor.uuid&&o.mc&&!o.COMPOSEDOP)return void ZWCollaboration.checkServerVersion()}else if(h>1||o.FETCHOPS&&d!=editor.uuid)return void ZWCollaboration.checkServerVersion();if(d!=editor.uuid){if(o.COMPOSEDOP){Utils.log("handleBroadcastMessageEDIT RECD FROM "+i+" @ "+l+"."+c);var E=DocOpBuilder.build(o.COMPOSEDOP);ZWCollaboration.applyCollaboratorsMutation(E,o,d,n,!1,i)}if(o.mc)for(var m=jQuery.parseJSON(o.mc),g=0,T=m.length,_=editor.doc.getSelection();g<T;g++)f=_.createCursorOp(m[g].si,m[g].ei,n),f=DocOpBuilder.build(f),ZWCollaboration.applyCollaboratorsMutation(f,o,d,n,!0,i,g);CommentUtils.getSequenceDiff(o.comment_sequence_number)>0&&(Utils.log("Comments sequence number has incremented, along with this doc op. Calling comment sync..."),CommentUtils.syncup())}}else if("REDACTSYNC"==o.ACTION&&editor.zuid!=o.zuid)ZWCollaboration.checkServerVersion();else if("HANDLE_TRASH"==a||"REVERT_TO_W2"==a)o.ZUID==editor.zuid?PubSub.publish("Document/Trashed",o.MSG_TO_OWNER):PubSub.publish("Document/Trashed",o.MSG_TO_SHRD_USER);else if("LOCK_DOCUMENT"==a)o.USER_ZUID!==editor.zuid&&(o.LOCK?editor.lock():editor.unlock());else if("REMOTE_TRASH"==a)PubSub.publish("Document/RemoteTrashed");else if("SPELL_CHECK"==a)editor.zuid!=n&&SpellCheck.addSuggestions(o.suggestions);else if("SESSION_INVALID"===a){var v={src:o.JSPATH+"js/zwsession_invalid.js"};loadJS(v)}else if("comment"==a){if(o.comment&&o.SESSIONID!=editor.uuid){U.keys(o.comment).map(function(e){return parseInt(e)}).sort();if(CommentUtils.getSequenceDiff(o.comment_sequence_number)<=0)return;for(var S=CommentModels.comment_sequence_number+1;S<=o.comment_sequence_number;S++){var b=o.comment[S];if(!b)return Utils.log("Expected sequence of op is missing, while recieving collaborator's comment ops. Calling comment sync..."),CommentUtils.syncup(),!1;PubSub.publish("Comment/CollaboratorOperationRecieved",[b],n,S)}}}else if("USERCOLOR_UPDATED"==o.ACTION){var R=editor.doc.getUserData(),O=o.USER_DATA,n=O.zuid;return void(R[n]&&(R[n].color=O.color,R[n].light_color=O.lightColor,editor.doc.setUserData(R),PubSub.publish("Collaboration/UsercolorUpdated",n)))}}},MsgHandler.handleCustomMessage=function(e){var t=editor.doc.getDocInfo();if("ZWUSER_SESSION_MANAGEMENT"===e.ACTION){var n=e.SUBACTION;return void("ZW_SESSION_RELOAD"===n?window.location.reload():"ZW_SESSION_LOGOUT"===n?window.location.href="/writer/jsp/logout.jsp?ref=a_wms":"ZW_SESSION_TAB_CLOSE"===n&&window.close())}if(!e.COLLABID||e.COLLABID==t.COLLAB_ID){var i=e.ACTION;if("VERSION_UPLOAD"==i)if(e.VERSION&&e.REVISION){var o=DocUtil.getVersionFromMsg(e),r=DocUtil.getCurrentDocVersion(),a=DocUtil.getVersionNumberDiff(r,o);a<0&&ZWCollaboration.updateVersion(e.VERSION,e.REVISION,e.DOCS_VERSION)}else PubSub.publish("Document/Warning",WARNING_MSG.NEW_VERSION_UPLOADED);else if("UPDATESEG"==i)MsgHandler.handleBroadcastMessage(e.COLLABID,e.zuid,e.zuid,e.uname,e);else if("PARTNER_REMOTESAVERESPONSE"===i){var s=e.statusValue,l=e.statusCode;REMOTE_MESSAGE[s]?UIUtils.showLoadingMsg(J.i18n(REMOTE_MESSAGE[s]),5e3):"datasaved"==s?(UIUtils.showLoadingMsg(J.i18n("writer.remotesave.SUCCESS"),3e3),RemoteEditor.documentModified=!1):"responsenull"==s?200!=l?UIUtils.showLoadingMsg(J.i18n("writer.remotesave.REMOTESAVE_ERR_MSG1"),5e3):(RemoteEditor.documentModified=!1,UIUtils.showLoadingMsg(J.i18n("writer.remotesave.SUCCESS"),3e3)):200!=l?UIUtils.showLoadingMsg(s,5e3):(UIUtils.showLoadingMsg(s,3e3),RemoteEditor.documentModified=!1)}else"CHATBAR_VIEW_CHANGED"==e.ACTION&&e.SESSIONID!=editor.uuid&&UIUtils.handleChatBarView(e.SHOWCHATBAR)}};var SHAREDUSERSLIST=[];MsgHandler.handleUserAdd=function(e,t){e==editor.doc.getDocInfo().COLLAB_ID&&jQuery.map(t,function(e,t){SHAREDUSERSLIST.push(e)})},MsgHandler.handleUserDeleted=function(e,t){if(e==editor.doc.getDocInfo().COLLAB_ID){editor.loginName!=t[0].uname&&editor.zuid!=t[0].uname||ZWCollaboration.htabs.deleteTabArray(editor.doc.getDocInfo().DOCUMENT_ID.split(","));for(var n=SHAREDUSERSLIST.length,i=0;i<n;i++){var o=SHAREDUSERSLIST[i],r=o.uname;if(t[0].uname==r){SHAREDUSERSLIST.splice(i,1);break}}}},MsgHandler.handleCrossProductMessage=function(e,t){var n=t.ACTION,i=t.RESOURCE_ID;if("EX"===e&&"UDSERVER_UPLOAD"===n&&FCImport.updateImportStatus(t),"SG"===e){var o=JSON.parse(t);o.account_created&&PubSub.publish("Esign/ZohoSign/Account/Added",o)}if("ESIGN"===n)return void EsignController.wmsMsgHandler(t.data||{});if("POST_TO_BLOG"===n)return void Wordpress.wmsMsgHandler(t.data||{});if("ORG_POLICY_CHANGED"===n)return editor.setOrgPolicy(t.data||{}),void PubSub.publish("OrgPolicy/Changed");if(i==editor.doc.getDocInfo().RID){var r=t.ACTION_BY,a=t.ACTION_BY_USERNAME,s=editor.zuid,l=t.ACTION_INFO;switch(l=l?l:"{}",l=JSON.parse(l),n){case"RESOURCE_RENAMED":return void Utils.fetchDocName();case"RESOURCE_PERMISSION_CHANGED":return void(s!=r&&PubSub.publish("Collaboration/DocPermissionChanged",r,a));case"RESOURCE_SHARED":return void PubSub.publish("Collaboration/ResourceShared",r,a);case"RESOURCE_UNSHARED":var d=l.SHARED_TO;return s==d?void PubSub.publish("Collaboration/ResourceUnshared",r,a):void ZWCollaboration.removeCollaborator(d);case"RESOURCE_TRASHED":return void PubSub.publish("Collaboration/ResourceTrashed",r,a);case"RESOURCE_LOCKED":return void PubSub.publish("Collaboration/ResourceLocked",r,a,!0,l.hasOwnProperty(ATTR_BODY.TC_ISREVIEWPAGE));case"RESOURCE_UNLOCKED":return void PubSub.publish("Collaboration/ResourceUnLocked",r,a,l.hasOwnProperty(ATTR_BODY.TC_ISREVIEWPAGE))}}},MsgHandler.processAcknowledgement=function(e){var t=DocUtil.getVersionFromMsg(e),n=DocUtil.getCurrentDocVersion(),i=DocUtil.getVersionNumberDiff(t,n);Utils.log("processAcknowledgementRES:"+t.version+"."+t.revision+",DIFF:"+i),1==i?(ZWCollaboration.msgQueue.ackReceived(),ZWCollaboration.updateVersion(e.VERSION,e.REVISION,e.DOCS_VERSION),ZWCollaboration.sendPendingMutation(),PubSub.publish("Document/SaveStatus",!0,void 0,editor.zuid),e.MAX_REVISION&&(MAX_REVISION=e.MAX_REVISION)):i>1&&ZWCollaboration.checkServerVersion()},MsgHandler.openURL=function(e,t,n,i){return"WR"===i},MsgHandler.handleLogout=function(e){},MsgHandler.getPageTitle=function(){var e=editor.doc.getDocInfo();if(e&&e.DOCUMENT_NAME)return e.DOCUMENT_NAME},MsgHandler.handleComposeMail=function(e,t){return!1},PubSub.subscribe("Document/InitEditor",function(){PubSub.subscribe("WMS/UserPresence",MsgHandler.handlePresence),PubSub.subscribe("WMS/ServerUp",MsgHandler.handleServerUp),PubSub.subscribe("WMS/ServerDown",MsgHandler.handleServerDown),PubSub.subscribe("WMS/Message",MsgHandler.handleBroadcastMessage),PubSub.subscribe("WMS/CustomMessage",MsgHandler.handleCustomMessage),PubSub.subscribe("WMS/UserAdded",MsgHandler.handleUserAdd),PubSub.subscribe("WMS/UserDeleted",MsgHandler.handleUserDeleted),PubSub.subscribe("WMS/CrossProductMessage",MsgHandler.handleCrossProductMessage),PubSub.subscribe("WMS/Logout",MsgHandler.handleLogout)}),function(e){function t(t){return function(){var i=[t].concat(n.call(arguments,0));e.publish.apply(e,i)}}var n=Array.prototype.slice,i={handleUserList:"WMS/UserList",handlePresence:"WMS/UserPresence",handleBroadcastMessage:"WMS/Message",handleServerUp:"WMS/ServerUp",handleServerDown:"WMS/ServerDown",handleUserAdd:"WMS/UserAdded",handleUserDeleted:"WMS/UserDeleted",handleCrossProductMessage:"WMS/CrossProductMessage",handleLogout:"WMS/Logout",handleCustomMessage:"WMS/CustomMessage"},o={handleJoin:function(e){WebMessanger.join(e)},handleQuit:function(e){return WebMessanger.quit(e)},openURL:function(e,t,n,i){return"WR"===i},getPageTitle:function(){var e=editor.doc.getDocInfo();return e&&e.DOCUMENT_NAME?e.DOCUMENT_NAME:null},handleComposeMail:function(e,t){return!1}};for(var r in i)o[r]=t(i[r]);this.CollabHandler=o}(PubSub),function(){var e=function(){},t=window.CollabHandler;window.Collaboration={handleUserList:t.handleUserList,handlePresence:t.handlePresence,join:t.handleJoin,handleMessage:t.handleBroadcastMessage,quit:t.handleQuit,serverup:t.handleServerUp,openURL:t.openURL,handleUserAdd:t.handleUserAdd,handleUserDeleted:t.handleUserDeleted,handleCrossProductMessage:t.handleCrossProductMessage,handleLogout:t.handleLogout,getPageTitle:t.getPageTitle,handleComposeMail:t.handleComposeMail,handleCustomMessage:t.handleCustomMessage,serverdown:t.handleServerDown,wmsOffline:e,handleLanguageChange:e,handleZohoMessage:e,onConnect:e,handleCollabAdd:e,handleCollabDelete:e,handleIsOnline:e,goOffline:e,handleWmsDisable:e,handleChatNotifyMessage:e,handleServiceMessage:e}}(),ZWCollaboration.logger=new ZWLogger,ZWCollaboration.reqId=0,ZWCollaboration.docOpIds=[],ZWCollaboration.startingVersion=0,ZWCollaboration.contentEdited=!1,ZWCollaboration.stopUpdates=!1,ZWCollaboration.syncSent=!1,ZWCollaboration.serverupInvoked=!1,ZWCollaboration.SYNC_TIMER=5e3,ZWCollaboration.MUTATION_SEND_VERSION=1,ZWCollaboration.MUTATION_SEND_REVISION=0,ZWCollaboration.SERVER_SLOW_RESPONSE_TIMEOUT="undefined"!=typeof serviceName&&"WRITER_GDRIVE"===serviceName?6e4:3e4,ZWCollaboration.SYNCOP_VDIFF_INVALID="SVI_100",ZWCollaboration.SYNCOP_CLIENT_VERSION_GREATER="SCVG_100",ZWCollaboration.SYNCOP_DELTA_INVALIDCOUNT="SVC_200",ZWCollaboration.SYNCOP_DELTA_EMPTY="SVD_300",ZWCollaboration.SERVER_EXCEPTION="SXP_400",ZWCollaboration.SYNCOP_RESP_ERROR="SRE_500",ZWCollaboration.REDIS_EXCEPTION="RXP_400",ZWCollaboration.RESENDVERIFY_RELOAD_EXCEPTION="RELOAD_100",ZWCollaboration.OP_TC_ERROR="CTC_100",ZWCollaboration.ENDNOTE_TC_ERROR="CTC_101",ZWCollaboration.DELETE_TC_BLOCK_ERROR="CTC_102",ZWCollaboration.TC_NOMARKUP_OPS_PROCESSING_ERROR="CTC_103",ZWCollaboration.TC_USER_COLORS_NOT_LOADED="CTC_104",ZWCollaboration.TC_NO_MARKUP_CLIENT_ERROR="CTC_105",ZWCollaboration.OP_LK_ERROR="CLK_100",ZWCollaboration.DT_DOM_RENDERING_ERROR="CDTDOM_100",ZWCollaboration.DT_DOM_RENDERING_INVISIBLE_ERROR="CDTDOM_101",ZWCollaboration.COLLAB_OP_APPLYTO_ERROR="CCAT_100",ZWCollaboration.OP_APPLYTO_ERROR="CAT_100",ZWCollaboration.OP_APPLYTO_ERROR_DOM="CAT_101",ZWCollaboration.OP_APPLYTO_ERROR_DOC="CAT_102",ZWCollaboration.SP_LANG_NOT_SUPPORTED_ERROR="CSL_100",ZWCollaboration.SHOW_CARET_ERROR="CSC_200",ZWCollaboration.SHOW_CARET_GETPORTION_ERROR="CSC_201",ZWCollaboration.SHOW_CARET_SELECTION_ERROR="CSC_204",ZWCollaboration.SHOW_CARET_PLACENODE_ERROR="CSC_205",ZWCollaboration.CURSOR_IDX_ERROR="CSC_207",ZWCollaboration.SET_CURSOR_ERROR="CSC_208",ZWCollaboration.SET_COLLAB_CURSOR_ERROR="CSC_209",ZWCollaboration.SHOW_SELECTION_ERROR="CSS_700",ZWCollaboration.API_NEGATIVE_IDX="CNI_300",ZWCollaboration.API_IOB_IDX="CIO_400",ZWCollaboration.OP_IDX_IOB="CIO_500",ZWCollaboration.OP_RESEND_ERROR="CRE_600",ZWCollaboration.OP_PROCESSING_ERR="COPE_800",ZWCollaboration.TABLE_API_IDX_ERR="CTAI_900",ZWCollaboration.ACKPENDING_ERROR="ACK_100",ZWCollaboration.CHECKSERVERVERSION_LOOP_ERROR="ACK_101",ZWCollaboration.CHECKFORRESEND_LOOP_ERROR="ACK_102",ZWCollaboration.RESENDMUTATION_LOOP_ERROR="ACK_103",ZWCollaboration.FINDNEXTINDEXOF_GREATER_ERROR="FNI_111",ZWCollaboration.FONT_METRICS_ERROR="FMT_100",ZWCollaboration.SERVER_ERROR_502_BAD_GATEWAY="SXP_700",ZWCollaboration.SXP_ERR_100="SXP_ERR_100",ZWCollaboration.HISTORY_COMPARE_ERROR="CHI_101",ZWCollaboration.HISTORY_QUICK_COMPARE_ERROR="CHI_102",ZWCollaboration.TABLE_INSERT_COLUMN="CTBL_101",ZWCollaboration.TABLE_INSERT_ROW="CTBL_102",ZWCollaboration.TABLE_DELETE_COLUMN="CTBL_103",ZWCollaboration.TABLE_DELETE_ROW="CTBL_104",ZWCollaboration.TABLE_DISTRIBUTE_COLUMNS="CTBL_105",ZWCollaboration.TABLE_FIXED_COLUMN_WIDTH="CTBL_106",ZWCollaboration.TABLE_FIT_TO_WINDOW="CTBL_107",ZWCollaboration.ROW_RESIZE_HEIGHT="CTBL_108",ZWCollaboration.clientInfo="",ZWCollaboration.operationSequence=[],ZWCollaboration.checkForResendCount=0,ZWCollaboration.checkServerVersionCount=0,ZWCollaboration.SERVERCHECK_MAXCOUNT=3,ZWCollaboration.mutationResendCount=0,ZWCollaboration.MUTATIONRESEND_MAXCOUNT=3,ZWCollaboration.RESULT_ACK_PENDING=1,ZWCollaboration.RESULT_NOTHING_TO_SEND=2,ZWCollaboration.RESULT_SEND_STOPPED=3,ZWCollaboration.RESULT_SUCCESS=4,Error.stackTraceLimit=30,ZWCollaboration.getWMSSessionId=function(){return encodeURIComponent(WebMessanger.getSid())},ZWCollaboration.getWMSRawSessionId=function(){return WebMessanger.getRawSid()?encodeURIComponent(WebMessanger.getRawSid()):void 0},ZWCollaboration.addToQueue=function(e){if(ZWCollaboration.msgQueue.isAckPending()){var t=(new Date).getTime();t-ZWCollaboration.LASTREQUEST_TIMESTAMP>ZWCollaboration.SERVER_SLOW_RESPONSE_TIMEOUT+5e3&&(Utils.log("Slow Response"),ZWCollaboration.LASTREQUEST_TIMESTAMP=t,PubSub.publish("Document/Error",{title:"TITLE_SERVER_BUSY",errorNo:ZWCollaboration.ACKPENDING_ERROR,errorMsg:"MSG_SERVER_BUSY"}))}ZWCollaboration.msgQueue.add(e)},ZWCollaboration.resendMutation=function(){var e=ZWCollaboration.msgQueue.getAckPendingEdit();if(e){if(ZWCollaboration.mutationResendCount>=ZWCollaboration.MUTATIONRESEND_MAXCOUNT)return ZWCollaboration.mutationResendCount=0,void PubSub.publish("Document/Error",{title:"TITLE_SERVER_BUSY",errorNo:ZWCollaboration.RESENDMUTATION_LOOP_ERROR,errorMsg:"MSG_SERVER_BUSY"});ZWCollaboration.mutationResendCount++,ZWCollaboration.sendMessage(e,ZWCollaboration.handleSendMutationSuccess,ZWCollaboration.handleSendMutationError)}},ZWCollaboration.sendCursorMutation=function(){ZWCollaboration.msgQueue.isAckPending()||ZWCollaboration.sendMessage()},ZWCollaboration.sendPendingMutation=function(){if(ZWCollaboration.msgQueue.isAckPending())return ZWCollaboration.RESULT_ACK_PENDING;if(ZWCollaboration.stopUpdates)return ZWCollaboration.RESULT_SEND_STOPPED;var e=ZWCollaboration.msgQueue.shift();return!CommentModels.queue.getAckPendingEdit()&&CommentModels.queue.shift(),e?(e&&Utils.log("DOC OP IDS  :::::: "+e.docOpIds),ZWCollaboration.sendMessage(e,ZWCollaboration.handleSendMutationSuccess,ZWCollaboration.handleSendMutationError)):(ZWOffline.isOfflineSetupDone&&ZWOffline.isSyncing&&"TEMPLATE_USER"!==editor.doc.getRole()&&ZWOffline.CurrentDocSyncComplete(),ZWCollaboration.RESULT_NOTHING_TO_SEND)},ZWCollaboration.sendMessage=function(e,t,n){var i={},o=editor.doc.getDocInfo();e&&(PubSub.publish("Document/SaveStatus",J.i18n("editor","SAVING")),i.ops=e.toString());var r="SHAREDREADCOMMENT"!=editor.doc.getRole()&&"ANYONELINK_SHAREDREADCOMMENT"!=editor.doc.getRole()?"update":"commentop",a=Utils.getUrl(r);i.sid=editor.uuid,i.version=o.VERSION,i.revision=o.REVISION,i.reqId=ZWCollaboration.reqId++;var s=editor.doc.getSelection(),l=s.getCursorOp();l&&(editor.doc.getTrackChangeDetails().isNoMarkupON()&&(l=TcNoMarkupHandler.processClientToServerCursorOp(l)),i.mc=l),i.tstamp=(new Date).getTime(),1===o.VERSION&&0===o.REVISION&&(i.docsFolderId=docsFolderId),"REMOTE"==editor.getEditorType()?(i.rsid=RemoteEditor.rsid,RemoteEditor.documentModified=!0):i.rid=o.RID,Utils.setCsrfParam(i),ZWCollaboration.MUTATION_SEND_VERSION=o.VERSION,ZWCollaboration.MUTATION_SEND_REVISION=o.REVISION,ZWCollaboration.LASTREQUEST_TIMESTAMP=(new Date).getTime(),Utils.log("sendMutation |  OP STR :: "+e);var d=!!(e&&e.toString().length>75e3),c={type:"POST",dataType:"json",global:!1,timeout:ZWCollaboration.SERVER_SLOW_RESPONSE_TIMEOUT,url:a,data:i,error:n,success:t,beforeSend:function(){Utils.log("sendMutation-beforeSend")}};if("update"==r&&d){var u=new FormData;content=new Blob([e.toString()],{type:"text/plain"}),delete i.ops;for(var p in i)u.append(p,i[p]);u.append("opsfile",content),c.data=u,c.enctype="multipart/form-data;",c.contentType=!1,c.processData=!1}return J.ajax(c),ZWCollaboration.RESULT_SUCCESS},ZWCollaboration.handleSendMutationError=function(e,t,n){Utils.log("handleSendMutationError"+e.status+","+t),PubSub.publish("Document/Mutation/SendError",e)},ZWCollaboration.handleSendMutationSuccess=function(e){if(!e)return void ZWCollaboration.checkForResend();var t=e.UPDATE;switch(PubSub.publish("Document/Mutation/SendSuccess",t,e),t){case"SUCCESS":editor.doc.getDocInfo().newDoc=!1,ZWCollaboration.syncSent||(MsgHandler.processAcknowledgement(e),Lock.updateLockStatus());break;case"SAMEVERSIONREVISION":return void ZWCollaboration.checkForResend();case"FAILED":return void ZWCollaboration.handleUpdateFailure();case"OPUPDATEFAILED_INLOCKSTATE":return void PubSub.publish("Collaboration/LockReceived",editor.doc.docInfo.CREATOR_HTML);case"RESEND":return void ZWCollaboration.resendMutation();case"CHECKEDOUT":return void PubSub.publish("Document/SaveStatus",!1,void 0);case"SAVE_FAILURE":var n=e.errorCode,i=["<a href='#' onclick='document.location.reload();'>","</a>"];return UIUtils.showFreezeMessage(!0,"warning",n+" : "+J.i18n("writer.editor.ZFS_EXCEPTION",i)),J("#network_error_parent").css({"margin-left":"22%"}),void clearTimeout(Collaboration.slowRespTimer);case"REDIS_VERSION_MISMATCH":return void PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.REDIS_EXCEPTION,errorMsg:"MSG_EDIT_ERROR"});case"REMOTE_TRASH":return void PubSub.publish("Document/RemoteTrashed");case"RESOURCE_TRASHED":return void PubSub.publish("Collaboration/ResourceTrashed",editor.doc.docInfo.CREATOR_ZUID,editor.doc.docInfo.CREATOR);case"READ_ONLY_USER":return void PubSub.publish("Document/unauthorizededit");case"PERMISSIONDENIED_FOR_LOCK":return void PubSub.publish("Collaboration/LockNotAllowed")}},ZWCollaboration.handleUpdateFailure=function(){editor.setEditable(!1),PubSub.publish("Document/SaveStatus",!1,J.i18n("writer.common.SAVE_FAILURE")),PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.SERVER_EXCEPTION,errorMsg:"MSG_EDIT_ERROR"})},ZWCollaboration.handleRenameSaveSuccess=function(e){editor.doc.getDocInfo().newDoc=!1,PubSub.publish("Document/Renamed")},ZWCollaboration.checkForResend=function(){if(!ZWCollaboration.msgQueue.isAckPending())return void(ZWOffline.isOfflineSetupDone&&ZWOffline.isSyncing&&"TEMPLATE_USER"!==editor.doc.getRole()&&ZWOffline.CurrentDocSyncComplete());if(!(ZWCollaboration.checkForResendCount<ZWCollaboration.SERVERCHECK_MAXCOUNT))return UIUtils.UnfreezeEditor(),ZWCollaboration.checkForResendCount=0,void PubSub.publish("Document/Error",{title:"TITLE_SERVER_BUSY",errorNo:ZWCollaboration.CHECKFORRESEND_LOOP_ERROR,errorMsg:"MSG_SERVER_BUSY"});ZWCollaboration.checkForResendCount++,Utils.log("CheckForResend"+ZWCollaboration.MUTATION_SEND_VERSION+"."+ZWCollaboration.MUTATION_SEND_REVISION);var e={},t=editor.doc.getDocInfo();e.rid=t.RID,e.sid=editor.uuid,e.version=ZWCollaboration.MUTATION_SEND_VERSION,e.revision=ZWCollaboration.MUTATION_SEND_REVISION,e.tstamp=(new Date).getTime();var n=Utils.getUrl("resendVerify");"REMOTE"==editor.getEditorType()&&(e.rsid=RemoteEditor.rsid),Utils.setCsrfParam(e),J.ajax({type:"POST",dataType:"json",global:!1,url:n,data:e,timeout:ZWCollaboration.SERVER_SLOW_RESPONSE_TIMEOUT,error:function(e,t,n){UIUtils.UnfreezeEditor();var i=e.getResponseHeader("Content-Type"),o=e.responseJSON||{};if(200==e.status&&i.toLowerCase().indexOf("text/html")>=0)PubSub.publish("User/SignedOut");else if("RELOAD"==o.RESPONSE)PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.RESENDVERIFY_RELOAD_EXCEPTION,errorMsg:"MSG_EDIT_ERROR"});else{if("REMOTE_TRASH"!=o.RESPONSE)return void PubSub.publish("System/NetworkFailure");PubSub.publish("Document/RemoteTrashed")}},success:function(e){if(e){if(UIUtils.UnfreezeEditor(),ZWCollaboration.stopUpdates=!1,ZWCollaboration.checkForResendCount=0,"RESEND"==e.RESPONSE)return void ZWCollaboration.resendMutation();if("NORESEND"===e.RESPONSE)return void ZWCollaboration.checkServerVersion();"RELOAD"==e.RESPONSE?PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.RESENDVERIFY_RELOAD_EXCEPTION,errorMsg:"MSG_EDIT_ERROR"}):"REMOTE_TRASH"==e.RESPONSE&&PubSub.publish("Document/RemoteTrashed")}else setTimeout(ZWCollaboration.checkForResend,ZWCollaboration.SYNC_TIMER)}})},ZWCollaboration.applyCollaboratorsMutation=function(e,t,n,i,o,r,a){if(e){var s=ZWCollaboration.msgQueue.xform(e),l=e.redactContent;if(o){var d,c,u=s.getCursorPos()[0];if(d=u.start>0?u.start:u.end,c=u.end?u.end:u.start,editor.doc.getTrackChangeDetails().isNoMarkupON()){var p=TcNoMarkupHandler.processServerToClientCursorOp(d,c);d=p.start,c=p.end}var h=DocTreeManager.lineAtIndex(d),f=DocTreeManager.lineAtIndex(c);if(!h||!f)return editor.doc.setDomCursorIdx(n,"start",d),void editor.doc.setDomCursorIdx(n,"end",c);if(a=a||0,!editor.doc.domCursor[n])return void ZWCollaboration.logger.warn("@applyCollaboratorsMutation: There is no domCursor for\n"+n);var m=editor.doc.getSelection(n)||editor.doc.createSelection(n);0==a&&m.removeAllRanges(),m.showCaret(editor.doc.createRange(d,c,n)),CurUtil.showCollbUserName(n),PubSub.publish("Collaboration/UserCursor",{sid:n,start:d,end:c})}else{if(s.zuid=i||"collabop",editor.currentCommand=COMMAND.ANY,editor.doc.snapShotManager.flushTypedCharOps(),editor.doc.getTrackChangeDetails().isNoMarkupON()&&(s=TcNoMarkupHandler.processServerToClientOp(s)),editor.doc.snapShotManager.transformCollaboratorsOp(s),ZWCollaboration.transformAndApplyOthersCursor(s,n),editor.doc.locks&&!s.isLock)try{var g=DocOpBuilder.xform(editor.doc.locks,s);s=DocOpBuilder.concise(g.second),editor.doc.locks=DocOpBuilder.concise(g.first)}catch(e){if(Utils.log("serverOp: "+s.toString()),Utils.log("Exception: "+(e.stack||e)),"Error in xform lock"!=e){var T=new Error(ZWCollaboration.OP_LK_ERROR);throw editor.lastError=T,T}return PubSub.publish("DocOperation/LockError"),void Op.resetBuffer()}try{s.redactContent=l,editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!0),s.applyTo({operation:"collabop",cursor:DocUtil.copyStyle(editor.doc.domCursor),sid:n}),editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!1)}catch(e){Utils.log("serverOp: "+s.toString()),Utils.log("Exception: "+(e.stack||e));var _=e.message;throw _===ZWCollaboration.SET_CURSOR_ERROR||_===ZWCollaboration.SET_COLLAB_CURSOR_ERROR?editor.lastError=e:editor.lastError=new Error(ZWCollaboration.COLLAB_OP_APPLYTO_ERROR),editor.lastError}var E="";r&&(E=" by "+r),PubSub.publish("Document/SaveStatus",!0,void 0,i),ZWCollaboration.updateVersion(t.VERSION,t.REVISION,t.DOCS_VERSION)}}},ZWCollaboration.getRangesInRegionOfUser=function(e){var t=[],n=editor.doc.getSelection(e);if(!n)return t;var i=n.getLastRange();if(!i)return t;var o,r,a,s=DocTreeManager.getTreeNodeAtIndex(i.start),l=DocTreeManager.getTreeNodeAtIndex(i.end),d=s.getIndex(),c=l.getEndIndex(),u=editor.doc.getAllSelections();for(o in u)if((n=u[o])&&n.SID!==e)for(r=0,a=n.length;r<a;r++)i=n.getRangeAt(r),(i.isIntersectWithRange(editor.doc.createRange(d,c))||i.isTableSelected())&&(i.SID=o,t.push(i));return t},ZWCollaboration.transformAndApplyOthersCursor=function(e,t){var n,i,o,r,a,s,l,d,c,u,p,h,f,m=[];for(n in editor.doc.domCursor)if(i=t===n||!editor.doc.domCursor.hasOwnProperty(n),!i&&editor.doc.domCursor[n].start&&(o=editor.doc.getSelection(n))&&o.length){for(r=editor.doc.domCursor[n].zuid,a=0,s=o.length||0;a<s;a++)l=o.getRangeAt(a).createOp(r),m[a]=DocOpBuilder.build(l);for(d=m[0],a=1,s=m.length;a<s;a++)d=DocOpBuilder.compose(d,m[a]);for(h=DocOpBuilder.xform(d,e),d=h.first,f=d.getCursorPos(),a=0,s=f.length;a<s;a++)(p=o.getRangeAt(a))&&(c=f[a].start>0?f[a].start:f[a].end,u=f[a].end?f[a].end:f[a].start,p.setFocus(!1).setStart(c).setEnd(u));editor.doc.setDomCursorIdx(n,"start",c),editor.doc.setDomCursorIdx(n,"end",u)}},ZWCollaboration.updateCollabUsersRanges=function(e,t){for(var n,i=0,o=e.length;i<o;i++)if(e[i]&&(n=e[i].SID)&&n!=editor.uuid&&(editor.doc.domCursor[n]||{}).start)try{if(!editor.doc.domCursor[n])return void ZWCollaboration.logger.warn("@updateCollabUsersRanges: There is no domCursor for\n"+n);for(var r,a=editor.doc.getSelection(n)||editor.doc.createSelection(n),s=a.toArray(),l=0,d=s.length;l<d;l++)0==l&&a.removeAllRanges(),r=s[l].cloneRange(n),a.showCaret(r);n===t&&CurUtil.showCollbUserName(t)}catch(e){break}},ZWCollaboration.checkServerVersion=function(){if(!ZWCollaboration.stopUpdates){var e=Utils.getUrl("sync"),t=editor.doc.getDocInfo(),n=editorProps.deployment.zohowriter,i={sid:editor.uuid,version:t.VERSION,revision:t.REVISION,tstamp:(new Date).getTime()};"REMOTE"==editor.getEditorType()?i.rsid=RemoteEditor.rsid:i.rid=t.RID,ZWCollaboration.syncSent||(Utils.setCsrfParam(i),Utils.log("sync called:"+JSON.stringify(i)),J.ajax({type:"POST",global:!1,url:e,async:!0,data:i,dataType:"json",error:function(e,t,i){var o=e.getResponseHeader("Content-Type"),r=e.responseJSON||{};if(200==e.status&&o.toLowerCase().indexOf("text/html")>=0)PubSub.publish("User/SignedOut");else{if(r&&"FAILED"==r.UPDATE){var a=r.REASON;return"REVERTED_REVISION"===a?void UIUtils.showMessagePopup(J.i18n("common","REVERT_RELOAD"),n,"info",Utils.reloadDocumentContent,!0):"NEW_VERSION_UPLOAD_STATE"===a?void PubSub.publish("Document/Warning",WARNING_MSG.NEW_VERSION_UPLOADED):"REMOTE_TRASH"==a?void PubSub.publish("Document/RemoteTrashed"):"OPS_NOT_PRESENT"==a?void UIUtils.showMessagePopup(J.i18n("error","CONTENT_REPAIR_ERROR"),J.i18n("error","CONTENT_REPAIR_ERROR_TITLE_MSG"),"info",Utils.reloadDocumentContent,!0):"CLIENT_VERSIONDIFF_EXCEEDS"==a?void UIUtils.showMessagePopup(J.i18n("common","VERSIONDIFF_EXCEED_MSG"),J.i18n("common","VERSIONDIFF_EXCEED_TITLE_MSG"),"warning",Utils.reloadDocumentContent,!0):void PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.SYNCOP_RESP_ERROR,errorMsg:"MSG_EDIT_ERROR"})}if("CLIENT_VERSIONDIFF_EXCEEDS"!=r.UPDATE)return void PubSub.publish("System/NetworkFailure");UIUtils.showMessagePopup(J.i18n("common","VERSIONDIFF_EXCEED_MSG"),J.i18n("common","VERSIONDIFF_EXCEED_TITLE_MSG"),"warning",Utils.reloadDocumentContent,!0)}},success:function(e){if(ZWCollaboration.syncSent=!1,!e)return void(ZWCollaboration.checkServerVersionCount<ZWCollaboration.SERVERCHECK_MAXCOUNT?(ZWCollaboration.checkServerVersionCount++,setTimeout(ZWCollaboration.checkServerVersion,ZWCollaboration.SYNC_TIMER)):(ZWCollaboration.checkServerVersionCount=0,PubSub.publish("Document/Error",{title:"TITLE_SERVER_BUSY",errorNo:ZWCollaboration.CHECKSERVERVERSION_LOOP_ERROR,errorMsg:"MSG_SERVER_BUSY"})));if(ZWCollaboration.checkServerVersionCount=0,"SYNCUP"==e.UPDATE){var t=e.VERSION,i=e.REVISION,o=e.CHANGES,r={version:parseFloat(t),revision:parseInt(i)},a=editor.doc.getDocInfo(),s={version:parseFloat(a.VERSION),revision:parseInt(a.REVISION)};Utils.log("sync success:"+JSON.stringify(r)+", current:"+JSON.stringify(s));var l=DocUtil.getVersionNumberDiff(r,s);if(l<0)return void PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.SYNCOP_VDIFF_INVALID,errorMsg:"MSG_EDIT_ERROR"});if(l>=1){if(0==o.length)return void PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.SYNCOP_DELTA_EMPTY,errorMsg:"MSG_EDIT_ERROR"});if(o.length!=l)return Utils.log("Changes length:"+o.length+",versionDiff:"+l),void PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.SYNCOP_DELTA_INVALIDCOUNT,errorMsg:"MSG_EDIT_ERROR"});ZWCollaboration.handleSyncOpsResponse(e)}CommentUtils.getSequenceDiff(e.comment_sequence_number)>0&&CommentUtils.syncup(),e.MAX_REVISION&&(MAX_REVISION=e.MAX_REVISION)}else{if("FAILED"==e.UPDATE){var d=e.REASON;return"REVERTED_REVISION"===d?void UIUtils.showMessagePopup(J.i18n("common","REVERT_RELOAD"),n,"info",Utils.reloadDocumentContent,!0):"NEW_VERSION_UPLOAD_STATE"===d?void PubSub.publish("Document/Warning",WARNING_MSG.NEW_VERSION_UPLOADED):"REMOTE_TRASH"==d?void PubSub.publish("Document/RemoteTrashed"):"OPS_NOT_PRESENT"==d?void UIUtils.showMessagePopup(J.i18n("error","CONTENT_REPAIR_ERROR"),J.i18n("error","CONTENT_REPAIR_ERROR_TITLE_MSG"),"info",Utils.reloadDocumentContent,!0):void PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.SYNCOP_RESP_ERROR,errorMsg:"MSG_EDIT_ERROR"})}"CLIENT_VERSIONDIFF_EXCEEDS"==e.UPDATE&&UIUtils.showMessagePopup(J.i18n("common","VERSIONDIFF_EXCEED_MSG"),J.i18n("common","VERSIONDIFF_EXCEED_TITLE_MSG"),"warning",Utils.reloadDocumentContent,!0)}}}),ZWCollaboration.syncSent=!0)}},ZWCollaboration.handleSyncOpsResponse=function(e){var t,n,i,o="",r=!1,a=(editor.doc.getDocInfo(),e.CHANGES),s=a.length,i=e.DOCS_VERSION;try{for(var l=0;l<s;l++){var d=a[l],c=d.sid;if(t=d.VERSION,n=d.REVISION,c==editor.uuid)r=!0,ZWCollaboration.applyCollaboratorsMutation(o,{VERSION:t,REVISION:n,DOCS_VERSION:i}),o||ZWCollaboration.updateVersion(t,n,i),o="",PubSub.publish("Document/SaveStatus",!0,void 0,editor.zuid),Utils.log("handleSyncOpsResponse","ack received"),ZWCollaboration.msgQueue.ackReceived();else{var u=DocOpBuilder.build(d.op);u.isLock||u.isRedact||u.isInsideRedact?(1==u.isRedact?u.redactContent=d.redact_content:0==u.isRedact&&(u.redactContent=d.unredact_content),ZWCollaboration.applyCollaboratorsMutation(o,{VERSION:e.VERSION,REVISION:e.REVISION,DOCS_VERSION:i}),o="",ZWCollaboration.applyCollaboratorsMutation(u,{VERSION:e.VERSION,REVISION:e.REVISION,DOCS_VERSION:i})):o=o?DocOpBuilder.compose(o,u):u}}r?(o&&ZWCollaboration.applyCollaboratorsMutation(o,{VERSION:t,REVISION:n,DOCS_VERSION:i}),ZWCollaboration.sendPendingMutation()):o&&ZWCollaboration.applyCollaboratorsMutation(o,{VERSION:t,REVISION:n,DOCS_VERSION:i}),ZWCollaboration.updateVersion(e.VERSION,e.REVISION,e.DOCS_VERSION)}catch(e){try{Utils.log(" SYNC OP RES ERROR OP :: "+JSON.stringify(d)+" : COMPOSED OP : "+JSON.stringify(o))}catch(e){}throw"Error in xform lock"==e&&PubSub.publish("Collaboration/LockReceived",editor.doc.docInfo.CREATOR_HTML),e.message===ZWCollaboration.TC_NOMARKUP_OPS_PROCESSING_ERROR?editor.lastError=e:editor.lastError=new Error(ZWCollaboration.COLLAB_OP_APPLYTO_ERROR),Utils.log("SYNC OP RES ERROR VERSION : "+t+" : "+n),Utils.sendErrorDetails("SYNC RESPOSE ERROR<ZWERROR>"+editor.doc.getDocInfo().VERSION+"."+editor.doc.getDocInfo().REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No =EXPORT DOC DOC len ="+editor.doc.getDocumentLength()+" Pen [0]="+(ZWCollaboration.msgQueue.getAckPendingEdit()?ZWCollaboration.msgQueue.getAckPendingEdit().toString():"")+"[1]="+(ZWCollaboration.msgQueue.getPendingToPushEdit()?ZWCollaboration.msgQueue.getPendingToPushEdit().toString():"")+" FULL DOC OP IDS :: "+ZWCollaboration.docOpIds+" buildLabel::: "+buildLabel+"\n Error Log End \n"),editor.lastError}},ZWCollaboration.isExistingUserSession=function(e){for(var t=!1,n=editor.doc.collabUsers,i=0,o=n.length;i<o;i++)if(n[i].uuid==e){t=!0;break}return t},ZWCollaboration.removeCollabUserUUID=function(e){e!=editor.uuid&&ZWCollaboration.isExistingUserSession(e)&&(Utils.removeObjArray(e,editor.doc.collabUsers),editor.doc.removeSelection(e),DomUtil.removeCursorNode(e,"start"),DomUtil.removeCursorNode(e,"end"),delete editor.doc.domCursor[e])},ZWCollaboration.addCollaborator=function(e,t){if(e&&t)try{var n=editor.doc.getUserData()[e]||{},i=[],o=[];n.uuids&&(i=n.uuids.split(",")),t.uuids&&(o=t.uuids.split(",")),editor.doc.updateUserData(e,t);for(var r=0,a=i.length;r<a;r++)o.contains(i[r])||ZWCollaboration.removeCollabUserUUID(i[r]);if(o.length>0){for(var r=0,a=o.length;r<a;r++)o[r]==editor.uuid||ZWCollaboration.isExistingUserSession(o[r])||(editor.doc.collabUsers.push({zuid:e,uuid:o[r],dname:t.fname,status:"active"}),editor.doc.createDomCursor(o[r],e));CollabPanelHandler.addCollaborator(e,t.fname,t.color)}}catch(e){}},ZWCollaboration.removeCollaborator=function(e){if(e)try{var t=editor.doc.getUserData()[e]||{},n=[];t.uuids&&(n=t.uuids.split(",")),t.uuids="",editor.doc.updateUserData(e,t);for(var i=0,o=n.length;i<o;i++)ZWCollaboration.removeCollabUserUUID(n[i]);CollabPanelHandler.removeCollaborator(e,t.fname)}catch(e){}},ZWCollaboration.updateVersion=function(e,t,n){var i={VERSION:e,REVISION:t};n&&(i.DOCS_VERSION=n),editor.doc.setDocInfo(i)};var Proofing=function(e,t){var n=!1,i=navigator.language,o=i,r={locale:"Auto","en-US":"English(US)","en-GB":"English(UK)","fr-FR":"French","de-DE":"German(DE)","pt-PT":"Portuguese(PT)",ru:"Russian","es-ES":"Spanish(ES)"},a={"af-za":"af-ZA",af:"af-ZA",am:"am",ar:"ar","ar-eg":"ar","ar-sa":"ar","ar-iq":"ar","ar-jo":"ar","ar-ae":"ar","ar-bh":"ar","ar-ly":"ar","ar-kw":"ar","ar-qa":"ar","ar-sy":"ar",az:"az",bg:"bg_BG","bg-bg":"bg_BG","bn-BN":"bn_BN",bn:"bn_BN","bn-in":"bn_BN",ca:"ca","ca-es":"ca","en-au":"en-AU","en-a":"en-AU","en-ca":"en-CA","en-c":"en-CA","english(canada)":"en-CA","en-gb":"en-GB","en-g":"en-GB","en-in":"en-GB","en-ie":"en-GB","en-nz":"en-NZ","en-us":"en-US","en-u":"en-US",en:"en-US","en-my":"en-US","en-sg":"en-US","en-zw":"en-US","en-securid":"en-US","en-ph":"en-US","en-tt":"en-US","en-ZA":"en_ZA","en-za":"en_ZA",eo:"eo_l3","de-at":"de-AT","de-ch":"de-CH","de-de":"de-DE",de:"de-DE","de-lu":"de-DE","es-es":"es-ES",es:"es-ES","es-ar":"es-ES","es-ve":"es-ES","es-us":"es-ES","es-419":"es-ES","es-cr":"es-ES","es-pa":"es-ES","es-do":"es-ES","es-hn":"es-ES","es-gt":"es-ES","es-sv":"es-ES","es-bo":"es-ES","es-es-tradnl":"es-ES","es-mx":"es-MX","es-co":"es_CO","es-ni":"es_NI","es-pe":"es_PE","es-pr":"es_PR","es-cl":"es_CL","es-ec":"es_EC","es-uy":"es_UY",et:"et_EE","et-ee":"et_EE",fa:"fa","fa-ir":"fa",fj:"fj_FJ",fo:"fo_FO","fo-fo":"fo_FO",fy:"fy_NL",cs:"cs_CZ","cs-cz":"cs_CZ",da:"da","da-dk":"da",el:"el_GR","el-gr":"el_GR",ga:"ga_IE","ga-ie":"ga_IE","gd-GB":"gd_GB",gl:"gl","gl-es":"gl","gu-in":"gu_IN","fr-fr":"fr-FR",fr:"fr-FR","fr-ca":"fr-FR","fr-c":"fr-FR","fr-ch":"fr-FR","fr-be":"fr-FR","fr-mc":"fr-FR",iw:"he-IL","iw-il":"he-IL",he:"he-IL","he-il":"he-IL",hi:"hi_IN","hi-in":"hi_IN",hr:"hr_HR","hr-hr":"hr_HR",ko:"ko","ko-kr":"ko",lv:"lv-LV","lv-lv":"lv-LV",lt:"lt","lt-lt":"lt",pt:"pt_PT","pt-pt":"pt_PT","pt-br":"pt-BR","pt-b":"pt-BR",pl:"PL","pl-PL":"PL","pl-pl":"PL",qu:"qu_BO","quz-BO":"qu_BO",zu:"zu-ZA","zu-za":"zu-ZA",hu:"hu","hu-hu":"hu",hy:"hy_AM","hy-AM":"hy_AM",ia:"ia",id:"id_ID","id-ID":"id_ID",in:"id_ID","in-id":"id_ID",it:"it","it-it":"it","it-ch":"it",is:"is","is-IS":"is",la:"la",mi:"mi","mi-nz":"mi","mn-MN":"mn_MN",mr:"mr_IN","mr-IN":"mr_IN",ms:"ms_MY","ms-my":"ms_MY",nb:"nb_NO","nb-no":"nb_NO",no:"nb_NO",ne:"ne_NP","nl-nl":"nl_NL",nl:"nl_NL","nl-no":"nl_NL","nl-be":"nl_NL",nn:"nn","nn-no":"nn","nso-ZA":"ns_ZA",oc:"oc_FR",or:"or_OR",ro:"ro","ro-ro":"ro",ru:"ru","ru-ru":"ru",rw:"rw_RW","rw-rw":"rw_RW",sk:"sk","sk-sk":"sk",sl:"sl","sl-si":"sl",sv:"sv_SE","sv-se":"sv_SE","sv-fi":"sv_SE",sr:"sr","sr-cs":"sr","sr-rs":"sr",sw:"sw_KE","sw-KE":"sw_KE",ta:"ta_TA","ta-IN":"ta_TA","tn-ZA":"tn_ZA",ts:"ts_ZA",ve:"ve_ZA",vi:"vi_VI","vi-vn":"vi_VI","uk-ua":"uk",uz:"uz_UZ",xh:"xh_ZA","xh-ZA":"xh_ZA"};a["es-ES_tradnl"]="es-ES";var s=function(){return a},l=function(e){if(e)if(r.hasOwnProperty(e))o=e;else{e=e.toLowerCase();t.getKeys(a);for(key in a)if(key.toLowerCase()==e){o=a[key];break}}},d=function(){var s=editor.doc.getBodyFormat()[ATTR_BODY.DS_SPLANG]||o;s="locale"==s.toLowerCase()?o:s,i=s;var l=r.hasOwnProperty(i);if(!l){s=s.toLowerCase();t.getKeys(a);for(key in a)if(key.toLowerCase()==s){i=a[key],l=!0;break}}if(!l){e.log("LANGUAGE IS NOT SUPPORTED... Lang : "+i);var d=ZWCollaboration.SP_LANG_NOT_SUPPORTED_ERROR;return void e.sendErrorDetails(d+"<ZWERROR>"+editor.doc.getDocInfo().VERSION+"."+editor.doc.getDocInfo().REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No ="+d+" DOC len ="+editor.doc.getDocumentLength()+" buildLabel::: "+buildLabel+"\n Error Log End \n")}n=!0},c=function(){return n},u=function(e){if(e&&e.length){r={};for(var t=0;t<e.length;t++){var n=e[t][0],i=e[t][1];r[n]=i}}},p=function(){return o},h=function(){if(r.hasOwnProperty(i))return i;var e=editor.doc.getBodyFormat()[ATTR_BODY.DS_SPLANG]||o;return e="locale"==e.toLowerCase()?o:e},f=function(){return i},m=function(e){i=e},g=function(){return r},T=function(){"undefined"!=typeof Grammar&&Grammar.showMessage()};return{init:d,setBrowserLanguage:l,setSupportedLanguages:u,getBrowserLanguage:p,getSupportedLanguages:g,getLocaleMap:s,canProceed:c,getLanguage:h,setLanguage:m,getSPLanguage:f,toggleGrammarChecker:T}}(Utils,DocUtil),TrackChangeDetails=function(){var e=!1,t="false",n=!1,i=!1,o=!1,r=TCConstants.ALL_MARKUP_VIEW,a=!1,s=!1,l=!1;return{setProcessingContentDeletion:function(e){o=e},isProcessingContentDeletion:function(){return o},isOwner:function(){return s},canReview:function(){return l},setReviewPermission:function(e){l=e},isUserParticipated:function(){return a},makeUserParticipated:function(){a=!0},init:function(t){var i=editor.doc.getBodyFormat()[ATTR_BODY.TC_COLLAB_LIST];e=!1,n=!1,"true"===t[ATTR_BODY.TC_ISENABLED]?(e=!0,n=!0):i&&i.contains(editor.zuid.toString())&&(e=!0);var o=editor.doc.getRole();"OWNER"!==o&&"COOWNER"!==o&&"REMOTEPUBLICUSER"!==o&&editor.doc.getDocInfo().CREATOR_ZUID!=editor.zuid||(s=!0,l=!0),"undefined"!=typeof RemoteEditor&&(RemoteEditor.options.hasOwnProperty("isTcON")&&"true"==RemoteEditor.options.isTcON&&(e=!0),RemoteEditor.options.hasOwnProperty("isTcReviewON")&&"true"==RemoteEditor.options.isTcReviewON&&(l=!0))},isEnabled:function(){return e},getIsReviewPage:function(){return"true"===t},isONByOwner:function(){return n},getStopProcessingTC:function(){return i},getDisplayMode:function(){return r},setIsEnabled:function(t){e=t},setIsReviewPage:function(e){t=e},setStopProcessingTC:function(e){i=e},setDisplayMode:function(e){r=e},isNoMarkupON:function(){return r===TCConstants.NO_MARKUP_VIEW},canCarryParaStyle:function(){return!e||"true"===t},canHandleTC:function(){return!(!e||"true"===t)},toString:function(){var s="_isEnabled : "+e;return s+="; isReviewPage : "+t,s+="; _isONByOwner : "+n,s+="; stopProcessingTC : "+i,s+="; processingContentDeletion : "+o,s+="; displayMode : "+r,s+="; isCurrentUserParticipated : "+a}}}(),TcView=function(e,t,n){var i=function(t){if(editor.isOfflineMode||editor.getView()===EDITOR_VIEWS.HISTORY&&HistoryUI.isDiffView())return t;t=DocUtil.copyStyle(t);var n=t[e.TC];n.length>1&&TcUtil.sortTCVals(n);for(var i=0,a=n.length;i<a;i++){var s=n[i],l=o(t,s[e.ZUID],s[e.ACTION]);l[ATTR_TEXT.CLS]=l[ATTR_TEXT.CLS]+" tc-revision",r(t,l)}return t},o=function(t,n,i){return i===e.INSERT?a(t,n):i===e.DELETE?s(t,n):void 0},r=function(e,t){for(var i in t)if(e[i])if(i===ATTR_TEXT.CLS)e[i]=e[i]+" "+t[i];else if(i===ATTR_TEXT.TS_TD){var o=e[i];n.arrayContains(o,"none")?e[i]=t[i]:n.arrayContains(o,t[i])||(e[i]=e[i]+" "+t[i])}else e[i]=t[i];else e[i]=t[i]},a=function(n,i){var o={},r=n.type,a=editor.doc.getTrackChangeDetails().getDisplayMode();if(a===e.ALL_MARKUP_VIEW){if(r===NODE_TYPE.TEXT){var s=t.getUserColour(i);o[ATTR_TEXT.TS_FGC]=s,o[ATTR_COMMON.BORDERS]={},o[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM]={type:"solid",width:"2px",color:s}}else if(r===NODE_TYPE.IMAGE){var s=t.getUserColour(i);o[ATTR_TEXT.TS_FGC]=s,o[ATTR_COMMON.BORDERS]={},o[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]={type:"solid",width:"2px",color:s},o[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT]={type:"solid",width:"2px",color:s},o[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_RIGHT]={type:"solid",width:"2px",color:s},o[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM]={type:"solid",width:"2px",color:s}}else if(r===NODE_TYPE.ROW){var s=t.getUserLightColour(i);o[ATTR_ROW.TRS_BGC]=s}}else a===e.NO_MARKUP_VIEW?o={}:a===e.ORIGINAL_VIEW&&(o={cls:"tc-txt-hide"});return o.hasOwnProperty(ATTR_TEXT.CLS)?o[ATTR_TEXT.CLS]+=" tc-insertion":o[ATTR_TEXT.CLS]="tc-insertion",o},s=function(n,i){var o={},r=n.type,a=editor.doc.getTrackChangeDetails().getDisplayMode();if(a===e.ALL_MARKUP_VIEW){if(r===NODE_TYPE.TEXT){var s=t.getUserColour(i);o[ATTR_TEXT.TS_FGC]=s,o[ATTR_TEXT.TS_TD]="line-through",n[ATTR_SECTION.ST]===NODE_TYPE.TAB&&(o[ATTR_COMMON.BORDERS]={},o[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM]={type:"solid",width:"2px",color:s})}else if(r===NODE_TYPE.IMAGE){var s=t.getUserColour(i);o[ATTR_TEXT.TS_FGC]=s,o[ATTR_COMMON.BORDERS]={},o[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]={type:"solid",width:"2px",color:s},o[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT]={type:"solid",width:"2px",color:s},o[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_RIGHT]={type:"solid",width:"2px",color:s},o[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM]={type:"solid",width:"2px",color:s}}else if(r===NODE_TYPE.ROW){var s=t.getUserLightColour(i);o[ATTR_ROW.TRS_BGC]=s}}else a===e.NO_MARKUP_VIEW?o={}:a===e.ORIGINAL_VIEW&&(o={});return o.hasOwnProperty(ATTR_TEXT.CLS)?o[ATTR_TEXT.CLS]+=" tc-deletion":o[ATTR_TEXT.CLS]="tc-deletion",o},l=function(t){for(var n=editor.doc.getTrackChangeDetails().getDisplayMode(),i=t[e.TC],o=0,r=i.length;o<r;o++){var a=i[o],s=a[e.ACTION];if(s===e.INSERT&&n===e.ORIGINAL_VIEW)return!0}return!1},d=function(n,i){var o=editor.doc.getTrackChangeDetails().getDisplayMode();if(i&&n&&!editor.isOfflineMode&&(editor.getView()!==EDITOR_VIEWS.HISTORY||!HistoryUI.isDiffView())&&o==e.ALL_MARKUP_VIEW){var r=i[e.TC][i[e.TC].length-1];n.className=n.className+" icon-pilcrow",n.style.color=t.getUserColour(r.zuid),r[e.ACTION]===e.DELETE&&(n.className=n.className+" icon-pilcrow-strike-through")}},c=function(n,i){var o=editor.doc.getTrackChangeDetails().getDisplayMode();if(n&&i&&!editor.isOfflineMode&&(editor.getView()!==EDITOR_VIEWS.HISTORY||!HistoryUI.isDiffView())&&o==e.ALL_MARKUP_VIEW){var r=J(i).find("div.fgImgOuterDiv"),a=TcUtil.getTcDeletionDetails(n).zuid,s=document.createElement(NODE_NAME.SPAN),l=t.getUserColour(a),d=r.width(),c=r.height(),u=n[ATTR_IMAGE.I_ROTATE]?n[ATTR_IMAGE.I_ROTATE]:0,p=Math.sqrt(d*d+c*c),h=Math.atan(c/d)*(180/Math.PI),f=parseInt(r[0].style.top.split("px")[0]),m=parseInt(r[0].style.left.split("px")[0]),g=c/2+(f?f:0),T=(d-p)/2+(m?m:0);0===u&&i.tagName.toLowerCase()==NODE_NAME.SPAN&&J(i).css("position","relative");var _=u-h,E=n[ATTR_IMAGE.I_MT]||0,v=n[ATTR_IMAGE.I_MR]||0,S=n[ATTR_IMAGE.I_MB]||0,b=n[ATTR_IMAGE.I_ML]||0;return J(s).css({position:"absolute",margin:E+" "+v+" "+S+" "+b,height:1,"z-index":11,width:p,top:g,left:T,"background-color":l,"-ms-transform":"rotate("+_+"deg)","-o-transform":"rotate("+_+"deg)","-moz-transform":"rotate("+_+"deg)",transform:"rotate("+_+"deg)","-webkit-transform":"rotate("+_+"deg)"}),s}};return{updateDOMStyles:i,setPilcrowStyle:d,isCharSizeZero:l,getDiagonalLineSpan:c}}(TCConstants,ReviewUtil,Utils),TcBlockHandler=function(){var e=function(e,t,n,i,o,r){var a=new TcNode.types[r](e,t,n,i,o,r);return a},t=function(e){return e===NODE_TYPE.TABLE||e===NODE_TYPE.ROW||e===NODE_TYPE.TABLEEND||e===NODE_TYPE.TOC||e===NODE_TYPE.AUTOFIELD||e===NODE_TYPE.MAILMERGEFIELD||e===NODE_TYPE.FOOTNOTE||e===NODE_TYPE.ENDNOTE||e===NODE_TYPE.SECTION},n=function(e,t){var n=0;switch(t){case NODE_TYPE.TABLE:n=e;break;case NODE_TYPE.TABLEEND:n=e;break;case NODE_TYPE.ROW:n=TableUtil.getRowEnd(e+1)-1;break;case NODE_TYPE.TOC:n=editor.doc.findNextIndexOf(UNICODE.TOCEND,e+1);break;case NODE_TYPE.AUTOFIELD:case NODE_TYPE.MAILMERGEFIELD:case NODE_TYPE.FOOTNOTE:case NODE_TYPE.ENDNOTE:n=DocUtil.getRangeEnd(e);break;case NODE_TYPE.SECTION:n=editor.doc.getSectionEnd(e)-1}return n},i=function(e,t,n,i){for(var o=0,r=e.length;o<r;o++){var a=e[o];if(a.isBlockNode()&&a.getStart()<t&&t<=a.getEnd()&&a.getUser()===i&&a.getAction()===n)return!0}return!1};return{createNode:e,isBlockNodeType:t,getBlockEnd:n,isInBlockNode:i}}(),TcNode=function(e,t,n,i,o,r,a,s){this.start=e,this.end=t,this.zuid=n,this.action=i,this.time=o,this.prev=null,this.next=null,this.type=r||"doc",this.isBlock=a||!1,this.mode=s||TCConstants.CREATE_MODE,this.isHidden=!1,this.linkedNodes=[],this.id="tcnode_"+("x"+Math.random()).replace(/\D/g,"")};extend(TcNode.prototype,{getId:function(){return this.id},getStart:function(){return this.start},getEnd:function(){return this.end},getAction:function(){return this.action},getUser:function(){return this.zuid},getElement:function(){return this.el},getType:function(){return this.type},getTime:function(){return this.time},getMode:function(){return this.mode},getLinkedNodes:function(){return this.linkedNodes},isBlockNode:function(){return this.isBlock},isHiddenNode:function(){return this.isHidden},setTime:function(e){this.time=e},setMode:function(e){return this.mode=e},setStart:function(e){this.start=e},setEnd:function(e){this.end=e},setIsBlockNode:function(e){this.isBlock=e},setIsHiddenNode:function(e){this.isHidden=e},setLinkedNodes:function(e){this.linkedNodes=e},appendLinkedNodes:function(e){this.linkedNodes.push(e)},updateIndices:function(e){this.start+=e,this.end+=e},isEquals:function(e){return e.getAction()===this.action&&e.getUser()===this.zuid&&e.getType()===this.type},hasSameStyle:function(e){for(var t,n=0,i=e.length;n<i;n++)if(t=e[n],t[TCConstants.ZUID]===this.zuid&&t[TCConstants.ACTION]===this.action)return!0;return!1},getTcIndicesOp:function(e,t){var n,i=[],o=0;i.push({r:e});for(var r=e;r<=t;r++){var a=editor.doc.getRawFormatAt(r);if(a){if(n){var s=Utils.randomString();i.push({as:{start:n,id:s}}),i.push({r:o}),i.push({as:{end:DocUtil.getKeys(n),id:s}}),n=void 0,o=0}a.hasOwnProperty(TCConstants.TC)&&this.hasSameStyle(a[TCConstants.TC])?(n={},n.type=a.type,o=1):i.push({r:1})}else n?o+=1:i.push({r:1})}if(n){var s=Utils.randomString();i.push({as:{start:n,id:s}}),i.push({r:o}),i.push({as:{end:DocUtil.getKeys(n),id:s}})}return i},_removeTcStyle:function(){var e=this.getTcIndicesOp(this.start,this.end),t={};t[TCConstants.TASK]=TCConstants.REMOVE,t[TCConstants.ACTION]=this.action,t[TCConstants.ZUID]=this.zuid;for(var n,i=0,o=e.length;i<o;i++)n=e[i].as,n&&(n.start?n.start[TCConstants.TC]=[t]:n.end.push(TCConstants.TC));Op.processMsg(e)},_getNoMarkupOPs:function(e,t,n){if(this.action===e){var i=this.start,o=this.end,r=editor.doc.getContent(i,o+1),a=editor.doc.getRawFormatAt(i),s=i-prevEnd-1;s>0&&tcRangeOps.skipChars(s),dsNodesRanges.push({start:i,end:o}),n.push(new TCOp(o-i+1,e,this.zuid,r,a,t)),prevEnd=o}},toJson:function(){return{id:this.id,start:this.start,end:this.end,zuid:this.zuid,action:this.action,time:this.time,type:this.type,isBlockNode:this.isBlock,isHidden:this.isHidden,linkedNodes:this.linkedNodes,mode:this.mode}}});var TcText=function(e,t,n,i,o,r,a,s){var l=new TcNode(e,t,n,i,o,NODE_TYPE.TEXT,!1,s);return l.setIsHiddenNode(!1),extend(l,{canDeleteTheRange:function(e,t){return!0},fillLinkNodes:function(){},removeTcStyle:function(e){this._removeTcStyle()},removeContent:function(e){var t=editor.doc.createRange(this.start,this.end+1);editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_AUTO_GEN).addRange(t).deleteSelectedContents()},getNoMarkupOPs:function(e,t,n){_getNoMarkupOPs(e,t,n)}}),l},TcRow=function(e,t,n,i,o,r,a,s){var l=new TcNode(e,t,n,i,o,NODE_TYPE.ROW,!0,s);return l.setIsHiddenNode(!1),extend(l,{canDeleteTheRange:function(e,t){return e===this.start&&t===this.end||e!==this.start},fillLinkNodes:function(e){for(var t=TableUtil.getTableStart(this.start),n=TableUtil.getTableEnd(this.start)-1,i=0,o=e.length;i<o;i++){var r=e[i];if(r.getType()===NODE_TYPE.TABLE&&r.getStart()===t&&r.getAction()===this.action&&r.getUser()===this.zuid){this.appendLinkedNodes(r),r.appendLinkedNodes(this);break}}for(var i=0,o=e.length;i<o;i++){var r=e[i];if(r.getType()===NODE_TYPE.TABLEEND&&r.getStart()===n&&r.getAction()===this.action&&r.getUser()===this.zuid){this.appendLinkedNodes(r),r.appendLinkedNodes(this);break}}},removeTcStyle:function(e){if(this._removeTcStyle(),e&&this.linkedNodes.length){var t,n=this.linkedNodes;for(var i in n)n.hasOwnProperty(i)&&n[i].type==NODE_TYPE.TABLE&&(t=n[i]);if(t.linkedNodes&&t.linkedNodes.length>0)for(var o=0,r=n.length;o<r;o++)n[o].removeTcStyle()}for(var a,s=[],o=this.start,r=this.end;o<r;o++)if(a=editor.doc.getRawFormatAt(o),a&&(a.type===NODE_TYPE.FOOTNOTE||a.type===NODE_TYPE.ENDNOTE)&&!s.contains(a.id)){var l=editor.doc.getFloatElement(a.type,a.id).section;msg=this.getTcIndicesOp(l.getStart(),l.getEnd()-1);var d={};d[TCConstants.TASK]=TCConstants.REMOVE,d[TCConstants.ACTION]=this.action,d[TCConstants.ZUID]=this.zuid;for(var c,o=0,r=msg.length;o<r;o++)c=msg[o].as,c&&(c.start?c.start[TCConstants.TC]=[d]:c.end.push(TCConstants.TC));Op.processMsg(msg),s.push(a.id)}},removeContent:function(e){if(e&&this.linkedNodes.length){var t;for(var n in this.linkedNodes)this.linkedNodes[n].type==NODE_TYPE.TABLE&&(t=this.linkedNodes[n]);if(t.linkedNodes&&1==t.linkedNodes.length)return void t.removeContent()}editor.doc.getSelection().selectRow(DocTreeManager.getNodeAtIndex(this.start));var i=editor.doc.getSelection().parents(NODE_TYPE.ROW);TableActions.delRow(i)},getNoMarkupOPs:function(e,t,n){_getNoMarkupOPs(e,t,n)}}),l},TcTable=function(e,t,n,i,o,r,a,s){var l=new TcNode(e,t,n,i,o,NODE_TYPE.TABLE,!0,s);return l.setIsHiddenNode(!0),extend(l,{canDeleteTheRange:function(e,t){return!0},fillLinkNodes:function(e){var t=[],n=this.start+1,i=TableUtil.getTableEnd(this.start+1)-1;for(isTableEndReached=!1;;){t.push(n);var o=TableUtil.getRowEnd(n+1);if(o===i)break;n=o}for(var r=e.filter(function(e){return e.getType()===NODE_TYPE.ROW}),a=0,s=t.length;a<s;a++)for(var n=t[a],l=0,d=r.length;l<d;l++){var c=r[l];if(c.getStart()===n&&c.getAction()===this.action&&c.getUser()===this.zuid){this.appendLinkedNodes(c),c.appendLinkedNodes(this);break}}},removeTcStyle:function(e){this._removeTcStyle()},removeContent:function(e){var t=editor.doc.createRange(this.start+1,this.start+1),n=editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_AUTO_GEN).addRange(t),i=n.parents(NODE_TYPE.TABLE);n.deleteContents(i.getStart(),i.getEnd())},getNoMarkupOPs:function(e,t,n){_getNoMarkupOPs(e,t,n)}}),l},TcTableEnd=function(e,t,n,i,o,r,a,s){var l=new TcNode(e,t,n,i,o,NODE_TYPE.TABLEEND,!0,s);return l.setIsHiddenNode(!0),extend(l,{canDeleteTheRange:function(e,t){return!0},fillLinkNodes:function(e){var t=TableUtil.getTableStart(this.start),n=[],i=t+1;for(isTableEndReached=!1;;){n.push(i);var o=TableUtil.getRowEnd(i+1);if(o===this.start)break;i=o}for(var r=e.filter(function(e){return e.getType()===NODE_TYPE.ROW}),a=0,s=n.length;a<s;a++)for(var i=n[a],l=0,d=r.length;l<d;l++){var c=r[l];if(c.getStart()===i&&c.getAction()===this.action&&c.getUser()===this.zuid){this.appendLinkedNodes(c),c.appendLinkedNodes(this);break}}},removeTcStyle:function(e){this._removeTcStyle()},removeContent:function(e){},getNoMarkupOPs:function(e,t,n){_getNoMarkupOPs(e,t,n)}}),l},TcSection=function(e,t,n,i,o,r,a,s){var l=new TcNode(e,t,n,i,o,NODE_TYPE.SECTION,!0,s);return l.setIsHiddenNode(!0),extend(l,{canDeleteTheRange:function(e,t){return e===this.start&&t===this.end},fillLinkNodes:function(e){var t=editor.doc.getRawFormatAt(this.start),n=t.st,i=DocUtil.getFloatElementIdx(t.sid);if(i>0)for(var o=0,r=e.length;o<r;o++){var a=e[o];if(a.getType()===n&&a.getStart()===i&&a.getAction()===this.action&&a.getUser()===this.zuid){this.appendLinkedNodes(a),a.appendLinkedNodes(this);break}}},removeTcStyle:function(e){this._removeTcStyle()},removeContent:function(e){},getNoMarkupOPs:function(e,t,n){_getNoMarkupOPs(e,t,n)}}),l},TcToc=function(e,t,n,i,o,r,a,s){var l=new TcNode(e,t,n,i,o,NODE_TYPE.TOC,!0,s);return l.setIsHiddenNode(!1),extend(l,{canDeleteTheRange:function(e,t){return e===this.start&&t===this.end},fillLinkNodes:function(){},removeTcStyle:function(e){this._removeTcStyle()},removeContent:function(e){Toc.deleteTOC(this.start)},getNoMarkupOPs:function(e,t,n){_getNoMarkupOPs(e,t,n)}}),l},TcAutofield=function(e,t,n,i,o,r,a,s){var l=new TcNode(e,t,n,i,o,NODE_TYPE.AUTOFIELD,!0,s);return l.setIsHiddenNode(!1),extend(l,{canDeleteTheRange:function(e,t){return e===this.start&&t===this.end},fillLinkNodes:function(){},removeTcStyle:function(e){this._removeTcStyle()},removeContent:function(e){var t=editor.doc.createRange(this.start,this.end+1);editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_AUTO_GEN).addRange(t).deleteSelectedContents()},getNoMarkupOPs:function(e,t,n){_getNoMarkupOPs(e,t,n)}}),l},TcMergefield=function(e,t,n,i,o,r,a,s){var l=new TcNode(e,t,n,i,o,NODE_TYPE.MAILMERGEFIELD,!0,s);return l.setIsHiddenNode(!1),extend(l,{canDeleteTheRange:function(e,t){return e===this.start&&t===this.end},fillLinkNodes:function(){},removeTcStyle:function(e){this._removeTcStyle()},removeContent:function(e){var t=editor.doc.createRange(this.start,this.end+1);editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_AUTO_GEN).addRange(t).deleteSelectedContents()},getNoMarkupOPs:function(e,t,n){_getNoMarkupOPs(e,t,n)}}),l},TcFootnote=function(e,t,n,i,o,r,a,s){var l=new TcNode(e,t,n,i,o,NODE_TYPE.FOOTNOTE,!0,s);return l.setIsHiddenNode(!1),extend(l,{canDeleteTheRange:function(e,t){return e===this.start&&t===this.end},fillLinkNodes:function(e){for(var t=editor.doc.getSectionStart(this.start),n=0,i=e.length;n<i;n++){var o=e[n];if(o.getType()===NODE_TYPE.SECTION&&o.getStart()===t&&o.getAction()===this.action&&o.getUser()===this.zuid){this.appendLinkedNodes(o),o.appendLinkedNodes(this);break}}},removeTcStyle:function(e){this._removeTcStyle(),e&&this.linkedNodes[0].removeTcStyle()},removeContent:function(e){var t=editor.doc.createRange(this.start,this.end+1);editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_AUTO_GEN).addRange(t).deleteSelectedContents()},getNoMarkupOPs:function(e,t,n){_getNoMarkupOPs(e,t,n)}}),l},TcEndnote=function(e,t,n,i,o,r,a,s){var l=new TcNode(e,t,n,i,o,NODE_TYPE.ENDNOTE,!0,s);return l.setIsHiddenNode(!1),extend(l,{canDeleteTheRange:function(e,t){return e===this.start&&t===this.end},fillLinkNodes:function(e){for(var t=editor.doc.getSectionStart(this.start),n=0,i=e.length;n<i;n++){var o=e[n];if(o.getType()===NODE_TYPE.SECTION&&o.getStart()===t&&o.getAction()===this.action&&o.getUser()===this.zuid){this.appendLinkedNodes(o),o.appendLinkedNodes(this);break}}},removeTcStyle:function(e){this._removeTcStyle(),e&&this.linkedNodes[0].removeTcStyle()},removeContent:function(e){var t=editor.doc.createRange(this.start,this.end+1);editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_AUTO_GEN).addRange(t).deleteSelectedContents()},getNoMarkupOPs:function(e,t,n){_getNoMarkupOPs(e,t,n)}}),l};TcNode.types={},TcNode.types[NODE_TYPE.TEXT]=TcText,TcNode.types[NODE_TYPE.TABLE]=TcTable,TcNode.types[NODE_TYPE.ROW]=TcRow,TcNode.types[NODE_TYPE.TABLEEND]=TcTableEnd,TcNode.types[NODE_TYPE.TOC]=TcToc,TcNode.types[NODE_TYPE.SECTION]=TcSection,TcNode.types[NODE_TYPE.AUTOFIELD]=TcAutofield,TcNode.types[NODE_TYPE.MAILMERGEFIELD]=TcMergefield,TcNode.types[NODE_TYPE.FOOTNOTE]=TcFootnote,TcNode.types[NODE_TYPE.ENDNOTE]=TcEndnote;var TCHandler=function(){var e=function(e){var o=e.length,a=!1,c=0,h=!1,f=function(t){var n=DocUtil.getTextStyle(c-1);n[TCConstants.TC]&&delete n[TCConstants.TC],n&&n.hasOwnProperty("type")||(n={type:"text"});var i=Utils.randomString(),o={as:{start:n,id:i}},r={as:{end:DocUtil.getKeys(n),id:i}};e.splice(t,0,o),e.splice(t+2,0,r)};if(editor.doc.getTrackChangeDetails().isNoMarkupON()||editor.currentCommand!==COMMAND.UNDO&&editor.currentCommand!==COMMAND.REDO){var m=editor.doc.getTrackChangeDetails();if(!m.canHandleTC()||m.getStopProcessingTC()||editor.isOfflineMode)for(var g=0;g<o;g++){var T=e[g];if(T.hasOwnProperty("r"))c+=T.r;else if(T.hasOwnProperty("as")){var _=T.as;_.hasOwnProperty("start")&&e[g+1]&&e[g+1].hasOwnProperty("is")?h=!0:_.hasOwnProperty("end")&&(h=!1)}else if(T.hasOwnProperty("is")&&!h){var E=editor.doc.getRawFormatAt(c-1);if(E||(E=DocUtil.getTextStyle(c-1)),!E.hasOwnProperty(TCConstants.TC))continue;f(g),o+=2,g--}}else for(var g=0;g<o;g++){var T=e[g];if(T.hasOwnProperty("r"))c+=T.r;else if(T.hasOwnProperty("ds")){var v=T.ds,S=v.length,b=s(c,c+S-1),R=0,O=b.start,D=b.end,y=O.length,A=c,C=0;e.splice(g,1);for(var I=0;I<y;I++){var w=O[I],P=D[I],M=editor.doc.getContent(w,P+1);if(p(w)){var L={ds:M};e.splice(g+R,0,L),R++}else{var N=TcUtil.getFormatTypeAtIndex(w),U=editor.doc.getRawFormatAt(w);if(U||(U=DocUtil.getTextStyle(w),ch=editor.doc.getCharAt(w),N=TcUtil.getFormatType(U,ch)),N&&i(N)&&!r(U)){var x=t(w,P,e,g+R);R+=x,C+=M.length}else{var L={ds:M};e.splice(g+R,0,L),R++}}c+=M.length}if(g=g+R-1,o=e.length,C>0){var U=editor.doc.getRawFormatAt(A);if(!U||U.type!==NODE_TYPE.SECTION){var k=editor.doc.getSectionStart(A);U=editor.doc.getRawFormatAt(k)}if(editor.currentKey!==KEYS.DELETE||editor.doc.getTrackChangeDetails().isNoMarkupON()){if(0==Op.cursor.length){var F=l(A);F+=d(e,A),A-=F,Op.fillCursorPos(A,A)}}else{var F=l(A);F+=d(e,A),A=A+C-F,Op.fillCursorPos(A,A)}}}else if(T.hasOwnProperty("as")){var _=T.as;if(_.hasOwnProperty("start")&&e[g+1]&&e[g+1].hasOwnProperty("is")){h=!0,_=_.start;var Y,N=_.type;if(N&&n(N)&&!r(_)){var B=editor.zuid+"";Y=u(B,TCConstants.INSERT),_[TCConstants.TC]=[],_[TCConstants.TC].push(Y),a=!0}}else _.hasOwnProperty("end")&&(h=!1,a&&_.end.push(TCConstants.TC),a=!1)}else if(T.hasOwnProperty("is")&&!h){var H=T.is,W=RegExp(CONT_REGEXP.TC_BLOCK_CHARS);if(W.test(H)){N=TcUtil.getFormatType(null,H),newStyle={},newStyle.type=N;var V=Utils.randomString();asStartOp={as:{start:newStyle,id:V}},asEndOp={as:{end:DocUtil.getKeys(newStyle),id:V}},e.splice(g,0,asStartOp),e.splice(g+2,0,asEndOp),o+=2,g--}else f(g),o+=2,g--}}}},t=function(e,t,n,o){for(var a=[],s=[],l=e,d=RegExp(CONT_REGEXP.TC_BLOCK_CHARS),c=0,p=e+1;p<=t;p++){var h=editor.doc.getRawFormatAt(p),f=editor.doc.getCharAt(p);(h||d.test(f))&&(a.push(l),s.push(p-1),l=p)}s.indexOf(t)===-1&&(a.push(l),s.push(t));for(var p=0,m=a.length;p<m;p++){var l=a[p],g=s[p],T=TcUtil.getFormatTypeAtIndex(l),h=editor.doc.getRawFormatAt(l);if(h||(h=DocUtil.getTextStyle(l),f=editor.doc.getCharAt(l),T=TcUtil.getFormatType(h,f)),h=DocUtil.copyStyle(h),T&&i(T)&&!r(h)){var _,E=editor.zuid+"";_=u(E,TCConstants.DELETE);var v={};v.type=h.type,v[TCConstants.TC]=[],v[TCConstants.TC].push(_);var S=Utils.randomString(),b={as:{start:v,id:S}},R={r:g-l+1},O={as:{end:DocUtil.getKeys(v),id:S}};n.splice(o+c,0,b,R,O),c+=3}else{var R={r:g-l+1};n.splice(o+c,0,R),c+=1}}return c},n=function(e){return e===NODE_TYPE.TEXT||e===NODE_TYPE.PARAGRAPH||e===NODE_TYPE.IMAGE||e===NODE_TYPE.TABLE||e===NODE_TYPE.ROW||e===NODE_TYPE.CELL||e===NODE_TYPE.TABLEEND||e===NODE_TYPE.TOC||e===NODE_TYPE.TOCEND||e===NODE_TYPE.HR||e===NODE_TYPE.IFRAME||e===NODE_TYPE.AUTOFIELD||e===NODE_TYPE.MAILMERGEFIELD||e===NODE_TYPE.FOOTNOTE||e===NODE_TYPE.ENDNOTE||e===NODE_TYPE.SECTION},i=function(e){return e===NODE_TYPE.TEXT||e===NODE_TYPE.PARAGRAPH||e===NODE_TYPE.IMAGE||e===NODE_TYPE.TABLE||e===NODE_TYPE.TABLEEND||e===NODE_TYPE.ROW||e===NODE_TYPE.CELL||e===NODE_TYPE.TOC||e===NODE_TYPE.TOCEND||e===NODE_TYPE.HR||e===NODE_TYPE.IFRAME||e===NODE_TYPE.SECTION||!(!o(e)||!editor.doc.getTrackChangeDetails().isProcessingContentDeletion())},o=function(e){return e===NODE_TYPE.COMMENT||e===NODE_TYPE.LINK||e===NODE_TYPE.AUTOFIELD||e===NODE_TYPE.BOOKMARK||e===NODE_TYPE.MAILMERGEFIELD||e===NODE_TYPE.FOOTNOTE||e===NODE_TYPE.ENDNOTE},r=function(e){var t=e.type;return t===NODE_TYPE.PARAGRAPH&&"list"===e.ps_type},a=function(e){var t=TableUtil.getTableStart(e[0]),n=DocTreeManager.getTreeNodeAtIndex(t);return n.children.length===e.length},s=function(e,t){var n=[],i=[],o=e,r=editor.doc,a=RegExp(CONT_REGEXP.TC_BLOCK_CHARS),s={start:n,end:i};if(e===t)return n.push(e),i.push(t),s;for(var l=e;l<=t;l++){var d=r.getRawFormatAt(l),c=r.getCharAt(l),u=TcUtil.getFormatTypeAtIndex(l);if(d||(c=editor.doc.getCharAt(l),u=TcUtil.getFormatType(DocUtil.getTextStyle(l),c)),c===UNICODE.TOCSTART&&u!=NODE_TYPE.TOC&&(d.type=NODE_TYPE.TOC,u=d.type,editor.doc.setFormatAt(l,d)),TcBlockHandler.isBlockNodeType(u)){n.indexOf(o)===-1&&o!==l&&(n.push(o),i.push(l-1)),n.push(l);var p;if(p=u===NODE_TYPE.TABLE?TableUtil.getTableEnd(l+1)-1:TcBlockHandler.getBlockEnd(l,u),p>t)throw Utils.log("Error in TcBlock Deletion... type : "+u+"... blockEnd : "+p+"... annotationStartIndex : "+e+"... annotationEndIndex : "+t),"Error in TcBlock Deletion";i.push(p),o=p+1,l=p}else(d||a.test(c))&&o!==l&&(n.push(o),i.push(l-1),o=l)}i.indexOf(t)===-1&&(n.push(o),i.push(t)),finalStartArrLen=n.length;for(var l=1;l<finalStartArrLen;l++){var o=n[l],h=i[l],f=(n[l-1],i[l-1]),m=r.getRawFormatAt(o),g=r.getRawFormatAt(f);m&&g&&m.type===NODE_TYPE.TEXT&&g.type===NODE_TYPE.TEXT&&!m[TCConstants.TC]&&!g[TCConstants.TC]&&(i[l-1]=h,n.splice(l,1),i.splice(l,1),l--,finalStartArrLen--)}return s},l=function(e){e=e?e:0;for(var t=editor.doc.getSectionStart(e),n=editor.doc.getSectionEnd(e),i=0,o=0,r=Op.msgBuffer.length;o<r;o++)for(var a=Op.msgBuffer[o],s=a.docOps,l=0,d=0,c=s.length;d<c;d++){var u=s[d];u.isRetain()?l+=u.retain_count:u.isDelete()&&t<l&&n>l&&(i+=u.delete_characters.length)}return i},d=function(e,t){t=t?t:0;for(var n=0,i=0,o=editor.doc.getSectionStart(t),r=editor.doc.getSectionEnd(t),a=0,s=e.length;a<s;a++){var l=e[a];if(l.r)i+=l.r;else if(l.ds&&o<i&&r>i){var d=l.ds;n+=d.length}}return n},c=function(e){var t=editor.doc,n={};n.r=0;var i={};i.as={},i.as.start={};for(var o in e)e.hasOwnProperty(o)&&(i.as.start[o]=e[o]);i.as.start[ATTR_COMMON.TYPE]=NODE_TYPE.BODY;var r=Utils.randomString();i.as.id=r;var a={};a.as={},a.as.end=DocUtil.getKeys(i.as.start),a.as.id=r;var s=[];s.push(n),s.push(i),s.push(n),s.push(a),Op.processMsg(s),EditorUtil.focusMultiByteSpan(),t.snapShotManager.setSkipSnapShot(!0),Op.sendMsg(),t.snapShotManager.setSkipSnapShot(!1)},u=function(e,t){var n=editor.zuid+"";e=e?e:n,t=t?t:TCConstants.INSERT;var i={};i[TCConstants.ZUID]=e,i[TCConstants.ACTION]=t,i[TCConstants.TIME]=(new Date).getTime();var o=editor.doc.getTrackChangeDetails().isUserParticipated();return o||(editor.doc.getTrackChangeDetails().makeUserParticipated(),ReviewUtil.addParticipant()),i},p=function(e){var t=editor.doc,n=t.getRawFormatAt(e)||DocUtil.getTextStyle(e);if(n&&n[TCConstants.TC])for(var i=n[TCConstants.TC],o=editor.zuid+"",r=0,a=i.length;r<a;r++){var s=i[r];if(s[TCConstants.ZUID]===o&&s[TCConstants.ACTION]===TCConstants.INSERT)return!0}return!1};return{processMsg:e,isSupportedRangeCharType:o,isListData:r,isAllRowsSelected:a,sendTCPropertiesOP:c}}(),TcUtil={};TcUtil.focusedTcNode,TcUtil.getFormatType=function(e,t){return t===UNICODE.TABLEEND?NODE_TYPE.TABLEEND:t===UNICODE.TOCEND?NODE_TYPE.TOCEND:e?e.type:""},TcUtil.getFormatTypeAtIndex=function(e){var t=editor.doc.getRawFormatAt(e),n=editor.doc.getCharAt(e);return TcUtil.getFormatType(t,n)},TcUtil.convertContentToDOMElements=function(e){var t,n=e.start,i=e.end,o=e.type,r=[],a=editor.doc.getRawFormatAt(n);if(o===TCConstants.ROW)r.push(TcUtil.getRowElementHtml());else if(o===NODE_TYPE.AUTOFIELD)t=Utils.createElement(NODE_NAME.SPAN,null,TcUtil.getAutoFieldValue(a,n)+""),r.push(t);else if(o===NODE_TYPE.TOC)t=Utils.createElement(NODE_NAME.SPAN,null,"< Table of Content >"),r.push(t);else if(o===NODE_TYPE.FOOTNOTE)t=Utils.createElement(NODE_NAME.SPAN,null,"< Footnote >"),r.push(t);else if(o===NODE_TYPE.ENDNOTE)t=Utils.createElement(NODE_NAME.SPAN,null,"< Endnote >"),r.push(t);else if(o===NODE_TYPE.MAILMERGEFIELD)t=Utils.createElement(NODE_NAME.SPAN,null,editor.doc.getContent(n+1,i)),r.push(t);else{var s=editor.doc.getContent(n,i+1);SPL_CHARS_REGEX.lastIndex=0;for(var l=SPL_CHARS_REGEX.exec(s);l;){var d=l[1],c=l[2];if(d&&(t=Utils.createElement(NODE_NAME.SPAN,null,d),r.push(t)),c)for(var u,p,a,t,h=0,f=c.length;h<f;h++)if(p=c.charAt(h),u=n+l.index+h,a=editor.doc.getRawFormatAt(u),p===UNICODE.IMAGE)if(a.type===NODE_TYPE.IFRAME)t=Utils.createElement(NODE_NAME.SPAN,null,"< Iframe >"),r.push(t);else if(a.shapeData&&"SHAPE"==a.shapeData.type)t=Utils.createElement(NODE_NAME.SPAN,null,"< Shape Object >"),r.push(t);else{var m=DomUtil.processImgSrc(a.src);t=Utils.createElement("img",{src:m,"data-zw-imagesrc":m,class:"tc-shrink-img"}),r.push(t)}else p===UNICODE.PARA?(t=Utils.createElement(NODE_NAME.SPAN),J(t).html("&#182;").css({"font-size":"15px",color:"rgb(3, 187, 247)"}),r.push(t),r.push(document.createElement("br"))):p===UNICODE.TAB?(t=Utils.createElement(NODE_NAME.SPAN,{class:"icon-tab"}),J(t).css({padding:"0px 3px"}),r.push(t)):p===UNICODE.HR&&(t=Utils.createElement(NODE_NAME.DIV),J(t).css({border:"1px solid #999"}),r.push(t));l=SPL_CHARS_REGEX.exec(s)}}return r},TcUtil.getAutoFieldValue=function(e,t){var n="0",i=e.ftype;if(i===AUTOFIELD_TYPE.AUTO_DATE){var o=Utils.getMomentFmt(e[ATTR_AUTOFIELD.DATEFMT]),r=e[ATTR_AUTOFIELD.ISAUTO];if(editor.options.timeZone&&moment().zone()!=editor.options.timeZone){var a=parseInt(editor.options.timeZone);n=parseInt(r)?moment().zone(a).format(o):moment(e[ATTR_AUTOFIELD.VALUE]).format(o)}else n=parseInt(r)?moment().format(o):moment(e[ATTR_AUTOFIELD.VALUE]).format(o);"undefined"==typeof n&&(n=moment().format("M/D/YY"))}else i===AUTOFIELD_TYPE.AUTO_DOCNAME?n=editor.doc.getDocInfo().DOCUMENT_NAME_HTML:i===AUTOFIELD_TYPE.AUTO_DOCVERSION?n=e.val:i===AUTOFIELD_TYPE.AUTO_AUTHOR?n=editor.doc.getDocInfo().CREATOR_HTML:i===AUTOFIELD_TYPE.AUTO_FORMULA?n="< Formula >":i===AUTOFIELD_TYPE.AUTO_PAGENUMBER?n=ViewManager.getPageAtIndex(t).pageNumber:i===AUTOFIELD_TYPE.AUTO_PAGECOUNT&&(n=ViewManager.getPageCount());return n},TcUtil.getRowElementHtml=function(){var e=document.createElement("table"),t=J(e);t.attr({class:"zw-table tblthme1 tc-shrink-table",align:"center",cellpadding:"0",cellspacing:"0"});var n=document.createElement("tr"),i=J(n);t.append(i),i.height("20px");var o=document.createElement("td"),r=J(o);return r.css("width","100px"),i.append(r),e},TcUtil.acceptChanges=function(e,t){var n=editor.doc.getTrackChangeDetails();n.setIsReviewPage("true"),editor.lastOperation="tc-review",U.each(e,function(e){e.action===TCConstants.INSERT?e.removeTcStyle(t):e.removeContent(t)}),Op.sendMsg(),n.setIsReviewPage("false")},TcUtil.rejectChanges=function(e,t){var n=editor.doc.getTrackChangeDetails();n.setIsReviewPage("true"),editor.lastOperation="tc-review",U.each(e,function(e){e.action===TCConstants.DELETE?e.removeTcStyle(t):e.removeContent(t)}),Op.sendMsg(),n.setIsReviewPage("false")},TcUtil.acceptUserChanges=function(){var e=TcPane.getFilteredNodes();TcUtil.acceptChanges(e),editor.doc.snapShotManager.resetSnapShotManager(),Utils.addToStatistics("TC_AcceptAll_Userchanges")},TcUtil.rejectUserChanges=function(){var e=TcPane.getFilteredNodes();TcUtil.rejectChanges(e),editor.doc.snapShotManager.resetSnapShotManager(),Utils.addToStatistics("TC_RejectAll_Userchanges")},TcUtil.acceptAll=function(){var e=TcPane.getFilteredNodes();TcUtil.acceptChanges(e),editor.doc.snapShotManager.resetSnapShotManager(),Utils.addToStatistics("TC_AcceptAll")},TcUtil.rejectAll=function(){var e=TcPane.getFilteredNodes();TcUtil.rejectChanges(e),editor.doc.snapShotManager.resetSnapShotManager(),Utils.addToStatistics("TC_RejectAll")},TcUtil.accept=function(e){TcUtil.acceptChanges([e],!0),EditorUtil.focusMultiByteSpan()},TcUtil.reject=function(e){TcUtil.rejectChanges([e],!0),EditorUtil.focusMultiByteSpan()},TcUtil.getReviewNodesInRange=function(){for(var e=editor.doc.getSelection(),t=TcManager.getCollection().getNodesInRange(e.getStart(),e.getEnd()),n=[],i=[],o=0,r=t.length;o<r;o++){var a=t[o];if(!a.isHidden){n.push(a);var s=a.linkedNodes;if(s&&s.length)for(var l=0,d=s.length;l<d;l++)U.contains(i,s[l].id)||(n.push(s[l]),i.push(s[l].id))}}return n},TcUtil.acceptAllInRange=function(){var e=TcUtil.getReviewNodesInRange();TcUtil.acceptChanges(e),editor.doc.snapShotManager.resetSnapShotManager()},TcUtil.rejectAllInRange=function(){var e=TcUtil.getReviewNodesInRange();TcUtil.rejectChanges(e),editor.doc.snapShotManager.resetSnapShotManager()},TcUtil.acceptAllInRangeConfirm=function(){MsgDialog.showMessage(CONST.MSG_TYPE_YESNO,CONST.SEVERITY_WARNING,J.i18n("writer.trackchange.ACCEPT_SELECTED_CHANGES"),J.i18n("writer.trackchange.ACCEPT_ALL_INSELECTION_CONFRIM_TEXT"),null,function(e){switch(e){case CONST.BUTTON_YES_CLICKED:TcUtil.acceptAllInRange()}})},TcUtil.rejectAllInRangeConfirm=function(){MsgDialog.showMessage(CONST.MSG_TYPE_YESNO,CONST.SEVERITY_WARNING,J.i18n("writer.trackchange.REJECT_SELECTED_CHANGES"),J.i18n("writer.trackchange.REJECT_All_INSELECTION_CONFRIM_TEXT"),null,function(e){switch(e){case CONST.BUTTON_YES_CLICKED:TcUtil.rejectAllInRange()}})},TcUtil.isEqualTCStyles=function(e,t){if(!e.hasOwnProperty(TCConstants.TC)||!t.hasOwnProperty(TCConstants.TC))return!1;var e=DocUtil.copyStyle(e),t=DocUtil.copyStyle(t);return DocUtil.deleteTimeStampInTCStyle(e[TCConstants.TC]),DocUtil.deleteTimeStampInTCStyle(t[TCConstants.TC]),U.isEqual(e,t)},TcUtil.selectRevision=function(e){TrackChangeUI.unbindTooltip(),TcUtil.clearFocusingLines();var t=TcUtil.selectRevisionContent(e);t&&t.promise().then(function(){TcPane.selectRevision(e),TcUtil.drawLineToFocus(e)})},TcUtil.clearFocusingLines=function(){ReviewUtil.focusLine.revision.remove()},TcUtil.drawLineToFocus=function(e){var t=TcManager.getCollection().get(e).toJson(),n=t.type===TCConstants.ROW?t.start+2:t.start,i=DocTreeManager.lineAtIndex(n),o=J(i.el).offset(),r=TcPane.getNodeElementMap()[e],a=r.offset(),s=CurUtil.offset.start;s.top=o.top;var l=r.find("#author_img");a.top=l.offset().top+l.height(),ReviewUtil.focusLine.revision.drawLine(a,s,e)},TcUtil.selectRevisionContent=function(e){var t=editor.doc.getSelection();if(t&&e){var n=TcManager.getCollection().get(e).toJson(),i=n.start,o=n.end;n.type===TCConstants.ROW?(o=TableUtil.getRowEnd(i+1),i+=2):o+=1;var r=editor.doc.createRange(i,o);t.removeAllRanges().setSelectionType(SEL_AUTO_GEN).addRange(r);var a=Utils.scrollElementIntoView(editor.doc.getCursorPortionNode());return a}},TcUtil.switchToChangesTab=function(){ReviewUtil.switchTab("review",!0)},TcUtil.focusRevision=function(){ReviewUtil.switchTab("review");var e=editor.doc.getSelection().getStart(),t=TcManager.getIntersectingNodes(e),n=TcManager.getCollection().getAtIndex(t[0]),i=n.getId();TcPane.selectRevision(i);var o=TcPane.scrollRevisionIntoView(i);o&&o.then(function(){TcUtil.drawLineToFocus(i)}),Utils.addToStatistics("Tc_RightClick_ReviewChange")},TcUtil.addUserInContainer=function(e){editor.getView()===EDITOR_VIEWS.HISTORY||Utils.isVersionView()||ReviewUtil.addUserInUserListPanel(e)},TcUtil.removeUserInContainer=function(e){ReviewUtil.removeUserInUserListPanel(e)},TcUtil.positionUsersList=function(){ReviewUtil.positionUserListPanel()},TcUtil.drawUsersList=function(){ReviewUtil.removeUsersInUserListPanel();var e=TcManager.getCollection().getVisibleNodesCountDetails(),t=e.authors;for(zuid in t)t.hasOwnProperty(zuid)&&TcUtil.addUserInContainer(zuid);TcUtil.positionUsersList()},TcUtil.toggleUsersListAndBanner=function(e,t){e!==t&&(e===LAYOUTS.VERSIONHISTORY||e===LAYOUTS.MAILMERGEPREVIEW||e===LAYOUTS.PRINTPREVIEW?ReviewUtil.showUserListPanel():t!==LAYOUTS.VERSIONHISTORY&&t!==LAYOUTS.MAILMERGEPREVIEW&&t!==LAYOUTS.PRINTPREVIEW||ReviewUtil.hideUserListPanel())},TcUtil.updateUserColorInUserList=function(e){var t=ReviewUtil.getUserColour(e);e="$"==e.toString().charAt(0)?e.slice(1,e.length):e,Z("userlist-panel").find("#user_"+e+" span").css("border-color",t)},TcUtil.markupMenuBeforeShow=function(){var e=Z("tcviewsmenu");e.find(".ui-icon-tick-sm").removeClass("ui-writer-menu-icons ui-icon-sprit-image-blue ui-icon-tick-sm"),e.find("li#tc_markup_view_"+TrackChangeDetails.getDisplayMode()+" .ui-icon").addClass("ui-writer-menu-icons ui-icon-sprit-image-blue ui-icon-tick-sm")},TcUtil.hasTCDeletion=function(e){if(e&&e.hasOwnProperty(TCConstants.TC))for(var t=e[TCConstants.TC],n=0,i=t.length;n<i;n++){var o=t[n];if(o[TCConstants.ACTION]===TCConstants.DELETE)return!0}return!1},TcUtil.getTcDeletionDetails=function(e){var t,n,i;if(e&&e.hasOwnProperty(TCConstants.TC)){var o=e[TCConstants.TC];i="";for(var r=0,a=o.length;r<a;r++){var s=o[r];if(n=s[TCConstants.ZUID],s[TCConstants.ACTION]===TCConstants.DELETE){t=TC_ACTION_DELETE,i=s[TCConstants.TASK]?s[TCConstants.TASK]:"";break}t=TC_ACTION_INSERT,i=s[TCConstants.TASK]?s[TCConstants.TASK]:""}}return{action:t,zuid:n,task:i}},TcUtil.hasTCInsertion=function(e){if(e&&e.hasOwnProperty(TCConstants.TC))for(var t=e[TCConstants.TC],n=0,i=t.length;n<i;n++){var o=t[n];if(o[TCConstants.ACTION]===TCConstants.INSERT)return!0}return!1},TcUtil.hasTCProperty=function(e){var t=editor.doc.getRawFormatAt(e);return t||(t=DocUtil.getTextStyle(e)),!!t.hasOwnProperty(TCConstants.TC)},TcUtil.canCopy=function(e){return!TcUtil.hasTCDeletion(e)},TcUtil.sortTCVals=function(e){var t=e[0],n=e[1];if(n[TCConstants.ACTION]===TCConstants.INSERT&&t[TCConstants.ACTION]===TCConstants.DELETE){var i=e.splice(1,1);e.splice(0,0,i[0])}},TcUtil.isAllWithTCInsertionInPara=function(e,t){for(var n=e;n<t;n++){var i=editor.doc.getRawFormatAt(n);if(i&&!TcUtil.hasTCInsertion(i))return!1}return!0},TcUtil.getUserColors=function(e,t){var n={};J.ajax({type:"GET",url:Utils.getNiceUrlPrefix("getusercolors"),data:n,dataType:"json",success:function(t){e(t.usercolors)},error:function(e,n,i){t(i)}})},TcUtil.setUserColor=function(e){var t={};t.color=e,Utils.setCsrfParam(t);var n=editor.doc.getUserData()[editor.zuid].color;J.ajax({type:"POST",url:Utils.getUrl("updateusercolor"),data:t,dataType:"json",success:function(e){if("SUCCESS"===e.RESPONSE){var t=editor.doc.getUserData();t[editor.zuid].color=e.color,t[editor.zuid].light_color=e.lightColor,editor.doc.setUserData(t),UIUtils.showMessage("info",J.i18n("writer.common.USER_COLOR_UPDATED_MSG"),"showclose","normalfont",3e3),PubSub.publish("Document/UsercolorUpdated",editor.zuid)}else setTimeout(function(e){TrackChangeUI.selectColorInColorPopup(e)},1e3,n),UIUtils.showMessage("error",J.i18n("writer.common.UNABLE_TO_UPDATE_USER_COLOR"),"showclose","normalfont",3e3)},error:function(e,t,i){setTimeout(function(e){TrackChangeUI.selectColorInColorPopup(e)},1e3,n),UIUtils.showMessage("error",J.i18n("writer.common.UNABLE_TO_UPDATE_USER_COLOR"),"showclose","normalfont",3e3)}})},TcUtil.setDefaultUserColor=function(e,t){var n={};n.rid=editor.doc.getDocInfo().RID,n.isdefaultcolor=e,e&&(n.color=t),Utils.setCsrfParam(n),J.ajax({type:"POST",url:Utils.getNiceUrlPrefix("user/settings/usercolor"),data:n,dataType:"json",success:function(n){var i=editor.doc.getUserData()[editor.zuid];"SUCCESS"===n.RESPONSE?e?i.default_color=t:delete i.default_color:UIUtils.showMessage("error",J.i18n("writer.common.UNABLE_TO_UPDATE_USER_COLOR"),"showclose","normalfont",3e3),TrackChangeUI.selectColorInColorPopup(i.color)},error:function(e,n,i){TrackChangeUI.selectColorInColorPopup(t),UIUtils.showMessage("error",J.i18n("writer.common.UNABLE_TO_UPDATE_USER_COLOR"),"showclose","normalfont",3e3)}})},TcUtil.updateUserColorInDoc=function(e){if(!editor.doc.getTrackChangeDetails().isNoMarkupON()){var t=TcManager.getCollection().getVisibleNodesCountDetails().authors[e];if(t&&(t[TCConstants.INSERT]>0||t[TCConstants.DELETE]>0)){for(var n,i,o=TcManager.getCollection().getAllNodes(),r=new DocOpBuilder,a=0,s=o.length;a<s;a++)n=o[a],n.getUser()===e&&(i=DocOpBuilder.build(n.getTcIndicesOp(n.getStart(),n.getEnd())),r=DocOpBuilder.compose(r,i),r=DocOpBuilder.concise(r));editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!0),r.applyTo(),editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!1)}}},TcUtil.updateUserColor=function(e){TcUtil.updateUserColorInDoc(e),TcUtil.updateUserColorInUserList(e)},TcUtil.updateCollabColor=function(e){e!=editor.zuid&&TcUtil.updateUserColor(e)},TcUtil.acceptAllFromRemoteClient=function(){var e=editor.doc.getTrackChangeDetails();if(!e.canReview())return{RESPONSE:"FAILED",ERROR_CODE:"PERMISSION_DENIED"};try{TcUtil.acceptAll()}catch(e){return{RESPONSE:"FAILED",ERROR_CODE:"CLIENT_ERROR"}}return{RESPONSE:"SUCCESS"}},TcUtil.rejectAllFromRemoteClient=function(){var e=editor.doc.getTrackChangeDetails();if(!e.canReview())return{RESPONSE:"FAILED",ERROR_CODE:"PERMISSION_DENIED"};try{TcUtil.rejectAll()}catch(e){return{RESPONSE:"FAILED",ERROR_CODE:"CLIENT_ERROR"}}return{RESPONSE:"SUCCESS"}},TcUtil.getDisplayMode=function(){var e=editor.doc.getTrackChangeDetails().getDisplayMode(),t="";return t=e===TCConstants.NO_MARKUP_VIEW?"No markup":e===TCConstants.ORIGINAL_VIEW?"Original":"All markup"},TcUtil.getNearestFormat=function(e){for(;e>0&&!editor.doc.getRawFormatAt(e);)e--;return editor.doc.getRawFormatAt(e)},TcUtil.updateRevisionfocus=function(e){if(e==editor.uuid&&editor.doc.getSelection().selectionType!==SEL_AUTO_GEN){var t,n=editor.doc.getSelection().getStart(),i=TcUtil.getNearestFormat(n);if(i.hasOwnProperty(TCConstants.TC)){var o=TcManager.getCollection().getNodesAtDocIndex(n),r=i[TCConstants.TC];r.length>1&&TcUtil.sortTCVals(r);for(var a,s=r[r.length-1],l=0,d=o.length;l<d;l++)if(a=o[l],a.getAction()===s.action&&a.getUser()===s.zuid){t=!0,TcUtil.focusedTcNode&&a.getId()==TcUtil.focusedTcNode.getId()?PubSub.publish("Document/TCContent/CurPosChanged",a):(TcUtil.focusedTcNode=a,PubSub.publish("Document/TCContent/FocusIn",a));break}}t||TcUtil.unFocusRevision()}},TcUtil.unFocusRevision=function(){TcUtil.focusedTcNode=void 0,PubSub.publish("Document/TCContent/FocusOut")},TcUtil.bindRevisionFocusEvents=function(){editor.isEditable()&&"SHAREDREADCOMMENT"!=editor.doc.getRole()&&(PubSub.subscribe("Document/CursorPositionChanged",TcUtil.updateRevisionfocus),PubSub.subscribe("Document/ModeOpened",TcUtil.unFocusRevision))},TcUtil.addSubscribers=function(){PubSub.subscribe("Document/FirstTimeComponentReady",TcUtil.bindRevisionFocusEvents),PubSub.subscribe("Document/ComponentReady",TcUtil.drawUsersList),PubSub.subscribe("Document/TC/UserAdded",TcUtil.addUserInContainer),PubSub.subscribe("Document/TC/UserRemoved",TcUtil.removeUserInContainer),PubSub.subscribe("Document/LayoutChanged",TcUtil.toggleUsersListAndBanner),PubSub.subscribe("UiEvents/EditorParentOffsetChanged",TcUtil.positionUsersList),PubSub.subscribe("Collaboration/UsercolorUpdated",TcUtil.updateCollabColor),PubSub.subscribe("Document/UsercolorUpdated",TcUtil.updateUserColor)}();var TcManager=function(e,t,n,i,o,r,a){var s=null,l=function(){var e=[],t={},i={},r=function(){e=[],t={ins:0,del:0},i={}},a=function(e,t){i.hasOwnProperty(e)||(i[e]={ins:0,del:0},n.publish("Document/TC/UserAdded",e)),t==o.INSERT?i[e].ins+=1:i[e].del+=1},s=function(e,t){t==o.INSERT?i[e].ins-=1:i[e].del-=1,0==i[e].ins&&0==i[e].del&&(delete i[e],n.publish("Document/TC/UserRemoved",e))},d=function(i,o){var r,s=e[i-1]||null,l=e[i]||null;o.prev=s,s&&(s.next=o),o.next=l,l&&(l.prev=o),o.fillLinkNodes(e),e.splice(i,0,o),o.isHiddenNode()||(t[o.getAction()]=t[o.getAction()]+1,r=o.getUser(),a(r,o.action)),n.publish("Document/TC/CountUpdated")},c=function(e,t){var n,i,o;for(n=0,i=t.length;n<i;n++)o=t[n],d(e++,o)},u=function(t){d(e.length,t)},p=function(e){for(var t=e.getId(),n=0,i=e.getLinkedNodes().length;n<i;n++)for(var o=e.getLinkedNodes()[n],r=o.getLinkedNodes(),a=0,s=r.length;a<s;a++)if(r[a].getId()===t){r.splice(a,1);break}},h=function(i){var o,r=e[i],a=r.prev||null,l=r.next||null;a&&(a.next=l),l&&(l.prev=a),r.prev=null,r.next=null,p(r),e.splice(i,1),r.isHiddenNode()||(t[r.getAction()]=t[r.getAction()]-1,o=r.getUser(),s(o,r.action)),n.publish("Document/TC/CountUpdated")},f=function(t){var n,i;for(n=0;n<e.length;n++)i=e[n],i.getId()===t&&(h(n),n--)},m=function(t){return e[t]},g=function(t){var n,i,o;for(n=0,i=e.length;n<i;n++)if(o=e[n],o.getId()===t)return o;return null},T=function(t){for(var n,i=null,o=0,r=e.length;o<r&&(i=e[o],n=e[o+1],!n||!(n.getStart()>=t||n.getEnd()>=t));o++);return i&&(i.getStart()>=t||i.getEnd()>=t)&&(i=null),i},_=function(t,n,i){var o=T(t),r=null;for(o||(o=e[0]);o;){if(t>=o.getStart()&&t<=o.getEnd()&&o.getAction()===n&&o.getUser()===i){r=o;break}if(o.getStart()>t)break;o=o.next}return r},E=function(e,t,n){return t<=e.getStart()&&e.getStart()<=n||t<=e.getEnd()&&e.getEnd()<=n||e.getStart()<=t&&n<=e.getEnd()},v=function(t,n){var i=[];if(0===e.length)return i;var o=T(t);if(o||(o=e[0]),o&&E(o,t,n)&&!o.isHiddenNode()&&i.push(o),o)for(;o.next&&E(o.next,t,n);)!o.isHiddenNode()&&i.push(o.next),o=o.next;return i},S=function(t,n){var i=T(t),o=!1;if(i||(i=e[0]),!i)return!1;if(o=E(i,t,n)&&!i.isHiddenNode(),!o)for(;i.next&&E(i.next,t,n);)if(i=i.next,!i.isHiddenNode()){o=!0;break}return o},b=function(t){var n=T(t),i=[];for(n||(n=e[0]);n;){if(n.getStart()<=t&&t<=n.getEnd())i.push(n);else if(n.getStart()>t)break;n=n.next}return i},R=function(){return e},O=function(){return e.length},D=function(t){var n,i,o,r,a=t.getStart(),s=!1;for(f(t.getId()),n=0,i=e.length;n<i;n++)if(o=e[n],r=o.getStart(),a<=r){d(n,t),s=!0;break}s||u(t)},y=function(t){var n,i,o,r=0,a=0;if(e.length>0){for(;r<t.length&&a<e.length;)i=t[r],o=e[a],node1Start=i.getStart(),node2Start=o.getStart(),node1Start===node2Start?(d(a,i),r++,a++):node1Start<node2Start?(d(a,i),r++,a++):a++;if(r!==t.length)for(n=r;n<t.length;n++)u(t[n])}else for(r=0;r<t.length;r++)u(t[r])},A=function(e,t){var n,i;for(i=l.length()-1;i>=0&&(n=l.getAtIndex(i),e<=n.getStart());i--)n.updateIndices(t)},C=function(t){var n,i,o;for(n=0,i=e.length;n<i;n++)o=e[n],o.setMode(t)},I=function(){var t,n,i,o=[];for(t=0,n=e.length;t<n;t++)i=e[t],o.push(i.toJson());return o},w=function(){var t,n,i,o="";for(t=0,n=e.length;t<n;t++)i=e[t],o+="\n"+JSON.stringify(i.toJson());return o},P=function(){var e={all:t[o.INSERT]+t[o.DELETE],ins:t[o.INSERT],del:t[o.DELETE],authors:{}};for(var n in i)i.hasOwnProperty(n)&&(e.authors[n]=i[n]);return e};return{init:r,addAll:c,remove:h,removeNodeById:f,getAtIndex:m,get:g,getNode:_,getAllNodes:R,getNodesAtDocIndex:b,length:O,injectNodes:y,placeNode:D,updateIndices:A,setMode:C,getVisibleNodesCountDetails:P,getNearestNode:T,isNodeInRange:S,getNodesInRange:v,toJson:I,toString:w}}(),d=function(){var e;l.init(),e=u(0,editor.doc.getDocumentLength()),p(e),l.addAll(0,e)},c=function(e){var t,i,o,r;for(t=0,i=e.length;t<i;t++)o=e[t],r=o.getId(),n.publish("Document/TC/NodeRemoved",o),l.removeNodeById(r)},u=function(e,t){var n,i,s,l,d,c,u,p,h,f,m,g,T,_,E,v=[],S=[],b=function(e,t){S.push(t),v.splice(e,1)},R=function(e){var t,n;for(t=0;t<v.length;t++)n=v[t],n.setEnd(e-1),b(t,n),t--;v=[]},O=function(e,t,n){var i,o;for(i=0;i<e.length;i++)if(o=e[i],o.getAction()===t&&o.getUser()===n)return!0;return!1},D=function(e,t,n){var i,r,a,s;if(e&&e.hasOwnProperty(o.TC))for(a=e[o.TC],i=0,r=a.length;i<r;i++)if(s=a[i],s[o.ACTION]===t&&s[o.ZUID]===n)return!0;return!1};for(s=e;s<t;s++)if(n=editor.doc.getRawFormatAt(s),l=a.getFormatTypeAtIndex(s),n&&n.hasOwnProperty(o.TC)){for(d=n[o.TC],c=r.isBlockNodeType(l),u=0,c&&(u=r.getBlockEnd(s,l)),i=0;i<v.length;i++)p=v[i],!c&&D(n,p.getAction(),p.getUser())||(p.setEnd(s-1),b(i,p),i--);for(_=0;_<d.length;_++)h=d[_],f=h[o.ACTION],m=h[o.ZUID],g=h[o.TIME],E=r.isInBlockNode(S,s,f,m),c?E||(T=r.createNode(s,u,m,f,g,l),S.push(T)):O(v,f,m)||E||(T=r.createNode(s,u,m,f,g,NODE_TYPE.TEXT),v.push(T))}else n&&!n.hasOwnProperty(o.TC)&&R(s);return R(s),S},p=function(e){var t,n,i;for(t=0,i=e.length;t<i-1;t++)for(n=t+1;n<i;n++)e[t].getStart()>e[n].getStart()&&(temp=e[t],e.splice(t,1,e[n]),e.splice(n,1,temp))},h=function(e,t){var n,i,o=[],r=l.length();for(t=t?t:e,n=0;n<r;n++)if(i=l.getAtIndex(n),i.getStart()<=e&&e<=i.getEnd()||i.getStart()<=t&&t<=i.getEnd()||e<=i.getStart()&&i.getEnd()<=t)o.push(n);else if(i.getStart()>e)break;return o},f=function(e){var t=l.getNearestNode(e),n=[];for(t||(t=l.getAllNodes()[0]);t;){if(t.getStart()<e&&e<=t.getEnd())n.push(t);else if(e<t.getStart())break;t=t.next}return n},m=function(e,t){var n=[],i=[],o=[],r=[],a=l.getNearestNode(e);for(a||(a=l.getAllNodes()[0]);a;){if(e<=a.getStart()&&a.getEnd()<=t)o.push(a);else if(a.getStart()<e&&t<a.getEnd())r.push(a);else if(e<=a.getStart()&&a.getStart()<=t&&a.getEnd()>t)n.push(a);else if(e<=a.getEnd()&&a.getEnd()<=t&&a.getStart()<e)i.push(a);else if(e<a.getStart()&&t<a.getStart())break;a=a.next}return n.length||i.length||o.length||r.length?{startOnly:n,endOnly:i,fullyIn:o,fullyOut:r}:null},g=function(e,t,n,i){var o=e.getStart(),r=e.getEnd();o<t&&n-1<=r&&(E(e,t-1),T(n,r+i,e.getAction(),e.getUser(),e.getTime(),e.getType()))},T=function(e,t,i,o,a,s){var d,c=r.isBlockNodeType(s),u=0;c?(u=r.getBlockEnd(e,s),d=r.createNode(e,u,o,i,a,s)):d=r.createNode(e,t,o,i,a,NODE_TYPE.TEXT),l.injectNodes([d]),n.publish("Document/TC/NodeCreated",d)},_=function(e,t){e.setStart(t),TcManager.getCollection().placeNode(e),e.setMode(o.UPDATE_MODE),n.publish("Document/TC/NodeUpdated",e)},E=function(e,t){e.isBlockNode()?e.setEnd(r.getBlockEnd(e.getStart(),e.getType())):e.setEnd(t),e.setMode(o.UPDATE_MODE),n.publish("Document/TC/NodeUpdated",e)},v=function(e,t,n){var s,d,c,u,p,h,m,_,v,S,b=t-e,R=a.getFormatTypeAtIndex(e);if(0!=b&&l.updateIndices(e,b),n||(n=i.getTextStyle(e),ch=editor.doc.getCharAt(e),R=a.getFormatType(n,ch)),n&&n.hasOwnProperty(o.TC))for(s=n[o.TC],s.length>1&&a.sortTCVals(s),d=0;d<s.length;d++)if(c=s[d],u=c[o.ZUID],p=c[o.TIME],h=c[o.ACTION],m=f(e),m.length)for(_=0,v=m.length;_<v;_++)S=m[_],S.getAction()===h&&S.getUser()!==u||S.getAction()===o.DELETE&&h===o.INSERT?(S.isBlockNode()?E(S):g(S,e,t,b),T(e,t-1,h,u,p,R)):S.getAction()===h&&S.getUser()===u?r.isBlockNodeType(R)&&!S.isBlockNode()?(g(S,e,t,b),T(e,t-1,h,u,p,R)):E(S,S.getEnd()+b):S.getAction()===o.INSERT&&h===o.DELETE&&D(e,t,u,h,p,R);else D(e,t,u,h,p,R);else if(n&&!n.hasOwnProperty(o.TC)&&(m=f(e),m.length))for(_=0,v=m.length;_<v;_++)S=m[_],S.isBlockNode()?E(S):g(S,e,t,b)},S=function(e,t){var n,i,o,r,a=l.getNodesAtDocIndex(e),s=l.getNodesAtDocIndex(t);for(n=0;n<a.length;n++)for(o=a[n],i=0;i<s.length;i++)r=s[i],o.isBlockNode()||r.isBlockNode()||!o.isEquals(r)||o.getId()===r.getId()||(E(o,r.getEnd()),c([r]))},b=function(e,t){var n,i,o,r,a,s,d,u=e-t,p=m(e,t-1);if(p){for(o=p.fullyIn,r=[],n=0;n<o.length;n++)i=o[n],r.push(i);for(c(r),a=p.fullyOut,n=0;n<a.length;n++)i=a[n],i.canDeleteTheRange(e,t-1)&&E(i,i.getEnd()+u);for(s=p.startOnly,n=0;n<s.length;n++)i=s[n],_(i,t);for(d=p.endOnly,n=0;n<d.length;n++)i=d[n],E(i,e-1);0!=u&&l.updateIndices(t,u)}else 0!=u&&l.updateIndices(t,u);S(e-1,t+u)},R=function(e,t,n){var i,o,r;for(i=0,o=e.length;i<o;i++)if(r=e[i],r.isBlockNode()&&(E(r),r.getStart()<=t&&n<=r.getEnd()))return!0;return!1},O=function(e,t,n){var i,o,r;for(i=0,o=e.length;i<o;i++)if(r=e[i],!r.isBlockNode()&&r.getAction()===t&&r.getUser()===n)return r;return null},D=function(e,t,n,i,o,a){var s,d,u,p,h,f=!1;if(!r.isBlockNodeType(a)){if(d=l.getNodesAtDocIndex(e-1),s=R(d,e,t))return;u=O(d,i,n),p=l.getNodesAtDocIndex(t),h=O(p,i,n),u&&h?(E(u,h.getEnd()),c([h]),f=!0):u?(E(u,t-1),f=!0):h&&(_(h,e),f=!0)}f||T(e,t-1,i,n,o,a)},y=function(e,t,n){var r,s,l,d,u,p,h,f,T,v,S,b,R,O,y,C,I=a.getFormatTypeAtIndex(e);if(n||(n=i.getTextStyle(e),r=editor.doc.getCharAt(e),I=a.getFormatType(n,r)),n&&n.hasOwnProperty(o.TC))for(d=n[o.TC],d.length>1&&a.sortTCVals(d),u=0;u<d.length;u++)if(p=d[u],h=p[o.ZUID],T=p[o.TIME],f=p[o.ACTION],v=!1,S=m(e,t-1)){for(b=S.fullyIn,R=[],s=0;s<b.length;s++)l=b[s],l.getAction()===f&&R.push(l);for(c(R),O=S.fullyOut,s=0;s<O.length;s++)l=O[s],l.getAction()===f&&l.getUser()!==h?l.isBlockNode()||g(l,e,t,0):l.getAction()===f&&l.getUser()===h&&(v=!0);for(y=S.startOnly,s=0;s<y.length;s++)l=y[s],l.getAction()===f&&l.getUser()===h&&(l.isBlockNode()?v=!0:_(l,t));for(C=S.endOnly,s=0;s<C.length;s++)l=C[s],l.getAction()===f&&l.getUser()===h&&(l.isBlockNode()?v=!0:E(l,e-1));v||D(e,t,h,f,T,I)}else D(e,t,h,f,T,I);else if(n&&!n.hasOwnProperty(o.TC)&&(S=m(e,t-1))){for(b=S.fullyIn,R=[],s=0;s<b.length;s++)l=b[s],R.push(l);for(c(R),O=S.fullyOut,s=0;s<O.length;s++)l=O[s],l.isBlockNode()||g(l,e,t,0);for(y=S.startOnly,R=[],s=0;s<y.length;s++)l=y[s],l.isBlockNode()?R.push(l):_(l,t);for(c(R),C=S.endOnly,s=0;s<C.length;s++)l=C[s],l.isBlockNode()||E(l,e-1)}A(e,t,n)},A=function(e,t,n){var i,r,a,s,l,d,u,p,h=m(e,t-1),f=function(e,t){var n,i,r,a,s;for(n=0,i=t.length;n<i;n++)if(r=t[n],a=r[o.ZUID],s=r[o.ACTION],e.getAction()===s&&e.getUser()===a)return!0;return!1};if(h&&n&&n.hasOwnProperty(o.TC)){for(i=n[o.TC],s=h.fullyIn,l=[],r=0;r<s.length;r++)a=s[r],f(a,i)||l.push(a);for(c(l),d=h.fullyOut,r=0;r<d.length;r++)a=d[r],f(a,i)||a.isBlockNode()||(E(a,e-1),T(t,a.getEnd(),a.getAction(),a.getUser(),a.getTime(),a.getType()));for(u=h.startOnly,r=0;r<u.length;r++)a=u[r],f(a,i)||(a.isBlockNode()?c([a]):_(a,t));for(p=h.endOnly,r=0;r<p.length;r++)a=p[r],f(a,i)||a.isBlockNode()||E(a,e-1)}},C=function(){var e,t,i,r,a,l,d;if(s){if(n.publish("Document/TC/ModelUpdationStarted"),e=s.type,t=s.from,i=s.to,e===o.INSERT?fn=v:e===o.DELETE?fn=b:e===o.UPDATE&&(fn=y),e===o.DELETE)fn(t,i);else{for(a=t,l=editor.doc.getRawFormatAt(a),d=t+1;d<i;d++)r=editor.doc.getRawFormatAt(d),r&&(fn(a,d,l),l=r,a=d);fn(a,d,l)}s=null}},I=function(e,t){if(editor.getView()!==EDITOR_VIEWS.HISTORY&&!Utils.isVersionView()){var n=!0;s&&(s.type==o.INSERT&&s.to==e?(s.to=t,n=!1):C()),n&&(s={type:o.INSERT,from:e,to:t})}},w=function(e,t,n){if(editor.getView()!==EDITOR_VIEWS.HISTORY&&!Utils.isVersionView()){var i=!0;s&&(s.type==o.DELETE&&s.to==e+(s.to-s.from)?(s.to+=t-e,i=!1):C()),i&&(s={type:o.DELETE,from:e,to:t})}},P=function(e,t){if(editor.getView()!==EDITOR_VIEWS.HISTORY&&!Utils.isVersionView()){var n=!0;s&&(s.type==o.INSERT?s.from<=e&&s.to==t?n=!1:C():s.type==o.DELETE?C():s.type==o.UPDATE&&(s.to==e?(s.to=t,n=!1):s.from==e&&s.to==t?n=!1:C())),n&&(s={type:o.UPDATE,from:e,to:t})}},M=function(){return l},L=function(e,t,n){return l.getNode(e,t,n)},N=function(){var e=l.getVisibleNodesCountDetails();return!(e.all>0)};return n.subscribe("Document/ContentAdded",I),n.subscribe("Document/ContentDeleted",w),n.subscribe("Document/StyleChanged",P),{init:d,getCollection:M,addToTree:I,deleteFromTree:w,updateTree:P,applyChanges:C,getIntersectingNodes:h,getNodeAtDocIndex:L,isEmpty:N,getIntersectingNodesForUpdate:m,getIntersectingNodesForIns:f}}(jQuery,Z,PubSub,DocUtil,TCConstants,TcBlockHandler,TcUtil);!function(){var e,t,n,i,o,r,a={},s={find:function(e){return this.def[e]||{type:"(number)",value:0}},init:function(e){var t,n;this.def={};for(var i in e)t=parseFloat(e[i]),n="(number)",isNaN(e[i])&&(t=0,n="(literal)"),this.def[i.toUpperCase()]={type:n,value:t}}},l={ABS:1,AND:1,AVERAGE:1,COUNT:1,INT:1,MAX:1,MIN:1,MOD:1,NOT:1,OR:1,PRODUCT:1,ROUND:1,SIGN:1,SUM:1},d={ABOVE:1,BELOW:1,LEFT:1,RIGHT:1},c=function(e){throw{message:e}},u={nud:function(){c("Undefined.")},led:function(e){c("Missing operator.")}},p=function(e){var t,n,i,o,r="=<>!",a="=",s=[],l=0,d=function(e,t){return{type:e,value:t,from:n,to:l}},u=function(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"},p=function(){return t>="0"&&t<="9"};if(!e)return s;for(t=e.charAt(l);t;)if(n=l," "==t)l+=1,t=e.charAt(l);else if(u(t)){for(i=t,l+=1;t=e.charAt(l),u(t)||p(t);)i+=t,l+=1;s.push(d("name",i))}else if(p(t)){for(i=t,l+=1;t=e.charAt(l),p(t);)i+=t,l+=1;if("."==t)for(i+=t,l+=1;t=e.charAt(l),p(t);)i+=t,l+=1;if("e"==t||"E"==t){i+=t,l+=1,t=e.charAt(l),"-"!==t&&"+"!==t||(i+=t,l+=1,t=e.charAt(l)),p(t)||c("Bad exponent");do i+=t,l+=1,t=e.charAt(l);while(p(t))}u(t)&&(i+=t,l+=1,c("Bad number")),o=+i,isFinite(o)?s.push(d("number",o)):c("Bad number")}else r.indexOf(t)>=0?(i=t,l+=1,t=e.charAt(l),a.indexOf(t)>=0&&(i+=t,l+=1,t=e.charAt(l)),s.push(d("operator",i))):(l+=1,s.push(d("operator",t)),t=e.charAt(l));return s},h=function(e,t){var n=a[e];return t=t||0,n?t>n.lbp&&(n.lbp=t):(n=f(u),n.id=n.value=e,n.lbp=t,a[e]=n),n},f=function(e){var t={};for(var n in e)t[n]=e[n];return t},m=function(i){var o,r,u,p,h,m;i&&n.id!==i&&c("Expected '"+i+"'."),t>=e.length||(o=e[t],t+=1,r=h=o.value,u=o.type,"name"==u?l[r]||d[r]?p=a[r]:s.find(r)&&(m=s.find(r),r=m.value,u=m.type,p=a[u]):"operator"==u?(p=a[r],p||c("Unknown operator.")):"number"==u?p=a["(number)"]:c("Unexpected token."),n=f(p),n.from=o.from,n.to=o.to,n.value=r,n.type=u,n.name=h)},g=function(e){var t,i=n;for(e=e||0,m(),t=i.nud();e<n.lbp;)i=n,m(),t=i.led(t);return t},T=function(e,t,n){var i=h(e,t);i.led=n},_=function(e,t){var n=h(e);n.nud=t},E=function(e,t){_(e,function(){return t})},v=function(e,t,n){_(e,function(){return function(e){return e.reduce(t,S(n||0))}})},S=function(e){return{value:e}},b=function(e){var t,n=s.find(e),i=a[n.type];return t=f(i),t.value=n.value,t.type=n.type,t.name=e,t};h(")"),h(","),h("(number)").nud=function(){return{name:this.name,value:this.value}},h("(literal)").nud=function(){return{name:this.name,value:this.value}},h("ABOVE").nud=function(){for(var e,t=[],n=i-1,r=o;n>=1;)e=b(r+n),"(number)"==e.type&&t.push(e),n-=1;return t},h("BELOW").nud=function(){for(var e,t=[],n=i+1,a=r.rows,s=o;n<=a;)e=b(s+n),"(number)"==e.type&&t.push(e),n+=1;return t},h("LEFT").nud=function(){for(var e,t=[],n=i,r=String.fromCharCode(o.charCodeAt()-1);r>="A";)e=b(r+n),"(number)"==e.type&&t.push(e),r=String.fromCharCode(r.charCodeAt()-1);return t},h("RIGHT").nud=function(){for(var e,t=[],n=i,a=String.fromCharCode(o.charCodeAt()+1),s=String.fromCharCode("A".charCodeAt()+r.cols-1);a<=s;)e=b(a+n),"(number)"==e.type&&t.push(e),a=String.fromCharCode(a.charCodeAt()+1);return t},T(":",100,function(e){for(var t,n,i=e.name.replace(/([A-Z])([\d])/g,"$1 $2").split(" "),o=g(0).name.replace(/([A-Z])([\d])/g,"$1 $2").split(" "),r=i[0],a=o[0],s=[];r<=a;){for(t=+i[1],n=+o[1];t<=n;)s.push(b(r+t)),t+=1;r=String.fromCharCode(r.charCodeAt()+1)}return s}),T("&&",30,function(e){var t=g(this.lbp);return S(e.value&&t?1:0)}),T("||",30,function(e){var t=g(this.lbp);return S(e.value||t?1:0)}),T("==",40,function(e){var t=g(this.lbp);return S(e.value==t?1:0)}),T("!=",40,function(e){var t=g(this.lbp);return S(e.value!=t?1:0)}),T("<",40,function(e){var t=g(this.lbp);return S(e.value<t?1:0)}),T("<=",40,function(e){var t=g(this.lbp);return S(e.value<=t?1:0)}),T(">",40,function(e){var t=g(this.lbp);return S(e.value>t?1:0)}),T(">=",40,function(e){var t=g(this.lbp);return S(e.value>=t?1:0)}),T("+",50,function(e){return S(e.value+g(this.lbp).value)}),T("-",50,function(e){return S(e.value-g(this.lbp).value)}),_("-",function(){return S(-g(0).value)}),T("*",60,function(e){return S(e.value*g(this.lbp).value)}),T("/",60,function(e){return S(e.value/g(this.lbp).value)}),T("%",40,function(e){return S(e.value%g(this.lbp).value)}),T("(",90,function(e){var t=[];if(")"!==n.id)for(;t.push(g(0)),","==n.id||":"==n.id;)m();return m(")"),t=t.reduce(function(e,t){return e.concat(t)},[]),t.length?e.call(null,t):S(0)}),_("(",function(){var e=g(0);return m(")"),e}),E("ABS",function(e){return S(Math.abs(e[0].value))}),v("AND",function(e,t){return S(e.value&&t.value?1:0)},1),E("AVERAGE",function(e){return S(e.reduce(function(e,t){return S(e.value+(t.value||0))}).value/e.length)}),v("COUNT",function(e,t){return S(e.value+(t.value?1:0))}),E("INT",function(e){return S(Math.floor(e[0].value))}),v("MAX",function(e,t){return S(Math.max(e.value,t.value))}),E("MIN",function(e){return e.reduce(function(t,n){return S(Math.min(t.value,n.value),e[0].value)})}),E("MOD",function(e){return S(e[0].value%e[1].value)}),E("NOT",function(e){return S(e[0].value?0:1)}),v("OR",function(e,t){return S(e.value||t.value?1:0)}),v("PRODUCT",function(e,t){return S(e.value*(t.value||(0===t.value?0:1)))},1),E("ROUND",function(e){return S(Math.round(e[0].value))}),E("SIGN",function(e){var t=e[0].value;return S(t>0?1:t<0?-1:0)}),v("SUM",function(e,t){return S(e.value+(t.value||0))}),window.Formula={calc:function(n,a,l,d){var c=/=([^\n]*)\n?/g;return n=c.exec(n)[1].toUpperCase(),l=l.replace(/([A-Z])([\d])/g,"$1 $2").split(" "),o=l[0],i=parseInt(l[1],10),r=d,s.init(a),e=p(n),t=0,m(),g().value}}}();var CurUtil=function(){"use strict";document.body.getBoundingClientRect().constructor.prototype.toRect=function(){return new n(this.top,this.right,this.bottom,this.left)};var e={},t=Math.round,n=function(e,t,n,i){this.top=e||0,this.right=t||0,this.bottom=n||0,this.left=i||0};n.prototype.clone=function(){return new n(this.top,this.right,this.bottom,this.left)},n.prototype.extendCoordinates=function(e,t){return this.top+=t,this.right+=e,this.bottom+=t,this.left+=e,this},n.prototype.width=function(){return Math.abs((this.right||0)-(this.left||0))},n.prototype.roundup=function(){return this.top=t(this.top),this.right=t(this.right),this.bottom=t(this.bottom),this.left=t(this.left),this};var i=function(e){return Object.defineProperties(e,{width:{get:function(){return Math.abs((this.right||0)-(this.left||0))}},height:{get:function(){return Math.abs((this.bottom||0)-(this.top||0))}},midWidth:{get:function(){return Math.abs((this.left||0)+(this.width||0)/2)}},midHeight:{get:function(){return Math.abs((this.top||0)+(this.height||0)/2)}}}),e};i(n.prototype);var o=function(){if(editor.doc.getRole()!=USER_ROLE.PUBLIC&&!is_wkhtmltopdf_browser&&editor.doc.getSelection().isCollapsed()&&editor.isEditable()&&!EventHandler.isMenuOpened&&!EventHandler.isDialogOpened){var e=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start");e&&e.addClass("blink")}},r=function(e){var t=e&&e.toLowerCase()||"";if(!t||"none"===t||"transparent"===t)return"";if(0===t.indexOf("rgba")){var n=t.replace(/[rgba()]*/g,"").split(",")||[];return n.length>3&&"0"!==n[3].trim()?"rgb("+n[0].trim()+","+n[1].trim()+","+n[2].trim()+")":""}return e},a=function(e,t,n){n=n||editor.doc.domCursor[t].zuid;var i=editor.doc.getUserData()||{};i=i[n]||{};var o=t!==editor.uuid,r=o&&i.color||"black",a="&#8203;",s="comment"===t?"":i.fname_HTML||"Unknown";o&&"comment"!==t&&(a='<div class="callout-con"><div class="callout user_name" style="background-color:'+r+";border:1px solid "+r+';color:white;font-weight:bold;">'+s+'</div><div class="callout-outer" style="border-top-color:'+r+'"><div class="callout-inner" style="border-top:5px solid '+r+';display:none;"></div></div></div>');var l=J(document.createElement("div")).attr("id","z-cursor-"+e+"-"+t).addClass(o?"otherUserCollapsedCursor":"cursor").css("border-color",r).append(a).appendTo(editor.jeditorPane[0]);return editor.doc.setDomCursorNode(t,e,l),l[0]},s=function(e){var t=editor.doc.getSelection().isCollapsed();if((!e||"end"==e&&t)&&(e="start"),"start"==e&&t){var i=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,e),o=i&&i.offset()||{},r=parseFloat(o.left||0),a=parseFloat(i[0].style.top||0);return new n(a,r+2,a+parseFloat(i[0].style.height||0),r)}return CurUtil.offset[e].rects},l=function(e,t){return e=t?J(e).closestParent(".zw-tr").find(".zw-line-div:last")[0]:J(e).closest(".zw-line-div")[0],DocTreeManager.getStartIndex(e)},d=function(e){if(Utils.nodeNameEquals(e,"td"))return 0;e.nodeType===Node.TEXT_NODE&&(e=e.parentNode);var t=J(e);t.hasClass("zw-space")&&(t=t.closestParent(".zw-portion")),Utils.nodeNameEquals(t.parent()[0],"bdo")&&(t=t.parent());for(var n,i=0,o=t.prev();o.length;){n=J(o);var r=o[0];Utils.nodeNameEquals(r,"bdo")&&(r=n.children()[0]),i+=parseInt(r.getAttribute("data-text-len")||0),o=n.prev()}return i},c=function(e){e=e||editor.doc.getSelection(),e.setCursorFormat();var t=editor.doc.getDomCursorNode(e.SID,e.ZUID,"start");if(t&&e.isCollapsed()){var n=e.getComputedTextFormat(),i=e.getParaFormat(),o=TableUtil.getCellBgcAt(e.getStart()),a=editor.doc.getBodyFormat(),s={};if(s[ATTR_TEXT.TS_BGC]=r(n[ATTR_TEXT.TS_BGC])||r(i[ATTR_PARAGRAPH.PS_BGC])||r(o.z_td_bgc)||r(a[ATTR_BODY.DS_BGC]),DocUtil.constructRenderingFormat(s),s=Utils.rgbToHex(s[ATTR_TEXT.TS_BGC]||"rgb(255 , 255 , 255)"),e.SID===editor.uuid){var l=Utils.invertColor(s||"#000000");t.css("border-color",l)}s&&"italic"==s[ATTR_TEXT.TS_FS]?t.addClass("italic"):t.removeClass("italic")}},u=function(e){editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start").css("visibility",e?"visible":"hidden")},p=function(t){var n=editor.doc.getSelection(t);if(n&&n.isCollapsed()){var i=editor.doc.getDomCursorNode(t);i&&i.find(".callout-con").fadeIn(0,function(){var n=J(this);clearTimeout(e[t]),e[t]=setTimeout(function(){n.fadeOut("2500",function(){J(this).css("display","")}),delete e[t]},1e3)})}},h=function(e){if(editor.doc.getRole()!=USER_ROLE.PUBLIC&&!is_wkhtmltopdf_browser){var t=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start");t&&(e&&editor.doc.getSelection().isCollapsed()?t.addClass("blink"):t.removeClass("blink"))}};return{blinkCursor:o,createCursor:a,getBounds:s,getCursorLineOffset:l,getCursorPortionOffset:d,initCursor:c,offset:{start:{top:0,left:0,rects:{}},end:{top:0,left:0,rects:{}}},scrollTop:0,showCollbUserName:p,stopBlinking:h,setCursorVisiblity:u}}(),isProofError=!1,isTC=!1,isComment=!1;ReviewUtil.draw={angularLine:function(e,t,n){var i=Utils.createElement("div",{id:"annon_angular_"+n,class:"comnt-rev-connector-angular"}),o=e.top-t.top,r={},a=e.left-t.left,s=Math.atan(o/a),l=Math.sqrt(a*a+o*o);r.left=t.left;var d={};d["-moz-transform"]="rotate("+s+"rad)",d["-webkit-transform"]="rotate("+s+"rad)",d["-o-transform"]="rotate("+s+"rad)",d.transform="rotate("+s+"rad)",d.left=r.left,d.top=e.top-o,d.width=l;var c=J(i).css(d);return c.appendTo(J("#ui-editor-outer-div")),c},horizontalLine:function(e,t,n){var i=Utils.createElement("div",{id:"annon_horizontal_"+n,class:"comnt-rev-connector-horizontal"});horizontalDivStyles={width:t.left-e.left,left:e.left,top:e.top};var o=J(i).css(horizontalDivStyles);return o.appendTo(J("#ui-editor-outer-div")),o},boxConnectorLine:function(e,t){var n=Utils.createElement("div",{class:"comnt-rev-connector-horizontal"});horizontalDivStyles={width:e.left-t.left,right:Jdocument.width()-e.left,top:t.top};var i=J(n).css(horizontalDivStyles);return i.appendTo(J("#ui-editor-outer-div")),i},pointer:function(e,t){var n=Utils.createElement("div",{id:"annon_"+t,class:"comnt-rev-connector"}),i={};e.left;i.left=e.left-3,i.top=e.top-3;var o=J(n).css(i);return o.appendTo(J("#ui-editor-outer-div")),o}},ReviewUtil.focusLine=function(){var e=function(){this.horizontalLine=null,this.angularLine=null,this.boxConnectorLine=null,this.pointer=null;var e=function(){this.angularLine&&this.angularLine.remove(),this.horizontalLine&&this.horizontalLine.remove(),this.boxConnectorLine&&this.boxConnectorLine.remove(),this.pointer&&this.pointer.remove(),this.horizontalLine=null,this.angularLine=null,this.boxConnectorLine=null,this.pointer=null},t=function(e,t,n){var i=10,o=20;this.remove();var r=Z(ELEM_ID.TOPBANDWRAPPER).offset().top+Z(ELEM_ID.TOPBANDWRAPPER).height();t.top=t.top<r?r:t.top;var a={top:e.top,left:e.left-i},s=J(".zw-page:first"),l=s.offset();l.right=l.left+s.width()*editor.zoomFactor;var d={},c=Z(ELEM_ID.EDITOROUTERDIV).offset();c.right=Z(ELEM_ID.EDITOROUTERDIV).width()+c.left,d.left=l.right<c.right?l.right:c.right,d.left=d.left-o,d.top=t.top,this.angularLine=ReviewUtil.draw.angularLine(a,d,n),this.horizontalLine=ReviewUtil.draw.horizontalLine(t,d,n),this.boxConnectorLine=ReviewUtil.draw.boxConnectorLine(e,a,n),this.pointer=ReviewUtil.draw.pointer(t,n)};return{drawLine:t,remove:e}};return{comment:new e,revision:new e}}(),ReviewUtil.updateTime=function(e){U.each(e,function(e){e.find(".dynamic-time").each(function(e,t){Jelm=J(t),Jelm.text(Utils.getTimeFromNow(parseInt(Jelm.attr("data-dynamic-time"))))})})},ReviewUtil.startTimeupdateLoop=function(){setInterval(function(){var e=Z(ELEM_ID.EDITORRIGHTPANEL),t=e.find("#reviewpane"),n=e.find("#comment-list-container"),i=Z(ELEM_ID.EDITOROUTERDIV).find("#popup-menu-container"),o=J(".ui-comment-notify-div"),r=[t,n,i,o];ReviewUtil.updateTime(r)},6e4)}(),ReviewUtil.switchTab=function(e,t){t&&ModeManager.getCurrentMode()!==EDITOR_MODES.COLLABORATE&&ModeManager.switchMode(EDITOR_MODES.COLLABORATE),"comments"==e?(J("#comments-tab-header").trigger("mousedown"),J("#comments-tab-header").trigger("click"),J("#comments-tab-header").trigger("mouseup")):(J("#review-tab-header").trigger("mousedown"),J("#review-tab-header").trigger("click"),J("#review-tab-header").trigger("mouseup"))},ReviewUtil.updateIndex=function(e,t,n,i){var o=editor.doc.getSelection().createCursorOp(e.start,e.end);o=DocOpBuilder.build(o);var r={};r[i]=n,docOps=DocOpBuilder.build([{r:t},r]);var a=DocOpBuilder.xform(docOps,o),s=a.second.getCursorPos()[0];return s.start=s.start>=0?s.start:s.end,s.end=s.end>=0?s.end:s.start,s},ReviewUtil.getUserColour=function(e,t){return ReviewUtil.getUserProp(e,"color",t)},ReviewUtil.getUserName=function(e,t){return ReviewUtil.getUserProp(e,"fname",t)},ReviewUtil.removeSplCharsInZuid=function(e){return"$"==e.toString().charAt(0)?e.slice(1,e.length):e},ReviewUtil.getUserProp=function(e,t,n){if(!editor.isOffline()&&e){if(!jQuery.isEmptyObject(editor.doc.userData)&&editor.doc.getUserData()[e])return editor.doc.getUserData()[e][t];Utils.log("ADD ALL PARTICIPANTS CALLED FOR ZUID: "+e+" , KEY: "+t+" , VERSION: "+n);var i={};Utils.setCsrfParam(i),n&&(i.version=n),J.ajax({type:"POST",global:!1,url:Utils.getNiceUrlPrefix(editor.doc.getDocInfo().RID+"/util/addallparticipants"),async:!1,data:i,dataType:"json",error:function(e,t,n){PubSub.publish("trackchange/errormsg")},success:function(e){PubSub.publish("trackchange/errormsg")}})}},ReviewUtil.getUserLightColour=function(e){return ReviewUtil.getUserProp(e,"light_color")},ReviewUtil.addParticipant=function(){if("REMOTE"!=editor.getEditorType()){var e={};Utils.setCsrfParam(e),J.ajax({type:"POST",global:!1,url:Utils.getNiceUrlPrefix(editor.doc.getDocInfo().RID+"/util/addparticipant"),async:!0,data:e,dataType:"json",success:function(e){editor.doc.getTrackChangeDetails().makeUserParticipated()},error:function(e,t,n){}})}},ReviewUtil.addUsersInUserListPanel=function(e){for(var t=0,n=e.length;t<n;t++)ReviewUtil.addUserInUserListPanel(e[t])},ReviewUtil.removeUsersInUserListPanel=function(){Z("userlist-panel").find("div").remove()},ReviewUtil.addUserInUserListPanel=function(e){var t=ReviewUtil.getUserColour(e),n=ReviewUtil.getUserName(e),i=Utils.getUserImageURL(e);if(e=this.removeSplCharsInZuid(e),!Z("userlist-panel").find("#user_"+e).length){var o=Utils.createElement(NODE_NAME.DIV,{id:"user_"+e,class:"ui-tc-onindicater-imgdiv"}),r=Utils.createElement(NODE_NAME.SPAN,{style:"border-left: 3px solid "+t+";height: 24px; display: inline-block; box-shadow: 0px 2px 1px 0px #CCC;"}),a=Utils.createElement("img");J(a).attr({src:i,title:n}),r.appendChild(a),o.appendChild(r),Z("userlist-panel").append(o)}},ReviewUtil.removeUserInUserListPanel=function(e){Z("userlist-panel").find("#user_"+this.removeSplCharsInZuid(e)).remove()},ReviewUtil.showUserListPanel=function(){Z("userlist-panel-container").show()},ReviewUtil.hideUserListPanel=function(){Z("userlist-panel-container").hide()},ReviewUtil.positionUserListPanel=function(){var e=editor.jeditorPane.offset(),t=Z("userlist-panel").width(),n=e.left;"undefined"!=typeof LeftPanel&&LeftPanel.getPanelWidth()>e.left?n=e.left:e.left>t&&(n-=t),Z("userlist-panel-container").css("left",n)},ReviewUtil.omitTcDeletions=function(e,t){for(var n,i="",o=[],r=!1,a=0,s=0,l=function(e){for(a=0,s=e.length;a<s;a++)if(e[a][TCConstants.ACTION]===TCConstants.DELETE)return!0;return!1},d=0,c=e.length;d<c;d++)n=t[d],n&&(r=!(!n[TCConstants.TC]||!l(n[TCConstants.TC]))),r||(i+=e.charAt(d),o.push(n));return{contStr:i,styles:o}},ReviewUtil.setFreeze=function(e){var t=Z("reviewpane-freeze-overlay");e?t.show():t.hide()},ReviewUtil.calculatePostionForTcCommentContainer=function(){var e=(editor.doc.getPaperWidth(!0)-editor.doc.getPaperWidth(!1))/2,t=editor.doc.getPaperWidth()+e+10,n=CurUtil.offset.start.top,i={};return ReviewUtil.hasTC()&&ReviewUtil.hasComment()&&(n-=Z("popup-menu-tc-container").height()),n<editor.editorPaneContainerOffset.top&&(n=editor.editorPaneContainerOffset.top),i.top=n,i.left=t,i},ReviewUtil.adjustPositionOfTcCommentContainer=function(){$el=Z("popup-menu-tc-proof-cmnt-container");var e=$el.offset().left+$el.width()+10;if(e>J(document).width()){var t=e-J(document).width(),n=editor.doc.getDomCursorNode(editor.uuid,editor.zuid);n&&$el.css({left:$el.position().left-(t+20),top:CurUtil.offset.start.top+J(n).height()})}},ReviewUtil.removeReviewContainerChildren=function(){Z("popup-menu-tc-container").children().remove(),Z("popup-menu-cmnt-container").children().remove()},ReviewUtil.setHasProofError=function(e){isProofError=e},ReviewUtil.hasProofError=function(){return isProofError},ReviewUtil.setHasTC=function(e){isTC=e},ReviewUtil.hasTC=function(){return isTC},ReviewUtil.setHasComment=function(e){isComment=e},ReviewUtil.hasComment=function(){return isComment},CommentUtils={},CommentUtils.selectWord=function(){var e,t,n=editor.doc.getSelection();if(n.isCollapsed())n.setSelectionType(SEL_KEYBOARD).getWord().select(),e=n.getStart(),t=n.getEnd();else if(n.isTableSelected()){var i=editor.doc.getContent(e,t);if(i.indexOf(UNICODE.ROW)!=-1){var o=n.getStartCell();if(o){e=o.getStart()+1,t=o.getEnd()-1;var r=editor.doc.createRange(e,t);n.setSelectionType(SEL_KEYBOARD).removeAllRanges().addRange(r)}}}else{var a=n.getTargetRange();e=a.start,t=a.end}return n.length>1&&Utils.addToStatistics("comment_ON_MUL_SEL"),{start:e,end:t}},CommentUtils.getHighlights=function(e,t){return U.reduce(e,function(e,t){return e.add(CommentManager.highlightMap.el[t])},J([]))},CommentUtils.showHighlights=function(e){var t=CommentUtils.getHighlights(CommentManager.highlightMap.comments[e],e);t.show()},CommentUtils.hideHighlights=function(e){var t=CommentManager.highlightMap.comments[e]||[],n=t.filter(function(e){return 1==CommentManager.highlightMap.highlights[e].length}),i=CommentUtils.getHighlights(n,e);i.hide()},CommentUtils.removeHighlights=function(e){var t=CommentManager.highlightMap.comments[e]||[];CommentManager.highlightMap.comments[e]=[],U.each(t,function(t){var n=CommentManager.highlightMap.highlights[t],i=CommentManager.highlightMap.el[t];if(1==n.length)i.remove(),delete CommentManager.highlightMap.highlights[t],delete CommentManager.highlightMap.el[t];else{i.removeClass("ui-comment-indication-new-active");var n=n.filter(function(t){return t!=e});n.filter(CommentUtils.isResolved).length==n.length&&i.addClass(CommentUtils.getResolvedClass()),CommentManager.highlightMap.highlights[t]=n}})},CommentUtils.discardHighlights=function(e){if(e){var t=e.commentSegments;e.commentSegments=[],U.each(t,function(e){var t=CommentManager.highlightMap.highlights[e];U.each(t,function(t){var n=CommentManager.highlightMap.comments[t]||[];n=n.filter(function(t){return e!=t}),CommentManager.highlightMap.comments[t]=n}),CommentManager.highlightMap.el[e]&&CommentManager.highlightMap.el[e].remove(),delete CommentManager.highlightMap.highlights[e],delete CommentManager.highlightMap.el[e]})}},CommentUtils.highlightCommentedDoctext=function(e){var t=CommentUtils.getHighlights(CommentManager.highlightMap.comments[e],e);t.addClass("ui-comment-indication-new-active")},CommentUtils.removeCommentedDoctextHighlight=function(e){var t=CommentUtils.getHighlights(CommentManager.highlightMap.comments[e],e);t.removeClass("ui-comment-indication-new-active")},CommentUtils.resolveHighlights=function(e){var t=CommentManager.highlightMap.comments[e]||[],n=t.filter(function(e){return!CommentManager.highlightMap.highlights[e].filter(function(e){var t=CommentModels.commentCollection.get(e);return t&&!t.get("isResolved")}).length}),i=CommentUtils.getHighlights(n,e);i.addClass(CommentUtils.getResolvedClass())},CommentUtils.unresolveHighlights=function(e){var t=CommentManager.highlightMap.comments[e]||[],n=CommentUtils.getHighlights(t,e);n.removeClass(CommentUtils.getResolvedClass())},CommentUtils.drawFocusLine=function(e){var t,n=CommentUtils.getCommentRange(e),i=n.start;DocTreeManager.linesBetween(i,i+1)[0];if(editor.doc.getCharAt(i+1)==UNICODE.IMAGE)o=J(editor.doc.getPortionData(i+2).node.firstChild);else var o=J(editor.doc.getPortionData(i+2).node);t=o.offset(),t.top=o.closest(".zw-line-content").offset().top-2;var r=CommentManager.views.commentCollectionView.commentViewMap[e].$(".ui-ncmt-container"),a=r.offset();a.top=r.find("#parent-comment-author-img").offset().top+r.find("#parent-comment-author-img").height(),r.offset().top<CommentManager.views.commentCollectionView.$el.offset().top&&(a.top=CommentManager.views.commentCollectionView.$el.offset().top),ReviewUtil.focusLine.comment.drawLine(a,t,e)},CommentUtils.removeFocusLine=function(e){ReviewUtil.focusLine.comment.remove()},CommentUtils.getCommentRange=function(e){var t=CommentModels.commentIndices.filter(function(t){return t.id==e})[0];if(t&&t.start&&t.end)return t;for(var n=-1,i=-1,o=editor.doc.contStr.length,r=editor.doc.contStr.indexOf(UNICODE.RANGE_START),t={start:null,end:null};r>-1&&r<o;){var a=editor.doc.getRawFormatAt(r);if(a&&a.type==NODE_TYPE.COMMENT&&a.id==e){for(n=r,r=editor.doc.findNextIndexOf(UNICODE.RANGE_END,r+1);r>n;){if(format=editor.doc.getRawFormatAt(r),format&&format.type==NODE_TYPE.COMMENT&&format.id==e){i=r;break}r=editor.doc.findNextIndexOf(UNICODE.RANGE_END,r+1)}break}r=editor.doc.findNextIndexOf(UNICODE.RANGE_START,r+1)}return n!=-1&&i!=-1&&(t.start=n,t.end=i,t)},CommentUtils.pullCommentedDoctextIntoView=function(e){var t=CommentUtils.getCommentRange(e);if(!t||!editor.doc.getSelection())return!1;CommentModels.updateCommentFocus=!1;var n=editor.doc.createRange(t.start+1);editor.doc.getSelection().setSelectionType(SEL_AUTO_GEN).removeAllRanges().addRange(n),CommentModels.updateCommentFocus=!0;var i=Utils.scrollElementIntoView(editor.doc.getCursorPortionNode());return i},CommentUtils.pullCommentInputIntoView=function(){if(CommentModels.commentPane.get("commentCreationDialogShow")){var e=CommentManager.views.commentCreationView.$el;JcommentPane=CommentManager.views.commentCollectionView.$el,CommentPaneScrollTop=JcommentPane.scrollTop(0),CommentViewTop=e.position().top,JcommentPane.animate({scrollTop:CommentViewTop-100})}},CommentUtils.pullCommentIntoView=function(e){var t=J.Deferred(),n=CommentManager.views.commentCollectionView.commentViewMap[e];return!!n&&(JcommentView=n.$el,JcommentView.length?(JcommentPane=CommentManager.views.commentCollectionView.$el,CommentPaneScrollTop=JcommentPane.scrollTop(0),CommentViewTop=JcommentView.position().top,JcommentPane.animate({scrollTop:CommentViewTop-200},function(){t.resolve(!0)}),t):void 0)},CommentUtils.getMarkedupCommentContent=function(e,t){if(t=t||CommentModels.commentPane.get("searchQuery"),!t||t.trim().length<3)var n=e;else var i=new RegExp("("+t+")","igm"),n=e.replace(i,'<span class="search-highlight">$1</span>');var o=J("<div/>").text(n).text(),r=o.replace(/\n/g," <br/> "),a=r.replace(CommentManager.EMAIL_REGEX,'<a class="ui-atmention" rel="noreferrer" href="mailto:$1@$2.$3" title="$1@$2.$3">@$1</a>'),s=a.replace(CommentModels.URL_REGEX,function(e){var t=e;return e.startsWith("www")&&(t="http://"+e),'<a rel="noreferrer" target="_blank" href="'+t+'">'+e+"</a>"});return s},CommentUtils.escapeHTML=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},CommentUtils.unescapeHTML=function(e){return J("<div/>").html(e).text()},CommentUtils.updateTextAreaHeight=function(e){e.style.overflow="hidden";var t=(e.clientHeight,e.scrollHeight);e.style.height=t+"px"},CommentUtils.autoHeightTextArea=function(e){var t=e.target,n=CommentManager.views.commentCollectionView.$el.scrollTop();t.style.height="",CommentUtils.updateTextAreaHeight(t),CommentManager.views.commentCollectionView.$el.scrollTop(n),CommentManager.views.commentPaneView.setPosition()},CommentUtils.isAnyCommentRenderedInPane=function(){var e=CommentModels.commentCollection.find(function(e){return e.get("isRangeCharsRendered")});return e},CommentUtils.getUsername=function(e){var t;return t=e&&""!==e?ReviewUtil.getUserProp(e,"fname"):"Guest"},CommentUtils.getCoreData=function(e){var t=["id","createdAt","updatedAt","zuid","activityLog","text","html","doctext","children","parentId","isResolved","contentUpdatedAt"];return commentJSON={},U.each(t,function(t){commentJSON[t]=e[t]}),commentJSON},CommentUtils.sendOp=function(e,t){Utils.log("\nComment sendOp called for ops: "+JSON.stringify(e));var n=J.Deferred(),i=e.filter(function(e){return"addComment"==e.action||"deleteComment"==e.action}),e=e.filter(function(e){return"addComment"!=e.action});return i.length?(Utils.log("\naddComment/deleteComment ops. Just adding to comment queue."),Utils.log("\nWaiting for range chars ajax success, for sending these ops"),CommentModels.queue.add(i),n):(e.length&&CommentModels.queue.add(e),void(!CommentModels.queue.getAckPendingEdit()&&ZWCollaboration.msgQueue.isEmpty()&&(Utils.log("Docops queue is empty. Sending these comment ops immediately."),CommentModels.queue.shift(),CommentManager.sendCommentMutation())))},CommentUtils.setUpPrint=function(){if(document.getElementById("commentPrint"))return!1;var e=document.createElement("iframe");e.id="commentPrint",editor.editorPaneContainer.append(e);var t=e.contentWindow.document,n=J(document).find('link[href$="writer_min_all.css"]');link=t.createElement("link"),link.href=n.attr("href"),link.rel="stylesheet",J(e).css({height:0,top:"-10px",position:"absolute"}),J(t).find("head").append(link)},CommentUtils.printComments=function(){Utils.addToStatistics("comment_printComments"),J("#commentPrint").length||CommentUtils.setUpPrint(),setTimeout(function(){var e=document.getElementById("commentPrint"),t=CommentManager.views.commentCollectionView.$el.clone();t.find("div.ui-ncmt-container").css("width",800),t.find(".reply-textarea").hide(),t.find(".ui-delete-comment").hide(),t.find(".ui-ncmt-container").removeClass("ui-ncmt-container-selected"),t.find(".cmt-header-menu").hide(),t.find(".reply-list-container").css("margin-left","30px"),t.find("div.ui-ncmt-container").css({"margin-top":"","margin-left":""}),t.find("div.ui-reply-comments").css({display:"block"}),t.find(".reply-list-container").show(),t.find("#new-reply-view").hide(),t.find(".ui-ncmt-reply").hide(),t.find(".ui-toggle-comment-height").hide(),t.find(".child-comnt-options").hide(),t.find(".ui-ncmt-footer").hide();var n=e.contentWindow.document,i=n.getElementsByTagName("body")[0];i.innerHTML=t[0].innerHTML,e.contentWindow.focus(),e.contentWindow.print()},200)},CommentUtils.loadContacts=function(){return!!U.contains(CommentModels.atMention.validRoles,editor.doc.getRole())&&void Utils.getDocumentSharedUsersWithContacts(function(e){CommentModels.atMention.loaded=!0,CommentModels.atMention.contacts=e,J(".enable-atmentions").each(function(t,n){var i=J(n).data("plugin_sew");i?i.options.values=e:J(n).atMention()})})},CommentUtils.getContacts=function(){return CommentModels.atMention.contacts},CommentUtils.detectMentions=function(e){var t=U.uniq(e.match(CommentModels.EMAIL_REGEX));return t.map(function(e,t){var n=e.substr(1);return n})},CommentUtils.sendNotificationMail=function(e,t,n,i){var o={},r={};o.purpose="comment",U.each(e,function(e){var t=CommentModels.atMention.contacts.filter(function(t){return t.emailid==e});1==t.length?r[e]=t[0].fullname:r[e]=e.split("@")[0]});var e=[],a=[];for(var s in r)e.push(s),a.push(r[s]);o.mail_toaddress=e.join(",");var l={userNames:a,commentContent:t,commentId:n};i&&(l.replyCommentId=i),o.addinfo=JSON.stringify(l),Utils.setCsrfParam(o),J.ajax({url:Utils.getNiceUrlPrefix(editor.doc.getDocInfo().RID+"/util/sendmail"),data:o,dataType:"json",type:"POST",success:function(e){},error:function(e){}})},CommentUtils.notifyMentions=function(e,t,n){if(CommentModels.atMention.enabled){var i=CommentUtils.detectMentions(e);i.length&&(CommentUtils.sendNotificationMail(i,e,t,n),Utils.addToStatistics("comment_atMentionNotification"))}},CommentUtils.showHint=function(e){var t=J(e.target);t.parent().find(".atmention-hint").length&&t.parent().find(".atmention-hint").show()},CommentUtils.hideHint=function(e){var t=J(e.target);setTimeout(function(){t.parent().find(".atmention-hint").hide()},100)},CommentUtils.doneKey=function(e,t,n){(e.ctrlKey||e.metaKey)&&13==e.keyCode&&t.apply(n,[])},CommentUtils.cancelKey=function(e,t,n){27==e.keyCode&&t.apply(n,[])},CommentUtils.refineCommentJSON=function(e){e=JSON.parse(JSON.stringify(e)),e="string"==typeof e?JSON.parse(e):e;for(var t in e)"null"===e[t]&&(e[t]=null);var n=[];for(var i in e.children)e.children[i].children=[],e.children[i].doctext=null,e.children[i].deleted||n.push(e.children[i]);return e.children=n,e},CommentUtils.showCurrentCommentSelection=function(e,t){editor.doc.domCursor.comment&&!J.isEmptyObject(editor.doc.domCursor.comment)||(editor.doc.domCursor.comment={zuid:editor.zuid,bgColor:"#F88017",start:{node:"",idx:"",cursor:""},end:{node:"",idx:"",cursor:""}});var n=editor.doc.getSelection("comment")||editor.doc.createSelection("comment"),i=editor.doc.createRange(e,t).setFocus(!1);i.type=ZWRange.TYPE.COMMENT,n.setSelectionType(SEL_AUTO_GEN).removeAllRanges().addRange(i)},CommentUtils.hideCurrentCommentSelection=function(){editor.doc.domCursor.comment&&!J.isEmptyObject(editor.doc.domCursor.comment)&&(J(editor.doc.domCursor.comment.start.cursor).remove(),J(editor.doc.domCursor.comment.end.cursor).remove()),delete editor.doc.domCursor.comment;var e=editor.doc.getSelection("comment");e&&e.removeAllRanges()},CommentUtils.removeCommentUI=function(){CommentModels.commentPane.set("commentCreationDialogShow",!1),CommentModels.commentPane.set("show",!1)},CommentUtils.arrayDiff=function(e,t){var n=[],i=[];return n=t.filter(function(t){return e.indexOf(t)<0}),i=e.filter(function(e){return t.indexOf(e)<0}),{additions:n,deletions:i}},CommentUtils.isResolved=function(e){var t=CommentModels.commentCollection.get(e);return t&&t.get("isResolved")},CommentUtils.shouldHighlightResolved=function(){return U.contains(["REMOTEEDIT","REMOTECOLLABEDIT","REMOTEPUBLICUSER","MAILMERGE_LIBRARY","CRM_VERTICAL_MAILMERGE_LIBRARY","ZFORMS_TEMPLATE"],editor.doc.getRole())},CommentUtils.getResolvedClass=function(){return CommentModels.SHOULD_HIGHLIGHT_RESOLVED_COMMENTS?"ui-comment-indication-new-resolved":"ui-comment-indication-new-resolved-no-background"},CommentUtils.afterHighlightDraw=function(e,t,n){var i="cmt-hl-"+Utils.randomString(),o=e.filter(CommentUtils.isResolved).length==e.length;o&&t.addClass(CommentUtils.getResolvedClass()),editor.doc.getDocInfo().FINAL_INFO&&editor.doc.getDocInfo().FINAL_INFO.STATUS&&t.hide(),t.attr("id",i),U.each(e,function(e){var n=CommentModels.commentCollection.get(e);t.addClass("comment-indicator-"+e),n&&n.get("inFocus")&&t.addClass("ui-comment-indication-new-active"),CommentManager.highlightMap.comments[e]=CommentManager.highlightMap.comments[e]||[],CommentManager.highlightMap.comments[e].push(i)}),CommentManager.highlightMap.highlights[i]=e,CommentManager.highlightMap.el[i]=t,n.commentSegments=n.commentSegments||[],n.commentSegments.push(i)},CommentUtils.drawCommentHighlight=function(e,t,n){if(e===t)return!1;var i=DocTreeManager.lineAtIndex(e);if(!i)return!1;var o=DocTreeManager.getLeftAtIndex(e),r=DocTreeManager.getLeftAtIndex(t);DocTreeManager.getTreeNodeAtIndex(e);if(t==i.parent.getIndex()+i.end&&editor.doc.getCharAt(t)!=UNICODE.PARA&&(t-=1,r=DocTreeManager.getLeftAtIndex(t)),e===t)return!1;for(var a,s=DocTreeManager.linesBetween(e,t),l=editor.doc.getContent(e,t),d=Utils.isRTL(l),c=s.length>1,u=0;u<s.length;u++)if(i=s[u],i.el){var p,h=editor.doc.getComputedFormatAt(i.parent.getEndIndex(),NODE_TYPE.PARAGRAPH)||{},f=h[ATTR_PARAGRAPH.PS_AL]||0,m=i.height,g=J(i.el),T=document.createElement("div"),_={},E=parseFloat(g.css("padding-top")||0);_.height=m,_.top=E,p=3===f?0:i.remainingWidth*f/2,a=i.listRight?i.listRight:0,c?0===u?(_.left=o,_.width=i.width-o+p+a):u==s.length-1?(_.left=p+a,_.width=r-p-a):(_.left=p+a,_.width=i.width):d?(_.left=r,_.width=o-r):(_.left=o,_.width=r-o),_["z-index"]=ZINDEX.COMMENT_HIGHLIGHT,CommentUtils.isImageSegment(e,t)&&(_.top--,_.left--,_.width=_.width+2);var v=J(T);v.addClass("ui-comment-indication-new").css(_).appendTo(g[0]),CommentUtils.afterHighlightDraw(n,v,i.viewLine)}},CommentUtils.getHighlightSegments=function(e,t){var n=[],i=[],o={start:null,end:null,ids:[]},r={},a=CommentModels.commentIndices.filter(function(e){var t=CommentModels.commentCollection.get(e.id);return t&&t.get("isRangeCharsRendered")}),s=a.filter(function(n){return n.start<e&&n.end>t}),l=a.filter(function(n){return n.start>=e&&n.start<=t&&n.end>t}),d=a.filter(function(n){return n.start<e&&n.end<=t&&n.end>=e}),c=a.filter(function(n){return n.start>=e&&n.start<=t&&n.end<=t&&n.end>=e});U.each(s,function(n){r[e]||(r[e]={start:[],end:[]}),r[t]||(r[t]={start:[],end:[]}),r[e].start.push(n.id),r[t].end.push(n.id)}),U.each(l,function(e){r[e.start]||(r[e.start]={start:[],end:[]}),r[t]||(r[t]={start:[],end:[]}),r[e.start].start.push(e.id),r[t].end.push(e.id)}),U.each(d,function(t){r[e]||(r[e]={start:[],end:[]}),r[t.end]||(r[t.end]={start:[],end:[]}),r[e].start.push(t.id),r[t.end].end.push(t.id)}),U.each(c,function(e){r[e.start]||(r[e.start]={start:[],end:[]}),r[e.end]||(r[e.end]={start:[],end:[]}),r[e.start].start.push(e.id),r[e.end].end.push(e.id)});for(var u=e;u<=t;u++)if(r[u])if(r[u].start.length)o.start&&!o.end?(n.length&&i.push({start:o.start,end:u,ids:n.slice()}),o.start=u,o.end=null,o.ids=o.ids.concat(r[u].start),n=n.concat(r[u].start)):(o.start=u,o.end=null,o.ids=o.ids.concat(r[u].start),n=n.concat(r[u].start));else{n.length&&i.push({start:o.start,end:u,ids:n.slice()});for(var p=0;p<r[u].end.length;p++){var h=r[u].end[p],f=n.indexOf(h);f>-1&&n.splice(f,1)}n.length&&(o.start=u,o.end=null,o.ids=n)}return i},CommentUtils.replaceOrAdd=function(e,t){var n=e.filter(function(e){return e.id!=t.id});return n.push(t),n},CommentUtils.loadCommentIndices=function(e){for(var t,n=[],i={},o=new RegExp(UNICODE.RANGE_START+"|"+UNICODE.RANGE_END,"g");t=o.exec(editor.doc.contStr);){var r=editor.doc.getRawFormatAt(t.index),a=t[0];r.type==NODE_TYPE.COMMENT&&a==UNICODE.RANGE_START?(n.push(r.id),i[r.id]||(i[r.id]={}),i[r.id].start=t.index):r.type==NODE_TYPE.COMMENT&&a==UNICODE.RANGE_END&&(i[r.id].end=t.index)}CommentModels.commentOrder=n,U.each(U.keys(i),function(e){CommentModels.commentIndices.push({id:e,start:i[e].start,end:i[e].end})}),e()},CommentUtils.onErrorCallback=function(e){if(CommentModels.queue.isReqSent=!1,CommentModels.queue.reqCount=0,ReviewUtil.setFreeze(!0),e.error)var t=e.error.stack;else{var t=printStackTrace();t=t.join("\n")}e.commentQueue=JSON.stringify(CommentModels.queue.pendingCommentEdits),Utils.log("\nERROR CODE: "+e.errNo+"\nACTION: "+e.action+"\nADDINFO: "+JSON.stringify(e.info)),Utils.log("\n"+t),e.error&&Utils.log("\n Stack: "+e.error.stack),CommentModels.lastError=e,UIUtils.showZohoError("TITLE_COMMENT_ERROR","MSG_COMMENT_ERROR",e.errNo)},CommentUtils.addParticipant=function(){var e=editor.doc.getTrackChangeDetails().isUserParticipated();e||(editor.doc.getTrackChangeDetails().makeUserParticipated(),ReviewUtil.addParticipant())},CommentUtils.shouldLoadComments=function(){var e=["SHAREDREAD","REMOTEVIEW","REMOTECOLLABVIEW","PREVIEW",USER_ROLE.PUBLIC],t=[EDITOR_VIEWS.HISTORY,EDITOR_VIEWS.MAILMERGE_PREVIEW,EDITOR_VIEWS.PRINT_PREVIEW];return!(U.contains(e,editor.doc.getRole())||U.contains(t,editor.getView())||editor.doc.getTrackChangeDetails().getIsReviewPage())},CommentUtils.pushToBuffer=function(e){var t="zw"+Utils.randomString();e.opId=t,CommentModels.appliedCommentOps[t]=editor.zuid,Op.commentMsgBuffer.push(e)},CommentUtils.isEmptyCommentOpHistory=function(e){var t=!0;for(var n in e)U.each(e[n],function(e){t=!1});return t},CommentUtils.sendMessage=function(e,t,n){var i={},o=editor.doc.getDocInfo();i.commentOps=JSON.stringify(e);var r=Utils.getUrl("comment");i.sid=editor.uuid,"REMOTE"==editor.getEditorType()?(i.remoteUserStatusId=RemoteEditor.userStatusId,i.docId=o.DOCUMENT_ID):i.rid=o.RID,Utils.setCsrfParam(i),J.ajax({type:"POST",dataType:"json",global:!1,url:r,data:i,error:n,success:t})},CommentUtils.syncCommentOps=function(e){for(var t=e.CHANGES,n=(e.comment_sequence_number,CommentModels.comment_sequence_number+1);n<=e.comment_sequence_number;n++){var i=t[n];if(!i)return CommentUtils.onErrorCallback({action:"sync_op_missing",info:e,errorNo:e.ERR_CODE||CommentModels.COMMENT_SYNC_OP_MISSING_ERROR}),!1;i.sid!=editor.uuid?CommentManager.handleCollaboratorOperation(i,i.zuid,n):CommentModels.comment_sequence_number=n}},CommentUtils.checkSync=function(e,t){return sequenceDiff=CommentUtils.getSequenceDiff(e.comment_sequence_number),t?void(1==sequenceDiff?CommentModels.comment_sequence_number=e.comment_sequence_number:sequenceDiff>1&&CommentUtils.syncup()):void(sequenceDiff>0&&CommentUtils.syncup())},CommentUtils.syncup=function(e){Utils.log("SENDING COMMENT SYNC REQUEST...");var t=Utils.getUrl("comment/sync");if(params={},params.comment_sequence_number=CommentModels.comment_sequence_number,params.sid=editor.uuid,currentDocInfo=editor.doc.getDocInfo(),params.rid=currentDocInfo.RID,"REMOTE"==editor.getEditorType()&&(params.remoteUserStatusId=RemoteEditor.userStatusId,params.docId=currentDocInfo.DOCUMENT_ID),!CommentUtils.shouldLoadComments())return!1;Utils.setCsrfParam(params);J.ajax({type:"POST",dataType:"json",global:!1,url:t,data:params,error:function(e){Utils.log("COMMENT SYNC REQUEST FAILED BY REQUEST FAILURE."),CommentUtils.onErrorCallback({action:"comment_sync",info:{params:params,serverResp:e},errNo:CommentModels.COMMENT_REQUEST_FAILURE_ERROR})},success:function(t){"SUCCESS"==t.RESPONSE?(CommentUtils.syncCommentOps(t),e&&e()):"FAILED"==t.RESPONSE&&t.comments?(CommentManager.reload(t),e&&e()):(Utils.log("COMMENT SYNC REQUEST FAILED. CHECK SERVER LOGS."),CommentUtils.onErrorCallback({action:"comment_sync",info:t,errNo:t.ERR_CODE||CommentModels.COMMENT_SYNC_ERROR}))}})},CommentUtils.constructDeleteOp=function(e){var t={},n=editor.doc.getDocInfo();return t.action="deleteComment",t.rid=n.RID,t.sid=editor.uuid,t.commentData={},t.commentData.id=e.id,t},CommentUtils.getSequenceDiff=function(e){return e-CommentModels.comment_sequence_number},CommentUtils.freeze=function(){CommentModels.commentPane.set("freeze",!0)},CommentUtils.unfreeze=function(){CommentModels.commentPane.set("freeze",!1)},CommentUtils.constructLog=function(e){return e.errorNo+"<ZWERROR>"+editor.doc.getDocInfo().VERSION+"."+editor.doc.getDocInfo().REVISION+"<ZWERROR>\n Err No ="+e.errorNo+" DOC len ="+editor.doc.getDocumentLength()+" Cur St ="+editor.doc.getSelection().getStart()+" Cur end="+editor.doc.getSelection().getEnd()+" Pen [0]="+(ZWCollaboration.msgQueue.getAckPendingEdit()?ZWCollaboration.msgQueue.getAckPendingEdit().toString():"")+"[1]="+(ZWCollaboration.msgQueue.getPendingToPushEdit()?ZWCollaboration.msgQueue.getPendingToPushEdit().toString():"")+" FULL DOC OP IDS :: "+ZWCollaboration.docOpIds+" buildLabel::: "+buildLabel+"\n Error Log End \n"},CommentUtils.getCount=function(e){if(!e)return CommentModels.commentCollection.getRenderedComments().length;switch(e){case"unresolved":return CommentModels.commentCollection.getRenderedComments().filter(function(e){return!e.get("isResolved")}).length;case"resolved":return CommentModels.commentCollection.getRenderedComments().filter(function(e){return e.get("isResolved")}).length;case"unread":return CommentModels.commentCollection.getRenderedComments().filter(function(e){return e.get("unread")}).length}},CommentUtils.deleteComment=function(e){var t=CommentManager.views.commentCollectionView[e];t.initDelete()},CommentUtils.editComment=function(e){var t=CommentManager.views.commentCollectionView[e];t.initEditMode()},CommentUtils.initComponents=function(e){e.find('[ctype="zbutton"]').zbutton(),e.find(".comment-popup").bind("menuitemclicked",function(e,t){UIUtils._itemClicked(e,t)})},CommentUtils.deleteAllComments=function(){Utils.addToStatistics("comment_deleteAllComments"),MsgDialog.showMessage(CONST.MSG_TYPE_YESNO,CONST.SEVERITY_WARNING,"Delete All Comments","You are about to delete all the comments in this document. Note that you cannot undo the changes after this. Do you want to continue ?",null,function(e){switch(e){case CONST.BUTTON_YES_CLICKED:CommentManager.views.commentPaneView.deleteAllComments()}})},CommentUtils.resolveAllComments=function(){Utils.addToStatistics("comment_resolveAllComments"),MsgDialog.showMessage(CONST.MSG_TYPE_YESNO,CONST.SEVERITY_WARNING,"Resolve All Comments","You are about to resolve all the comments in this document. Note that you cannot undo the changes after this. Do you want to continue ?",null,function(e){switch(e){case CONST.BUTTON_YES_CLICKED:CommentManager.views.commentPaneView.resolveAllComments()}})},CommentUtils.positionCommentDialog=function(){var e=CommentManager.views.commentCreationView.$el;"SHAREDREADCOMMENT"===editor.doc.getRole()||ModeManager.getCurrentMode()===EDITOR_MODES.COLLABORATE?CommentUtils.showDialogInCommentPane(e):CommentUtils.showDialogInEditorPane(e)},CommentUtils.showDialogInCommentPane=function(e){e.hide(),e.css({position:"relative",left:"",top:"",width:"auto"}),e.detach(),e.find(".ui-ncmt-container-div").removeClass("ui-ncmt-container-cmode");var t=function(){for(var e=editor.doc.getSelection().getStart(),t=CommentModels.commentIndices.sort(function(e,t){return t.start<e.start?1:-1}).filter(function(t){return t.start<=e}),n=t.length-1;n>=0;n--){var i=t[n],o=CommentModels.commentCollection.get(i.id);if(o&&!o.get("isResolved")&&CommentModels.commentCollection.isCommentRendered(i.id))return i.id}return null}();if(t){var n=CommentManager.views.commentCollectionView.commentViewMap[t].$el;n.after(e)}else e.prependTo(CommentManager.views.commentCollectionView.$el);e.slideDown(200)},CommentUtils.getDialogOffset=function(e){var t,n,i=50,o=CurUtil.offset.start,r=CurUtil.offset.end,a=Z(ELEM_ID.EDITOROUTERDIV),s={top:a.scrollTop(),bottom:a.scrollTop()+a.height(),left:a.offset().left};return editor.doc.getSelection().isCollapsed()||(o.left=o.left-a.offset().left,r.left=r.left-a.offset().left),r.top+e.height()+r.rects.height<s.bottom?(n=r.top+r.rects.height,t=r.left):o.top-e.height()>s.top?(n=o.top-e.height(),t=o.left):(n=a.offset().top+a.scrollTop(),t=i),s.left+t+e.outerWidth()+i>window.innerWidth&&(t=window.innerWidth-e.outerWidth()-i-s.left),{left:t,top:n}},CommentUtils.showDialogInEditorPane=function(e){e.hide(),e.find(".ui-ncmt-container-div").addClass("ui-ncmt-container-cmode"),e.detach(),e.appendTo(Z(ELEM_ID.EDITOROUTERDIV));var t=CommentUtils.getDialogOffset(e);e.css({position:"absolute",left:t.left,top:t.top}),e.fadeIn(200)},CommentUtils.closeLikeModal=function(){J("#likelistview").hide(),J("#likelistoverlay").hide()},CommentUtils.updateAuthorListUI=function(){var e=CommentModels.commentCollection.getRenderedComments().length;J("#comments-author-list").zmenu(),J("#comments-author-list").zmenu("removeAllMenuItems"),CommentModels.authors.each(function(e){var t={label:e.get("name")+"("+e.get("count")+")",data:"{'appData':{'action':'CommentUtils.showByAuthor','params':'"+e.id+"'}}"};J("#comments-author-list").zmenu("addMenuItem",t)}),J("#comments-author-list").zmenu("addMenuItem",{mtype:"separator",class:"ui-zmenu-item ui-zmenu-separator"}),J("#comments-author-list").zmenu("addMenuItem",{label:"All("+e+")",data:"{'appData':{'action':'CommentUtils.showAllComments'}}"})},CommentUtils.showByAuthor=function(e){Utils.addToStatistics("comment_viewByAuthor"),CommentModels.commentPane.set("currentAuthorView",e),CommentModels.commentPane.set("currentView",void 0),CommentModels.commentPane.set("currentView",CommentModels.COMMENTVIEWS.BY_AUTHOR)},CommentUtils.showAllComments=function(){CommentModels.commentPane.set("currentView",CommentModels.COMMENTVIEWS.ALL)},CommentUtils.toggleSearchBox=function(){CommentModels.commentPane.get("isShowingSearchbox")?CommentManager.views.commentPaneView.cancelSearch():(CommentModels.commentPane.set("isShowingSearchbox",!0),Utils.addToStatistics("comment_search"))},CommentUtils.closeSearchbox=function(){CommentManager.views.commentPaneView.cancelSearch()},CommentUtils.containsSearchTerm=function(e){var t=CommentModels.commentPane.get("searchQuery").toLowerCase().trim();if(e.get("text").toLowerCase().indexOf(t)>-1)return!0;for(var n=0;n<e.get("children").models.length;n++){var i=e.get("children").models[n];if(i.get("text").toLowerCase().indexOf(t)>-1)return!0}return!1},CommentUtils.delay=function(){var e=0;return function(t,n){clearTimeout(e),e=setTimeout(t,n)}}(),CommentUtils.setVisibilityForNoResultsDiv=function(){return CommentModels.commentPane.get("currentView")===CommentModels.COMMENTVIEWS.BY_AUTHOR?void CommentManager.views.commentPaneView.$("#noresults-container").hide():void(CommentManager.views.commentCollectionView.$el.contents("div:visible").length?CommentManager.views.commentPaneView.$("#noresults-container").hide():CommentManager.views.commentPaneView.$("#noresults-container").show())},CommentUtils.getViewLabel=function(e){return COMMENTVIEWS={1:"ALL",2:"RESOLVED",3:"UNRESOLVED",4:"UNREAD",5:"BY_AUTHOR",6:"BY_DATE",7:"UNREAD"},COMMENTVIEWS[e]},CommentUtils.enclosingCommentAtIndex=function(e,t){var n=CommentModels.commentIndices.filter(function(n){var i=e>=n.start&&e<=n.end+1,o=CommentModels.commentCollection.get(n.id);if(!o)return!1;var r=o.get("isResolved");return t?i:i&&!r});return n=n.length>1?n.sort(function(e,t){return e.start<t.start})[0]:n[0]},CommentUtils.triggerCommentFocus=function(e){var t=CommentModels.commentCollection.get(e);if(t&&t.get("isRangeCharsRendered")){var n=CommentUtils.getCommentRange(e),i=editor.doc.getSelection(),o=editor.doc.createRange(n.start,n.start+1);i.setSelectionType(SEL_AUTO_GEN).removeAllRanges().addRange(o)}else CommentUtils.showDeletedInfo()},CommentUtils.showDeletedInfo=function(){MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_WARNING,"COMMENT NOT FOUND","The comment you are looking for, has been deleted from the document.",null,function(e){})},CommentUtils.chunkArray=function(e,t){var n,i,o,t=t||10,r=[];for(n=0,i=e.length;n<i;n+=t)o=e.slice(n,n+t),r.push(o);return r},CommentUtils.toggleViewMenu=function(){CommentModels.commentPane.set("isShowingViewMenu",!CommentModels.commentPane.get("isShowingViewMenu"))},CommentUtils.isPartOfComment=function(e,t){var n=t.get("zuid")===e,i=U.contains(t.get("likes"),e),o=t.get("children").filter(function(t){return t.get("zuid")==e}).length;return n||i||o},CommentUtils.showCommentPanel=function(){},CommentUtils.updateFollowers=function(e,t){var n=function(){Follow.states.PARTICIPATED_COMMENTS&&t.follow(!1,editor.zuid)},i={addComment:function(){Follow.states.NO_NOTIFICATION||t.follow(!1,editor.zuid)},likeComment:n,addReplyComment:n,resolveComment:n,reopenComment:n,followAllComments:function(){CommentModels.commentCollection.followAllComments(!0,editor.zuid)},unfollowAllComments:function(){CommentModels.commentCollection.unfollowAllComments(!0,editor.zuid)},followParticipatedComments:function(){var e=CommentModels.commentCollection.getRenderedComments().filter(function(e){return!U.contains(e.get("followers"),editor.zuid)&&CommentUtils.isPartOfComment(editor.zuid,e)}).map(function(e){return e.id});CommentModels.commentCollection.followComments(!0,editor.zuid,e)}};i[e]&&i[e]()},CommentUtils.sendUnreadCommentDocNotificaion=function(e){var t={};t.zuid=e.get("zuid"),t.time=e.get("createdAt"),t.click=function(){CommentUtils.triggerCommentFocus(e.id)},t.text='<span class="ui-comment-notify-list-username">'+CommentUtils.getUsername(t.zuid)+"</span> has made a comment";var n=DocNotificationManager.add(t);CommentModels.docnotificationMap[e.id]=n},CommentUtils.removeDocNotification=function(e){var t=CommentModels.docnotificationMap[e];t&&DocNotificationManager.remove(t),t&&delete CommentModels.docnotificationMap[e]},CommentUtils.showAllHighlights=function(){U.each(CommentManager.highlightMap.el,function(e){e.show()})},CommentUtils.hideAllHighlights=function(){U.each(CommentManager.highlightMap.el,function(e){e.hide()})},CommentUtils.getSharedUsers=function(){return U.filter(CollabListHandler.userStatus,function(e){return editor.zuid!=e.ZUID}).map(function(e){return e.EMAIL_ID})},CommentUtils.getMentionedPeople=function(e){var t=[],n=CommentModels.commentCollection.get(e);return n?(t.push(CommentUtils.detectMentions(n.get("text"))),t.push(n.get("children").map(function(e){return CommentUtils.detectMentions(e.get("text"))})),U.flatten(t)):[]},CommentUtils.invalidCharsRegex=function(){var e=["\u2028","\u2029"];return new RegExp(e.join("|"),"gi")},CommentUtils.removeInvalidChars=function(e){return e.replace(CommentUtils.invalidCharsRegex(),"")},CommentUtils.isImageSegment=function(e,t){return t-e==2&&editor.doc.getCharAt(e+1)===UNICODE.IMAGE},CommentUtils.isRangeCharsPresent=function(e){return CommentModels.commentIndices.filter(function(t){return t.id===e}).length},CommentUtils.isJSONString=function(e){try{return JSON.parse(e),!0}catch(e){return!1}},CommentUtils.getCurrentFocusedComment=function(){return CommentManager.views.commentPaneView?CommentManager.views.commentPaneView.currentFocusedComment:null},CommentModels=function(e){var t={ALL:1,RESOLVED:2,UNRESOLVED:3,UNREAD:4,BY_AUTHOR:5,BY_DATE:6,UNREAD:7},n={REPLY_ADD:1,RESOLVE:2,REOPEN:3,DELETE:4,REPLY_DELETE:5,EDIT:6,REPLY_EDIT:7,LIKE:8,REPLY_LIKE:9,UNLIKE:10,REPLY_UNLIKE:11},i=/@([\w\.\+-]+)@([\w-]+)\.([a-zA-Z\.]{2,22}(\.[a-zA-Z]{2}){0,2})/g,o=/((http|ftp|https|www\.)(:\/\/|)[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?)/g,r=J.i18n("common","NO")+" {{type}} "+J.i18n("common","COMMENTS")+" "+J.i18n("common","TODISP"),a="CCE_101",s="CCE_102",l="CCE_103",d="CCE_104",c="CCE_105",u="CCE_106",p=15,h=!1,f=3,m=e.Model.extend({constructor:function(t){defaults={id:"zw"+Utils.randomString(),createdAt:(new Date).getTime(),zuid:editor.zuid,activityLog:[],text:null,html:null,doctext:null,children:[],parentId:null,isResolved:!1,contentUpdatedAt:(new Date).getTime(),version:editor.doc.getDocInfo().VERSION,likes:[],followers:[],reads:[],inFocus:!1,inEditingMode:!1,isRangeCharsRendered:!1,focusedFrom:null,unread:!1,parentComment:null},t=jQuery.extend(defaults,t),e.Model.apply(this,arguments),this.listenTo(this,"addComment addReplyComment likeComment resolveComment reopenComment",function(e,t,n){t&&CommentUtils.updateFollowers(e,this)}),this.listenTo(this,"change:unread",function(e,t,n){return!e.get("parentId")&&void(!n.dontSendDocNotification&&t?CommentUtils.sendUnreadCommentDocNotificaion(e):null)}),this.listenTo(this,"change:isRangeCharsRendered",function(e,t,n){t||CommentUtils.removeDocNotification(e.id)})},addReplyComment:function(e,t,i){var i=i||"zw"+Utils.randomString();this.get("children").push(e),e.set("parentComment",this),this.addToActivityLog({activityId:i,action:n.REPLY_ADD,commentId:e.id}),t&&this.sendReplyCommentToBuffer(e,i),this.trigger("addReplyComment","addReplyComment",t,e)},editReplyComment:function(e,t,i,o){var r=r||"zw"+Utils.randomString(),a=e.get("text"),s=e.get("html"),l=e.get("contentUpdatedAt");e.set("text",t),e.set("html",CommentUtils.getMarkedupCommentContent(t)),e.addToActivityLog({activityId:r,action:n.EDIT,oldText:a,oldHtml:s,oldTime:l}),this.addToActivityLog({activityId:r,action:n.REPLY_EDIT,commentId:e.id}),i&&this.sendReplyEditToBuffer(e,t,r)},removeReplyComment:function(e,t,i){var i=i||"zw"+Utils.randomString();this.get("children").remove(e),this.addToActivityLog({activityId:i,action:n.REPLY_DELETE,commentId:e.id}),t&&this.sendReplyDeleteToBuffer(e,i)},edit:function(e,t,i){var i=i||"zw"+Utils.randomString(),o=this.get("text"),r=this.get("html"),a=this.get("contentUpdatedAt");this.set("text",e),this.set("html",CommentUtils.getMarkedupCommentContent(e)),this.addToActivityLog({activityId:i,action:n.EDIT,oldText:o,oldHtml:r,oldTime:a}),t&&this.sendEditToBuffer(e,i)},resolve:function(e,t,i,o,r){var o=o||"zw"+Utils.randomString();this.set("isResolved",!0),this.addToActivityLog({activityId:o,action:n.RESOLVE,zuid:t||editor.zuid,time:i||(new Date).getTime()}),e&&(r||this.sendResolveToBuffer(o)),this.trigger("resolveComment","resolveComment",e,this)},reopen:function(e,t,i,o){this.set("isResolved",!1),o=o||"zw"+Utils.randomString(),this.addToActivityLog({activityId:o,action:n.REOPEN,zuid:t||editor.zuid,time:i||(new Date).getTime()}),e&&this.sendReopenToBuffer(o),this.trigger("reopenComment","reopenComment",e,this)},follow:function(e,t,n){t=t||editor.zuid,n=n||"zw"+Utils.randomString();var i=JSON.parse(JSON.stringify(this.get("followers")));i.push(t),this.set("followers",i),e&&this.sendFollowToBuffer(n)},unfollow:function(e,t,n){t=t||editor.zuid,n=n||"zw"+Utils.randomString();var i=JSON.parse(JSON.stringify(this.get("followers")));i=i.filter(function(e){return e!=t}),this.set("followers",i),e&&this.sendUnfollowToBuffer(n)},read:function(e,t){if(e=e||editor.zuid,t=t||"zw"+Utils.randomString(),U.contains(this.get("reads"),e)){if(this.isAnyChildUnread(e)){var n=this.get("children").filter(function(t){return!U.contains(t.get("reads"),e)}).map(function(e){return e.id});this.get("children").read(n,e),CommentModels.commentCollection.markRead([this.id],t)}}else this.get("reads").push(e),this.trigger("change:reads",this,this.get("reads")),CommentModels.commentCollection.markRead([this.id],t)},unread:function(e,t){if(e=e||editor.zuid,t=t||"zw"+Utils.randomString(),!U.contains(this.get("reads"),e))return!1;var n=this.get("reads").filter(function(t){return e!=t});this.set("reads",n,{dontSendDocNotification:!0}),CommentModels.commentCollection.markUnread([this.id],t)},like:function(e,t,n,i){t=t||editor.zuid,n=n||(new Date).getTime(),i=i||"zw"+Utils.randomString();var o=JSON.parse(JSON.stringify(this.get("likes")));o.push(t),this.set("likes",o),e&&this.sendLikeToBuffer(i),this.trigger("likeComment","likeComment",e,this)},unlike:function(e,t,n,i){t=t||editor.zuid,n=n||(new Date).getTime(),i=i||"zw"+Utils.randomString();var o=JSON.parse(JSON.stringify(this.get("likes")));o=o.filter(function(e){return e!=t}),this.set("likes",o),e&&this.sendUnlikeToBuffer(i)},isAnyChildUnread:function(){for(var e=0;e<this.get("children").length;e++){var t=this.get("children").models[e];if(!U.contains(t.get("reads"),editor.zuid))return!0}return!1},sendReplyCommentToBuffer:function(e,t){var n={},i=editor.doc.getDocInfo();n.action="addReplyComment",n.rid=i.RID,n.sid=editor.uuid,n.commentData=CommentUtils.getCoreData(e.json()),n.commentData.children={},n.commentData.activityId=t,CommentUtils.sendOp([n])},sendReplyEditToBuffer:function(e,t,n){var i={},o=editor.doc.getDocInfo();i.action="updateReplyComment",i.rid=o.RID,i.sid=editor.uuid,i.commentData={},i.commentData.id=e.id,i.commentData.parentId=this.id,i.commentData.text=t,i.commentData.activityId=n,CommentUtils.sendOp([i])},sendReplyDeleteToBuffer:function(e,t){var n={},i=editor.doc.getDocInfo();n.action="deleteReplyComment",n.rid=i.RID,n.sid=editor.uuid,n.commentData={},n.commentData.id=e.id,n.commentData.parentId=this.id,n.commentData.activityId=t,CommentUtils.sendOp([n])},sendEditToBuffer:function(e,t){var n={},i=editor.doc.getDocInfo();n.action="updateComment",n.rid=i.RID,n.sid=editor.uuid,n.commentData={},n.commentData.id=this.id,n.commentData.text=e,n.commentData.activityId=t,CommentUtils.sendOp([n])},sendResolveToBuffer:function(e){var t={},n=editor.doc.getDocInfo();t.action="resolveComment",t.rid=n.RID,t.sid=editor.uuid,t.commentData={},t.commentData.id=this.id,t.commentData.activityId=e,CommentUtils.sendOp([t])},sendReopenToBuffer:function(e){var t={},n=editor.doc.getDocInfo();t.action="reopenComment",t.rid=n.RID,t.sid=editor.uuid,t.commentData={},t.commentData.id=this.id,t.commentData.activityId=e,CommentUtils.sendOp([t])},sendLikeToBuffer:function(e){var t={},n=editor.doc.getDocInfo();t.action=this.get("parentId")?"likeReplyComment":"likeComment",t.rid=n.RID,t.sid=editor.uuid,t.commentData={},t.commentData.id=this.id,t.commentData.activityId=e,this.get("parentId")&&(t.commentData.parentId=this.get("parentId")),CommentUtils.sendOp([t])},sendUnlikeToBuffer:function(e){var t={},n=editor.doc.getDocInfo();t.action=this.get("parentId")?"unlikeReplyComment":"unlikeComment",t.rid=n.RID,t.sid=editor.uuid,t.commentData={},t.commentData.id=this.id,t.commentData.activityId=e,this.get("parentId")&&(t.commentData.parentId=this.get("parentId")),CommentUtils.sendOp([t])},sendFollowToBuffer:function(e){var t={},n=editor.doc.getDocInfo();t.action="followComment",t.rid=n.RID,t.sid=editor.uuid,t.commentData={},t.commentData.idList=[this.id],t.commentData.activityId=e,CommentUtils.sendOp([t])},sendUnfollowToBuffer:function(e){var t={},n=editor.doc.getDocInfo();t.action="unfollowComment",t.rid=n.RID,t.sid=editor.uuid,t.commentData={},t.commentData.idList=[this.id],t.commentData.activityId=e,CommentUtils.sendOp([t])},receiveReplyCommentFromCollaborators:function(e){var t=e.activityId;delete e.activityId;var n=CommentModels.CommentCollection.createComment(CommentUtils.refineCommentJSON(e));this.addReplyComment(n,!1,t)},receiveReplyEditFromCollaborators:function(e){var t=e.activityId,n=this.get("children").get(e.id);this.editReplyComment(n,e.text,!1,t)},receiveReplyDeleteFromCollaborators:function(e){var t=e.activityId,n=this.get("children").get(e.id);this.removeReplyComment(n,!1,t)},receiveEditFromCollaborators:function(e,t){this.edit(e,!1,t)},json:function(){var e=this.toJSON();return e.activityLog=e.activityLog.map(function(e){return e.toJSON()}),e.children=e.children.map(function(e){return e.json()}),delete e.parentComment,e},addToActivityLog:function(e){e.time||(e.time=(new Date).getTime()),this.get("activityLog").push(e),e.action===n.EDIT&&this.set("contentUpdatedAt",e.time)}}),g=e.Collection.extend({initialize:function(e){this.sortkey="time"},comparator:function(e,t){return t.get(this.sortkey)<e.get(this.sortkey)?1:-1}}),T=e.Collection.extend({model:m,initialize:function(e){this.listenTo(this,"change:reads remove change:isRangeCharsRendered",this.updateUnreadCommentCount)},updateUnreadCommentCount:function(e,t,n){return!e.get("parentId")&&(noOfUnreadComments=this.getRenderedComments().filter(function(e){return U.contains(e.get("reads"),editor.zuid)?(e.set("unread",!1,n),!1):(e.set("unread",!0,n),!0)}).length,void CommentModels.commentPane.set("noOfUnreadComments",noOfUnreadComments))},addComment:function(e,t,n,i){this.add(e),t&&n&&i&&(editor.lastOperation="addComment",this.insertRangeChars(e.id,n,i),this.sendCommentToBuffer(e),Op.sendMsg()),e.trigger("addComment","addComment",t,e)},removeComment:function(e,t,n,i){n=n||"zw"+Utils.randomString(),this.remove(e),PubSub.publish("Comment/deleted",e.id),t&&(editor.lastOperation="removeComment",this.removeRangeChars(e.id),i||(this.sendDeleteToBuffer(e,n,i),Op.sendMsg()))},removeAllComments:function(e,t){var n=this;t=t||"zw"+Utils.randomString();var i=n.getRenderedComments().map(function(e){return e.id});U.each(i,function(i){var o=n.get(i);o.get("isRangeCharsRendered")&&n.removeComment(o,e,t,!0)}),e&&(this.sendDeleteAllToBuffer(i,t),Op.sendMsg())},resolveAllComments:function(e,t,n,i){var o=this;i=i||"zw"+Utils.randomString();var r=o.getUnresolvedComments().map(function(e){return e.id});U.each(r,function(r){var a=o.get(r);a.get("isRangeCharsRendered")&&a.resolve(e,t,n,i,!0)}),e&&this.sendResolveAllToBuffer(r,i)},followAllComments:function(e,t,n){n=n||"zw"+Utils.randomString(),t=t||editor.zuid;this.getRenderedComments().filter(function(e){return!U.contains(e.get("followers"),t)}).map(function(e){return e.follow(!1,t,n),e.id});e&&this.getRenderedComments().length&&this.sendFollowCommentsToBuffer("followAllComments",null,n)},unfollowAllComments:function(e,t,n){n=n||"zw"+Utils.randomString(),t=t||editor.zuid;this.getRenderedComments().filter(function(e){return U.contains(e.get("followers"),t)}).map(function(e){return e.unfollow(!1,t,n),e.id});e&&this.getRenderedComments().length&&this.sendFollowCommentsToBuffer("unfollowAllComments",null,n)},followComments:function(e,t,n,i,o){i=i||"zw"+Utils.randomString(),t=t||editor.zuid;var r=n.filter(function(e){return this.get(e)&&this.get(e).follow(!1,t,i),this.get(e)},this);e&&r.length&&this.sendFollowCommentsToBuffer("followComment",r,i,o)},unfollowComments:function(e,t,n,i,o){i=i||"zw"+Utils.randomString(),t=t||editor.zuid;var r=n.filter(function(e){return this.get(e)&&this.get(e).unfollow(!1,t,i),this.get(e)},this);e&&r.length&&this.sendFollowCommentsToBuffer("unfollowComment",r,i,o)},sendFollowCommentsToBuffer:function(e,t,n,i){var o={},r=editor.doc.getDocInfo();o.action=e,o.rid=r.RID,o.sid=editor.uuid,o.commentData={},o.commentData.idList=t,o.commentData.activityId=n,CommentUtils.sendOp([o],i)},insertRangeChars:function(e,t,n){t=0===t?1:t,!editor.doc.getSelection().isCollapsed&&editor.doc.getCharAt(n-1)==UNICODE.PARA&&(n-=1);var i={};i[ATTR_COMMON.TYPE]=NODE_TYPE.COMMENT,i[ATTR_COMMON.ID]=e;var o={char:UNICODE.RANGE_START,style:i},i={};i[ATTR_COMMON.TYPE]=NODE_TYPE.COMMENT,i[ATTR_COMMON.ID]=e;var r={char:UNICODE.RANGE_END,style:i},a=editor.doc.getSelection(),s=a.getLastRange();s&&s.setStart(t)&&s.setEnd(n),a.surroundTextWith(o,r),curPos=n+2,Op.fillCursorPos(curPos,curPos)},removeRangeChars:function(e){var t=CommentUtils.getCommentRange(e);if(!t)return!1;var n=editor.doc.getContent(t.start,t.start+1),i=editor.doc.getContent(t.end,t.end+1),o=[{r:t.start},{ds:n},{r:t.end-t.start-1},{ds:i}];Op.processMsg(o)},sendCommentToBuffer:function(e){var t={},n=editor.doc.getDocInfo();t.action="addComment",t.rid=n.RID,t.sid=editor.uuid,t.commentData=CommentUtils.getCoreData(e.json()),t.commentData.children={},CommentUtils.sendOp([t])},sendDeleteToBuffer:function(e,t,n){var i=CommentUtils.constructDeleteOp(e);i.activityId=t,n||CommentUtils.sendOp([i])},sendDeleteAllToBuffer:function(e,t){var n={},i=editor.doc.getDocInfo();n.action="deleteAllComments",n.rid=i.RID,n.sid=editor.uuid,n.commentData={},n.commentData.activityId=t,n.commentData.idList=e,CommentUtils.sendOp([n])},sendResolveAllToBuffer:function(e,t){var n={},i=editor.doc.getDocInfo();n.action="resolveAllComments",n.rid=i.RID,n.sid=editor.uuid,n.commentData={},n.commentData.activityId=t,n.commentData.idList=e,CommentUtils.sendOp([n])},read:function(e,t){t=t||editor.zuid,U.each(e,function(e){var n=this.get(e);U.contains(n.get("reads"),t)||n.get("reads").push(t),n.trigger("change:reads",n,n.get("reads"))},this)},unread:function(e,t,n){t=t||editor.zuid,U.each(e,function(e){var n=CommentModels.commentCollection.get(e);if(!U.contains(n.get("reads"),t))return!1;var i=n.get("reads").filter(function(e){return t!=e});n.set("reads",i,{dontSendDocNotification:!0})})},markRead:function(e,t){t=t||"zw"+Utils.randomString();var n={},i=editor.doc.getDocInfo();n.action="markRead",n.rid=i.RID,n.sid=editor.uuid,n.commentData={},n.commentData.activityId=t,n.commentData.idList=e,e.length&&CommentUtils.sendOp([n])},markUnread:function(e,t){t=t||"zw"+Utils.randomString();var n={},i=editor.doc.getDocInfo();n.action="markUnread",n.rid=i.RID,n.sid=editor.uuid,n.commentData={},n.commentData.activityId=t,n.commentData.idList=e,e.length&&CommentUtils.sendOp([n])},receiveAddCommentFromCollaborators:function(e){var t=CommentUtils.refineCommentJSON(e);commentObj=CommentModels.CommentCollection.createComment(t),this.addComment(commentObj,!1)},receiveDeleteCommentFromCollaborators:function(e){var t=this.get(e.id);this.removeComment(t,!1,e.activityId)},getRenderedComments:function(){return this.filter(function(e){return e.get("isRangeCharsRendered")&&CommentModels.commentOrder.indexOf(e.id)>-1})},getUnresolvedComments:function(){return this.getRenderedComments().filter(function(e){return!e.get("isResolved")})},isCommentRendered:function(e){return this.get(e)&&this.get(e).get("isRangeCharsRendered")&&CommentModels.commentOrder.indexOf(e)>-1},getParent:function(e){return this.get(e)?this.get(e):this.filter(function(t){return t.get("children").get(e)})[0]},json:function(){var e=this.map(function(e){return e.json()});return e}},{createComment:function(e){var t=new m(e);return t.set("activityLog",new g(e.activityLog)),t.set("children",new T),U.each(e.children,function(e){var n=CommentModels.CommentCollection.createComment(e);n.set("parentComment",t),t.get("children").push(n)},this),t}}),_=e.Model.extend({defaults:{VIEWS:t,currentView:t.UNRESOLVED,noOfUnreadComments:0,show:!1,searchQuery:"",isShowingSearchbox:!1,order:new e.Collection,VIEW_NAME_MAP:{1:"All Comments",2:"Resolved Comments",3:"Unresolved Comments",4:"Unread Comments",5:"All Comments",6:"All Comments",7:"Unread Comments"},nosAll:0,nosResolved:0,nosUnresolved:0,commentCreationDialogShow:!1,freeze:!1,noCommentsToShow:!0,isShowingViewMenu:!0,isLoading:!1}}),E=e.Model.extend({defaults:{display:!0}}),v=function(){var e=new Array(2);this.add=function(t){e[1]?e[1]=e[1].concat(t):e[1]=t},this.shift=function(){var t=e[1];return e[0]=t,e[1]=void 0,e[0]},this.getAckPendingEdit=function(){return e[0]},this.getPendingToPushEdit=function(){return e[1]},this.ackReceived=function(){e[0]=void 0},this.isReqSent=!1,this.reqCount=0,this.pendingCommentEdits=e},S=new T,b=new _,R=new E,O=[],D=!0,y={isLoaded:!1,contacts:[],enabled:!0,validRoles:["OWNER","SHAREDREADCOMMENT","COOWNER","SHAREDREADWRITE"],add:function(e){var t={};U.each(CommentModels.atMention.contacts,function(e){t[e.emailid]=e}),e=e.filter(function(e){return!t[e.emailid]}),Array.prototype.push.apply(CommentModels.atMention.contacts,e)}},A={},C=[],I={start:null,end:null},w=function(){S.reset(),CommentModels.commentOrder=[],CommentModels.commentIndices=[]},P=new v,M=0,L=null,N=new e.Collection,x={},k=function(e){var t=CommentModels.commentIndices.filter(function(t){return t.end>=e.start&&t.end<e.end}).map(function(e){return e.id});H(t)},F=function(e,t){var n=editor.doc.getContent(e,t);B(e,n,"is")},Y=function(e,t,n){B(e,n,"ds")},B=function(e,t,n){CommentModels.commentIndices=CommentModels.commentIndices.map(function(i){var o=ReviewUtil.updateIndex(i,e,t,n);return i.start=o.start,i.end=o.end,i})},H=function(e){U.each(e,function(e){var t=CommentModels.commentCollection.get(e);t&&t.set("isRangeCharsRendered",!1),CommentUtils.removeHighlights(e),CommentModels.commentIndices=CommentModels.commentIndices.filter(function(t){return t.id!=e})})},W=function(e){var t=editor.doc.getRawFormatAt(e),n=editor.doc.getCharAt(e);t&&t.type===NODE_TYPE.COMMENT&&n===UNICODE.RANGE_END&&PubSub.publish("Comment/RangeEndInserted",[t.id],e)},V=null,G=function(){var e,t,n,i,o,r,a,s;if(V){e=V.type,t=V.from,n=V.to,s=V.chars,"is"===e?fn=W:"ds"===e&&(fn=k);if("ds"===e)fn({start:t,end:n,chars:s}),Y(t,n,s);else{for(F(t,n),o=t,r=editor.doc.getRawFormatAt(o),a=t+1;a<n;a++)i=editor.doc.getRawFormatAt(a),i&&(fn(o,a,r),r=i,o=a);fn(o,a,r)}V=null}},z=function(e,t){if(editor.getView()!==EDITOR_VIEWS.HISTORY&&!Utils.isVersionView()){var n=!0;V&&("is"==V.type&&V.to==e?(V.to=t,n=!1):G()),n&&(V={type:"is",from:e,to:t})}},Z=function(e,t,n){if(editor.getView()!==EDITOR_VIEWS.HISTORY&&!Utils.isVersionView()){var i=!0;V&&("ds"==V.type&&V.to==e+(V.to-V.from)?(V.to+=t-e,V.chars+=n,i=!1):G()),i&&(V={type:"ds",from:e,to:t,chars:n})}};return PubSub.subscribe("Document/ContentAdded",z),PubSub.subscribe("Document/ContentDeleted",Z),{CommentObj:m,CommentPane:_,CommentCollection:T,commentOrder:O,commentCollection:S,commentPane:b,commentToggle:R,EMAIL_REGEX:i,URL_REGEX:o,COMMENTVIEWS:t,TXT_NO_COMMENTS_TO_DISPLAY:r,COMMENT_REQUEST_FAILURE_ERROR:a,COMMENT_SERVER_DATA_MISSING_ERROR:s,COMMENT_COLLABORATION_HANDLING_ERROR:l,COMMENT_SYNC_ERROR:d,COMMENT_SYNC_OP_MISSING_ERROR:c,COMMENT_CLIENT_DATA_MISSING_ERROR:u,SHOULD_HIGHLIGHT_RESOLVED_COMMENTS:h,MAX_RETRY_COUNT:f,updateCommentFocus:D,atMention:y,ACTIVITYLOG:n,cursorSelection:I,highlightNodes:A,commentIndices:C,reset:w,queue:P,comment_sequence_number:M,lastError:L,EDITORPANE_HORIZONTALSCROLLBAR_HEIGHT:p,authors:N,docnotificationMap:x,applyChanges:G}}(Backbone);var XFormMap=function(e){"use strict";var t=function(){this.map={}};return t.prototype.applyOp=function(e){if(!e||!e.length())return e;for(var t in this.map){var n=DocOpBuilder.xform(e,this.map[t]);this.map[t]=DocOpBuilder.concise(n.second)}},t.prototype.disableAutoUpdate=function(){PubSub.unsubscribe("Document/AfterModelUpdation",this.applyOp,{context:this})},t.prototype.enableAutoUpdate=function(){PubSub.subscribe("Document/AfterModelUpdation",this.applyOp,{context:this})},t.prototype.flushOp=function(e){this.map={}},t.prototype.getOp=function(e){return this.map[e]},t.prototype.putOp=function(e,t){this.map[t]=e},t.prototype.removeOp=function(e){delete this.map[e]},t}(),XFormStack=function(e){"use strict";var t=function(){};return t.prototype.forEach=Array.prototype.forEach,t.prototype.length=0,t.prototype.pushOp=Array.prototype.push,t.prototype.splice=Array.prototype.splice,t.prototype.applyOp=function(e){if(!e||!e.length())return e;this.forEach(function(t,n,i){var o=DocOpBuilder.xform(e,t);i[n]=DocOpBuilder.concise(o.second)})},t.prototype.disableAutoUpdate=function(){PubSub.unsubscribe("Document/AfterModelUpdation",this.applyOp,{context:this})},t.prototype.enableAutoUpdate=function(){PubSub.subscribe("Document/AfterModelUpdation",this.applyOp,{context:this})},t.prototype.flushOp=function(e){this.length=0},t.prototype.getOp=function(e){return this[e]},t.prototype.removeOp=function(e){this.splice(e,1)},t}();!function(e){e.widget("ui.zshapeintegrator",{_rMenuData:[{id:"cutShape",action:"cutShape",label:"Cut"},{id:"copyShape",action:"copyShape",label:"Copy"},{id:"pasteShape",action:"pasteShape",label:"Paste"},{id:"shapeMenu_sep",mtype:"separator"},{id:"removeShape",action:"removeShapes",label:"Delete"},{id:"shapeMenu_sep",mtype:"separator"},{id:"bringFront",action:"bringFront",label:"Bring Front"},{id:"sendBack",action:"sendBack",label:"Send Back"},{id:"bringForward",action:"bringForward",label:"Bring Forward"},{id:"sendBackward",action:"sendBackward",label:"Send Backward"}],_drawContainer:void 0,_drawContainers:[],_allowMouseEvent:!0,options:{container:void 0,editButton:!0},_initShapes:function(){e.ShapeData.init(),Shape.init([])},removeBorder:function(){var e=InsertShape.selectedShape().data,t=e.nvOProps.nvDProps.id,n=J("#"+t).parents("div.zw-paragraph")[0],i=InsertShape.getShapeNodeData(n,t).shapenode;if(null!=i){var o={};o[ATTR_COMMON.TYPE]="image",0==e.props.stroke.width?e.props.stroke.width=2:e.props.stroke.width=0;var r,a,s=PUtil.offset(n);r=e.props.transform.pos.top-s.top,a=e.props.transform.pos.left-s.left,e.props.transform.pos.top=r,e.props.transform.pos.left=a,o[ATTR_IMAGE.I_SHAPEDATA]=e,editor.doc.execCmd("applyStyle",[i,o])}},formatshapemenu:function(){LayoutManager.isRichEditActive()?LeftPanel.showSubPanel(ELEM_ID.SHAPESPANEL,ANIMATIONS.FADEIN):LayoutManager.toggleRichEdit("open",ELEM_ID.SHAPESPANEL)},removeShapes:function(){InsertShape.deleteShapes()},_bindContainerEvents:function(t){t.bind("keyup",function(e){if(InsertShape.selectedShape()){var t=e.keyCode,n=e.ctrlKey||e.metaKey;InsertShape.isCtrlKeyPressed=EventHandler.isOnlyCtrlKeyPressed=n,40!=t&&39!=t&&38!=t&&37!=t||0!=J(".selectedArea").length||(ShapeEditor.config.isSlideLocked=function(){return!1}),9==t&&(ShapeEditor.config.isSlideLocked=function(){return!1}),!ShapeEditor.text.isEditable()||t!=KEYS.NAV_LEFT&&t!=KEYS.NAV_RIGHT||InsertShape.updateToolbar()}}),t.bind("keydown",function(e){if(InsertShape.selectedShape()){var t=e.keyCode,n=e.ctrlKey||e.metaKey,i=e.shiftKey;if(InsertShape.isCtrlKeyPressed=n,n)return ShapeEditor.text.isEditable()||65!=t||InsertShape.editShape(-1),void(t==KEYS.C?CopyUtil.onCopy():88!=t||i?90==t?InsertShape.clearSelection():t==KEYS.V?(EventHandler.plainTextPaste=!!i,PasteUtil.preparePasteDiv()):(66==t?InsertShape.processTxtFormat(["bold"]):73==t?InsertShape.processTxtFormat(["italic"]):85==t?InsertShape.processTxtFormat(["underline"]):i&&88==t?InsertShape.processTxtFormat(["strikethrough"]):190==t?InsertShape.processTxtFormat(["superscript"]):188==t&&InsertShape.processTxtFormat(["subscript"]),e.stopPropagation(),e.preventDefault()):InsertShape.cut());EventHandler.isOnlyCtrlKeyPressed=!1,9==t?ShapeEditor.config.isSlideLocked=function(){return!0}:40!=t&&39!=t&&38!=t&&37!=t||0!=J(".selectedArea").length||(e.stopPropagation(),e.preventDefault(),ShapeEditor.config.isSlideLocked=function(){return!0}),e.keyCode!=KEYS.BACKSPACE&&e.keyCode!=KEYS.DELETE||void 0!=ShapeEditor.text.getObject().from.para||(InsertShape.deleteShapes(),InsertShape.closeToolbar(),e.stopPropagation(),e.preventDefault())}}),e(document).bind("shape_created",function(t,n){e("#customShapes").zbutton("uncheck","#curve,#freeform,#scribble")})},updateTextFormat:function(e,t){var n={ut:"portion",value:{}},i=e.action;"underline"!=e.action&&"strike"!=e.action||(t=t?"SINGLE":"NONE"),"superscript"!=e.action&&"subscript"!=e.action||(t="superscript"==e.action?t?.3:0:t?-.25:0,i="baseline"),n.value[i]=t,ShapeEditor.text.editor.changeProperty(n)},_removeShapes:function(e){ShapeEditor.bbox.shape={bbox:{},handles:[]},ShapeEditor.clear(),this.options.container.find(".shape_box").remove()},_removeSelectedShapes:function(t){t=t||InsertShape.selectedShape(),ShapeEditor.bbox.remove(),e.each(t,function(e,t){for(var n=t.data,i=(t.connector,n.nvOProps.nvDProps.id),o=J("#"+i).parents("div.zw-paragraph"),r=(DocUtil.getDocElement(o).getStart(),editor.doc.getSelection().getStart()),a=editor.doc.getSectionStart(r),s=editor.doc.getSectionEnd(a),l=editor.doc.getNodesInSelection(NODE_TYPE.IMAGE,a,s),e=0;e<l.length;e++){var d=l[e].getStart(),c=editor.doc.getRawFormatAt(d);if(c&&c.hasOwnProperty(ATTR_IMAGE.I_SHAPEDATA)&&c.shapeData.nvOProps.nvDProps.id==i){var u=[{r:d},{ds:UNICODE.IMAGE}];Op.processMsg(u),Op.sendMsg();break}}}),J("#inner_shape").css({width:"0",height:"0px"})},_changeDrawContainer:function(t){t.length&&e(ShapeEditor.config.drawcontainer).get(0)!=t[0]&&(ShapeEditor.config.drawContainer&&ShapeEvent.destroy(),ShapeEditor.config.drawcontainer=t,ShapeEditor.config.container=t,ShapeEvent.init())},_changeContainerMode:function(t,n){e(t).each(function(t,i){if(e(i).get(0)!=n[0]){var o=e(i).find("#edit");o.zbutton("changeLabel","Edit"),o.data("editMode",!1)}})},_triggerDrawnEvent:function(){ShapeEditor.config.isSupported.shapeEdit||ShapeEditor.config.drawcontainer.trigger("shapesdrawn",e.ShapeData.shapes);},draw:function(t,n){n.addClass("drawcontainer"),ShapeEditor.config.drawcontainer=n,ShapeEditor.config.container=n.find("#inner_shape"),this._initShapes(),editor.isEditable()&&(ShapeEvent.init(),this._bindContainerEvents(n),ShapeEvent.cursorTypes.DEFAULT=""),this._removeShapes(e.ShapeData.shapes),e.ShapeData.shapes={},t&&t.length&&this._drawShapes(e("#inner_shape"),t);var i=e("#inner_shape");i.attr("context","Rmenu")},_drawShapes:function(t,n){e.each(n,function(n,i){Shape.create.draw(i,t),e.ShapeData.updateShapes(i)})},_create:function(){e.metadata.setType("attr","data");e("#drawcontainer")},_createShapeRMenu:function(t){var n=e.ui.zmenu.createMenu(t),i=[];e(this._rMenuData).each(function(e,t){var n={};n.icon=t.iconClass,n.id=t.id,n.label=t.label,n.appData={action:t.action},n.mtype=t.mtype,i.push(n)}),n.zmenu("addMenuItems",i),n.appendTo("body"),n.bind("menubeforeshow",function(e,t){return editor.isEditable()});var o=this;n.bind("menuitemclicked",function(e,t){var n=t.menuitem.metadata().appData.action;o[n]()})},getShapesData:function(){return e.ShapeData.shapes},getPaintedArea:function(){var t=e.ShapeData.shapes,n=[],i=[];e.each(t,function(e,t){var o=ShapeEditor.outerBBox(t);n.push(o[0]),i.push(o[1])});var o=VectorUtil.getMinAndMax(n),r=VectorUtil.getMinAndMax(i),a={left:o.small.x,top:o.small.y},s={width:r.big.x-o.small.x,height:r.big.y-o.small.y},l={position:a,dimension:s};return l}})}(jQuery),function(e){ShapeEditor.config=e.extend(!0,ShapeConfig,{init:function(){this.shapeDim={width:100,height:100}},allowMouseEvent:function(){return!0},get:{shapes:{all:function(t){return e.ShapeData.getShapeIds(t,"All")},hidden:function(t){return e.SlideEvent.getShapeIds(t,"Hidden")},visible:function(t){return e.SlideEvent.getShapeIds(t,"Visible")}},shape:function(t){var n;if(t&&J("#"+t).length>0){if(n=e.ShapeData.getShapeData(t)){var i=J.extend(!0,{},n),o=J(editor.clientActiveSection).find("#"+t).parents("div.zw-paragraph")[0]||J("#"+t).parents("div.zw-paragraph")[0];PUtil.offset(o),editor.jeditorPane.offset();return i.props.transform=InsertShape.changeRelativeToPara(t,i.props.transform),i.props.transform.dim.height*=editor.zoomFactor,i.props.transform.dim.width*=editor.zoomFactor,i.fitModeData&&(i.fitModeData.height=1e3,i.fitModeData.width=1e3,i.fitModeData.top=-200,i.fitModeData.left=-200),i}}else n=e.ShapeData.getShapeData(t);return n},mergeShape:function(e){},groupselect:function(){return e.ShapeDefault.groupselect},scale:function(){return 1},shapeContainer:function(){return e.ShapeData.getShapeContainer()},shapeContainerId:function(){return"drawcontainer"},zIndies:function(){var t=this,n=t.shapes.all(),i=[];return e.each(n,function(e,n){var o=t.shape(n);props=o.props?o.props:o[o.type.toLowerCase()].props;var r=o.props.transform.pos.zindex;i.push({zindex:r,data:o})}),i.sort(zoho.array.compareZindex),i},max:{zIndex:function(){var e=ShapeEditor.config.get.zIndies(),t=e[e.length-1],n=t?t.zindex:0;return n}},convertUnit:function(e){return e},slideSize:function(){return{width:750,height:600}}},eventTrigger:{rightClick:function(t,n){e(document).trigger(t,{target:n})}},isSupported:{text:!0,draw:!0,connector:!1,shapeEdit:!0,selection:!0,showSmartGuides:!1,showGrids:!1,showGuides:!1},drawOnMouseDown:{preset:!0,custom:!1},mouse:{down:function(e,t){if(!InsertShape.isEditorEditable())return!1;var n=J(t[0]),i=n.prop("tagName"),o=InsertShape.selectedShape(),r=n.parents("div.inner_shape"),a=!1,s=(Utils.getCorrectedCoord(e),n.parents("div.shape_box")[0]&&n.parents("div.shape_box")[0].id||"");if(s&&s.indexOf("_")!=-1&&(s=n.parents("div.shape_box").attr("class").split(" ").slice(-1)[0].replace("bbox","").replace("normal","")),InsertShape.isCtrlKeyPressed=EventHandler.isOnlyCtrlKeyPressed=!e.altKey&&!e.shiftKey&&(editor.browserInfo.is_mac?!e.ctrlKey&&e.metaKey:e.ctrlKey),InsertShape.duplicateMode=!e.shiftKey&&editor.browserInfo.is_mac?e.altKey&&!e.ctrlKey:e.ctrlKey&&!e.altKey,n.parents("div.shape_box")[0]&&o&&s!=o.data.nvOProps.nvDProps.id&&(a=!0),a&&PubSub.publish("Gridlines/show"),null!=InsertShape.isTextModified&&("path"==i&&n.parents(".inner_shape")[0]||"path"!=i||"SPAN"==i&&"word"===n.attr("id"))&&(0==r.length||a))return InsertShape.updateShapeText(),a?(InsertShape.select.shape(s),InsertShape.updateToolbar()):(InsertShape.closeToolbar(),InsertShape.clearSelection()),J("#scaleSpan").css({top:J("#ui-editor-outer-div").scrollTop()}),!1;if("path"!=i&&0==r.length&&!InsertShape.isDrawingMode)return PubSub.publish("Gridlines/hide"),InsertShape.clearSelection(),InsertShape.closeToolbar(),InsertShape.showEditorCursor(),ShapeEditor.config.container=J("#inner_shape").css({width:"0",height:"0px"}).empty(),!1;if(("path"==i||r.length>0)&&!InsertShape.isDrawingMode&&s.length){InsertShape.positionScalespan(),J("#inner_shape").css("cursor","");var l=J.ShapeData.getShapeData(s),d=l&&l.dropcapData||!1;(InsertShape.isSelectedShapeADropcap()||d)&&InsertShape.clearSelection(),InsertShape.openToolbar(d),ShapeEditor.config.container=J("#drawcontainer"),PubSub.publish("Gridlines/show"),InsertShape.isDrawingMode=!0,InsertShape.isShapeSelected=!0}},doubleClick:function(){InsertShape.editShape()}}})}(jQuery),function(e){var t=[79,129,189],n=[79,129,189];e.ShapeData={shapes:{},init:function(){this.bindEvents()},bindEvents:function(){var t=this;e(document).bind("shape_created",function(e,n){t.updateShapes(n)})},isTextBox:!1,setThemeColor:function(e,i){t=e,n=i},getThemeColor:function(){return t},getBorderColor:function(){return n},updateShapes:function(e){var t=e.nvOProps.nvDProps.id;this.shapes[t]=e},getShapeData:function(e){return this.getShape(e,this.drawShapeData)},getShape:function(t,n){if(t)return this.shapes[t];var i=n.shapeObjType.toLowerCase(),o="connector"===i,r=e.extend(!0,{},e.ShapeDefault[i]);r.props.transform.pos.zindex=1;var a={type:n.shapeGeoType};a[n.shapeGeoType.toLowerCase()]={type:n.type},r.props.geom=a;var s=this.getDefaultFill(n.theme.bg),l=this.getDefaultStroke(n.theme.br);this.updateDimenstion(r);var d=["RIGHT_BRACE","LEFT_BRACE","DOUBLE_BRACE","RIGHT_BRACKET","LEFT_BRACKET","DOUBLE_BRACKET","ARC"];if(e.inArray(n.type,d)>=0&&(s={type:"NONE"}),r.props.fill=s,r.props.stroke=l,!o){var c=n.theme.txtclr?n.theme.txtclr:[255,255,255];r.textBody=this.getTextBody(o,c)}return n.subType&&this.mergeMarkerData(r,n.subType),r.type=n.shapeObjType,r.editable=!0,r},setBGShape:function(t){if(t){var n=this.COUNTRY_CODE_MAP[t],i=this.getPictFill(n),o=void 0;if(this.shapes[ATTR_SHAPE.BGSHAPE])o=this.shapes[ATTR_SHAPE.BGSHAPE],o.props.fill=i;else{o=e.extend(!0,{},e.ShapeDefault[ATTR_SHAPE.BGSHAPE]),o.type="BGSHAPE";var r=this.getBGShapeContainer();o.props.fill=i,o.props.stroke=this.getDefaultStroke(),o.props.transform.dim={width:r.width(),height:r.height()},o.props.transform.pos={left:0,top:0}}Shape.create.draw(o,this.getBGShapeContainer()),this.shapes[ATTR_SHAPE.BGSHAPE]=o}},updateDimenstion:function(t){t.props.transform.dim=e.extend(!0,{},ShapeEditor.config.shapeDim)},getLocks:function(){return{locks:{noRotation:!0,noResize:!0}}},getTextBody:function(t,n){var i={};t||(i.t="");var o={size:11,fill:this.getDefaultFill(n),stroke:this.getDefaultStroke(),font:{fontFamily:{name:"Arial"}}};i.props=o,i.unmerged={props:e.extend(!0,{},o)};var r=this.updateStyleProps(),a=InsertShape.isTextBox?"TOP":"MIDDLE",s={paras:[{portions:[i],style:r,unmerged:{style:e.extend(!0,{},r)}}],props:{valign:a,inset:{left:10,top:5,right:10,bottom:5},autoFit:{type:"NONE"},wrap:"NONE"}};return s},updateStyleProps:function(){var e=InsertShape.isTextBox?"LEFT":"CENTER";return{halign:e,level:1,margin:{left:0},dir:"LTR",defPrProps:{font:{fontFamily:{name:"Arial"},ref:"MINOR"},fill:{type:"SOLID",solid:{color:{type:"TX1",rgb:{0:0,1:0,2:0}}}},size:18,stroke:{type:"SOLID",width:2.6666667,fill:{type:"SOLID",solid:{color:{type:"A1",tweaks:{shade:.5},rgb:[56,93,138]}}},captype:"FLAT"}},spacing:{line:{type:"PERCENT",percent:"1.2"}}}},getDefaultFill:function(t){var n=e.extend(!0,{},e.ShapeDefault.fill),i={};return null==t?i.type="NONE":(i.type="SOLID",i.solid=n.SOLID,i.solid.color.rgb=t?t:[79,129,189]),i},getPictFill:function(t){var n=(e.extend(!0,{},e.ShapeDefault.fill),{});return n.type="PICT",n.pict={value:{url:t},type:{type:"FRAME"}},n},getDefaultStroke:function(t){var n=(e.extend(!0,{},e.ShapeDefault.stroke),"SOLID");InsertShape.isTextBox&&(n="DASH");var i={type:n,captype:"FLAT",jointype:"ROUND",width:1},o=this.getDefaultFill(t);return i.fill=o,i},setShapeDetails:function(e){if(e){var t=e;ShapeEditor.draw.setDrawingMode(t.shapeGeoType),"CUSTOM"==t.shapeGeoType?ShapeEditor.draw.custom.setCustomData(t.shapeGeoType,t.type):ShapeEditor.draw.preset.setPresetData(t.shapeObjType),t.shapeGeoType=t.shapeGeoType,J.ShapeData.drawShapeData=t}},getShapeContainer:function(){return this.getContainer("shape")},getBGShapeContainer:function(){return this.getContainer("bgshape")},getContainer:function(e){return ShapeEditor.config.container},mergeMarkerData:function(t,n){var i={type:e.ShapeConstants.MarkerType.OPEN,width:e.ShapeConstants.Size.MEDIUM,height:e.ShapeConstants.Size.MEDIUM};if(n&&"1marker"==n){var o={props:{stroke:{tailend:i}}};e.extend(!0,t,o)}else if(n&&"2marker"==n){var r={props:{stroke:{tailend:i,headend:i}}};e.extend(!0,t,r)}},getShapeIds:function(t,n){var i=[];return e.each(this.shapes,function(e,t){i[i.length]=e}),i},props:{fill:{solid:{set:function(t,n){if("transparent"==n.color)return void e.ShapeData.props.fill.none.set(t,n);var i=e.ShapeIntegratorUtil.convertColorToColorArr(n);t.props.fill.type="SOLID",t.props.fill.solid.color.rgb=i,Shape.props.fill.set(t,ShapeEditor.config.container)}},none:{set:function(e,t){e.props.fill.type="NONE",Shape.props.fill.set(e,ShapeEditor.config.container)}}},stroke:{fill:{solid:{set:function(t,n){if("transparent"==n.color)return void e.ShapeData.props.stroke.fill.none.set(t,n);var i=e.ShapeIntegratorUtil.convertColorToColorArr(n);t.props.stroke.fill.type="SOLID",t.props.stroke.fill.solid.color.rgb=i,Shape.props.stroke.fill.set(t,ShapeEditor.config.container)}},none:{set:function(e,t){e.props.stroke.fill.type="NONE",Shape.props.stroke.fill.set(e,ShapeEditor.config.container)}}},width:{set:function(t,n){var i=e(n.menuitem).metadata().appData.value,o=e.ShapeData.getDefaultStroke();"none"==t.props.stroke.fill.type&&(t.props.stroke.fill.type="solid",t.props.stroke.fill.solid.color.rgb=o.fill.solid.color.rgb),t.props.stroke.width=i,Shape.props.stroke.set(t,ShapeEditor.config.container)}},type:{set:function(t,n){var i=e.ShapeData.getDefaultStroke();"none"==t.props.stroke.fill.type&&(t.props.stroke.fill.type="solid",t.props.stroke.fill.solid.color.rgb=i.fill.solid.color.rgb),t.props.stroke.type=e(n.menuitem).metadata().appData.value,Shape.props.stroke.set(t,ShapeEditor.config.container)}}}},set:function(t,n,i){var o=InsertShape.getSelectedShapesArray();e.each(o,function(i,o){var r=o.data,a=t.action,s=e.ShapeIntegratorUtil.getPropValue(e.ShapeData,a);s.set&&s.set(r,n)})}}}(jQuery),InsertShape.shapeCache={},InsertShape.skipMoveCursor=!0,InsertShape.isChangeShape=!1,InsertShape.fontColor=[235,43,51],InsertShape.tobeSkippedCmds=["cut","copy","paste"],InsertShape.oldShapeAttr={},InsertShape.pastedShapes=[],InsertShape.modifiedOnKeys=!1,InsertShape.mergeWithFormats={},InsertShape.groupShapeProps=["wraptype","fliph","flipv","rotateClk","rotateAntiClk"],InsertShape.currentTheme=null,InsertShape.isCtrlKeyPressed=!1,InsertShape.duplicateMode=!1,InsertShape.constant={CONTENT:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur lectus urna, aliquet nec lacinia at, tempus ut sapien. Cras condimentum ante justo, vel luctus felis facilisis ut. Pellentesque dapibus pellentesque diam, lacinia cursus odio rutrum eget.",HEADING:"Lorem ipsum dolor sit amet",DEFAULT_MARGIN_RIGHT_VAL:"0.0625in",OVERLAY_BORDER_WIDTH:12},InsertShape.defaultData={TEXTBOX:'{"nvOProps":{"nvDProps":{"id":""}},"props":{"transform":{"fliph":false,"flipv":false,"dim":{"width":316,"height":117},"pos":{"left":252,"top":146,"zindex":0},"rotate":0},"geom":{"type":"PRESET","preset":{"type":"RECT"}},"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[255,255,255]}}},"stroke":{"type":"DASH","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[0,0,0]}}}}},"themeRef":{"fillRef":{"ref":"THEME","color":{"type":"A1"}},"strokeRef":{"ref":"THEME","color":{"type":"A1","tweaks":{"shade":0.5}}},"fontRef":{"ref":"MINOR","color":{"type":"CUSTOM","rgb":[255,255,255]}}},"textBody":{"paras":[{"portions":[{"t":"","props":{"size":11,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[0,0,0]}}},"stroke":{"type":"DASH","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"NONE"}},"font":{"fontFamily":{"name":"Arial"}}},"unmerged":{"props":{"size":11,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[0,0,0]}}},"stroke":{"type":"DASH","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"NONE"}},"font":{"fontFamily":{"name":"Arial"}}}}}],"style":{"halign":"LEFT","level":1,"margin":{"left":0},"dir":"LTR","defPrProps":{"font":{"fontFamily":{"name":"Arial"},"ref":"MINOR"},"fill":{"type":"SOLID","solid":{"color":{"type":"TX1","rgb":{"0":0,"1":0,"2":0}}}},"size":18,"stroke":{"type":"SOLID","width":2.6666667,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","tweaks":{"shade":0.5},"rgb":[56,93,138]}}},"captype":"FLAT"}},"spacing":{"line":{"type":"PERCENT","percent":"1.2"}},"listStyle":{"bullet":{"type":"NONE","status":"disabled"}}},"unmerged":{"style":{"halign":"LEFT","level":1,"margin":{"left":0},"dir":"LTR","defPrProps":{"font":{"fontFamily":{"name":"Arial"},"ref":"MINOR"},"fill":{"type":"SOLID","solid":{"color":{"type":"TX1","rgb":{"0":0,"1":0,"2":0}}}},"size":18,"stroke":{"type":"SOLID","width":2.6666667,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","tweaks":{"shade":0.5},"rgb":[56,93,138]}}},"captype":"FLAT"}},"spacing":{"line":{"type":"PERCENT","percent":"1.2"}}}},"listNum":false}],"props":{"column":{"num":1,"gap":0},"valign":"TOP","inset":{"left":10,"right":10,"top":5,"bottom":5},"autoFit":{"type":"NONE"},"wrap":"NONE"},"element":"","id":"textcontainer"},"type":"SHAPE","editable":true,"textBox":true,"containerDim":{"width":"1000","height":"1000"}}',SHAPE:'{"nvOProps":{"nvDProps":{"id":""}},"props":{"transform":{"fliph":false,"flipv":false,"dim":{"width":88,"height":76},"pos":{"left":0,"top":0,"zindex":1},"rotate":0},"geom":{"type":"PRESET","preset":{"type":"RECT"}},"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[137,191,74]}}},"stroke":{"type":"SOLID","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"NONE","solid":{"color":{"type":"A1","rgb":[112,154,63]}}}}},"themeRef":{"fillRef":{"ref":"THEME","color":{"type":"A1"}},"strokeRef":{"ref":"THEME","color":{"type":"A1","tweaks":{"shade":0.5}}},"fontRef":{"ref":"MINOR","color":{"type":"CUSTOM","rgb":[255,255,255]}}},"textBody":{"paras":[{"portions":[{"t":"","props":{"size":11,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[255,255,255]}}},"stroke":{"type":"SOLID","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"NONE"}},"font":{"fontFamily":{"name":"Arial"}}},"unmerged":{"props":{"size":18,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[255,255,255]}}},"stroke":{"type":"SOLID","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"NONE"}},"font":{"fontFamily":{"name":"Arial"}}}}}],"style":{"halign":"LEFT","level":1,"margin":{"left":0},"dir":"LTR","defPrProps":{"font":{"fontFamily":{"name":"Arial"},"ref":"MINOR"},"fill":{"type":"SOLID","solid":{"color":{"type":"TX1","rgb":{"0":0,"1":0,"2":0}}}},"size":18,"stroke":{"type":"SOLID","width":2.6666667,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","tweaks":{"shade":0.5},"rgb":[56,93,138]}}},"captype":"FLAT"}},"spacing":{"line":{"type":"PERCENT","percent":"1.2"}},"listStyle":{"bullet":{"type":"NONE","status":"disabled"}}},"unmerged":{"style":{"halign":"LEFT","level":1,"margin":{"left":0},"dir":"LTR","defPrProps":{"font":{"fontFamily":{"name":"Arial"},"ref":"MINOR"},"fill":{"type":"SOLID","solid":{"color":{"type":"TX1","rgb":{"0":0,"1":0,"2":0}}}},"size":18,"stroke":{"type":"SOLID","width":2.6666667,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","tweaks":{"shade":0.5},"rgb":[56,93,138]}}},"captype":"FLAT"}},"spacing":{"line":{"type":"PERCENT","percent":"1.2"}}}},"listNum":false}],"props":{"column":{"num":1,"gap":0},"valign":"MIDDLE","inset":{"left":10,"right":10,"top":5,"bottom":5},"autoFit":{"type":"NONE"},"wrap":"NONE"},"element":"","id":"textcontainer"},"type":"SHAPE","editable":true,"containerDim":{"width":"1000","height":"1000"}}'},InsertShape.clearSelection=function(e,t){try{if(!InsertShape.selectedShape()||InsertShape.tobeSkippedCmds.indexOf(e)!=-1)return;var n=ShapeEditor.config.container;n.is("#drawcontainer")||(ShapeEditor.config.container=Z("drawcontainer")),ShapeEditor.clear(),ShapeEditor.text.isEditable()&&ShapeEditor.text.editor.clear(),ShapeEditor.config.container=n}catch(e){InsertShape.sendErrorMail(e)}},InsertShape.clearBbox=function(){ShapeEditor.bbox.remove(),ShapeEditor.clear()},InsertShape.getShapeFromCache=function(e){return InsertShape.shapeCache[e]},InsertShape.themeColors={red:{bg:[253,108,110],br:[202,84,86]},green:{bg:[137,191,74],br:[112,154,63]},orange:{bg:[248,150,40],br:[202,84,86]},blue:{bg:[164,205,255],br:[65,144,242]},darkred:{bg:[216,119,128],br:[167,104,107]},darkblue:{bg:[62,130,169],br:[28,92,145]},white:{bg:[255,255,255],br:[0,0,0],txtclr:[0,0,0]}},InsertShape.changeShape=function(){InsertShape.isChangeShape=!0},InsertShape.insertShapeMenu=function(){InsertShape.isChangeShape=!1},InsertShape.drawShape=function(e){var t=e[0];if("text"!=t||"text"==t&&editor.doc.getSelection().isCollapsed()){PubSub.publish("Gridlines/show"),InsertShape.updateShapeText(),InsertShape.clearSelection();var n=e[1];"text"==t?(J(".ui-textbox").addClass("ui-state-highlight"),t="RECT",InsertShape.isTextBox=!0,EditorUtil.focusMultiByteSpan(),Utils.addToStatistics("TextBox")):(J(".ui-textbox").removeClass("ui-state-highlight"),InsertShape.isTextBox=!1,Utils.addToStatistics("Shape"));var i={shapeObjType:"SHAPE",shapeGeoType:"PRESET",action:t,type:t,theme:InsertShape.themeColors[n]},o=Z("inner_shape"),r=Z("editorpane-container");"LINE"==t||"ELBOW_CONNECTOR3"==t||"CURVED_CONNECTOR3"==t?(i.subType=e[2],i.theme=InsertShape.themeColors[n],i.shapeObjType="CONNECTOR"):"SCRIBBLE"==t&&(i.shapeGeoType="CUSTOM",i.shapeObjType="SHAPE"),J.ShapeData.setShapeDetails(i),InsertShape.isDrawingMode=!0,ShapeEditor.config.container=o,o.css({width:r.width(),height:r.height(),"z-index":"1000",display:"block",cursor:"crosshair"})}else{var a=InsertShape.getDefaultShapeData("TEXTBOX");InsertShape.updateTransformPropWithOverlayOffset(a),InsertShape.pushSelectedTextToShape(a),a.wrapType="square",a[ATTR_IMAGE.I_MR]=a[ATTR_IMAGE.I_MT]=a[ATTR_IMAGE.I_ML]=a[ATTR_IMAGE.I_MB]=InsertShape.constant.DEFAULT_MARGIN_RIGHT_VAL,InsertShape.insertShape(a),InsertShape.select.shape(a)}},InsertShape.getCopyHTML=function(){var e="";if(ShapeEditor.text.isEditable()){var t=ShapeEditor.text.editor.selectedText();if(!t)return;e="<span>"+t+"</span>"}else e=InsertShape.getSelectedShapesHTML();return e},InsertShape.getSelectedShapesHTML=function(){var e="";document.getElementById("_zohoPaste"),editor.doc.getPaperWidth();if(InsertShape.selectedShape()){var t=editor.doc.getSelection();t.getLastRange();return InsertShape.updateShapeText(null,!0),InsertShape.getSelectedShapesArray().forEach(function(t){var n=t.data.nvOProps.nvDProps.id,i=(J("#"+n).parents("div.zw-paragraph")[0],InsertShape.getShapeNodeData(n).shapenode);if(null!=i){var o=i.getStart(),r=editor.doc.createRange(o,o+1);e+=HTMLUtil.getHTML(r)}}),e}},InsertShape.createShapeDiv=function(e){var t=document.createElement("div"),n=document.createElement("span"),i=new Date,o="zshape_"+i.getMilliseconds(),r=InsertShape.getShapeFromFloatImages(e.paraProperties)[0];if(r){var a={};a.class="inner_shape",a.context="Rmenu",a.id=o,a.fid=r.fid,a.pid=r.parentId;var s={};s.position="absolute",s.top="0",s.left="0",s[ATTR_SHAPE.ZINDEX]="5",J(t).attr(a).css(s);var l=J(n);return l.attr("class","shapeAnchor ui-components-toolbar-icon ui-icon-zinsertanchor"),l.css("display","none"),J(t).append(n),t}},InsertShape.getRGBVal=function(e){return e.replace("rgb(","").replace(")","").split(",")},InsertShape.getShapeIdx=function(e){var t="string"==typeof e?e:e.parentIds&&e.parentIds[0]||(e.data||e).nvOProps.nvDProps.id,n=InsertShape.getShapeNodeData(t),i=n.index;return i},InsertShape.getShapeNodeData=function(e){for(var t={},n=InsertShape.getShapesInPara(e),i=n.length,o=null,r=-1,a={},s={},l=0;l<i;l++){var d=n[l].getStart(),a=DocUtil.copyStyle(editor.doc.getRawFormatAt(d)),c=a[ATTR_IMAGE.I_SHAPEDATA];if(c){var u=c.nvOProps.nvDProps.id;if(u==e){o=n[l],r=d,s=c;break}}}return t.shapenode=o,t.index=r,t.shapedata=s,t.format=a,t},InsertShape.init=function(){var e=J("#drawcontainer");e.bind("keydown",function(e){if(!ShapeEditor.text.isEditable()&&(37==e.keyCode||38==e.keyCode||39==e.keyCode||40==e.keyCode)){var t=InsertShape.getSelectedShapesArray();if(t.length>0){PubSub.publish("Gridlines/show");for(var n=0;n<t.length;n++)for(var i=t[n].data.nvOProps.nvDProps.id,o=0;o<t.length;o++)i==t[o].data.nvOProps.nvDProps.id&&(ShapeEditor.select.shapes[o].data.props.transform=J.ShapeData.getShapeData(i).props.transform,InsertShape.modifiedOnKeys=!0)}}}),e.on("mouseup",".bbox path",function(e){InsertShape.handleMouseEvents(e,e.type)}),J(document).zshapeintegrator({container:e}).zshapeintegrator("draw",[],e),J("#drawcontainer")[0].onselectstart=function(){return!0},ShapeEvent.IMESupport=!0,InsertShape.addSubscribers(),InsertShape.currentTheme=InsertShape.themeColors.blue},InsertShape.addSubscribers=function(){PubSub.subscribe("Document/FirstTimeComponentReady",InsertShape.lazyInitialisation),PubSub.subscribe("Document/AfterInit",InsertShape.shapeBindEvents),PubSub.subscribe("Document/EditPermissionChanged",InsertShape.handleEditorPermissionChanged),PubSub.subscribe("DocOperation/AfterPaste",InsertShape.processAfterPaste),PubSub.subscribe("Document/ViewChanged",InsertShape.clearCache),PubSub.subscribe(["Document/Resize","Document/Zoom"],InsertShape.editorResizeHandler),PubSub.subscribe("Cursor/Selected",InsertShape.selectShapesInRange)},InsertShape.lazyInitialisation=function(){J.ui.utils.initComponents(J("#shadowpresetmenu")),J.ui.utils.initComponents(J("#reflectionpresetmenu")),J.ui.utils.initComponents(J("#shapeopacitymenu")),J.ui.utils.initComponents(J("#strokewidthmenu")),J.ui.utils.initComponents(J("#strokestylemenu")),J.ui.utils.initComponents(J("#shapewraptypesmenu")),J.ui.utils.initComponents(J("#shapetextValign")),J.ui.utils.initComponents(J("#shapeParaAlign")),J.ui.utils.initComponents(J("#dropcap-panel")),COMPONENTS_INIT_DONE.push("shadowpresetmenu"),COMPONENTS_INIT_DONE.push("reflectionpresetmenu"),COMPONENTS_INIT_DONE.push("shapeopacitymenu"),COMPONENTS_INIT_DONE.push("strokewidthmenu"),COMPONENTS_INIT_DONE.push("strokestylemenu"),COMPONENTS_INIT_DONE.push("shapewraptypesmenu"),COMPONENTS_INIT_DONE.push("shapetextValign"),COMPONENTS_INIT_DONE.push("shapeParaAlign"),COMPONENTS_INIT_DONE.push("dropcap-panel")},InsertShape.editorResizeHandler=function(){InsertShape.updateShapeText(),InsertShape.clearSelection(),InsertShape.closeToolbar()},InsertShape.shapeBindEvents=function(){if(editor.isEditable()){J("#drawcontainer").on("mousedown",".shape_box.bbox",function(){J(this).attr("context","Rmenu")}),InsertShape.handleEditorPermissionChanged(!0);var e=J("#drawcontainer");e.bind("keydown",function(e){e.keyCode==KEYS.ESC&&(InsertShape.updateShapeText(),InsertShape.closeToolbar(),InsertShape.showEditorCursor(),EditorUtil.focusMultiByteSpan())}),e.bind("shape_selected",function(e,t){var n=InsertShape.selectedShape();1==InsertShape.getSelectedShapesArray().length&&InsertShape.moveCursorIdx(n),n&&!n.data.dropcapData&&InsertShape.updateToolbar()}),e.bind("mouseup",function(e,t){"svg"!=e.target.nodeName&&"path"!=e.target.nodeName&&(InsertShape.isDrawingMode=!1)}),e.bind("modified",function(e,t){var n=0,i=[],o=[];t.shapeData.forEach(function(e){var t=e.id;delete InsertShape.shapeCache[t];var r=JSON.stringify(J.ShapeData.getShapeData(t)),a=JSON.parse(r),s=JSON.parse(r),l=e.data.data.props;if(l){var d=l.transform;!InsertShape.modifiedOnKeys&&d?(d.dim.height/=editor.zoomFactor,d.dim.width/=editor.zoomFactor,d.pos.top/=editor.zoomFactor):PubSub.publish("Gridlines/hide");var c=InsertShape.getShapeDom(t);if(c){var u=c.parents("div.zw-paragraph")[0],p=InsertShape.getShapeNodeData(t),h=p.shapenode;if(null!=h){if(d){var f=p.index,m=editor.doc.getParents(NODE_TYPE.PARAGRAPH,f),g=null;if(s.lockAnchor)g=m;else if(d){var T=InsertShape.getParaToShapeTop(d.pos,!0);g=s.lockAnchor?m:DocUtil.getDocElement(T)}var _=PUtil.offset(u),E=d,v=s.props.transform;if(E.pos){if(E.pos.zindex=v.pos.zindex,v.pos=E.pos,g.getStart()!=m.getStart()&&(u=ViewManager.getViews(g.dtNode)[0].el,_=PUtil.offset(u)),E.dim&&(v.dim=E.dim),void 0!=E.rotate&&(v.rotate=E.rotate),!InsertShape.modifiedOnKeys){var S=s.props.transform.pos.top-_.top,b=(PUtil.offset(u).left-editor.jeditorPane.offset().left)*editor.zoomFactor,R=editor.jeditorPane.offset().left-Z("ui-editor-outer-div").offset().left,O=(d.pos.left-(R+b))/editor.zoomFactor;s.props.transform.pos.top=S,s.props.transform.pos.left=O,JSON.stringify(s.props.transform.dim)==JSON.stringify(a.props.transform.dim)&&s.props.transform.rotate==a.props.transform.rotate||(InsertShape.duplicateMode=!1)}E.fliph?v.fliph=E.fliph:"CONNECTOR"==s.type&&(v.fliph=!1),E.flipv?v.flipv=E.flipv:"CONNECTOR"==s.type&&(v.flipv=!1)}if(InsertShape.isTextModified){var D=InsertShape.selectedShape().data.textBody;s.textBody=D,InsertShape.isTextModified=null}if(s.dropcapData){"MARGIN"==s.dropcapData.type&&InsertShape.updateDropcapPosition(s,"MARGIN",!0);var y=s.textBody.paras[0].portions[0],A=s.props.transform.dim.height,C="normal"==s.dropcapData.style?3.6*A/4:A/2;y.props.size=C,y.unmerged&&(y.unmerged.props.size=C),s.props.transform.rotate=0,InsertShape.duplicateMode=!1}}if(l.geom&&(s.props.geom=l.geom,InsertShape.duplicateMode=!1),InsertShape.oldShapeAttr=p.format,g&&g.getStart()!=m.getStart()){if(o.length&&(InsertShape.applyStyle(o,!1),o=[]),InsertShape.duplicateMode)InsertShape.applyStyle(a,!1),InsertShape.moveCursorIdx(g.getStart()),InsertShape.renewShape(s),InsertShape.insertShape(s);else{InsertShape.removeFromCache(t);var I=editor.doc.createRange(f,f+1);editor.doc.getSelection().removeAllRanges().addRange(I).deleteSelectedContents(null,!0),InsertShape.moveCursorIdx(g.getStart()),InsertShape.insertShape(s)}i.push(s),InsertShape.openToolbar(),InsertShape.oldShapeAttr={}}else InsertShape.duplicateMode?(o.push(a),o.length&&(InsertShape.applyStyle(o,!1),o=[]),InsertShape.moveCursorIdx(m.getStart()),InsertShape.renewShape(s),InsertShape.insertShape(s)):o.push(s),i.push(s)}n++}}}),o.length&&(InsertShape.applyStyle(o,!1),o=[]),InsertShape.modifiedOnKeys=!1,InsertShape.select.shape(i),InsertShape.openToolbar(i[0].dropcapData||!1),J("#inner_shape").css({width:"0",height:"0px"})}),e.bind("text_modified",function(e,t){InsertShape.textBoxData||(InsertShape.isTextModified=t.textData[0].shapeData.id)}),e.bind("shape_created",function(e,t){InsertShape.isTextBox&&(t.textBox=!0),J(".ui-textbox").removeClass("ui-state-highlight"),t[ATTR_IMAGE.I_MR]=t[ATTR_IMAGE.I_MT]=t[ATTR_IMAGE.I_ML]=t[ATTR_IMAGE.I_MB]=InsertShape.constant.DEFAULT_MARGIN_RIGHT_VAL,InsertShape.processShape(t),PubSub.publish("Gridlines/hide")})}},InsertShape.processShape=function(e){e.data&&(e=e.data);var t=InsertShape.getParaToShapeTop(e.props.transform.pos,!0),n=DocUtil.getDocElement(t);InsertShape.moveCursorIdx(n.getStart());var i=InsertShape.getOffsetonDomPara(t,e),o=e.nvOProps.nvDProps.id;e.props.transform.pos.top=i.top,e.props.transform.pos.left=i.left,e.textBody&&(e.textBody.element=""),J("#"+o).remove(),ShapeEditor.bbox.shape={bbox:{},handles:{crop:[],shape:[]}},ShapeEditor.clear(),e.props.transform.pos.zindex=InsertShape.getZindex(),e.containerDim={width:"1000",height:"1000"},InsertShape.isShapeSelected=!0,InsertShape.insertShape(e),editor.editorPaneContainer.css("cursor",""),InsertShape.openToolbar(J.ShapeData.getShapeData(o).dropcapData),InsertShape.select.shape(o),e.textBox&&InsertShape.editShape()},InsertShape.isPlaceHolderNeeded,InsertShape.placeHolderText,InsertShape.insertShape=function(e){e.data&&(e=e.data);var t={};t[ATTR_COMMON.TYPE]="image",t[ATTR_IMAGE.I_WID]="0px",t[ATTR_IMAGE.I_HT]="0px",t[ATTR_IMAGE.I_AL]="front",InsertShape.mergeWithFormat&&(J.extend(!0,t,InsertShape.mergeWithFormat),InsertShape.mergeWithFormat=null),InsertShape.isPlaceHolderNeeded&&(e.nvOProps.nvProps={placeHolder:{type:"TITLE",relId:Math.uuid()}},e.placeHolder={text:InsertShape.placeHolderText,doNotUpdate:!1}),InsertShape.oldShapeAttr.al&&(t[ATTR_IMAGE.I_AL]=InsertShape.oldShapeAttr.al),InsertShape.oldShapeAttr.mminfos&&(t.mminfos=InsertShape.oldShapeAttr.mminfos),InsertShape.oldShapeAttr.ff&&(t.ff=InsertShape.oldShapeAttr.ff),t[ATTR_IMAGE.I_SHAPEDATA]=e,e.wrapType&&(t[ATTR_IMAGE.I_AL]=e.wrapType),J("#inner_shape").css({width:"0",height:"0px"}),editor.doc.execCmd("insimg",t),editor.jeditorPane.children(".zw-page").css("cursor","")},InsertShape.getOffsetonDomPara=function(e,t){t.props.transform.dim.height/=editor.zoomFactor,t.props.transform.dim.width/=editor.zoomFactor,t.props.transform.pos.top/=editor.zoomFactor;var n=J(editor.doc.getCursorPortionNode(editor.uuid,"start")).parents("div.zw-paragraph")[0],i=PUtil.offset(n),o=editor.doc.getSelection().getStart(),r=editor.jeditorPane.offset().left-Z("ui-editor-outer-div").offset().left,a=t.props.transform.pos.top-i.top,s=(t.props.transform.pos.left-(r+(PUtil.offset(n).left-editor.jeditorPane.offset().left)*editor.zoomFactor))/editor.zoomFactor;t.props.transform.pos.top=a,t.props.transform.pos.left=s;var l=editor.doc.getDomCursorNode(editor.uuid,"start");l.css("border-left-style","");for(var d=editor.doc.getRawFormatAt(o);d&&d.hasOwnProperty("shapeData");)o++,d=editor.doc.getRawFormatAt(o);var c=editor.doc.getSelection().getLastRange();return c&&c.setStart(o)&&c.setEnd(o),t.props.transform.pos},InsertShape.handleMouseEvents=function(e,t){if("mouseup"==t&&InsertShape.isDrawingMode)return PubSub.publish("Gridlines/hide"),InsertShape.isDragMode=!1,InsertShape.isDrawingMode=!1,InsertShape.isShapeSelected=!0,InsertShape.skipMoveCursor?InsertShape.skipMoveCursor=!1:InsertShape.hideEditorCursor(),!0;var n=J(e.target),i=InsertShape.selectedShape(),o=n.parents(".unselectableSection").length>0,r=n.parents(".inner_shape ").length>0;if(i){if("mousemove"==t){var a=InsertShape.getSelectedShapesArray();return J.each(a,function(e,t){J("#clonebox_"+t.data.nvOProps.nvDProps.id).addClass("zw-shape-clone-box")}),!0}if("mouseup"==t)return!0}if(o&&("mouseup"==t||"mousedown"==t))return InsertShape.isShapeSelected=!1,!1;if(r&&o?ShapeEditor.config.isSlideLocked=function(){return!0}:ShapeEditor.config.isSlideLocked=function(){return!1},"mousedown"==t&&r&&o)return!1;if("path"==n.prop("tagName")||r>0||"inner_shape"==n.attr("id"))return!0;if("mousedown"==t&&"path"!=n.prop("tagName")&&0!=n.parents("#inner_shape").length)return!0;if(InsertShape.isDrawingMode){if("mousedown"==t){EventHandler.moveCursor(e,0,0);var s=editor.doc.getDomCursorNode(editor.uuid,"start");s.css("border-left-style","")}return InsertShape.isTextBox&&J("#inner_shape").css("cursor",""),J(editor.clientActiveSection).css({"-moz-user-select":"none"}),editor.editorPaneContainer.css("cursor","crosshair"),!0}return J(editor.clientActiveSection).css({"-moz-user-select":""}),editor.editorPaneContainer.css("cursor",""),"mousedown"!=t||"path"==n.prop("tagName")||r?void 0:(InsertShape.isShapeSelected=!1,!1)},InsertShape.processParaFormat=function(e){for(var t=e[0],n=e[1]||"",i=[],o={at:"update",ut:"para",si:0,ei:0,value:{value:{}}},r=InsertShape.getSelectedShapesArray(),a=r.length,s=a>1,l=0;l<a;l++){var d=r[l];if(a>1&&(InsertShape.clearBbox(),InsertShape.select.shape(d),InsertShape.editShape(-1)),"Align"==t)"Left"==n?o.value.value={halign:"LEFT"}:"Right"==n?o.value.value={halign:"RIGHT"}:"Center"==n&&(o.value.value={halign:"CENTER"});else if("SetLineSpacing"==t){var c={line:{percent:n,type:"PERCENT"}};o.value.value={spacing:c}}else if(t.indexOf("dent")>-1){var u=ShapeEditor.text.editor._getFromTo(),p=u.from.num.para;p||(InsertShape.editShape(-1),p=ShapeEditor.text.editor._getFromTo().from.num.para);var h=InsertShape.selectedShape().data.textBody.paras[p].style,f=h.level;f?"indent"==t?(f+=1,o.value.value.margin={left:h.margin.left+10}):(f=f<0?0:f-1,o.value.value.margin={left:h.margin.left<0?0:h.margin.left-10}):(o.value.value.level=1,o.value.value.margin={left:0})}var m=ShapeEditor.text.editor.cursor.getIndex();m.si&&(o.si=m.si),m.ei&&(o.ei=m.ei),i.push(o),ShapeEditor.text.editor.changeStyle(i),InsertShape.applyStyle(InsertShape.selectedShape(),!0),s||(d.parentIds[0]?InsertShape.select.shape(d.parentIds[0]):(InsertShape.select.shape(d.data.nvOProps.nvDProps.id),InsertShape.editShape(m.si,m.ei)))}s&&InsertShape.select.shape(r)},InsertShape.processTxtFormat=function(e){for(var t={ut:"portion",value:{}},n=e[0],i=e[1]||"",o="",r="",a=ShapeEditor.text.getObject().from,s=InsertShape.getSelectedShapesArray(),l=s.length>1,d=0;d<s.length;d++){var c=s[d];if(l){a.para=void 0,InsertShape.clearBbox();var u=c.data.nvOProps.nvDProps.id;InsertShape.select.shape(u)}(void 0==a.para||c.data.dropcapData)&&(InsertShape.editShape(-1),a=ShapeEditor.text.getObject().from);var p=(c.data.nvOProps.nvDProps.id,c.data.textBody.paras[a.para].portions[a.portion].props);if("bold"==n){var h=p.bold;o="bold",r=!h,UIUtils.uiShapePortionStyles.zbutton(r?"check":"uncheck","#shpBold")}else if("italic"==n){var f=p.italic;o="italic",r=!f,UIUtils.uiShapePortionStyles.zbutton(r?"check":"uncheck","#shpItalic")}else if("underline"==n){var m=p.underline;m="SINGLE"==m?"NONE":"SINGLE",o="underline",r=m,UIUtils.uiShapePortionStyles.zbutton("NONE"!=r?"check":"uncheck","#shpStrikethrough")}else if("forecolor"==n){var g="selectedColor"==i?InsertShape.fontColor:i;InsertShape.fontColor=g;var t={ut:"portion",value:{fill:{type:"SOLID",solid:{color:{rgb:g}}}}};ShapeEditor.text.editor.changeProperty(t)}else if("fontsize"==n){if("number"!=typeof i){p.size;"increasefontsize"==i?i=DocUtil.getNextFontSize(parseInt(p.size)):"decreasefontsize"==i&&(i=DocUtil.getPrevFontSize(parseInt(p.size)))}o="size",r=i,c.data.dropcapData?Z("dropcap-fontsize").zcombo("setValue",i):Z("shape_fontSize").zcombo("setValue",i)}else if("fontname"==n){o="font";var T=i.split(",")[0];r={fontFamily:{name:T}},Z("shapepanel-fontFamily").zfontcombo("setValue",i),InsertShape.mergeWithFormats.ff=[T]}else"strikethrough"==n?(o="strike",r="SINGLE"==p.strike?"NONE":"SINGLE",UIUtils.uiShapePortionStyles.zbutton("NONE"!=r?"check":"uncheck","#shpUnderline")):"superscript"==n?(o="baseline",r=.3==p.baseline?0:.3):"subscript"==n&&(o="baseline",r=p.baseline==-.25?0:-.25);t.value[o]=r,ShapeEditor.text.editor.changeProperty(t);var _=ShapeEditor.text.editor._getFromTo().from.num.index,E=ShapeEditor.text.editor._getFromTo().to.num.index;InsertShape.applyStyle(InsertShape.selectedShape(),!0),l||(c.parentIds[0]?InsertShape.select.shape(c.parentIds[0]):(InsertShape.select.shape(c.data.nvOProps.nvDProps.id),InsertShape.editShape(_,E)))}l&&InsertShape.select.shape(s)},InsertShape.drawShapeInPara=function(e,t){var n=J(e),i=n.find("div.inner_shape");if(i&&0!=editor.visiblePageNumbers.length){i.css("display","none");var o=J(document.createElement("div"));t.forEach(function(e){try{var t=e[ATTR_IMAGE.I_SHAPEDATA],n=InsertShape.getShapeFromCache(t.nvOProps.nvDProps.id);if(n&&n[0].fitModeData&&delete n[0].fitModeData,t.fitModeData&&delete t.fitModeData,n&&n[0]==JSON.stringify(t)){var i=n[1],r=J(i).clone(!0);return void o.append(r)}var a=[],s=InsertShape.getShapeFrameProp(t);t.fitModeData=s,J.ShapeData.updateShapes(J.extend(!0,{},t)),t.textBody&&(t.textBody.element=""),is_wkhtmltopdf_browser&&t.props.stroke&&0==t.props.stroke.width&&(t.props.stroke.fill={type:"NONE"});try{var l=void 0,d=t.shapes;d?(J.each(d,function(e,n){n.fitModeData=InsertShape.getShapeFrameProp(n,t.nvOProps.nvDProps.id),d[e]=n}),l=J.GroupShape.create.draw(t,o)):l=Shape.create.draw(t,o);var r=l.clone(!0);if(delete t.fitModeData,t.props.fill&&"PICT"==t.props.fill.type){var c=document.createElement("img"),u={shapeid:t.nvOProps.nvDProps.id,data:t,cache:function(){var e=InsertShape.shapeCache[this.shapeid];e||(e=[]),this.data.textBody&&(this.data.textBody.element=""),e[0]=JSON.stringify(this.data),e[1]=J("#"+this.shapeid).clone(!0),InsertShape.shapeCache[this.shapeid]=e}};J(c).load(u.cache.bind(u)),c.setAttribute("src",t.props.fill.pict.value.serverUrl)}else a.push(JSON.stringify(t)),a.push(r),InsertShape.shapeCache[t.nvOProps.nvDProps.id]=a}catch(e){}}catch(e){}}),J(o).children().length&&i.append(o).css("display","block")}},InsertShape.getShapeParaDOMNode=function(e){var t=null,n=editor.clientActiveSection.className;return n.indexOf("header")||n.indexOf("footer")?J(editor.clientActiveSection).find("#"+e).length>0&&(t=J(editor.clientActiveSection).find("#"+e).parents("div.zw-paragraph")[0]):t=J("#"+e).parents("div.zw-paragraph")[0],t},InsertShape.modifyShapeProperty=function(e,t){var n=e[0],i=e[1];Utils.addToStatistics("ShapeStyle_"+n);var o=t.nvOProps.nvDProps.id,r=t.props;if("borderstyle"==n)"NONE"==i?r.stroke.width=0:(0==r.stroke.width&&(r.stroke.width=2),r.stroke.type=i);else if("fillcolor"==n){var a={type:"NONE"};"NONE"!=i&&"transparent"!=i&&(a={type:"SOLID",solid:{color:{type:"A1",rgb:i}}}),r.fill=a}else if("strokecolor"==n){0==r.stroke.width&&(r.stroke.width=2);var a={type:"NONE"};"NONE"!=i&&"transparent"!=i&&(a={type:"SOLID",solid:{color:{type:"A1",rgb:i}}}),r.stroke.fill=a}else if("opacity"==n){var a=("CONNECTOR"==t.type?t.props.stroke.fill:t.props.fill)||{type:"NONE"};"NONE"!=a.type&&"PICT"!=a.type&&(a.solid.color.tweaks={alpha:i})}else if("borderwidth"==n)r.stroke.width=parseInt(i);else if("shadow"==n)if("NONE"!=i){var s={type:"OUTER",color:{type:"CUSTOM",rgb:[91,91,91],tweaks:{alpha:.6}},distance:{radius:10,angle:i},preset:"PRESET1",blur:{radius:4}};r.effects?r.effects.shadow=s:r.effects={shadow:s}}else delete r.effects.shadow;else if("reflection"==n)if("NONE"!=i){var l={distance:{radius:i[0]},pos:{end:i[1]},alpha:{st:i[2]},preset:i[3]};r.effects?r.effects.reflection=l:r.effects={reflection:l}}else delete r.effects.reflection;else if("changeshape"==n&&"SHAPE"==t.type)r.geom.preset.type=i,InsertShape.isChangeShape=!1;else if("resetshapeproperty"==n)t.textboxTemplate?t=TextBoxTemplates[t.textboxTemplate]:(r.effects={},r.effects.reflection={},r.stroke.width=1,r.stroke.type="SOLID",r.stroke.fill={type:"SOLID",solid:{color:{type:"A1",rgb:InsertShape.currentTheme.br}}},r.fill={type:"SOLID",solid:{color:{type:"A1",rgb:InsertShape.currentTheme.bg}}},r.transform.rotate=0);else if("fillimage"==n&&"SHAPE"==t.type){var d=/(ht|f)(tp|tps):\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s\/]{2,}|www\.[^\s]+\.[^\s\/]{2,}/,c=i[0],u=c.match(d),p=u?c:editor.getBaseURL()+"/"+i[0],h=i[1],f=i[2],m='{"type":"PICT","pict":{"type":{"type":"FRAME"},"value":{"id":"'+o+'","type":"USERDEFINED","pictureName":"Image'+o+'.jpg","serverUrl":"'+p+'","url":"'+p+'","dim":{"width": '+h+',"height": '+f+'},"width":  '+h+' ,"height": '+f+"}}}";m=JSON.parse(m),r.fill=m,InsertShape.isShapeImage=!1}else"txtalign"==n&&t.textBody?t.textBody.props.valign=i[0]:"wraptype"==n?t.wrapType=i:"rotateClk"==n?r.transform.rotate+=90:"rotateAntiClk"==n?r.transform.rotate-=90:"fliph"==n?r.transform.fliph=!r.transform.fliph:"flipv"==n?r.transform.flipv=!r.transform.flipv:"resetRotation"==n&&(r.transform.rotate=0);return t},InsertShape.changeShapeProperty=function(e){var t=InsertShape.getSelectedShapesArray();InsertShape.updateShapeText(),ShapeEditor.clear();var n=[];J.each(t,function(i,o){var r=o.data,a=o.parentIds[0];if(o.parentIds&&a){var s=J.ShapeData.getShapeData(a),l=s.shapes;l.forEach(function(t){if(t.nvOProps.nvDProps.id==r.nvOProps.nvDProps.id){var n=t;InsertShape.modifyShapeProperty(e,n)}}),r=s,t=[a]}else if("GROUPSHAPE"==r.type){var d=TextBoxTemplates[r.textboxTemplate];if(InsertShape.groupShapeProps.indexOf(e[0])!=-1)InsertShape.modifyShapeProperty(e,r);else{var l=r.shapes;J.each(l,function(t,n){if("resetshapeproperty"==e[0]&&r.textboxTemplate){var i=d.shapes[t];n.props.fill=i.props.fill,n.props.stroke=i.props.stroke}else InsertShape.modifyShapeProperty(e,n)})}}else if("resetshapeproperty"==e[0]&&r.textboxTemplate){var d=TextBoxTemplates[r.textboxTemplate];r.props.fill=d.props.fill,r.props.stroke=d.props.stroke}else InsertShape.modifyShapeProperty(e,r);n.push(r)}),InsertShape.applyStyle(n,!0),InsertShape.select.shape(t)},InsertShape.applyStyle=function(e,t){try{e.length||(e=[e]);for(var n=[],i=[],o=0;o<e.length;o++){var r=e[o],a=r.data||r,s=a.nvOProps.nvDProps.id;if(r.data&&r.parentIds[0]){for(var l=r.parentIds[0],d=J.ShapeData.getShapeData(l),c=d.shapes,o=0;o<c.length;o++){var u=c[o];if(u.nvOProps.nvDProps.id==s){c[o].textBody=InsertShape.selectedShape().data.textBody,c[o].textBody.element="";break}}a=d,s=l}var p=InsertShape.getShapeNodeData(s),h=p.shapenode,f=p.index;if(t){var f=p.index,m=editor.doc.getRawFormatAt(f).shapeData,g=a.props.transform.pos;g.top=m.props.transform.pos.top,g.left=m.props.transform.pos.left,a.props.transform.dim.height/=editor.zoomFactor,a.props.transform.dim.width/=editor.zoomFactor}a.textBody&&(a.textBody.element="");var T={};T[ATTR_COMMON.TYPE]="image",T[ATTR_IMAGE.I_SHAPEDATA]=a;try{if(InsertShape.mergeWithFormats){var _=p.format;U.each(InsertShape.mergeWithFormats,function(e,t){if(_[t]){var n=_[t];"object"==typeof n?(void 0!=n.length?n=n.concat(InsertShape.mergeWithFormats[t]):J.extend(!0,n,InsertShape.mergeWithFormats[t]),T[t]=n):T[t]=e}else T[t]=e})}}catch(e){InsertShape.mergeWithFormats={}}n.push(h),i.push(T)}InsertShape.mergeWithFormats={},InsertShape.isTextModified=null,editor.doc.execCmd("applyStyle",[n,i,"applyShapeFormat"])}catch(e){InsertShape.sendErrorMail(e)}},InsertShape.generateShapeMenu=function(e){var t=InsertShape.getDefaultShapeData("SHAPE"),n=["ARC","DOUBLE_BRACKET","DOUBLE_BRACE","LEFT_BRACKET","RIGHT_BRACKET","LEFT_BRACE","RIGHT_BRACE"],i=["RECTANGULAR_CALLOUT","ROUNDED_RECTANGULAR_CALLOUT","OVAL_CALLOUT","CLOUD_CALLOUT"],o={type:"SOLID",solid:{color:{type:"A1",rgb:[180,180,180]}}},r={type:"SOLID",captype:"FLAT",jointype:"ROUND",width:1.5,fill:{type:"SOLID",solid:{color:{type:"A1",rgb:[120,120,120]}}}},a={CURVE:{type:"CURVE",pathList:[{path:[{m:{x:33,y:15},type:"M"},{cc:[{x:33.1875,y:10.9375},{x:33.375,y:6.875},{x:32,y:5}],type:"CC"},{cc:[{x:30.625,y:3.125},{x:25.75,y:-.125},{x:22,y:0}],type:"CC"},{cc:[{x:20.25,y:.125},{x:12.28125,y:1.515625},{x:10,y:6}],type:"CC"},{cc:[{x:9.71875,y:10.484375},{x:12.21484375,y:32.185546875},{x:10,y:36}],type:"CC"},{cc:[{x:9.78515625,y:39.814453125},{x:4.892578125,y:40.4072265625},{x:0,y:41}],type:"CC"}],height:41,width:33}]},FREEFORM:{type:"FREEFORM",pathList:[{width:134.68661,height:91.70152,path:[{type:"M",m:{x:45.850815,y:1.4328609}},{type:"L",l:{x:116.05974,y:0}},{type:"L",l:{x:116.05974,y:20.059738}},{type:"L",l:{x:116.05974,y:20.059738}},{type:"CC",cc:[{x:112.238846,y:21.492598},{x:108.09627,y:22.258686},{x:104.59706,y:24.358215}]},{type:"CC",cc:[{x:103.12042,y:25.244198},{x:102.8338,y:27.333858},{x:101.73134,y:28.6568}]},{type:"CC",cc:[{x:100.43411,y:30.213438},{x:98.86572,y:31.522415},{x:97.43286,y:32.955276}]},{type:"CC",cc:[{x:96.14383,y:36.822258},{x:94.63412,y:38.786983},{x:97.43286,y:42.985092}]},{type:"CC",cc:[{x:98.38803,y:44.417953},{x:100.29848,y:44.89554},{x:101.73134,y:45.850815}]},{type:"CC",cc:[{x:102.686615,y:47.283676},{x:103.136795,y:49.23664},{x:104.59706,y:50.149292}]},{type:"CC",cc:[{x:107.15852,y:51.750237},{x:110.3284,y:52.05974},{x:113.194016,y:53.014908}]},{type:"CC",cc:[{x:122.92987,y:56.260155},{x:115.98195,y:54.44777},{x:134.68661,y:54.44777}]},{type:"L",l:{x:134.68661,y:78.805984}},{type:"L",l:{x:127.522415,y:90.26866}},{type:"L",l:{x:0,y:91.70152}},{type:"L",l:{x:0,y:34.388138}},{type:"L",l:{x:45.850815,y:1.4328609}},{type:"C",c:!0}]}]},SCRIBBLE:{type:"SCRIBBLE",pathList:[{width:180.51282,height:182.5641,path:[{type:"M",m:{x:143.58974,y:0}},{type:"L",l:{x:146.32478,y:0}},{type:"CC",cc:[{x:143.58974,y:0},{x:143.58974,y:0},{x:141.53847,y:0}]},{type:"CC",cc:[{x:137.4359,y:0},{x:135.38461,y:0},{x:133.33333,y:0}]},{type:"CC",cc:[{x:131.28206,y:0},{x:127.17949,y:0},{x:121.02564,y:0}]},{type:"CC",cc:[{x:118.97436,y:0},{x:116.92308,y:0},{x:114.871796,y:0}]},{type:"CC",cc:[{x:104.61539,y:0},{x:90.25641,y:0},{x:86.15385,y:0}]},{type:"CC",cc:[{x:84.10256,y:0},{x:82.051285,y:0},{x:80,y:0}]},{type:"CC",cc:[{x:77.948715,y:0},{x:69.74359,y:0},{x:61.53846,y:0}]},{type:"CC",cc:[{x:59.48718,y:0},{x:57.435898,y:0},{x:53.333332,y:0}]},{type:"CC",cc:[{x:43.076923,y:0},{x:38.974358,y:0},{x:38.974358,y:2.0512822}]},{type:"CC",cc:[{x:36.923077,y:2.0512822},{x:34.871796,y:2.0512822},{x:32.820515,y:2.0512822}]},{type:"CC",cc:[{x:30.76923,y:2.0512822},{x:28.717949,y:2.0512822},{x:28.717949,y:4.1025643}]},{type:"CC",cc:[{x:26.666666,y:4.1025643},{x:22.564102,y:6.1538463},{x:18.461538,y:10.256411}]},{type:"CC",cc:[{x:16.410257,y:10.256411},{x:16.410257,y:12.307693},{x:14.358974,y:12.307693}]},{type:"CC",cc:[{x:14.358974,y:14.358974},{x:12.307693,y:16.410257},{x:10.256411,y:16.410257}]},{type:"CC",cc:[{x:10.256411,y:18.461538},{x:8.205129,y:20.512821},{x:8.205129,y:22.564102}]},{type:"CC",cc:[{x:6.1538463,y:24.615385},{x:6.1538463,y:26.666666},{x:4.1025643,y:26.666666}]},{type:"CC",cc:[{x:4.1025643,y:28.717949},{x:4.1025643,y:30.76923},{x:2.0512822,y:30.76923}]},{type:"CC",cc:[{x:2.0512822,y:32.820515},{x:2.0512822,y:34.871796},{x:2.0512822,y:36.923077}]},{type:"CC",cc:[{x:0,y:36.923077},{x:0,y:38.974358},{x:0,y:41.025642}]},{type:"CC",cc:[{x:0,y:43.076923},{x:0,y:49.23077},{x:0,y:51.28205}]},{type:"CC",cc:[{x:0,y:53.333332},{x:0,y:55.384617},{x:0,y:57.435898}]},{type:"CC",cc:[{x:0,y:59.48718},{x:0,y:61.53846},{x:0,y:63.589745}]},{type:"CC",cc:[{x:0,y:65.64103},{x:0,y:67.69231},{x:0,y:69.74359}]},{type:"CC",cc:[{x:0,y:71.79487},{x:0,y:73.84615},{x:0,y:75.89744}]},{type:"CC",cc:[{x:2.0512822,y:75.89744},{x:2.0512822,y:77.948715},{x:4.1025643,y:80}]},{type:"CC",cc:[{x:6.1538463,y:82.051285},{x:6.1538463,y:84.10256},{x:8.205129,y:84.10256}]},{type:"CC",cc:[{x:8.205129,y:86.15385},{x:10.256411,y:86.15385},{x:10.256411,y:88.20513}]},{type:"CC",cc:[{x:12.307693,y:88.20513},{x:14.358974,y:88.20513},{x:16.410257,y:88.20513}]},{type:"CC",cc:[{x:18.461538,y:88.20513},{x:20.512821,y:88.20513},{x:22.564102,y:88.20513}]},{type:"CC",cc:[{x:26.666666,y:88.20513},{x:28.717949,y:88.20513},{x:34.871796,y:86.15385}]},{type:"CC",cc:[{x:36.923077,y:86.15385},{x:38.974358,y:86.15385},{x:41.025642,y:86.15385}]},{type:"CC",cc:[{x:41.025642,y:84.10256},{x:43.076923,y:84.10256},{x:45.128204,y:84.10256}]},{type:"CC",cc:[{x:47.179485,y:82.051285},{x:51.28205,y:80},{x:53.333332,y:80}]},{type:"CC",cc:[{x:55.384617,y:77.948715},{x:57.435898,y:77.948715},{x:59.48718,y:77.948715}]},{type:"CC",cc:[{x:59.48718,y:75.89744},{x:61.53846,y:75.89744},{x:61.53846,y:73.84615}]},{type:"CC",cc:[{x:63.589745,y:73.84615},{x:67.69231,y:71.79487},{x:69.74359,y:71.79487}]},{type:"CC",cc:[{x:71.79487,y:71.79487},{x:71.79487,y:69.74359},{x:73.84615,y:67.69231}]},{type:"CC",cc:[{x:75.89744,y:67.69231},{x:77.948715,y:65.64103},{x:80,y:65.64103}]},{type:"CC",cc:[{x:82.051285,y:65.64103},{x:82.051285,y:63.589745},{x:84.10256,y:61.53846}]},{type:"CC",cc:[{x:88.20513,y:61.53846},{x:92.30769,y:61.53846},{x:94.35897,y:61.53846}]},{type:"CC",cc:[{x:96.410255,y:61.53846},{x:96.410255,y:59.48718},{x:98.46154,y:59.48718}]},{type:"CC",cc:[{x:100.51282,y:59.48718},{x:106.666664,y:59.48718},{x:108.71795,y:59.48718}]},{type:"CC",cc:[{x:110.76923,y:57.435898},{x:114.871796,y:57.435898},{x:116.92308,y:57.435898}]},{type:"CC",cc:[{x:118.97436,y:57.435898},{x:121.02564,y:57.435898},{x:123.07692,y:57.435898}]},{type:"CC",cc:[{x:129.23077,y:57.435898},{x:131.28206,y:57.435898},{x:133.33333,y:57.435898}]},{type:"CC",cc:[{x:135.38461,y:57.435898},{x:137.4359,y:57.435898},{x:139.48718,y:57.435898}]},{type:"CC",cc:[{x:141.53847,y:57.435898},{x:145.64102,y:57.435898},{x:157.94872,y:59.48718}]},{type:"CC",cc:[{x:160,y:59.48718},{x:162.05128,y:59.48718},{x:164.10257,y:59.48718}]},{type:"CC",cc:[{x:166.15384,y:61.53846},{x:168.20512,y:61.53846},{x:170.25641,y:63.589745}]},{type:"CC",cc:[{x:174.35898,y:65.64103},{x:176.41026,y:67.69231},{x:176.41026,y:69.74359}]},{type:"CC",cc:[{x:178.46153,y:69.74359},{x:180.51282,y:69.74359},{x:180.51282,y:71.79487}]},{type:"CC",cc:[{x:180.51282,y:75.89744},{x:180.51282,y:77.948715},{x:180.51282,y:80}]},{type:"CC",cc:[{x:180.51282,y:82.051285},{x:180.51282,y:84.10256},{x:180.51282,y:86.15385}]},{type:"CC",cc:[{x:180.51282,y:88.20513},{x:180.51282,y:90.25641},{x:180.51282,y:92.30769}]},{type:"CC",cc:[{x:180.51282,y:94.35897},{x:178.46153,y:94.35897},{x:178.46153,y:96.410255}]},{type:"CC",cc:[{x:178.46153,y:98.46154},{x:176.41026,y:100.51282},{x:176.41026,y:102.5641}]},{type:"CC",cc:[{x:176.41026,y:104.61539},{x:174.35898,y:104.61539},{x:174.35898,y:106.666664}]},{type:"CC",cc:[{x:172.3077,y:106.666664},{x:170.25641,y:108.71795},{x:166.15384,y:108.71795}]},{type:"CC",cc:[{x:164.10257,y:110.76923},{x:160,y:110.76923},{x:157.94872,y:110.76923}]},{type:"CC",cc:[{x:157.94872,y:112.82051},{x:155.89743,y:112.82051},{x:153.84616,y:112.82051}]},{type:"CC",cc:[{x:151.79488,y:112.82051},{x:147.6923,y:114.871796},{x:145.64102,y:114.871796}]},{type:"CC",cc:[{x:143.58974,y:114.871796},{x:141.53847,y:114.871796},{x:139.48718,y:114.871796}]},{type:"CC",cc:[{x:135.38461,y:114.871796},{x:133.33333,y:114.871796},{x:129.23077,y:114.871796}]},{type:"CC",cc:[{x:127.17949,y:114.871796},{x:127.17949,y:116.92308},{x:123.07692,y:116.92308}]},{type:"CC",cc:[{x:108.71795,y:116.92308},{x:106.666664,y:116.92308},{x:104.61539,y:116.92308}]},{type:"CC",cc:[{x:102.5641,y:116.92308},{x:90.25641,y:116.92308},{x:88.20513,y:116.92308}]},{type:"CC",cc:[{x:84.10256,y:116.92308},{x:77.948715,y:116.92308},{x:67.69231,y:116.92308}]},{type:"CC",cc:[{x:63.589745,y:116.92308},{x:55.384617,y:116.92308},{x:51.28205,y:116.92308}]},{type:"CC",cc:[{x:49.23077,y:116.92308},{x:47.179485,y:116.92308},{x:41.025642,y:116.92308}]},{type:"CC",cc:[{x:38.974358,y:116.92308},{x:34.871796,y:116.92308},{x:32.820515,y:116.92308}]},{type:"CC",cc:[{x:30.76923,y:116.92308},{x:28.717949,y:116.92308},{x:24.615385,y:116.92308}]},{type:"CC",cc:[{x:24.615385,y:118.97436},{x:22.564102,y:121.02564},{x:22.564102,y:123.07692}]},{type:"CC",cc:[{x:22.564102,y:125.128204},{x:18.461538,y:129.23077},{x:18.461538,y:131.28206}]},{type:"CC",cc:[{x:18.461538,y:133.33333},{x:18.461538,y:135.38461},{x:16.410257,y:135.38461}]},{type:"CC",cc:[{x:16.410257,y:137.4359},{x:16.410257,y:139.48718},{x:16.410257,y:141.53847}]},{type:"CC",cc:[{x:16.410257,y:143.58974},{x:16.410257,y:145.64102},{x:16.410257,y:147.6923}]},{type:"CC",cc:[{x:16.410257,y:149.74359},{x:18.461538,y:149.74359},{x:20.512821,y:151.79488}]},{type:"CC",cc:[{x:22.564102,y:151.79488},{x:22.564102,y:153.84616},{x:22.564102,y:155.89743}]},{type:"CC",cc:[{x:24.615385,y:155.89743},{x:24.615385,y:157.94872},{x:24.615385,y:160}]},{type:"CC",cc:[{x:26.666666,y:160},{x:28.717949,y:160},{x:28.717949,y:162.05128}]},{type:"CC",cc:[{x:30.76923,y:162.05128},{x:30.76923,y:164.10257},{x:32.820515,y:164.10257}]},{type:"CC",cc:[{x:34.871796,y:164.10257},{x:34.871796,y:166.15384},{x:36.923077,y:166.15384}]},{type:"CC",cc:[{x:36.923077,y:168.20512},{x:38.974358,y:168.20512},{x:41.025642,y:168.20512}]},{type:"CC",cc:[{x:43.076923,y:168.20512},{x:43.076923,y:170.25641},{x:45.128204,y:170.25641}]},{type:"CC",cc:[{x:45.128204,y:172.3077},{x:47.179485,y:172.3077},{x:47.179485,y:174.35898}]},{type:"CC",cc:[{x:49.23077,y:174.35898},{x:51.28205,y:174.35898},{x:51.28205,y:176.41026}]},{type:"CC",cc:[{x:53.333332,y:176.41026},{x:55.384617,y:176.41026},{x:55.384617,y:178.46153}]},{type:"CC",cc:[{x:57.435898,y:178.46153},{x:59.48718,y:178.46153},{x:61.53846,y:178.46153}]},{type:"CC",cc:[{x:63.589745,y:180.51282},{x:65.64103,y:180.51282},{x:67.69231,y:180.51282}]},{type:"CC",cc:[{x:69.74359,y:180.51282},{x:73.84615,y:182.5641},{x:75.89744,y:182.5641}]},{type:"CC",cc:[{x:77.948715,y:182.5641},{x:80,y:182.5641},{x:88.20513,y:182.5641}]},{type:"CC",cc:[{x:90.25641,y:182.5641},{x:90.25641,y:180.51282},{x:92.30769,y:180.51282}]},{type:"CC",cc:[{x:94.35897,y:180.51282},{x:96.410255,y:178.46153},{x:98.46154,y:178.46153}]},{type:"CC",cc:[{x:100.51282,y:176.41026},{x:100.51282,y:174.35898},{x:102.5641,y:174.35898}]},{type:"CC",cc:[{x:104.61539,y:174.35898},{x:106.666664,y:172.3077},{x:108.71795,y:170.25641}]},{type:"CC",cc:[{x:110.76923,y:168.20512},{x:112.82051,y:166.15384},{x:112.82051,y:164.10257}]},{type:"CC",cc:[{x:114.871796,y:164.10257},{x:114.871796,y:162.05128},{x:114.871796,y:160}]},{type:"CC",cc:[{x:116.92308,y:160},{x:116.92308,y:157.94872},{x:118.97436,y:157.94872}]},{type:"CC",cc:[{x:118.97436,y:155.89743},{x:121.02564,y:155.89743},{x:121.02564,y:153.84616}]},{type:"CC",cc:[{x:123.07692,y:153.84616},{x:123.07692,y:151.79488},{x:125.128204,y:151.79488}]},{type:"CC",cc:[{x:125.128204,y:149.74359},{x:125.128204,y:147.6923},{x:127.17949,y:145.64102}]},{type:"L",l:{x:129.23077,y:145.64102}},{type:"L",l:{x:133.33333,y:143.58974}}]}]}};t.props.fill=o,t.props.stroke=r;var s=J(e.menu).zmenu("getAllIconHolders",!0);delete t.textBody,J.each(s,function(e,o){var r=J.extend(!0,{},t),s=J(o.item).metadata(),l=s.appData,d=J(o.icon);d.css({width:22,height:22}),r.props.geom={type:l.shapeGeoType,preset:{type:l.action}},r.type=l.shapeObjType;var c=s.width,u=s.height,p=s.left,h=s.top;J(o.item).is("[gname=callouts]")?(i.indexOf(l.action)!=-1&&(r.props.geom.preset.modifiers=[-.5,.9],c=18,u=15),r.props.transform={dim:{width:c?c:17,height:u?u:17},pos:{left:p?p:9,top:h?h:5,zindex:1}}):r.props.transform={dim:{width:c?c:22,height:u?u:22},pos:{left:p?p:3,top:h?h:3,zindex:1}},l.subType&&(r=J.extend(!0,{},InsertShape.mergeMarkerData(r,l))),"CUSTOM"==l.shapeGeoType&&(r.props.transform.dim={width:16,height:16},r.props.transform.pos={left:6,top:6},"FREEFORM"!=l.action&&(r.props.fill={type:"NONE"}),r.props.geom.custom=a[l.action]),n.indexOf(l.action)!=-1&&(r.props.fill={type:"NONE"}),Shape.create.draw(r,d)})},InsertShape.mergeMarkerData=function(e,t){var n={type:J.ShapeConstants.MarkerType.OPEN,width:J.ShapeConstants.Size.MEDIUM,height:J.ShapeConstants.Size.MEDIUM};if(t.subType&&"1marker"==t.subType){var i={props:{stroke:{tailend:n}}};e=J.extend(!0,e,i)}else if(t.subType&&"2marker"==t.subType){var o={props:{stroke:{tailend:n,headend:n}}};e=J.extend(!0,e,o)}return e},InsertShape.drawMenuShapes=function(e,t){var n=!t.menu.data("shapesdrawn");n&&(InsertShape.generateShapeMenu(t),t.menu.data("shapesdrawn",!0))},InsertShape.drawSelectedShapeFromMenu=function(e,t){var n=J(t.menuitem[0]).attr("data"),i=JSON.parse(n).appData,o=i.action;if(InsertShape.isChangeShape)InsertShape.changeShapeProperty(["changeshape",o]);else{var r=[o,"blue"];i.subType&&r.push(i.subType),InsertShape.drawShape(r)}},InsertShape.changeStrokeColor=function(e,t){J(e.target).css({"background-color":t.color});var n=InsertShape.getRGBVal(t.color);InsertShape.changeShapeProperty(["strokecolor",n])},InsertShape.changeShapeFillColor=function(e,t){J(e.target).css({"background-color":t.color});var n=InsertShape.getRGBVal(t.color);InsertShape.changeShapeProperty(["fillcolor",n])},InsertShape.changeShapeForegroundColor=function(e,t){Z(J(e.target).attr("id").replace("list","")).children(".ui-button-icon-primary").css({"border-bottom":"2px solid "+t.color});var n=InsertShape.getRGBVal(t.color);InsertShape.processTxtFormat(["forecolor",n])},InsertShape.isEditorEditable=function(){var e=editor.doc.getRole();return editor.isEditable()&&!("SHAREDREADCOMMENT"==e||"ANYONELINK_SHAREDREADCOMMENT"==e)},InsertShape.handleEditorPermissionChanged=function(){InsertShape.updateShapeText(),InsertShape.clearSelection(),InsertShape.clearCache();var e=InsertShape.isEditorEditable();J.each(ShapeConfig.isSupported,function(t,n){ShapeConfig.isSupported[t]=e})},InsertShape.updateShapeText=function(e,t){if(null==InsertShape.isTextModified||0==InsertShape.getSelectedShapesArray().length&&!e)return!1;var n=e||InsertShape.selectedShape();if(n)return ShapeEditor.config.container=Z("inner_shape"),InsertShape.isTextModified=null,InsertShape.applyStyle(n,!0),t&&InsertShape.select.shape(n),!0},InsertShape.deleteGroupShape=function(){try{var e=InsertShape.selectedShape(),t=e.data;if("SHAPE"==t.type){var n=e.parentIds[0];t=J.ShapeData.getShape(n)}InsertShape.clearSelection(),InsertShape.updateShapeText(),InsertShape.deleteSingleShape(t),Op.sendMsg(),EditorUtil.focusMultiByteSpan()}catch(e){InsertShape.sendErrorMail(e)}},InsertShape.deleteSingleShape=function(e){var t=e.nvOProps.nvDProps.id,n=J("#"+t).parents("div.zw-paragraph");if(e.dropcapData){var i=DocUtil.getDocElement(n),o=DocUtil.getParaFormat(i.getEnd()-1);o[ATTR_PARAGRAPH.PS_DROPCAP]=!1,i.attr(o)}var r=InsertShape.getShapeNodeData(t),a=editor.doc.createRange(r.index,r.index+1);editor.doc.getSelection().removeAllRanges().addRange(a).deleteSelectedContents(null,!0),InsertShape.removeFromCache(t)},InsertShape.deleteInGroupShape=function(e,t){var n=J.ShapeData.getShapeData(t),i=n.shapes;if(2==i.length){InsertShape.clearSelection(),InsertShape.select.shape(t);var o=InsertShape.selectedShape(),r=InsertShape.ungroupShape(o);r.forEach(function(t){t.nvOProps.nvDProps.id!=e&&InsertShape.processShape(t)})}else{var a=0;J.each(i,function(t,n){n.nvOProps.nvDProps.id==e&&(a=t)}),i.splice(a,1),InsertShape.applyStyle(n),InsertShape.select.shape(t)}},InsertShape.deleteShapes=function(e){try{var e=e||InsertShape.getSelectedShapesArray();InsertShape.updateShapeText(),1==e.length&&e[0].parentIds&&e[0].parentIds[0]?(InsertShape.deleteInGroupShape(curShapeId,selShapeData.parentIds[0]),InsertShape.select.shape(selShapeData.parentIds[0])):(e.forEach(function(e){var t=e.data;InsertShape.deleteSingleShape(t),J("#inner_shape").css({width:"0",height:"0px"})}),Op.sendMsg(),EditorUtil.focusMultiByteSpan())}catch(e){InsertShape.sendErrorMail(e)}},InsertShape.arrange=function(e){e=e[0];var t=InsertShape.selectedShape().data,n=t.nvOProps.nvDProps.id,i=t.props.transform.pos.zindex,o=InsertShape.getShapeFromFloatImages(DocTreeManager.getTreeNodeAtIndex(editor.doc.getSelection().getStart()).paraProperties),r={},a=0;if("forward"==e){if(i==o.length)return;if(a=1e3,J.each(o,function(e,t){var n=t.shapeData.props.transform.pos.zindex;i<n&&n<a&&(a=n,r=t.shapeData)}),1e3==a)return}else if("backward"==e){if(1==i)return;if(a=-1,J.each(o,function(e,t){var n=t.shapeData.props.transform.pos.zindex;i>n&&n>a&&(a=n,r=t.shapeData)}),a==-1)return}r.props.transform.pos.zindex=i,t.props.transform.pos.zindex=a,InsertShape.applyStyle(t,!0),InsertShape.applyStyle(r,!0),InsertShape.select.shape(n)},InsertShape.cut=function(){ShapeEditor.text.isEditable()||(CopyUtil.onCopy(),InsertShape.deleteShapes())},InsertShape.paste=function(){editor.doc.execCmd("paste")},InsertShape.duplicateShapes=function(){var e=InsertShape.getSelectedShapesArray(),t=[];e.forEach(function(e){var n=e.data.nvOProps.nvDProps.id,i=InsertShape.getShapeNodeData(n);i.format[MAILMERGE.MMINFOS]&&(InsertShape.mergeWithFormat={mminfos:i.format[MAILMERGE.MMINFOS]});var o=i.format.shapeData,r=InsertShape.getZindex(e.data.nvOProps.nvDProps.id),a=o.props.transform.pos;InsertShape.renewShape(o),a.top+=30,a.left+=30,a.zindex=r,InsertShape.moveCursorIdx(i.index+1),InsertShape.insertShape(o),t.push(o.nvOProps.nvDProps.id)}),InsertShape.select.shape(t)},InsertShape.getZindex=function(e){try{var t=null;if(e){var n=DocUtil.getDocElement(J("#"+e).parents(".zw-paragraph")[0]);t=InsertShape.getShapeFromFloatImages(n.dtNode.paraProperties)}else t=InsertShape.getShapeFromFloatImages(DocTreeManager.getTreeNodeAtIndex(editor.doc.getSelection().getStart()).paraProperties);var i=0;t.forEach(function(e){var t=JSON.parse(e.shapeData.props.transform.pos.zindex);t>i&&(i=t)}),i++}catch(e){}return i},InsertShape.startToolbarUpdation=function(){var e=InsertShape.getSelectedShapesArray();if(e[0]){var t=e[0].data;if(!t.dropcapData){var n=t.shapes;n&&(t=n[0]);var i,o=e.length>1,r=!(o||!e[0].parentIds[0]);if(e.forEach(function(e){var t=e.data;"CONNECTOR"==t.type&&(i=!0)}),UIUtils.enableMenuTabs(UIUtils.uiNotChildShapeMenus),i)UIUtils.disableMenuTabs(UIUtils.uiNotConnectorMenus);else if(n)UIUtils.disableMenuTabs(UIUtils.uiNotGroupShapeMenus);else{UIUtils.enableMenuTabs(UIUtils.uiNotConnectorMenus),UIUtils.enableMenuTabs(UIUtils.uiNotGroupShapeMenus),r&&UIUtils.disableMenuTabs(UIUtils.uiNotChildShapeMenus);var a={para:0,portion:0,ch:0};ShapeEditor.text.isEditable()&&(a=ShapeEditor.text.getObject().from);var s=t.textBody,l=s.paras[a.para],d=l.portions[a.portion],c=d.props,u="transparent";"SOLID"==c.fill.type&&(u="rgb("+c.fill.solid.color.rgb.toString()+")"),UIUtils.uiShapePortionStyles.zbutton(c.bold?"check":"uncheck","#shpBold"),UIUtils.uiShapePortionStyles.zbutton(c.italic?"check":"uncheck","#shpItalic"),UIUtils.uiShapePortionStyles.zbutton(c.strike&&"NONE"!=c.strike?"check":"uncheck","#shpStrikethrough"),UIUtils.uiShapePortionStyles.zbutton(c.underline&&"NONE"!=c.underline?"check":"uncheck","#shpUnderline"),Toolbar.updateFontSize(parseFloat(c.size||11),Z("shape_fontSize")),Toolbar.updateFontFamily(c.font.fontFamily.name,Z("shapepanel-fontFamily")),J("#shp-lpnl-fgcolor").children(".ui-button-icon-primary").css({"border-bottom":"2px solid "+u}),UIUtils.uiShapePortionStyles.zbutton("uncheck","#shpSuperscript,#shpSubscript"),c.baseline&&(c.baseline<0&&UIUtils.uiShapePortionStyles.zbutton("check","#shpSubscript"),c.baseline>0&&UIUtils.uiShapePortionStyles.zbutton("check","#shpSuperscript"));var p=l.style,h=(p.spacing.line.percent+"").replace(".","_"),f="#align"+(p.halign||"LEFT").toLowerCase();Z("shp-lpnl-linespacemenu").zmenu("check","shp_lnSp"+h),Z("shapeParaAlign").zbutton("check",f);var m=t.textBody.props.valign;t.textBox&&"left"==m?m="top":m&&(m=t.textBody.props.valign.toLowerCase()),Z("shapetextValign").zmenu("check","valign_"+m)}var g="0_0",T="shadow0",_="preset0",E="rgb(255,255,255)",v=InsertShape.getShapeFromFloatImages(DocTreeManager.getTreeNodeAtIndex(editor.doc.getSelection().getStart()).paraProperties),S=t.props.fill?t.props.fill.type:"NONE",b=t.props.stroke.fill.type,R="NONE"!=b?"rgb("+t.props.stroke.fill.solid.color.rgb.toString()+")":"rgb(255,255,255)",O="wrap"+(t.wrapType||"front");if("NONE"!=S&&"PICT"!=S){var D=i?t.props.stroke.fill:t.props.fill;D&&(g=D.solid.color.tweaks?(D.solid.color.tweaks.alpha+"").replace(".","_"):"0_0"),E="rgb("+t.props.fill.solid.color.rgb.toString()+")"}t.props.effects&&(t.props.effects.reflection&&(_=t.props.effects.reflection.preset&&t.props.effects.reflection.preset.toLowerCase()),t.props.effects.shadow&&(T=t.props.effects.shadow.distance&&"shadow"+t.props.effects.shadow.distance.angle));var y=t.props.transform.pos.zindex,A=Z("sendbackward"),C=Z("bringforward");1==y||o?A.disable():A.enable(),y==v.length||o?C.disable():C.enable(),Z("shapefillcolor").css({background:E,"border-color":E}),Z("strokecolor").css({background:R,"border-color":R}),Z("strokewidthmenu").zmenu("check","strokewidth"+t.props.stroke.width),Z("strokestylemenu").zmenu("check","strokestyle_"+t.props.stroke.type),Z("shapeopacitymenu").zmenu("check","opacity"+g),Z("shadowpresetmenu").zmenu("check",T),Z("reflectionpresetmenu").zmenu("check",_),Z("shapewraptypesmenu").zmenu("check",O),Z("shape-lpnl-mmbtn").show()}}},InsertShape.updateToolbar=function(){clearTimeout(InsertShape.toolbarUpdationProgress),LeftPanel.isPanelVisible(ELEM_ID.SHAPESPANEL)&&(InsertShape.toolbarUpdationProgress=setTimeout(function(){InsertShape.startToolbarUpdation()},300))},InsertShape.clearShapeCache=function(){InsertShape.shapeCache={}},InsertShape.beforeShapeDelete=function(e){if(J("#inner_shape").css({width:"0",height:"0px"}),ShapeEditor.bbox.remove(),e&&e.shapeData.dropcapData){var t=e.shapeData.nvOProps.nvDProps.id,n=J("#"+t).parents("div.zw-paragraph"),i=DocUtil.getDocElement(n),e=DocUtil.getParaFormat(i.getEnd()-1);e[ATTR_PARAGRAPH.PS_DROPCAP]=!1,i.attr(e)}InsertShape.clearSelection(),InsertShape.closeToolbar(),EditorUtil.focusMultiByteSpan()},InsertShape.addClassToParent=function(e,t){J(t.menu).find(".ui-state-active").removeClass("ui-state-active").parents("li").addClass("ui-state-active")},InsertShape.getSelectedShapesArray=function(){return ShapeEditor.select.shapes},InsertShape.selectedShape=function(){return ShapeEditor.select.shapes[0]},InsertShape.processAfterPaste=function(){InsertShape.pastedShapes.length>0&&(InsertShape.clearSelection(),InsertShape.select.shape(InsertShape.pastedShapes),InsertShape.pastedShapes=[])},InsertShape.moveCursorIdx=function(e,t){if(e&&e!=-1){e="number"==typeof e?e:InsertShape.getShapeIdx(e);var n=editor.doc.createRange(e,t||e);return editor.doc.getSelection().removeAllRanges().addRange(n),n}},InsertShape.getShapesInPara=function(e){var t=e?J("#"+e).parents(".zw-paragraph")[0]:DocTreeManager.getNodeAtIndex(editor.doc.getSelection().getStart()),n=DocUtil.getDocElement(t),i=n.getStart(),o=n.getEnd(),r=editor.doc.getNodesInSelection(NODE_TYPE.IMAGE,i,o);return r},InsertShape.clearCache=function(){for(var e=(J.ShapeData.shapes,U.keys(J.ShapeData.shapes)),t=0;t<e.length;t++)delete InsertShape.shapeCache[e[t]]},InsertShape.removeFromCache=function(e){var t=e;if("object"==typeof e&&e.length)for(var n=0;n<e.length;n++){var i=e[n];t="string"==typeof i?i:i.id||(i.data||i.shapeData||i).nvOProps.nvDProps.id}else"string"!=typeof e&&(t=(e.data||e).nvOProps.nvDProps.id);delete J.ShapeData.shapes[t],delete InsertShape.shapeCache[t]},InsertShape.editShape=function(e,t){ShapeEditor.text.editor.edit(InsertShape.selectedShape()),e>=0?ShapeEditor.text.editor.select.select(e,t||e):e==-1&&ShapeEditor.text.editor.select.all()},InsertShape.select={similar:function(){var e=InsertShape.selectedShape().data,t=e.props.geom.preset.type,n=JSON.stringify(e.props.fill),i=JSON.stringify(e.props.stroke),o=JSON.stringify(e.props.transform.dim),r=[],a=U.keys(J.ShapeData.shapes),s=J.ShapeData;U.each(a,function(e,a){var l=s.getShapeData(e);l&&l.props.geom.preset.type==t&&JSON.stringify(l.props.transform.dim)==o&&JSON.stringify(l.props.fill)==n&&JSON.stringify(l.props.stroke)==i&&r.push(e)}),r.length>0&&this.shape(r)},all:function(){var e=(J.ShapeData.shapes,U.keys(J.ShapeData.shapes));this.shape(e)},shape:function(e){if(InsertShape.positionScalespan(),InsertShape.positionScalespan(),e){var t=ShapeEditor.config.container;J(editor.clientActiveSection);if(t.is("#drawcontainer")||(ShapeEditor.config.container=J("#drawcontainer"),J("#ui-editor-outer-div").scrollTop()),"string"==typeof e){var n=InsertShape.getShapeDom(e);n&&ShapeEditor.selectShape(e,!1,n)}else if(e.length)for(var i=0;i<e.length;i++){var o=e[i],r="string"==typeof o?o:o.id||(o.data||o).nvOProps.nvDProps.id,n=InsertShape.getShapeDom(r);n&&ShapeEditor.selectShape(r,!1,n)}else{var r=(e.data||e).nvOProps.nvDProps.id,n=InsertShape.getShapeDom(r);n&&ShapeEditor.selectShape(r,!1,n)}PubSub.subscribe("ZWSelection/ShapeDeleted",InsertShape.beforeShapeDelete),InsertShape.hideEditorCursor()}}},InsertShape.lockanchor=function(){var e=InsertShape.getSelectedShapesArray();e.length&&U.each(InsertShape.getSelectedShapesArray(),function(e,t){e.data.lockAnchor=!e.data.lockAnchor,InsertShape.applyStyle(e.data,!0)}),InsertShape.select.shape(e)},InsertShape.clearCache=function(){InsertShape.updateShapeText();for(var e=(J.ShapeData.shapes,U.keys(J.ShapeData.shapes)),t=0;t<e.length;t++)delete InsertShape.shapeCache[e[t]]},InsertShape.editShape=function(e,t){ShapeEditor.text.editor.edit(InsertShape.selectedShape()),e>=0?ShapeEditor.text.editor.select.select(e,t||e):e==-1&&ShapeEditor.text.editor.select.all()},InsertShape.changeRelativeToPara=function(e,t){var n=e,i=J(editor.clientActiveSection).find("#"+n).parents("div.zw-paragraph")[0]||J("#"+n).parents("div.zw-paragraph")[0],o=PUtil.offset(i),r=(editor.jeditorPane.offset(),J(i).offset().left+t.pos.left*editor.zoomFactor+Z("ui-editor-outer-div").scrollLeft()),a=(o.top+t.pos.top)*editor.zoomFactor;return t.pos.top=a+1,t.pos.left=r,t.pos.left-=Z("ui-editor-outer-div").offset().left,t},InsertShape.groupShapes=function(e){var t=e||ShapeEditor.select.shapes;InsertShape.getShapeParaDOMNode(t[0].data.nvOProps.nvDProps.id);if(!(t.length<=1)){var n=J.extend(!0,{},J.ShapeDefault.shape);delete n.textBody,n.type=J.ShapeConstants.ShapeNodeType.GROUPSHAPE,n.nvOProps.nvDProps.id=Math.uuid();var i=n.nvOProps.nvDProps.id,o=[],r=[],a=!1;J.each(t,function(e,t){var n=J.extend(!0,{},t.data);n=InsertShape.updatePosRelativeToPara(t.data),n.nvOProps.nvODProps&&n.nvOProps.nvODProps.locks.noAspectChange&&(a=!0);var i=n.props.transform.pos,s=n.props.transform.dim;o.push(n);var l={x:i.left,y:i.top},d={x:i.left+s.width,y:i.top+s.height};r.push(l),r.push(d)}),a&&(n.nvOProps.nvODProps={locks:{noAspectChange:!0}});var s=VectorUtil.getMinAndMax(r),l={},d={};l.left=s.small.x,l.top=s.small.y,d.width=s.big.x-s.small.x,d.height=s.big.y-s.small.y;var c=n.props.transform;c.chDim=d,c.chPos=l,c.dim=d,c.pos=l,c.rotate=0,n.shapes=o,InsertShape.deleteShapes(t);var u={};u[ATTR_IMAGE.I_SHAPEDATA]=n,u[ATTR_COMMON.TYPE]="image",u[ATTR_IMAGE.I_WID]="0px",u[ATTR_IMAGE.I_HT]="0px",J("#inner_shape").css({width:"0",height:"0px"}),editor.doc.execCmd("insimg",u),InsertShape.select.shape(i)}},InsertShape.updatePosRelativeToPara=function(e){var t=InsertShape.getShapeIdx(e),n=e.props.transform.pos,i=editor.doc.getRawFormatAt(t).shapeData;return n.top=i.props.transform.pos.top,n.left=i.props.transform.pos.left,e},InsertShape.ungroupAndInsert=function(e){var t=InsertShape.ungroupShape(e);t.forEach(function(e){InsertShape.processShape(e)}),InsertShape.select.shape(t)},InsertShape.ungroupShape=function(e){var t=e||InsertShape.selectedShape(),n=InsertShape.getShapeIdx(t),i=editor.doc.createRange(n,n+1);editor.doc.getSelection().removeAllRanges().addRange(i).deleteSelectedContents(null,!0);var o=t.data||t,r=J.each(o.shapes,function(e,t){J.GroupShape.updateInnerShapeData(J.GroupShape.props,o.props,t,!0)});return r},InsertShape.feedShapesFromZShowToZWriter=function(e){var t=e.shapes||e.data.shapes;J.each(t,function(e,t){var n=InsertShape.getDefaultShapeData();n.props=t.props,t.textBody?n.textBody=t.textBody:delete n.textBody,n.nvOProps.nvDProps.id=Math.uuid(),n.nvOProps.nvODProps={locks:{noAspectChange:!0}},InsertShape.processShape(n)}),InsertShape.clearSelection()},InsertShape.textboxFillImageMap={box4:"textbox-thumbpin.png",col1:"textbox-pink-bg.png",col3:"textbox-blue-bg.png",quotes1:"quotes-pink-bg.png",quotes2:"quotes-green-bg.png",quotes3:"quotes-orange-bg.png",quotes4:"quotes-violet-bg.png"},InsertShape.fillText=function(e){if(!e.textBody)return e;var t=editor.doc.getSelection(),n=t.getLastRange();t.removeAllRanges().addRange(n).deleteSelectedContents(null,!0);for(var i=editor.doc.contStr.substring(t.getStart(),t.getEnd())||"",o=e.textBody.paras,r=0;r<o.length;r++){var a=o[r];if(a)for(var s=a.portions,l=0;l<s.length;l++){var d=a.portions[l];if(d){if(!d||!d.t)continue;var c=d.t;c.indexOf("CONTENT")!=-1?0==i.length?d.t=InsertShape.constant.CONTENT:d.t=i:c.indexOf("HEADING")!=-1&&(d.t=InsertShape.constant.HEADING)}}}return e},InsertShape.getTextboxTemplateData=function(e){var t=JSON.parse(JSON.stringify(TextBoxTemplates[e])),n=t.shapes;return n&&J.each(n,function(t,i){var o=InsertShape.getDefaultShapeData();if(o.props=i.props,i.textBody?o.textBody=i.textBody:delete o.textBody,"box9"==e&&e.indexOf("quotes")==-1||(i=InsertShape.fillText(o)),o.nvOProps.nvDProps.id=Math.uuid(),o.props.fill&&"PICT"==o.props.fill.type){var r=InsertShape.textboxFillImageMap[e];if(r){var a=o.props.transform.dim.height,s=o.props.transform.dim.width;InsertShape.modifyShapeProperty(["fillimage",["images/textbox/"+r,a,s]],o)}}n[t]=o}),t.nvOProps.nvDProps.id=Math.uuid(),t.props.transform.pos={top:0,left:0},t[ATTR_IMAGE.I_MT]=t[ATTR_IMAGE.I_MB]=t[ATTR_IMAGE.I_ML]=t[ATTR_IMAGE.I_MR]="0.125in",t.wrapType="square",t.textboxTemplate=e,t},InsertShape.insertTextboxTemplate=function(e){var t=0;if(("box5"==e||"box6"==e||"box7"==e)&&!editor.doc.getSelection().isCollapsed())return void InsertShape.convertSelectedTextToPullquote(e);var n=InsertShape.getTextboxTemplateData(e);if(n.maintainLayout){n.nvOProps.nvODProps&&delete n.nvOProps.nvODProps;var i=ViewManager.getPageAtPageNumber(editor.currentPageIndex+1),o=n.props.transform;o.dim.height=3*J(i.el).height()/4,o.dim.width=J(i.el).width()/3,o.pos.left=-(editor.doc.bodyFormat.ml.convertor().pixels-5),t=i.content.columns.first.views.first.node.start}else t=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH)[0].getStart();InsertShape.moveCursorIdx(t),InsertShape.insertShape(n),InsertShape.select.shape(n.nvOProps.nvDProps.id),InsertShape.openToolbar()},InsertShape.openToolbar=function(e){if((e||!LeftPanel.isPanelVisible(ELEM_ID.SHAPESPANEL))&&LayoutManager.isRichEditActive()&&"undefined"!=typeof PanelUtil&&!editor.isOffline()){var t=J(".ui-nav.ui-navbar-nav.ui-side-menu").children();t.push(Z("review-tb-redact"),Z("review-tb-lock")),UIUtils.disableMenuTabs(t),e?setTimeout(function(){DropcapPanel.open()},100):(InsertShape.openShapeToolbar(),DropcapPanel.close()),UIUtils.enableMenuTabs(Z("menu-shape-parent")),InsertShape.hideEditorCursor()}},InsertShape.openShapeToolbar=function(){J("#menu-shape-parent").css("display","block"),LeftPanel.showSubPanel(ELEM_ID.SHAPESPANEL,ANIMATIONS.FADEIN)},InsertShape.closeToolbar=function(){if("undefined"!=typeof PanelUtil&&!editor.isOffline()){InsertShape.closeDropcapPanel(),InsertShape.closeShapeToolbar();var e=J(".ui-nav.ui-navbar-nav.ui-side-menu").children();e.push(Z("review-tb-redact")),e.push(Z("review-tb-lock")),editor.isEditable()&&(UIUtils.enableMenuTabs(e),InsertShape.showEditorCursor()),PubSub.unsubscribe("ZWSelection/ShapeDeleted",InsertShape.beforeShapeDelete)}},InsertShape.closeShapeToolbar=function(){LeftPanel.closeDynamicPanel(ELEM_ID.SHAPESPANEL),J("#menu-shape-parent").css("display","none")},InsertShape.closeDropcapPanel=function(){for(var e=InsertShape.getSelectedShapesArray(),t=0;t<e.length;t++){var n=e[t].data||e[t];if(n.dropcapData){InsertShape.clearSelection();break}}DropcapPanel.close()},InsertShape.processBeforeShapePaste=function(e){var t=e[ATTR_IMAGE.I_SHAPEDATA];InsertShape.renewShape(t),t.props.transform.pos.top+=30,t.props.transform.pos.left+=30,t.props.transform.pos.zindex=InsertShape.getZindex(),InsertShape.pastedShapes.push(t.nvOProps.nvDProps.id),e[ATTR_IMAGE.I_WID]="0px",e[ATTR_IMAGE.I_HT]="0px"},InsertShape.insertDropCap=function(e){var t=editor.doc.getSelection(),n=editor.doc.getParents(NODE_TYPE.PARAGRAPH,t.getStart()),i=n.dtNode.getParaStyles().isDropCapPresent;if(i)return void InsertShape.removeDropcap(n);var o=(InsertShape.selectedShape(),3),r=InsertShape.getDefaultShapeData(),a=InsertShape.getDropcapText(n),s=a.latestIdx,l=(r.dropcapData={},editor.doc.createRange(s,s+1));t.removeAllRanges().addRange(l).deleteSelectedContents(null,!0);var d=n.getStart();InsertShape.moveCursorIdx(d),InsertShape.upateDropcapTextFormats(r,a),InsertShape.fillDropcap(e,r),InsertShape.updateDropcapHeight(r,o,n),InsertShape.updateDropcapPosition(r,"DROP"),r.wrapType="square",r.nvOProps.nvODProps={locks:{noAspectChange:!0}},r.textBody.props.inset={left:0,right:0,top:0,bottom:0};var c=DocUtil.getParaFormat(n.getEnd()-1);c[ATTR_PARAGRAPH.PS_DROPCAP]=!0,n.attr(c),r[ATTR_IMAGE.I_MR]=InsertShape.constant.DEFAULT_MARGIN_RIGHT_VAL,InsertShape.insertShape(r)},InsertShape.changeDropCapType=function(e){var t=InsertShape.getDropCapInPara();if(!t)return void InsertShape.insertDropCap(e);if(!t||t.style!=e){var n=InsertShape.selectedShape(),i=editor.doc.getParents(NODE_TYPE.PARAGRAPH,editor.doc.getSelection().getStart()),o=n&&n.data||t.shapeData;InsertShape.fillDropcap(e,o),InsertShape.updateDropcapHeight(o,o.dropcapData.linestodrop,i),InsertShape.applyStyle(o,!0),LeftPanel.isPanelVisible(ELEM_ID.DROPCAPPANEL)&&InsertShape.select.shape(o.nvOProps.nvDProps.id)}},InsertShape.removeDropcap=function(e){var t=InsertShape.getDropCapInPara();if(t){InsertShape.clearSelection();var n=editor.doc.getSelection();e=e||editor.doc.getParents(NODE_TYPE.PARAGRAPH,n.getStart());var i=DocUtil.getParaFormat(e.getEnd()-1);i[ATTR_PARAGRAPH.PS_DROPCAP]=!1,e.attr(i);var o=editor.doc.createRange(t.index,t.index+1);n.removeAllRanges().addRange(o).deleteSelectedContents(null,!0);var r=InsertShape.getTextFromDropcap(t.shapeData);if(r&&r.length>0){var a=editor.doc.createElement(NODE_TYPE.TEXT,r);Command.exec("InsertChar",{cmd:"insert",element:a})}else Op.sendMsg();InsertShape.closeToolbar()}},InsertShape.getTextFromDropcap=function(e){var t="";e="string"==typeof e?J.ShapeData.getShape(e):e;var n=e.textBody.paras;return J.each(n,function(e,n){var i=n.portions;J.each(i,function(e,n){n.t&&(t+=n.t)})}),t.toUpperCase()},InsertShape.getDropCapInPara=function(){for(var e=InsertShape.getShapesInPara(),t=void 0,n=0;n<e.length;n++){var i=e[n].getStart(),o=editor.doc.getRawFormatAt(i);o.shapeData&&o.shapeData.dropcapData&&(t={index:i,shapeData:o.shapeData,style:o.shapeData.dropcapData.style})}return t},InsertShape.getDropcapText=function(e,t){var n=-1,i="";t?n=t:e?n=e.getStart():(e=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH)[0],n=e.getStart());for(var o=editor.doc.getRawFormatAt(n);null==o||o.type;){if(o&&"text"!=o.type){if("image"==o.type&&o.shapeData&&o.shapeData.dropcapData){i=InsertShape.getTextFromDropcap(o.shapeData);break}if("section"==o.type)break}else if(i=editor.doc.getCharAt(n).trim(),i.length>0)break;n+=1,o=editor.doc.getRawFormatAt(n)}return{text:i.toUpperCase(),latestIdx:n,latestFormat:o}},InsertShape.isSelectedShapeADropcap=function(){var e=!1,t=InsertShape.selectedShape();return t&&(e=!!t.data.dropcapData),e},InsertShape.updateDropcapMenuLabels=function(e,t){var n=InsertShape.isSelectedShapeADropcap(),i="";if(n)i=InsertShape.getTextFromDropcap(InsertShape.selectedShape().data);else{var o=InsertShape.getDropCapInPara();i=o?InsertShape.getDropcapText(void 0,o.index).text:InsertShape.getDropcapText().text}i.length>=3&&(i=i.substring(0,2));var r=J("#dropcapmenu").find(".ui-zmenu-text.ui-zmenu-text-placeholder").not("span:first");J.each(r,function(e,t){J(t).text(i.charAt(0)).attr("style","color :rgb("+SHAPE.DROPCAP_FONT_COLORS_MAP["dropcap"+(e+1)]+") !important")})},InsertShape.upateDropcapTextFormats=function(e,t){var n=e.textBody.paras[0];n.style.spacing.line.percent="0.7",n.unmerged.style.spacing.line.percent="0.7";var i=n.portions[0];return i.t=t.text||"D",i.props.font.fontFamily.name=InsertShape.getFontFamily(t.latestFormat),e},InsertShape.calculateLinesToDropHeight=function(e,t){var n=ViewManager.getViews(t.dtNode)[0].el,i=J(n).find(".zw-line-div"),o=0;if(i.length<e)for(;i.length<e;)i.push(i[0]);for(var r=0;r<e;r++)o+=J(i[r]).height();return o=o<40?40:o-10},InsertShape.getFontFamily=function(e){var t="",n="arial";return"string"==typeof e?t=e:(e||(e={}),t=e.ff||editor.doc.getBodyFormat().styles.para[e.hd||"h0"].textFormat.ff),n=t.indexOf("major")!=-1?Theme.font.major.latin:t.indexOf("minor")!=-1?Theme.font.minor.latin:t,n.split(",")[0]},InsertShape.fillDropcap=function(e,t){var n=t.props.transform.dim.height,i=t.textBody.paras[0].portions[0],o=t.dropcapData;if(t.props.geom.preset.type="RECT","normal"==e)InsertShape.modifyShapeProperty(["fillcolor","NONE"],t);else if(e.indexOf("fill")!=-1){var r=[68,200,245];"greenfill"==e&&(r=[151,201,124],t.props.geom.preset.type="ROUND_RECT"),InsertShape.modifyShapeProperty(["fillcolor",r],t)}else InsertShape.modifyShapeProperty(["fillimage",["images/dropcap/"+e+".png",n,n]],t);return InsertShape.modifyShapeProperty(["strokecolor","NONE"],t),i.props.fill.solid.color.rgb=SHAPE.DROPCAP_FONT_COLORS_MAP[e],i.unmerged.props=i.props,o.style=e,t},InsertShape.updateDropcapHeight=function(e,t,n){var i=e.dropcapData,o=InsertShape.calculateLinesToDropHeight(t,n),r=e.props;r.transform.dim.height=o,r.transform.dim.width=o,i.linestodrop=t;var a=e.textBody.paras[0].portions[0];return a.props.size="normal"==i.style?3.6*o/4:o/2,e},InsertShape.updateDropcapPosition=function(e,t,n){var i=e.props.transform,o=i.pos;if(n)t=e.dropcapData.type;else if(e.dropcapData.type==t)return;if("MARGIN"==t){var r=Conversions.inchToPx(editor.doc.getBodyFormat().ml),a=i.dim.width+5;a>r&&(a=r),o.top=7,o.left=-a}else o.top=7,o.left=0;return e.dropcapData.type=t,e.dropcapData[ATTR_IMAGE.I_MR]=InsertShape.constant.DEFAULT_MARGIN_RIGHT_VAL,e},InsertShape.modifyDropcapProperty=function(e,t){var n=InsertShape.selectedShape().data;if(n){var i=n.nvOProps.nvDProps.id,o=(J("#"+i).parents("div.zw-paragraph"),InsertShape.getShapeNodeData(i).shapedata),r=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH)[0],a=n.dropcapData;if(n.props.transform.pos=o.props.transform.pos,"POSITION"==e){if("NONE"==t)return void InsertShape.removeDropcap();InsertShape.updateDropcapPosition(n,t)}else"LINESTODROP"==e?(InsertShape.updateDropcapHeight(n,t,r),"MARGIN"==a.type&&InsertShape.updateDropcapPosition(n,null,!0)):"DISTANCEFROMRIGHT"==e?n[ATTR_IMAGE.I_MR]=t:"DISTANCEFROMBOTTOM"==e&&(n[ATTR_IMAGE.I_MB]=t);InsertShape.applyStyle(n,!1),InsertShape.select.shape(i)}},InsertShape.updateDropcapButton=function(e){var t=(e.getStart(),e.text(!0).replaceAll("\\n","").trim().length),n=editor.clientActiveSection.className;t&&"cell"!=e.parentNode().type&&n.indexOf("header")==-1&&n.indexOf("footer")==-1?J("#fmt-lpnl-dropcap-btn").enable():J("#fmt-lpnl-dropcap-btn").disable()},InsertShape.createShape=function(e,t,n){if(!t||t.paraProperties&&t.paraProperties.floatImages.length>0)try{for(var i=0;i<n.length;i++){var o=InsertShape.getShapeFromFloatImages(n[i]);o&&n[i].el&&("remove"==e?InsertShape.removeFromCache(o):InsertShape.drawShapeInPara(n[i].el,o))}}catch(e){}},InsertShape.getShapeFromFloatImages=function(e){for(var t=e.floatImages,n=[],i=0;i<t.length;i++)t[i].isShape&&n.push(t[i]);return!!n.length&&n},InsertShape.getParaToShapeTop=function(e,t){var n=Z("drawcontainer").offset(),i=e.top+n.top,o=e.top+n.left,r=(J(editor.clientActiveSection),Utils.getClosestChild(t?editor.clientActiveSection:editor.editorPaneContainer[0],"span.zw-portion, span.EOP",o,i));return J(r).parents(".zw-paragraph")[0]},InsertShape.selectShapesInRange=function(){var e=editor.doc.getSelection(),t=editor.doc.getNodesInSelection(NODE_TYPE.IMAGE,e.getStart(),e.getEnd()),n=t.length;if(!n)return void InsertShape.removeShapeOverlay();for(var i=0;i<t.length;i++){var o=t[i].getStart(),r=DocUtil.copyStyle(editor.doc.getRawFormatAt(o)),a=r[ATTR_IMAGE.I_SHAPEDATA];if(a&&(JshpDiv=InsertShape.getShapeDom(a.nvOProps.nvDProps.id),JshpDiv&&0==JshpDiv.find(".shape_overlay").length)){var s=document.createElement("div"),l=a.props.transform,d=InsertShape.constant.OVERLAY_BORDER_WIDTH,c=-(d/2),u=-(d/2),p={rotate:l.rotate,pos:{top:u,left:c},dim:{height:l.dim.height+d,width:l.dim.width+d}},h=InsertShape.getTransformedSize(p);J(s).css({height:h.dim.height,width:h.dim.width,top:h.pos.top+"px",left:h.pos.left+"px","background-color":"rgba(20, 119, 255,0.3)",border:"6px solid rgba(20, 119, 255,0.4)",position:"absolute","z-index":5}).addClass("shape_overlay"),JshpDiv.prepend(s)}}EditorUtil.focusMultiByteSpan(),PubSub.subscribe("Cursor/Collapsed",InsertShape.removeShapeOverlay)},InsertShape.removeShapeOverlay=function(){editor.editorPaneContainer.find(".shape_overlay").remove(),PubSub.unsubscribe("Cursor/Collapsed",InsertShape.removeShapeOverlay)},InsertShape.removeShapeNodes=function(e){InsertShape.clearSelection();for(var t=0;t<e.length;t++)J(e[t].el).find("div.inner_shape").children("div").remove()},InsertShape.getShapeDom=function(e){var t=J(editor.clientActiveSection).find("#"+e)[0]||editor.editorPaneContainer.find("#"+e)[0];return t?J(t):void 0},InsertShape.sendErrorMail=function(e){ZWCollaboration.clientInfo+="Catch Exception  "+e,ZWCollaboration.clientInfo+=" STACKTRACE :::  "+e.stack},InsertShape.getDefaultShapeData=function(e){e||(e="SHAPE");var t=JSON.parse(InsertShape.defaultData[e]);return t.nvOProps.nvDProps.id=Math.uuid(),t},InsertShape.getOverlayTransformProps=function(){var e=0,t=0,n=0,i=J(".overlay");if(!i.length)return{top:0,left:0,height:0,width:0};i.each(function(){var i=J(this),o=i.find(".zw-table");o.length?(e+=i.height()/i.parents("tr").find("td").length,n=i.width()/i.parents("tr").find("td").length,n>t&&(t=n)):(e+=i.height(),n=i.width(),n>t&&(t=n))});var o=0;1==i.length&&(o=parseInt(i.first().css("left"),10));var r=i.first().parents(".zw-paragraph").offset().top,a=i.first().offset().top-r;return{top:a,left:o,height:e,width:t}},InsertShape.updateTransformPropWithOverlayOffset=function(e){var t=InsertShape.getOverlayTransformProps();return e.props.transform.dim.height=t.height,e.props.transform.dim.width=t.width+20,e.props.transform.pos.top=t.top,e.props.transform.pos.left=t.left,e},InsertShape.convertSelectedTextToPullquote=function(e){var t=InsertShape.getTextboxTemplateData(e);return InsertShape.pushSelectedTextToShape(t),InsertShape.updateTransformPropWithOverlayOffset(t),t.wrapType="square",InsertShape.moveCursorIdx(editor.doc.getSelection().getStart()),InsertShape.insertShape(t),t},InsertShape.pushSelectedTextToShape=function(e){var t=editor.doc.getSelection(),n=t.getLastRange();t.removeAllRanges().addRange(n).deleteSelectedContents(null,!0);for(var i=editor.doc.contStr.substring(t.getStart(),t.getEnd()),o=i.split("\n"),r=0;r<o.length;r++){var a=o[r],s=void 0;if(e.textBody.paras[r])s=e.textBody.paras[r];else{var l=JSON.stringify(e.textBody.paras[e.textBody.paras.length-1]);s=JSON.parse(l)}var d=s.portions.splice(0,1)[0];d.t=a.length>0?a:"",s.portions[0]=d,e.textBody.paras[r]=s;var l=JSON.stringify(e.textBody.paras[e.textBody.paras.length-1]);s=JSON.parse(l)}return e},InsertShape.convertSelectedTextToInsertPullquote=function(e){var t=InsertShape.getTextboxTemplateData();return t.textBody.paras[0].portions[0].t="",InsertShape.updateTransformPropWithOverlayOffset(t),InsertShape.pushSelectedTextToShape(t),t.wrapType="square",InsertShape.moveCursorIdx(editor.doc.getSelection().getStart()),InsertShape.insertShape(t),t},InsertShape.pushSelectedTextToInsertShape=function(e){var t=editor.doc.getSelection();t.getLastRange();t.deleteSelectedContents();var n=editor.doc.snapShotManager.getReverseOp(Op.msgBuffer[0]),i=[];i.push(n);var o=ShapePaste.convertPasteOp(i),r=e,a={Beforeparas:{},Aftereparas:{}},s=ShapeEditor.text.getObject();return a.Beforeparas=[r.textBody.paras[0]],a.Aftereparas=[r.textBody.paras[0]],s.from.para=0,s.from.ch=0,s.from.portion=0,s.to.para=0,s.to.ch=0,s.to.portion=0,processedPara=ShapePaste.fillParas(a,o,s),e.textBody.paras=processedPara.paras,e},InsertShape.convertParaToPullquote=function(){var e=InsertShape.getTextboxTemplateData("box5"),t=J(editor.doc.getCursorPortionNode(editor.uuid,"start")).parents("div.zw-paragraph"),n=DocUtil.getDocElement(t[0]).dtNode,i=editor.doc.contStr.substring(n.start,n.end),o=editor.doc.getSelection(),r=editor.doc.createRange(n.start,n.end);o.removeAllRanges().addRange(r).deleteSelectedContents(null,!0),e.textBody.paras[0].portions[0].t=i,e.props.transform.dim.height=t.height()+30,e.props.transform.dim.width=t.width(),e.props.transform.pos.top=0,e.props.transform.pos.left=0,InsertShape.insertShape(e)},InsertShape.insertMergeFields=function(e){for(var t=e[1],n=t.hasOwnProperty(MAILMERGE.GROUP_NAME)?t[MAILMERGE.GROUP_NAME]+"."+t[MAILMERGE.FIELD_NAME]:t[MAILMERGE.FIELD_NAME],i=InsertShape.getSelectedShapesArray(),o=0;o<i.length;o++){i.length>1&&(InsertShape.clearSelection(),InsertShape.select.shape(i[o]));var r=i[o].data,a=(r.nvOProps.nvDProps.id,DocUtil.copyStyle(editor.doc.getRawFormatAt(InsertShape.getShapeIdx(i[o])))),s=a[MAILMERGE.MMINFOS]||{};s[n]=t,InsertShape.insertFieldInShape(i[o],UNICODE.MERGEFIELD_START+n+UNICODE.MERGEFIELD_END,{mminfos:s},t)}InsertShape.select.shape(i)},InsertShape.insertFieldInShape=function(e,t,n,i){if(InsertShape.mergeWithFormats=J.extend(!0,InsertShape.mergeWithFormats,n),!ShapeEditor.text.isEditable()){InsertShape.editShape(-1);var o=ShapeEditor.text.editor.getCursorIndex().ei;ShapeEditor.text.editor.select.select(o,o)}ShapePaste.init(t,i)},InsertShape.getTransformedSize=function(e){if(e.rotate){var t=Utils.getTransformedSize(e.rotate,e.dim.width,e.dim.height);e.pos.left-=(t.width-e.dim.width)/2,e.pos.top-=(t.height-e.dim.height)/2,e.dim.height=t.height,e.dim.width=t.width}return e},InsertShape.getShapeFrameProp=function(e,t){var n=10;e.shapes||(n+=e.props.stroke&&e.props.stroke.width||10);var i=J.extend(!0,{},e.props.transform);if(t){var o=J.ShapeData.getShapeData(t).props.transform,r=i.dim.height,a=i.dim.width,s=o.dim.height-o.chDim.height,l=o.dim.width-o.chDim.width;r+=s,a+=l,i.dim.height=r,i.dim.width=a}if(i.pos.left=0,i.pos.top=0,e.props.effects&&(i.dim.height*=2,i.dim.width*=2),e.props.geom&&e.props.geom.preset&&e.props.geom.preset.type.indexOf("CALLOUT")!=-1){var d=i.dim.width/2;i.pos.left-=d,i.dim.width+=d}return i.rotate&&(i=InsertShape.getTransformedSize(i)),{top:i.pos.top-n/2,left:i.pos.left-n/2,width:i.dim.width+n,height:i.dim.height+n}},InsertShape.renewShape=function(e){e=e.data||e;var t=e.shapes;return t&&J.each(t,function(e,n){n.nvOProps.nvDProps.id=Math.uuid(),t[e]=n}),e.nvOProps.nvDProps.id=Math.uuid(),e},InsertShape.positionScalespan=function(){J("#scaleSpan").css({top:J("#ui-editor-outer-div").scrollTop()})},InsertShape.hideEditorCursor=function(){CurUtil.stopBlinking(),CurUtil.setCursorVisiblity(!1)},InsertShape.showEditorCursor=function(){CurUtil.blinkCursor(),CurUtil.setCursorVisiblity(!0)};var defaultParaFmt=InsertShape.getDefaultShapeData().textBody.paras[0],defaultPortionFmt=InsertShape.getDefaultShapeData().textBody.paras[0].portions[0],emptydummyPara={portions:[],style:{halign:"LEFT",level:1,margin:{left:0},dir:"LTR",defPrProps:{font:{fontFamily:{name:"Arial"},ref:"MINOR"},fill:{type:"SOLID",solid:{color:{type:"TX1",rgb:{0:0,1:0,2:0}}}},size:18,stroke:{type:"SOLID",width:2.6666667,fill:{type:"SOLID",solid:{color:{type:"A1",tweaks:{shade:.5},rgb:[56,93,138]}}},captype:"FLAT"}},spacing:{line:{type:"PERCENT",percent:"1.2"}},listStyle:{bullet:{type:"NONE",status:"disabled"}}},unmerged:{style:{halign:"LEFT",level:1,margin:{left:0},dir:"LTR",defPrProps:{font:{fontFamily:{name:"Arial"},ref:"MINOR"},fill:{type:"SOLID",solid:{color:{type:"TX1",rgb:{0:0,1:0,2:0}}}},size:18,stroke:{type:"SOLID",width:2.6666667,fill:{type:"SOLID",solid:{color:{type:"A1",tweaks:{shade:.5},rgb:[56,93,138]}}},captype:"FLAT"}},spacing:{line:{type:"PERCENT",percent:"1.2"}}}},listNum:!1};ShapePaste.fontFamiliesInPaste=[];var from_Char,from_Portion,from_Para,textlength,portionslength,to_Char,to_Portion,to_Para;ShapePaste.init=function(e,t,n){var i=InsertShape.getSelectedShapesArray(),o=null,r=i.length>1;InsertShape.PasteOp=DocOpBuilder.build(PasteUtil.getOpForCustomConent());var a,s,l=n==CONST.PASTE_TEXTONLYFORMAT;if(r)InsertShape.clearSelection();else if(ShapeEditor.text.isEditable()){var d=ShapeEditor.text.editor._getFromTo().from.num.index,c=ShapeEditor.text.editor._getFromTo().to.num.index;o=d,InsertShape.updateShapeText(i[0],!0),InsertShape.editShape(d,c)}if(!l){var u=[],p=InsertShape.PasteOp.toString();u.push(JSON.parse(p)),a=ShapePaste.convertWriterOpToShapeData(u)}1==i.length&&o!=-1&&(o+=e.length,a&&a.paras.length&&(o+=a.paras.length));for(var h=0;h<i.length;h++){var f=i[h],m=f.data;if(r&&(InsertShape.select.shape(m),InsertShape.editShape(-1)),l||t){var g={paras:[],portions:[]},T=ShapePaste.getCursorProperty().from,_=f.data.textBody.paras[T.para].portions[T.portion],E=J.extend(!0,{},_);t&&(E.mminfo=t),E.t=e,g.portions.push(E),a=g}s=ShapePaste.processShape(a),m.textBody.paras=s.paras,InsertShape.isTextModified=null,InsertShape.applyStyle(f,!0)}!r&&f.parentIds[0]?(InsertShape.select.shape(f.parentIds[0]),o=-1):InsertShape.select.shape(i),InsertShape.editShape(o,o)},ShapePaste.convertWriterOpToShapeData=function(e){var t=0,n=0,o=e,r={paras:[],portions:[]};ShapePaste.fontFamiliesInPaste=[];var a,s,l,d=[];for(j=0;j<o.length;j++){var c=o[j];for(i=0;i<c.length;i++){if(c[i].as&&c[i].as.start){var u=c[i].as.start;if("listFormat"==u.st)l=u;else if("paragraph"==u.type){s=$.extend(!0,{},defaultPortionFmt);var p=u;DocUtil.constructRenderingFormat(p),DocUtil.constructRenderingFormat(p),a=ShapePaste.fillParagraphFmt(p,l,d)}else{var h=u;DocUtil.constructRenderingFormat(h),s=ShapePaste.fillPortionFmt(h)}}if(c[i].is){var f=c[i].is,m={TABLE:"",ROW:"",CELL:"",TABLEEND:"",IMAGE:"",IFRAME:"",RANGE_START:"",RANGE_END:"",MULTIBYTE_SPACE:"",SECTION_START:"",HR:"\r",TOCEND:"",TOCSTART:"",MERGEFIELD_START:"",MERGEFIELD_END:""};f=f.replace(new RegExp(m.RANGE_END+"|"+m.MULTIBYTE_SPACE+"|"+m.SECTION_START+"|"+m.HR+"|"+m.TOCEND+"|"+m.TOCSTART+"|"+m.MERGEFIELD_START+"|"+m.MERGEFIELD_END+"|"+m.IMAGE+"|"+m.IFRAME+"|"+m.RANGE_START+"|"+m.TABLE+"|"+m.ROW+"|"+m.CELL+"|"+m.TABLEEND,"g"),""),"\v"==f?(s.type="LINEBREAK",d[n]=s,n++):""!=f&&"\n"!=f?(s.t=f,d[n]=s,n++):"\n"==f&&(d.length>0&&(a.portions=d),d=[],r.paras[t]=a,n=0,t++,a=$.extend(!0,{},defaultParaFmt))}}}return d.length>0&&(r.portions=d),r},ShapePaste.fillPortionFmt=function(e){if(dummyPortionFmt=$.extend(!0,{},defaultPortionFmt),e.ff){var t=e.ff;t=t.split(",")[0],dummyPortionFmt.props.font.fontFamily.name=t,ShapePaste.fontFamiliesInPaste.indexOf(t)==-1&&ShapePaste.fontFamiliesInPaste.push(t)}if(e.fgc){var n=e.fgc,i=ShapePaste.getColor(n);dummyPortionFmt.props.fill.solid.color.rgb=i}else 1==ShapeEditor.select.shapes[0].data.textBox&&(dummyPortionFmt.props.fill.solid.color.rgb=[0,0,0]);if(e.size){var o=e.size;dummyPortionFmt.props.size=o}if("bold"==e.fw&&(dummyPortionFmt.props.bold=!0),"italic"==e.fs&&(dummyPortionFmt.props.italic=!0),e.td){var r=e.td;r.indexOf("underline")!=-1&&(dummyPortionFmt.props.underline="SINGLE"),r.indexOf("line-through")!=-1&&(dummyPortionFmt.props.strike="SINGLE")}"super"==e.va&&(dummyPortionFmt.props.baseline=.3),"sub"==e.va&&(dummyPortionFmt.props.baseline=-.25),dummyPortionFmt.unmerged={props:dummyPortionFmt.props};$.extend({},dummyPortionFmt.props);return dummyPortionFmt},ShapePaste.fillParagraphFmt=function(e,t,n){if(dummyParaFmt=$.extend(!0,{},defaultParaFmt),e.ml){var i=e.ml;if(/px$/i.test(i))i=parseFloat(i);else{var o=i.convertor();i=parseFloat(o.pixels.toFixed(3))}dummyParaFmt.style.margin.left=i}if(e.ti){var i=e.ti.replace("in","");i=parseFloat(i);var r=72*i;dummyParaFmt.style.indent=r}if(e.ls_data){if(dummyParaFmt.style.listStyle.bullet={number:{},character:{}},dummyParaFmt.style.listStyle.font={fontFamily:{name:"Arial"}},dummyParaFmt.style.listStyle.color={rgb:[255,255,255]},e.ml){var i=e.ml.replace("in","");i=parseFloat(i);var a=72*i;dummyParaFmt.style.margin.left=a}dummyParaFmt=ShapePaste.listStyle(e,dummyParaFmt,n);var s,l,d=e.ls_data.id,c=e.ls_data.l,u=ShapePaste.getListProperties();if(dummyParaFmt.listNum=1,dummyParaFmt.style.level=c+1,null!=editor.doc.getListType(d,c))l=editor.doc.getListType(d,c),s=u[l],dummyParaFmt.style.listStyle.bullet=s;else{var p=t[d],h="level";l=p[h+c].type,8==l&&(dummyParaFmt.style.listStyle.font.fontFamily.name="Wingdings"),s=u[l],dummyParaFmt.style.listStyle.bullet=s}}if(e.al){var f=e.al;1==f?dummyParaFmt.style.halign="CENTER":2==f&&(dummyParaFmt.style.halign="RIGHT")}if(e.sa){var m=e.sa,g=m.convertor().pixels;dummyParaFmt.style.spacing.after={absolute:g,type:"ABSOLUTE"}}if(e.sb){dummyParaFmt.style.spacing.before={};var T=e.sb,_=T.convertor().pixels;dummyParaFmt.style.spacing.before={absolute:_,type:"ABSOLUTE"}}if(e.ls){var E=e.ls,v=parseFloat(E)||1;dummyParaFmt.style.spacing.line.percent=v}return dummyParaFmt.unmerged={style:dummyParaFmt.style},dummyParaFmt},ShapePaste.listStyle=function(e,t,n){var i={},o=12,r="Arial",a=[255,255,255],s=12,l=[255,255,255];return e.ts&&(i=e.ts),i.ff?(r=i.ff,r=r.split(",")[0],t.style.listStyle.font.fontFamily.name=r):(n.length>0&&n[0].props.font.fontFamily.name&&(r=n[0].props.font.fontFamily.name,r=r.split(",")[0],t.style.listStyle.font.fontFamily.name=r),t.style.listStyle.font.fontFamily.name=r),i.fgc?(a=i.fgc,l=ShapePaste.getColor(a),t.style.listStyle.color.rgb=l):(n.length>0&&n[0].props.fill.solid.color.rgb&&(a=n[0].props.fill.solid.color.rgb,l=ShapePaste.getColor(a)),t.style.listStyle.color.rgb=l),n.length>0&&n[0].props.size&&(o=n[0].props.size),i.size?(s=i.size,s=parseFloat(s/o),t.style.listStyle.size=s):(s=parseFloat(s/o),t.style.listStyle.size=s),t},ShapePaste.getColor=function(e){var t=[0,0,0];try{if(e.indexOf("#")!==-1){var n=hexToRgb(e);t[0]=n.r,t[1]=n.g,t[2]=n.b}else if(e.indexOf("rgb(")!==-1)t=e.replace(/rgb\(| |\)/g,"").split(",");else if(e.indexOf("rgba(")!=-1){var i=e.replace(/rgba\(| |\)/g,"").split(","),o=i[3],r=255,a=Math.round((1-o)*r+o*i[0]),s=Math.round((1-o)*r+o*i[1]),l=Math.round((1-o)*r+o*i[2]);t=[a,s,l]}}catch(e){}return t},ShapePaste.getListProperties=function(){var e={0:{number:{type:"NUMERIC",suffix:"."},status:"enabled",type:"NUMBER"},1:{number:{type:"LCROMAN",suffix:"."},status:"enabled",type:"CHARACTER",character:{ch:"8226"}},2:{number:{type:"LCROMAN",suffix:"."},status:"enabled",type:"NUMBER"},3:{number:{type:"UCALPHABET",suffix:"."},status:"enabled",type:"NUMBER",character:{ch:"8226"}},4:{number:{type:"LCALPHABET",suffix:"."},status:"enabled",type:"NUMBER"},5:{number:{type:"NUMERIC",suffix:"."},status:"enabled",type:"CHARACTER",character:{ch:"113"}},6:{number:{type:"NUMERIC",suffix:"."},status:"enabled",type:"CHARACTER",character:{ch:"8226"}},7:{number:{type:"NUMERIC",suffix:"."},status:"enabled",type:"CHARACTER",character:{ch:"111"}},8:{type:"CHARACTER",number:{type:"NUMERIC",suffix:"."},character:{ch:"167"},status:"enabled"}};return e},ShapePaste.getCursorProperty=function(){var e=ShapeEditor.text.getObject();return void 0==e.from.para&&void 0==e.to.para&&(e.from={para:0,ch:0,portion:0},e.to={para:0,ch:0,portion:0}),e},ShapePaste.processShape=function(e){var t,n=ShapeEditor.text.getObject(),i=ShapeEditor.select.shapes[0].data,o=$.extend({},i.textBody);return from_Char=n.from.ch,from_Portion=n.from.portion,from_Para=n.from.para,to_Char=n.to.ch,to_Portion=n.to.portion,to_Para=n.to.para,void 0!=from_Para&&(portionslength=o.paras[from_Para].portions.length,void 0!=o.paras[from_Para].portions[from_Portion].t?textlength=o.paras[from_Para].portions[from_Portion].t.length:o.paras[from_Para].portions[from_Portion].type&&"LINEBREAK"==o.paras[from_Para].portions[from_Portion].type&&(textlength=0)),1==o.paras.length&&1==o.paras[0].portions.length&&void 0==o.paras[0].portions[0].t?t=ShapePaste.processEmptyPara(e,o):0==from_Portion&&from_Char==-1||from_Portion==portionslength-1&&from_Char==textlength?t=ShapePaste.processParaStart(e,o):from_Para==to_Para&&from_Char==to_Char&&(from_Portion>0||from_Char>-1)?t=ShapePaste.processParaCenter(e,o):from_Char!=to_Char?t=ShapePaste.processSelectionPara(e,o):void 0==from_Para&&(t=ShapePaste.processNoCursor(e,o)),i.textBody.paras=t.paras,i.textBody},ShapePaste.processNoCursor=function(e,t){var n=[InsertShape.getDefaultShapeData().textBody.paras[0]];return 0==e.paras.length?(n[0].portions=e.portions,t.paras=n):e.paras.length>0&&(t.paras=e.paras,e.portions.length>0&&(n[0].portions=e.portions,t.paras=t.paras.concat(n))),t},ShapePaste.processSelectionPara=function(e,t){var n=JSON.parse(JSON.stringify(t)),i=JSON.parse(JSON.stringify(t)),o=n.paras.slice(0,from_Para+1),r=o[from_Para].portions.slice(0,from_Portion+1),a=r[from_Portion].t.slice(0,from_Char);r[from_Portion].t=a,o[from_Para].portions=r;var s=i.paras.slice(to_Para),l=s[0].portions.slice(to_Portion),d=l[0].t.slice(to_Char+1);l[0].t=d,s[0].portions=l;var c;if(0==e.paras.length){var u=o[from_Para].portions.concat(e.portions);o[from_Para].portions=u,c=o.concat(e.paras);var p=c[c.length-1].portions.concat(s[0].portions);c[c.length-1].portions=p,s.splice(0,1)}else if(e.paras.length>0){var h=o[from_Para].portions.concat(e.paras[0].portions);o[from_Para].style=e.paras[0].style,o[from_Para].portions=h,e.paras.splice(0,1),c=o.concat(e.paras),e.portions.length>0&&(s[0].portions=e.portions.concat(s[0].portions))}var f=c.concat(s);return t.paras=f,t},ShapePaste.processParaCenter=function(e,t,n){var i=JSON.parse(JSON.stringify(t)),o=JSON.parse(JSON.stringify(t)),r=i.paras.slice(0,from_Para+1),a=r[from_Para].portions.slice(0,from_Portion+1),s=a[from_Portion].t.slice(0,from_Char+1);a[from_Portion].t=s,r[from_Para].portions=a;var l=o.paras.slice(to_Para),d=l[0].portions.slice(to_Portion),c=d[0].t.slice(to_Char+1);d[0].t=c,l[0].portions=d;var u;if(0==e.paras.length){u=r.concat(e.paras);var p=r[from_Para].portions.concat(e.portions);r[from_Para].portions=p;var h=u[u.length-1].portions.concat(l[0].portions);u[u.length-1].portions=h,l.splice(0,1)}else if(e.paras.length>0){var f=r[from_Para].portions.concat(e.paras[0].portions);r[from_Para].style=e.paras[0].style,r[from_Para].portions=f,e.paras.splice(0,1),u=r.concat(e.paras),e.portions.length>0&&(l[0].portions=e.portions.concat(l[0].portions))}var m=u.concat(l);return t.paras=m,t},ShapePaste.processParaStart=function(e,t,n){var i=[];if(1==t.paras.length){if(from_Portion==portionslength-1&&from_Char==textlength){var o=[t.paras[0]];if(0==e.paras.length){var r=e.portions,a=o[0].portions.concat(r);o[0].portions=a,t.paras=o}else if(e.paras.length>0){i=JSON.parse(JSON.stringify(o));var s=o[0].portions.concat(e.paras[0].portions);o[0].style=e.paras[0].style,o[0].portions=s,e.paras.splice(0,1);var l=e.paras,d=o.concat(l);t.paras=d,e.portions.length>0&&(i[0].portions=e.portions,t.paras=t.paras.concat(i))}}else if(0==from_Portion&&from_Char==-1){var o=[t.paras[0]];if(0==e.paras.length){var r=e.portions,a=r.concat(o[0].portions);o[0].portions=a,t.paras=o}else if(e.paras.length>0){var l=e.paras;e.portions.length>0&&(o[0].portions=e.portions.concat(o[0].portions));var d=l.concat(o);o=d,t.paras=o}}}else if(t.paras.length>0){var c=t.paras.slice(0,from_Para),u=[t.paras[from_Para]],p=t.paras.slice(to_Para+1);if(u[0].portions[0].t||(u[0].portions.length>0&&!e.portions.length>0?u.splice(0,1):u[0].portions.splice(0,1)),from_Portion==portionslength-1&&from_Char==textlength){if(0==e.paras.length){var r=e.portions,a=u[0].portions.concat(r);u[0].portions=a}else if(e.paras.length>0){i=[$.extend({},u[0])];var s=u[0].portions.concat(e.paras[0].portions);u[0].style=e.paras[0].style,u[0].portions=s,e.paras.splice(0,1),e.portions.length>0&&(i[0].portions=e.portions)}var h=e.paras,f=c.concat(u),m=f.concat(h),g=m.concat(i),T=g.concat(p);t.paras=T}else if(0==from_Portion&&from_Char==-1){if(0==e.paras.length){var r=e.portions,a=r.concat(u[0].portions);u[0].portions=a}else e.paras.length>0&&u.length>0&&(u[0].portions=e.portions.concat(u[0].portions));var h=e.paras,m=c.concat(h),f=m.concat(u),_=f.concat(p);t.paras=_}}return t},ShapePaste.processEmptyPara=function(e,t){if(0==e.paras.length)t.paras[0].portions=e.portions;else if(e.paras.length>0){var n=$.extend({},t);t.paras=e.paras,e.portions.length>0&&(n.paras[0].portions=e.portions,t.paras=t.paras.concat(n.paras))}return t},ShapePaste.drawPastedShape=function(e){var t=$("#drawcontainer");$(document).zshapeintegrator({container:t}),$(document).zshapeintegrator("draw",e,t);var n=$(".zw-paragraph"),i=n.find("div.inner_shape");Shape.create.draw(e,i);$.ShapeData.updateShapes(e)},hexToRgb=function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,n,i){return t+t+n+n+i+i});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null},DocumentMap=function(){var e,t={},n={},i={},o=function(){},r=!1,a=null,s=!0;state="dirty";var l=function(e){var t;do t=e.prev,e=t;while(t&&"para"!=t.type);return t},d=function(e){var t;do t=e.next,e=t;while(t&&"para"!=t.type);return e},c=function(e){var n;do n=e.prev,e=t[n];while(e&&(e.level<=0||e.level>6));return e},u=function(e){var n;do n=e.next,e=t[n];while(e&&(e.level<=0||e.level>6));return e},p=function(e){var i,o,s,p,h=e.id;if("content"==e.section.name&&(M(e,"addOrUpdate"),e.parent==e.section)){if(!r)return void(state="dirty");if(i=l(e),o=d(e),t[h]||(t[h]={}),extend(t[h],{id:h,prev:i&&i.id||null,next:o&&o.id||null,level:e.paraProperties.level}),i?t[i.id]&&(t[i.id].next=h):t.head=h,o&&t[o.id]&&(t[o.id].prev=h),e.paraProperties.level>0&&e.paraProperties.level<=6){s=c(t[h]),p=u(t[h]),n[h]?J(n[h].el).remove():n[h]={};var f=J('<div class="ui-doc-nav-h'+e.paraProperties.level+'"><span class="doc-nav-marker" style="display:inline-block;width:17px;cursor:pointer;"></span><span class="doc-nav-map-txt"></span></div>');f.find(".doc-nav-map-txt").text(e.content().replace(/^\s+|\s+$/g,"")),extend(n[h],{id:h,node:e,prev:s&&s.id||null,next:p&&p.id||null,level:e.paraProperties.level,el:f}),r&&O(n[h],f[0]),s?n[s.id]&&(n[s.id].next=h):n.head=h,p&&n[p.id]&&(n[p.id].prev=h),s?J(n[s.id].el).after(f):p?J(n[p.id].el).before(f):a&&a.appendChild(f[0]),E(s),E(n[h]),E(p),R(f)}else e.paraProperties.level<=0&&n[h]&&g(h)}},h=function(e){if("content"==e.section.name&&(M(e,"modify"),e.parent==e.section)){if(!r)return void(state="dirty");var i=e.id;t[i].level=e.paraProperties.level,n[i]&&(n[i].level=e.paraProperties.level,n[i].level>0?(n[i].el.find(".doc-nav-map-txt").text(e.content().replace(/^\s+|\s+$/g,"")),R(n[i].el)):g(i))}},f=function(){var e=editor.doc.getElement("bookmark"),t=document.getElementById("bookmarkMap");J(t).html("");for(var n=e.length,i=0;i<n;i++)if(e[i].id.indexOf("toc_")==-1){var o=J('<div class="ui-doc-nav-h2"><span class="doc-nav-marker doc-nav-marker-parent-nosublevel" style="display:inline-block;width:17px;cursor:pointer;"></span><span class="doc-nav-map-txt doc-nav-map-txt-bookmark"></span></div>');o.find(".doc-nav-map-txt").text(e[i].name),t.appendChild(o[0]),m(e[i].id,o)}},m=function(e,t){t.find("span.doc-nav-map-txt-bookmark").click(function(){J("span.doc-nav-map-txt").removeClass("doc-nav-map-txt-selected"),J(this).addClass("doc-nav-map-txt-selected"),Utils.moveToBookmark(e)})},g=function(e){var t=n[e].prev,i=n[e].next;return r?(t&&(n[t].next=i),i&&(n[i].prev=t),J(n[e].el).remove(),delete n[e],void(n.head==e&&(n.head=i))):void(state="dirty")},T=function(e){if("content"==e.section.name&&(M(e,"remove"),e.parent==e.section)){if(!r)return void(state="dirty");var i,o,a=e.id;t[a]&&(i=t[a].prev,o=t[a].next),i&&(t[i].next=o),o&&(t[o].prev=i),n[a]&&g(a),t.head==a&&(t.head=o),delete t[a]}},_=function(e,t){for(var i=e.level,o=n[n[e.id].next];o&&o.level>i;)t?J(o.el).show():J(o.el).hide(),o=n[n[o.id].next]},E=function(e){e&&(v(e)?(J(n[e.id].el).find("span.doc-nav-marker").addClass("ui-icon ui-icon-heading-active"),J(n[e.id].el).find("span.doc-nav-marker").removeClass("doc-nav-marker-parent-nosublevel")):(J(n[e.id].el).find("span.doc-nav-marker").attr({class:"doc-nav-marker"}),J(n[e.id].el).find("span.doc-nav-marker").addClass("doc-nav-marker-parent-nosublevel")))},v=function(e){if(!e)return!1;var t=!1,i=e.level,o=n[n[e.id].next];return o&&o.level>i&&(t=!0),t},S={};S.init=function(){if(J(".ui-widget-overlay").hide(),y(),J("#documentmapzdialog").show(),J("#documentmapzdialog").draggable(),a=document.getElementById("headingMap"),n.head){for(var e,t,i=n.head,o=J(a);i;)e=n[i],t=e.prev&&n[i],o.append(e.el),O(e,e.el),i=e.next,R(e.el);state="clean"}};var b=function(e){var t=e.getIndex(),n=editor.doc.getSelection(),i=editor.doc.createRange(t);n.removeAllRanges().addRange(i),Utils.scrollElementIntoView(editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start")[0],0,!0),CurUtil.blinkCursor(),EditorUtil.focusMultiByteSpan()},R=function(e){var t=e.find("span.doc-nav-map-txt").text().replace(REGEX.docUnicodes,"");0==t.length||"[Empty Heading]"==t?(e.find("span.doc-nav-marker").removeClass("doc-nav-marker-parent-nosublevel ui-icon"),e.find("span.doc-nav-marker").removeClass("ui-icon-heading-active").html('<span class="uiicon-empty-space" style="width:7px!important;height:2px !important">&#8203;</span>'),e.find("span.doc-nav-map-txt").text(J.i18n("writer.documentmap.EMPTY_HEADING")).addClass("doc-nav-empty-heading")):e.find("span.doc-nav-map-txt").removeClass("doc-nav-empty-heading")},O=function(e,t){var n=J(t);n.find("span.doc-nav-map-txt").click(function(){J("span.doc-nav-map-txt").removeClass("doc-nav-map-txt-selected"),J(this).addClass("doc-nav-map-txt-selected"),b(e.node)}),n.find("span.doc-nav-marker").unbind().click(function(){var t=this.className||"",n=!0;t.indexOf("doc-nav-marker-parent-nosublevel")==-1&&(J(this).hasClass("ui-icon-heading-inactive")?J(this).removeClass("ui-icon-heading-inactive").addClass("ui-icon-heading-active"):(J(this).removeClass("ui-icon-heading-active").addClass("ui-icon-heading-inactive"),n=!1)),_(e,n)})},D=function(){t={},n={},a=document.getElementById("headingMap"),J(a).html("");var e=J("#fieldMap");e.html("")},y=function(){var e=J("#topband-wrapper").height(),t=editor.editorPaneContainerHt;J(".ui-doc-navigation-parent").css({height:t-90+"px"}),Z("documentmapzdialog").css({top:e+"px",height:t+"px","min-height":t+"px"})},A=function(){r||B(!1),PubSub.unsubscribe("Document/Resize",y),J("#documentmapzdialog").hide()},C=function(){var e,t,n;r=!0;try{!J("#topband-hamburger").isDisabled()&&LayoutManager.isRichEditActive()&&LayoutManager.toggleRichEdit()}catch(e){}if("dirty"==state)for(D(),n=editor.doc.getNodesInSelection(NODE_TYPE.PARAGRAPH,1,editor.doc.getSectionEnd(1)),e=0,t=n.length;e<t;e++){var i=ViewManager.getViews(n[e].dtNode);n[e].dtNode&&i&&i.length&&i[0].lines&&0!=i[0].lines.length&&p(n[e].dtNode)}k(),S.init(),Utils.addToStatistics("DocumentMap")},I=function(e){var t=e;do t=t.prev;while(t&&!P(t));return t},w=function(e){var t=e;do t=t.next;while(t&&!P(t));return t},P=function(e){var t=e.getIndex(),n=e.getEndIndex(),i=editor.doc.getContent(t,n),o=new RegExp(UNICODE.RANGE_START+"#|"+UNICODE.RANGE_START+UNICODE.MERGEFIELD_START,"gi"),r=o.exec(i);return!!r},M=function(e,t){if(e.parent!=e.section&&"cell"==e.parent.type){if("addOrUpdate"==t){var n=e.parent,o=n.parent;if(n.next||o.next)return}e=e.parent.parent.parent}var r=e.id,a=J("#fieldMap");if(i[r]&&J(i[r].el).remove(),P(e)&&"remove"!=t){for(var s=e.getIndex(),l=e.getEndIndex(),d=I(e),c=w(e),u=L(s-1),p=0,h=J("<div>");u<l&&u!=-1;){var f=editor.doc.getRawFormatAt(u),m="",g=f.type,T=f.ftype;if(g.indexOf("auto")!=-1)m="autodate"==T?f.datefmt:"autoformula"==T?f.formula:"autopno"==T?J.i18n("common","PAGE_NUMBER"):"autopcnt"==T?J.i18n("common","PAGE_COUNT"):f.val+"";else if(f.mminfo){var _=f.mminfo,E=_.groupname,v=_.display_name;m=E?E+"."+v:v,m=UNICODE.MERGEFIELD_START+m+UNICODE.MERGEFIELD_END}var S=J('<div class="doc-nav-field-map-txt ui-ellipsis" id='+p+"></div>");S.text(m.replace(/^\s+|\s+$/g,"")),N(S,e,T),h.append(S),p++,u=L(u)}if(h.children().length){i[r]={},extend(i[r],{id:r,node:e,prev:d&&d.id||null,next:c&&c.id||null,el:h});var b=!1,R=!1;d?i[d.id]&&(i[d.id].next=r,b=!0):i.head=r,c&&i[c.id]&&(i[c.id].prev=r,R=!0),c&&R?J(i[c.id].el).before(h):d&&b?J(i[d.id].el).after(h):a&&a.append(h)}}},L=function(e){var t=editor.doc.getContent(),n=editor.doc.getFormats(),i=new RegExp(UNICODE.RANGE_START+"#|"+UNICODE.RANGE_START+UNICODE.MERGEFIELD_START,"gi");i.lastIndex=e+1;for(var o=i.exec(t),r=-1;o;){r=o.index;var a=n[r];if(a.mminfo||a.type.indexOf("auto")!=-1)return r;o=i.exec(t)}return o?r:-1},N=function(e,t,n){e.click(function(){for(var e=parseInt(this.id),n=t.getIndex(),i=L(n-1),o=0;o<e;)o++,i=L(i+1);var r=editor.doc.getContent();i=r.indexOf(UNICODE.RANGE_END,i),U(i),x(i+1)})},U=function(t){var n=J(editor.doc.getPortionData(t+UNICODE.RANGE_START.length).node).prev();clearTimeout(e),o(),o=function(){n.removeClass("nav-field"),o=function(){}},e=setTimeout(o,3e3),Utils.scrollElementIntoView(n[0],500,!0),n.addClass("nav-field")},x=function(e){var t=editor.doc.getSelection(),n=editor.doc.createRange(e);t.removeAllRanges().addRange(n),CurUtil.blinkCursor(),EditorUtil.focusMultiByteSpan()},k=function(){s&&(s=!1,PubSub.subscribe("Document/Resize",y),PubSub.subscribe("Para/Create",p),PubSub.subscribe("Para/Update",p),PubSub.subscribe("Para/Modify",h),PubSub.subscribe("Para/Remove",T),PubSub.subscribe("documentMap/refresh",C),J("#doc-nav-close").click(function(){r=!1,DocumentMap.closePane(),J("#documentmapzdialog").hide()}),J("#documentPaneCombo").bind("combochange",function(e,t){"bookmark"==t.value?(f(),J("#headingMap").hide(),J("#fieldMap").hide(),J("#bookmarkMap").show()):"heading"==t.value?(J("#bookmarkMap").hide(),J("#fieldMap").hide(),J("#headingMap").show()):(J("#bookmarkMap").hide(),J("#headingMap").hide(),J("#fieldMap").show())}))},F=function(){if(r)DocumentMap.closePane(),r=!1;else{var e=editor.doc.getUserData()[editor.zuid];e&&e.showNavigationPane&&(r=!0,DocumentMap.openPane())}},Y=function(){r||B(!0),DocumentMap.refreshMap()},B=function(e){var t=editor.doc.getDocInfo(),n={};n.rid=t.RID,n.showNavigationPane=e,Utils.setCsrfParam(n),J.ajax({type:"POST",url:Utils.getNiceUrlPrefix("user/settings/shownavigationpane"),data:n,success:function(e){if("SUCCESS"==e.RESPONSE){var t=editor.doc.getUserData();t[editor.zuid].showNavigationPane=n.showNavigationPane,editor.doc.setUserData(t)}},error:function(e){}})};return{init:k,closePane:A,refreshMap:C,clearParas:D,state:state,headingParas:n,openPane:Y,togglePane:F}}(),MsgDialog=function(){"use strict";var e=null,t=null,n=null,i=null,o=function(){e()},r=function(){t()},a=function(){n()},s=function(o,r,a,s,l,d,c){var u=null,p=null,h=null;U.isArray(o)?(u=o[0],p=o[1],h=o[2]):o==CONST.MSG_TYPE_RELOAD?u=J.i18n("writer.common.RELOAD"):o==CONST.MSG_TYPE_RELOADCANCEL?(u=J.i18n("writer.common.RELOAD"),p=J.i18n("writer.common.CANCEL")):o==CONST.MSG_TYPE_CONFIRM?(u=J.i18n("writer.common.OK"),p=J.i18n("writer.common.CANCEL")):o==CONST.MSG_TYPE_YESNO?(u=J.i18n("writer.common.YES"),p=J.i18n("writer.common.NO")):o==CONST.MSG_TYPE_ALERT&&(u=J.i18n("writer.common.OK")),d?(e=function(){o==CONST.MSG_TYPE_RELOAD?document.location.reload():d(CONST.BUTTON_1_CLICKED),J("#msgdlgzdialog").dialog("close")},t=function(){d(CONST.BUTTON_2_CLICKED),J("#msgdlgzdialog").dialog("close")},n=function(){d(CONST.BUTTON_3_CLICKED),J("#msgdlgzdialog").dialog("close")},i=function(){d(CONST.BUTTON_3_CLICKED),J("#msgdlgzdialog").dialog("close")}):c?(i=function(){J("#msgdlgzdialog").dialog("close")},e=function(){i(),c(CONST.BUTTON_1_CLICKED)},t=function(){i(),c(CONST.BUTTON_2_CLICKED)},n=function(){i(),c(CONST.BUTTON_3_CLICKED)}):e=t=n=function(){J("#msgdlgzdialog").dialog("close")};var f={init:function(){var e=J("#messagedialog"),t=J("#messagedlgbtn_1"),n=J("#messagedlgbtn_2"),i=J("#messagedlgbtn_3");if(r&&"info"!=r&&e.find(".ui-wdialog-info").addClass("ui-wdialog-"+r),null!=h&&J(".ui-wdialog").addClass("ui-wdialog-extn"),u?t.button("option","label",u):t.remove(),p?n.button("option","label",p):n.remove(),h?i.button("option","label",h):i.remove(),e.find(".ui-msg-content").html(s),e.find(".ui-wdialog-title").text(a),l)return void l()}};J.dialogutil.open("msgdlg",null,f)};return{showMessage:s,execCallback_1:o,execCallback_2:r,execCallback_3:a}}(),function(e){var t={},n=function(e,t){e=jsStaticURL+e;var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&(200===n.status?t(!0,n.responseText):t(!1))},n.open("GET",e,!0),n.send(null)},i=function(e,t){e=cssStaticURL+e;var n=document.createElement("link");return n.type="text/css",n.rel="stylesheet",n.href=e,document.getElementsByTagName("head")[0].appendChild(n),t(!0),e},o=function(){var e=function(e){e=jsStaticURL+e;var t=document.createElement("script");return t.type="text/javascript",t.charset="utf-8",t.async=!0,t.src=e,t};return function(t,n){var i=e(t);i.attachEvent?i.attachEvent("onreadystatechange",n.bind(this,!0)):(i.addEventListener("load",n.bind(this,!0),!1),i.addEventListener("error",n.bind(this,!1),!1));var o=document.getElementsByTagName("head")[0];o.appendChild(i)}}(),r=function(e,t){this.list=e,this.cb=t};r.prototype.resolve=function(e){var t=this.list.indexOf(e);t>-1&&this.list.splice(t,1),this.list.length||this.cb()};var a=function(e,a,s){var l=e.js||[],d=e.css||[],c=e.html||[],u=[].concat(l).concat(d).concat(c),p=new r(u,a);u.length||a();for(var h=function(e,n,i,o){if(i)t[e]=!n||o,p.resolve(e);else{var r=new Error("Script download failed: "+e);s&&s(r)}},f=0;f<d.length;f++){var m=d[f];t[m]?p.resolve(m):i(m,h.bind(this,m,!1))}for(var f=0;f<c.length;f++){var m=c[f];t[m]?p.resolve(m):n(m,h.bind(this,m,!0))}for(var f=0;f<l.length;f++){var m=l[f];t[m]?p.resolve(m):o(m,h.bind(this,m,!1))}},s=function(e,n){if(!n)return e;var i=n.reduce(function(e,n){return e[n]=t[n],e},{});return e=e.concat(i)},l=function(e,t,n,i,o){a(e,function(){t=t.map(function(e){if(window[e])return window[e];var t=new Error("Module {{name}} not loaded yet.".replace("{{name}}",e));throw i&&i(t),t}),t=s(t,e.html),n.apply(o,t)},i)},d=function(t,n,i,o,r,l){a(n,function(){i=i.map(function(e){if(window[e])return window[e];var t=new Error("Module {{name}} not loaded yet.".replace("{{name}}",e));throw r&&r(t),t}),i=s(i,n.html);var a=o.apply(l,i);e[t]=a},r)};e.zw=e.zw||{},e.zw.require=l,e.zw.define=d}(window);var NoteViewObject=function(){"use strict";function e(e){this.orderedNotes=[],this.allViews={},this.type=e}var t=function(e,t){return e.node.rangeIndex-t.node.rangeIndex},n=function(e,t){var n=t.length,i="",o="",r=e%n,a=Math.ceil(e/n);0==r&&(r=n),i=t[r-1];for(var s=0;s<a;s++)o+=i;return o},i=function(e,t){var i,o=editor.doc.getBodyFormat()[e]||{stnum:1,fmt:"num"},r=parseInt(o.stnum),a=o.fmt;return t+=r,i="chicago"==a?n(t,o.refchars):List.bullet_str(t,a)};return e.prototype.addView=function(e){e&&(this.orderedNotes.push(e),this.sortNotes(),this.allViews[e.node.sid]=e)},e.prototype.removeView=function(e){e&&(this.orderedNotes.splice(e.number,1),this.sortNotes(),delete this.allViews[e.node.sid])},e.prototype.sortNotes=function(){this.orderedNotes.sort(t);for(var e,n,o=0,r=0,a=this.orderedNotes.length;r<a;r++)e=this.orderedNotes[r],e&&(e.number=r,n=e.node.format.refchar,n||(n=i(this.type,o),o++),e.referenceChar=Utils.encodeHTMLString(n),e.referenceCharWidth=FontUtils.getCharSize(e.referenceChar,e.getFontString()).width)},e.prototype.updateNoteReferenceChar=function(){var e,t;for(e in this.allViews)t=this.allViews[e],t&&t.updateNoteReferenceChar()},e.prototype.getOrderedNotes=function(){return this.orderedNotes},e.prototype.getViews=function(){return this.allViews},e.prototype.getSortedViewIndex=function(e){for(var t,n=0,i=this.orderedNotes.length;n<i;n++)if(t=this.orderedNotes[n],t.node.start<=e&&e<t.node.end)return n;return-1},e.prototype.getViewsBetween=function(e,t){var n=this.getSortedViewIndex(e),i=this.getSortedViewIndex(t);return n<i?this.orderedNotes.slice(n,i+1):this.orderedNotes.slice(i,n+1)},e.prototype.getViewAtSortedIndex=function(e){return this.orderedNotes[e]||null},e.prototype.destroy=function(){this.orderedNotes=[],this.allViews={}},e}(),NoteViewCollection=function(){var e,t,n,i=function(){e={},t=new NoteViewObject(ATTR_BODY.DS_EN),n=new NoteViewObject(ATTR_BODY.DS_FN)},o=function(){e={},t.destroy(),n.destroy()},r=function(){return t.getViews()},a=function(){return n.getViews()},s=function(e,n){return t.getViewsBetween(e,n)},l=function(e,t){return n.getViewsBetween(e,t)},d=function(e,t,n){return"endnote"===e?s(t,n):l(t,n)},c=function(e,t,n){var i=[],o=d(e,t,n);len=o.length;for(var r=0;r<len;r++)i[r]={start:o[r].node.start+1,end:o[r].node.end};return len>0&&(i[0].start=t,i[len-1].end=n),i},u=function(e){return"endnote"===e.type?f(e.node.start):g(e.node.start)},p=function(e){return"endnote"===e.type?h(e.node.start):m(e.node.start)},h=function(e){var n=t.getSortedViewIndex(e)+1;return t.getViewAtSortedIndex(n)},f=function(e){var n=t.getSortedViewIndex(e)-1;return t.getViewAtSortedIndex(n)},m=function(e){var t=n.getSortedViewIndex(e)+1;return n.getViewAtSortedIndex(t)},g=function(e){var t=n.getSortedViewIndex(e)-1;return n.getViewAtSortedIndex(t)},T=function(){return t.getOrderedNotes()},_=function(e){return E(e)[0].getRangeElement()},E=function(t){return e[t]||[]},v=function(e){var t=new Views[e.name](e);return t.create(),ViewManager.addNoteView(t),t},S=function(i){e[i.node.sid]||(e[i.node.sid]=[]),e[i.node.sid].push(i),"footnote"==i.type?n.addView(i):t.addView(i)},b=function(i){delete e[i.node.sid],"footnote"==i.type?n.removeView(i):t.removeView(i)},R=function(e){e?"endnote"===e?t.updateNoteReferenceChar():n.updateNoteReferenceChar():(n.updateNoteReferenceChar(),t.updateNoteReferenceChar())},O=function(e){var t;switch(e.name){case"footnote":t=ViewManager.getColumnAtIndex(e.rangeIndex);break;case"endnote":for(var n,i,o=E(e.sid)[0],r=ViewManager.pages.last,t=r.content.columns.last;t;){if(t.endNoteViews.isEmpty()){i=t.next||t.columnInNextPage();break}t=t.prev||t.columnInPrevPage()}if(i!=ViewManager.pages.last.content.columns.last&&i)for(t=i;(t.next||t.columnInNextPage())&&(n=t.endNoteViews.last,!(n.number>o.number));)t=t.next||t.columnInNextPage();else t=ViewManager.pages.last.content.columns.last}return t},D=function(e){"endnote"===e?t.sortNotes():n.sortNotes()},y=function(e,t){var n,i=e.id||e.fid||e.sid;n=E(i)[0],n||(n=v(DocTreeManager.getMetaSection(i))),n.setRangeElement(t)},A=function(e){for(var t=ViewManager.getViews(e)||[],n=E(e.section.sid)[0];t.length;)view=lastElementOf(t),n.removeView(view)};return{getEndNoteViews:r,getFootNoteViews:a,getEndNoteViewsBetween:s,getFootNoteViewsBetween:l,getNoteViewsBetween:d,getNoteRangesBetween:c,getPreviousNoteView:u,getNextNoteView:p,getNextEndNoteView:h,getPreviousEndNoteView:f,getNextFootNoteView:m,getPreviousFootNoteView:g,getOrderedEndNoteViews:T,getNoteViewRangeElement:_,getNoteViews:E,createMetaSectionView:v,addNoteView:S,removeNoteView:b,updateNoteNumbers:R,sortNotes:D,updateNote:y,removeFromNoteView:A,findNoteColumn:O,init:i,destroy:o}}();ProofingAdaptor=function(){var e=function(){window.allowedModules&&window.allowedModules.proofing?(t(!1),zw.require(window.allowedModules.proofing.files,["SpellCheck","Grammar"],function(e,n){t(!0),e.init(),window.isGrammarSupported&&(n.init(),Z("bbar-spellcheck-guider").zbutton("hide"),J("#spellwindow").hide(),J("#spellwindowseparator").hide())})):(J("#bbar-spellcheck").hide(),J("#tools-lpnl-spellcheck").hide(),J("#tools-lpnl-pers-dict").hide(),J("#tools-lpnl-thesaurus").hide(),J("#review-tb-lpnl-spellcheck").hide(),Z("bbar-gra-switch-outer").hide())},t=function(e){var t=["review-tb-lpnl-spellcheck",,"bbar-spellchecklang","tools-lpnl-spellcheck","tools-lpnl-pers-dict","tools-lpnl-thesaurus","bbar-spellcheck-switch-off"];e?n(t):i(t)},n=function(e){for(var t=0,n=e.length;t<n;t++)Z(e[t]).zbutton("enable");J("#bbar-spellcheck-toggle-switch").removeClass("ui-state-disabled"),J("#bbar-sp-toggle-switch").removeAttr("disabled")},i=function(e){for(var t=0,n=e.length;t<n;t++)Z(e[t]).zbutton().zbutton("disable");J("#bbar-spellcheck-toggle-switch").addClass("ui-state-disabled"),J("#bbar-sp-toggle-switch").attr("disabled",!0)},o=function(){"undefined"!=typeof SpellCheck&&SpellCheck.startSpellchecker(),"undefined"!=typeof Grammar&&Grammar.startGrammarchecker()};PubSub.subscribe("Document/FirstTimeComponentReady",e),PubSub.subscribe("Document/ComponentReady",o)}(),TableThemeCSSGenerator=function(){"use strict";var e={"border-top":"tbody>tr:first-child>td { border-top\t:\tX;\t}","border-left":"tbody>tr>td:first-child { border-left\t:\tX;\t}","border-bottom":"tbody>tr:last-child>td\t{ border-bottom\t:\tX;\t}","border-right":"tbody>tr>td:last-child\t{ border-right\t:\tX;\t}",insideH:"tbody>tr:not(:last-child)>td { border-bottom\t:\tX;\t}",insideV:"tbody>tr>td:not(:last-child) { border-right:\tX;\t}"},t="tbody.zw-tbody:first-of-type>tr.zw-tr:first-child>td.zw-td",n="tbody.zw-tbody:last-of-type>tr.zw-tr:last-child>td.zw-td",i="tbody.zw-tbody>tr.zw-tr>td.zw-td:first-child",o="tbody.zw-tbody>tr.zw-tr>td.zw-td:last-child",r="tbody.zw-tbody:first-of-type>tr.zw-tr:first-child>td.zw-td:first-child",a="tbody.zw-tbody:first-of-type>tr.zw-tr:first-child>td.zw-td:last-child",s="tbody.zw-tbody:first-of-type>tr.zw-tr:last-child>td.zw-td:first-child",l={"border-top":"tbody.zw-tbody>tr.zw-tr>td.zw-td { border-top\t:\tX;\t}","border-left":"tbody.zw-tbody>tr.zw-tr>td.zw-td { border-left:\tX;\t}","border-right":"tbody.zw-tbody>tr.zw-tr>td.zw-td { border-right:\tX;\t}","border-bottom":"tbody.zw-tbody>tr.zw-tr>td.zw-td { border-bottom:\tX;\t}"},d={"border-top":"tbody.zw-tbody:first-of-type>tr.zw-tr:first-child>td.zw-td { border-top\t:\tX;\t}","border-left":"tbody.zw-tbody:first-of-type>tr.zw-tr:first-child>td.zw-td { border-left:\tX;\t}","border-right":"tbody.zw-tbody:first-of-type>tr.zw-tr:first-child>td.zw-td { border-right:\tX;\t}","border-bottom":"tbody.zw-tbody:first-of-type>tr.zw-tr:first-child>td.zw-td { border-bottom:\tX;\t}"},c={"border-top":"tbody.zw-tbody:last-of-type>tr.zw-tr:last-child>td.zw-td { border-top\t:\tX;\t}","border-left":"tbody.zw-tbody:last-of-type>tr.zw-tr:last-child>td.zw-td { border-left\t:\tX;\t}","border-right":"tbody.zw-tbody:last-of-type>tr.zw-tr:last-child>td.zw-td { border-right\t:\tX;\t}","border-bottom":"tbody.zw-tbody:last-of-type>tr.zw-tr:last-child>td.zw-td { border-bottom:\tX;\t}"},u={"border-top":"tbody.zw-tbody>tr.zw-tr>td.zw-td:first-child { border-top\t:\tX;\t}","border-left":"tbody.zw-tbody>tr.zw-tr>td.zw-td:first-child { border-left\t:\tX;\t}","border-right":"tbody.zw-tbody>tr.zw-tr>td.zw-td:first-child { border-right\t:\tX;\t}","border-bottom":"tbody.zw-tbody>tr.zw-tr>td.zw-td:first-child { border-bottom:\tX;\t}"},p={"border-top":"tbody.zw-tbody>tr.zw-tr>td.zw-td:last-child { border-top\t:\tX;\t}","border-left":"tbody.zw-tbody>tr.zw-tr>td.zw-td:last-child { border-left\t:\tX;\t}","border-right":"tbody.zw-tbody>tr.zw-tr>td.zw-td:last-child { border-right\t:\tX;\t}","border-bottom":"tbody.zw-tbody>tr.zw-tr>td.zw-td:last-child { border-bottom\t:\tX;\t}"},h={"border-top":"tbody.zw-tbody:first-of-type>tr.zw-tr:first-child>td.zw-td:first-child { border-top\t:\tX;\t}","border-left":"tbody.zw-tbody:first-of-type>tr.zw-tr:first-child>td.zw-td:first-child { border-left:\tX;\t}","border-right":"tbody.zw-tbody:first-of-type>tr.zw-tr:first-child>td.zw-td:first-child { border-right:\tX;\t}","border-bottom":"tbody.zw-tbody:first-of-type>tr.zw-tr:first-child>td.zw-td:first-child { border-bottom:\tX;\t}"},f={"border-top":"tbody.zw-tbody:first-of-type>tr.zw-tr:first-child>td.zw-td:last-child { border-top\t:\tX;\t}","border-left":"tbody.zw-tbody:first-of-type>tr.zw-tr:first-child>td.zw-td:last-child { border-left:\tX;\t}","border-right":"tbody.zw-tbody:first-of-type>tr.zw-tr:first-child>td.zw-td:last-child { border-right:\tX;\t}","border-bottom":"tbody.zw-tbody:first-of-type>tr.zw-tr:first-child>td.zw-td:last-child { border-bottom:\tX;\t}"},m={"border-top":"tbody.zw-tbody:first-of-type>tr.zw-tr:last-child>td.zw-td:first-child { border-top\t:\tX;\t}","border-left":"tbody.zw-tbody:first-of-type>tr.zw-tr:last-child>td.zw-td:first-child { border-left:\tX;\t}","border-right":"tbody.zw-tbody:first-of-type>tr.zw-tr:last-child>td.zw-td:first-child { border-right:\tX;\t}","border-bottom":"tbody.zw-tbody:first-of-type>tr.zw-tr:last-child>td.zw-td:first-child { border-bottom:\tX;\t}"},g={"border-top":"tbody.zw-tbody:first-of-type>tr.zw-tr:last-child>td.zw-td:last-child { border-top\t:\tX;\t}","border-left":"tbody.zw-tbody:first-of-type>tr.zw-tr:last-child>td.zw-td:last-child { border-left:\tX;\t}","border-right":"tbody.zw-tbody:first-of-type>tr.zw-tr:last-child>td.zw-td:last-child { border-right:\tX;\t}","border-bottom":"tbody.zw-tbody:first-of-type>tr.zw-tr:last-child>td.zw-td:last-child { border-bottom:\tX;\t}"},T="div.zw-cell-container>div.zw-paragraph>div.zw-line-div>div.zw-line-content>span.zw-portion",_="div.zw-cell-container>div.zw-paragraph",E=function(e){if(!e||"string"==typeof e)return e;var t="";return"nil"!=e.type?(t+=e.width?e.width+" ":"0px ",t+=e.type?e.type+" ":"none ",t+=e.color?e.color:""):t+="none",t},v=function(e,t){var n=e.tblPr?e.tblPr:{},i=(n.borders?n.borders:{},e[t]);if(!i)return{};var o,r=i.cell?i.cell:{};r&&(o=r.borders?r.borders:{}),DocUtil.constructRenderingFormat(r);var a=r.bgc?r.bgc:null;return{borders:o,bgc:a,para:i.para}},S=function(e,n){var i=e.tblPr?e.tblPr:{},o=(i.borders?i.borders:{},"table[data-node-id="+n+"].zw-table>"),r="",a=v(e,"firstRow"),s=a.borders,l=a.bgc;for(var c in s)if(s[c]){var u=o+d[c];u=u.replace("X",E(s[c]))+"\n",r+=u}return l&&(r+=o+t+" { background-color : "+l+"; }\n"),U.isEmpty(a.para)||(r+=o+t+">"+_+"{ "+Utils.constructStyleText(a.para)+"}\n",r+=o+t+">"+T+"{ "+Utils.constructStyleText(a.para.textFormat)+"}\n"),r},b=function(e,t){var i=e.tblPr?e.tblPr:{},o=(i.borders?i.borders:{},"table[data-node-id="+t+"].zw-table>"),r="",a=v(e,"lastRow"),s=a.borders,l=a.bgc;for(var d in s)if(s[d]){var u=o+c[d];u=u.replace("X",E(s[d]))+"\n",r+=u}return l&&(r+=o+n+" { background-color : "+l+"; }\n"),U.isEmpty(a.para)||(r+=o+n+">"+_+"{ "+Utils.constructStyleText(a.para)+"}\n",r+=o+n+">"+T+"{ "+Utils.constructStyleText(a.para.textFormat)+"}\n"),r},R=function(e,t){var n=e.tblPr?e.tblPr:{},o=(n.borders?n.borders:{},"table[data-node-id="+t+"].zw-table>"),r="",a=v(e,"firstColumn"),s=a.borders,l=a.bgc;for(var d in s)if(s[d]){var c=o+u[d];c=c.replace("X",E(s[d]))+"\n",r+=c}return l&&(r+=o+i+" { background-color : "+l+"}\n"),U.isEmpty(a.para)||(r+=o+i+">"+_+"{ "+Utils.constructStyleText(a.para)+"}\n",r+=o+i+">"+T+"{ "+Utils.constructStyleText(a.para.textFormat)+"}\n"),r},O=function(e,t){var n=e.tblPr?e.tblPr:{},i=(n.borders?n.borders:{},"table[data-node-id="+t+"].zw-table>"),r="",a=v(e,"lastColumn"),s=a.borders,l=a.bgc;for(var d in s)if(s[d]){var c=i+p[d];c=c.replace("X",E(s[d]))+"\n",r+=c}return l&&(r+=i+o+" { background-color : "+l+"}\n"),U.isEmpty(a.para)||(r+=i+o+">"+_+"{ "+Utils.constructStyleText(a.para)+"}\n",r+=i+o+">"+T+"{ "+Utils.constructStyleText(a.para.textFormat)+"}\n"),r},D=function(e,t,n,i){var o=!1,r=v(n,e),a=r.borders,s="table[data-node-id="+i+"]>",l="";o=t.hasOwnProperty("tblLook")?!!parseInt(t.tblLook.firstRow):!!n.hasOwnProperty("firstRow");var d;"band1Horz"==e?(d=o?"even":"odd",s+="tbody.zw-tbody>tr:nth-child("+d):(d=o?"odd":"even",s+="tbody>tr:nth-child("+d),r.bgc&&(l+=s+")>td {",l+="background-color : "+r.bgc+"; }\n"),U.isEmpty(r.para)||(l+=s+")>td>"+_+"{",l+=Utils.constructStyleText(r.para)+"}\n",l+=s+")>td>"+T+"{",l+=Utils.constructStyleText(r.para.textFormat)+"}\n");for(var c in a)if(a[c]){var u=")>td {";u+=E(a[c])+"; }\n",l+=u}return l},y=function(e,t,n,i){var o=!1,r=v(n,e),a=r.borders,s="table[data-node-id="+i+"]>",l="";o=t.hasOwnProperty("tblLook")?!!parseInt(t.tblLook.firstColumn):!!n.hasOwnProperty("firstColumn");var d;"band1Vert"==e?(d=o?"even":"odd",s+="tbody.zw-tbody>tr.zw-tr>td.zw-td:nth-child("+d):(d=o?"odd":"even",s+="tbody.zw-tbody>tr.zw-tr>td:nth-child("+d),r.bgc&&(l=s+") {",l+="background-color : "+r.bgc+"; }\n"),U.isEmpty(r.para)||(l+=s+")>"+_+"{",l+=Utils.constructStyleText(r.para)+"}\n",l+=s+")>"+T+"{",l+=Utils.constructStyleText(r.para.textFormat)+"}\n");for(var c in a)if(a[c]){var u=s+") {";u+=E(a[c])+"; }\n",l+=u}return l},A=function(e,t){var n=e.tblPr?e.tblPr:{},i=(n.border?n.borders:{},"table[data-node-id="+t+"].zw-table>"),o="",a=v(e,"nwCell"),s=a.borders,l=a.bgc;for(var d in s)if(s[d]){var c=i+h[d];c=c.replace("X",E(s[d]))+"\n",o+=c}return l&&(o+=i+r+" { background-color : "+l+"}\n"),U.isEmpty(a.para)||(o+=i+r+">"+_+"{ "+Utils.constructStyleText(a.para)+"}\n",o+=i+r+">"+T+"{ "+Utils.constructStyleText(a.para.textFormat)+"}\n"),o},C=function(e,t){var n=e.tblPr?e.tblPr:{},i=(n.borders?n.borders:{},"table[data-node-id="+t+"].zw-table>"),o="",r=v(e,"neCell"),s=r.borders,l=r.bgc;for(var d in s)if(s[d]){var c=i+f[d];c=c.replace("X",E(s[d]))+"\n",o+=c}return l&&(o+=i+a+" { background-color : "+l+"}\n"),U.isEmpty(r.para)||(o+=i+a+">"+_+"{ "+Utils.constructStyleText(r.para)+"}\n",o+=i+a+">"+T+"{ "+Utils.constructStyleText(r.para.textFormat)+"}\n"),o},I=function(e,t){var n=e.tblPr?e.tblPr:{},i=(n.borders?n.borders:{},"table[data-node-id="+t+"].zw-table>"),o="",r=v(e,"swCell"),l=r.borders,d=r.bgc;for(var c in l)if(l[c]){var u=i+m[c];u=u.replace("X",E(l[c]))+"\n",o+=u}return d&&(o+=i+s+" { background-color : "+d+"}\n"),U.isEmpty(r.para)||(o+=i+a+">"+_+"{ "+Utils.constructStyleText(r.para)+"}\n",o+=i+a+">"+T+"{ "+Utils.constructStyleText(r.para.textFormat)+"}\n"),o},w=function(e,t){var n=e.tblPr?e.tblPr:{},i=(n.borders?n.borders:{},"table[data-node-id="+t+"].zw-table>"),o="",r=v(e,"seCell"),l=r.borders,d=r.bgc;for(var c in l)if(l[c]){var u=i+g[c];u=u.replace("X",E(l[c]))+"\n",o+=u}return d&&(o+=i+s+" { background-color : "+d+"}\n"),U.isEmpty(r.para)||(o+=i+a+">"+_+"{ "+Utils.constructStyleText(r.para)+"}\n",o+=i+a+">"+T+"{ "+Utils.constructStyleText(r.para.textFormat)+"}\n"),o},P=function(e){var t="";return t+=e.pt?e.pt.convertor().pixels+"px ":"0px ",t+=e.pr?e.pr.convertor().pixels+"px ":"0px ",t+=e.pb?e.pb.convertor().pixels+"px ":"0px ",t+=e.pl?e.pl.convertor().pixels+"px;":"0px;"},M=function(e,t){var n=e.tblPr?e.tblPr:{},i=n.cell?n.cell:{},o=i.borders?i.borders:{},r="table[data-node-id="+t+"].zw-table>",a="";for(var s in o)if(o[s]){var d=r+l[s];d=d.replace("X",E(o[s]))+"\n",a+=d}return a},L=function(t,n){var i=t[ATTR_TABLE.TBLS_THEME];i||(i=n.theme);var o=i[ATTR_TABLE.TBLS_THEME_OBJECT];if(o){var r=n.id,a=o.tblPr?o.tblPr:{},s=a.borders?a.borders:{},l=a.tblCellMar?a.tblCellMar:{},d=a.cell?a.cell:{},c="table[data-node-id="+r+"]>",u="";t=Utils.mergeObjs([s,t]);for(var p in t)if(e.hasOwnProperty(p)){var h=c+e[p];h=h.replace("X",E(t[p]))+"\n",u+=h}U.isEmpty(l)||(u+=c+"tbody>tr>td>div.zw-cell-container { padding : "+P(l)+"}\n"),U.isEmpty(d)||(d.hasOwnProperty("bgc")&&(u+=c+"tbody>tr>td {",u+="background-color : "+d.bgc+";\n",u+="}\n"),d.hasOwnProperty(ATTR_CELL.TDS_VA)&&(u+=c+"tbody>tr>td {",u+="vertical-align : "+d[ATTR_CELL.TDS_VA]+";\n",u+="}\n"),d.hasOwnProperty("borders")&&(u+=M(o,r))),U.isEmpty(o.para)||(u+=c+"tbody>tr>td>div.zw-paragraph { "+Utils.constructStyleText(o.para)+"}\n",u+=c+"tbody>tr>td>span.zw-portion { "+o.para.textFormat+"}\n"),o.firstRow&&!U.isEmpty(o.firstRow)&&(u+=S(o,r)),o.lastRow&&!U.isEmpty(o.lastRow)&&(u+=b(o,r)),o.firstColumn&&!U.isEmpty(o.firstColumn)&&(u+=R(o,r)),o.lastColumn&&!U.isEmpty(o.lastColumn)&&(u+=O(o,r)),o.band1Horz&&!U.isEmpty(o.band1Horz)&&(u+=D("band1Horz",t,o,r)),o.band2Horz&&!U.isEmpty(o.band2Horz)&&(u+=D("band2Horz",t,o,r)),o.band1Vert&&!U.isEmpty(o.band1Vert)&&(u+=y("band1Vert",t,o,r)),o.band2Vert&&!U.isEmpty(o.band2Vert)&&(u+=y("band2Vert",t,o,r)),o.nwCell&&!U.isEmpty(o.nwCell)&&(u+=A(o,r)),o.neCell&&!U.isEmpty(o.neCell)&&(u+=C(o,r)),o.swCell&&!U.isEmpty(o.swCell)&&(u+=I(o,r)),o.seCell&&!U.isEmpty(o.seCell)&&(u+=w(o,r));var f=J("#"+r).length?J("#"+r):J("<style>");f.attr({id:r,class:"table-theme-style"}),f.text(u).appendTo(document.head)}};return{getCellStyles:v,getCSSBorder:E,setStyleTag:L}}(),function(){var e,t,n,i,o,r,a,s,l,d,c,u,p,h,f,m,g=this.ViewManager={},T=[],_={},E=2,v=new LinkedList,S={header:{},footer:{}},b=[],R={},O={};NoteViewCollection.init();var D=function(){var e=new PageView;v.append(e),e.create(),PubSub.publish("page/created",e)},y=function(e){var t=v.last.id==e.id;if(editor.visiblePageNumbers.contains(e.pageNumber)){var n=editor.visiblePageNumbers.indexOf(e.pageNumber);editor.visiblePageNumbers.splice(n,n+1)}e.remove(),v.remove(e),PubSub.publish("page/removed",e),t&&v.last.footer.showFooter()},A=function(e,t,n){return e[n]&&e[n]!=t[n]},C=function(){return _},I=function(){return _.count},w=function(){return _.width},P=function(){return _.space},M=function(){return 1==_.iseqwidth},L=function(){return"1"==_.separator},N=function(){var e,t=editor.doc.getBodyFormat(),n=t[ATTR_BODY.DS_COLCOLS]||{count:1,space:[],width:[],iseqwidth:!0,col_space:Conversions.toGlobalValue("0.5in"),seperator:"0"},i=n.count||1,o=n.width||[],r=n.space||[],a=void 0==n.iseqwidth||n.iseqwidth,s=n.defaultspace||Conversions.toGlobalValue("0.5in"),l=n.seperator||"0";if(e=editor.doc.getPaperWidth(),i>1&&(e-=PAGE_BORDER_WIDTH),e-=(i-1)*s.convertor().pixels,a||1==i){o=[],r=[],e/=i,e=Conversions.toGlobalValue(e+"px");for(var d=0;d<i;d++)o.push(e),d!=i-1&&r.push(s)}r.splice(i-1),_={count:i,space:r,width:o,iseqwidth:a,defaultspace:s,seperator:l}},x=function(e){var t=w(),n=M();if(void 0==e){var i=(editor.clientActiveSection&&editor.clientActiveSection.className||"").toLowerCase();if(i.indexOf("header")!=-1||i.indexOf("footer")!=-1)return editor.doc.getPaperWidth();e=editor.currentColumnIndex||0}return e==-1&&(e=0),1==n?t[0].convertor().pixels:t[e].convertor().pixels},k=function(e){var t=P(),n=M();return e==-1?null:1==n?t[0].convertor().pixels:t[e]?t[e].convertor().pixels:null},F=function(){var e,t,n,i=editor.doc.getBodyFormat(),o=I()||1,r=i[ATTR_BODY.DS_OR]||CONST.DEFAULT_ORIENTATION,a=i[ATTR_BODY.DS_PS]||CONST.DEFAULT_PAPER,s=PageLayout.Paper[a][r].height,l=PageLayout.Paper[a][r].width;if("Custom"==a){if(e=i[ATTR_BODY.DS_PH]){s={};var d=e.convertor();s.inch=d.inches,s.pixel=d.pixels,s.mm=d.millimeters}if(t=i[ATTR_BODY.DS_PW]){l={};var c=t.convertor();l.inch=c.inches,l.pixel=c.pixels,l.mm=c.millimeters}}if(editor.doc.getRole()===USER_ROLE.PUBLIC&&1==o){s={};var d="10000000px".convertor();s.inch=d.inches,s.pixel=d.pixels,s.mm=d.millimeters}n={orientation:r,size:a,height:s,width:l},(A(S,n,"orientation")||A(S,n,"height")||A(S,n,"width"))&&v.first&&Ke(v.first),extend(S,n),Y()},Y=function(){var l=editor.doc.getBodyFormat(),d=l[ATTR_BODY.DS_MT].convertor().pixels,c=v.first&&v.first.getHeaderHeight(),u=l[ATTR_BODY.DS_MB].convertor().pixels,p=v.first&&v.first.getFooterHeight(),h=.4*S.height.pixel,f=h;S.header.height=Math.min(Math.max(d,c),h),S.footer.height=Math.min(Math.max(u,p),f),e&&(e.setStyle(),e.height=Math.min(Math.max(d,e.height),h)),t&&(t.setStyle(),t.height=Math.min(Math.max(u,t.height),f)),n&&(n.setStyle(),n.height=Math.min(Math.max(d,n.height),h)),i&&(i.setStyle(),i.height=Math.min(Math.max(u,i.height),f)),o&&(o.setStyle(),o.height=Math.min(Math.max(d,o.height),h)),r&&(r.setStyle(),r.height=Math.min(Math.max(u,r.height),f)),a&&(a.setStyle(),a.height=Math.min(Math.max(d,a.height),h)),s&&(s.setStyle(),s.height=Math.min(Math.max(u,s.height),f))},B=function(e){var t=new Views[e.type](e);return t},H=function(e){var t=O[e.node.id]||(O[e.node.id]={});t.blocks||(t.blocks=[],t.isBlocksContructed=!1),t.blocks.length||t.isBlocksContructed||(t.blocks=e.node.buildBlocks(),t.isBlocksContructed=!0)},W=function(e){var t=O[e.node.id];t&&(t.blocks=[],t.isBlocksContructed=!1)},V=function(e){var t=O[e.node.id];if(t)return t.blocks||[]},G=function(e){var t=O[e.node.id]||(O[e.node.id]={});R[e.id]=e,t.views=t.views?t.views:[],t.views.push(e)},z=function(e){var t,n;for(delete R[e.id],t=ViewManager.getViews(e.node)||[],n=0;n<t.length&&e.id!=t[n].id;n++);t.splice(n,1),O[e.node.id]&&O[e.node.id].views.length||delete O[e.node.id]},Z=function(e){var t,n=0;if(e.prev)for(e=e.prev;e;)n+=e.getHeight(),t=e,e=e.prev,!e&&t.parent&&"section"!=t.parent.type&&("cell"==t.parent.type?n+=Z(t.parent.parent):"table"==t.parent.type?n+=Z(t.parent):"toc"==t.node.parent.type&&(n+=Z(t.parent)));else e.parent&&"section"!=e.parent.node.type&&(n+=Z("cell"==e.parent.type?e.parent.parent:e.parent));return n},j=function(e,t){for(var n,i=t.content.columns.first;i;){for(n=i.viewMap[e],view=n&&n.first;view;){if(view.id==e)return view;view=view.next}i=i.next}return null},X=function(e){return e?e.columnNumber-1:-1},K=function(e,t){if(t==-1)return null;for(var n=e.content.columns.first,i=0;n&&i!=t;)n=n.next,i++;return n},$=function(e){var t,n,i,o,r=B(e),a=q(r),s=a.getPage(),l=a.getHeight(),d=!1,c=0,u=!1,t=s.addViewToContent(r),p=0;for(a.addDOMView(r,t),i=X(r.column),o=Z(r),r.parent&&"cell"==r.parent.type&&(d=!0,u=!0),p=r.create(p,o,u),"para"==r.type&&r.isInVisiblePage()?(r.addViewLines(0,r.lines.length),r.postDomChecks()):r.column.content.page.isPageRendered=!1;p>=0;){var h=X(r.column);s.paginate();var f,m=K(s,h);m.next?f=m.next.views:s.next?(s=s.next,f=s.content.columns.first.views):f=m.views,c+=r.nodeLines.length;for(var g=s.getViewsFrom(f,"para"),T=0;T<g.length;T++)if(g[T].node.id==r.node.id){r=g[T],c=r.start;break}if(m.width!=r.column.width)break;o=Z(r);var _=r.lines.length;if(o+=r.getHeight(),r.isReflow){r.isReflow=!1;break}p=r.addNodeLines(p,o,u,"done"),u=!1,r.start=c,r.addLines(_,r.nodeLines.length),r.isInVisiblePage()?r.addViewLines(_,r.lines.length):r.column.content.page.isPageRendered=!1}s&&(n=Ke(s,i),n.height+=a.getHeight()-l,(n.height>ft()||"hr"==e.type&&(r.isPageBreakHr()||r.isColumnBreakHr())||e.paraProperties&&e.paraProperties.pageBreakBefore)&&it())},q=function(e){var t,n,i,o,r=e.node,a=r.prev,s=r.parent;return a?(t=mt(a),n="cell"==r.type?t[0]:lastElementOf(t),o=n.column):"section"==r.parent.type?o=v.first.content.columns.first:(t=ViewManager.getViews(s),i=t[0],o=i.column),o},Q=function(e){var t,n=[];for(t=0;t<e.length;t++)n.push(e[t].getHeight());return n},ee=function(e){return"para"!=e.type?[]:e.floatImages},te=function(e){var t=ce(e),n=ue(e);if(t&&n)for(var i,o,r,a=n.length,s=0;s<a;s++)r=n[s],i=j(r.viewId,t),i&&(o=Z(i),r.pageTop=o+r.top-r.splitTop)},ne=function(){for(var e=0;T[e];)Wt(T[e])?e++:T.splice(e,1);T.sort(function(e,t){return Wt(e).start-Wt(t).start}),U.each(T,function(e){var t={forceReRender:!0},n=O[e];if(n&&n.views){var i=n.views[0].node,o=i.section.nodesToUpdate&&i.section.nodesToUpdate.nodesMap&&i.section.nodesToUpdate.nodesMap[i.id];o||(he(i,t),InsertShape.createShape("modify",i,n))}}),T.splice(0,T.length)},ie=function(e){return!(!e.section||e.section.id.indexOf("header")==-1)},oe=function(e){return!(!e.section||e.section.id.indexOf("footer")==-1)},re=function(e){var t=ue(e);if(!t)return!1;var n=t.length,i=e.column?e.column.left:0,o=Z(e);if("para"==e.type&&n)for(var r,a=0;a<n;a++)if(r=t[a],!Utils.arrayContains(["front","behind"],r.align)&&o+e.getHeight()>=r.pageTop&&o<r.pageTop+r.height&&(!e.column||i+e.width>r.pageLeft&&i<r.pageLeft+r.width))return!0;return!1},ae=function(e){var t=e.length;if(t)for(var n,i,o,r=0;r<t;r++)if(n=e[r],i=n.affectedNodes){o=i.length;for(var a=0;a<o;a++)T.contains(i[a])||T.push(i[a])}},se=function(e){for(var t,n=ViewManager.getViews(e.node),i=1;i<n.length;i++)e.id==n[i].id&&(t=n[i-1]);return t},le=function(e){for(var t,n=ViewManager.getViews(e.node),i=0;i<n.length-1;i++)e.id==n[i].id&&(t=n[i+1]);return t},de=function(e){if(!e)return null;var t;return e.next?t=e.next:e.column&&e.column.next&&(t=e.column.next.views.first),t},ce=function(e){var t;return t=e.column?e.column.content.page:e.page},ue=function(e){if(ViewManager.isHeaderView(e)||ViewManager.isFooterView(e))return e.section.floatImages;var t=ce(e);return t?t.floatImages:null},pe=function(e){e&&"para"==e.type&&(e.adjustLineSpaces(),e.setLineSpaceStyle(),e.updateBorderStyles(),e.setBorderStyle(),e.setHeight(),e.publishLineEvents())},he=function(e,t,n){var i,o,r,a,s,l,d=mt(e),c=0,u=0,p=0,h=!0,f=!1,m=!1,g=0;t&&(f=!(e.paraProperties.pageBreakBefore||e.paraProperties.widowsOrphan||e.paraProperties.linesTogether),m=!(e.paraProperties.widowsOrphan&&e.paraProperties.linesTogether||e.paraProperties.pageBreakBefore),r=t.triggerPagination);var T=(d.length,e.getIndex(),0),_=0,E=[];if(i=Q(d),s=d[g],n){for(n-=e.getIndex();s;){if(s.nodeLines[0].start<=n&&s.nodeLines[s.nodeLines.length-1].end>=n){p=s.nodeLines[0].start;break}u+=s.nodeLines.length,g++,s=d[g]}s||(u=g=0,s=d[g])}for(c=X(s.column),InsertShape.removeShapeNodes(d),"content"!=e.section.name||s.parent&&"cell"==s.parent.type||(h=!1);s;){if(E=ee(s),ae(E),s.updateProperties(_),s.nodeLines=[],a=Z(s),p=s.addNodeLines(p,a,h),s.updateBorderStyles(),s.checkLine(u,t),s.isReflow&&s.postDomChecks(),s.setBorderStyle(),s.setHeight(),pe(s.prev),pe(s.next),u+=s.nodeLines.length,l=s,g++,p==-1)for(;d[g];)d[g].column.removeView(d[g]);te(s),s=d[g]}for(s=l;p>=0;){var v=X(s.column),S=s.column.content.page;S.paginate();var b,R=K(S,v);R.next?b=R.next.views:S.next?(S=S.next,b=S.content.columns.first.views):b=R.views,u+=s.nodeLines.length;for(var O=S.getViewsFrom(b,"para"),D=0;D<O.length;D++)if(O[D].node.id==s.node.id){s=O[D];break}if(R.width!=s.column.width)break;a=Z(s);var y=s.lines.length;if(a+=s.getHeight(),s.isReflow){s.isReflow=!1;break}p=s.addNodeLines(p,a,h),h=!1,s.start=u,s.addLines(y,s.nodeLines.length),s.isInVisiblePage()?s.addViewLines(y,s.lines.length):s.column.content.page.isPageRendered=!1}g=0,s=d[g];d=ViewManager.getViews(e)||[],o=Q(d);var A=Math.min(i.length,o.length),T=-1;if(r)T=0;else for(D=0;D<A;D++)if(i[D]!=o[D]){T=D;break}s=null,T>=0?s=d[T]:i.length!=o.length&&(s=d[A-1]);var C=ViewManager.isMetaSection(e);if(s&&s.column){var I=s,w=s.column,P=!1;if(C)if("footnote"===e.section.name){var M=NoteViewCollection.getNoteViews(e.section.sid)[0];I=M.getContainingPara()}else"endnote"===e.section.name&&(P=!0);var R=w.prev||w.columnInPrevPage();if(R&&!P&&fe(I,R)&&(r&&(f||m)||!r))Ke(R.getPage(),X(R));else if(s.parent&&"cell"==s.parent.type){if(T>=0){for(var L=s.parent,N=L.parent,b=N.views,U=b.first,x=0;U;)U!=L&&(x=Math.max(x,U.getHeight())),U=U.next;var k=L.getHeight(),F=k+i[T]-o[T],Y=!1;F>x?F!=k&&(Y=!0):k>x&&(Y=!0)}(T<0||Y)&&Ke(w.getPage(),c)}else Ke(w.getPage(),X(w))}},fe=function(e,t){var n,i=t.getMaxColumnHeight()-t.getHeight();if(null==e.prev){var o="cell"!==e.node.parent.type;n=ViewManager.getlineHeight(e.lines[0],!1,o)}return!!(n&&i>n)},me=function(e){var t,n,i,o,r=ViewManager.getViews(e)||[];for(n=Q(r),t=0;t<r.length;t++)r[t].update();i=Q(r);var a=Math.min(n.length,i.length),s=-1;for(t=0;t<a;t++)if(n[t]!=i[t]){s=t;break}r[0].column&&(s>=0?(o=r[s].column.getPage(),o.prev&&o.prev.remainingHeight>i[s]-n[s]&&(o=o.prev)):n.length!=i.length&&(o=r[a-1].column.getPage()),o&&Ke(o))},ge=function(e,t){switch(e.type){case"para":t||(t={}),t.forceReRender=!0,W(ViewManager.getViews(e)[0]),H(ViewManager.getViews(e)[0]),he(e,t),ne();break;default:me(e)}},Te=function(e){var t,n,i,o=ViewManager.getViews(e)||[];for(o[0]&&(t=o[0].column.getPage(),i=X(o[0].column));o.length;)n=lastElementOf(o),n.column.removeView(n);t&&Ke(t,i)},_e=function(e){var t,n=ViewManager.getViews(e)||[];for(t=0;t<n.length;t++)n[t].adjustBorder()},Ee=function(e,t){var n,i=B(e);n=t.addView(i),i.create(0,Z(i)),t.addDOMView(i,n)},ve=function(e,t){for(var n=ViewManager.getViews(e)||[];n.length;)view=lastElementOf(n),t.removeView(view)},Se=function(e){var t=e.node,n=e.op;tt();var i=NoteViewCollection.getNoteViews(t.section.sid)[0];switch(n){case"create":i||(i=NoteViewCollection.createMetaSectionView(t.section));var o=B(t),r=i.addView(o);o.create(0,0,!0),i.addDOMView(o,r),i.views.first.updateNoteReferenceChar(i.getReferenceChar());var a=i.column;Ke(a.getPage(),X(a)),t.section.isSectionBuildInRecursion||it();break;case"modify":W(ViewManager.getViews(t)[0]),H(ViewManager.getViews(t)[0]),he(t),i.views.first.updateNoteReferenceChar(i.getReferenceChar()),it();break;case"update":ge(t),i.views.first.updateNoteReferenceChar(i.getReferenceChar()),it();break;case"remove":var s=i.column;NoteViewCollection.removeFromNoteView(t);var l=i.getContainingPara(),d=s.prev||s.columnInPrevPage();"footnote"===i.type&&d&&fe(l,d)?Ke(d.getPage(),X(d)):Ke(s.getPage(),X(s)),it()}},be=function(t){var n=t.node,i=t.collabop,o=t.op;switch(tt(),o){case"create":Ee(n,e);break;case"modify":W(ViewManager.getViews(n)[0]),H(ViewManager.getViews(n)[0]),he(n);break;case"update":ge(n);break;case"remove":ve(n,e);break;case"adjustBorder":_e(n)}PubSub.publish(n.type+"view/"+o,n,i),O[n.id]&&InsertShape.createShape(o,n,O[n.id].views)},Re=function(e){var t=e.node,i=e.collabop,o=e.op;switch(tt(),o){case"create":Ee(t,n);break;case"modify":W(ViewManager.getViews(t)[0]),H(ViewManager.getViews(t)[0]),he(t);break;case"update":ge(t);break;case"remove":PubSub.publish(t.type+"view/before/"+o,ViewManager.getViews(t),i),ve(t,n);break;case"adjustBorder":_e(t)}PubSub.publish(t.type+"view/"+o,t,i),O[t.id]&&InsertShape.createShape(o,t,O[t.id].views)},Oe=function(e){var t=e.node,n=e.collabop,i=e.op;switch(tt(),i){case"create":Ee(t,o);break;case"modify":W(ViewManager.getViews(t)[0]),H(ViewManager.getViews(t)[0]),he(t);break;case"update":ge(t);break;case"remove":PubSub.publish(t.type+"view/before/"+i,ViewManager.getViews(t),n),ve(t,o);break;case"adjustBorder":_e(t)}PubSub.publish(t.type+"view/"+i,t,n),O[t.id]&&InsertShape.createShape(i,t,O[t.id].views)},De=function(e){var t=e.node,n=e.collabop,i=e.op;switch(tt(),i){case"create":Ee(t,a);break;case"modify":W(ViewManager.getViews(t)[0]),H(ViewManager.getViews(t)[0]),he(t);break;case"update":ge(t);break;case"remove":PubSub.publish(t.type+"view/before/"+i,ViewManager.getViews(t),n),ve(t,a);break;case"adjustBorder":_e(t)}PubSub.publish(t.type+"view/"+i,t,n),O[t.id]&&InsertShape.createShape(i,t,O[t.id].views)},ye=function(e){var t=e.node,n=e.collabop,o=e.op;switch(tt(),o){case"create":Ee(t,i);break;case"modify":W(ViewManager.getViews(t)[0]),H(ViewManager.getViews(t)[0]),he(t);break;case"update":ge(t);break;case"remove":PubSub.publish(t.type+"view/before/"+o,ViewManager.getViews(t),n),ve(t,i);break;case"adjustBorder":_e(t)}PubSub.publish(t.type+"view/"+o,t,n),O[t.id]&&InsertShape.createShape(o,t,O[t.id].views)},Ae=function(e){var t=e.node,n=e.collabop,i=e.op;switch(tt(),i){case"create":Ee(t,r);break;case"modify":W(ViewManager.getViews(t)[0]),H(ViewManager.getViews(t)[0]),he(t);break;case"update":ge(t);break;case"remove":PubSub.publish(t.type+"view/before/"+i,ViewManager.getViews(t),n),ve(t,r);break;case"adjustBorder":_e(t)}PubSub.publish(t.type+"view/"+i,t,n),O[t.id]&&InsertShape.createShape(i,t,O[t.id].views)},Ce=function(e){var t=e.node,n=e.collabop,i=e.op;switch(tt(),i){case"create":Ee(t,s);break;case"modify":W(ViewManager.getViews(t)[0]),H(ViewManager.getViews(t)[0]),he(t);break;case"update":ge(t);break;case"remove":PubSub.publish(t.type+"view/before/"+i,ViewManager.getViews(t),n),ve(t,s);break;case"adjustBorder":_e(t)}PubSub.publish(t.type+"view/"+i,t,n),O[t.id]&&InsertShape.createShape(i,t,O[t.id].views)},Ie=function(e){var t,n,i=e.node,o=e.collabop,r=e.contentIndex,a=e.op,s={isCollabOp:o,triggerPagination:e.triggerPagination,forceReRender:"update"===a};switch(tt(),a){case"create":$(i);break;case"modify":W(ViewManager.getViews(i)[0]),H(ViewManager.getViews(i)[0]),he(i,s,r),ne();break;case"update":ge(i,s);break;case"remove":var t=ViewManager.getViews(i);n=t&&t[0]?t[0].el:null,Te(i,s);var l=DocTreeManager.doc.getAllChildren(i,"para");U.each(l,function(e){PubSub.publish(e.type+"view/before/"+a,ViewManager.getViews(e),o)});break;case"adjustBorder":_e(i)}if("remove"!=a){var t=ViewManager.getViews(i);n=t&&t[0]?t[0].el:null}n&&PubSub.publish(i.type+"view/"+a,i,o),O[i.id]&&InsertShape.createShape(a,i,O[i.id].views)},we=function(e){var n=e.node,i=e.collabop,o=e.op;switch(tt(),o){case"create":Ee(n,t);break;case"modify":W(ViewManager.getViews(n)[0]),H(ViewManager.getViews(n)[0]),he(n);break;case"update":ge(n);break;case"remove":PubSub.publish(n.type+"view/before/"+o,ViewManager.getViews(n),i),ve(n,t);break;case"adjustBorder":_e(n)}PubSub.publish(n.type+"view/"+o,n,i),O[n.id]&&InsertShape.createShape(o,n,O[n.id].views)},Pe=function(){l=e.height},Me=function(){c=n.height},Le=function(){p=o.height},Ne=function(){f=a.height},Ue=function(t){t&&(F(),PubSub.publish("header/changed")),l!=e.height&&(PubSub.publish("content/setStyle"),Ke(v.first),it())},xe=function(e){e&&(F(),PubSub.publish("header/changed")),c!=n.height&&(PubSub.publish("content/setStyle"),Ke(v.first),it())},ke=function(e){e&&(F(),PubSub.publish("header/changed")),f!=a.height&&(PubSub.publish("content/setStyle"),Ke(v.first),it())},Fe=function(e){e&&(F(),PubSub.publish("header/changed")),p!=o.height&&(PubSub.publish("content/setStyle"),Ke(v.first),it())},Ye=function(){d=t.height},Be=function(){u=i.height},He=function(){h=r.height},We=function(){m=s.height},Ve=function(e){e&&(F(),PubSub.publish("footer/changed")),d!=t.height&&(PubSub.publish("content/setStyle"),Ke(v.first),it())},Je=function(e){e&&(F(),PubSub.publish("footer/changed")),u!=i.height&&(PubSub.publish("content/setStyle"),Ke(v.first),it())},Ge=function(e){e&&(F(),PubSub.publish("footer/changed")),h!=r.height&&(PubSub.publish("content/setStyle"),Ke(v.first),it())},ze=function(e){e&&(F(),PubSub.publish("footer/changed")),m!=s.height&&(PubSub.publish("content/setStyle"),Ke(v.first),it())},Ze=function(){if(it(),editor.doc.getRole()===USER_ROLE.PUBLIC){var e=I()||1;if(1==e){var t=v.last.content.columns.first.getHeight(),n=editor.doc.getBodyFormat(),i=(n[ATTR_BODY.DS_PH]||"0in").convertor().pixels;i>t&&(t=i),J(v.last.el).css("min-height",t),J(v.last.content.el).css("min-height",t),editor.jeditorPaneWrapper.css("height",t)}}},je=function(e,t){return e.page.pageNumber-t.page.pageNumber},Xe=function(){b.sort(je)},Ke=function(e,t){var n,i;for(t=t||0,i=0;i<b.length;i++)if(b[i].page.id==e.id)return b[i].colIdx=Math.min(b[i].colIdx,t),b[i];return n={page:e,colIdx:t,height:0},b.push(n),n},$e=function(e){var t;for(t=0;t<b.length;t++)if(b[t].page.id==e.id){b.splice(t,1);break}},qe=!1,Qe=0,et=function(e,t){var n=J.Deferred(function(n){n.start=function(){e.paginate(n,t)}});return n.done(function(e,t){$e(e);for(var n=e.floatImages,i={forceReRender:!0},o=0;o<n.length;o++){var r=n[o],a=[],s=j(r.viewId,e);for(s=de(s);s;){for(var l=0;l<n.length;l++)a.contains(n[l].parentId)||a.push(n[l].parentId);if(!a.contains(s.node.id)&&(r.removedAffectedNodes.contains(s.node.id)||re(s)&&!r.affectedNodes.contains(s.node.id))){for(var l=0;l<r.affectedNodes.length;l++){var d=Wt(r.affectedNodes[l]);d&&d.getIndex()>s.node.getIndex()&&!r.removedAffectedNodes.contains(s.node.id)&&(r.removedAffectedNodes.push(r.affectedNodes[l]),r.affectedNodes.splice(l,1))}r.affectedNodes.contains(s.node.id)||(r.removedAffectedNodes.contains(s.node.id)&&r.removedAffectedNodes.splice(r.removedAffectedNodes.indexOf(s.node.id),1),r.affectedNodes.push(s.node.id)),he(s.node,i),O[s.node.id]&&InsertShape.createShape("modify",s.node,O[s.node.id].views)}s=de(s)}}if(t){if(editor.doc.getRole()===USER_ROLE.PUBLIC)J(this.el).css("min-height",editor.doc.getBodyFormat()[ATTR_BODY.DS_PH]);else if(EditorView.isFixedView()||EditorView.isWebView()){for(var c=e.content.columns.first,u=0;c;)u=Math.max(u,c.getHeight()),c=c.next;J(e.content.el).css("min-height",u),e.id===ViewManager.pages.first.id?u+=e.header.height:e.id===ViewManager.pages.last.id&&(u+=e.footer.height),J(e.el).css("min-height",u)}Ke(t)}else Qe=0;null==editor.subAction||editor.subAction.state||PubSub.publish("Document/Paginated",e,b.length);try{if(editor.doc.getSelection()&&editor.doc.getSelection().isCollapsed()){e.views.first.node.getIndex(),e.views.last.node.getEndIndex(),editor.doc.getSelection().getStart()}}catch(e){}Qe?setTimeout(nt,10):(Qe=10,nt())}),n},tt=function(){qe=!1},nt=function(){var e,t=I()||1;if(!qe||!b.length){if((EditorView.isFixedView()||EditorView.isWebView())&&(editor.doc.getRole()!==USER_ROLE.PUBLIC||t>1)){var n=v.last;if(n){var i=n.el;J(i).find("div.zw-contentpane").css({height:n.getContentHeight()})}}return void(b.length||(Qe=0,PubSub.publish("Document/Pagination/Complete")))}Xe(),e=et(b[0].page,b[0].colIdx),e.start()},it=function(){var e=I()||1;0!==b.length&&(editor.doc.getRole()!==USER_ROLE.PUBLIC||e>1)&&(qe=!0,nt())},ot=function(){F(),PubSub.publish("header/changed"),PubSub.publish("footer/changed"),PubSub.publish("page/setStyle"),PubSub.publish("PageSettings/updated")},rt=function(){for(var e,t,n;v.last;)e=v.last,v.remove(e),e.remove();for(t in O)n=O[t].views[0],z(n);O={},NoteViewCollection.destroy(),PubSub.unsubscribe("header/started",Pe),PubSub.unsubscribe("header/op",be),PubSub.unsubscribe("header/complete",Ue),PubSub.unsubscribe("header_first/started",Me),PubSub.unsubscribe("header_first/op",Re),PubSub.unsubscribe("header_first/complete",xe),PubSub.unsubscribe("header_odd/started",Le),PubSub.unsubscribe("header_odd/op",Oe),PubSub.unsubscribe("header_odd/complete",Fe),PubSub.unsubscribe("header_even/started",Ne),PubSub.unsubscribe("header_even/op",De),PubSub.unsubscribe("header_even/complete",ke),PubSub.unsubscribe("content/op",Ie),PubSub.unsubscribe("footer/started",Ye),PubSub.unsubscribe("footer/op",we),PubSub.unsubscribe("footer/complete",Ve),PubSub.unsubscribe("footer_first/started",Be),PubSub.unsubscribe("footer_first/op",ye),PubSub.unsubscribe("footer_first/complete",Je),PubSub.unsubscribe("footer_odd/started",He),PubSub.unsubscribe("footer_odd/op",Ae),PubSub.unsubscribe("footer_odd/complete",Ge),PubSub.unsubscribe("footer_even/started",We),PubSub.unsubscribe("footer_even/op",Ce),PubSub.unsubscribe("footer_even/complete",ze),PubSub.unsubscribe("endnote/op",Se),PubSub.unsubscribe("footnote/op",Se),PubSub.unsubscribe("meta/complete",Ze),PubSub.unsubscribe("Section/Remove",qt),PubSub.unsubscribe("Section/TypeChange",en),PubSub.unsubscribe("Section/Updated",Qt)},at=function(){a=new HeaderView_Even,o=new HeaderView_Odd,s=new FooterView_Even,r=new FooterView_Odd,o.create(),o.setStyle(),a.create(),a.setStyle(),r.create(),r.setStyle(),s.create(),s.setStyle()},st=function(){e=new HeaderView_Primary,e.create(),e.setStyle(),t=new FooterView_Primary,t.create(),t.setStyle()},lt=function(){n=new HeaderView_First,i=new FooterView_First,n.create(),n.setStyle(),i.create(),i.setStyle()},dt=function(){var e=editor.doc.getHeaderType();e&&e!=HEADER_FOOTER_TYPE.PRIMARY?e==HEADER_FOOTER_TYPE.DIFF_ODD_EVEN_PAGE?at():e==HEADER_FOOTER_TYPE.DIFF_FIRST_PAGE?(st(),lt()):e==HEADER_FOOTER_TYPE.DIFF_FIRST_ODD_EVEN_PAGE&&(at(),lt()):st()};cleanUpHeaderFooter=function(){for(var l,d=[e,t,n,i,o,r,a,s],c=0,u=d.length;c<u;c++)(l=d[c])&&(J(l.container).empty(),l=void 0)},updateHeaderFooter=function(){ct()};var ct=function(){b=[],rt(),cleanUpHeaderFooter(),N(),F(),dt(),D(),EditorView.isWebView()&&J(ViewManager.pages.first.el).css({"border-top-width":"1px"}),PubSub.publish("Document/FirstPageCreated"),PubSub.subscribe("header/started",Pe),PubSub.subscribe("header/op",be),PubSub.subscribe("header/complete",Ue),PubSub.subscribe("header_first/started",Me),PubSub.subscribe("header_first/op",Re),PubSub.subscribe("header_first/complete",xe),PubSub.subscribe("header_odd/started",Le),PubSub.subscribe("header_odd/op",Oe),PubSub.subscribe("header_odd/complete",Fe),PubSub.subscribe("header_even/started",Ne),PubSub.subscribe("header_even/op",De),PubSub.subscribe("header_even/complete",ke),PubSub.subscribe("content/op",Ie),PubSub.subscribe("footer/started",Ye),PubSub.subscribe("footer/op",we),PubSub.subscribe("footer/complete",Ve),PubSub.subscribe("footer_first/started",Be),PubSub.subscribe("footer_first/op",ye),PubSub.subscribe("footer_first/complete",Je),PubSub.subscribe("footer_odd/started",He),PubSub.subscribe("footer_odd/op",Ae),PubSub.subscribe("footer_odd/complete",Ge),PubSub.subscribe("footer_even/started",We),PubSub.subscribe("footer_even/op",Ce),PubSub.subscribe("footer_even/complete",ze),PubSub.subscribe("endnote/op",Se),PubSub.subscribe("footnote/op",Se),PubSub.subscribe("meta/complete",Ze),PubSub.subscribe("Section/Remove",qt),PubSub.subscribe("Section/TypeChange",en),PubSub.subscribe("Section/Updated",Qt)},ut=function(){return S.height.pixel-E},pt=function(){return S.width.pixel},ht=function(){return v.length},ft=function(e){var t=(v.first,0);return t=e?ut()-e.header.height-e.footer.height:ut()-S.header.height-S.footer.height},mt=function(e){var t=O[e.id]?O[e.id].views:null;return t&&e.section&&"content"==e.section.name&&(t="table"==e.type?t.sort(function(e,t){var n=Gt(e),i=e.column?e.column.columnNumber:1,o=Gt(t),r=t.column?t.column.columnNumber:1;return n==o?i-r:n-o}):t.sort(function(e,t){return e.start-t.start})),t},gt=function(e){for(var t=mt(e)||[],n=[],i=0;i<t.length;i++)for(var o=t[i].nodeLines,r=0;r<o.length;r++)n.push(o[r]);return n},Tt=function(e,t){var n,i,o,r,a,s,l,d=e.id,c=e.type,u=[],p=ViewManager.isMetaSection(e);if(e.section.name.indexOf("content")!==-1||p){for(r=mt(e),n=0,s=r.length;n<s;n++)(a=r[n])&&a.el&&(!t||a.column&&a.column.content.page.id==t||p)&&u.push(a.el);return u}switch(i=vt(t)||v.first,o=0===e.section.name.indexOf("header")?i.header.el:i.footer.el,c){case"para":l=J(o).find("div.zw-paragraph");break;case"table":l=J(o).find("table.zw-table");break;case"row":l=J(o).find("tr.zw-tr");break;case"cell":l=J(o).find("td.zw-td")}for(n=0,s=l.length;n<s;n++)if(J(l[n]).data("nodeId")===d)return u.push(l[n]),u;return u},_t=function(e){var t,n=ViewManager.getViews(e)||[];for(t=0;t<n.length;t++)n[t].updateListNumber()},Et=function(e,t,n){var i,o,r,a,s,l=e.id;for(i=1,o=vt(t)||v.first,r=0===e.section.name.indexOf("header")?o.header.el:o.footer.el,a=J(r).find(".zw-paragraph"),i=0;i<a.length;i++)if(s=J(a[i]),s.data("nodeId")==l)return s.find(".zw-line-div")[n];return null},vt=function(e){for(var t=v.first;t&&t.id!=e;)t=t.next;return t},St=function(e){var t,n,i,o,r;for(e=J(e),t=e.data("nodeId"),n=e.data("viewId"),r=O[t]||{},i=r.views||[],o=0;o<i.length;o++)if(i[o].id==n)return i[o];return null},bt=function(){return{width:pt()+"px",height:ut()+"px"}},Rt=function(){if(EditorView.isFixedView()||EditorView.isWebView()){for(var e=v.first;e;)J(e.el).css("min-height",e.content.height),e=e.next;var t=ut();J(v.last.el).css("min-height",t),J(v.last.content.el).css("min-height",t)}},Ot=function(){return e},Dt=function(){return n},yt=function(){return o},At=function(){return a},Ct=function(){return t},It=function(){return i},wt=function(){return r},Pt=function(){return s},Mt=function(t){var i,r,s=DocTreeManager.doc.sections,l=s.length;for(i=0;i<l;i++)if(t>s[i].start&&s[i].end>=t){r=s[i].name;break}return"header"===r?e.height:"header_first"===r?n.height:"header_odd"===r?o.height:"header_even"===r?a.height:void 0},Lt=function(e){var n,o,a=DocTreeManager.doc.sections,l=a.length;for(n=0;n<l;n++)if(e>a[n].start&&a[n].end>=e){o=a[n].name;break}return"footer"===o?t.height:"footer_first"===o?i.height:"footer_odd"===o?r.height:"footer_even"===o?s.height:void 0},Nt=function(e){var t,n,i,o,r,a,s,l=0;if(t=DocTreeManager.getTreeNodeAtIndex(e),n=ViewManager.getViews(t)||[],"para"==t.type){if(n.length>1)for(i=t.getIndex(),o=t.getEndIndex(),l=0,s=n.length;l<s&&(r=i+n[l].nodeLines[0].start,a=i+lastElementOf(n[l].nodeLines).end,!(r<=e&&e<a||l+1==n.length));l++);return n[l].column}return null},Ut=function(e){var t=v.first,n=DocTreeManager.doc.getSection(e);if(n&&"content"!=n.name)return t=vt(editor.getPageID())||v.first;var i=Nt(e);return null!=i?i.content.page:null},xt=function(){for(var e=v.first;e;)e.isPageRendered||e.forceToRender(),e.content.el.style.display="block",e=e.next},kt=function(e){var t,n=[];switch(e){case"page":for(t=v.first;t;)n.push(t.el),t=t.next}return n},Ft=function(){var e;for(e=v.first;e;)e.content.el.style.display="none",e=e.next},Yt=function(e){var t,n=0;for(n+=e.length,t=e.first;t;)t.views&&(n+=Yt(t.views)),t=t.next;return n},Bt=function(e){var t;for(t=v.first;t&&t.pageNumber!=e;)t=t.next;return t},Ht=function(e,t){var n,i,o,r,a,s,l,d;return n=CurUtil.scrollTop||0,i=editor.editorPaneContainerHt,o=ViewManager.getPageHeight(),t--,r=t*o,a=r+o+CONST.PAGE_BOTTOM_MARGIN_BORDERS,EditorView.isPageView()?r+=t*CONST.PAGE_BOTTOM_MARGIN_BORDERS:(d=editor.doc.getBodyFormat()||{},s=d[ATTR_BODY.DS_MT]||96,l=d[ATTR_BODY.DS_MB]||96,r-=t*(s+l)),n<=r&&r<=n+i||n<=a&&a<=n+i},Wt=function(e){return O[e]&&O[e].views&&O[e].views[0]?O[e].views[0].node:null},Vt=function(){for(var e,t,n,i,o,r=[],a=v.first;a;){for(e=a.getViewsFrom(a.content.columns,"para"),t=0,n=e.length;t<n;t++)if(e[t].el)for(i=0,o=e[t].nodeLines.length;i<o;i++)r.push(e[t].nodeLines[i]);a=a.next}return r},Jt=function(){for(var e,t,n,e=[],i=[],o=v.first;o;){for(e=o.getViewsFrom(o.content.columns,"para"),t=0,n=e.length;t<n;t++)e[t].el&&i.push(e[t].node);o=o.next}return i},Vt=function(){for(var e,t,n,i,o,r=[],a=v.first;a;){for(e=a.getViewsFrom(a.content.columns,"para"),t=0,n=e.length;t<n;t++)if(e[t].el)for(i=0,o=e[t].nodeLines.length;i<o;i++)r.push(e[t].nodeLines[i]);a=a.next}return r},Gt=function(e){return e.column&&e.column.content&&e.column.content.page?e.column.content.page.pageNumber:1},zt=function(){for(var e=ViewManager.getPageAtPageNumber(editor.currentPageIndex+1),t=e.content.columns.first,n=0,i=editor.currentColumnIndex;n<i;n++)t=t.next;return t.left},Zt=function(){for(var e=v.first,t=[];e;)t.push(e),e=e.next;return t},jt=function(e,t){if(!e)return 0;var n=e.getHeight();return t&&(n+=e.getFootNoteHeight()),n},Xt=function(e,t,n){if(!e)return 0;var i=t?e.outerHeight:e.height;return n&&(i+=e.footNoteHeight),i},Kt=function(e){NoteViewCollection.addNoteView(e);var t=NoteViewCollection.findNoteColumn(e.node);"footnote"==e.type?t.addFootNoteView(e,!0):t.addEndNoteView(e,!0)},$t=function(e){if(NoteViewCollection.removeNoteView(e),"footnote"==e.type){var t=e.getContainingPara(),n=t.column;n.removeFromOutGoingFootNotes(e.node.sid),Ke(n.getPage(),X(n))}},qt=function(e){if("footnote"==e.name||"endnote"==e.name){var t=NoteViewCollection.getNoteViews(e.sid)[0];$t(t),t.column.removeNoteView(t)}},Qt=function(e){NoteViewCollection.sortNotes(e.name),NoteViewCollection.updateNoteNumbers(e.name)},en=function(e,t,n){if("footnote"==e.name||"endnote"==e.name){var i=NoteViewCollection.getNoteViews(e.sid)[0];$t(i),tn(i,e)}},tn=function(e,t){for(var n=e.getContainingPara().column,i=e.views,o=e.viewMap,r=i.first;r;)J(r.el).detach(),r=r.next;for(e.viewMap={},e.views=new LinkedList,e.column.removeNoteView(e),newNoteView=NoteViewCollection.createMetaSectionView(t),newNoteView.viewMap=o,newNoteView.views=i,r=newNoteView.views.first;r;)r.column=newNoteView.column,r.page=newNoteView.column.getPage(),newNoteView.appendView(r),r=r.next;Ke(n.getPage(),X(n)),NoteViewCollection.updateNoteNumbers()},nn=function(e){return"footnote"===e.section.name||"endnote"===e.section.name};extend(g,{init:ct,createPage:D,getViewTop:Z,getViewById:j,getNodeById:Wt,modifyPara:he,removePage:y,getColumnWidth:x,getColumnSpacing:k,getColumnIndex:X,getColumnAtIndex:Nt,getColumnFromPageAtIndex:K,getViewFloatImages:ee,getPageFromView:ce,getPageFloatImages:ue,initColumns:N,addViewDetails:G,addBlocks:H,getBlocks:V,removeViewDetails:z,updateListNumber:_t,updatePageSettings:ot,updateFloatImagesPageTop:te,getPageHeight:ut,getPageWidth:pt,getPageCount:ht,getContentHeight:ft,getViews:mt,getViewElements:Tt,getLine:Et,getPageWithId:vt,getView:St,getPageSize:bt,getColumnFormat:C,getNextView:de,getPageAtIndex:Ut,getPageAtPageNumber:Bt,getSplitParaPreviousView:se,getSplitParaNextView:le,updateAllPageHeight:Rt,getViewHeight:jt,getlineHeight:Xt,pages:v,renderAllpages:xt,updateHeaderFooter:updateHeaderFooter,getPages:Zt,getPrimaryHeader:Ot,getPrimaryFooter:Ct,getFirstPageHeader:Dt,getFirstPageFooter:It,getOddPageHeader:yt,getEvenPageHeader:At,getOddPageFooter:wt,getEvenPageFooter:Pt,getCurrentPageHeaderHeight:Mt,getCurrentPageFooterHeight:Lt,getViewsLength:Yt,getElements:kt,pageIsInVisibleRange:Ht,hideAllPageContents:Ft,getLinesInNode:gt,getColumnWidthArray:w,getColumnSpaceArray:P,getColCount:I,isEqualColumnWidth:M,isLineBetweenColumn:L,isFloatImageArea:re,isHeaderView:ie,isFooterView:oe,isMetaSection:nn,addNoteView:Kt,getAllRenderedLines:Vt,getAllRenderedParas:Jt,getCurrentColumnLeft:zt,getPageNumber:Gt})}();var ParaView=function(e){this.id=randomId("para"),this.node=e,this.lines=[],this.start=0,this.height=0,this.nodeLines=[],this.floatImages=[],this.paraStyles,this.borderProperties={"border-top":0,"border-right":0,"border-bottom":0,"border-left":0},ViewManager.addBlocks(this),ViewManager.addViewDetails(this),this.type="para"};extend(ParaView.prototype,{create:function(e,t,n){this.updateProperties();var e=this.addNodeLines(e,t,n);return this.updateBorderStyles(),this.addLines(),this.setBorderStyle(),this.setHeight(),this.adjustHeight(),this.prev&&"para"==this.prev.type&&(this.prev.adjustLineSpaces(),this.prev.setLineSpaceStyle(),this.prev.updateBorderStyles(),this.prev.setBorderStyle(),this.prev.setHeight(),this.adjustHeight(),this.prev.publishLineEvents()),this.next&&"para"==this.next.type&&(this.next.adjustLineSpaces(),this.next.setLineSpaceStyle(),this.next.updateBorderStyles(),this.next.setBorderStyle(),this.next.setHeight(),this.adjustHeight(),this.next.publishLineEvents()),e},clearChildren:function(){var e,t,n;for(n=this.nodeLines.length,e=0;e<n;e++)t=this.nodeLines[e],t.prev=t.next=t.parent=t.el=null,t.view=null;this.nodeLines=[]},updateBorderStyles:function(){var e={},t={},n={},i={},o={},r={},a=null,s=this.getParaStyles();if(this.nodeLines.length){var l=this.nodeLines[0];this.node.getEndIndex()-this.node.getIndex()==lastElementOf(this.nodeLines).end&&(a=lastElementOf(this.nodeLines))}this.borderStyles=DomUtil.getBorderStyles(s),this.borderProperties=clone(Utils.getBorderSize(s)),this.prevHaveSameBorder=!1,this.nextHaveSameBorder=!1,o=this.node.getCodeProperties(),this.prev&&"para"==this.prev.type&&(e=this.prev.getBorderFormat(),i=this.prev.node.getCodeProperties()),this.next&&"para"==this.next.type&&(n=this.next.getBorderFormat(),r=this.next.node.getCodeProperties()),t=this.getBorderFormat(),(Utils.compareJSON(i,o)&&Utils.compareJSON(t,e)||0!=this.start)&&(this.prevHaveSameBorder=!0,this.borderStyles[ATTR_BORDERS.BORDER_TOP]="0px",this.borderStyles.paddingTop="0px",this.borderProperties[ATTR_BORDERS.BORDER_TOP]=0),(Utils.compareJSON(o,r)&&Utils.compareJSON(t,n)||this.lines.length&&this.node.getIndex()+lastElementOf(this.nodeLines).end<this.node.getEndIndex())&&(this.nextHaveSameBorder=!0,this.borderStyles[ATTR_BORDERS.BORDER_BOTTOM]="0px",this.borderStyles.paddingBottom="0px",this.borderProperties[ATTR_BORDERS.BORDER_BOTTOM]=0),1==this.nodeLines.length?l&&(l.style["padding-top"]=this.borderStyles.paddingTop,l.style["padding-bottom"]=this.borderStyles.paddingBottom,l.outerHeight=l.height,this.borderStyles.paddingTop&&(l.outerHeight+=this.borderStyles.paddingTop.convertor().pixels),l.style["margin-top"]&&(l.outerHeight+=l.style["margin-top"].convertor().pixels),this.borderStyles.paddingBottom&&(l.outerHeight+=this.borderStyles.paddingBottom.convertor().pixels),l.style["margin-bottom"]&&(l.outerHeight+=l.style["margin-bottom"].convertor().pixels)):(l&&(l.style["padding-top"]=this.borderStyles.paddingTop,l.outerHeight=l.height,this.borderStyles.paddingTop&&(l.outerHeight+=this.borderStyles.paddingTop.convertor().pixels),l.style["margin-top"]&&(l.outerHeight+=l.style["margin-top"].convertor().pixels)),a&&(a.style["padding-bottom"]=this.borderStyles.paddingBottom,a.outerHeight=a.height,this.borderStyles.paddingBottom&&(a.outerHeight+=this.borderStyles.paddingBottom.convertor().pixels),a.style["margin-bottom"]&&(a.outerHeight+=a.style["margin-bottom"].convertor().pixels)))},getParaStyles:function(){return this.paraStyles||editor.doc.getComputedFormatAt(this.node.getEndIndex(),NODE_TYPE.PARAGRAPH)},updateProperties:function(e){var t=this.node.getEndIndex(),n=this.node.section.doc.getComputedFormatAt(t,NODE_TYPE.PARAGRAPH);this.floatImages=[],this.width=this.node.parent.width-(this.node.borderProperties[ATTR_BORDERS.BORDER_LEFT]+this.node.borderProperties[ATTR_BORDERS.BORDER_RIGHT]),"cell"!=this.node.parent.type&&this.column&&(this.width=this.column.width-(this.node.borderProperties[ATTR_BORDERS.BORDER_LEFT]+this.node.borderProperties[ATTR_BORDERS.BORDER_RIGHT])),this.width=this.width||20,this.left=this.node.parent.left,this.lineProperties={lineFormats:this.lineFormatGenerator(n)}},getBorderFormat:function(){var e,t={};return e=this.getParaStyles(),t=DomUtil.getBorderStyles(e),t.marginLeft=(e[ATTR_PARAGRAPH.PS_ML]||"0in").convertor().inches,t.marginRight=(e[ATTR_PARAGRAPH.PS_MR]||"0in").convertor().inches,t},lineFormatGenerator:function(e){var t,n,i,o,r=this.width,a=[],s={},l={},d=this.getParaStyles(),c=[ATTR_PARAGRAPH.PS_ML,ATTR_PARAGRAPH.PS_MR,ATTR_PARAGRAPH.PS_PL,ATTR_PARAGRAPH.PS_PR];for(o=c.length,i=0;i<o;i++)t=c[i],n=e[t]||d[t],n&&(n=n.convertor().pixels,r-=n,s[t]=n,l[t]=n);var u=e[ATTR_COMMON.BORDERS];s[ATTR_COMMON.BORDERS]={},s[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]={space:(u&&u[ATTR_BORDERS.BORDER_TOP]&&u[ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.SPACE]?u[ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.SPACE]:"0in").convertor().pixels},s[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT]={space:(u&&u[ATTR_BORDERS.BORDER_LEFT]&&u[ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.SPACE]?u[ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.SPACE]:"0in").convertor().pixels},s[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_RIGHT]={space:(u&&u[ATTR_BORDERS.BORDER_RIGHT]&&u[ATTR_BORDERS.BORDER_RIGHT][ATTR_BORDERS.SPACE]?u[ATTR_BORDERS.BORDER_RIGHT][ATTR_BORDERS.SPACE]:"0in").convertor().pixels},s[ATTR_PARAGRAPH.PS_PL]=0,s[ATTR_PARAGRAPH.PS_PR]=0,l[ATTR_COMMON.BORDERS]={},l[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_RIGHT]={space:(u&&u[ATTR_BORDERS.BORDER_RIGHT]&&u[ATTR_BORDERS.BORDER_RIGHT][ATTR_BORDERS.SPACE]?u[ATTR_BORDERS.BORDER_RIGHT][ATTR_BORDERS.SPACE]:"0in").convertor().pixels},l[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT]={space:(u&&u[ATTR_BORDERS.BORDER_LEFT]&&u[ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.SPACE]?u[ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.SPACE]:"0in").convertor().pixels},l[ATTR_PARAGRAPH.PS_PL]=0,l[ATTR_PARAGRAPH.PS_PR]=0,l.width=parseInt(r,10),l.width<0&&(l.width=20);var p=e[ATTR_PARAGRAPH.PS_TI]||d[ATTR_PARAGRAPH.PS_TI];p&&(p=p.convertor().pixels,s[ATTR_PARAGRAPH.PS_TI]=p,s.width=parseInt(r-p),p<0&&(l[ATTR_PARAGRAPH.PS_TI]=Math.abs(p),l[ATTR_PARAGRAPH.PS_ML]-=p),0==this.start&&a.push(s)),s.width<20&&(s.width=20);var h=this,f=function(){return!h.nodeLines.length&&a.length?clone(a.pop()):clone(l)};return{next:f}},getTabProperties:function(e){var t,n,i,o,r,a=this.node.paraProperties.tabPoints,s=this.lineProperties.lineStyle.ml||0,l=this.lineProperties.lineStyle.ti||0,d=(this.lineProperties.lineStyle.pl||0)-(l<0?l:0),c=editor.doc.getBodyFormat()[ATTR_BODY.DS_ML].convertor().pixels||0,u=c+s+(l+d)+this.lineProperties.runningWidth,p=0,h=0,f=0;for(0==this.nodeLines&&this.node.paraProperties.listData&&!J.isEmptyObject(this.node.paraProperties.listData)&&(f=this.node.paraProperties.listData.listCharSize.width||0,u+=f),o=0,r=a.length;o<r;o++){if(t=a[o].value,n=parseInt(a[o].align,10),h=a[o].style,t>u){p=t-u;var m=this.lineProperties.runningWidth+p>this.lineProperties.lineWidth;m&&this.lineProperties.runningWidth<this.lineProperties.lineWidth&&(p=this.lineProperties.lineWidth-this.lineProperties.runningWidth);break}if(o==r-1){var g=(TabHandler.def_pt_len+Conversions.globalUnit).convertor().pixels;p=g>0?g-u%g:0;break}}return i=dimension(p,0),i.align=n,i.leader=h,i},getBlockByIndex:function(e,t){var n,i=e.length;for(n=0;n<i;n++)if(e[n].start==t)return n;return-1},updateViewFloatImages:function(e){var t,n;if("para"==this.type){t=this.floatImages,n=t.length;for(var i=0;i<n;i++)if(t[i].fid==e.fid){t.splice(i,1);break}t.push(e),t.sort(function(e,t){return e.left-t.left})}},updatePageFloatImages:function(){for(var e=ViewManager.getViewFloatImages(this),t=e.length,n=ViewManager.getPageFloatImages(this),i=0;i<t;i++){for(var o=0;n[o];){if(n[o].fid==e[i].fid){n.splice(o,1);break}o++}Utils.arrayContains(["square","left","right"],e[i].align)&&n.push(e[i])}n.sort(function(e,t){return e.left-t.left})},removePageFloatImage:function(e){for(var t=ViewManager.getPageFloatImages(this),n=0;n<t.length;n++)t[n].fid==e.fid&&t.splice(n,1)},removeViewFloatImage:function(e){for(var t=this.floatImages,n=0;n<t.length;n++)t[n].fid==e.fid&&t.splice(n,1)},getFloatImageJson:function(e,t){var n,i,o=this.column?this.column.left:0,r=0,a=t+this.node.getIndex();if(isShape=e[ATTR_IMAGE.I_SHAPEDATA],charSize=this.node.getImageProperties(e,a),imageAlign=e[ATTR_IMAGE.I_AL],isShape){for(var s=0,l=0,d=this.node.paraProperties.floatImages,c=0;c<d.length;c++)if(e.fid==d[c].fid){e.left=d[c].left,s=d[c].width,l=d[c].height,e.top=d[c].top;break}i={height:l,width:s,align:isShape.wrapType,index:t,fid:e.fid,top:e.top,splitTop:r,left:e.left,parentId:this.node.id,paraStart:this.node.start,viewId:this.id,affectedNodes:[],removedAffectedNodes:[],pageTop:ViewManager.getViewTop(this)+e.top,pageLeft:o+e.left,isShape:!0,shapeData:e.shapeData}}else imageAlign&&Utils.arrayContains(["square","left","right","front","behind"],imageAlign)&&(e.pl=0,e.pr=0,e.top=e.top||0,"left"==imageAlign?e.left=0:"right"==imageAlign&&(n=this.column?this.column.width:this.page.width,e.left=n-charSize.width),editor.doc.setFormatAt(a,e),i={height:charSize.height,width:charSize.width,align:imageAlign,index:t,fid:e.fid,top:e.top,splitTop:r,left:e.left,parentId:this.node.id,viewId:this.id,affectedNodes:[],removedAffectedNodes:[],pageTop:ViewManager.getViewTop(this)+e.top,pageLeft:o+e.left},this.parent&&"cell"==this.parent.type&&(this.parent.floatImageHeight[e.fid]=charSize.height));return i},checkLine:function(e,t){var n,i,o,r;if(i=this.nodeLines.length,o=this.lines.length,i<o){for(n=i;n<o;n++)r=this.removeLastLine(),this.isInVisiblePage()?this.removeLine(r):this.column.content.page.isPageRendered=!1;0==this.lines.length&&this.column.content.page&&this.column.removeView(this)}this.start=e,this.isInVisiblePage()?this.updateViewLines(0,t):(this.updateLines(e,t),this.column.content.page.isPageRendered=!1),i>o&&(this.addLines(o,i),this.isInVisiblePage()?this.addViewLines(o,i):this.column.content.page.isPageRendered=!1)},addNodeLines:function(e,t,n,i){var o,r,a,s=this.node.paraProperties,l=this.lineProperties,d=ViewManager.getBlocks(this),c=this.node.segments,u=[],p=!0,h=this.node.getEndIndex(),f=this.node.getIndex(),m=ViewManager.getPageFromView(this),g=ViewManager.getPageFloatImages(this),T=0;if(this.resetLineProperties(e||0),0==e&&(this.floatImages=[]),o=ViewManager.getContentHeight(m),!e){s.isList&&(l.lineWidth-=s.listData.listCharSize.width,l.lineHeight=s.listData.listCharSize.height,l.listWidth=this.node.paraProperties.listData.listCharSize.width,l.listRight=this.node.paraProperties.listData.listRight);var _=NoteViewCollection.getNoteViews(this.node.section.sid)[0];_&&_.isFirstView(this)&&(l.lineWidth-=_.referenceCharWidth)}if(!i&&g&&g.length>0)for(var E=0;g[E];)g[E].viewId!=this.id?E++:g.splice(E,1);if(this.column&&"para"==this.type&&e>0){var v,S,b,R,O,D=this.node.paraProperties.floatImages,y=D.length,A=[];if(y>0){var C,I=ViewManager.getViews(this.node);if(I){C=I[0];for(var E=0;E<y;E++)v=D[E].index,v>e||(S=v+f,b=editor.doc.getCharAt(S),b==UNICODE.IMAGE&&(R=editor.doc.getRawFormatAt(S)||{},A.push(C.getFloatImageJson(R,v))))}var T=0,E=0,w=0;for(I[T]&&(w+=ViewManager.getViewTop(I[T]));I[T];){for(w+=I[T].getHeight();A[E];){var O=A[E];O.pageTop<=w&&(A.splice(E,1),E--),I[T+1]&&O.pageTop+O.splitTop>w&&(I[T].moveFloatImageToNextSplitPara(O),O.splitTop+=I[T].getHeight(),O.pageTop=O.top-O.splitTop,I[T].removePageFloatImage(O),I[T+1].updatePageFloatImages(),I[T].removeViewFloatImage(O)),E++}T++}}}e&&(T=this.getBlockByIndex(d,e));for(var E=T;E<d.length;E++)d[E]&&(d[E].width=d[E].originalWidth);for(;a=d[T];){if(a=d[T],r=a.start+f,Q=editor.doc.getCharAt(r),B=editor.doc.getRawFormatAt(r)||{},Q==UNICODE.TAB)this.node.paraProperties.tabs.push(r-f),W=this.getTabProperties(r),B.width=W.width,B.leader=W.leader,l.tabs.push({align:W.align,block:a,index:a.start,width:W.width}),a.width=W.width;else if(Q==UNICODE.IMAGE){var O=this.getFloatImageJson(B,a.start);if(this.adjustLastTabWidth(a.width),O){for(var w=0,P=!1,M=ViewManager.getSplitParaPreviousView(this);M&&!P;){for(var E=0;E<M.floatImages.length;E++)if(M.floatImages[E].index==O.index){P=!0;break}w+=M.getHeight(),M=ViewManager.getSplitParaPreviousView(M)}if(P||(O.splitTop+=w,O.pageTop=ViewManager.getViewTop(this)+O.top-O.splitTop),M=ViewManager.getSplitParaPreviousView(this),P&&M){T++;continue}if(this.updateViewFloatImages(O),this.updatePageFloatImages(),(l.runningWidth>O.pageLeft&&l.runningWidth+O.width<=this.width||t>O.pageTop)&&!i)return this.reflow(e||0,null,null,"notdone"),this.isReflow=!0,-1}}else this.adjustLastTabWidth(a.width);if(Q==UNICODE.SPACE)for(var L=a.width/(a.end-a.start),N=a.start;N<a.end;N++)this.lineProperties.spaceWidths.push(L);this.adjustForFloatImages(t,a,u);var U=l.runningWidth+a.width>l.lineWidth,x=Q==UNICODE.SPACE;if(p=!0,Q==UNICODE.BR){if(this.setLineHeight(a.start+1),l.blocks.push(a),!(t+this.lineProperties.lineHeight<o||n))return this.makeLine(a.start+1),this.adjustLineSpaces(),this.addTrailingSpacesToRemWidth(),this.adjustBlocksWidth(),this.addSegments(c,u),this.adjustLastSegmentWidth(d),this.lineProperties.lineEnd;t+=this.lineProperties.lineHeight,this.makeLine(a.start+1)}else if(U&&!x){if(x||!(a.width>l.lineWidth)){if(this.setLineHeight(a.start),!(t+this.lineProperties.lineHeight<o||n))return this.makeLine(a.start),this.adjustLineSpaces(),this.addTrailingSpacesToRemWidth(),this.adjustBlocksWidth(),this.addSegments(c,u),this.adjustLastSegmentWidth(d),this.lineProperties.lineEnd;t+=this.lineProperties.lineHeight,this.makeLine(a.start);var k=lastElementOf(u);k&&k.start==a.start&&u.pop();continue}if(Q==UNICODE.IMAGE||Q==UNICODE.TAB){if(l.blocks.length>0){if(this.setLineHeight(a.start),!(t+this.lineProperties.lineHeight<o||n))return this.makeLine(a.start),this.adjustLineSpaces(),this.addTrailingSpacesToRemWidth(),this.adjustBlocksWidth(),this.addSegments(c,u),this.adjustLastSegmentWidth(d),this.lineProperties.lineEnd;t+=this.lineProperties.lineHeight,this.makeLine(a.start);continue}if(l.runningWidth+=a.width,this.setLineHeight(a.start+1),!(t+this.lineProperties.lineHeight<o||n))return this.makeLine(a.start+1),this.adjustLineSpaces(),this.addTrailingSpacesToRemWidth(),this.adjustBlocksWidth(),this.addSegments(c,u),this.adjustLastSegmentWidth(d),this.lineProperties.lineEnd;t+=this.lineProperties.lineHeight,this.makeLine(a.start+1),p=!1}else{if(l.runningWidth>0){if(this.setLineHeight(a.start),!(t+this.lineProperties.lineHeight<o||n))return this.makeLine(a.start),this.adjustLineSpaces(),this.addTrailingSpacesToRemWidth(),this.adjustBlocksWidth(),this.addSegments(c,u),this.adjustLastSegmentWidth(d),this.lineProperties.lineEnd;t+=this.lineProperties.lineHeight,this.makeLine(a.start);continue}var F,Y,B,H,F,W,V=a.end,J=this.node.paraProperties.paraFormat,G=J.textFormat,z=0,Z=0,j="";for(B=this.node.section.doc.getComputedFormatAt(a.start+f,NODE_TYPE.TEXT,J[ATTR_PARAGRAPH.PS_HD]),H=FontUtils.getFontString(B,G),E=a.start;E<V;E++){var X=E+f;if(Q=editor.doc.getCharAt(X),B=this.node.section.doc.getRawFormatAt(X),Y=editor.doc.getRawFormatAt(X),F=jQuery.isEmptyObject(Y),E==a.start||F?(j+=Utils.encodeHTMLChars(Q),W=FontUtils.getCharSize(j,H),z=W.width+Z):(B=this.node.section.doc.getComputedFormatAt(X,NODE_TYPE.TEXT,J[ATTR_PARAGRAPH.PS_HD]),H=FontUtils.getFontString(B,G),j=Utils.encodeHTMLChars(Q),Z=z,W=FontUtils.getCharSize(j,H),z+=W.width),z>l.lineWidth){a.width-l.runningWidth;0==l.runningWidth&&a.width>l.lineWidth&&E++,a.end=E,a.width=l.runningWidth,a.left=0,l.blocks.push(a),this.setLineHeight(E),this.makeLine(E),l.lineWidth<=0&&E++;for(var K,H,$=a.start||0,q={};$<V;)a.fontStringObj.hasOwnProperty($)&&($<E?(q={},q[E]=a.fontStringObj[$]):(q[$]=a.fontStringObj[$],delete a.fontStringObj[$])),$++;K=E;for(var Q,W,ee=FontUtils.getWord(),te=!1;K<V;)te=!0,Q=editor.doc.getCharAt(K+f),q.hasOwnProperty(K)&&(H=q[K]),W=FontUtils.getCharSize(Utils.encodeHTMLChars(Q),H),ee.addChar(Q,K,H,W),K++;if(te&&d.splice(T+1,0,ee.getBlock()),ee.clear(),!(t+this.lineProperties.lineHeight<o||n))return this.adjustLineSpaces(),this.addTrailingSpacesToRemWidth(),this.adjustBlocksWidth(),this.addSegments(c,u),this.adjustLastSegmentWidth(d),E;t+=this.lineProperties.lineHeight;break}l.lineHeight=Math.max(l.lineHeight,W.height),a.left=l.runningWidth,l.runningWidth=z}}}else l.lineHeight=Math.max(l.lineHeight,a.height),a.left=l.runningWidth,l.runningWidth+=a.width,l.blocks.push(a);T++}return this.adjustForFloatImages(t,lastElementOf(d),null,!0),p&&(this.setLineHeight(h-f),this.makeLine(h-f)),this.adjustLineSpaces(!0),this.addTrailingSpacesToRemWidth(),this.adjustBlocksWidth(),this.addSegments(c,u,e),this.adjustLastSegmentWidth(d),-1},adjustLastSegmentWidth:function(e){if(!this.node.paraProperties.paraFormat.dir||"rtl"!=this.node.paraProperties.paraFormat.dir){var t,n,i,o,r,a,s,l,d,c=0,u=this.node.getIndex();for(len=this.nodeLines.length,c=0;c<len;c++)for(t=this.nodeLines[c].segments,r=t.length,o=r-1;o>=0;o--){if(n=t[o],i=editor.doc.getContent(u+n.start,u+n.end),d=i.trimRight(),0!=d.length){d.length!=n.end-n.start&&(s=n.end,n.end=n.start+d.length,a={start:n.end,left:n.left,end:s,isRTL:n.isRTL,format:n.format,width:n.width},a.isSpaceSegment=!0,l=o,t.splice(l+1,0,a));break}n.isSpaceSegment=!0}}},addTrailingSpacesToRemWidth:function(){if(!this.node.paraProperties.paraFormat.dir||"rtl"!=this.node.paraProperties.paraFormat.dir){var e,t,n,i,o,r;for(len=this.nodeLines.length,i=this.node.getIndex(),e=0;e<len;e++){n=this.nodeLines[e].remainingWidth,t=this.nodeLines[e].blocks;for(var a=t.length-1;a>=0;a--)if(o=t[a],r=editor.doc.getContent(o.start+i,o.end+i),o.isTailingBlock=!1," "==r[0])n+=o.width,this.nodeLines[e].width-=o.width,o.isTailingBlock=!0;else{if(r!=UNICODE.BR)break;n+=0}this.nodeLines[e].remainingWidth=n,this.nodeLines[e].origRemainingWidth<0&&(this.nodeLines[e].remainingWidth+=this.nodeLines[e].origRemainingWidth)}}},arrangeBlocksInVisualOrder:function(){for(var e,t,n,i=this.nodeLines,o=!1,r=0,a=i.length;r<a;r++){n=i[r],dtPara=n.parent,e=dtPara.getEndIndex(),t=this.getParaStyles(),o=t&&t[ATTR_PARAGRAPH.PS_DIR]===PARA_DIR.RTL||!1;var s=n.blocks,l=s.length,d=(n.segments,[]),c=[],u=!1;if(o)for(var p,h=0;h<l;h++)p=s[h],u=!1,p.isNeutralChars&&(u=s[h-1]&&s[h-1].isRTL),p.isRTL||u?(c.length&&(d=d.concat(c.reverse()),c=[]),d.push(p)):c.push(p),c.length&&h===l-1&&(d=d.concat(c.reverse()),c=[]);else for(var p,h=0;h<l;h++)p=s[h],u=!1,p.isNeutralChars&&(u=s[h-1]&&s[h-1].isRTL),p.isRTL||u?c.push(p):(c.length&&(d=d.concat(c.reverse()),c=[]),d.push(p)),c.length&&h===l-1&&(d=d.concat(c.reverse()),c=[]);this.calculateVisualLefts(d),this.arrangeBlocksWidthsForImageSegments(n,d),n.blocks=d,this.sortBlocks(n.blocks)}},sortBlocks:function(e){Array.prototype.sort.call(e,function(e,t){return e.start-t.start})},calculateVisualLefts:function(e){var t=this.getParaStyles(),n=t&&t[ATTR_PARAGRAPH.PS_DIR]===PARA_DIR.RTL||!1,i=0;U.each(e,function(e){n?e.isTailingBlock?e.visualLeft=0:(i+=e.width,e.visualLeft=i):(e.visualLeft=i,i+=e.width)})},arrangeBlocksWidthsForImageSegments:function(e,t){for(var n,i=!1,o=e.segments,r=o.length,a=0;a<r;a++)if(n=o[a],n.left>0){i=!0;break}if(i)for(var s,l,d=a;d<r;d++)if(s=o[d],l=s.left)for(var c,u=0,p=t.length;u<p;u++)c=t[u],c.start>=s.start&&(c.visualLeft+=l)},adjustHeight:function(){if(this.parent&&"cell"==this.parent.type&&this.node&&!this.node.next){var e=[],t=this.parent.views.first;for(var n in this.parent.floatImageHeight)e.push(this.parent.floatImageHeight[n]);for(var i=function(t){e=e.map(function(e){return e-t.getHeight()})};t;)i(t),t=t.next;if(e.sort(),e=e[e.length-1],e>0&&this.lines&&this.lines.length&&this.lines[this.lines.length-1].outerHeight<e){var o=this.lines[this.lines.length-1];o.height+=e,o.outerHeight+=e,this.setHeight()}}},adjustBlocksWidth:function(){if(3==this.node.paraProperties.align){var e,t,n,i,o,r,a,s,l,d,c,u,p,h,f=0,m=this.nodeLines,g=m.length,T=this.node.getIndex(),_=!1,E=[],v=0,S=0;for(f=0;f<g;f++){for(d=m[f],i=d.start+T,o=d.end+T,e=d.spaceWidths.length,E=d.blocks,s=0,h=-1,n=E[E.length-1],v=E.length-1;v>=0;v--){n=E[v];var t=editor.doc.getContent(T+n.start,T+n.end);if(" "==t[0])e-=n.end-n.start,s+=n.width||0;else{if(t!=UNICODE.BR&&t!=UNICODE.RANGE_START&&t!=UNICODE.RANGE_END){h=v;break}s+=0}}if(_=e>=1&&(o!=this.node.getEndIndex()||editor.doc.getCharAt(o-1)==UNICODE.BR)&&d.remainingWidth>0){for(l=d.origRemainingWidth,l+=s,a=l,v=0;v<e;v++)a+=d.spaceWidths[v];r=Math.floor(a/e),a-=e*r,d.width+=l,d.remainingWidth=0}d.renderedSpaceWidths.length=0;var b,R,O=!1,D=!1,c=E.length;for(v=0;v<h;v++){for(p=E[v].width,D=!1,R=E[v].start;R<E[v].end;R++)" "==editor.doc.getCharAt(R+T)?(D=!0,_?(b=r+(a>0?1:0),O?E[v].width+=b:E[v].width=b):b=E[v].width/(E[v].end-E[v].start),d.renderedSpaceWidths.push(b),a-=1,O=!0):O=!1;if(D&&(u=E[v].width-p,u>0))for(S=v+1;S<c;S++)E[S].left+=u;O=!1}}}},adjustLineSpaces:function(e){var t=(this.lines,this.nodeLines[0]),n=lastElementOf(this.nodeLines);if(0==this.start&&this.nodeLines.length&&this.node.paraProperties.spaceBeforeParagraph){if(this.prev&&"para"==this.prev.type&&!this.prev.isInDirtyNode()&&this.prev.node.paraProperties&&this.prev.node.paraProperties.spaceAfterParagraph&&this.prev.nodeLines.length)if(this.node.paraProperties.spaceBeforeParagraph>=this.prev.node.paraProperties.spaceAfterParagraph){var i=(lastElementOf(this.prev.nodeLines).style["margin-bottom"]||"0px").convertor().pixels;t.style["margin-top"]=this.node.paraProperties.spaceBeforeParagraph-i+"px"}else t.style["margin-top"]="0px";else t.style["margin-top"]=this.node.paraProperties.spaceBeforeParagraph+"px";this.lines.length&&(this.lines[0].style["margin-top"]=t.style["margin-top"],this.lines[0].outerHeight=t.height+(t.style["margin-top"]||"0px").convertor().pixels,t.outerHeight=this.lines[0].outerHeight)}if(this.nodeLines.length){var o=this.node.getEndIndex()-this.node.getIndex()==n.end,r=this.node.paraProperties;o&&r.spaceAfterParagraph&&(n.style["margin-bottom"]=r.spaceAfterParagraph+"px",this.lines.length&&this.nodeLines.length==this.lines.length&&(1==this.nodeLines.length?n.outerHeight=lastElementOf(this.lines).outerHeight=n.height+(t.style["margin-top"]||"0px").convertor().pixels+(n.style["margin-bottom"]||"0px").convertor().pixels:n.outerHeight=lastElementOf(this.lines).outerHeight=n.height+(n.style["margin-bottom"]||"0px").convertor().pixels,lastElementOf(this.lines).style["margin-bottom"]=n.style["margin-bottom"]))}},addSegments:function(e,t,n){var i,o,r,a,s,l,d=this.nodeLines[0];for(i=0,a=t.length;i<a;i++)for(s=t[i].start,l=t[i].end,o=0;o<e.length;o++)if(r=e[o],r.end>s){e.splice(o+1,0,{start:s,left:t[i].left,end:r.end,isRTL:r.isRTL,format:r.format,width:r.width}),r.end=s;break}for(i=0,a=this.nodeLines.length;i<a;i++)this.nodeLines[i].segments=[];for(i=e.length-1;i>=0;i--)e[i].start==e[i].end&&e.splice(i,1);for(i=0;i<e.length&&d;i++)if(r=e[i],!(r.start<d.start&&r.end<=d.start)&&(r.start<d.end&&(d.segments.push({start:Math.max(r.start,d.start),end:Math.min(r.end,d.end),left:r.left,format:r.format,isRTL:r.isRTL,width:r.width}),r.left=void 0),r.end>=d.end))do d=d.next,d&&(s=Math.max(r.start,d.start),l=Math.min(r.end,d.end),s!=l&&(d.segments.push({start:Math.max(r.start,d.start),end:Math.min(r.end,d.end),left:r.left,format:r.format,isRTL:r.isRTL,width:r.width}),r.left=void 0));while(d&&d.next&&r.end>=d.end);this.node.isCode()&&this.adjustCodeSegments(),this.arrangeBlocksInVisualOrder()},adjustLineCodeSegments:function(e){var t,n,i,o,r,a,s,l=this.node.getIndex(),d=l+e.start,c=l+e.end,u=e.segments,p=[];this.node.paraProperties.codeLanguage;for(t=editor.doc.getContent(d,c),n=this.node.codeSegments,o=0,a=n.length;o<a&&!(n[o]>=e.start);o+=2);for(r=o,o=0,a=u.length;o<a;o++)if(i=u[o],r<=n.length-2)if(i.start==n[r]||i.start>n[r])for(;i.end&&"undefined"!=typeof n[r];){if(s={start:Math.max(i.start,n[r]),end:n[r+2]||i.end,format:i.format,code:n[r+1]},i.start==n[r]&&(s.left=i.left),i.end<=n[r+2]){i.end==n[r+2]&&(r+=2),s.end=i.end,p.push(s);break}p.push(s),r+=2}else{if(s={start:i.start,format:i.format,code:n[r-1]},!(i.end>n[r])){s.end=i.end,p.push(s);continue}for(s.end=n[r],i.start=n[r],p.push(s);i.end&&n[r];){if(s={start:Math.max(i.start,n[r]),end:n[r+2]||i.end,format:i.format,code:n[r+1]},i.start==n[r]&&(s.left=i.left),i.end<n[r+2]){s.end=i.end,s.start!=s.end&&p.push(s);break}p.push(s),r+=2}}else p.push({start:i.start,end:i.end,format:i.format,code:n[n.length-1]});e.segments=p},adjustCodeSegments:function(){var e,t;this.node.paraProperties.codeLanguage;for(e=0,t=this.nodeLines.length;e<t;e++)this.adjustLineCodeSegments(this.nodeLines[e])},adjustLastTabWidth:function(e){var t=lastElementOf(this.lineProperties.tabs);if(t){var n=this.node.getIndex(),i=0,o=this.lineProperties.blocks.length,r=t.block,a=t.width;if(this.lineProperties.runningWidth-=t.width,(1==t.align||2==t.align)&&t.width>0){for(i=0;i<o;i++)if(this.lineProperties.blocks[i]==t.block){i++;break}for(;this.lineProperties.blocks[i];i++)a=Math.min(a,e),1==t.align?this.lineProperties.blocks[i].left-=Math.min(a,e/2):2==t.align&&(this.lineProperties.blocks[i].left-=a)}t.width-=1==t.align?e/2:0,t.width-=2==t.align?e:0,t.width=t.width<0?0:t.width,this.lineProperties.runningWidth+=t.width,r&&(r.width=t.width);var s=editor.doc.getRawFormatAt(t.index+n)||{};s.width=t.width,editor.doc.setFormatAt(t.index+n,s)}},adjustForFloatImages:function(e,t,n,i){var o,r,a=this.lineProperties,s=t?t.height:0,l=ViewManager.getPageFloatImages(this);if(l){var d=l.length,c=this.column?this.column.left:0,u=this.column?this.column.width:0;for(this.left=this.left?this.left:0,o=0;o<d;o++){var p,h,f,m=!0;for(r=l[o],p=r.viewId,f=ViewManager.getNodeById(r.parentId),f&&"cell"==f.parent.type&&f.parent.id!=this.node.parent.id&&(m=!1),h=ViewManager.getNextView(this);h;){if(h.id==p){m=!1;break}h=ViewManager.getNextView(h)}if(Utils.arrayContains(["square","left","right"],r.align)&&m&&e+s>=r.pageTop&&e<=r.pageTop+r.height&&(!this.column||this.left+c+u>r.pageLeft&&c+this.left<r.pageLeft+r.width)){var g=r.pageLeft-c,T=0;if(T=c<r.pageLeft?r.width:r.pageLeft+r.width-c,g<0&&(g=0),r.affectedNodes.contains(this.node.id)||r.parentId==this.node.id||(r.removedAffectedNodes.contains(this.node.id)&&r.removedAffectedNodes.splice(r.removedAffectedNodes.indexOf(this.node.id),1),r.affectedNodes.push(this.node.id)),!i&&a.runningWidth+t.width>g)if(a.runningWidth&&a.runningWidth==a.imagePaddingLeft)a.imagePaddingLeft=Math.max(a.imagePaddingLeft,g+T),a.runningWidth=a.imagePaddingLeft;else if(g+T>=a.runningWidth){var _=lastElementOf(n);_&&_.start==t.start?_.left+=T+(g-a.runningWidth):n.push({start:t.start,left:g+T-a.runningWidth}),a.runningWidth=g+T}}m=!1}a.runningWidth<0&&(a.runningWidth=0)}},setLineHeight:function(e){var t,n,i,o=this.node.paraProperties.paraFormat.textFormat,r=this.lineProperties.lineHeight||this.lineProperties.prevLineHeight||FontUtils.getCharSize(" ",FontUtils.getFontString(this.node.paraProperties.textFormat||{},o)).height||20,a=0;for(t=0,n=this.node.paraProperties.inlineImages.length;t<n;t+=1)i=this.node.paraProperties.inlineImages[t],i.index>=this.lineProperties.lineStart&&i.index<e&&(a=Math.max(a,i.height));this.lineProperties.lineHeight=Math.round(r*(this.node.paraProperties.lineHeight-1))+Math.max(r,a),this.lineProperties.contentHeight=Math.max(r,a)},makeLine:function(e){var t,n,i,o,r,a,s,l,d,c,u=this.lineProperties.runningWidth;for(this.lineProperties.lineEnd=e,n=this.lineProperties.lineWidth-u,t=n,n<0&&(n=0),d={type:"line",start:this.lineProperties.lineStart,end:this.lineProperties.lineEnd,height:this.lineProperties.lineHeight,contentHeight:this.lineProperties.contentHeight,style:this.lineProperties.lineStyle,remainingWidth:n,origRemainingWidth:t,listWidth:this.lineProperties.listWidth||0,listRight:this.lineProperties.listRight||0,width:u,align:this.node.paraProperties.align,segments:[],blocks:this.lineProperties.blocks,length:this.node.end-this.node.start,parent:this.node,view:this,imagePaddingLeft:this.lineProperties.imagePaddingLeft,renderedSpaceWidths:this.lineProperties.spaceWidths.slice(),spaceWidths:this.lineProperties.spaceWidths.slice(),commentEnds:[],autoField:!1,bookMarks:[],footNotes:[],spWords:[]},defineLineProperties(d),c=lastElementOf(this.nodeLines),this.nodeLines.push(d),c&&(d.prev=c,c.next=d),d.next=null,o=this.node.getIndex(),s=0,l=d.blocks.length;s<l;s+=1)if(i=d.blocks[s],i.line=d,r=editor.doc.getCharAt(o+i.start),a=editor.doc.getRawFormatAt(o+i.start),r==UNICODE.RANGE_START){if("bookmark"==a.type)d.bookMarks.push({index:o+i.start,id:a.id,name:a.name});else if("footnote"==a.type||"endnote"==a.type){var p=DocTreeManager.getMetaSection(a.id||a.sid);p.isSectionBuildInRecursion=!0,p.build(),p.isSectionBuildInRecursion=!1}}else r==UNICODE.RANGE_END&&a&&("autofield"==a.type?d.autoField=!0:"footnote"==a.type||"endnote"==a.type?("footnote"==a.type&&d.footNotes.push({index:o+i.start,id:a.id}),noteView=NoteViewCollection.getNoteViews(a.id)[0],noteView.setContainingParaReference(this.id,this.node.id)):"comment"==a.type&&d.commentEnds.push({index:o+i.start,id:a.id}));return PubSub.publish("Document/line/create",d),this.node.paraProperties.runningHeight+=d.height,this.resetLineProperties(e),d},resetLineProperties:function(e){extend(this.lineProperties,{lineHeight:0,imageHeight:0,runningWidth:0,lineStart:e||0,lineStyle:{},lineWidth:1e5,tabs:[],blocks:[],listWidth:0,listRight:0,imagePaddingLeft:0,renderedSpaceWidths:[],spaceWidths:[],commentEnds:[],footNotes:[],bookMarks:[],autofield:!1}),this.lineProperties.lineStyle=this.lineProperties.lineFormats.next(),this.lineProperties.lineWidth=this.lineProperties.lineStyle.width,this.lineProperties.top=this.node.paraProperties.runningHeight},remove:function(){if(this.isInVisiblePage()){var e;if(this.column)for(var t,n,i=!1,o=0,r=ViewManager.getPageFloatImages(this);r[o];)if(this.id==r[o].viewId){t=r[o].affectedNodes,n=r[o].parentId,r.splice(o,1);for(var a=0;t[a];)i=t.contains(this.node.id)&&t[a]!=n,i?(t.splice(t.indexOf(this.node.id),1),ViewManager.modifyPara(this.node)):a++}else{t=r[o].affectedNodes,i=t&&t.contains(this.node.id);var s=ViewManager.getViews(this.node)||[];i&&!s.length&&t.splice(t.indexOf(this.node.id),1),o++}for(e=0;e<this.lines.length;e++)this.resetAutoField(this.lines[e]);J(this.el).remove(),"content"==this.node.section.name&&(this.column.content.page.isPageRendered=!0)}else this.column.content.page.isPageRendered=!1},addLines:function(e,t){var n,i,o,r,a=this.node,s=a.getIndex(),l=this.nodeLines;for(e=e||0,t=t||l.length,r=e;r<t;r++)n=l[r],o={},i={height:n.height,outerHeight:n.height,content:editor.doc.getContent(s+n.start,s+n.end),autoField:n.autoField,segments:n.segments,footNotes:n.footNotes,commentEnds:n.commentEnds},n.style["margin-top"]&&(i.outerHeight+=n.style["margin-top"].convertor().pixels),n.style["margin-bottom"]&&(i.outerHeight+=n.style["margin-bottom"].convertor().pixels),n.style["padding-top"]&&(i.outerHeight+=n.style["padding-top"].convertor().pixels),n.style["padding-bottom"]&&(i.outerHeight+=n.style["padding-bottom"].convertor().pixels),n.outerHeight=i.outerHeight,this.height+=n.height,i.style=clone(l[r].style),this.lines.push(i),defineViewLineProperties(i)},updateLines:function(e){var t,n,i,o,r=this.node,a=r.getIndex();for(this.start=e||0,t=0;t<this.lines.length;t++)i=this.nodeLines[t],n=this.lines[t],o=editor.doc.getContent(a+i.start,a+i.end),extend(n,{content:o,height:i.height,outerHeight:i.height,segments:i.segments,autoField:i.autoField,footNotes:i.footNotes,commentEnds:i.commentEnds}),i.style["margin-top"]&&(n.outerHeight+=i.style["margin-top"].convertor().pixels),i.style["margin-bottom"]&&(n.outerHeight+=i.style["margin-bottom"].convertor().pixels),i.style["padding-top"]&&(n.outerHeight+=i.style["padding-top"].convertor().pixels),i.style["padding-bottom"]&&(n.outerHeight+=i.style["padding-bottom"].convertor().pixels),i.outerHeight=n.outerHeight,n.style=i.style;this.setHeight(),this.adjustHeight()},split:function(e,t,n,i){var o,r,a,s=new ParaView(this.node),l=this.lines,d=0,c=ViewManager.getContentHeight(n.content.page),u=0,p=l.length,h=this.nodeLines.length,f=this.node.paraProperties.widowsOrphan,m=this.node.paraProperties.linesTogether;for(i&&(i.parent&&(s.parent=i.parent),i.borderHeight&&(u=i.borderHeight)),a=0;a<p;a++){if(r=ViewManager.getlineHeight(l[a],!0,i.considerFootNotes),d+r>e){0==a&&(r>c||u+r>c)&&(a++,l[a]&&(r=ViewManager.getlineHeight(l[a],!0,i.considerFootNotes))),m&&d+r<c&&(a=0);break}d+=r}var g=a;if(f&&h>1){a===h-1?2===a?a=0:a--:1===a&&(a=0);var T=l.slice(a),_=T.length;if(a!=g){var E,v=ViewManager.getlineHeight(T[0],!1,i.considerFootNotes);if(_>1){var S=ViewManager.getlineHeight(T[1],!1,i.considerFootNotes);E=v+S}else E=v;0==a&&(_>3||1==_)&&E>c?a=g:2==_&&E>c?a=g:3==_&&E+ViewManager.getlineHeight(T[2],!1,i.considerFootNotes)>c&&(a=g)}}for(var b=a;a<p;a++)o=this.lines[a],this.removeLine(o),this.resetAutoField(o);var R=ViewManager.isFloatImageArea(this),O=t.addView(s);s.start=this.start+b,s.updateProperties(),s.updateBorderStyles();var D=-1;this.nodeLines[b]&&(D=this.nodeLines[b].start),s.lines=this.lines.splice(b),s.nodeLines=this.nodeLines.splice(b);for(var y,A=(s.lines.length,this.lines.length),a=0;a<A;a++){var o=this.lines[a];y=this.nodeLines[a],y.absEnd||(o.style=clone(y.style))}for(var a=0,A=s.nodeLines.length;a<A;a++)s.nodeLines[a].view=s;for(var a=0,A=s.nodeLines.length;a<A;a++)s.nodeLines[a].view=s;var C=0,I=ViewManager.getViews(s.node);U.each(I,function(e){e.start=C,C+=e.lines.length}),this.updateBorderStyles(),this.setHeight(),this.adjustHeight();for(var a=0,w=ViewManager.getViewFloatImages(this);w[a];)w[a].top-w[a].splitTop>this.getHeight()?(this.moveFloatImageToNextSplitPara(w[a]),w[a].splitTop+=this.getHeight(),w[a].pageTop=w[a].top-w[a].splitTop,this.removePageFloatImage(w[a]),s.updatePageFloatImages(w[a]),this.floatImages.splice(a,1)):a++;s.setHeight(),this.postDomChecks(),s.adjustHeight();var P=ViewManager.isFloatImageArea(s),M=t.content.page.isPageRendered;(R||P||this.column.width!=s.column.width)&&D>=0&&!s.isInDirtyNode()?(s.reflow(D,t,O),s.isReflow=!0):(t.addDOMView(s,O),s.adjustHeight()),s.checkMerge(),s.postDomChecks(),s.adjustLineSpaces(),s.setLineSpaceStyle(),s.updateBorderStyles(),s.setBorderStyle(),s.setHeight(),s.publishLineEvents(),!M&&s.isInVisiblePage()&&(t.content.page.isPageRendered=!1),this.moveFootNotesInPara(),s.moveFootNotesInPara();var L=s.next;return L&&"para"==L.type&&(L.adjustLineSpaces(),L.setLineSpaceStyle(),L.updateBorderStyles(),L.setBorderStyle(),L.setHeight()),s},isInDirtyNode:function(){var e;return e=this.node.section.nodesToUpdate.length,this.node.section.nodesToUpdate&&this.node.section.nodesToUpdate.nodesMap&&this.node.section.nodesToUpdate.nodesMap[this.node.id]},checkMerge:function(){this.next&&this.column.viewMap[this.next.id]&&this.node.id==this.next.node.id?this.merge(this.next,this.column):this.prev&&this.column.viewMap[this.prev.id]&&this.prev.node.id==this.node.id&&this.prev.merge(this,this.column)},merge:function(e,t){var n,i,o;o=e.isInVisiblePage(),this.isInVisiblePage()&&!e.isInVisiblePage()&&(o=!0,e.createView());var r,a=this.lines.length;for(this.lines=this.lines.concat(e.lines),this.nodeLines.length&&e.nodeLines.length&&(lastElementOf(this.nodeLines).next=e.nodeLines[0],e.nodeLines[0].prev=lastElementOf(this.nodeLines)),n=0,r=e.nodeLines.length;n<r;n++)e.nodeLines[n].view=this;this.nodeLines=this.nodeLines.concat(e.nodeLines);for(var s=ViewManager.getViewTop(this),l=ViewManager.getViewFloatImages(e),d=l.length,c=ViewManager.getPageFloatImages(e),u=0;u<d;u++){l[u].pageLeft=l[u].left+e.column.left,l[u].pageTop=s+l[u].top,l[u].splitTop-=this.getHeight(),l[u].viewId=this.id,this.updateViewFloatImages(l[u]);for(var p=0;p<c.length;p++)if(c[p].fid==e.floatImages[u].fid){c.splice(u,1);break}}this.updatePageFloatImages(),l.splice(0,d),this.setHeight(),this.adjustHeight();var h=0,f=!1,m=(ViewManager.getViewTop(this)+this.getHeight(),ViewManager.isFloatImageArea(this)),g=ViewManager.isFloatImageArea(e);if(!this.isInDirtyNode()&&(m||g||e.column.width!=t.width)){this.reflow(),f=!0,h=this.lines.length;for(n=a;n<h;n++)i=this.lines[n],this.isInVisiblePage()&&o&&this.setAutoField(i)}for(n=0;n<e.lines.length;n++)i=e.lines[n],e.isInVisiblePage()&&e.resetAutoField(i),this.isInVisiblePage()&&o&&this.el&&i.el&&(f||(this.el.appendChild(i.el),this.setAutoField(i)));f||e.column.removeView(e),this.moveFootNotesInPara(),this.setHeight(),this.adjustHeight(),this.postDomChecks()},setHeight:function(){this.height=0;for(var e=0;e<this.lines.length;e++)this.height+=this.lines[e].outerHeight;this.height&&(0==this.start&&(this.height+=this.borderProperties[ATTR_BORDERS.BORDER_TOP]),this.start+this.lines.length==this.nodeLines.length&&(this.height+=this.borderProperties[ATTR_BORDERS.BORDER_BOTTOM]))},getHeight:function(){var e=this.height,t=this.prev;if(t){var n=t.borderProperties;this.borderProperties&&n&&this.borderProperties[ATTR_BORDERS.BORDER_TOP]==n[ATTR_BORDERS.BORDER_BOTTOM]&&0!=e&&(e-=n[ATTR_BORDERS.BORDER_TOP])}return e},getFootNoteHeight:function(){for(var e,t=0,n=0,i=this.lines.length;n<i;n++)e=this.lines[n],e&&(t+=e.footNoteHeight);return t},removeLastLine:function(){var e=this.lines.pop();return this.height-=e.height,e},createView:function(e){this.el=document.createElement("div"),this.el.setAttribute("class","zw-paragraph"),J(this.el).data({nodeId:this.node.id,viewId:this.id}),this.addViewLines(0,this.lines.length),e&&(e.appendChild(this.el),this.updateAutoField()),this.postDomChecks()},setStyle:function(){var e,t,n,i=this.getParaStyles(),o={},r=J(this.el);r.removeAttr("style"),r.attr({class:"zw-paragraph"});for(e in ParaView.commonStyles)t=i[e],n=ParaView.commonStyles[e],e==ATTR_PARAGRAPH.PS_ML&&i[ATTR_PARAGRAPH.PS_DIR]==PARA_DIR.RTL&&(n=ParaView.commonStyles[ATTR_PARAGRAPH.PS_MR]),t&&(o[n]=t);var a,s,l,d,c,u=i[ATTR_COMMON.BORDERS];d=u&&u[ATTR_BORDERS.BORDER_LEFT]&&u[ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.WIDTH]?u[ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.WIDTH]:"0px",c=u&&u[ATTR_BORDERS.BORDER_RIGHT]&&u[ATTR_BORDERS.BORDER_RIGHT][ATTR_BORDERS.WIDTH]?u[ATTR_BORDERS.BORDER_RIGHT][ATTR_BORDERS.WIDTH]:"0px",a=(i[ATTR_PARAGRAPH.PS_ML]||"0in").convertor().inches-(d.convertor().inches+(u&&u[ATTR_BORDERS.BORDER_LEFT]&&u[ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.SPACE]||"0in").convertor().inches),a+=(i[ATTR_PARAGRAPH.PS_PL]||"0in").convertor().inches,s=(i[ATTR_PARAGRAPH.PS_MR]||"0in").convertor().inches-(c.convertor().inches+(u&&u[ATTR_BORDERS.BORDER_RIGHT]&&u[ATTR_BORDERS.BORDER_RIGHT][ATTR_BORDERS.SPACE]||"0in").convertor().inches),l=(i[ATTR_PARAGRAPH.PS_TI]||"0in").convertor().inches,l<0&&(a+=l),a+="in",s+="in",i[ATTR_PARAGRAPH.PS_DIR]==PARA_DIR.RTL?(o[ParaView.commonStyles[ATTR_PARAGRAPH.PS_MR]]=a,o[ParaView.commonStyles[ATTR_PARAGRAPH.PS_ML]]=s):(o[ParaView.commonStyles[ATTR_PARAGRAPH.PS_ML]]=a,o[ParaView.commonStyles[ATTR_PARAGRAPH.PS_MR]]=s);for(var p=0;p<ParaView.specialStyles.length;p++)if(e=ParaView.specialStyles[p],t=i[e],t||0==t)if(e==ATTR_PARAGRAPH.PS_BGC)"none"==t?o.backgroundColor="":o.backgroundColor=t;else if(e==ATTR_PARAGRAPH.PS_TPS)this.el.setAttribute("data-tabPoints",JSON.stringify(t));else if(e==ATTR_PARAGRAPH.PS_HD)t=t||0,r.attr({"data-header":t}).removeClass().addClass("zw-paragraph heading"+t);else if(e==ATTR_PARAGRAPH.PS_TS){if(DomUtil.isParaEmpty(this.el)){var h=r.find("span.EOP")[0];DomUtil.setStyle(h,t),i&&(i.hasOwnProperty(HISTORY_CONST.ACTION)&&HistoryUtils.setPilcrowStyle(h,i),i.hasOwnProperty(TCConstants.TC)&&TcView.setPilcrowStyle(h,i))}r.attr({"data-textformat":JSON.stringify(t)})}else e==ATTR_PARAGRAPH.LS_DATA&&t&&t.id==editor.doc.getHeadingListId()&&r.attr({"data-hlist":"true"});this.node.isCode()&&r.addClass("code "+this.node.getCodeTheme()),this.node.paraProperties.isQuote&&r.addClass("quote"),t=i[ATTR_PARAGRAPH.PS_AL];var f=i[ATTR_PARAGRAPH.PS_DIR];if(f==PARA_DIR.RTL&&(2==t?t=0:0==t&&(t=2)),i.hasOwnProperty(TCConstants.TC)){var m=editor.doc.getTrackChangeDetails().getDisplayMode();m===TCConstants.ORIGINAL_VIEW&&TcUtil.isAllWithTCInsertionInPara(this.node.getIndex(),this.node.getEndIndex())&&(i=TcView.updateDOMStyles(i),r.addClass(i[ATTR_TEXT.CLS]))}i.hasOwnProperty(HISTORY_CONST.ACTION)&&(i=HistoryUtils.getDiffFormat(i)),this.setBorderStyle(),J.isEmptyObject(o)||r.css(o)},setLineSpaceStyle:function(){if(this.nodeLines[0]&&(this.setLineStyle(this.nodeLines[0],this.nodeLines[0].el),this.nodeLines.length>1)){var e=lastElementOf(this.nodeLines);this.setLineStyle(e,e.el)}},setBorderStyle:function(){if(this.lines.length){var e,t,n,i,o,r=this.borderStyles,a=J(this.el),s={},l={};e=a.find("div.zw-line-div"),e.css({"border-left":r[ATTR_BORDERS.BORDER_LEFT]||"","border-right":r[ATTR_BORDERS.BORDER_RIGHT]||""}),t=this.lines[0],this.nodeLines.length==this.lines.length&&(n=lastElementOf(this.lines)),s[ATTR_BORDERS.BORDER_TOP]=r[ATTR_BORDERS.BORDER_TOP]||"",i=(this.nodeLines[0].style["padding-top"]||"0px").convertor().pixels,s["padding-top"]=t.style["padding-top"]=this.nodeLines[0].style["padding-top"]||"0px",t.outerHeight=this.nodeLines[0].outerHeight,this.prevHaveSameBorder?(s["padding-top"]=(t.style["padding-top"]||"0px").convertor().pixels+(t.style["margin-top"]||"0px").convertor().pixels+"px",i=parseFloat(t.style["padding-top"]||0),s["margin-top"]=0):s["margin-top"]=t.style["margin-top"],n&&(l[ATTR_BORDERS.BORDER_BOTTOM]=r[ATTR_BORDERS.BORDER_BOTTOM]||"",o=(lastElementOf(this.nodeLines).style["padding-bottom"]||"0px").convertor().pixels,l["padding-bottom"]=n.style["padding-bottom"]=lastElementOf(this.nodeLines).style["padding-bottom"]||"0px",n.outerHeight=lastElementOf(this.nodeLines).outerHeight,this.nextHaveSameBorder?(l["padding-bottom"]=(n.style["padding-bottom"]||"0px").convertor().pixels+(n.style["margin-bottom"]||"0px").convertor().pixels+"px",o=parseFloat(n.style["padding-bottom"]||0),l["margin-bottom"]=0):l["margin-bottom"]=n.style["margin-bottom"]),this.lines.length>1?(s.height=t.height+parseFloat(r[ATTR_BORDERS.BORDER_TOP]||0)+parseFloat(s["padding-top"]||0),n&&(l.height=n.height+parseFloat(r[ATTR_BORDERS.BORDER_BOTTOM]||0)+parseFloat(l["padding-bottom"]||0))):n&&1==this.lines.length&&(s["padding-bottom"]=l["padding-bottom"],s["margin-bottom"]=l["margin-bottom"],s["border-bottom"]=l["border-bottom"],s.height=t.height+parseFloat(r[ATTR_BORDERS.BORDER_TOP]||0)+parseFloat(r[ATTR_BORDERS.BORDER_BOTTOM]||0)+parseFloat(s["padding-top"]||0)+parseFloat(s["padding-bottom"]||0)),e.css({"padding-top":"","margin-top":"","padding-bottom":"","margin-bottom":"","border-top":"","border-bottom":""}),e.first().css(s),this.lines.length>1&&e.last().css(l)}},publishLineEvents:function(){if(!this.isInDirtyNode()){var e,t,n,i;e=this.lines[0],t=this.nodeLines[0],e&&(J(e.el).find(CONST_VIEW.LINE_DIV_CHILDREN).remove(),PubSub.publish("Document/lineview/update",e,t)),this.lines.length>1&&(J(n).find(CONST_VIEW.LINE_DIV_CHILDREN).remove(),n=lastElementOf(this.lines),i=lastElementOf(this.nodeLines),PubSub.publish("Document/lineview/update",n,i)),PubSub.publish("paraview/updateforgrammar",this.node)}},postDomChecks:function(){this.el&&(this.updateFloatImages(),this.setStyle(),this.updateListNumber(),this.publishLineEvents())},addViewLines:function(e,t){if(this.el){var n,i,o,r,a;this.node;e=e||0,t=t||this.lines.length;var s=0,l=this.node.parent;for("cell"==l.type&&(s=l.cellPadding.left+l.cellPadding.right),J(this.el).attr("data-width",l.width-s),a=e;a<t;a++)n=this.lines[a],i=this.nodeLines[a],o=this.getLineDiv(i),n.el=o,i.el=o,r=this.constructLine(i,o),n.autoField=r.autoField,n.bookMark=r.bookMarks,this.setAutoField(n),i.viewLine=n,this.el.appendChild(o),PubSub.publish("Document/lineview/create",n,i)}},constructLine:function(e,t){var n,i,o,r,a,s,l,d,c,u,p,h,f,m,g,T,_,E,v,S,b=t.childNodes[0],R=editor.doc.isHiddenMarkersEnabled,O=this.node.getIndex(),D=(O+e.start,O+e.end,this.node.paraProperties.align),y=0,A=[],C=e.spaceWidths.length,I={links:[],commentEnds:[],commentStarts:[]},w=this.getParaStyles(),P=w&&w[ATTR_PARAGRAPH.PS_DIR]===PARA_DIR.RTL||!1;if(e.lineProperties=I,0==e.segments.length||e.start==e.end)return b.appendChild(this.constructEOPPortion(R,w)),I;v=document.createDocumentFragment();var M,L;for(o=0,a=e.segments.length;o<a;o++){d=e.segments[o],c=O+d.start,u=O+d.end,M=editor.doc.getContent(c,u),L=d.isRTL,s=editor.doc.getCharAt(c),l=editor.doc.getThemeStyleFormatAt(c),n=DomUtil.createSpan();var N=J(n);if(m=(l&&l[ATTR_TEXT.CLS]||"").toLowerCase(),l[ATTR_TEXT.TS_VA]&&"none"!=l[ATTR_TEXT.TS_VA]||m.indexOf("endnote")!=-1||m.indexOf("footnote")!=-1){var U=editor.doc.getComputedFormatAt(c,NODE_TYPE.TEXT),x=this.getNoteContainerSpan(U);x.appendChild(n),v.appendChild(x)}else v.appendChild(n);switch(i=i||n,y=u-c,p=e.segments[o+1],h=e.segments[o-1],s){case UNICODE.TAB:var m="zeroSize tab";l=l?l:{};var k={};k["padding-left"]=l.width,k["border-bottom"]=TabHandler.getLeaderStyle(l.leader),N.addClass(m),T=this.getSpacerImage(),J(T).css("width","0px"),n.appendChild(T),l&&N.css(k),l.hasOwnProperty(TCConstants.TC)&&editor.doc.getTrackChangeDetails().getDisplayMode()===TCConstants.ALL_MARKUP_VIEW&&(l=TcView.updateDOMStyles(l),DomUtil.setStyle(n,l)),l.hasOwnProperty(HISTORY_CONST.ACTION)&&(l=HistoryUtils.getDiffFormat(l));break;case UNICODE.IMAGE:if(l=editor.doc.getRawFormatAt(c)||{},l=this.convertWidgetProperty(l),E=!(!l[ATTR_COMMON.ST]||"digisign-field"!=l[ATTR_COMMON.ST]),l.type==ATTR_WIDGET.WIDGET)n=this.createWidgetContainer(l,n),N.css({display:"inline-block"});else if(l[ATTR_IMAGE.I_SHAPEDATA]){var F=J(this.el);if(!F.find("div.inner_shape")[0]){var Y=InsertShape.createShapeDiv(this.node);if(!Y){var B=!!F.length,H=!!F.find("div.inner_shape").length,W=this.node.paraProperties.floatImages&&this.node.paraProperties.floatImages.length;Utils.log("Does paraview.el exist: "+B),Utils.log("Does paraview.el.inner_shape div exist: "+H),Utils.log("Does paraNode.paraProperties contain float images data: "+W)}this.el.appendChild(Y)}n.innerHTML=CONST.ZERO_WIDTH_SPACE}else if(E){var V=DomUtil.createDigiSignField(l);n.appendChild(V)}else{l.hasOwnProperty(TCConstants.TC)&&(l=TcView.updateDOMStyles(l)),l.hasOwnProperty(HISTORY_CONST.ACTION)&&(l=HistoryUtils.getDiffFormat(l));var G=null;if(Utils.arrayContains(["left","right","square","front","behind"],l[ATTR_IMAGE.I_AL])){if(N.addClass("f_"+l.fid).addClass("zeroSize").html("&#8203;"),R){var z=document.createElement("div");z.className="icon-anchor float-div",z.style.top="-"+e.contentHeight+"px",t.appendChild(z)}}else{var G=this.getImage(l);if(Jimage=J(G).children().children("image").addClass("draggable"),"content"==this.node.section.name,l.src){var Z=document.createElement("div");Z.appendChild(G);var j=Z.innerHTML;j=j.replace("<img","<image"),n.innerHTML=j}else n.innerHTML=G.outerHTML;if(N.css({display:"inline-block"}),l[ATTR_IMAGE.I_ROTATE]&&N.css({display:"inline-block",width:l.rot_width,position:"relative",height:l.rot_ht}),l.hasOwnProperty(TCConstants.TC)&&TcUtil.hasTCDeletion(l)){var X=TcView.getDiagonalLineSpan(l,n);X&&n.appendChild(X)}l.linkData&&!editor.isEditable()&&DomUtil.setAnchorForImages(l.linkData,n)}}break;case UNICODE.BR:var m="zw-br-portion";R&&(m+=" icon-linebreak-2"),N.addClass(m).html("&#8203;");break;case UNICODE.RANGE_START:h?L=h.isRTL:p&&(L=p.isRTL),T=this.getSpacerImage(),_=J(T).addClass("zw-range-start").appendTo(n),N.addClass("zeroSize"),l&&(l.id&&l.type==NODE_TYPE.BOOKMARK?(_.attr("id",l.id).addClass("bookmark"),A.push(T)):l.id&&l.type==NODE_TYPE.COMMENT?(_.attr("cid",l.id),I.commentStarts.push({index:c,id:l.id})):l.type==NODE_TYPE.AUTOFIELD&&_.addClass("noprint"));break;case UNICODE.RANGE_END:h?L=h.isRTL:p&&(L=p.isRTL),T=this.getSpacerImage(),_=J(T).addClass("zw-range-end").appendTo(n),l&&Utils.arrayContains([NODE_TYPE.COMMENT,NODE_TYPE.BOOKMARK,NODE_TYPE.LINK,NODE_TYPE.AUTOFIELD],l.type)&&(l.type==NODE_TYPE.COMMENT&&I.commentEnds.push({index:c,id:l.id}),_.attr("cid",l.id).addClass("noprint")),N.addClass("zeroSize");break;default:l&&!jQuery.isEmptyObject(l)||(l=editor.doc.getThemeStyleFormatAt(DocUtil.getTextStyleStart(c))),l.hasOwnProperty(TCConstants.TC)&&(l=TcView.updateDOMStyles(l)),l.hasOwnProperty(HISTORY_CONST.ACTION)&&(l=HistoryUtils.getDiffFormat(l));var K=l.bgc;for(delete l.bgc,d.isSpaceSegment&&(l.bgc="transparent",l.td="none"),DomUtil.setStyle(n,l),m=(l&&l[ATTR_TEXT.CLS]||"").toLowerCase(),m.indexOf(NODE_TYPE.LINK)!=-1&&(DomUtil.setLinkDatas(l,n),I.links.push({url:l[ATTR_LINK.LINK_URL],el:n})),g=[],f="",r=c;r<u;r++)g.push(Utils.encodeHTMLChars(editor.doc.getCharAt(r)));var $=new RegExp(CONT_REGEXP.AUTOFIELD);if($.test(m)){var q=l&&l.hasOwnProperty(ATTR_COMMON.FIELDINFO)?l[ATTR_COMMON.FIELDINFO]:null,Q=CONST.ZERO_WIDTH_SPACE,ee="#";if(/autopcnt|autopno/.test(m)){if(I.autoField=!0,m.indexOf(AUTOFIELD_TYPE.AUTO_PAGECOUNT)!=-1)Q+=CONST.ZERO_WIDTH_SPACE,ee=ViewManager.getPageCount();else{var te=editor.doc.getBodyFormat(),ne=te.pagenumber;ee=this.node&&this.node.section&&this.node.section.name.indexOf("content")!=-1?ViewManager.getPageNumber(this):(editor.currentPageIndex||0)+1,ne&&("undefined"!=typeof ne[ATTR_BODY.DS_PAGENUMBER_STARTS_AT]&&(ee+=ne[ATTR_BODY.DS_PAGENUMBER_STARTS_AT],ee-=1),"undefined"!=typeof ne[ATTR_BODY.DS_PAGENUMBER_FORMAT]&&(ee=List.getListNumber(ne[ATTR_BODY.DS_PAGENUMBER_FORMAT],ee,null,!0)))}var ie="<div class='"+CONST.FIELD_TEXT_NODE+"' style='display:inline-block;font-size:inherit;'>"+ee+"</div>";f=Q+ie}else if(q){var oe="",re=m.match($)[0];oe=this.node.paraProperties.fields[q];var ie="<div class='"+CONST.FIELD_TEXT_NODE+"' style='display:inline-block;font-size:inherit;' data-fieldInfo='"+q+"' data-fieldType='"+re+"'>"+oe+"</div>";f=Q+ie}else f=g.join("").replace(/ /g,"&nbsp;")}else if(m.indexOf(CONST.NEXTRECORD)!=-1){var q=l&&l.hasOwnProperty(ATTR_COMMON.FIELDINFO)?l[ATTR_COMMON.FIELDINFO]:null;f=this.node.paraProperties.fields[q]}else if(3==D||R){S=g.join("");for(var ae=S.indexOf(" ");S&&ae!=-1;)f+=R?S.substring(0,ae)+"<span class='zw-space icon-space' style='display:inline-block; vertical-align:sub;'>&#8203;</span>":S.substring(0,ae)+"<span class='zw-space' style='display:inline-block;'>&nbsp;</span>",S=S.substring(ae+1),ae=S.indexOf(" ");f+=S}else f=g.join("").replace(/ /g,"&nbsp;");if(m.indexOf("endnote")!=-1||m.indexOf("footnote")!=-1){N.append(CONST.ZERO_WIDTH_SPACE),NoteViewCollection.updateNote(l,n);var se;se=m.indexOf("endnote")!=-1?NoteViewCollection.getEndNoteViews():NoteViewCollection.getFootNoteViews();var le=l.id?l.id:l.fid;if(!se.hasOwnProperty(le)){n.innerHTML=f,l.cls="";var U=editor.doc.getRawFormatAt(c);U&&(U[ATTR_COMMON.CLS]=""),editor.doc.setFormatAt(c,U);var de=ZWCollaboration.ENDNOTE_TC_ERROR;Utils.sendErrorDetails(de+"<ZWERROR>"+editor.doc.getDocInfo().VERSION+"."+editor.doc.getDocInfo().REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No ="+ZWCollaboration.ENDNOTE_TC_ERROR+"DOC len ="+editor.doc.getDocumentLength()+" buildLabel::: "+buildLabel+"\n Error Log End \n");break}var ce=se[l.id||l.fid],ue=ATTR_TEXT.TS_SIZE,pe=.7*(l[ue]||this.node.paraProperties.paraFormat.textFormat[ue]||editor.doc.getParaStyles().h0.textFormat[ue]);N.data("id",l.id||l.fid).css({"font-size":Math.round(pe)+"pt"}),ce&&ce.updateNoteReferenceChar()}else{if(p){var he=O+p.start,fe=O+p.end,me=editor.doc.getContent(he,fe);Utils.isArabic(M)&&(Utils.isArabic(me)||me===UNICODE.RANGE_START||me===UNICODE.RANGE_END)&&(f+=CONST.ZERO_WIDTH_JOINER)}n.innerHTML=f,N.children(".field_text_node").css("text-decoration",N.css("text-decoration"))}}P?!L&&s!==UNICODE.TAB&&J('<bdo dir="ltr"/>').appendTo(v).append(N[0]):L&&J('<bdo dir="rtl"/>').appendTo(v).append(N[0]),P&&d.isSpaceSegment&&N.hide(),d.left&&N.css({"padding-left":d.left}),N.attr({"data-text-len":y}),K&&!d.isSpaceSegment&&(l.bgc=K,DomUtil.setSpanBg(N,K)),d.code&&N.addClass(d.code)}if(e.imagePaddingLeft&&J(i).css({"padding-left":e.imagePaddingLeft}),b.appendChild(v),3==D)ae=0,J(b).find("span.zw-space").each(function(){var t=e.spaceWidths[ae],n=J(this),i=n.parents("span.zw-portion").css("text-decoration");n.parents("span.zw-portion").hasClass("link")&&(i?i.indexOf("underline")==-1&&(i+=" underline"):i="underline");var o;if(o=e.renderedSpaceWidths[ae],n.css({width:o}),!R&&i&&(i.indexOf("underline")!==-1||i.indexOf("line-through")!==-1)&&ae<C&&(this.nextSibling||this.parentNode.nextSibling||J(this.parentNode).hasClass("tc-revision"))){for(var r=t&&o?Math.ceil(o/t):0,a="&nbsp;&nbsp;";r&&this.nextSibling;)a+="&nbsp;",r--;n.css({"text-decoration":i}).html(a)}ae++});else if(R){var ge,Te=J(b).find("span.zw-space");for(o=0,ge=Te.length;o<ge;o++)J(Te[o]).css({width:e.spaceWidths[o]})}return 0!=A.length&&DocTreeManager.doc.showBookMark&&(I.bookMarks=A),e.next||b.appendChild(this.constructEOPPortion(R,w)),PubSub.publish("Line/Rendered",e,I),I},createWidgetContainer:function(e,t){var n,i,o=document.createElement("div"),r=document.createElement("div");if(o.className="zw-ifr-div",r.className="ui-iframe-loading-gif",J(o).css("width",e.wid),J(o).css("height",e.ht),e[ATTR_WIDGET.THUMBNAIL]&&editor.isEditable()?n=this.createThumbnailImage(e):e[ATTR_WIDGET.SRC]&&e[ATTR_WIDGET.SRC].match(ATTR_WIDGET.URL_REGEX)&&(n=this.createIframe(e),i=document.createElement("div"),i.className="zw-ifr-msg-div",i.textContent=J.i18n("writer.common.WIDGET_DOUBLE_CLICK_MSG"),o.appendChild(i)),n){o.appendChild(r),o.appendChild(n);var a=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/;e[ATTR_WIDGET.SRC].match(a)&&editor.isEditable()&&e[ATTR_WIDGET.THUMBNAIL]&&this.appendPlayIcon(e,o,n),t.appendChild(o),editor.isEditable()&&(t=this.appendViewIcon(e,t))}return t},createIframe:function(e){var t=document.createElement("iframe");editorRole=editor.doc.getRole(),editor.isEditable()&&(t.className="zw-iframe");var n=J(t),i={};return i[ATTR_IMAGE.I_SRC]=e[ATTR_WIDGET.SRC],i[ATTR_WIDGET.WIDTH]=e[ATTR_WIDGET.WID],i[ATTR_WIDGET.HEIGHT]=e[ATTR_WIDGET.HT],e[ATTR_WIDGET.SRC].match(ATTR_WIDGET.VIDEO_REGEX)||e[ATTR_WIDGET.SRC].match(ATTR_WIDGET.ZOHO_REGEX)?i.sandbox="allow-scripts allow-same-origin":i.sandbox="allow-scripts",n.attr(i),t},createThumbnailImage:function(e){var t=document.createElement("img");editorRole=editor.doc.getRole(),editor.isEditable()&&(t.className="zw-iframe");var n=J(t),i={};return i[ATTR_IMAGE.I_SRC]=e[ATTR_WIDGET.THUMBNAIL],i[ATTR_WIDGET.WIDTH]=e[ATTR_WIDGET.WID],i[ATTR_WIDGET.HEIGHT]=e[ATTR_WIDGET.HT],n.attr(i),t},convertWidgetProperty:function(e){var t={};return"image"!=e.type&&"widget"!=e.type||e[ATTR_WIDGET.SERVICE]?("YOUTUBE"==e[ATTR_WIDGET.SERVICE]?(t[ATTR_COMMON.TYPE]=ATTR_WIDGET.WIDGET,t[ATTR_WIDGET.SRC]=this.createWidgetUrl(e),t[ATTR_WIDGET.THUMBNAIL]=e.src,t[ATTR_WIDGET.HT]=e.ht,t[ATTR_WIDGET.WID]=e.wid):e[ATTR_WIDGET.SERVICE]&&(t[ATTR_COMMON.TYPE]=ATTR_WIDGET.WIDGET,t[ATTR_WIDGET.SRC]=this.createWidgetUrl(e),t[ATTR_WIDGET.HT]=e.ht,t[ATTR_WIDGET.WID]=e.wid),t):e},createWidgetUrl:function(e){var t="",n=window.location.protocol+"//",i=e[ATTR_WIDGET.SERVICE],o=n+document.domain;if(i==ATTR_WIDGET.SERVICE_SHEET)t=o+"/sheet/published.do?rid="+e[ATTR_WIDGET.TUBEID]+"&mode=embed";else if(i==ATTR_WIDGET.SERVICE_SHOW)t=o+"/show/publish/"+e[ATTR_WIDGET.TUBEID];else if(i==ATTR_WIDGET.SERVICE_REPORTS){var r=window.location.hostname;r=r.substring(r.indexOf(".")),t=n+"reports"+r+"/ZDBDataSheetView.cc?OBJID="+e[ATTR_WIDGET.TUBEID]+"&STANDALONE=true&ZDB_THEME_NAME=blue&INTERVAL=-1&REMTOOLBAR=true&INCLUDETITLE=true&INCLUDEDESC=false"}else if(i==ATTR_WIDGET.SERVICE_SHEETEXTERNAL)t=o+"/sheet/publishrange.do?id="+e[ATTR_WIDGET.TUBEID]+"&mode=embed";else if(i==ATTR_WIDGET.SERVICE_SHEETINTRANET)t=o+"/publishrange.org?id="+e[ATTR_WIDGET.TUBEID]+"&mode=embed";else if(i==ATTR_WIDGET.SERVICE_SHEETCHARTIMG)t=o+"/sheet/publicgraphs/"+e[ATTR_WIDGET.TUBEID]+".png";else if(i==ATTR_WIDGET.SERVICE_SHEETCHART)t=o+"/sheet/publicgraphs/"+e[ATTR_WIDGET.TUBEID];else if(i==ATTR_WIDGET.SERVICE_DOCS)t=o+"/file/"+e[ATTR_WIDGET.TUBEID];else if(i.toUpperCase()==ATTR_WIDGET.SERVICE_YOUTUBE){var a,s;e.src&&(a=e.src.split("/"),s=a[a.length-2]),t=n+"www.youtube.com/embed/"+s}return t},appendViewIcon:function(e,t){var n=document.createElement("div"),i=document.createElement("span");return n.className="ui-edit-icon-btn",J(i).attr({size:[e.wid,e.ht],class:"ifr-edite-icon",service:e.service}),n.appendChild(i),J(t).children()[0].appendChild(n),t},appendPlayIcon:function(e,t,n){var i=document.createElement("span"),o=J(t).find("img")[0].getAttribute("class");J(t).find("img")[0].setAttribute("class",o+" embedobj-play-icon");var r=e.ht/2-13,a=e.wid/2-24;J(i).attr({size:[e.wid,e.ht],class:"yt-imgPlay-icon",service:e.service,src:e[ATTR_WIDGET.SRC]}).css({"margin-left":a,"margin-top":r}),J(t)[0].appendChild(i)},isStyleChanged:function(e,t){var n,i;for(n=0,i=e.segments.length;n<i;n++)if(!Utils.compareJSON(e.segments[n].format,t.segments[n].format))return!0;return!1},updateViewLines:function(e,t){var n,i,o,r,a,s,l,d,c=this.node,u=c.getIndex(),p=!1;for(t&&(l=t.forceReRender,s=t.isCollabOp),J(this.el).attr("data-width",this.node.parent.width),i=0;i<this.lines.length;i++){if(d=this.nodeLines[i],o=this.lines[i],!o.el){this.column.content.page.isPageRendered=!1;break}n=editor.doc.getContent(u+d.start,u+d.end),a=o.autoField,(l||o.content!==n||o.segments.length!==d.segments.length||n.indexOf(UNICODE.IMAGE)!=-1||this.isStyleChanged(o,d))&&(J(o.el.childNodes[0]).empty(),J(o.el).find(CONST_VIEW.LINE_DIV_CHILDREN).remove(),this.resetAutoField(o),r=this.constructLine(d,o.el),o.bookMark=r.bookMarks,o.autoField=r.autoField,this.setAutoField(o),o.commentEnds=r.commentEnds,p=!0),extend(o,{content:n,height:d.height,outerHeight:d.height,segments:d.segments,autoField:d.autoField,footNotes:d.footNotes,commentEnds:d.commentEnds}),d.style["margin-top"]&&(o.outerHeight+=d.style["margin-top"].convertor().pixels),d.style["margin-bottom"]&&(o.outerHeight+=d.style["margin-bottom"].convertor().pixels),d.style["padding-top"]&&(o.outerHeight+=d.style["padding-top"].convertor().pixels),d.style["padding-bottom"]&&(o.outerHeight+=d.style["padding-bottom"].convertor().pixels),o.style=d.style,d.el=o.el,d.viewLine=o,d.outerHeight=o.outerHeight,this.setLineStyle(d,o.el),p&&PubSub.publish("Document/lineview/update",o,d),p=!1}this.setHeight(),this.adjustHeight(),this.postDomChecks()},getLineDiv:function(e){var t=DomUtil.createLineDiv();return this.setLineStyle(e,t),t},constructEOPPortion:function(e,t){var n=document.createElement("span"),i="EOP";return e&&(i+=" icon-pilcrow"),t&&(t.hasOwnProperty(HISTORY_CONST.ACTION)&&HistoryUtils.setPilcrowStyle(n,t),t.hasOwnProperty(TCConstants.TC)&&TcView.setPilcrowStyle(n,t)),editor.isEditable()||(i+=" EOP-readonly"),n.className=i+n.className,n.innerHTML="&nbsp;",n},getSpacerImage:function(){var e=document.createElement("img");return e.className="spacer",e},getImage:function(e){var t;if(e.service&&!e.src&&(e.src="https://i.ytimg.com/vi/"+e.id+"/hqdefault.jpg"),DocUtil.setIDforExternalImage(e),e[ATTR_IMAGE.I_ID]&&(t=DomUtil.getImageFromCache(e[ATTR_IMAGE.I_ID]))){var n={};for(var i in e)i!=ATTR_IMAGE.I_SRC&&(n[i]=e[i]);DomUtil.applyStyleToSvgImage(J(t).children("svg").children("image"),n)}if(t||(t=DomUtil.createSvgImage(e),e&&e[ATTR_IMAGE.I_ID]&&(extImgCache[e[ATTR_IMAGE.I_ID]]=t)),e[ATTR_IMAGE.I_ROTATE]){var o=e[ATTR_IMAGE.I_WID],r=e[ATTR_IMAGE.I_HT],a=(e.rot_width-o)/2,s=(e.rot_ht-r)/2;J(t).css({position:"absolute",top:s+"px",left:a+"px"})}return t},updateFloatImages:function(){var e,t,n,i,o=this.node,r=o.getIndex(),a=ViewManager.getViewTop(this),s=(a+this.getHeight(),ViewManager.getViews(this.node),ViewManager.getViewFloatImages(this).length);for(J(this.el).find("div.zw-float").remove(),n=0;n<s;n++)if(t=this.floatImages[n],t.parentId==o.id){i=t.index+r;var l=editor.doc.getRawFormatAt(i);l.hasOwnProperty(TCConstants.TC)&&(l=TcView.updateDOMStyles(l)),l.hasOwnProperty(HISTORY_CONST.ACTION)&&(l=HistoryUtils.getDiffFormat(l));var e=this.getImage(l||{});J(e).attr({pid:t.parentId,fid:t.fid});var d=document.createElement("div");"f_"+Utils.randomString();if(l.src){var c=document.createElement("div");c.appendChild(e);var u=c.innerHTML;u=u.replace("<img","<image"),d.innerHTML=u}else d.innerHTML=e.outerHTML;var p={position:"absolute",top:t.top-t.splitTop,"z-index":10},h=J(d);"right"==t.align?p.left=this.width-t.width:"left"==t.align?p.left="0px":(p.left=t.left,"behind"==t.align&&(p["z-index"]=0,h.addClass("zw-float-behind"))),h.css(p).addClass("zw-float");var f=editor.doc.getRawFormatAt(i)||{};if(f.service&&this.appendPlayIcon(f,d,e),l.hasOwnProperty(TCConstants.TC)&&TcUtil.hasTCDeletion(l)){var m=TcView.getDiagonalLineSpan(l,d);m&&d.appendChild(m)}this.el.appendChild(d),"content"==this.node.section.name}if(this.floatImages.length>0)try{var g=InsertShape.getShapeFromFloatImages(this);g&&!J(this.el).find("div.inner_shape")[0]&&InsertShape.drawShapeInPara(this.el,g)}catch(e){}},updateListNumber:function(){var e=J(this.el),t=e.find(".zw-line-content").first().css("marginLeft",0);if(!this.node.paraProperties.isList)return e.find(".zw-bullet").remove();if(0===this.start){var n=this.node.paraProperties.listData,i=J("<span>").addClass("zw-bullet").attr("style",this.node.paraProperties.listData.listStyle).text(this.node.paraProperties.listData.listNumberString),o=e.find("span.zw-bullet")[0],r=this.node.paraProperties.listData.listType;r===LIST_TYPE.DISC||r===LIST_TYPE.CIRCLE||r===LIST_TYPE.BOX?i.addClass("zw-bullet-unorder-list"):i.addClass("zw-bullet-order-list"),0==n.id||r!==LIST_TYPE.UPPER_ROMAN&&r!==LIST_TYPE.LOWER_ROMAN||t.css("marginLeft",-n.listCharSize.width);var a=i.css("text-decoration")||"";if(/(line-through|none)/.test(a.trim())||i.css("text-decoration","none"),n.listType==LIST_TYPE.CHECKLIST){var s=J("<span>");s.addClass(1===n.state?"icon-checked":"icon-uncheck"),s.on("click",{state:n.state,node:this.node},Utils.checkListHandler),i.html(s),1==n.state&&e.addClass("checked")}o?J(o).before(i).remove():t[0]&&t.children().first().before(i)}},setLineStyle:function(e,t){var n,i,o=this.getParaStyles(),r=o&&o[ATTR_PARAGRAPH.PS_DIR]===PARA_DIR.RTL||!1,a=e.style[ATTR_PARAGRAPH.PS_TI]||0,s=e.style[ATTR_COMMON.BORDERS]&&e.style[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT]&&e.style[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.SPACE]?parseFloat(e.style[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.SPACE]):0,l=e.style[ATTR_COMMON.BORDERS]&&e.style[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_RIGHT]&&e.style[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_RIGHT][ATTR_BORDERS.SPACE]?parseFloat(e.style[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_RIGHT][ATTR_BORDERS.SPACE]):0;i=this.nodeLines,a<0&&(a=0),n=e.remainingWidth||0,0==e.align||3==e.align?n=0:1==e.align&&(n=e.remainingWidth/2),a+=s+n,J(t).height(e.height).css({"margin-top":e.style["margin-top"]||0,"margin-bottom":e.style["margin-bottom"]||0,"padding-top":e.style["padding-top"]||0,"padding-bottom":e.style["padding-bottom"]||0,"padding-left":r?l:a>0?a:0,"padding-right":r?a>0?a:0:l})},updateNoteReferenceChar:function(e){if(0==this.start){var t,n=J("<span>").addClass("endnotenum").html(e).attr({fid:this.node.section.sid}).css({cursor:"pointer"}).unbind("click").click(function(){Note.moveToNoteRange(J(this).attr("fid"))}),i=J(this.el).find("span.endnotenum"),o=this.getNoteContainerSpan({size:10});o.appendChild(n[0]),i[0]?i.parents(":first").before(o).remove():(t=J(this.el).find(".zw-line-content")[0],t&&J(t.childNodes[0]).before(o))}},getNoteContainerSpan:function(e){var t=document.createElement("span");return t.setAttribute("class","zw-portion-outline"),t.style.fontSize=e[ATTR_TEXT.TS_SIZE]+"pt",t},removeNoteReferenceChar:function(e){var t=J(this.el).find("span.endnotenum");t[0]&&t.remove()},setAutoField:function(e){var t=editor.isEditable();e.autoField&&(PubSub.subscribe("applyChanges/complete",this.updateAutoField,{context:this,async:t,timeout:500}),PubSub.subscribe("Document/Pagination/Complete",this.updateAutoField,{context:this,async:t,timeout:500}))},resetAutoField:function(e){var t=editor.isEditable();e.autoField&&(PubSub.unsubscribe("applyChanges/complete",this.updateAutoField,{context:this,async:t,timeout:500}),PubSub.unsubscribe("Document/Pagination/Complete",this.updateAutoField,{context:this,async:t,timeout:500}))},updateAutoField:function(){var e,t,n=editor.doc.getBodyFormat(),i=n.pagenumber,o=ViewManager.getPageCount(),r=ViewManager.getPageNumber(this),a=!1,s=!0,l=editor.doc.findNextIndexOf(UNICODE.TOCSTART,0);if(i&&("undefined"!=typeof i[ATTR_BODY.DS_PAGENUMBER_STARTS_AT]&&(r+=i[ATTR_BODY.DS_PAGENUMBER_STARTS_AT],r-=1),"undefined"!=typeof i[ATTR_BODY.DS_PAGENUMBER_FORMAT]&&(r=List.getListNumber(i[ATTR_BODY.DS_PAGENUMBER_FORMAT],r,null,!0))),l>0){var d=editor.doc.getRawFormatAt(l);s=!d||d.showNo}for(e=0;e<this.lines.length;e++){t=this.lines[e];var c=J(t.el);if(t.autoField){c.find("span.autopcnt").find("div."+CONST.FIELD_TEXT_NODE).text(o),c.find("span.autopno").find("div."+CONST.FIELD_TEXT_NODE).text(r);var u=c.find("span.autopno_toc");if(u.length){var p=c.find("[data-type=2]").attr("data-href"),h=DocUtil.getFloatElementIdx(null,p);if(h){try{var f=ViewManager.getPageAtIndex(h)}catch(e){f=null}var m=f&&f.pageNumber||1;s?u.find("div."+CONST.FIELD_TEXT_NODE).text(m):u.find("div."+CONST.FIELD_TEXT_NODE).text(m).hide()}}a=!0}}a&&"content"!=this.node.section.name&&(0===this.node.section.name.indexOf("header")?PubSub.publish("header/updateAutoFields"):PubSub.publish("footer/updateAutoFields"),PubSub.publish(this.node.section.name+"/updateAutoFields"))},reflow:function(e,t,n,i){var o,r=ViewManager.getViews(this.node);for(c=0;c<r.length;c++)r[c].start<=this.start||r[c].column.removeView(r[c]);o=void 0==e?this.nodeLines[0].start:e,this.clearChildren();for(var a=0,s=this.lines.length;a<s;a++)this.removeLine(this.lines[a]);if(this.lines=[],t&&n&&(this.nodeLines=[],t.addDOMView(this,n)),this.updateProperties(),this.updateBorderStyles(),o>0){var l=ViewManager.getSplitParaPreviousView(this);if(l&&"para"==l.type)for(var d=l.floatImages,c=0;c<d.length;c++)d[c].pageTop>ViewManager.getViewTop(l)+l.getHeight()&&(d[c].pageTop=d[c].top-l.getHeight(),d[c].viewId=this.id,this.updateViewFloatImages(d[c]),this.updatePageFloatImages(),d.splice(c,1))}return"notdone"==i?(i="done",lineIndex=this.addNodeLines(o,ViewManager.getViewTop(this),!0,i),lineIndex):(this.addNodeLines(o,ViewManager.getViewTop(this),!0),this.addLines(0,this.nodeLines.length),this.isInVisiblePage()?this.el?this.addViewLines(0,this.lines.length):this.createView():this.column.content.page.isPageRendered=!1,this.setHeight(),this.postDomChecks(),void this.adjustHeight())},removeLine:function(e){this.resetAutoField(e),J(e.el).remove(),PubSub.publish("lineview/before/remove",[e])},isInVisiblePage:function(){return!editor.isEditable()||!this.column||editor.visiblePageNumbers.contains(this.column.content.page.pageNumber)||this.node.section.name&&"content"!=this.node.section.name},moveFloatImageToNextSplitPara:function(e){var t=ViewManager.getSplitParaNextView(this);t&&(e.viewId=t.id,e.pageLeft=e.left+t.column.left,t.updateViewFloatImages(e))},moveFootNotesInPara:function(){for(var e,t,n,i,o=0,r=this.lines.length;o<r;o++){e=this.lines[o].footNotes,n=e.length;for(var a=0;a<n;a++)i=e[a].id,t=NoteViewCollection.getNoteViews(i)[0],t.setContainingParaReference(this.id,this.node.id),this.column.isAnOutGoingFootNote(i)||t.column.id==this.column.id||this.column.moveViewToFootNote(t,t.column)}}}),function(){var e;e=ParaView.commonStyles={},e[ATTR_PARAGRAPH.PS_DIR]="direction",e[ATTR_PARAGRAPH.PS_ML]="marginLeft",e[ATTR_PARAGRAPH.PS_MR]="marginRight",e[ATTR_PARAGRAPH.PS_WS]="wordSpacing",ParaView.specialStyles=[ATTR_PARAGRAPH.PS_BGC,ATTR_PARAGRAPH.PS_TPS,ATTR_PARAGRAPH.PS_HD,ATTR_PARAGRAPH.PS_TS],ParaView.textAlign={0:"left",1:"center",2:"right",3:"justify"}}(),function(){this.Views={para:ParaView,cell:CellView,row:RowView,table:TableView,hr:HrView,toc:TocView,endnote:EndNoteView,footnote:FootNoteView}}(),DocEvents=function(){var e=editorProps.deployment.zohowriter,t=function(e){editor.editorPaneContainer=J("#ui-editor-outer-div"),editor.editorPaneContainerOffset=editor.editorPaneContainer.offset(),editor.editorPaneContainerHt=editor.editorPaneContainer.height(),UIUtils.setProperties(e),UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING")),J("#drawcontainer").length&&InsertShape.init(),editor.doc.getRole()!=USER_ROLE.PUBLIC&&writerConfig.init()},n=function(e){editor.isHardReload&&J("#loading-page-div").hide()},i=function(){setTimeout(function(){if("REMOTE"!=editor.getEditorType()&&"ANYONEWITHLINK"!=editor.getEditorType()&&"undefined"!=typeof docsComponentjsSource){var e={async:"async",defer:"defer",src:docsComponentjsSource,callback:function(){J(document.createElement("link")).attr({href:docsComponentcssSource,rel:"stylesheet",type:"text/css"}).appendTo(document.head),FILEDIALOG.getI18N(editor.lang)}};loadJS(e)}},2e3)},o=function(){J("#loading-html").hide(),CurUtil.blinkCursor();var e=Utils.endTime("LOADING_COMPONENT");if(editor.docClientInfo.LOADING_COMPONENT=e,UIUtils.hideLoadingMsg(),editor.doc.getRole()!=USER_ROLE.PUBLIC){var t=editor.doc.getDocInfo();1==t.CHECKEDOUT?(PubSub.publish("Collaboration/ResourceLocked",t.CHECKEDOUTBY_ZUID,t.CHECKEDOUTBY_NAME,!1),editor.zuid!=t.CHECKEDOUTBY_ZUID&&J("#Rmenu,#spellCheckMenu,#fmt-lpnl-linespacemenu").zmenu("disable")):t.newDoc&&(J("#filemenu-saveas,#filemenu-saveastemplate,#filemenu-export,#filemenu-addtocloud,#filemenu-shareinvite,#filemenu-print,#filemenu-print-chrome,#topband-setupoffline,#filemenu-marknewversion,#filemenu-viewhistory,#filemenu-publish").each(function(){J(this).disable()}),J("#undo,#redo").each(function(){J(this).disable()})),UIEventHandler.addSubscribers(),J.ZToolbarHandler.init(),J.ZMenuHandler.init(),ReaderPopup.initDomElements(),LinkDialog.initDomElements(),UIUtils.initDOMElements(),UIUtils.onEditorLoad(),TrackChangeUI.initDOMElements(),UIUtils.updateBottomBar(),editor.handleScroll(),UIUtils.toggleCollabActionButtons(),V(),J("#documentname").zellipsis("setTitle",t.DOCUMENT_NAME),UIUtils.initUserInfoDialog(editorProps.userInfo);var n=editor.doc.getRole();"ANYONELINK_SHAREDREADCOMMENT"!==n&&"ANYONELINK_SHAREDREADWRITE"!==n&&"STOREAGE_SERVICE_WRITER"!==n&&"STOREAGE_SERVICE_READER"!==n||UIUtils.updateZohoLogoLink(),"REMOTEVIEW"!==n&&"REMOTECOLLABVIEW"!==n&&"PREVIEW"!==n||editor.jeditorPane.removeAttr("popup"),"REMOTEPUBLICUSER"===n&&J("#filemenu-newdoc,#filemenu-newfromtemplate,#filemenu-uploadfile,#filemenu-open,#filemenu-openDocs,#filemenu-saveas,#filemenu-saveastemplate,#filemenu-addtocloud,#filemenu-shareinvite,#filemenu-marknewversion,#filemenu-viewhistory,#filemenu-publish,#filemenu-docproperties").each(function(){J(this).disable()}),UIUtils.handleDocumentLoadingComplete(),DocTreeManager.isSectionBuildInProcess()&&UIUtils.JprogressDiv.css({display:"inline-block"}),Utils.bindCapitalizeNamesOfDaysShortcut(),UIUtils.setHeadingDropdownStyle();var n=editor.doc.getRole();if(editor.isEditable()){window.isOfflineRequest||J("#topband-savetofolder").on("filefieldfocus",function(e,t){CurUtil.stopBlinking(!0),EventHandler.isMenuOpened=!0,FileMenu.saveToFolderCallback()}).on("filefieldblur",function(e,t){EventHandler.isMenuOpened=!1});var i=HandleTheme.colorPaleteObj();i.defaultColor="rgb(0,0,0)",J.ZContextMenu.registerColorpalette(i)}"PREVIEW"===n&&(PubSub.unsubscribe("Document/ScrollEvent",A),editor.browserInfo.is_ie?editor.editorPaneContainer[0].attachEvent("onscroll",function(){PubSub.publish("Document/ScrollEvent")}):editor.editorPaneContainer[0].addEventListener("scroll",function(){PubSub.publish("Document/ScrollEvent")})),editor.isOffline()||a(),editor.browserInfo.is_ie&&(J("#filemenu-addtocloud").hide(),"WRITER_GDRIVE"===editor.doc.docInfo.SERVICE_NAME&&J("#topband-share-owner").hide()),"WRITER_GDRIVE"!==editor.doc.docInfo.SERVICE_NAME||editor.browserInfo.is_ie||(J("#topband-share-btn").addClass("ui-gdriveshare-btn"),J("#topband-share-btn").zbutton("changeIcon",{primary:"ui-writer-menu-icons ui-icon-sprit-fast ui-icon-topband-google-sm"})),"true"==t.ISSHARED&&J("#collablistmenuinvoke").addClass("ui-display-block"),HandleTheme.consrtuctDesginCombo();var o=editor.doc.getUserData()[editor.zuid];o&&o.showNavigationPane&&DocumentMap.refreshMap(),J(document.createElement(NODE_TYPE.LINK)).attr({href:cssStaticURL+"styles/writer_lazy_min_all.css",rel:"stylesheet",type:"text/css"}).appendTo(document.head),is_wkhtmltopdf_browser||editor.isOffline()||UIUtils.loadFcompFeatureFiles(),RemoteDiff.loadDiff()}},r=function(){if(!is_wkhtmltopdf_browser){editor.isEditable()&&(editor.bindEvents(),Mousetrap.init(document.getElementById("editorpane")),KeyBoardShortCuts.init(),J("#editorpane").attr("context","Rmenu"),editor.browserInfo.is_firefox&&J("#_zohoPaste").css("position","fixed"));var e=Utils.getContextUrl("jsp/fragments.jsp"),t=editor.doc.getDocInfo(),n={};"REMOTE"==editor.getEditorType()?(n.rsid=RemoteEditor.rsid,n.lang=editor.lang,n.action="remote"):window.isOfflineRequest?(n.action="offline",n.role="OFFLINE"):(n.rid=t.RID,n.action="normal"),J.ajax({type:"GET",url:e,data:n,success:function(e){var t=document.createElement("fragment");t.innerHTML=e;var n,i,o,r,a,s,l,d=0;for(i=t.children,d=0,n=i.length;d<n;d++)o=t.children[d],r=o.id,a=r.replace("frag-",""),s=J("#"+a),s[0]&&(l=s[0].children,l.length?J(l[0]).before(o.innerHTML):s.append(o.innerHTML));Jdocument.ztooltip({showShortcutKey:!0,timeDelay:"500"}),UIUtils.initComponent()}}),editor.jeditorPaneWrapper.append(Z("popup-menu-container")[0])}},a=function(){i();var e=editor.doc.getRole();"PREVIEW"!==e&&"undefined"!=typeof WordCountDlg&&WordCountDlg.updateWordCountInBottomPannel()},s=function(e,t){editor.doc.getRole()==USER_ROLE.PUBLIC&&(Jdocument.ztooltip({showShortcutKey:!0,timeDelay:"500"}),UIUtils.initComponent())},l=function(e){J("#menuitem-holder").show(),editor.getView()!=EDITOR_VIEWS.HISTORY&&J("#bottomband-container").show()},d=function(e){404==e?UIUtils.showNetworkError():UIUtils.showMessagePopup(J.i18n("common","UNABLE_TO_LOAD_VERSION"),J.i18n("error","OOPS"),"error",c)},c=function(){document.location.reload()},u=function(e){e?RestoreDocumentProperVersion.restoreToNextProperVersion(Utils.getDocumentId()):RestoreDocumentProperVersion.init()},p={DocViewFailure:function(e){UIUtils.showMessagePopup(J.i18n("error","EDITOR_ERROR_MSG"),J.i18n("common","ALERT"),"info",c,!0)},UpgradeFailure:function(e){J("#upgrade_preview_msg").html(J.i18n("common","UNABLE_TO_MIGRATE")),UIUtils.hideLoadingMsg()},_default:function(e){}},h=function(e){var t=e.docInfo.DOCUMENT_ID,n=e.REASON,i=p._default;return p.hasOwnProperty(n)&&(i=p[n]),i.apply(null,[t])},f={NEW_VERSION_UPLOADED:function(t){editor.getView()==EDITOR_VIEWS.HISTORY||editor.getView()==EDITOR_VIEWS.VERSIONVIEW?UIUtils.showMessagePopup(J.i18n("common","VERSION_UPLOAD"),e,"info",void 0,!1):editor.isEditable()&&UIUtils.showMessagePopup(J.i18n("common","VERSION_UPLOAD_RELOAD"),e,"info",Utils.reloadDocumentContent,!0)},CANT_DELETE_ROW:function(t){UIUtils.showMessagePopup(J.i18n("common","CANT_DELETE_ROW")+" "+J.i18n("common","IS_LOCK_THIS_TABLE",[t+""]),e,"info")},CANT_DELETE_COLUMN:function(t){UIUtils.showMessagePopup(J.i18n("common","CANT_DELETE_COLUMN")+" "+J.i18n("common","IS_LOCK_THIS_TABLE",[t+""]),e,"info")},NOHEADINGFOUND:function(e){UIUtils.showMessagePopup(J.i18n("editor","TOC.NOHEADINGFOUND"),J.i18n("editor","TOC.NOHEADINGFOUND_TITLE_MSG"),"info")},LOWER_HEADING_FOUND:function(e){UIUtils.showMessagePopup(J.i18n("editor","TOC.LOWER_HEADING_FOUND",[e+""]),J.i18n("editor","TOC.NOHEADINGFOUND_TITLE_MSG"),"info")},MERGE_IS_NOT_POSSIBLE:function(e){UIUtils.showMessagePopup(J.i18n("common","MERGE_IS_NOT_POSSIBLE"),J.i18n("common","MERGE_IS_NOT_POSSIBLE_TITLE_MSG"),"info")},BOOKMARK_REMOVED:function(){UIUtils.showMessagePopup(J.i18n("common","BOOKMARK_REMOVED"),J.i18n("common","BOOKMARK_REMOVED_TITLE_MSG"),"status")},UNABLE_TO_LOAD_VERSION:function(){UIUtils.showMessagePopup(J.i18n("common","UNABLE_TO_LOAD_VERSION"),J.i18n("error","OOPS"),"error",function(){})},UNABLE_TO_LOAD_CONTENT_IN_MAILMERGE_PREVIEW:function(){UIUtils.showMessagePopup(J.i18n("common","UNABLE_TO_LOAD_CONTENT_IN_MAILMERGEPREVIEW"),J.i18n("error","OOPS"),"error",function(){})},UNABLE_TO_LOAD_VERSION_IN_HISTORY:function(){UIUtils.showMessagePopup(J.i18n("common","UNABLE_TO_LOAD_VERSION_HISTORY"),J.i18n("common","UNABLE_TO_LOAD_VERSION_HISTORY_TITLE_MSG"),"error",function(){})},UNABLE_TO_PREVIEW_TEMPLATE:function(){UIUtils.showMessagePopup(J.i18n("common","UNABLE_TO_PREVIEW_TEMPLATE"),e,"error",function(){})},REPLACE_NO_MATCHES_FOUND:function(){J("#errormsg").show().html(UIUtils.getErrorMsg("error",J.i18n("common","REPLACE.NO_MATCHES_FOUND")))},REPLACE_SEARCH_COMPLETED_MSG:function(e){J("#errormsg").show().html(UIUtils.getErrorMsg("info",J.i18n("common","REPLACE.SEARCH_COMPLETED_MSG",new Array(e+""))))},COLUMN_WIDTH_IS_LESS:function(){UIUtils.showMessagePopup("Column Width cannot be less than 1.27cm","Column Width not fit to Page Dimension You choosed","info")},_default:function(){}},m=function(e,t){var n=f._default;f.hasOwnProperty(e)&&(n=f[e]),n.apply(null,[t])},g=function(e){UIUtils.showZohoError(e.title,e.errorMsg,e.errorNo)},T=function(e,t,n,i){e&&"-1"!=n&&_(n),UIUtils.showSaveStatus(e,t,n,i)},_=function(e,t){var n={},i=editor.doc.getUserData()[e];i&&(n.LASTMODIFIEDBY_ZUID=e,n.LASTMODIFIEDBY=i.fname,n.LASTMODIFIEDBY_HTML=i.fname_HTML,n.LAST_MODIFIED_TIME_LONG=(new Date).getTime(),editor.doc.setDocInfo(n))},E=function(t){var n=editor.doc.getDocInfo();1==n.VERSION&&0==n.REVISION&&(UIUtils.handleFirstCharSave(),editor.doc.getDocInfo().newDoc=!1),window.document.title=n.DOCUMENT_NAME+" - "+e,J("#topband-savetofolder").zfilefield("rename",n.DOCUMENT_NAME_HTML);var i=editor.editorPaneContainer[0].scrollTop;EditorUtil.focusMultiByteSpan(),editor.editorPaneContainer[0].scrollTop=i},v=function(t){UIUtils.showMessagePopup(J.i18n("common","VERSION_UPLOAD_RELOAD"),e,"info",Utils.reloadDocumentContent,!0)},S=function(e){switch(e){case"RequestError":UIUtils.enableRenameButton("rename_ok"),UIUtils.enterKey(J("#renamefilename"),FileMenu.renameFile);break;case"ResponseFailed":UIUtils.showMessagePopup(J.i18n("writer.common.UNABLE_TO_RENAME"),J.i18n("common","ALERT"),"info")}},b=function(){PubSub.publish("Comment/ShowCurrentSelection")},R=function(t){UIUtils.showMessagePopup(t,e,"error",Utils.resetURL,!1,!1)},O=function(){UIUtils.showMessagePopup(J.i18n("editor","REMOTE_TRASH"),J.i18n("editor","REMOTE_TRASH_TITLE_MSG"),"info",window.close,!1,!1)},D=function(){UIUtils.enableDocumentShortcuts(),UIUtils.handleDocumentUnLockByOwner()},y=function(e){try{if(UIUtils.isPasteToolbarOn()&&editor.doc.getSelection().isCollapsed()&&!Resize.getTargetImg()){var t=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start");t.css("visibility","visible")}UIUtils.JdocumentMenu.hide(),UIUtils.hideControllers(),e&&e==KEYS.ESC&&(jQuery.isEmptyObject(editor.doc.paintFormat)||(UIUtils.toggleButtonStatus("fmt-lpnl-grp-paint","fmt-lpnl-painter","uncheck"),UIUtils.toggleButtonStatus("format-painter-set","smart_formatpainter","uncheck")))}catch(e){}},A=function(){try{editor.handleScroll(),UIUtils.JdocumentMenu.hide(),jQuery.isEmptyObject(editor.doc.paintFormat)||editor.jeditorPane.find("div.zw-page").css("cursor","pointer")}catch(e){}},C=function(e){e&&"mousedown"===e.type&&UIUtils.hideControllers()},I=function(){"undefined"!=typeof RemoteEditor&&RemoteEditor.options.pview&&editor.jeditorPane.find("div.zw-page").css({border:"1px solid #cbcbcb","box-shadow":"0px 0px 0px transparent",margin:"0px"})},w=function(e){var t=Utils.endTime("LOADING_DOCUMENT");editor.docClientInfo.LOADING_DOCUMENT=t,"function"==typeof window.callPhantom&&window.callPhantom(),e&&e.cursorStart>-1&&e.cursorEnd>-1&&b(),UIUtils.JprogressDiv&&(UIUtils.JprogressDiv.hide(),UIUtils.JprogressDiv=null),editor.doc.getRole()==USER_ROLE.PUBLIC&&J(".unselectableSection").removeClass("unselectableSection"),editor.isEditable()||"undefined"==typeof RemoteEditor||jQuery.isEmptyObject(RemoteEditor.options.searchText)||Utils.hiliteText(RemoteEditor.options.searchText),"undefined"!=typeof RemoteEditor&&RemoteEditor.options.pview&&(J("#microandparaVCContainer,#topband-wrapper").remove(),J(".fixedwidth").css("margin","0px"),J("#mainOuterDiv").css({width:"833px","margin-top":"0px"}),J("#ui-editor-outer-div").css({width:"852px",overflow:"auto",height:"510px"}),document.body.style.border="1px solid #FFF",J(".ui-zeditor-light-background").css({background:"#FFF"}),document.body.style.background="#FFF"),Utils.updateQuickStyleLabel()},P=function(e,t){if(null!=editor.subAction.pages)e.pageNumber>=editor.subAction.pages&&(editor.startCursorIdx=UIUtils.getPageIndex(parseInt(editor.subAction.pages)).start,editor.isLazyFileLoaded&&(editor.subAction.state=!0,editor.afterInit()));else if(null!=editor.subAction.bookmarks||null!=editor.subAction.comments){var n=e.content.columns.last.views.last;null!=n&&n.node.start>=editor.startCursorIdx&&editor.isLazyFileLoaded&&(editor.subAction.state=!0,editor.afterInit())}DocTreeManager.isSectionBuildInProcess()||null==editor.subAction||editor.subAction.state||t||!editor.isLazyFileLoaded||(editor.startCursorIdx=1,editor.subAction.state=!0,editor.afterInit())},M=function(e){if(e&&e.cursor&&editor.isEditable())for(var t,n,i=e.node,o=i.parent.getIndex(),r=o+i.start,a=o+i.end,s=e.cursor[editor.uuid]||[],l=0,d=s.length;l<d;l++)if((t=s[l])&&t.start&&t.end){if(t.start!=t.end)return;r<=t.start&&t.start<=a&&t.start>-1&&t.end>-1&&(n=editor.doc.createRange(t.start,t.end),editor.doc.getSelection().removeAllRanges().showCaret(n))}},L=function(e,t){UIUtils.clearView(t),UIUtils.updateViewStatus(e),"Web View"===e&&UIUtils.applyWebView()},N=function(){try{b(),UIUtils.toggleRedactBtns()}catch(e){}},U=function(){UIUtils.disableDocumentShortcuts(),UIUtils.handleDocumentLockByOwner()},x=function(){UIUtils.JdocumentMenu.hide(),UIUtils.hideControllers()},c=function(){document.location.reload()},k=function(){"REMOTE"===editor.getEditorType()?UIUtils.showMessagePopup(J.i18n("common","SESSION_RELOADDOCUMENT"),e,"info",""):UIUtils.showMessagePopup(J.i18n("common","SESSION_RELOADDOCUMENT"),e,"info",c,!0)},F=function(e){var t=editor.browserInfo.is_ie?e.srcElement:e.target;J(t),e.type;EventHandler.isMenuOpened?EventHandler.isMenuOpened=!1:EventHandler.isDialogOpened&&J("#collabdialog").is(":visible")&&UIUtils.preProcessForDialogClose(),UIUtils.hideControllers()},Y=function(){"undefined"!=typeof HandleTheme&&HandleTheme.updateCombos()},B=function(e){EventHandler.isDialogOpened||EventHandler.isMenuOpened||(UIUtils.toggleButtonStatus("fmt-lpnl-grp-paint","fmt-lpnl-painter","check"),UIUtils.toggleButtonStatus("format-painter-set","smart_formatpainter","check"))},H=function(){"undefined"!=typeof EditorLayout&&EditorLayout.updateMainOuterDivProps(),Utils.setEditorHht(),editor.customZoom&&""!=editor.customZoom&&UIUtils.setZoomFactor(editor.customZoom)},W=function(e){CommonError.openBuildChangePopup(e)},V=function(){J("label[for=fmt-lpnl-painter]").bind("dblclick",function(e){editor.doc.paintFormat_dblClick=!0,PubSub.publish("Document/DocumentDblClick",e)}),J("label[for=smart_formatpainter]").bind("dblclick",function(e){editor.doc.paintFormat_dblClick=!0,PubSub.publish("Document/DocumentDblClick",e)})},G=function(){UIUtils.showMessagePopup(J.i18n("common","EDITING_NOT_ALLOWED"),e,"info",Utils.reloadDocumentContent)},z=function(){PubSub.subscribe("Document/InitEditor",t),PubSub.subscribe("Document/FirstTimeComponentReady",o),PubSub.subscribe("Document/BeforeLoading",n),PubSub.subscribe("Document/AfterInit",r),PubSub.subscribe("Document/UserDataFetched",a),PubSub.subscribe("Document/Paginated",P),PubSub.subscribe("Document/Resize",H),PubSub.subscribe("Document/themeChanged",Y),PubSub.subscribe("Document/LoadingError",d),PubSub.subscribe("Document/LoadingFailed",h),PubSub.subscribe("Document/Error",g),PubSub.subscribe("Document/Warning",m),PubSub.subscribe("Document/Restore",u),PubSub.subscribe("Document/SaveStatus",T),PubSub.subscribe("Document/Renamed",E),PubSub.subscribe("Document/RenameFailed",S),PubSub.subscribe("Document/Locked",U),PubSub.subscribe("Document/UnLocked",D),PubSub.subscribe("Document/Trashed",R),PubSub.subscribe("Document/RemoteTrashed",O),PubSub.subscribe("Document/NewVersionUploaded",v),PubSub.subscribe("Document/FirstTimeLoadingStart",s),PubSub.subscribe("Document/LoadingStart",l),PubSub.subscribe("Document/LoadingProgress",M),PubSub.subscribe("Document/LoadingComplete",w),PubSub.subscribe("Document/view/changed",L),PubSub.subscribe("Document/SectionChanged",UIUtils.handleToggleSection),PubSub.subscribe("Document/CursorPositionChanged",N),PubSub.subscribe("Document/Pagination/Complete",I),PubSub.subscribe("Document/DocumentDblClick",B),PubSub.subscribe("Document/ScrollEvent",A),PubSub.subscribe("Document/MouseEvent",C),PubSub.subscribe("Document/BeforeKeyDown",y),PubSub.subscribe("Document/BeforeMouseDown",F),PubSub.subscribe("Document/AfterNaviagtion",x),PubSub.subscribe("Document/SessionInvalid",k),PubSub.subscribe("Server/BuildChange",W),PubSub.subscribe("Document/show_non_printing_char/changed",UIUtils.updateNonPrintingButtonLabel),PubSub.subscribe("Document/bindUIEvents",V),PubSub.subscribe(["Editor/WheelEvent","Document/BeforeMouseDown"],UIUtils.hideRightClickMenu),PubSub.subscribe("Document/unauthorizededit",G)};return{addSubscribers:z}}(),DocMutationEvents=function(){var e=editorProps.deployment.zohowriter,t=function(){document.location.reload()},n={SUCCESS:function(){var e=editor.doc.getDocInfo();1==e.VERSION&&0==e.REVISION&&UIUtils.handleFirstCharSave(),ZWCollaboration.startingVersion||(ZWCollaboration.startingVersion=editor.doc.getDocInfo().VERSION+"."+editor.doc.getDocInfo().REVISION),ZWCollaboration.contentEdited=!0},VIEWING:function(){UIUtils.showMessagePopup(J.i18n("common","CHANGEPERMISSION"),J.i18n("common","CHANGEPERMISSION_TITLE_MSG"),"info",t,!0)},TRASHED_DOC:function(){UIUtils.showMessagePopup(J.i18n("editor","TRASH.DOC_DELETE_MSG_TO_OWNER"),J.i18n("common","ALERT"),"info",t,!0)},NOT_AUTHORIZED_USER:function(){UIUtils.isDialogOpened("commonerror")||UIUtils.showMessagePopup(J.i18n("common","ACCESS_MESSAGE"),J.i18n("common","ACCESS_REVOKED"),"",t,!1,!1,"access")},CLIENT_VERSIONDIFF_EXCEEDS:function(){UIUtils.showMessagePopup(J.i18n("common","VERSIONDIFF_EXCEED_MSG"),J.i18n("common","VERSIONDIFF_EXCEED_TITLE_MSG"),"info",Utils.reloadDocumentContent,!0)},REVERT_STATE:function(){UIUtils.showMessagePopup(J.i18n("common","REVERT_RELOAD"),J.i18n("common","REVERT_RELOAD_TITLE_MSG"),"info",Utils.reloadDocumentContent,!0)},MARKAS_FINAL:function(e){U.isEmpty(e)||PubSub.publish("Document/FinalStateUpdated",e.FINAL_INFO)},NEW_VERSION_UPLOAD_STATE:function(){UIUtils.showMessagePopup(J.i18n("common","VERSION_UPLOAD_RELOAD"),e,"info",Utils.reloadDocumentContent,!0)},CHECKEDOUT:function(e){PubSub.publish("Collaboration/ResourceLocked",e.CHECKEDOUTBY_ZUID,e.CHECKEDOUTBY_NAME,!0)},RESOURCE_EMPTY:function(){UIUtils.showMessagePopup(J.i18n("common","RESOURCE_NOT_ACCESSIBLE"),e,"info")},SAVEDCONTENT_REPAIRED:function(){UIUtils.showMessagePopup(J.i18n("error","CONTENT_REPAIR_ERROR"),J.i18n("error","CONTENT_REPAIR_ERROR_TITLE_MSG"),"info",Utils.reloadDocumentContent,!0)},_default:function(){}},i=function(e,t){UIUtils.showFreezeMessage(!1);var i=n._default;return n.hasOwnProperty(e)&&(i=n[e]),i.apply(null,[t])},o=function(n){var i=n.responseText,o=n.responseJSON||{},r=["<a href='#' onclick='document.location.reload();'>","</a>"],a=J.i18n("writer.editor.ZFS_EXCEPTION",r);if(200==n.status&&n.getResponseHeader("Content-Type").toLowerCase().indexOf("text/html")>=0)UIUtils.showFreezeMessage(!0,"info",J.i18n("writer.common.SIGNED_OUT_MESSAGE",r));else if(500==n.status&&i&&i.indexOf("AUTHENTICATION_FAILED")!=-1)UIUtils.showMessagePopup(J.i18n("common","CHANGEPERMISSION"),J.i18n("common","CHANGEPERMISSION_TITLE_MSG"),"info",t,!0);else if(500==n.status&&i&&i.indexOf("TRASHED_DOC")!=-1)UIUtils.showMessagePopup(J.i18n("editor","TRASH.DOC_DELETE_MSG_TO_OWNER"),e,"info",t,!0);else if(500==n.status&&i&&i.indexOf("ZFS_EXCEPTION")!=-1){var s=J.parseJSON(i),l=s.ERROR_CODE;"F918"===l?PubSub.publish("Collaboration/ResourceLocked",s.CHECKEDOUTBY_ZUID,s.CHECKEDOUTBY_NAME,!0):(UIUtils.showFreezeMessage(!0,"warning",l+" : "+a),J("#network_error_parent").css({"margin-left":"22%"}))}else if(500===n.status&&i&&i.indexOf("REDIS_EXCEPTION")!==-1){var l=J.parseJSON(n.responseText).ERROR_CODE;UIUtils.showFreezeMessage(!0,"warning",l+" : "+a),J("#network_error_parent").css({"margin-left":"22%"}),clearTimeout(Collaboration.slowRespTimer)}else if(500===n.status&&n.responseText&&n.responseText.indexOf("BROWSER_COOKIES_DISABLED")!==-1){var l=J.parseJSON(n.responseText).errorCode;UIUtils.showFreezeMessage(!0,"warning",l+" : "+J.i18n("writer.editor.BROWSER_COOKIE_DISABLE",["<a href='"+editorProps.urls.zohoURL+"/zoho_faq.html#13' target='_blank'>","</a>"])),J("#network_error_parent").css({"margin-left":"25%"})}else if(500===n.status||409===n.status){var l=J.parseJSON(n.responseText).errorCode;UIUtils.showFreezeMessage(!0,"warning",l+" : "+a),J("#network_error_parent").css({"margin-left":"22%"})}else if(502===n.status)PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.SERVER_ERROR_502_BAD_GATEWAY,errorMsg:"MSG_EDIT_ERROR"});else if("timeout"===n.statusText)ZWOffline.isOfflineSetupDone?UIUtils.showNetworkError():PubSub.publish("Document/Mutation/SlowResponse",{title:"TITLE_SERVER_BUSY",errorNo:ZWCollaboration.ACKPENDING_ERROR,errorMsg:"MSG_SERVER_BUSY"});else if("SAMEVERSIONREVISION"==o.UPDATE)ZWCollaboration.checkForResend();else if("FAILED"==o.UPDATE)ZWCollaboration.handleUpdateFailure();else if("OPUPDATEFAILED_INLOCKSTATE"==o.UPDATE)PubSub.publish("Collaboration/LockReceived",editor.doc.docInfo.CREATOR_HTML);else if("RESEND"==o.UPDATE)ZWCollaboration.resendMutation();else if("CHECKEDOUT"==o.UPDATE)PubSub.publish("Collaboration/ResourceLocked",o.CHECKEDOUTBY_ZUID,o.CHECKEDOUTBY_NAME,!0);else if("SAVE_FAILURE"==o.UPDATE){var l=o.errorCode,r=["<a href='#' onclick='document.location.reload();'>","</a>"];UIUtils.showFreezeMessage(!0,"warning",l+" : "+J.i18n("writer.editor.ZFS_EXCEPTION",r)),J("#network_error_parent").css({"margin-left":"22%"}),clearTimeout(Collaboration.slowRespTimer)}else if("REDIS_VERSION_MISMATCH"==o.UPDATE)PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.REDIS_EXCEPTION,errorMsg:"MSG_EDIT_ERROR"});else if("REMOTE_TRASH"==o.UPDATE)PubSub.publish("Document/RemoteTrashed");else if("RESOURCE_TRASHED"==o.UPDATE)PubSub.publish("Collaboration/ResourceTrashed",editor.doc.docInfo.CREATOR_ZUID,editor.doc.docInfo.CREATOR);else{if("READ_ONLY_USER"!=o.UPDATE){var d="";return n&&(n.status?d=n.status:n.statusText&&(d=n.statusText)),Utils.log("OTHER SERVER ERRORS ::: "+d),Utils.sendErrorDetails("NO_ERROR_MAIL<ZWERROR>"+editor.doc.getDocInfo().VERSION+"."+editor.doc.getDocInfo().REVISION+"<ZWERROR>\n Error Log Start \n RESPONSE STATUS ::: "+d+"\n"+ZWCollaboration.clientInfo+"\n Err No =SXP_ERR_100 DOC len ="+editor.doc.getDocumentLength()+" Pen [0]="+(ZWCollaboration.msgQueue.getAckPendingEdit()?ZWCollaboration.msgQueue.getAckPendingEdit().toString():"")+"[1]="+(ZWCollaboration.msgQueue.getPendingToPushEdit()?ZWCollaboration.msgQueue.getPendingToPushEdit().toString():"")+" FULL DOC OP IDS :: "+ZWCollaboration.docOpIds+" buildLabel::: "+buildLabel+"\n Error Log End \n"),void UIUtils.showNetworkError()}PubSub.publish("Document/unauthorizededit")}},r=function(e){var t=function(){PubSub.publish("System/NetworkUp")},n=function(){UIUtils.showNetworkError(J.i18n("common","SERVER_NOT_AVAILABLE"))};Utils.checkNetwork(t,n)},a=function(){PubSub.subscribe("Document/Mutation/SendSuccess",i),PubSub.subscribe("Document/Mutation/SendError",o),PubSub.subscribe("Document/Mutation/SlowResponse",r)};return{addSubscribers:a}}(),DocOperationEvents=function(){var e,t={undo:1,redo:1,instable:1,mergecells:1,splitcells:1,unmergecells:1,deltable:1},n=function(n,i){if(t[n]?(UIUtils.toggleTableTabAndButtons(editor.zuid),"instable"==n&&PubSub.publish("Document/TableInserted")):"ForeColor"===n?Doc.curForeGrdColor=i:"BackColor"===n?Doc.curBackGrdColor=i:"ParaBackColor"===n?Doc.curParaBackGrdColor=i:"deleteAllBookMarks"==n?J("#bMarkGoTo,#bMarkDelete,#bAllDelete").attr("disabled",!0):"unlock"==n&&UIUtils.toggleRedactBtns(),"FormatBlock"===n&&Utils.updateQuickStyleLabel(),("FormatPainter"!=n&&!editor.doc.paintFormat_dblClick&&!jQuery.isEmptyObject(editor.doc.paintFormat)||editor.doc.paintFormat_dblClick&&"applyStyle"!=n)&&(Utils.clearFormatPainterData(),UIUtils.toggleButtonStatus("fmt-lpnl-grp-paint","fmt-lpnl-painter","uncheck"),UIUtils.toggleButtonStatus("format-painter-set","smart_formatpainter","uncheck")),("applyStyle"===n&&i.length&&"body"===i[0].type||"resetStyle"===n||"updateHeadingStyle"===n)&&(PubSub.publish("Document/bodyStyleChanged"),"updateView"==i[2]&&UIUtils.setEditorPaneWrapperHeight(!0)),"applyStyle"===n&&"updateLastColumnWidth"==i[2]&&PubSub.publish("Table/marginChanged"),"undo"===n||"redo"===n||"insertnote"===n||"removenote"===n||"changenotetype"===n||"changeallnotetype"===n){var o=DocTreeManager.doc.getSection(editor.doc.getSelection().getStart()),r=o.start;e!=r&&(EventHandler.setClientActiveSection(o),EventHandler.toggleSection(),editor.jMultiByteSpan.css({top:CurUtil.offset.start.top})),editor.doc.getTrackChangeDetails().getIsReviewPage(),"undo"!==n&&"redo"!==n||PubSub.publish("Document/UndoRedo",n)}"tableLeftMarginChanged"!=editor.lastOperation&&"updateView"!=editor.lastOperation&&"updatePageLayout"!=editor.lastOperation&&"changeDesign"!=n||PubSub.publish("Document/TableStructureModified"),editor.currentCommand=COMMAND.ANY},i=function(t,n){editor.jTdVerticalControler.hide(),editor.jTdHorizantalControler.hide();var i=editor.doc.getSelection(),o=Resize.getTargetImg();if(o&&!editor.imgDrag&&(t.indexOf("ins")!=-1||t.indexOf("auto")!=-1))if("hr"==o.nodeName.toLowerCase()){var r=DocUtil.getDocElement(o);if(r){var a=i.getLastRange();a.setStart(r.getStart()),a.setEnd(r.getEnd())}}else{var a=i.getLastRange();a.setEnd(i.getStart()+1)}"undo"===t||"redo"===t||"notes"===t?e=editor.doc.getSectionStart(i.getStart()):"FormatPainter"==t&&(UIUtils.toggleButtonStatus("fmt-lpnl-grp-paint","fmt-lpnl-painter","check"),UIUtils.toggleButtonStatus("format-painter-set","smart_formatpainter","check"))},o=function(){UIUtils.showLoadingMsg(J.i18n("common","PASTING")),s()},r=function(e){var t=e.htmlCont,n=document.createElement("div");n.innerHTML=t?t:"",JContainer=J(n),"cut"!=editor.lastOperation&&JContainer.find("span[data-comment-info]").remove(),J(n.firstChild).attr("data-doc-rid",editor.doc.docInfo.RID),t=n.innerHTML,e.htmlCont=t},a=function(){PasteUtil.shouldShowPasteToolbar()&&UIUtils.showPasteToolbar()},s=function(){UIUtils.hideControllers()},l=function(e){if(e&&e.cursor){var t,n,i,o,r=e.node,a=r.parent.getIndex(),s=a+r.start,l=a+r.end,d=e.cursor;for(t in d){n=d[t]||[];for(var c=0,u=n.length;c<u;c++)if((i=n[c])&&i.start&&i.end&&s<=i.start&&i.start<l&&i.start>-1&&i.end>-1){o=editor.doc.createRange(i.start,i.end,t);var p=editor.doc.getSelection(t);("tableResize"==editor.lastOperation||"updateRowHeight"==editor.lastOperation||"updateColumnWidth"==editor.lastOperation||Op.isListItemSelection||p.isListItemSelection||p.isMultipleSelection)&&o.setFocus(!1);try{editor.doc.getSelection(t).removeAllRanges().showCaret(o)}catch(e){break}}}}},d=function(e){if("collabop"!==e.operation){w_usersettings.LAST_CLOSED_TIME=(new Date).getTime();var t=e.operation;if("paste"==t&&PubSub.publish("DocOperation/AfterPaste"),("paste"==t||t==COMMAND.CUSTOM_PASTE)&&!InsertShape.selectedShape()){var n=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start");n&&Utils.scrollElementIntoView(n[0])}}},c=function(){UIUtils.showLoadingMsg(J.i18n("common","CREATE_IMAGE"))},u=function(){UIUtils.hideLoadingMsg()},p=function(){document.location.reload()},h=function(){UIUtils.showMessagePopup(J.i18n("common","APPINSTLL"),J.i18n("common","APPINSTLL_TITLE_MSG"),"warning",p,!0,!0)},f=function(e){"CreateLink"===e&&LinkDialog.openLinkPopup()},m=function(){UIUtils.showMessagePopup(J.i18n("common","YOUR_TRYING_TO_LOCK_CONTEND",[ReviewUtil.getUserName(editor.doc.getDocInfo().CREATOR_ZUID)]),J.i18n("common","CANT_ALLOW_OPERATION_LOCK_TITLE_MSG"),"info")},g=function(){PubSub.subscribe("DocOperation/AfterExecCmd",n),PubSub.subscribe("DocOperation/BeforeExecCmd",i),PubSub.subscribe("DocOperation/CommandProgress",l),PubSub.subscribe("DocOperation/CommandComplete",d),PubSub.subscribe("DocOperation/BeforePaste",o),PubSub.subscribe("DocOperation/AfterPaste",a),PubSub.subscribe("DocOperation/BeforeDropImage",c),PubSub.subscribe("DocOperation/AfterDropImage",u),PubSub.subscribe("DocOperation/AfterChromeWebappInstall",h),PubSub.subscribe("DocOperation/applyLastAction",f),PubSub.subscribe("DocOperation/LockError",m),PubSub.subscribe("DocOperation/AfterGettingSelectedHTML",r)};return{addSubscribers:g}}(),CollabEvents=function(){var e=editorProps.deployment.zohowriter,t=function(e,t){ZWCollaboration.addCollaborator(e,t),editor.zuid!=e&&UIUtils.showMsgStatusbar(J.i18n("writer.common.STATUSMSG.openedtheDocument",[t.fname]))},n=function(e){if(ZWCollaboration.removeCollaborator(e),editor.zuid!=e){var t=editor.doc.getUserData()[e]||{};UIUtils.showMsgStatusbar(J.i18n("writer.common.STATUSMSG.closedtheDocument",[t.fname]))}},i=function(t){UIUtils.showMessagePopup(J.i18n("common","CANT_DELETE_TABLE")+" "+J.i18n("common","IS_LOCK_THIS_TABLE",[t]),e,"info")},o=function(){document.location.reload()},r=function(e,t){UIUtils.showMessagePopup(J.i18n("common","CHANGEPERMISSION"),J.i18n("common","CHANGEPERMISSION_TITLE_MSG"),"info",o,!0)},a=function(e,t,n,i){var o=DocUtil.getVersionFromMsg(i),r=DocUtil.getCurrentDocVersion(),a=DocUtil.getVersionNumberDiff(r,o);if(a<0){UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING")),editor.zuid===n&&editor.setEditable(!0);var s=function(){editor.doc.getSelection().select(),UIUtils.hideLoadingMsg(),PubSub.unsubscribe("Document/LoadingStart",s)},l=editor.doc.getDocInfo();PubSub.subscribe("Document/LoadingStart",s),editor.fetchDocument(l.RID,""),UIUtils.showMessage("info",J.i18n("common","REVERTED_INFO",[e,moment(t).format("MMM DD YYYY, hh:mm A")]),"showclose","normalfont",5e3)}},s=function(){editor.setEditable(!1),UIUtils.hideLoadingMsg(),UIUtils.showMessagePopup(J.i18n("common","UPGRADE.DOC_UPGRADE_MSG_TO_OWNER"),J.i18n("common","DOC_UPGRADE_TO_OWNER_TITLE_MSG"),"info",o,!0)},l=function(){UIUtils.toggleCollabActionButtons()},d=function(e,t){editor.doc.setDocInfo({ISSHARED:"true"}),UIUtils.toggleCollabActionButtons(),J("#Collaborators_btn").is(":enabled")||J("#Collaborators_btn,#notifyCollaborators").prop("enable",!0),J("#review-tb-collablist,#review-tb-chat").zbutton("enable"),J("#collablistmenuinvoke").addClass("ui-display-block")},c=function(e,t){UIUtils.isDialogOpened("commonerror")||UIUtils.showMessagePopup(J.i18n("common","ACCESS_MESSAGE"),J.i18n("common","ACCESS_REVOKED"),"",o,!1,!1,"access"),J("#review-tb-collablist,#review-tb-chat").zbutton("disable"),J("#collablistmenuinvoke").removeClass("ui-display-block")},u=function(t,n){UIUtils.showMessagePopup(J.i18n("editor","TRASH.DOC_DELETE_MSG_TO_OWNER"),e,"info",o,!0)},p=function(e,t,n,i){UIUtils.handleDocumentCheckOut(e,t,n,i)},h=function(e,t,n){UIUtils.handleDocumentCheckIn(e,t,n)},f=function(t){UIUtils.showMessagePopup(J.i18n("common","CONTENTLOCK",[t]),e,"info",o,!0)},m=function(){UIUtils.showMessagePopup(J.i18n("common","UNAUTHORIZELOCK"),e,"info",Utils.reloadDocumentContent,!0)},g=function(){PubSub.subscribe("Collaboration/UserAdded",t),PubSub.subscribe("Collaboration/UserRemoved",n),PubSub.subscribe("Collaboration/TableBeingUsed",i),PubSub.subscribe("Collaboration/DocumentReverted",a),PubSub.subscribe("Collaboration/DocPermissionChanged",r),PubSub.subscribe("Collaboration/DocumentMigratedTo3.0",s),PubSub.subscribe("Collaboration/EnableCollabPanel",l),PubSub.subscribe("Collaboration/ResourceUnshared",c),PubSub.subscribe("Collaboration/ResourceShared",d),PubSub.subscribe("Collaboration/ResourceTrashed",u),PubSub.subscribe("Collaboration/ResourceLocked",p),PubSub.subscribe("Collaboration/ResourceUnLocked",h),PubSub.subscribe("Collaboration/LockReceived",f),PubSub.subscribe("Collaboration/LockNotAllowed",m)};return{addSubscribers:g}}(),SystemEvents=function(){var e=function(){UIUtils.showNetworkError()},t=function(){Utils.log("SystemEvents NetworkUp - Called"),ZWCollaboration.checkForResend(),ZWCollaboration.syncSent=!1,clearTimeout(ZWCollaboration.slowRespTimer),ZWCollaboration.slowRespTimer=void 0,UIUtils.UnfreezeEditor()},n=function(){PubSub.subscribe("System/NetworkFailure",e),PubSub.subscribe("System/NetworkUp",t)};return{addSubscribers:n}}(),UserEvents=function(){var e=function(){UIUtils.showFreezeMessage(!0,"info",J.i18n("common","SIGNED_OUT_MESSAGE"))},t=function(){PubSub.subscribe("User/SignedOut",e)};return{addSubscribers:t}}(),EditorEvents=function(){var e=function(){DocEvents.addSubscribers(),DocMutationEvents.addSubscribers(),DocOperationEvents.addSubscribers(),CollabEvents.addSubscribers(),SystemEvents.addSubscribers(),UserEvents.addSubscribers()};return{addSubscribers:e}}(),exportDoc.prototype={value:"doc",needSuggestions:!0,exportDocument:function(){if("pdf"==exportDoc.value){var e={};return"undefined"==typeof HistoryUI||editor.getView()!=EDITOR_VIEWS.HISTORY&&editor.getView()!=EDITOR_VIEWS.VERSIONVIEW||(writerVersion=HistoryUI.getSelectedVersion(),e.version=writerVersion),void PrintPreview.printUsingPDF(!0,!1,"_self",e)}var t=editor.doc.getTrackChangeDetails(),n=t.getDisplayMode();if(n===TCConstants.NO_MARKUP_VIEW||TcManager.isEmpty())exportDoc.startConversion();else{var i=null,o=function(e){switch(e){case 1:exportDoc.needSuggestions=!0,exportDoc.startConversion();break;case 2:exportDoc.needSuggestions=!1,exportDoc.startConversion()}};MsgDialog.showMessage([J.i18n("writer.common.EXPORT_WITH_MARKUP"),J.i18n("writer.common.EXPORT_NO_MARKUP"),J.i18n("writer.common.CANCEL")],"warning","",J.i18n("common","EXPORT_WITH_MARKUP_CONFIRM_MSG"),i,o)}},startConversion:function(){var e=editor.doc.getDocInfo();exportDoc.checkIframe();var t=J("#exportErr")[0],e=editor.doc.getDocInfo(),n=Utils.getContextUrl("jsp/popups/error.jsp?FORMAT="+exportDoc.value),i=e.RID,o="export";"REMOTE"==editor.getEditorType()?(n+="&rsid="+RemoteEditor.rsid,o="remoteExport"):n+="&rid="+i,n+="&ACTION="+o,n+="&suggestion="+exportDoc.needSuggestions,"undefined"==typeof HistoryUI||editor.getView()!=EDITOR_VIEWS.HISTORY&&editor.getView()!=EDITOR_VIEWS.VERSIONVIEW||(n+="&version="+HistoryUI.getSelectedVersion()),t.src=n},checkIframe:function(){var e=J("#exportErr")[0];void 0==e&&(e=document.createElement("iframe"),e.id="exportErr",J(e).css("display","none"),document.body.appendChild(e))},exportAs:function(e){e||(e="docx"),this.value=e,WebUtil.saveDocumentCurrentVersions(this.exportDocument)},isHtml:function(){var e=J("#mainOuterDiv image.zw-image").length;J("#exportaszip,#exportashtml").show(),0==e?J("#exportaszip").hide():J("#exportashtml").hide()},postProcessingChangesForPDF:function(e){e=e||J("body");var t=e.find("span.link");t.each(function(){if(this.dataset.type==LINK_TYPES.WEBURL||this.dataset.type==LINK_TYPES.MAILTO){var e=this.dataset.href,t=document.createElement("a");t.href=e,t.target="_blank",this.parentElement.insertBefore(t,this),t.appendChild(this)}else if(this.dataset.type==LINK_TYPES.BOOKMARK){var e=this.dataset.href,t=document.createElement("a");t.href="#"+e,this.parentElement.insertBefore(t,this),t.appendChild(this),J(t).css("text-decoration","none");var n=DocUtil.getFloatElementIdx(null,e);if(n!=-1){var i=DocUtil.getParaFormat(n).id,o=document.getElementById(i);if(void 0!=o){var r=o.parentElement;if(void 0!=r){var a=document.createElement("a");a.name=e;var s=r.nextSibling;if(void 0!=s){var l=s.nextSibling;s=void 0!=l?l:s}else s=r;r.parentElement.insertBefore(a,s)}}}}}),e.find(".endnotenum").addClass("zw-portion");var n=e.find("#editorpane");e.find("#ui-editor-outer-div").append(n),n.find("input[type=text]").removeAttr("placeholder"),e.find("#drawcontainer").remove();var i=e.find("td.zw-td");i.each(function(){var e=J(this);parseFloat(e.css("border-top-width"))||e.css("border-top","none"),parseFloat(e.css("border-bottom-width"))||e.css("border-bottom","none"),parseFloat(e.css("border-left-width"))||e.css("border-left","none"),parseFloat(e.css("border-right-width"))||e.css("border-right","none")});var o=e.find("table.zw-table");o.each(function(){var e=J(this);parseFloat(e.css("border-top-width"))||e.css("border-top","none"),parseFloat(e.css("border-bottom-width"))||e.css("border-bottom","none"),parseFloat(e.css("border-left-width"))||e.css("border-left","none"),parseFloat(e.css("border-right-width"))||e.css("border-right","none")});var r=e.find("span.zw-portion");r.each(function(){var e="letter-spacing";""!=this.style[e]&&(this.style[e]="normal")});var a=e.find(".zw-paragraph");a.each(function(){for(var e=this.getAttribute("class").split(" "),t=e.length,n=0;n<t;n++)if(e[n].indexOf("heading")!=-1){var i=e[n].replace("heading","");if(i>0&&i<=6){var o=document.createElement("h"+i);J(o).css({margin:"0px","line-height":"inherit"}).insertAfter(this),o.appendChild(this)}break}});for(var s=document.getElementsByTagName("path"),l=s.length-1;l>=0;l--){var d=s[l],c=d.getAttribute("stroke-opacity");null!=c&&c<.2&&d.parentNode.removeChild(d)}e.find("span.autopcnt,span.autopno,span.autopno_toc,span.autodocname,span.autoauthor,span.autodate,span.autoformula,span.endnote,span.footnote,span.autodocversion").each(function(){this.innerHTML=J(this).find("div.field_text_node").html()});var u=editor.doc.getBodyFormat(),p=u[ATTR_BODY.DS_BGC];if(p=Utils.getColorValFromRefString(p)){var h=e.find("#pdf-bg"),f="body { background-color:"+p+" !important";editor.browserInfo.is_ie?h[0].styleSheet.cssText=f:h.text(f)}},documentLoadingComplete:function(){var e=editor.isMailMerge;!e&&is_wkhtmltopdf_browser&&setTimeout(function(){exportDoc.postProcessingChangesForPDF(),window.status="PaginationCompleted"},500)}};var exportDoc=new exportDoc;PubSub.subscribe("Document/beforePDFStart",exportDoc.postProcessingChangesForPDF),PubSub.subscribe("Document/LoadingComplete",exportDoc.documentLoadingComplete),function(e){"use strict";var t=document.createElement("fakeelement").style,n={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},i={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"},o=function(e){for(var n in e)if(void 0!==t[n])return e[n];return""};e.MouseWheelEvent="onwheel"in e?"wheel":"onmousewheel"in e?"mousewheel":"DOMMouseScroll",e.TransitionEndEvent=o(n),e.AnimationEndEvent=o(i)}(window),HeaderFooter=function(){var e,t,n=function(e){a(e,"ui-hf-border-blue",".ui-hf-dbl-clk"),PubSub.subscribe("Document/HeaderMouseLeave",i)},i=function(e){s(e,"ui-hf-border-blue",".ui-hf-dbl-clk"),PubSub.unsubscribe("Document/HeaderMouseLeave",i)},o=function(e){a(e,"ui-hf-border-blue",".ui-hf-dbl-clk"),PubSub.subscribe("Document/FooterMouseLeave",r)},r=function(e){s(e,"ui-hf-border-blue",".ui-hf-dbl-clk"),PubSub.unsubscribe("Document/FooterMouseLeave",r)},a=function(n,i,o){var r=n.currentTarget||n.srcElement,a=J(r);clearTimeout(e),e=setTimeout(function(){var e=a.find(o);a.addClass(i),e.show(),t=setTimeout(function(){e.hide()},1500)},500)},s=function(n,i,o){var r=n.currentTarget||n.srcElement,a=J(r);clearTimeout(e),clearTimeout(t),a.find(o).hide(),a.removeClass(i)},l=function(){PubSub.subscribe("Document/HeaderMouseEnter",n),PubSub.subscribe("Document/FooterMouseEnter",o),PubSub.subscribe("Document/SectionChanged",c)},d=function(){PubSub.unsubscribe("Document/HeaderMouseEnter",n),PubSub.unsubscribe("Document/FooterMouseEnter",o),PubSub.unsubscribe("Document/HeaderMouseLeave",i),PubSub.unsubscribe("Document/FooterMouseLeave",r)},c=function(e){"hdrfooter"===e?d():editor.editable&&l()},u=function(e){e?l():d()};PubSub.subscribe("Document/EditPermissionChanged",u)}(),Paste=function(){"use strict";var e=CONST.PASTE_SOURCEFORMAT,t={HTML:null,TEXT:null},n=J("#pasteToolbar"),o=document.getElementById("pasteFrame"),r={},a={},s=o.contentWindow.document.body,l=function(t){e=t},d=function(e){s=e},c=function(e,n){E(),v(),n=n?S(n):"",t.TEXT=n;var i=document.getElementById("pasteFrame"),o=i.contentWindow.document.body;if(R(),e)i.contentWindow.document.open(),i.contentWindow.document.write(e),i.contentWindow.document.close(),Utils.setStylesInPasteFrame(),o=i.contentWindow.document.body,t.HTML=o.innerHTML,t.isUnformattedTextPaste=PasteUtil.isUnformattedTextPaste(o);else{for(var r=i.contentWindow.document.getElementsByTagName("head")[0];r.firstChild;)r.removeChild(r.firstChild);Utils.setStylesInPasteFrame(),i.contentWindow.document.body.innerHTML=n,t.isUnformattedTextPaste=!0}u(o),d(o),t.isTablePaste=PasteUtil.isTablePaste(o),t.isImagePaste=PasteUtil.isImagePaste(o),p()},u=function(e){for(var t=J(e).find("img"),n={},i=[],o=function(e){var t=J.Deferred(),i=e.getAttribute("id");return n[i]={},J(e).addClass("yet-to-load"),e.onload=function(e){var i=e.target,o=J(i).attr("id");n[o][ATTR_IMAGE.I_ORGINALWID]=n[o][ATTR_IMAGE.I_WID]=i.naturalWidth,n[o][ATTR_IMAGE.I_ORGINALHT]=n[o][ATTR_IMAGE.I_HT]=i.naturalHeight,HtmlStyleParser.getImageWidthHeightAccordingToPage(n[o]),t.resolve()},setTimeout(function(){"resolved"!=t.state()&&t.resolve()},1e4),t.promise()},r=0,a=t.length;r<a;r++){var s=t[r];s.setAttribute("id",Utils.randomString());var l,d,c=HtmlStyleParser.getComputedStylesFromBrowser(s,["width","height"]),l=parseInt(c.width),d=parseInt(c.height);l&&d||i.push(o(s))}i.length&&h(n,i)},p=function(){var e=s.childNodes.length,t=1==e&&Utils.nodeNameEquals(s.childNodes[0],"ol|ul");if(a={sameListPaste:!1,nonListPaste:!1,diffListPaste:!1,isSameDoc:!1,isListOnly:t,isListPaste:DocUtil.isList(O("para"))},a.isSameDoc=PasteUtil.isSameDocumentPaste(s),t){var n=s.childNodes[0].getAttribute("data-list-id");DocUtil.isList(O("para"))?n==O("para")[ATTR_PARAGRAPH.LS_DATA].id?a.sameListPaste=!0:a.diffListPaste=!0:a.nonListPaste=!0}},h=function(e,t){r.deferredArr=t,r.imgAttr=e},f=function(e,t){var n=function(e,t,n){var i=r[e]?r[e]:{};i.hasOwnProperty("ele")||(i.ele=t.cloneNode(!0)),n&&!i.hasOwnProperty("arr")&&(i.op=DocUtil.copyStyle(n)),r[e]=i};g()==CONST.PASTE_SOURCEFORMAT?(n(CONST.PASTE_SOURCEFORMAT,e,t),n(CONST.PASTE_DESTINATIONFORMAT,e,null)):g()==CONST.PASTE_DESTINATIONFORMAT?(n(CONST.PASTE_DESTINATIONFORMAT,e,t),n(CONST.PASTE_SOURCEFORMAT,e,null)):g()==CONST.PASTE_TEXTONLYFORMAT?n(CONST.PASTE_TEXTONLYFORMAT,e,t):g()==CONST.PASTE_ASNEWLIST?(n(CONST.PASTE_ASNEWLIST,e,t),n(CONST.PASTE_CONTINUELIST,e,null)):g()==CONST.PASTE_CONTINUELIST?(n(CONST.PASTE_CONTINUELIST,e,t),n(CONST.PASTE_ASNEWLIST,e,null)):g()==CONST.PASTE_MERGELIST?(n(CONST.PASTE_MERGELIST,e,t),n(CONST.PASTE_DONT_MERGELIST,e,null)):g()==CONST.PASTE_DONT_MERGELIST&&(n(CONST.PASTE_DONT_MERGELIST,e,t),n(CONST.PASTE_MERGELIST,e,null))},m=function(){return s},g=function(){return e},T=function(){return t},_=function(){return a},E=function(){r={}},v=function(){t={HTML:null,TEXT:null}},S=function(e){for(var t=e.split(/\n/g),n=document.createElement("div"),i=document.createDocumentFragment(),o=0,r=t.length;o<r;o++){var a=document.createElement("div");a.innerText=t[o],i.appendChild(a)}return n.appendChild(i),n.innerHTML},b=function(e){editor.doc.snapShotManager.clearRedo();var t=editor.doc.snapShotManager.getPrevious();if(Op.processMsg(t.ops),t){for(var n=0,i=t.cursorStartPos.length;n<i;n++)Op.fillCursorPos(t.cursorStartPos[n],t.cursorEndPos[n]);editor.lastOperation=COMMAND.CUSTOM_PASTE,Op.sendMsg()}D(e)},R=function(){var e=editor.doc.getSelection(),n=e.parents(NODE_TYPE.PARAGRAPH).attr();n.hasOwnProperty(ATTR_PARAGRAPH.PS_HD)||(n[ATTR_PARAGRAPH.PS_HD]=0);var i={computedTextFormat:e.getComputedTextFormat(),computedParaFormat:e.getParaFormat(),text:e.getTextFormat(),para:n};t.formats=i},O=function(e){return t.hasOwnProperty("formats")||R(),DocUtil.copyStyle(t.formats[e])},D=function(e){l(e);var n=document.getElementById("pasteFrame"),i=n.contentWindow.document.body;i.innerHTML=g()==CONST.PASTE_TEXTONLYFORMAT?t.TEXT:t.HTML,editor.doc.getSelection().isCollapsed()||editor.doc.getSelection().deleteSelectedContents(),C(m()),editor.lastOperation=COMMAND.ANY,A()},y=function(e,t){l(t),PasteUtil.isTablePaste(e)?PasteUtil.handleTablePaste(e):C(e),A()},A=function(){var e=editor.doc.getSelection(),t=e[0].toDocOpBuilder(),n=new XFormStack;n.pushOp(t),n.enableAutoUpdate();var i=new XFormMap;if(r.hasOwnProperty("deferredArr"))for(var o in r.imgAttr){var a=r.imgAttr[o],s=Utils.randomString(),l=[{r:a.idx},{as:{start:{type:NODE_TYPE.IMAGE},id:s}},{r:1},{as:{end:["type"],id:s}}],d=DocOpBuilder.build(l);i.putOp(d,o)}Op.sendMsg(),i.enableAutoUpdate(),r.deferredArr&&r.deferredArr.length&&J.when.apply(null,r.deferredArr).done(function(){var e=(i.map,[]);for(var t in r.imgAttr){var o=i.map[t],a=r.imgAttr[t],s={type:NODE_TYPE.IMAGE};s[ATTR_IMAGE.I_ORGINALHT]=s[ATTR_IMAGE.I_HT]=a[ATTR_IMAGE.I_HT],s[ATTR_IMAGE.I_ORGINALWID]=s[ATTR_IMAGE.I_WID]=a[ATTR_IMAGE.I_WID],4==o.docOps.length&&(o.docOps[1].styles.begin=s,o.docOps[3].styles.end=U.keys(s)),e.push(o)}var l=n.getOp(0),d=l.docOps[0].retain_count;n.flushOp(),Op.fillCursorPos(d,d),Op.msgBuffer=Op.msgBuffer.concat(e),Op.sendMsg(),i.flushOp()}),PubSub.publish("DocOperation/PasteCompleted")},C=function(e){var t,n,i=editor.doc.getSelection().getStart();J(o).css("width",editor.doc.getPaperWidth()),r.hasOwnProperty(g())?(t=r[g()].ele,n=r[g()].arr?r[g()].arr:I(t,i)):(g()==CONST.PASTE_TEXTONLYFORMAT?e.innerHTML=T().TEXT:e.innerHTML=T().HTML?T().HTML:T().TEXT,t=PastePreProcess.getProcessedHTML(e),n=I(t,i)),Op.processMsg(n),f(t,n)},I=function(e,t){var n=0,o=PasteUtil.isSameDocumentPaste(e),a=["span","br","hr","p"],s=function(e){var t=J(e).attr("data-list-info"),n=null;if(t){t=JSON.parse(t);var i={st:"listFormat",type:"body"},o=Utils.randomString();for(var r in t)i[r]=t[r];n=[{r:0},{as:{start:i,id:o}},{r:0},{as:{end:DocUtil.getKeys(i),id:o}}]}return n},l=function(e){var t=J(e).attr("data-para-info"),n=null;if(t){var i={type:"body"};i[ATTR_BODY.DS_STYLES]=JSON.parse(t),n=[{as:{start:i}},{r:0},{as:{end:DocUtil.getKeys(i)}}]}return n},d=function(e){var t=e.type,n=function(e){var t=e[ATTR_COMMON.CLS];t=t.replaceAll("EOP",""),t?e[ATTR_COMMON.CLS]=t:delete e[ATTR_COMMON.CLS]};if(t==NODE_TYPE.TEXT&&e.hasOwnProperty(ATTR_COMMON.CLS))n(e);else if(t==NODE_TYPE.PARAGRAPH&&e.hasOwnProperty(ATTR_PARAGRAPH.PS_TS)){var i=e[ATTR_PARAGRAPH.PS_TS];i.hasOwnProperty(ATTR_COMMON.CLS)&&n(i)}},c=function(e,t){var i,o=Utils.randomString();return t?(d(t),i=[{as:{start:t,id:o}},{is:e},{as:{end:DocUtil.getKeys(t),id:o}}]):i=[{is:e}],n+=e.length,i},u=function(e,t){var n=UNICODE.RANGE_START,o=UNICODE.RANGE_END,r=J(e),a=JSON.parse(r.attr("data-text-info")).class,s=a.indexOf("mergeField")!=-1?e.innerText:a.indexOf("autopcnt")!=-1?"##":"#",l={},d={},u={},p={},h=[],d=JSON.parse(e.hasAttribute("data-mergefield-info")?e.getAttribute("data-mergefield-info"):e.hasAttribute("data-note-info")?e.getAttribute("data-note-info"):e.getAttribute("data-autofield-info"));for(d.id="zw"+Utils.randomString(),"autofield"!=d.type&&"mergeField"!=d.type||(l={cls:a,type:NODE_TYPE.TEXT,fieldinfo:d.id},u={id:d.id,type:d.type},extend(p,l,t)),i=1;i<=3;i++){switch(i){case 1:op=c(n,d);break;case 2:op=c(s,p);break;case 3:op=c(o,u)}h=h.concat(op)}return h},p=function(e,t){for(var n in e)t.hasOwnProperty(n)&&delete t[n]},h=function(e){if(g()==CONST.PASTE_TEXTONLYFORMAT)return O("para");var t=JSON.parse(e.getAttribute("data-para-info")),n=O("para");return g()==CONST.PASTE_DESTINATIONFORMAT?(p(O("computedParaFormat"),t),t=Utils.mergeObjs([t,n])):g()==CONST.PASTE_CONTINUELIST&&DocUtil.isList(t)?t[ATTR_PARAGRAPH.LS_DATA][ATTR_COMMON.ID]=e.getAttribute("data-continue-list-id"):g()==CONST.PASTE_MERGELIST&&(t[ATTR_PARAGRAPH.LS_DATA]=n[ATTR_PARAGRAPH.LS_DATA],t[ATTR_PARAGRAPH.PS_ML]=n[ATTR_PARAGRAPH.PS_ML],t[ATTR_PARAGRAPH.PS_TI]=n[ATTR_PARAGRAPH.PS_TI],t[ATTR_PARAGRAPH.PS_TYPE]=n[ATTR_PARAGRAPH.PS_TYPE]),t},f=function(e){if(g()==CONST.PASTE_TEXTONLYFORMAT)return O("text");var t=JSON.parse(e.getAttribute("data-text-info"));return g()==CONST.PASTE_DESTINATIONFORMAT&&(p(O("computedTextFormat"),t),t=Utils.mergeObjs([t,O("text")])),t},m=function(e){var i=e.nodeName.toLowerCase(),a=null,s=J(e),l=s.attr("data-text-info")&&JSON.parse(s.attr("data-text-info")).class;switch(i){case"span":if(e.hasAttribute("data-mergefield-info")||e.hasAttribute("data-autofield-info")){var d=f(e);a=u(e,d)}else if(o&&e.hasAttribute("data-comment-info")){var p=e.getAttribute("data-range-char-type"),h=JSON.parse(e.getAttribute("data-comment-info")),m="start"==p?UNICODE.RANGE_START:UNICODE.RANGE_END;a=c(m,h)}else if(e.hasAttribute("data-text-info")){var d=f(e);l&&(d[ATTR_TEXT.CLS]=l),a=c(e.textContent,d)}break;case"br":var g={type:NODE_TYPE.BR},m=UNICODE.BR,a=c(m,g);break;case"a":var g=HtmlStyleParser.getLinkStyles(e),m=UNICODE.RANGE_START,a=c(m,g);break;case"table":var g=JSON.parse(e.getAttribute("data-table-info")),m=UNICODE.TABLE,a=c(m,g);break;case"th":case"td":var g=JSON.parse(e.getAttribute("data-cell-info")),m=UNICODE.CELL,a=c(m,g);break;case"tr":var g=JSON.parse(e.getAttribute("data-row-info")),m=UNICODE.ROW,a=c(m,g);break;case"hr":var g={type:NODE_TYPE.HR},m=UNICODE.HR,a=c(m,g);break;case"img":var g=JSON.parse(e.getAttribute("data-img-info")),m=UNICODE.IMAGE,a=c(m,g);if(J(e).hasClass("yet-to-load")){var T=J(e).attr("id");r.imgAttr[T].idx=t+n-1}break;case"iframe":var g=JSON.parse(e.getAttribute("data-iframe-info")),m=UNICODE.IMAGE,a=c(m,g)}return a},T=function(e){var t=e.nodeName.toLowerCase(),n=null;switch(t){case"p":var i=h(e),o=UNICODE.PARA;n=c(o,i);break;case"table":n=c(UNICODE.TABLEEND,null);break;case"a":var i={id:e.getAttribute("id"),type:NODE_TYPE.LINK},o=UNICODE.RANGE_END,n=c(o,i)}return n},_=function(e){var t=a.join("|")+"|body";return Utils.nodeNameEquals(e,t)},E=function(e){var t=[];if(g()==CONST.PASTE_TEXTONLYFORMAT&&!_(e))return t;var n=m(e);n&&(t=t.concat(n));for(var i=e.childNodes,o=i.length,r=0;r<o;r++)t=t.concat(E(i[r],S));var a=T(e);return a&&(t=t.concat(a)),t},v=s(e),S=[];v&&(S=S.concat(v));var b=l(e);return b&&(S=S.concat(b)),S=S.concat([{r:t}]),S=S.concat(E(e,S))};return{handlePasteOptions:b,getOp:I,init:y,getPasteDiv:m,setPasteOpn:l,getPasteOpn:g,getListPasteInfo:_,pasteToolbar:n,setPasteInfo:c,getPasteInfo:T,getHTMLFromTextString:S}}(),CopyUtil=function(){"use strict";var e=function(e){var t={htmlCont:e};PubSub.publish("DocOperation/AfterGettingSelectedHTML",t),PasteUtil.positionPasteDiv(t.htmlCont),PasteUtil.focusPasteDiv()},t=function(){var e=editor.doc.getSelection(),t="";return U.each(e,function(e){t+=HTMLUtil.getHTML(e)}),e.length>1&&Utils.addToStatistics("copy_ON_MUL_SEL"),t},n=function(){editor.doc.execCmd("copy"),document.execCommand("copy",!1,null)},i=function(){editor.doc.execCmd("cut"),document.execCommand("copy",!1,null)},o=function(){var e;e=InsertShape.selectedShape()?InsertShape.getCopyHTML():t(),CopyUtil.copyToClipboard(e)};return{copyToClipboard:e,triggerCopyEvent:n,triggerCutEvent:i,onCopy:o}}(),writerConfig.prototype={init:function(){UIUtils.initDialogBindEvents()}},writerConfig=new writerConfig,UIUtils.freezeState=!1,UIUtils.isShowChangesVisible=!1,UIUtils.writerstatushtml="",UIUtils.forumURL="",UIUtils.blogURL="",UIUtils.reportabuseURL="",UIUtils.writerLandingPageURL="",UIUtils.faqURL="",UIUtils.howtoURL="",UIUtils.whatsNewURL="",UIUtils.fbURL="",UIUtils.twitterURL="",UIUtils.linkedinURL="",UIUtils.publicTemplatesURL="",UIUtils.iosAppURL="",UIUtils.macAppURL="",UIUtils.androidAppURL="",UIUtils.chromeWebStoreURL="",UIUtils.aboutofflineURL="",UIUtils.signInURL="",UIUtils.oneZohoURL="",UIUtils.developerApiURL="",UIUtils.docsWindow="",UIUtils.zohoURL="",UIUtils.iamServerURL="",UIUtils.logoutPageRedirectURL="",UIUtils.initDOMElements=function(){UIUtils.JprogressDiv=J("#progress-outer-div"),UIUtils.jToolbarComp=J("#panel-container, #paraPropMenu,#smartToolbar"),UIUtils.uiCopyButton=UIUtils.jToolbarComp.find("#fmt-lpnl-copy"),UIUtils.uiShapePortionStyles=UIUtils.jToolbarComp.find("#shapePortionstyles,#shapeParaAlign"),UIUtils.uiNotConnectorMenus=J("#shapenofill,#fillimage,#shadow,#reflection,#duplicateshapebtn,#vertiTextAlign,#shapeWrapType,#textFormattingContainer,#shapefillcolor"),UIUtils.uiNotGroupShapeMenus=J("#textFormattingContainer"),UIUtils.uiNotChildShapeMenus=J("#shape-arrange-menus"),UIUtils.uiPortionStyles=UIUtils.jToolbarComp.find("#fmt-lnpl-portionstyles,#portionstylessmarttoolbar"),UIUtils.uiSmartToolbar=J("#smartPortionStyles"),UIUtils.uiTextAlignment=UIUtils.jToolbarComp.find("#fmt-lpnl-textalign, #pcm-text-alignment, #fmt-lpnl-sub-textalign"),UIUtils.uiParaDir=UIUtils.jToolbarComp.find("#fmt-lpnl-sub-dircontainer"),UIUtils.uiBulletsAndIndent=UIUtils.jToolbarComp.find("#bulletsAndIndent"),UIUtils.defaultFontSize=J("#fmt-lpnl-fontsize,#smart_fontSize"),UIUtils.defaultFontFamily=J("#fmt-lpnl-fontfamily,#smart_fontFamily"),UIUtils.uiFontStyle=UIUtils.jToolbarComp.find("#fmt-lpnl-headingmenubtn,#fmt-lpnl-sub-headingmenubtn,#smart-headingmenubtn"),UIUtils.uiSaveButton=UIUtils.jToolbarComp.find("#undoRedoContainer"),UIUtils.saveStatusLink=J("#topband-savestatus-cont"),UIUtils.saveStatusMsg=UIUtils.saveStatusLink.find("#topband-savestatus-msg"),UIUtils.JdocumentMenu=J("#documentmenu"),UIUtils.JscrollbarPageInfoFlag=J("#page-info-flag-container"),UIUtils.JnotifyMessageDiv=J("#notifyMessage"),UIUtils.bottomBar=J("#bottombar"),UIUtils.JredactBtn=J("#review-tb-redact"),UIUtils.JunredactBtn=J("#review-tb-unredact"),J("#autoTxtDiv").niceScroll({cursorborder:"",cursorcolor:"#bdbdbd",boxzoom:!1,horizrailenabled:!1}),J("#ytvidscontainer,.ui-video-listcont").niceScroll({cursorborder:"",cursorcolor:"#bdbdbd",boxzoom:!1}),J("#templateContainer").niceScroll({cursorborder:"",cursorcolor:"#bdbdbd",boxzoom:!1}),J("#filemnu_docOwnerName").html(docProps.info.CREATOR_HTML),J("#filemnu_userImg").attr("src",contactServer+"/file?t=user&ID="+docProps.info.CREATOR_ZUID+"&fs=thumb"),InsertShape.toolsToBeEnableDisable=[J("#inserttab"),J("#fmt-lpnl-bgcolor"),J("#customStyles"),J("#bulletsAndIndent"),J("#borderandspacing"),J("#fmt-lpnl-grp-paint"),J("#fmt-lpnl-textalign"),J("#changeCaseButton"),J("#LEFT"),J("#CENTER"),J("#RIGHT"),J("#JUSTIFY"),J("#fmt-lpnl-list-bullet"),J("#fmt-lpnl-painter"),J("#removeformat"),J("#supersubscript"),J("#strikethrough"),J("#direction"),J("#insert_toolbar"),J("#cutCopyPasteContainer"),J("#fmt-lpnl-headingmenubtn"),J("#rt_btn_add_comment"),J("#highlighter")]},UIUtils.setProperties=function(e){UIUtils.forumURL=e.urls.forumURL,UIUtils.blogURL=e.urls.blogURL,UIUtils.reportabuseURL=e.urls.zohoURL+"/abuse",UIUtils.writerLandingPageURL=e.urls.writerLandingPageURL,UIUtils.faqURL=e.urls.zohoURL+"/docs/faq/online-editors.html",UIUtils.howtoURL=e.urls.helpPageURL+"creating-and-editing-documents.html",UIUtils.fbURL=e.fbURL,UIUtils.twitterURL=e.twitterURL,UIUtils.linkedinURL=e.linkedinURL,UIUtils.publicTemplatesURL=e.publicTemplatesURL,UIUtils.contactsURL=e.contactsURL,UIUtils.iosAppURL=e.urls.iosAppURL,UIUtils.macAppURL=e.urls.macAppURL,UIUtils.androidAppURL=e.urls.androidAppURL,UIUtils.chromeWebStoreURL=e.urls.chromeWebStoreURL,UIUtils.aboutofflineURL=e.urls.aboutofflineURL,UIUtils.whatsNewURL=e.urls.zohoURL+"/docs/whats-new-in-zoho-writer.html",UIUtils.signInURL=e.urls.signInURL,UIUtils.oneZohoURL=e.urls.oneZohoURL,UIUtils.developerApiURL=e.urls.zohoURL+"/docs/help/office-apis.html",UIUtils.zohoURL=e.urls.zohoURL,UIUtils.iamServerURL=e.urls.iamServerURL,UIUtils.logoutPageRedirectURL=e.urls.logoutPageRedirectURL,e.isRemote?(editor.setEditorType("REMOTE"),RemoteEditor.quitWithoutSaving=e.quitWithoutSaving,RemoteEditor.userStatusId=e.userStatusId,RemoteEditor.searchText=e.searchText,RemoteEditor.featuresToRemoved=e.featuresToRemoved,RemoteEditor.plainView=e.plainView):"TRUE"===e.anyOneWithLink&&editor.setEditorType("ANYONEWITHLINK"),e.r_encdocid&&(RemoteEditor.r_encdocid=e.r_encdocid)},UIUtils.onEditorLoad=function(){var e=window.location.href;if(e.indexOf("upgrade")!=-1){var t=J("#mainOuterDiv").position().top;J("div#ng-preview-doc").height(t).show()}editor.browserInfo.is_chrome?(J("#filemenu-print,#viewtoolbar_printpreview,#complete-tb-print").remove(),J("#view-lpnl-printpreview").remove(),J("#filemenu-print-chrome,#complete-tb-print-chrome").show()):editor.browserInfo.is_edge&&J("#preview-toolbar-print").remove()},UIUtils.initUserInfoDialog=function(e){J("#userinfomenu_userName").text(e.fullName),J("#userinfomenu_email").text(e.email),J("#userinfomenu_user_zuid").text(e.zuid),J("#userInfo_userImage,#topband-userimg").attr("src",contactServer+"/file?t=user&ID="+e.zuid+"&fs=thumb"),J("#userinfomenu-accounts-url").attr("href",UIUtils.iamServerURL),J("#userinfomenu-help-url").attr("href",UIUtils.howtoURL),J("#userinfomenu-logout").attr("href",UIUtils.iamServerURL+"/logout?serviceurl="+UIUtils.logoutPageRedirectURL),J("#userinfomenu-myapps").attr("href",UIUtils.oneZohoURL),editor.zoid!=-1&&J("#userinfomenu").removeClass("ui-login-personal"),J("#userinfomenu").bind("click",function(e){J("#topband-default-rightoptions").find("button#topband-userinfo").removeClass("ui-state-highlight"),"a"===e.target.tagName.toLowerCase()&&J.ZContextMenu.hideMenu()})},UIUtils.updateZohoLogoLink=function(){J("#topband-zohologo").attr("href",editorProps.urls.writerLandingPageURL)},UIUtils.postProcessingForUpgrade=function(){var e=J("#mainOuterDiv").position().top;J("div#ng-preview-doc").height(e).show(),editor.doc.getDocInfo().UpgradeTemplateToWriter3&&(J("#upgrade_preview_msg").text(J.i18n("common","UPGRADE_TEMPLATE_PREVIEW_MSG")),J("#BackToOldWriterlink").remove()),J("#quickFixedView,#quickPageView,#quickWebView,#quickFullScreen,#collaboratorPanelDiv").prop("disable",!0),UIUtils.bottomBar.hide()},UIUtils.updateSaveButton=function(e){J("#topband-save").zbutton(e)},UIUtils.showMessagePopup=function(e,t,n,i,o,r,a,s,l){var d;o&&r?d=CONST.MSG_TYPE_RELOADCANCEL:o&&!r?d=CONST.MSG_TYPE_RELOAD:!o&&r?d=CONST.MSG_TYPE_CONFIRM:o||r||(d=CONST.MSG_TYPE_ALERT);var c=null,u=function(e){switch(e){case 1:i&&i();break;case 2:s&&s()}};MsgDialog.showMessage(d,n,t,e,c,u)},UIUtils.showSaveStatus=function(e,t,n,i){try{if(clearInterval(window.saveStatusTimer),!e)return void UIUtils.saveStatusMsg.text(t);i||(i=(new Date).getTime());var o=function(e,t){var n,i=new Date(t),o=new Date,r=o.getMonth()-i.getMonth()+12*(o.getFullYear()-i.getFullYear());n=i.getFullYear()!=o.getFullYear()||r>2?"on "+moment(i).format("MMMM Do YYYY"):moment(i).fromNow();var a;if(editor.zuid==e)a=J.i18n("common","SAVE_STATUS",[n]),UIUtils.isShowChangesVisible&&ZWCollaboration.contentEdited&&UIUtils.hideViewChangesLink();else{var s=editor.doc.getUserData()[e].fname;a=J.i18n("common","SAVE_STATUS_COLLABORATOR",[s,n])}UIUtils.saveStatusMsg.text(a)};o(n,i),window.saveStatusTimer=setInterval(o,6e4,n,i)}catch(e){}},UIUtils.showViewChangesLink=function(){Z("sinceLastVisitLink").on("animationend",function(e){}).addClass("bInOut-animated bounceIn-anim").show(),Z("topband-savestatus").hide(),UIUtils.isShowChangesVisible=!0},UIUtils.hideViewChangesLink=function(){Z("sinceLastVisitLink").hide(),UIUtils.isShowChangesVisible=!1,Z("topband-savestatus").fadeIn(100)},UIUtils.FreezeEditor=function(e,t){UIUtils.freezeState=!0,UIUtils.hideWrappers(!0),UIUtils.showMessage(e,t),editor.setEditable(!1),Utils.log("FREEZE EDITOR - CALLED"),J("#topband-savestatus-msg").html(""),J("#topband-savestatus").prop("disable",!0),J(".js-sel-undo,js-sel-redo").disable(),Z("fmt-lpnl-undo").disable(),Z("fmt-lpnl-redo").disable(),J("#cutCopyPasteContainer").zbutton("disable","#fmt-lpnl-cut,#fmt-lpnl-copy,#fmt-lpnl-paste");try{var n=J("#bottombar");J("#topband-hamburger").prop("disabled",!0),J("#topband").find("#topband-review-noti,#topband-settings,#topband-shared-label,#topband-spotlightsearch").disable(),J("#topband").find("#topband-share-owner").hide(),n.find("#bbar-shortcutdlg").disable(),n.find("#bbar-spellcheck").hide(),J("#pausecollab").attr("disabled",!0),J("#review-tb-pausecollab").addClass("ui-state-disabled"),J("#review-tb").find("button").disable(),J("#complete-tb").find("button").disable(),UIUtils.toggleElemState(["topband-compose","topband-collaborate","topband-complete"],"disable"),TrackChangeUI.disableTCSwitch()}catch(e){}ReviewUtil.setFreeze(!0)},UIUtils.UnfreezeEditor=function(){if(UIUtils.freezeState){editor.setEditable(!0),UIUtils.preProcessForDialogClose(),UIUtils.freezeState=!1,Utils.log("UNFREEZE EDITOR - CALLED"),J("#topband-savestatus").prop("enable",!0),J("#editorpane,.ui-qat-container").css({opacity:"1.0"}),J(".js-sel-undo,js-sel-redo").enable(),Z("fmt-lpnl-undo").enable(),Z("fmt-lpnl-redo").enable(),J("#cutCopyPasteContainer").zbutton("enable","#fmt-lpnl-cut,#fmt-lpnl-copy,#fmt-lpnl-paste");try{UIUtils.hideMessage(),ReviewUtil.setFreeze(!1),J("#topband-hamburger").prop("disabled",!1),J("#topband").find("#topband-review-noti,#topband-settings,#topband-shared-label,#topband-spotlightsearch").enable(),J("#topband").find("#topband-share-owner").show(),J("#bottombar").find("button").enable(),J("#bbar-spellcheck").show(),J("#review-tb").find("button").enable(),J("#complete-tb").find("button").enable(),J("#review-tb-pausecollab").removeClass("ui-state-disabled"),UIUtils.toggleElemState(["topband-compose","topband-collaborate","topband-complete"],"enable"),UIUtils.hideWrappers(!1),TrackChangeUI.drawTCStatus()}catch(e){}editor.isEditable&&editor.doc.getSelection().select();var e="contentpane";J(editor.clientActiveSection).hasClass("zw-contentpane")||(e="hdrfooter"),UIUtils.handleToggleSection(e)}},UIUtils.showLoadingMsg=function(e,t){var n=J("#loadingmsg");n.text(e).show(),t&&setTimeout(UIUtils.hideLoadingMsg,t)},UIUtils.showMessage=function(e,t,n,i,o,r){var a=J("#topband-notification"),s=J("#banner-div");a.find(".ui-znotifier-message").html(t),a.find("#notification-close").hide();var l="info"===e?"ui-wnotify-success":"ui-wnotify-fail";a.find(".ui-topbanner-notification-cont").removeClass("ui-wnotify-success ui-wnotify-fail").addClass(l),s.show(),a.show(),a.find("#notification-close").toggle(!!n),a.find("#notification-reload").toggle(!!r),o&&setTimeout(function(){a.hide(),s.hide()},o)},UIUtils.hideMessage=function(){J("#topband-notification").hide(),J("#banner-div").hide()},UIUtils.showNetworkError=function(e){Utils.log("SHOW NETWORKERROR CALLED"),clearTimeout(ZWCollaboration.slowRespTimer),ZWCollaboration.slowRespTimer=void 0,ZWOffline.isOfflineSetupDone&&"TEMPLATE_USER"!==editor.doc.getRole()?(ZWOffline.isSyncing?ZWOffline.isSyncing=!1:ZWOffline.updateDocFromEditorToDB(ZWOffline.RID,ZWOffline.docObject),ZWOffline.disableOnlineFeatures(),editor.setEditable(!0),ZWOffline.storeOfflineOps()):UIUtils.showFreezeMessage(!0,"warning",e?e:J.i18n("common","UNABLE_TO_REACH")),Utils.retryNetwork()},UIUtils.toggleTableTabAndButtons=function(e){if(e==editor.zuid){var t=editor.doc.getSelection(),n=Z("split").button(),i=Z("ins-lpnl-link").button(),o=Z("ins-lpnl-bookmark").button(),r=Z("merge").button(),a=Z("smart_cell_merge").button();if(t.isTableSelected())i.button("disable"),o.button("disable"),n.button("disable"),r.button("enable"),a.button("enable");else{var s=t.hasDOMParent(NODE_TYPE.TABLE);if(s){UIUtils.initComponent("subpanel-table"),n.button("enable"),r.button("disable"),a.button("disable");var l=editor.doc.getCursorPortionNode(editor.uuid,"start"),d=J(l).parents("td").eq(0),c=d.attr("colspan"),u=d.attr("rowspan");(c||u)&&c&&c%2==1&&1!=c&&n.button("disable")}try{i.button("enable"),J(editor.clientActiveSection).is("div.zw-contentpane")&&o.button("enable")}catch(e){}}}},UIUtils.openShareDialog=function(e){function t(){if("WRITER_GDRIVE"===editor.doc.docInfo.SERVICE_NAME)gdriveShare.openDialog();else{var e=!(!editor.doc.getRole()||"COOWNER"!==editor.doc.getRole());FILEDIALOG.showShareForm("zw",Utils.getDocumentId(),e),Utils.addToStatistics("Share")}}return editor.doc.getDocInfo().DOCUMENT_NAME!=J.i18n("writer.common.UNTITLED_DOCUMENT")||e?void t():(RenameDialog.open(t),!1)},UIUtils.updateViewStatus=function(e){e=e||EditorView.getView();var t=e.replace(/\s/,"");t=t.toLowerCase(),UIUtils.initComponent("menuView"),J("#view-lpnl-pgview-grp-"+t).zbutton("check"),Z("bbar-editorview").zcombo("setValue",t),JpageInfoContainer=J("#pageInfoFlagContainer"),"Web View"!==e&&editor.isEditable()?JpageInfoContainer.show():JpageInfoContainer.hide();var n="Page View"==e?J.i18n("common","DOUBLE_CLICK_TO_HIDE_PAGE_BREAK"):J.i18n("common","DOUBLE_CLICK_TO_SHOW_PAGE_BREAK");J(".ui-page-collapse-div").attr("title",n).children().removeClass("ui-icon-page-collapse-sm").removeClass("ui-icon-page-expand-sm").attr("class",("Fixed View"==e?"ui-icon-page-expand-sm":"ui-icon-page-collapse-sm")+" js-collpse-span js-collpse-span ui-button-icon-primary ui-icon ui-writer-menu-icons ui-icon-sprit-image-blue")},UIUtils.updateToolbarForTemplateDoc=function(){J("#commonicondiv, #components, #file, #topband-savestatus, #quicksearchcontainer").hide();var e=J("#toolbarContainer").addClass("ui-history-printview-height");J("#templateComponent").appendTo(e[0]).css("display","block"),J("#mailMerge_toolbarSet,#usersettingbutton,#filemenu-saveastemplate,#ztb-settings").remove(),J(".fixedwidth").css("margin-top","20px"),J(".comnt-container").hide(),J(".ui-toplinks-div a").css("border-left","0px solid")};var reload=function(){document.location.reload()};UIUtils.handleDocumentCheckOut=function(e,t,n,i){if(editor.zuid==e){"WORKSPACE_CRMLIB_EDITOR"!==editor.doc.getRole()&&J("#pausecollab").prop("checked",!1);for(var o in editor.doc.domCursor)o!==editor.uuid&&(DomUtil.removeCursorNode(o,"start"),DomUtil.removeCursorNode(o,"end"));editor.doc.setDocInfo({CHECKEDOUT:!0}),editor.doc.setDocInfo({CHECKEDOUTBY_NAME:editor.loginName}),editor.doc.setDocInfo({CHECKEDOUTBY_ZUID:editor.zuid}),UIUtils.showDocStatusIcon()}else{var r=editor.doc.getRole();if("SHAREDREAD"==r)return;var a,s,l=editorProps.deployment.zohowriter;if(i?(a=J.i18n("trackchange","LOCK_FOR_REVIEW",[t]),s=l):n?(a=J.i18n("common","CHECKEDOUTBY",[t]),s=J.i18n("common","CHECKEDOUTBY_TITLE_MSG")):(a=J.i18n("common","CHECKEDOUTBY_LOCKED",[t]),s=l),n)PubSub.publish("Document/SaveStatus",!1,void 0),UIUtils.showMessagePopup(a,s,"info",reload,!1,!1,void 0,reload);else{var d=J("#readonly_add_comment"),c=J("#historyprint");d.prop("disable",!0),c.prop("disable",!0),J(".ui-dialog-content").dialog(),J(".ui-dialog-content").dialog("close"),UIUtils.showFreezeMessage(!0,"info",a),J("#file").prop("enable",!0),J("#quickFullScreen,#quickWebView,#quickPageView,#quickFixedView,#filemenu-saveas,#filemenu-export,#filemenu-shareinvite,#filemenu-marknewversion,#filemenu-viewhistory,#filemenu-pagelayout,#filemenu-uploadfile,#filemenu-publish").each(function(){J(this).disable()}),J(".comnt-container").hide(),DomUtil.removeCursorNode(editor.uuid),J("#topband-savestatus").remove(),UIUtils.disableDocumentShortcuts(),J("#topband-savetofolder").zfilefield("disable")}}},UIUtils.handleDocumentCheckIn=function(e,t,n){if(editor.zuid==e)J("#pausecollab").prop("checked",!0),editor.doc.setDocInfo({CHECKEDOUT:""}),editor.doc.setDocInfo({CHECKEDOUTBY_NAME:""}),editor.doc.setDocInfo({CHECKEDOUTBY_ZUID:""}),J("#topband-docstatus").find("#checkout-status").remove();else{var i=editor.doc.getRole();if("SHAREDREAD"==i)return;var o=J.i18n("common","CHECKINBY",[t]);UIUtils.showMessagePopup(o,J.i18n("common","CHECKINBY_TITLE_MSG"),"success",reload,!1,!1,void 0,reload)}},UIUtils.showCustomBanner=function(e){J("#customBannerText").text(e).css("color","#7F7F7F"),J("#customBanner").slideDown("slow")},UIUtils.showZohoError=function(e,t,n,i){editor.doc.contStr.length<100&&Utils.log("Client Content ::: "+FontUtils.contentBetween(0,5)),n||(n="0");try{if(editor.browserInfo.is_chrome)if(U){var o=Object.keys(U);o.contains("each")||Utils.log("UNDER SCORE WAS OVERWRITE :: "+JSON.stringify(o))}else Utils.log("UNDER SCORE IS NULL ::: "+U)}catch(e){}var r=Utils.shrinkOperationSequence(ZWCollaboration.operationSequence).join(",");if("628575768"!=editor.zuid&&Utils.sendErrorDetails(n+"<ZWERROR>"+editor.doc.getDocInfo().VERSION+"."+editor.doc.getDocInfo().REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No ="+n+" DOC len ="+editor.doc.getDocumentLength()+" Cur St ="+editor.doc.getSelection().getStart()+" Cur end="+editor.doc.getSelection().getEnd()+" Pen [0]="+(ZWCollaboration.msgQueue.getAckPendingEdit()?ZWCollaboration.msgQueue.getAckPendingEdit().toString():"")+"[1]="+(ZWCollaboration.msgQueue.getPendingToPushEdit()?ZWCollaboration.msgQueue.getPendingToPushEdit().toString():"")+" FULL DOC OP IDS :: "+ZWCollaboration.docOpIds+" buildLabel::: "+buildLabel+"\nOperation Sequence: \n"+r+"\nError Log End \n<ZWERROR>"+ZWCollaboration.mailInfo),ZWCollaboration.stopUpdates=!0,editor.setEditable(!1),!i){var a=function(){editor.setEditable(!0),Utils.reloadDocumentContent()};UIUtils.showMessagePopup(J.i18n("error",t),J.i18n("error",e),"error",a,!0,!1)}},UIUtils.hideLoadingMsg=function(){J("#loadingmsg").hide()},PubSub.subscribe("DocOperation/PasteCompleted",UIUtils.hideLoadingMsg),UIUtils.loadReadOnlyDoc=function(){var e=editor.doc.getRole();editor.isNotSupportedBrowser&&(J("#tableToolBar,#backbutton,#topband-savestatus-msg,#topband-savestatus").hide(),J("#toolbarContainer").hide()),J(".ui-toplinks-div a").css("border-left","0px solid"),J(".fixedwidth").css("margin-top","20px"),editor.setEditable(!1),UIUtils.disableDocumentShortcuts(),Utils.setEditorHht(),editor.isEditable()||"SHAREDREADCOMMENT"!=e&&"ANYONELINK_SHAREDREADCOMMENT"!=e&&("REMOTEVIEW"!=e||"true"!=RemoteEditor.featuresToRemoved.readmodeprint)||(J("#historycomponent").appendTo(J("#readonlyouter")).css({display:"block",height:"33px"}),"SHAREDREADCOMMENT"!=e&&"ANYONELINK_SHAREDREADCOMMENT"!=e||(editor.setEditable(!0),J("#readonly_add_comment").show()))},UIUtils.toggleButton=function(e,t,n){J("#"+e).zbutton(n,"#"+t)},UIUtils.toggleButtonStatus=function(e,t,n){J("#"+e).zbutton(n,"#"+t)},UIUtils.enableRenameButton=function(e){J("#"+e).removeClass("ui-state-disabled").addClass("ui-state-enabled")},UIUtils.closeDialog=function(e){J.dialogutil.close(e)},UIUtils.openDialog=function(e){J.dialogutil.open(e,void 0)},UIUtils.updateLockIconAndText=function(e){var t=J("#share_btn_lock"),n=J("#menuitem_share_btn_lock");e?(editor.doc.getDocInfo().DOCUMENT_LOCKED=!0,t.button("option","label",J.i18n("common","UNLOCK")),t.button("option","icons",{primary:"zicon zicon-unlock"}),n.length?(n.find(".ui-zmenu-text").text(J.i18n("common","UNLOCK")),J("#sharetabmenu").zmenu("changeIcon","menuitem_share_btn_lock","zicon zicon-unlock")):(t.metadata().label=J.i18n("common","UNLOCK"),t.metadata().icons={primary:"zicon zicon-unlock"})):(editor.doc.getDocInfo().DOCUMENT_LOCKED=!1,t.button("option","label",J.i18n("common","LOCK")),t.button("option","icons",{primary:"zicon zicon-lock"}),n.length?(n.find(".ui-zmenu-text").text(J.i18n("common","LOCK")),J("#sharetabmenu").zmenu("changeIcon","menuitem_share_btn_lock","zicon zicon-lock")):(t.metadata().label=J.i18n("common","LOCK"),t.metadata().icons={primary:"zicon zicon-lock"}))},UIUtils.enterKey=function(e,t){e.unbind("keydown"),e.bind("keydown",function(e){13===e.keyCode&&t&&t()})},UIUtils.hideUpdateBanner=function(){if(J("#annBanner").hide(),Utils.setEditorHht(),"undefined"!=typeof w_usersettings){var e="2.2";e=parseFloat(e),isNaN(e)&&(e=.9),e+=.1;var t={};t[ATTR_BODY.DS_BANNERVER]=e.toFixed(1),Settings.updateUserSettings(t),Utils.setCsrfParam(t),J.post(Utils.getNiceUrlPrefix("user/settings/updatebannerversion"),t)}},UIUtils.handleReviewTabForNewDoc=function(){J("#review-tb-follow,#review-tb-lock,#review-tb-showhistory").each(function(){J(this).disable()})},UIUtils.handleDistributeTabForNewDoc=function(){J("#complete-tb-mailmerge,#complete-tb-posttoblog,#complete-tb-publish,#complete-tb-email,#complete-tb-digisign,#complete-tb-download,#complete-tb-sendforapproval,#complete-tb-setreminder,#complete-tb-markasfinal,#complete-tb-print-chrome,#complete-tb-print").each(function(){J(this).disable()})},UIUtils.handleOrgPolicyUIChanges=function(){var e=editor.getOrgPolicy();if(!U.isEmpty(e)&&"PUBLIC"!==editor.doc.getRole()){var t=Z("popup-filemenu"),n=J.i18n("writer.common.FEATURE_DIABLED_BY_ORG_ADMIN_TOOLTIP"),i=LayoutManager.getCurrentLayout()==LAYOUTS.COMPLETE;if(!e.export_document){var o=J("#complete-tb-download"),r=J("#complete-tb-email");J("#filemenu-shareinvite-menu").zmenu("disableMenuItem","#filemenu-emailout"),t.zmenu("disableMenuItems",["filemenu-export","filemenu-addtocloud"]),o.length&&(i?o.zbutton("disable"):o.attr("disabled",!0),o.attr("title",n)),r.length&&(i?r.zbutton("disable"):r.attr("disabled",!0),r.attr("title",n))}if(!e.publish_document&&!e.publish_policy){var a=J("#complete-tb-publish");t.zmenu("disableMenuItem","#filemenu-publish"),a.length&&(i?a.zbutton("disable"):a.attr("disabled",!0),a.attr("title",n))}}},UIUtils.handleFirstCharSave=function(){J("#filemenu-saveas,#filemenu-saveastemplate,#filemenu-export,#filemenu-addtocloud,#filemenu-shareinvite,#filemenu-print,#filemenu-print-chrome,#topband-setupoffline,#filemenu-marknewversion,#filemenu-viewhistory,#filemenu-publish").each(function(){J(this).enable()}),J("#tools-lpnl-mm,#undo,#redo,#tools-lpnl-digi,#tools-lpnl-posttoblog,#ins-lpnl-version,#ins-version").each(function(){J(this).enable()}),J("#review-tb-follow,#review-tb-lock,#review-tb-showhistory,#complete-tb-mailmerge,#complete-tb-posttoblog,#complete-tb-publish,#complete-tb-email,#complete-tb-digisign,#complete-tb-download,#complete-tb-sendforapproval,#complete-tb-setreminder,#complete-tb-markasfinal,#complete-tb-print-chrome,#complete-tb-print").each(function(){J(this).enable()}),UIUtils.handleOrgPolicyUIChanges()},UIUtils.isDialogOpened=function(e){return J.dialogutil.isDialogOpened(e)},UIUtils.handleToggleSection=function(e){try{"hdrfooter"==e?(editor.jeditorPane.find("div.header_flag,div.footer_flag").show(),Z("microtool-img").enable(),Z("microtool-tbl").enable(),Z("microtool-code").enable(),Z("inlineinsert-img").enable(),Z("inlineinsert-tbl").enable(),Z("smart_cell_merge").enable(),Z("smart-table_cellalignment").enable(),UIUtils.jToolbarComp.find("#ins-lpnl-img,#ins-lpnl-table,#ins-lpnl-shapes,#ins-lpnl-txtbox,#ins-lpnl-splchars,#ins-lpnl-equation,#ins-lpnl-object,#ins-lpnl-embed,#ins-lpnl-codeblock").button("enable"),UIUtils.jToolbarComp.find("#comments,#ins-lpnl-break-menu,#rt_btn_add_comment,#ins-lpnl-bookmark,#ins-lpnl-toc,#ins-lpnl-endnote,#ins-lpnl-footnote,#readonly_add_comment,#mailmerge-btn-insmergefld,#mailmerge-btn-insmergefldDropDown,#mailmerge-btn-finishmerge,#ins-lpnl-cmnt,#ins-lpnl-blnkpage,#smart-addcomment").button("disable"),Z("microtool-bookmark").disable(),Z("microtool-cmt").disable(),Z("inlineinsert-bookmark").disable(),Z("inlineinsert-cmt").disable(),Z("review-tb-showcomment").disable(),J("#mailmergemenu").zmenu("disableMenuItems",["mailmerge-btn-insmergefld","mailmerge-btn-finishmerge"]),J("#ins-lpnl-break").zmenu("disableMenuItems",["ins-lpnl-page-break","ins-lpnl-col-break"])):"contentpane"==e?(editor.jeditorPane.find("div.header_flag,div.footer_flag").hide(),EditorView.isWebView()||UIUtils.jToolbarComp.find("#ins-lpnl-toc").button("enable"),UIUtils.jToolbarComp.find("#ins-lpnl-img,#ins-lpnl-table,#ins-lpnl-shapes,#ins-lpnl-txtbox,#ins-lpnl-splchars,#ins-lpnl-equation,#ins-lpnl-object,#comments,#ins-lpnl-break-menu,#rt_btn_add_comment,#ins-lpnl-bookmark,#ins-lpnl-toc,#ins-lpnl-endnote,#ins-lpnl-footnote,#readonly_add_comment,#mailmerge-btn-insmergefld,#mailmerge-btn-insmergefldDropDown,#mailmerge-btn-finishmerge,#ins-lpnl-cmnt,#ins-lpnl-blnkpage,#smart-addcomment,#ins-lpnl-embed,#ins-lpnl-codeblock").button("enable"),Z("microtool-bookmark").enable(),Z("microtool-cmt").enable(),Z("microtool-img").enable(),Z("microtool-tbl").enable(),Z("microtool-code").enable(),Z("inlineinsert-img").enable(),Z("inlineinsert-tbl").enable(),Z("inlineinsert-bookmark").enable(),Z("inlineinsert-cmt").enable(),Z("review-tb-showcomment").enable(),Z("smart_cell_merge").enable(),Z("smart-table_cellalignment").enable(),J("#mailmergemenu").zmenu("enableMenuItems",["mailmerge-btn-insmergefld","mailmerge-btn-finishmerge"]),J("#ins-lpnl-break").zmenu("enableMenuItems",["ins-lpnl-page-break","ins-lpnl-col-break"])):"notesectionpane"==e&&(editor.jeditorPane.find("div.header_flag,div.footer_flag").hide(),UIUtils.jToolbarComp.find("#ins-lpnl-img,#ins-lpnl-table,#ins-lpnl-shapes,#ins-lpnl-txtbox,#ins-lpnl-splchars,#ins-lpnl-equation,#ins-lpnl-object,#comments,#ins-lpnl-break-menu,#rt_btn_add_comment,#ins-lpnl-bookmark,#ins-lpnl-toc,#ins-lpnl-endnote,#ins-lpnl-footnote,#readonly_add_comment,#mailmerge-btn-insmergefld,#mailmerge-btn-insmergefldDropDown,#mailmerge-btn-finishmerge,#ins-lpnl-cmnt,#ins-lpnl-blnkpage,#smart-addcomment,#ins-lpnl-embed,#ins-lpnl-codeblock").button("disable"),Z("microtool-bookmark").disable(),Z("microtool-cmt").disable(),Z("microtool-img").disable(),Z("microtool-tbl").disable(),Z("microtool-code").disable(),Z("inlineinsert-img").disable(),Z("inlineinsert-tbl").disable(),Z("inlineinsert-bookmark").disable(),Z("inlineinsert-cmt").disable(),Z("review-tb-showcomment").disable(),Z("smart_cell_merge").disable(),Z("smart-table_cellalignment").disable(),J("#mailmergemenu").zmenu("disableMenuItems",["mailmerge-btn-insmergefld","mailmerge-btn-finishmerge"]),J("#ins-lpnl-break").zmenu("disableMenuItems",["ins-lpnl-page-break","ins-lpnl-col-break"]))}catch(e){}},UIUtils.preProcessForDialogClose=function(){"undefined"==typeof EventHandler||EventHandler.isSubDlgOpened||(J.dialogutil.isDialogOpened("insertshape")&&ShapeEditor.clear(),J.dialogutil.isDialogOpened("spellcheckdialog")&&(UIUtils.enableDocumentShortcuts(),UIUtils.hideLoadingMsg(),SpellCheck.setCorrectSpellingPopupOpened(!1)),J.dialogutil.isDialogOpened("custdicdialog")&&(CustomDictionary.personaldictionarywindowstatus=!1),EventHandler.isDialogOpened=!1,editor.isEditable()?(UIUtils.enableDocumentShortcuts(),editor.jMbSpan_editableSpan.attr("contenteditable","true"),editor.jMultiByteSpan.css({top:editor.editorPaneContainer.scrollTop()/editor.zoomFactor}),EditorUtil.focusMultiByteSpan(),CurUtil.blinkCursor()):"SHAREDREAD"===editor.doc.getRole()&&UIUtils.enableDocumentShortcuts(),editor.mustScroll=!0,document.body.scrollTop=0),"undefined"!=typeof EventHandler&&(EventHandler.isSubDlgOpened=!1)},UIUtils.preProcessForDialogOpen=function(){UIUtils.disableDocumentShortcuts(),editor.isShiftDown=!1,"undefined"!=typeof EventHandler&&EventHandler.isDialogOpened&&(EventHandler.isSubDlgOpened=!0),jQuery.isEmptyObject(editor.doc.paintFormat)||(Utils.clearFormatPainterData(),UIUtils.toggleButtonStatus("fmt-lpnl-grp-paint","fmt-lpnl-painter","uncheck"),UIUtils.toggleButtonStatus("format-painter-set","smart_formatpainter","uncheck")),"undefined"!=typeof CommentManager&&CommentManager.closeCommentCreationDialog(),UIUtils.hideControllers(),editor.isEditable()&&editor.jMbSpan_editableSpan.attr("contenteditable","false"),"undefined"!=typeof EventHandler&&(EventHandler.isDialogOpened=!0),CurUtil.stopBlinking(editor.isEditable())},UIUtils.getHTMLRequestParam=function(){var e={};return"REMOTE"==editor.getEditorType()&&(e.rsid=editorProps.options.REMOTE.rsid,e.lang=editor.lang),editor.isOffline()?e.role="OFFLINE":e.role=editor.doc.getRole(),e},UIUtils.initDialogBindEvents=function(){var e=[];!editor.isOffline()&&ZWOffline.isOfflineSetupDone&&(e=["formula","bookmarkdialog","insertsplchar","tabdialog","columndialog","findandreplace","wcdialog","commonerror","listnumberingstart","restoredocument","msgdlg","gotodialog","shortcut","documentpropertiesdlg","inserttabledialog","listprefixsuffix"]);var t={POPUP_NAME:"DIALOG_NAME"},n=UIUtils.getHTMLRequestParam();J.dialogutil.configure({dialogNames:e,dialogFetchUrl:Utils.getNiceUrlPrefix("popup/{POPUP_NAME}"),paramsToReplaceInURL:t,dataFormat:n,preload:!0}),Jdocument.bind("dialogbeforeclose",function(e){PubSub.publish("Dialog/BeforeClose",e),"documentmapzdialog"==e.target.id?(DocumentMap.closePane(),J(".ui-widget-overlay").show()):UIUtils.preProcessForDialogClose(),UIUtils.isDialogOpened("findandreplace")&&setTimeout(function(){ReplaceDialog.handleClose()},100)}).bind("dialogopen",function(e){"documentmapzdialog"!=e.target.id&&UIUtils.preProcessForDialogOpen(),e.target&&"collabdialog"===e.target.id&&(editor.jMbSpan_editableSpan.attr("contenteditable","true"),UIUtils.enableDocumentShortcuts())}),Jdocument.on("zdialogminimize",function(){UIUtils.preProcessForDialogClose()}),Jdocument.on("zdialogmaximize",function(){UIUtils.preProcessForDialogOpen()}),J("#collabdialog").on("collaboratorclose",function(e){EventHandler.isDialogOpened=!1}),J("#toolbarContainer").on("toolbarshow",function(e){editor.onResize()}).on("toolbarhide",function(e){editor.onResize()})},UIUtils.handleDocumentLoadingComplete=function(){UIUtils.hideLoadingMsg();var e=editor.doc.getDocInfo();e.UpgradeToWriter3&&(editor.setEditable(!1),DomUtil.removeCursorNode(editor.uuid),UIUtils.disableDocumentShortcuts(),UIUtils.postProcessingForUpgrade()),e.newDoc||PubSub.publish("Document/SaveStatus",!0,void 0,editor.doc.docInfo.LASTMODIFIEDBY_ZUID,e.LAST_MODIFIED_TIME_LONG),editor.isEditable()&&UIUtils.updateViewStatus(),"REMOTE"==editor.getEditorType()?(editor.onResize(),UIUtils.updateSaveButton("enable")):("STOREAGE_SERVICE_WRITER"===editor.doc.getRole()?UIUtils.updateSaveButton("enable"):UIUtils.updateSaveButton("disable"),UIUtils.showDocStatusIcon()),Utils.scrollToEditorTop()},UIUtils.showFreezeMessage=function(e,t,n){e?(UIUtils.freezeState&&UIUtils.UnfreezeEditor(),UIUtils.preProcessForDialogOpen(),UIUtils.FreezeEditor(t,n)):UIUtils.UnfreezeEditor()},UIUtils.isPasteToolbarOn=function(){return!Paste.pasteToolbar.is(":hidden")},UIUtils.showPasteToolbar=function(){var e=editor.doc.getDomCursorNode(),t=LeftPanel.isContainerVisible(ELEM_ID.MAINPANELCONTAINER)&&!LayoutManager.isRichEditActive()?J("#"+ELEM_ID.MAINPANELCONTAINER).width():0;J(Paste.pasteToolbar).css({width:"50px",top:CurUtil.offset.start.top*editor.zoomFactor+e[0].offsetHeight*editor.zoomFactor-5,left:CurUtil.offset.start.left+LeftPanel.getPanelWidth()-t-editor.jeditorPane.offset().left-e[0].offsetWidth+5-Z("ui-editor-outer-div").scrollLeft()}),Paste.pasteToolbar.show()},UIUtils.hideControllers=function(e){editor.jTdVerticalControler.hide(),editor.jTdHorizantalControler.hide(),"undefined"==typeof LinkDialog||!LinkDialog.isDialogOpened()||e&&(J(e.target).has("#ins-lpnl-link")||J(e.target).parent().has("#ins-lpnl-link"))||LinkDialog.closeLinkPopup(),"undefined"!=typeof Paste&&UIUtils.isPasteToolbarOn()&&UIUtils.hidePasteToolbar()},UIUtils.hidePasteToolbar=function(){J(Paste.pasteToolbar).hide()},UIUtils.openGotoPageDlg=function(){return J.dialogutil.open("gotodialog",void 0),setTimeout(function(){J(".ui-widget-overlay").hide()},500),Utils.addToStatistics("gotopage"),setTimeout(function(){var e=J("#gotopage").find("input").last();e[0]&&(e.focus(),J("#gotopgnumber").zspinner("setMaxValue",ViewManager.getPageCount()),e.on("keydown",function(e){e.keyCode===KEYS.ENTER&&UIUtils.gotoPage()}))},500),!1},UIUtils.getPageIndex=function(e){var t,n,i,o,r,a=-1,s=-1;if(t=ViewManager.getElements("page"),e>t.length&&(e=t.length),e--,n=t[e]){i=J(n),o=i.data("id"),r=ViewManager.pages.items[o],r.createContentFragments(),r.renderView();var l=i.find(".zw-contentpane .zw-paragraph"),d=l.eq(0).find(".zw-line-div:first")[0],c=l.eq(l.length-1).find(".zw-line-div:last")[0];d&&(a=DocTreeManager.getStartIndex(d)),c&&(s=DocTreeManager.getEndIndex(c)-1)}return{start:a,end:s}},UIUtils.gotoPage=function(e,t){if(e){var n,i=UIUtils.getPageIndex(e);n=t?i.end||-1:i.start||-1,n!=-1&&UIUtils.moveToPage(e,n)}J.dialogutil.close("gotopage")},UIUtils.moveToPage=function(e,t){var n=editor.doc.createRange(t),i=editor.doc.getSelection();i.removeAllRanges().addRange(n),e>ViewManager.pages.length&&(e=ViewManager.pages.length),editor.currentPageIndex=e-1,editor.clientActiveSection&&!J(editor.clientActiveSection).hasClass("zw-contentpane")&&EventHandler.toggleSection(),Utils.scrollElementIntoView(editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start")[0],500,!0)},UIUtils.getErrorMsg=function(e,t){var n="<div class='ui-status-wrapper'><div class='ui-state-"+e+" ui-corner-all ui-znotifier'><span class='ui-znotifier-message'><span  class='ui-components-icon ui-state-"+e+"-icon' ></span>"+t+"</span></div></div>";return n},UIUtils._itemClicked=function(e,t){var n=t.menuitem,i=J(n).metadata().appData;if(i){var o=i.action,r=i.params;editorProps.signInRequiredFeatures&&editorProps.signInRequiredFeatures.contains(J(n).attr("id"))&&(o="UIUtils.openSignupDialog",r=void 0);var a=Utils.getAsFunction(o);a.callable(r)}},UIUtils.showMsgStatusbar=function(e){J("#statusInfo").text(e).fadeIn("fast").show(),setTimeout(function(){J("#statusInfo").fadeOut("slow").text("")},3e3)},UIUtils.showDocStatusIcon=function(){var e=editor.doc.getRole(),t=editor.doc.getDocInfo();if(J("#topband-docstatus").html(""),"SHAREDREADCOMMENT"==e||"ANYONELINK_SHAREDREADCOMMENT"==e?J("#topband-docstatus").append("<span class='ui-icon ui-icon-sprit-fast ui-button-icon-primary ui-writer-menu-icons ui-icon-cmt-only-blk-sm ui-fl ui-left-margin-small' title='"+J.i18n("writer.common.COMMENT_ONLY")+"'> </span>"):"TEMPLATEUSER"==e?J("#topband-docstatus").append("<span class='zdocstatus zdocstatus-template' title='Template Document'> </span>"):editor.isEditable()||!editor.getView()!=EDITOR_VIEWS.HISTORY&&"SHAREDREAD"!=e?"2"==t.PUBLISH_SCOPE?J("#topband-docstatus").append("<a id='externallink_docstatus' target='_blank'><span class='ui-icon ui-icon-sprit-fast ui-button-icon-primary ui-writer-menu-icons ui-icon-outside-world-blk-sm' title='Published To External World'> </span></a>"):"1"==t.PUBLISH_SCOPE&&J("#topband-docstatus").append("<a id='corporate_docstatus' target='_blank'><span class='ui-icon ui-icon-sprit-fast ui-button-icon-primary ui-writer-menu-icons ui-icon-with-in-organization-blk-sm' title='Published Within Organization'> </span></a>"):J("#topband-docstatus").append("<span class='ui-icon ui-icon-sprit-fast ui-button-icon-primary ui-writer-menu-icons ui-icon-read-only-blk-sm ui-fl ui-left-margin-small' title='Read Only'> </span>"),t.CHECKEDOUT){var n=editor.zuid==t.CHECKEDOUTBY_ZUID?J.i18n("common","DOCUMENT_LOCKED_BY_YOU"):J.i18n("common","DOCUMENT_LOCKED_BY",[t.CHECKEDOUTBY_NAME]);J("#topband-docstatus").append("<span id='checkout-status' class='ui-icon ui-icon-sprit-fast ui-button-icon-primary ui-writer-menu-icons ui-icon-shape-lock-blk-sm' title='"+n+"'> </span>")}editor.zuid&&t.PUBLISH_SCOPE&&UIUtils.docStatushyperlink()},UIUtils.docStatushyperlink=function(){var e=editor.doc.getDocInfo(),t=editor.getBaseURL()+"/published/"+Utils.getDocumentId();"1"==e.PUBLISH_SCOPE?J("#corporate_docstatus").attr("href",t):"2"==e.PUBLISH_SCOPE&&J("#externallink_docstatus").attr("href",t)},UIUtils.revertDocToWriter2=function(){var e={};e.rid=editor.doc.getDocInfo().RID,Utils.setCsrfParam(e),J.ajax({type:"POST",url:Utils.getContextUrl("revertDocToWriter2.do"),data:e,dataType:"json",success:function(e){},error:function(e){}})},UIUtils.enableDocumentShortcuts=function(){Jdocument.shortcutkeys("enable")},UIUtils.disableDocumentShortcuts=function(){Jdocument.shortcutkeys("disable")},UIUtils.showImageFailedMsg=function(){UIUtils.JnotifyMessageDiv.find(".ui-znotifier-base").length&&Jdocument.znotifier("destroy"),Jdocument.znotifier({autohide:!0,timeout:5e3,iconclass:"ui-components-icon ui-state-info-icon",content:J.i18n("common","IMAGE_PROCESSING_FAILED"),type:"error",position:"north",closebutton:!0,container:"notifyMessage"}),UIUtils.JnotifyMessageDiv.css("left",J(window).width()/2-UIUtils.JnotifyMessageDiv.width()/2+"px")},UIUtils.topPanelFixForCustomers=function(){J("div.ui-branding-div").removeClass().addClass("ui-branding-div-fb"),J("span.savestatus-msg").css({margin:"1px 11px 0px 0px"}),J("span#topband-savestatus").removeClass().addClass("ui-toplinks-div-fb")},UIUtils.closeLastModifiedCollabUsersList=function(){J("#modifiedusercontainer").hide()},UIUtils.applyWebView=function(){editor.jeditorPane.css("padding-left",0);var e=editor.doc.getPaperWidth()-17;CommentManager&&CommentManager.isCommentPaneInDisplay()&&(e-=330);var t=editor.doc.getBodyFormat();e-=t[ATTR_BODY.DS_ML].convertor().pixels+t[ATTR_BODY.DS_MR].convertor().pixels,J("#print").prop("disable",!0),J("#pg_size,#pg_orientation").prop("disable",!0),J("#menuitem_ins_toc").prop("disable",!0),J("#ins-lpnl-toc").prop("disable",!0)},UIUtils.clearView=function(e,t){if("Web View"===e){if(editor.getView()==EDITOR_VIEWS.HISTORY||editor.getView()==EDITOR_VIEWS.MAILMERGE_PREVIEW||editor.getView()==EDITOR_VIEWS.VERSIONVIEW)return;J("#pg_size,#pg_orientation").prop("enable",!0),J("#menuitem_ins_toc").prop("enable",!0),J("#ins-lpnl-toc").prop("enable",!0),J("#print").prop("enable",!0);var n=editor.doc.getBodyFormat()[ATTR_BODY.DS_PW].convertor().inches,i=editor.doc.getBodyFormat();n-=i[ATTR_BODY.DS_ML].convertor().inches+i[ATTR_BODY.DS_MR].convertor().inches,editor.editorPaneContainer.css({border:"",margin:""}).parent().css("margin-right","")}},UIUtils.showZohoWriterWebAppInstalDlg=function(){J.dialogutil.open("clipboarddialog",void 0,"")},UIUtils.installWebapp=function(){var e=window.location.protocol+"//chrome.google.com/webstore/detail/jgaeidloagadfcohacebhbkkapgpiddj",t=function(){PubSub.publish("DocOperation/AfterChromeWebappInstall")},n=function(){};chrome.webstore?chrome.webstore.install(e,t,n):window.open(e),J.dialogutil.close("clipboarddialog")},UIUtils.updateBookMarks=function(e,t){var n,i,o,r=J(e.bookMark),n=t.bookMarks?t.bookMarks:null;if(n&&n.length>0){i=n.length,o=!1;for(var a=0;a<i;a++)if(n[a].id.indexOf("toc")==-1){o=!0;break}var s=1==J(e.div).children(".bMark").length;if((!e.bookMark||!s)&&o){e.bookMark=document.createElement("div"),r=J(e.bookMark);var l="cell"==t.parent.parent.type,d=-30;l&&(d=-15),r.css({left:d}),r.addClass("bMark"),r.appendTo(e.el)}var c=r.siblings(".zw-line-content").css("padding-top");r.css({top:parseInt(c)+2});try{BookmarkDialog&&BookmarkDialog.hideBookmark?r.hide():r.show()}catch(e){}}},UIUtils.updateBookMarkButton=function(){var e=DocUtil.getKeys(editor.bookmarks);1==e.length?J("#view-lpnl-hideshowbookmark").zstatebutton("enable"):0==e.length&&J("#view-lpnl-hideshowbookmark").zstatebutton("disable")},UIUtils.updateNonPrintingButtonLabel=function(e){"string"==typeof e&&(e="true"===e);var t=e?"check":"uncheck";UIUtils.toggleButtonStatus("hiddenmarker","fmt-lpnl-non-printing-char",t)},UIUtils.setEditorPaneWrapperHeight=function(e){if(1!=editor.zoomFactor||e)if(EditorView.isWebView()){var t=J(".zw-page"),n=0;t.each(function(){n+=J(this).height()*editor.zoomFactor}),editor.jeditorPaneWrapper.css("height",n)}else editor.jeditorPaneWrapper.css("height",editor.jeditorPane.height()*editor.zoomFactor)},PubSub.subscribe(["page/removed","page/created"],UIUtils.setEditorPaneWrapperHeight,{async:!0,timeout:500}),PubSub.subscribe(["Document/lineview/create","Document/lineview/update"],UIUtils.updateBookMarks),PubSub.subscribe("Document/ComponentReady",UIUtils.handleOrgPolicyUIChanges),PubSub.subscribe("OrgPolicy/Changed",UIUtils.handleOrgPolicyUIChanges),UIUtils.openAutoFormat=function(){Settings.showSettingsDlg();var e=J("#settingszdialog")[0]?0:500;setTimeout(function(){J("#settingszdialog #menutabs").ztab("selectTab",J("#settingszdialog, #tab3_autoformat").index()-1)},e)},UIUtils.setHeadingDropdownStyle=function(){var e=editor.doc.getParaStyles();for(var t in e)if("minor"!=t&&"major"!=t){var n=e[t][ATTR_PARAGRAPH.TEXTFORMAT];n.hasOwnProperty(ATTR_TEXT.TS_SIZE)&&(n[ATTR_TEXT.TS_SIZE]=n[ATTR_TEXT.TS_SIZE]>18?18:n[ATTR_TEXT.TS_SIZE]);var i=Utils.getStyle(n),o=t.substring(1),r=J("#contentHeading"+o+" .ui-zmenu-text");r.removeAttr("style");var a=i.styles;for(var s in a)r.css(s,a[s]);e[t].hasOwnProperty(ATTR_PARAGRAPH.PS_BGC)&&r.css("backgroundColor",e[t][ATTR_PARAGRAPH.PS_BGC])}},UIUtils.setPreviewTextStyle=function(){},UIUtils.updateBottomBar=function(){var e=J("#wmstoolbar");"true"===w_usersettings.showchatbar?(UIUtils.bottomBar.css("bottom","26px"),UIUtils.bottomHeight=UIUtils.bottomBar.outerHeight()+e.outerHeight()):"false"===w_usersettings.showchatbar&&(UIUtils.bottomBar.css("bottom","0px"),UIUtils.bottomHeight=UIUtils.bottomBar.outerHeight()),editor.onResize()},UIUtils.handleChatBarView=function(e){var t=J("#wmstoolbar"),n=J("#wmstoggle");if(void 0!=e){var i={};i.showchatbar=e,Settings.updateUserSettings(i)}"true"===w_usersettings.showchatbar?(t.show(),n.attr("title",J.i18n("writer.common.HIDE_CHAT"))):"false"===w_usersettings.showchatbar&&(t.hide(),n.attr("title",J.i18n("writer.common.SHOW_CHAT")))},UIUtils.changeChatBarView=function(){var e={};Utils.setCsrfParam(e);var t=J("#wmstoolbar").is(":visible")?"false":"true";e.showchatbar=t,Settings.updateUserSettings(e),"REMOTE"!=editor.getEditorType()&&(e.sid=editor.uuid,J.post("/writer/v1/web/userSettings/chatbar",e)),UIUtils.handleChatBarView(t),UIUtils.updateBottomBar()},UIUtils.toggleLockBtnAndInserts=function(){var e=editor.doc.getRole();editor.doc.getSelection().isUnlockAllowed()?(UIUtils.jToolbarComp.find("#share_btn_unlock").attr("enable",!0),"OWNER"!=e&&(UIUtils.jToolbarComp.find("#inserttab").find("button").attr("disable",!0),J("#ins-lpnl-link,#text_to_table,#rt_btn_add_comment,#readonly_add_comment,#mailmerge-btn-insmergefld,#mailmerge-btn-insmergefldDropDown,#mailmerge-btn-finishmerge").attr("disable",!0))):(UIUtils.jToolbarComp.find("#share_btn_unlock").attr("disable",!0),"OWNER"!=e&&(UIUtils.jToolbarComp.find("#inserttab").find("button").attr("enable",!0),J("#ins-lpnl-link").attr("enable",!0)))},UIUtils.setZoomFactor=function(e){J.isArray(e)&&(e=e[0],"fitPage"!=e&&"fitWidth"!=e&&(editor.customZoom="")),Utils.addToStatistics("Zoom");J("#editorpane-wrapper");if("fitPage"!=e&&"fitWidth"!=e||(editor.customZoom=e,e=UIUtils.getCustomZoomFactor())){var t=parseInt(e);if(t>200||t<=0||isNaN(t))return Z("bbar-zoom").zcombo("setValue",parseInt(100*editor.zoomFactor)+"%"),void Z("view-lpnl-zoom").zcombo("setValue",parseInt(100*editor.zoomFactor)+"%");editor.zoomFactor=parseFloat(e)/100,Z("bbar-zoom").zcombo("setValue",parseInt(e)+"%"),Z("view-lpnl-zoom").zcombo("setValue",parseInt(e)+"%");var n=Z(ELEM_ID.EDITORPANE)[0];e=parseFloat(e)/100,n.style.webkitTransform="scale("+e+")",n.style.MozTransform="scale("+e+")";var i="-ms-transform";n.style[i]="scale("+e+")",EditorLayout.updateMainOuterDivProps(),UIUtils.setEditorPaneWrapperHeight(!0),PubSub.publish("Document/Zoom"),Utils.addToStatistics("4.0_ZoomFactor")}},UIUtils.hideWrappers=function(e){e?(Z("microandparaVCContainer").hide(),J("#tablePropWrapper").hide()):UserPreferences.isPrefered("para_microtoolbar")&&Z("microandparaVCContainer").show()},UIUtils.toggleCollabActionButtons=function(){var e=editor.doc.getTrackChangeDetails().getDisplayMode();if(!(e===TCConstants.ORIGINAL_VIEW||editor.doc.getDocInfo().CHECKEDOUT&&editor.doc.getDocInfo().CHECKEDOUTBY_ZUID!=editor.zuid)){var t=J("#review-tb-collabaction"),n=t.find("#pausecollab");n.zbutton(),t.find("button").zbutton(),"true"==editor.doc.getDocInfo().ISSHARED&&editor.isEditable()?(t.find("button").zbutton("enable"),n.zbutton("enable"),editor.doc.getDocInfo().CHECKEDOUT||n.zbutton("check"),t.find("#review-tb-pausecollab").removeClass("ui-state-disabled"),t.attr("title","")):(t.find("button").zbutton("disable"),t.find("#review-tb-follow,#review-tb-lock").zbutton("enable"),n.zbutton("disable"),t.find("#review-tb-pausecollab").addClass("ui-state-disabled"),"false"==editor.doc.getDocInfo().ISSHARED&&t.attr("title",J.i18n("writer.common.PAUSE_COLLAB_TOOLTIP")))}},UIUtils.showBanner=function(e,t){var n=J("#banner-temp-offline-cont");J("#banner-div").show(),t=t||{color:"#7F7F7F"},n.find("#banner-temp-offline-txt").text(e).css(t),n.css("left","0px"),n.show().slideDown("slow")},UIUtils.hideBanner=function(){J("#banner-div").hide(),J("#banner-temp-offline-cont").hide()},UIUtils.getOpenType=function(){var e="_blank",t=editor.doc.getDocInfo();return(!t||1==t.VERSION&&0==t.REVISION&&t.newDoc)&&(e="_self"),e},UIUtils.hideRightClickMenu=function(){var e=J.ZContextMenu.currentMenu;e&&e.is("#Rmenu")&&(J.ZContextMenu.hideMenu()._isMenuShowing=!1)},UIUtils.processRightClickMenu=function(e,t){if((!editor.isEditable()||EventHandler.isDialogOpened)&&!editor.doc.getTrackChangeDetails().getIsReviewPage())return!1;if(PopupHandler.closeAllPopup(),!editor.browserInfo.is_ie&&window.getSelection().removeAllRanges(),"REMOTE"!=editor.getEditorType()&&J(e.toElement).is("div.field_text_node")&&"autodate"==J(e.toElement).attr("data-fieldtype"))return PopupHandler.openPopup("inlineDatemenu"),!1;var n=J("#Rmenu"),i=t.currentTarget,o=J(i),r=editor.doc.getSelection(),a=r.isCollapsed(),s=editor.doc.getRole(),l=r.getStart(),d=J(editor.doc.getCursorPortionNode(editor.uuid,"start")),c=editor.doc.getSelectedContent().length,u=o.attr("latexexpression"),p=(i.className,r.getTextFormat()),h=r.getParaFormat(),f=r.parents(NODE_TYPE.CELL),m=o.parents("div.zw-contentpane,div.header_primary,div.footer_primary")[0],g="link"==p.cls&&2==p.lnktype&&d.parents("#toc")[0],T=Utils.nodeNameEquals(i[0]||i,"image"),_=InsertShape.selectedShape(),E=!!f,v=r.isTableSelected(),S=Paste.pasteDiv&&Paste.pasteDiv.innerHTML,b="SHAREDREADCOMMENT"==s||"ANYONELINK_SHAREDREADCOMMENT"==s;if(n.zmenu("hideAllMenuItems"),n.zmenu("hideMenuGroup","synonymsMenuCbList"),n.zmenu("hideMenuGroup","synonymsMenuCbSmart"),EventHandler.mouseUpDone=!0,r.isListItemSelection){var R=r.getNodesInSelection(NODE_TYPE.PARAGRAPH)[0].dtNode.paraProperties.isHeadingList;if(n.zmenu("showMenuGroup","listselectionmenu",!0),n.zmenu(R?"showMenuItem":"hideMenuItem","rht_headingList"),"SHAREDREADCOMMENT"!=s&&"ANYONELINK_SHAREDREADCOMMENT"!=s&&h.ps_type&&"list"==h.ps_type){var O=h.ls_data.id,D=h.ls_data.l,y=editor.doc.getListObj(O)["level"+D].type<5;n.zmenu(y?"showMenuItems":"hideMenuItems",["rht_restart_num","rht_prefix_suffix"]);var A=J("#rht_list_dec_indent");0==D?A.disable():A.enable()}return J("#clipboardOperationsSmart").hide(),!0}if(!b&&_){PubSub.publish("Gridlines/hide");var C=InsertShape.getSelectedShapesArray();if(C[0].data.dropcapData)return J("#clipboardOperationsSmart").hide(),!1;InsertShape.updateToolbar(),n.zmenu("showMenuGroup","shapemenu",!0),J("#rht_click_clipboardSmart_shape").show();var C=InsertShape.getSelectedShapesArray(),I=InsertShape.getShapeFromFloatImages(DocTreeManager.getNode(d.parents(".zw-paragraph")).paraProperties),w=!1,P=C[0].data.props.transform.pos.zindex,M=C.length>1,L=!1,N=C[0].data.type,U=!1,x=!(M||!C[0].parentIds[0]);C.forEach(function(e){var t=e.data;"CONNECTOR"==t.type&&(L=!0),U||(U="GROUPSHAPE"==e.data.type),0!=t.props.transform.rotate&&(w=!0)}),n.zmenu(w&&"CONNECTOR"!=N?"showMenuItem":"hideMenuItem","resetRotation"),(L||M||U)&&n.zmenu("hideMenuItems",["editText","editText_sep"]),M||x?n.zmenu("hideMenuItems",["arrange_sep","bringForward","sendBackward"]):n.zmenu(P==I.length?"hideMenuItem":"showMenuItem","bringForward").zmenu(1==P?"hideMenuItem":"showMenuItem","sendBackward").zmenu(1==P&&1==I.length?"hideMenuItem":"showMenuItem","arrange_sep");var k=J("#undo_smart_shape"),F=J("#redo_smart_shape");return editor.doc.snapShotManager.isUndoQueueEmpty()?k.disable():k.enable(),editor.doc.snapShotManager.isRedoQueueEmpty()?F.disable():F.enable(),x&&n.zmenu("hideMenuItems",["resetShape","duplicateShape"]),n.zmenu(x?"showMenuItem":"hideMenuItem","deleteGrpShape"),!0}if(Z("rht_click_clipboardSmart_shape").hide(),!a&&!J(i).hasClass("overlay")){var Y=EventHandler.getIndex(t.orgEvent),B=editor.doc.createRange(Y);r.removeAllRanges().setSelectionType(SEL_MOUSE).addRange(B)}if(!b&&T){if(!u&&m){if(ZWOffline.isOfflineSetupDone&&editor.isOffline())return;var H=editor.doc.getParents(NODE_TYPE.IMAGE,editor.doc.getSelection().getStart());if(ImageUtils.isUserRoleDownloadAllowed()){var W=H.attr("src"),V=n.find("#rck-img-addto-mylib"),G=n.find("#rck-img-download-opts"),z=W&&0==W.indexOf("image.do?imgurl=");z?(V.enable(),G.enable()):(V.disable(),ImageUtils.isDownloadSupported()&&editor.browserInfo.is_chrome?G.enable():G.disable())}n.zmenu("showMenuGroup","imagemenu",!0);var j=J("#insertLinkOption"),X=editor.doc.getParents(NODE_TYPE.IMAGE,editor.doc.getSelection().getStart()),K=X.attr();return void(K.linkData&&K.linkData.url?j.hide():j.show())}if(u&&m)return void n.zmenu("showMenuGroup","latexmenu",!0)}if(!b&&g)return n.zmenu("showMenuGroup","tocmenus"),!0;if(a&&ModeManager.getCurrentMode()===EDITOR_MODES.COLLABORATE){var $=(editor.doc.getDocInfo(),TcUtil.hasTCProperty(r.getStart())),q=editor.doc.getTrackChangeDetails().canReview();$&&q&&"REMOTE"!==editor.getEditorType()&&n.zmenu("showMenuGroup","reviewTC")}if(!a){var q=editor.doc.getTrackChangeDetails().canReview();q&&"REMOTE"!==editor.getEditorType()&&TcManager.getCollection().isNodeInRange(r.getStart(),r.getEnd())&&n.zmenu("showMenuGroup","reviewAllTC")}if(E&&!b)if(d.parents("td:first")[0]&&a&&!r.getSelectedCells()[0]){n.zmenu("showMenuGroup","set1tableoperations"),FormulaHandler.isFormulaInSelection()||n.zmenu("hideMenuItems",["updateformula","Rgtmenu_Separator_formula"]);var Q=f.parentNode().parentNode(),ee=TableUtil.isCollabsInTable(Q);ee?n.zmenu("disableMenuItems",["convertTableToText"]):n.zmenu("enableMenuItems",["convertTableToText"]);var te=f.parentNode(),ne=SplitTable.canAllowSplitTable(te);ne&&!ee?n.zmenu("enableMenuItems",["splitTable"]):n.zmenu("disableMenuItems",["splitTable"]);var ie=TransposeTable.canAllowTransposeTable(Q);ie&&!ee?n.zmenu("enableMenuItems",["transposeTable"]):n.zmenu("disableMenuItems",["transposeTable"]);var oe=r.getLastRange();if(oe.isPartialTableSelected()||oe.isMultipleTablesSelected())v&&n.zmenu("showMenuItems",["mergecells","distributeColumn"]).zmenu("hideMenuItems",["unmergecells","splitcells","selectallcells"]);else{TableUtil.isCellWidthInPercentage(f.attr());if(!v){n.zmenu("showMenuItems",["distributeColumn","splitcells"]).zmenu("hideMenuItems",["mergecells","selectallcells","unmergecells"]);for(var re=0,ae=d.parents("table.zw-table").find("td.zw-td"),se=ae.length,le=0;le<se;le++){var de=ae[le];if("none"!=J(de).css("display")&&(re++,re>1)){n.zmenu("showMenuItem","selectallcells");break}}}f.attr("merge")&&"fc"==f.attr("merge")&&n.zmenu("showMenuItem","unmergecells");var ce=f.attr("cspan");ce&&ce%2==1&&1!=ce&&n.zmenu("hideMenuItem","splitcells")}}else r.getSelectedCells()[0]&&n.zmenu("showMenuGroup","set2tableoperations");if(n.zmenu("showMenuGroup","ClipBoard"),(a||0==c&&!T&&g)&&n.zmenu("hideMenuItem","delete"),"OWNER"==s)if(r.isUnlockAllowed()){var ue=Lock.getLock(r.getStart()+1),pe=ue.getDocOps();pe[1].lock_data.data.redact?n.zmenu("hideMenuItems",["rht_click_lock","rht_click_unlock"]).zmenu("showMenuItems",["rht_click_unredact","Rgtmenu_Separator_lock"]):n.zmenu("hideMenuItems",["rht_click_lock","rht_click_unredact"]).zmenu("showMenuItems",["rht_click_unlock","Rgtmenu_Separator_lock"])}else n.zmenu(a?"hideMenuItems":"showMenuItems",["rht_click_lock","Rgtmenu_Separator_lock"]),n.zmenu("hideMenuItems",["rht_click_unlock","rht_click_unredact"]);else n.zmenu("hideMenuItems",["rht_click_lock","rht_click_unlock","rht_click_unredact","Rgtmenu_Separator_lock"]);var he="link"==p.cls&&(!d.parents("#toc")[0]||1==p.lnktype);n.zmenu(he||r.isTableSelected()||g||a?"hideMenuItem":"showMenuItem","rt_btn_ins_link"),(editor.clientActiveSection&&editor.clientActiveSection.className.indexOf("zw-contentpane")==-1||a||editor.isOffline()||g)&&n.zmenu("hideMenuItems",["rt_btn_add_comment","Rgtmenu_Separator_inserts"]);var fe=h.hd,me=fe?"hd"+fe:"hd0";if(b||h.ps_type||a||v||he?n.zmenu("hideMenuItem","headingStyl_sep"):n.zmenu("showMenuItems",[me,"headingStyl_sep"]),a&&h.ps_type&&"list"==h.ps_type){var ge=[];ge.push({mtype:"separator"},{id:"inc_indent",label:J.i18n("writer.common.INCREASE_INDENT"),data:"{appData:{action:'editor.doc.execCmd',params:['indent','ID']},icon: 'ui-components-toolbar-icon ui-icon-zindentmore',text: true, shortcutkey:'ctrl+m'}"},{id:"dec_indent",label:J.i18n("writer.common.DECREASE_INDENT"),data:"{appData:{action:'editor.doc.execCmd',params:['outdent','DI']},icon: 'ui-components-toolbar-icon ui-icon-zindentless',text: true,shortcutkey:'ctrl+shift+m'}"}),n.zmenu("addMenuItems",ge)}if(!b&&h.ps_type&&"list"==h.ps_type){var O=h.ls_data.id,D=h.ls_data.l;if(editor.doc.getListObj(O)["level"+D].type<5){var Te=[];if(a){h.ls_data.id,h.ls_data.l;Te.push({id:"start_num",label:J.i18n("writer.common.RESTART_NUMBERING_SMALL"),data:"{appData: {action:'WebUtil.showNumberedList'}}"})}if(O==editor.doc.getHeadingListId()){var _e={label:J.i18n("writer.common.REMOVEHLIST"),data:"{'appData':{'action':'editor.doc.execCmd','params':'removeHeadingList'}}"};Te.push(_e)}n.zmenu("addMenuItems",Te)}}var Ee="";n.find('li[style*="display: block"]').length||n.find('li[id*="-spell"]').length?(n.zmenu("hideMenuGroup","clipboardOperationsLists").zmenu("showMenuGroup","clipboardOperationsSmart").zmenu("hideMenuItem","delete"),Ee="_smart"):(n.zmenu("showMenuGroup","clipboardOperationsLists").zmenu("hideMenuGroup","clipboardOperationsSmart"),Ee="_list");var k=n.find("#undo"+Ee),F=n.find("#redo"+Ee),S=Paste.pasteDiv&&Paste.pasteDiv.innerHTML||"";editor.doc.snapShotManager.isUndoQueueEmpty()?k.disable():k.enable(),editor.doc.snapShotManager.isRedoQueueEmpty()?F.disable():F.enable(),editor.browserInfo.is_chrome&&"REMOTE"!==editor.getEditorType()&&!editor.isOffline()||Utils.contextMenuSupportedBrowser()?a?(n.find("#rht_click_copy"+Ee).disable(),n.find("#rht_click_cut"+Ee).disable()):(n.find("#rht_click_copy"+Ee).enable(),n.find("#rht_click_cut"+Ee).enable()):n.zmenu("hideMenuItems",["rht_click_cut"+Ee,"rht_click_copy"+Ee,"rht_click_paste"+Ee,"Rgtmenu_Separator_unodredo"]),n.zmenu(b?"hideMenuItems":"showMenuItems",["rht_click_select_all_same_formatting"+Ee,"rht_click_select_all_same_formatting_sep"+Ee]),b&&(n.find("#rht_click_cut"+Ee).hide(),n.find("#rht_click_paste"+Ee).hide(),n.find("#rht_click_delete_smart").hide());var ve="rht_click_select_code_block";if(ZWCode.isCodePara()?n.zmenu("showMenuItem",ve):n.zmenu("hideMenuItem",ve),S&&0!=S.length?S.indexOf("zw-image")!=-1?n.zmenu("showMenuItem","rmenu_pasteimage_list").zmenu("hideMenuItem","rmenu_pastelink_list"):S.indexOf("link")!=-1&&n.zmenu("showMenuItem","rmenu_pastelink_list").zmenu("hideMenuItem","rmenu_pasteimage_list"):n.zmenu("hideMenuItems",["rmenu_pasteimage_list","rmenu_pastelink_list"]),"undefined"!=typeof SpellCheck&&(a||!SpUtil.isSelectionHasMoreWord())){var Se=SpellCheck.getWordDetailedInfo(l);if(Se.hasOwnProperty("isInvalid")&&0==Se.isInvalid){var be=Thesaurus.getSynonyms(Se.text);n.zmenu("showMenuGroup","synonymsMenuCbList"),n.zmenu("showMenuGroup","synonymsMenuCbSmart"),be.done(function(e,t){t==Se.text&&("block"!=Z("synonymsSubMenuCbmart").css("display")&&"block"!=Z("synonymsSubMenuCbList").css("display")||UIUtils.addSynonymsMenu(e))}),be.fail(function(e){e==Se.text&&("block"!=Z("synonymsSubMenuCbmart").css("display")&&"block"!=Z("synonymsSubMenuCbList").css("display")||UIUtils.addSynonymsMenu(new Array))})}}if(!b){var Re=editor.doc.getSelection().parents("section");"endnote"!=Re.subType&&"footnote"!=Re.subType||(n.zmenu("showMenuGroup","notemenus"),Re.attr("refchar")?n.zmenu("showMenuItem","rht-click-remove-notesymbol"):n.zmenu("hideMenuItem","rht-click-remove-notesymbol"),"endnote"==Re.subType?n.zmenu("showMenuItems",["rht-click-endnote-to-footnote","rht-click-allendnote-to-footnote"]).zmenu("hideMenuItems",["rht-click-footnote-to-endnote","rht-click-allfootnote-to-endnote"]).zmenu("changeLabel","rht-click-insert-notesymbol",J.i18n("writer.endnote.MODIFY_ENDNOTE_SYMBOL")).zmenu("changeLabel","rht-click-remove-notesymbol",J.i18n("writer.endnote.RESET_ENDNOTE_SYMBOL")).zmenu("changeLabel","rht-click-noteproperties",J.i18n("writer.endnote.ENDNOTE_PROPERTIES")).zmenu("changeLabel","rht-click-removenote",J.i18n("writer.endnote.REMOVE_ENDNOTE")):"footnote"==Re.subType&&n.zmenu("showMenuItems",["rht-click-footnote-to-endnote","rht-click-allfootnote-to-endnote"]).zmenu("hideMenuItems",["rht-click-endnote-to-footnote","rht-click-allendnote-to-footnote"]).zmenu("changeLabel","rht-click-insert-notesymbol",J.i18n("writer.endnote.MODIFY_FOOTNOTE_SYMBOL")).zmenu("changeLabel","rht-click-remove-notesymbol",J.i18n("writer.endnote.RESET_FOOTNOTE_SYMBOL")).zmenu("changeLabel","rht-click-noteproperties",J.i18n("writer.endnote.FOOTNOTE_PROPERTIES")).zmenu("changeLabel","rht-click-removenote",J.i18n("writer.endnote.REMOVE_FOOTNOTE")))}},UIUtils.updateDocumentMenu=function(e,t){var n=J("#documentmenu");if(!editor.isEditable())return!1;jQuery.isEmptyObject(editor.doc.paintFormat)||(Utils.clearFormatPainterData(),UIUtils.toggleButtonStatus("fmt-lpnl-grp-paint","fmt-lpnl-painter","uncheck"),UIUtils.toggleButtonStatus("format-painter-set","smart_formatpainter","uncheck")),EventHandler.mouseUpDone=!0;var i=editor.doc.getRole(),o=t.currentTarget,r=(J(o).attr("latexexpression"),J(o)),a=J(editor.doc.getCursorPortionNode(editor.uuid,"start")).is(".link"),s=r.parents("div.zw-contentpane,div.header_primary,div.footer_primary")[0];if("bMark"!=r.attr("class")&&a&&s){var l=editor.doc.getParents(NODE_TYPE.LINK,editor.doc.getSelection().getStart()-1),d=!1;if(J(t.orgEvent.target).parents("#toc")[0]){var c=l.attr(ATTR_LINK.LINK_URL),u=editor.doc.getElement(NODE_TYPE.BOOKMARK,c);if(!u)return n.zmenu("hideMenuItems",["subitem1","modifylink"]),!0;d=!0}if(l){n.zmenu("showMenuGroup","linkmenu",!0).zmenu("removeAllMenuItems",J("#linkmenu"));var p=LinkDialog.getMenuObj(l,d),h=p.length;("SHAREDREADCOMMENT"===i||"ANYONELINK_SHAREDREADCOMMENT"===i)&&h>1&&(h=1);for(var f=0;f<h;f++)n.zmenu("addMenuItem",p[f]);return J("#documentmenu").hide(),!0}}if("SHAREDREADCOMMENT"===i||"ANYONELINK_SHAREDREADCOMMENT"===i)return!1;if(editor.jeditorPane.find("div.markingDiv").remove(),"bMark"==r.attr("class")){var m=BookmarkDialog.constructMenu(o);return n.zmenu("showMenuGroup","bookmark",!0).zmenu("removeAllMenuItems",J("#bookmark")),n.zmenu("addMenuItems",m),!0}return!1},UIUtils.initComponent=function(e){if(e)e&&COMPONENTS_INIT_DONE.indexOf(e)==-1&&(J.ui.utils.initComponents(J("#"+e),function(){editor.doc.getDocInfo().newDoc&&("complete-tb"==e?UIUtils.handleDistributeTabForNewDoc():"review-tb"==e?UIUtils.handleReviewTabForNewDoc():e==ELEM_ID.HEADEROPTIONSPANEL&&editor.doc.getDocInfo().newDoc&&J("#ins-version").disable())}),COMPONENTS_INIT_DONE.push(e));else{J.ui.zcolorpalette.defaults.useDefaultBaseColors=!0,J.ui.utils.initComponents(J("#topband")),COMPONENTS_INIT_DONE.push("topband"),J.ui.utils.initComponents(J("#popup-filemenu")),COMPONENTS_INIT_DONE.push("popup-filemenu"),J.ui.utils.initComponents(J("#bottombar")),J.ui.utils.initComponents(J("#documentmapzdialog")),J.ui.utils.initComponents(J("#ins-lpnl-break")),COMPONENTS_INIT_DONE.push("ins-lpnl-break"),COMPONENTS_INIT_DONE.push("bottombar");var t=editor.doc.getRole();if("OWNER"!=t&&"COOWNER"!=t&&"REMOTEPUBLICUSER"!=t&&"ANYONELINK_SHAREDREADWRITE"!=t&&"SHAREDREADWRITE"!=t&&"REMOTECOLLABEDIT"!=t&&"REMOTEEDIT"!=t&&"WORKSPACE_CRMLIB_EDITOR"!=t&&"MAILMERGE_LIBRARY"!=t&&"CRM_VERTICAL_MAILMERGE_LIBRARY"!=t&&"ZFORMS_TEMPLATE"!=t&&"STOREAGE_SERVICE_WRITER"!=t&&"TEMPLATE_USER"!=t)"SHAREDREAD"==t||"REMOTEVIEW"==t||"ANYONELINK_SHAREDREAD"==t?(J.ui.utils.initComponents(J("#readonly-tb")),COMPONENTS_INIT_DONE.push("readonly-tb")):"SHAREDREADCOMMENT"==t||"ANYONELINK_SHAREDREADCOMMENT"==t?(J.ui.utils.initComponents(J("#readcomment-tb")),COMPONENTS_INIT_DONE.push("readcomment-tb"),J.ui.utils.initComponents(J("#editor-rightPanel")),COMPONENTS_INIT_DONE.push("editor-rightPanel"),J.ui.utils.initComponents(J("#Rmenu")),COMPONENTS_INIT_DONE.push("Rmenu")):t==USER_ROLE.PUBLIC?(J.ui.utils.initComponents(J("#branding")),COMPONENTS_INIT_DONE.push("branding")):"REMOTECOLLABVIEW"==t&&(J.ui.utils.initComponents(J("#readcomment-tb")),COMPONENTS_INIT_DONE.push("readcomment-tb"),J.ui.utils.initComponents(J("#editor-rightPanel")),COMPONENTS_INIT_DONE.push("editor-rightPanel"),J.ui.utils.initComponents(J("#readonly-tb")),COMPONENTS_INIT_DONE.push("readonly-tb"),J.ui.utils.initComponents(J("#Rmenu")),COMPONENTS_INIT_DONE.push("Rmenu"));else{if("REMOTEEDIT"!=t||"REMOTECOLLABEDIT"!=t||"REMOTEPUBLICUSER"!=t||"TEMPLATE_USER"!=t){var n=editor.doc.getUserData(),i=n[editor.zuid].editor_mode;2==i?(J.ui.utils.initComponents(J("#review-tb"),function(){editor.doc.getDocInfo().newDoc&&UIUtils.handleReviewTabForNewDoc()}),COMPONENTS_INIT_DONE.push("review-tb"),J.ui.utils.initComponents(J("#editor-rightPanel")),COMPONENTS_INIT_DONE.push("editor-rightPanel")):3==i&&(J.ui.utils.initComponents(J("#complete-tb"),function(){editor.doc.getDocInfo().newDoc&&UIUtils.handleDistributeTabForNewDoc()}),COMPONENTS_INIT_DONE.push("complete-tb"))}"WORKSPACE_CRMLIB_EDITOR"!=t&&"MAILMERGE_LIBRARY"!=t&&"CRM_VERTICAL_MAILMERGE_LIBRARY"!=t&&"ZFORMS_TEMPLATE"!=t||(J.ui.utils.initComponents(J("#menuTools")),COMPONENTS_INIT_DONE.push("menuTools"),J.ui.utils.initComponents(J("#menuInsert")),COMPONENTS_INIT_DONE.push("menuInsert")),J.ui.utils.initComponents(J("#link-popup")),COMPONENTS_INIT_DONE.push("link-popup"),J.ui.utils.initComponents(J("#paraPropMenu")),COMPONENTS_INIT_DONE.push("paraPropMenu"),J.ui.utils.initComponents(J("#microtoolbar")),COMPONENTS_INIT_DONE.push("microtoolbar"),J.ui.utils.initComponents(J("#Rmenu")),COMPONENTS_INIT_DONE.push("Rmenu"),J.ui.utils.initComponents(J("#inlineDatemenu")),COMPONENTS_INIT_DONE.push("inlineDatemenu"),J.ui.utils.initComponents(J("#inlineInsert")),COMPONENTS_INIT_DONE.push("inlineInsert")}J.ui.utils.initComponents(J("#spellCheckMenu")),COMPONENTS_INIT_DONE.push("spellCheckMenu"),J.ui.utils.initComponents(J("#smartToolbar")),COMPONENTS_INIT_DONE.push("smartToolbar"),J.ui.utils.initComponents(J("#menuShapes")),COMPONENTS_INIT_DONE.push("menuShapes"),J.ui.utils.initComponents(J("#pasteToolbar")),COMPONENTS_INIT_DONE.push("pasteToolbar"),J.ui.utils.initComponents(J("#fmt-sub-pnl-para-grp")),COMPONENTS_INIT_DONE.push("fmt-sub-pnl-para-grp"),J.ui.utils.initComponents(J("#menuFormat"),function(){var e={},t=editorProps.options||{};e.fileId=docProps.info.RID,e.allowDuplicateName=!0,e.movetoDialogTitle=J.i18n("writer.zmoveto.MOVE_TO_FOLDER"),e.fileName=docProps.info.DOCUMENT_NAME_HTML,e.rename=t.is_rename_allowed||!1,e.saveToFolder=t.save_to_folder||!1,e.canFavourite=t.can_favourite||!1,e.displayLength="250",e.fileExtension="zwriter",J("#topband-savetofolder").zfilefield(e),PubSub.publish("Document/FirstTimeComponentReady"),PubSub.publish("Document/ComponentReady")}),J.ui.utils.initComponents(J("#menuInsert")),J.ui.utils.initComponents(J("#menuTools")),J.ui.utils.initComponents(J("#langmenu")),J.ui.utils.initComponents(J("#changecasemenu")),COMPONENTS_INIT_DONE.push("changecasemenu"),J.ui.utils.initComponents(J("#ui-reader-popup")),COMPONENTS_INIT_DONE.push("menuFormat"),COMPONENTS_INIT_DONE.push("menuInsert"),COMPONENTS_INIT_DONE.push("menuTools"),J("#branding, #mainOuterDiv").show(),J.ui.utils.initComponents(J("#table-visualcue-popup")),COMPONENTS_INIT_DONE.push("table-visualcue-popup"),PubSub.unsubscribe("Document/LoadingStart",UIUtils.initComponent)}},UIUtils.positionDocumentMenu=function(e,t){var n=J(t.currentTarget),i=n.offset(),o=i.top+n.outerHeight();o+this.offsetHeight>editor.editorPaneContainerHt+editor.editorPaneContainerOffset.top&&(o-=this.offsetHeight),J(t.menu).css({left:e.originalEvent.clientX,top:o}),"bMark"!=n.attr("class")&&setTimeout(function(){EditorUtil.focusMultiByteSpan()},500)},UIUtils.loadFcompFeatureFiles=function(){var e=editorProps.fcomponentFiles.slice();if(0!=e.length){e.indexOf("import")!=-1&&e.splice(e.indexOf("import"),1),e.push("customize");for(var t=0,n=e.length;t<n;t++){var i=e[t],o="customize"===i?cssStaticURL:fcomponentCssPath;UIUtils.loadFcompCssFiles(i,o)}UIUtils.loadFcompJsFiles()}},UIUtils.loadFcompCssFiles=function(e,t){J(document.createElement(NODE_TYPE.LINK)).attr({href:t+"styles/fcomponents_"+e+".css",rel:"stylesheet",type:"text/css"}).appendTo(document.head)},UIUtils.loadFcompJsFiles=function(){var e=editorProps.fcomponentFiles;if(0!=e.length)for(var t=0,n=e.length;t<n;t++){var i=e[t],o={async:"async",defer:"defer",src:fcomponentJsPath+"js/fcomponents_"+i+".js"};loadJS(o)}},UIUtils.changeTextBackgroundColor=function(e,t){J("button#fmt-lpnl-bgcolor,button#textbackgroundcolor-smart").children(".ui-button-icon-primary").css({"border-bottom":"2px solid "+t.color}),editor.doc.execCmd("BackColor",Utils.getColorReference(t))},UIUtils.changeForegroundColor=function(e,t){J("#fmt-lpnl-fgcolor,#textforegroundcolor-smart,#shp-lpnl-fgcolor").children(".ui-button-icon-primary").css({"border-bottom":"2px solid "+t.color}),editor.doc.execCmd("ForeColor",Utils.getColorReference(t))},UIUtils.changeParaBackgroundColor=function(e,t){J("button#fmt-lpnl-parabgcolor, #pcm-parabgcolor").children(".ui-button-text").attr("style","background-color: "+t.color+"!important"),editor.doc.execCmd("ParaBackColor",Utils.getColorReference(t))},UIUtils.getVisibleAreaTop=function(){var e=editor.editorPaneContainer.scrollTop(),t=editor.editorPaneContainer.height();viewportOffset={top:e,bottom:e+t};var n;return CurUtil.offset.start.top<viewportOffset.top&&CurUtil.offset.end.top>viewportOffset.bottom?n=e+t/2:CurUtil.offset.start.top<viewportOffset.top&&CurUtil.offset.end.top<viewportOffset.bottom?n=CurUtil.offset.end.top:(CurUtil.offset.start.top>=viewportOffset.top||CurUtil.offset.end.top<viewportOffset.bottom)&&(n=CurUtil.offset.start.top),n},UIUtils.toggleElemState=function(e,t){if("enable"==t)for(var n=0,i=e.length;n<i;n++){var o=Z(e[n]).attr("data_onclick");Z(e[n]).attr("onclick",o),Z(e[n]).enable(),Z(e[n]).removeAttr("data_onclick")}else if("disable"==t)for(var n=0,i=e.length;n<i;n++){var o=Z(e[n]).attr("onclick");Z(e[n]).attr("data_onclick",o),Z(e[n]).disable(),Z(e[n]).removeAttr("onclick")}},UIUtils.afterOnboardHelp=function(){PopupHandler.openPopup("paraPropMenu"),LeftPanel.toggleLeftPanel()},UIUtils.enableMenuTabs=function(e){J(e).removeClass("ui-button-state-disable")},UIUtils.disableMenuTabs=function(e){J(e).addClass("ui-button-state-disable")},PubSub.subscribe("ZWSelection/ListItemSelected",function(){var e=["fmt-lpnl-cut","fmt-lpnl-copy","fmt-lpnl-paste","fmt-lpnl-pasteDropDown","fmt-lpnl-quickbtn","review-tb-lock","review-tb-redact","review-tb-showcomment","complete-tb-mailmerge","tools-lpnl-mm","microtoolbarbtndiv"],t="menu-insert-parent";U.each(U.union(e,[t]),function(e){Z(e).addClass("ui-button-state-disable")}),PubSub.subscribeOnce(["Cursor/Collapsed","Cursor/Selected"],function(){U.each(e,function(e){Z(e).removeClass("ui-button-state-disable")});var n=editor.doc.getSelection();n.isListItemSelection||InsertShape.selectedShape()||Z(t).removeClass("ui-button-state-disable")})}),UIUtils.toggleRedactBtns=function(){var e=editor.doc.getRole();if("OWNER"==e||"COOWNER"==e){UIUtils.JredactBtn.show().zbutton("enable"),UIUtils.JunredactBtn.hide();var t=editor.doc.getSelection();if(t&&!t.isCollapsed())return void UIUtils.JredactBtn.zbutton("disable");var n=Lock.getLock(t.getStart()+1);if(editor.jeditorPane.find("div.lock-overlay").css({border:""}),J(DocTreeManager.lineAtIndex(t.getStart()).el).find("div.lock-overlay").css({border:"1px solid #808080",opacity:".5"}),n){var i=n.getDocOps();i[1].lock_data.data.redact?(UIUtils.JunredactBtn.show().zbutton("enable"),UIUtils.JredactBtn.hide()):(UIUtils.JredactBtn.show().zbutton("enable"),UIUtils.JunredactBtn.hide())}}},UIUtils.showRedactWarningMsg=function(e){editor.doc.locks&&editor.doc.locks.isLock?MsgDialog.showMessage([J.i18n("writer.common.PROCEED"),J.i18n("writer.common.CANCEL")],CONST.SEVERITY_WARNING,J.i18n("writer.common.WARNING"),J.i18n("writer.common.REDACT_WARNING_TEXT"),null,function(t){switch(t){case CONST.BUTTON_1_CLICKED:e&&e()}}):e&&e()},UIUtils.addGridlinesStyle=function(){var e=document.getElementById("zw-page-gridlines");if(!J("#view-lpnl-gridlines").prop("checked")&&!e){e=document.createElement(NODE_NAME.STYLE),e.id="zw-page-gridlines",e.type="text/css",document.head.appendChild(e);var t=w_usersettings[ATTR_BODY.DS_UN],n=("in"==t?1:20)/4+t;J(e).text(".zw-page-gridlines { background-position: -1px -1px; background-size: "+n+" "+n+"; background-image: linear-gradient(to right, rgba(128, 128, 128, 0.25) 1px, transparent 1px), linear-gradient(to bottom, rgba(128, 128, 128, 0.25) 1px, transparent 1px); display: none; height: 100%; pointer-events: none; position: absolute; width: 100%; z-index: 11; }")}},UIUtils.removeGridlinesStyle=function(){J("#zw-page-gridlines").remove()},PubSub.subscribe("page/created",function(e){J(document.createElement("div")).addClass("zw-page-gridlines").prependTo(e.el)}),PubSub.subscribe("Settings/UnitsChanged",UIUtils.updateGridlinesStyle=function(){UIUtils.removeGridlinesStyle(),UIUtils.addGridlinesStyle()}),PubSub.subscribe(["Gridlines/show","Document/DragStart"],function(){J("#view-lpnl-gridlines").prop("checked")?PubSub.publish("Gridlines/hide"):(UIUtils.addGridlinesStyle(),J(".zw-page-gridlines").show())}),PubSub.subscribe(["Gridlines/hide","Document/DragStop"],function(){J(".zw-page-gridlines").hide()}),UIUtils.getCustomZoomFactor=function(){var e,t=J(window);if("fitPage"==editor.customZoom){var n=editor.doc.getBodyFormat()[ATTR_BODY.DS_PH].convertor().pixels,i=t.height(),o=Z("topband-wrapper").height(),r=Z("bottombar").height(),a=i-o-r-10;e=a/n}else if("fitWidth"==editor.customZoom){var s=t.width()-10,l=editor.doc.getBodyFormat()[ATTR_BODY.DS_PW].convertor().pixels,d=Z(ELEM_ID.REVIEWRIGHTPANE),c=Z(ELEM_ID.PANELCONTAINER);LeftPanel.isContainerVisible(ELEM_ID.PANELCONTAINER)&&(s-=c.width()),d.is(":visible")&&(s-=d.width()),e=s/l}return e&&e!=editor.zoomFactor?100*e:null},UIUtils.getEventWithZoomFactor=function(e){var t=editor.jeditorPane.offset(),n=e.clientX-t.left,i=e.clientY-t.top;return n=t.left+n/editor.zoomFactor,i=t.top+i/editor.zoomFactor,{clientX:n,clientY:i}},UIUtils.openSignupWelcome=function(){var e=Utils.getContextUrl("jsp/popups/writersignupwelcome.jsp");J.ajax({type:"GET",url:e,success:function(e,t,n){var i=document.createElement("div");i.innerHTML=e.trim(),J("body").append(J(i)),UIUtils.preProcessForDialogOpen()},error:function(){}})},UIUtils.openSignupDialog=function(e){var t={},n=editor.doc.getRole();"ANYONEWITHLINK || ANYONELINK_SHAREDREADCOMMENT || ANYONELINK_SHAREDREADWRITE || ANYONELINK_SHAREDREAD"===n?t.docType="anyone":"REMOTEPUBLICUSER"===n&&(t.docType="tryeditor",t.rsid=RemoteEditor.rsid,t.titleText="writer.signup.GET_STARTED_MESSAGE_MSG1",t.descriptionText="writer.signup.GET_STARTED_DESCRIPTION_MSG1",e&&(t.action=e)),zwritersignup.openSignupDialog(t)},UIUtils.closeSignupWelcome=function(){UIUtils.preProcessForDialogClose(),J("#wsignup-welcome-container").remove(),EditorUtil.focusMultiByteSpan()},UIUtils.openTopLinks=function(e){var t={accounts:"/IAMMyAccount",contacts:UIUtils.contactsURL,groups:"/IAMMyAccount#groups/allgroups",publicTemplate:UIUtils.publicTemplatesURL,forum:UIUtils.forumURL,blog:UIUtils.blogURL,reportabuse:UIUtils.reportabuseURL,writerLandingPage:UIUtils.writerLandingPageURL,faq:UIUtils.faqURL,howto:UIUtils.howtoURL,whatsNew:UIUtils.whatsNewURL,signIn:UIUtils.signInURL,fb:UIUtils.fbURL,twitter:UIUtils.twitterURL,linkedin:UIUtils.linkedinURL,iosApp:UIUtils.iosAppURL,macApp:UIUtils.macAppURL,androidApp:UIUtils.androidAppURL,chromeWebApp:UIUtils.chromeWebStoreURL,aboutoffline:UIUtils.aboutofflineURL,developerApi:UIUtils.developerApiURL};t.hasOwnProperty(e)?window.open(t[e]):"shortcut"==e?J.dialogutil.open("shortcut",void 0):"signout"==e&&(window.location.href="/jsp/logout.jsp")},UIUtils.changeView=function(e){var t;if(J.isArray(e))switch(t=e[0]){case"pageview":editor.doc.execCmd("changeView","Page View");break;case"webview":editor.doc.execCmd("changeView","Web View")}},UIUtils.addSynonymsMenu=function(e){var t,n=Z("clipboardOperationsLists").css("display");if(t=Z("none"!=n?"synonymsSubMenuCbList":"synonymsSubMenuCbmart"),t.zmenu("removeAllMenuItems"),e){var i=e.length;if(0==i)t.zmenu("addMenuItem",{label:J.i18n("writer.proofing.NO_SUGGESTIONS"),disabled:"true"});else for(var o=0;o<i;o++){var r={},a=e[o];r.style="width: 100%;",r.label=a,r.data="{'appData': { 'action' : 'Thesaurus.replaceWord', 'params':'"+a+"'  } }",t.zmenu("addMenuItem",r)}t.zmenu("addMenuItem",{mtype:"separator",class:"ui-zmenu-item ui-zmenu-separator"}),t.zmenu("addMenuItem",{style:"width:100%",label:J.i18n("writer.proofing.THESAURUS"),data:"{'appData':{'action':'Thesaurus.insertThDlgFromRc'}}"})}else t.zmenu("addMenuItem",{label:J.i18n("writer.common.LOADING"),disabled:"true"})},UIUtils.showSynonyms=function(){var e=editor.doc.getSelection().getWord(),t=e.getStart(),n=e.getEnd(),i=editor.doc.getContent(t,n);UIUtils.addSynonymsMenu(Thesaurus.getCachedThesaurusWords(i.toLowerCase())),Utils.addToStatistics("rc_synonyms")},UIUtils.dataURItoBlob=function(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],i=new Uint8Array(t.length),o=0;o<t.length;o++)i[o]=t.charCodeAt(o);return{imageFile:new Blob([i],{type:n}),type:n}},UIUtils.convertHTMLToBlob=function(e,t){html2canvas(e,{useCORS:!0,allowTaint:!1,letterRendering:!0,onpreloaded:function(){t.onpreloaded&&t.onpreloaded(this)},onparsed:function(){t.onparsed&&t.onparsed(this)},onrendered:function(e){var n=e.toDataURL("image/png"),i=UIUtils.dataURItoBlob(n);t.success(i)}})},MsgDialog=function(){"use strict";var e=null,t=null,n=null,i=null,o=function(){e()},r=function(){t()},a=function(){n()},s=function(o,r,a,s,l,d,c){var u=null,p=null,h=null;U.isArray(o)?(u=o[0],p=o[1],h=o[2]):o==CONST.MSG_TYPE_RELOAD?u=J.i18n("writer.common.RELOAD"):o==CONST.MSG_TYPE_RELOADCANCEL?(u=J.i18n("writer.common.RELOAD"),p=J.i18n("writer.common.CANCEL")):o==CONST.MSG_TYPE_CONFIRM?(u=J.i18n("writer.common.OK"),p=J.i18n("writer.common.CANCEL")):o==CONST.MSG_TYPE_YESNO?(u=J.i18n("writer.common.YES"),p=J.i18n("writer.common.NO")):o==CONST.MSG_TYPE_ALERT&&(u=J.i18n("writer.common.OK")),d?(e=function(){o==CONST.MSG_TYPE_RELOAD?document.location.reload():d(CONST.BUTTON_1_CLICKED),J("#msgdlgzdialog").dialog("close")},t=function(){d(CONST.BUTTON_2_CLICKED),J("#msgdlgzdialog").dialog("close")},n=function(){d(CONST.BUTTON_3_CLICKED),J("#msgdlgzdialog").dialog("close")},i=function(){d(CONST.BUTTON_3_CLICKED),J("#msgdlgzdialog").dialog("close")}):c?(i=function(){J("#msgdlgzdialog").dialog("close")},e=function(){i(),c(CONST.BUTTON_1_CLICKED)},t=function(){i(),c(CONST.BUTTON_2_CLICKED)},n=function(){i(),c(CONST.BUTTON_3_CLICKED)}):e=t=n=function(){J("#msgdlgzdialog").dialog("close")};var f={init:function(){var e=J("#messagedialog"),t=J("#messagedlgbtn_1"),n=J("#messagedlgbtn_2"),i=J("#messagedlgbtn_3");if(r&&"info"!=r&&e.find(".ui-wdialog-info").addClass("ui-wdialog-"+r),null!=h&&J(".ui-wdialog").addClass("ui-wdialog-extn"),u?t.button("option","label",u):t.remove(),p?n.button("option","label",p):n.remove(),h?i.button("option","label",h):i.remove(),e.find(".ui-msg-content").html(s),e.find(".ui-wdialog-title").text(a),l)return void l()}};J.dialogutil.open("msgdlg",null,f)};return{showMessage:s,execCallback_1:o,execCallback_2:r,execCallback_3:a}}();var LayoutManager=function(){"use strict";var e="",t=!1,n=function(){return e},i=function(t){e=t},o=function(){return editor.isFinalDocument()?LAYOUTS.COMPLETE:ModeManager.getCurrentMode()},r=function(){return LAYOUTS.READCOMMENT},a=function(){return LAYOUTS.READONLY},s=function(){return LAYOUTS.REMOTE},l=function(){return LAYOUTS.USERTEMPLATE},d=function(){return LAYOUTS.COMPOSE},c=function(){var e=editor.doc.getRole();return u[e]()},u={OWNER:o,SHAREDREAD:a,SHAREDREADCOMMENT:r,COOWNER:o,SHAREDREADWRITE:o,ANYONELINK_SHAREDREADCOMMENT:r,ANYONELINK_SHAREDREADWRITE:o,EXTERNAL_SHAREDREADWRITE:o,TEMPLATE_USER:l,REMOTEVIEW:a,REMOTEEDIT:s,REMOTECOLLABVIEW:a,REMOTECOLLABEDIT:s,STOREAGE_SERVICE_WRITER:o,STOREAGE_SERVICE_READER:a,REMOTEPUBLICUSER:s,WORKSPACE_CRMLIB_EDITOR:o,OFFLINE:o,MAILMERGE_LIBRARY:d,CRM_VERTICAL_MAILMERGE_LIBRARY:d,ZFORMS_TEMPLATE:d},p=function(){Replace.closeFindMenu()},h={};h[LAYOUTS.COMPOSE]={open:function(){TopbandHandler.showTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),editor.onResize(),PubSub.publish("Document/ModeOpened",LAYOUTS.COMPOSE)},close:function(){p(),PubSub.publish("Document/ModeClosed",LAYOUTS.COMPOSE)},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=0,n=window.innerHeight-e-Utils.getBottombarHeight(),i=window.innerWidth;return{marginTop:e+"px",marginLeft:t+"px",width:i+"px",height:n+"px"}},getToolbar:function(){return null}},h[LAYOUTS.COLLABORATE]={open:function(){UIUtils.initComponent("review-tb"),UIUtils.initComponent("editor-rightPanel"),b(ELEM_ID.REVIEWTOOLBARCONTAINER),editor.isEditable()&&(EditorLayout.showRightPanel(),editor.onResize(),TcPane.drawRightPane(TCConstants.ALL_FILTER),TcPane.subscribe(),TrackChangeUI.handleReviewModeOpen(),ReviewUtil.switchTab("comments"),PubSub.publish("Document/ModeOpened",LAYOUTS.COLLABORATE))},close:function(){p(),TopbandHandler.hideToolbarHideBtn(),TopbandHandler.hideToolbar(ELEM_ID.REVIEWTOOLBARCONTAINER),EditorLayout.hideRightPanel(),TcPane.unsubscribe(),TrackChangeUI.handleReviewModeClose(),editor.onResize(),PubSub.publish("Document/ModeClosed",LAYOUTS.COLLABORATE)},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=0,n=window.innerHeight-e-Utils.getBottombarHeight(),i=window.innerWidth,o=Z(ELEM_ID.EDITORRIGHTPANEL);return o&&o.is(":visible")&&!EditorLayout.isEnoughGapToFitRightPanelIn(i)&&(i-=o.outerWidth()),{marginTop:e+"px",marginLeft:t+"px",width:i+"px",height:n+"px"}},getToolbar:function(){return ELEM_ID.REVIEWTOOLBARCONTAINER}},h[LAYOUTS.COMPLETE]={open:function(){UIUtils.initComponent("complete-tb"),b(ELEM_ID.FINISHMODETOOLBARCONTAINER),editor.onResize(),PubSub.publish("Document/ModeOpened",LAYOUTS.COMPLETE)},close:function(){p(),TopbandHandler.hideToolbarHideBtn(),TopbandHandler.hideToolbar(ELEM_ID.FINISHMODETOOLBARCONTAINER),editor.onResize(),PubSub.publish("Document/ModeClosed",LAYOUTS.COMPLETE)},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=0,n=window.innerHeight-e-Utils.getBottombarHeight(),i=window.innerWidth;return{marginTop:e+"px",marginLeft:t+"px",width:i+"px",height:n+"px"}},getToolbar:function(){return ELEM_ID.FINISHMODETOOLBARCONTAINER}},h[LAYOUTS.RICHEDIT]={open:function(e){T(!0);TopbandHandler.getBandHeight();Z(ELEM_ID.SUBPANELCONTAINER)[0].style.marginTop="0px",Z(ELEM_ID.PANELCONTAINER)[0].style.marginTop=Z(ELEM_ID.TOPBANDCONTAINER)[0].offsetTop+Z(ELEM_ID.TOPBANDCONTAINER)[0].offsetHeight+"px",LeftPanel.showPanelContainer(ANIMATIONS.SLIDEIN,e||ELEM_ID.FORMATPANEL),editor.onResize(),PubSub.publish("Document/RichEditLayoutOpened");var t=LeftPanel.getPanelWidth(),n={width:window.innerWidth-t+"px"};EditorLayout.updateElemCSS(ELEM_ID.TOOLBARCONTAINER,n)},close:function(){T(!1),LeftPanel.hidePanelContainer(ANIMATIONS.SLIDEOUT),p(),editor.onResize(),PubSub.publish("Document/RichEditLayoutClosed");var e={width:window.innerWidth+"px"};EditorLayout.updateElemCSS(ELEM_ID.TOOLBARCONTAINER,e)},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=LeftPanel.getPanelWidth(),n=window.innerHeight-e-Utils.getBottombarHeight(),i=window.innerWidth-t,o=Z(ELEM_ID.EDITORRIGHTPANEL);return o&&o.is(":visible")&&!EditorLayout.isEnoughGapToFitRightPanelIn(i)&&(i-=o.outerWidth()),{marginTop:e+"px",marginLeft:t+"px",width:i+"px",height:n+"px"}}},h[LAYOUTS.VERSIONVIEW]={open:function(){UIUtils.initComponent("toolbar-versionview"),J("#bottomband-container").hide(),J("topband-hamburger").hide(),Z("topband-hamburger").hide(),Z("topband-file-container").hide(),Z("topband-savestatus").hide(),Z("ui-docnotification").hide(),Z("topband-modes").hide(),Z("topband-share-owner").hide(),Z("topband-shared-label").hide(),Z("topband-spotlightsearch").hide(),Z("topband-settings").hide(),Z("sinceLastVisitLink").hide(),Z("topband-versionview-doclink").show(),TopbandHandler.showToolbar(ELEM_ID.VERSIONVIEWTOOLBARCONTAINER),UIUtils.hideWrappers(!0),UIUtils.hideControllers(),Z("wmstoolbar").addClass("ui-no-display-imp"),editor.clientActiveSection=J("div.zw-contentpane")[0],EventHandler.toggleSection(),DocumentMap.togglePane(),TableVisualCueHandler.close(),editor.onResize()},close:function(){J("#bottomband-container").show(),J("#topband-hamburger").show(),p(),TopbandHandler.hideTopband(ELEM_ID.VERSIONVIEWTOPBANDCONTAINER),TopbandHandler.showTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),UIUtils.hideWrappers(!1),Z("wmstoolbar").removeClass("ui-no-display-important"),TopbandHandler.hideToolbar(ELEM_ID.VERSIONVIEWTOOLBARCONTAINER),editor.onResize(),DocumentMap.togglePane()},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=window.innerHeight-e-Utils.getBottombarHeight(),n=window.innerWidth;return{marginTop:e+"px",width:n+"px",height:t+"px"}},getToolbar:function(){return ELEM_ID.VERSIONVIEWTOOLBARCONTAINER}},h[LAYOUTS.VERSIONHISTORY]={open:function(){J("#bottomband-container").hide(),J("#topband-hamburger").hide(),TopbandHandler.hideTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),TopbandHandler.showTopband(ELEM_ID.HISTORYTOPBANDCONTAINER),UIUtils.hideWrappers(!0),UIUtils.hideControllers(),Z("wmstoolbar").addClass("ui-no-display-important"),TopbandHandler.showToolbar(ELEM_ID.VERSIONHISTORYCONTAINER),editor.clientActiveSection=J("div.zw-contentpane")[0],EventHandler.toggleSection(),PopupHandler.forceClosePopup("smartToolbar"),DocumentMap.togglePane(),TableVisualCueHandler.close(),editor.onResize()},close:function(){J("#bottomband-container").show(),J("#topband-hamburger").show(),p(),TopbandHandler.hideTopband(ELEM_ID.HISTORYTOPBANDCONTAINER),TopbandHandler.showTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),UIUtils.hideWrappers(!1),Z("wmstoolbar").removeClass("ui-no-display-important"),TopbandHandler.hideToolbar(ELEM_ID.VERSIONHISTORYCONTAINER),editor.onResize(),DocumentMap.togglePane()},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=Z(ELEM_ID.VERSIONHISTORYCONTAINER).width(),n=window.innerHeight-e-Utils.getBottombarHeight(),i=window.innerWidth-t;return{marginTop:e+"px",width:i+"px",height:n+"px"}},getToolbar:function(){return null}},h[LAYOUTS.HISTORYDIFFVIEW]={open:function(){J("#bottomband-container").hide(),J("#topband-hamburger").hide(),TopbandHandler.hideTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),TopbandHandler.showTopband(ELEM_ID.HISTORYDIFFTOPBANDCONTAINER),UIUtils.hideWrappers(!0),UIUtils.hideControllers(),Z("wmstoolbar").addClass("ui-no-display-important"),editor.clientActiveSection=J("div.zw-contentpane")[0],EventHandler.toggleSection(),PopupHandler.forceClosePopup("smartToolbar"),DocumentMap.togglePane(),TableVisualCueHandler.close(),editor.onResize()},close:function(){J("#bottomband-container").show(),J("#topband-hamburger").show(),p(),TopbandHandler.hideTopband(ELEM_ID.HISTORYDIFFTOPBANDCONTAINER),TopbandHandler.showTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),UIUtils.hideWrappers(!1),Z("wmstoolbar").removeClass("ui-no-display-important"),editor.onResize(),DocumentMap.togglePane()},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=window.innerHeight-e-Utils.getBottombarHeight(),n=window.innerWidth;return{marginTop:e+"px",width:n+"px",height:t+"px"}},getToolbar:function(){return null}},h[LAYOUTS.MAILMERGEPREVIEW]={open:function(){J("#bottomband-container").hide(),J("#topband-hamburger").hide(),TopbandHandler.hideTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),TopbandHandler.showTopband(ELEM_ID.MAILMERGETOPBANDCONTAINER),TopbandHandler.showToolbar(ELEM_ID.MMPREVIEWCONTAINER),editor.onResize(),J("#microandparaVCContainer").hide(),editor.browserInfo.is_firefox&&J("#mailmergeprint").hide(),UIUtils.hidePasteToolbar(),DocumentMap.togglePane(),TableVisualCueHandler.close(),UIUtils.disableDocumentShortcuts()},close:function(){J("#bottomband-container").show(),J("#topband-hamburger").show(),p(),TopbandHandler.hideTopband(ELEM_ID.MAILMERGETOPBANDCONTAINER),TopbandHandler.showTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),TopbandHandler.hideToolbar(ELEM_ID.MMPREVIEWCONTAINER),editor.onResize(),J("#microandparaVCContainer").show(),editor.browserInfo.is_firefox&&J("#mailmergeprint").show(),DocumentMap.togglePane(),TableVisualCueHandler.close(),UIUtils.enableDocumentShortcuts()},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=J(".ui-mmlist-container")[0].offsetWidth,n=window.innerHeight-e-Utils.getBottombarHeight(),i=window.innerWidth-t;return{marginTop:e+"px",width:i+"px",height:n+"px"}},getToolbar:function(){return ELEM_ID.MMPREVIEWCONTAINER}},h[LAYOUTS.READONLY]={open:function(){var e=editor.doc.getRole();"SHAREDREAD"==e?(TopbandHandler.showToolbar(ELEM_ID.READONLYTOOLBARCONTAINER),Z("topband-hamburger").disable()):"REMOTEVIEW"==e&&("undefined"!=typeof RemoteEditor&&RemoteEditor.options.pview?(TopbandHandler.hideTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),J("#microandparaVCContainer,#topband-wrapper,#bbar-reader").remove()):J("#topband-savetofolder").addClass("ui-remotecase-filename")),editor.onResize()},close:function(){"SHAREDREAD"==editor.doc.getRole()&&TopbandHandler.hideToolbar(ELEM_ID.READONLYTOOLBARCONTAINER)},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=0,n=window.innerHeight-e-Utils.getBottombarHeight(),i=window.innerWidth;return{marginTop:e+"px",marginLeft:t+"px",width:i+"px",height:n+"px"}},getToolbar:function(){return ELEM_ID.READONLYTOOLBARCONTAINER}},h[LAYOUTS.READCOMMENT]={open:function(){TopbandHandler.showToolbar(ELEM_ID.READCOMMENTTOOLBARCONTAINER),EditorLayout.showRightPanel(),editor.onResize(),Z("topband-hamburger").disable()},close:function(){TopbandHandler.hideToolbar(ELEM_ID.READCOMMENTTOOLBARCONTAINER),EditorLayout.hideRightPanel(),editor.onResize()},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=0,n=window.innerHeight-e-Utils.getBottombarHeight(),i=window.innerWidth,o=Z(ELEM_ID.EDITORRIGHTPANEL);return o&&o.is(":visible")&&!EditorLayout.isEnoughGapToFitRightPanelIn(i)&&(i-=o.outerWidth()),{marginTop:e+"px",marginLeft:t+"px",width:i+"px",height:n+"px"}},getToolbar:function(){return ELEM_ID.READCOMMENTTOOLBARCONTAINER}},h[LAYOUTS.REMOTE]={open:function(){TopbandHandler.showTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER);var e=editor.doc.getRole();"REMOTEPUBLICUSER"==e&&LayoutManager.toggleRichEdit("open"),editor.onResize(),PubSub.publish("Document/ModeOpened",LAYOUTS.REMOTE)},close:function(){p(),PubSub.publish("Document/ModeClosed",LAYOUTS.REMOTE)},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=0,n=window.innerHeight-e-Utils.getBottombarHeight(),i=window.innerWidth;return{marginTop:e+"px",marginLeft:t+"px",width:i+"px",height:n+"px"}},getToolbar:function(){return null}},h[LAYOUTS.USERTEMPLATE]={open:function(){TopbandHandler.showTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),editor.onResize(),PubSub.publish("Document/ModeOpened",LAYOUTS.REMOTE)},close:function(){p(),PubSub.publish("Document/ModeClosed",LAYOUTS.REMOTE)},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=0,n=window.innerHeight-e-Utils.getBottombarHeight(),i=window.innerWidth;return{marginTop:e+"px",marginLeft:t+"px",width:i+"px",height:n+"px"}},getToolbar:function(){return null}},h[LAYOUTS.PRINTPREVIEW]={open:function(){TopbandHandler.showToolbar(ELEM_ID.PREVIEWTOOLBARCONTAINER),TopbandHandler.hideTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),TopbandHandler.showTopband(ELEM_ID.PRINTPREVIEWTOPBANDCONTAINER)},close:function(){p(),TopbandHandler.hideToolbar(ELEM_ID.PREVIEWTOOLBARCONTAINER),TopbandHandler.hideTopband(ELEM_ID.PRINTPREVIEWTOPBANDCONTAINER),TopbandHandler.showTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER)},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=0,n=window.innerHeight-e-Utils.getBottombarHeight(),i=window.innerWidth;return{marginTop:e+"px",marginLeft:t+"px",width:i+"px",height:n+"px"}},getToolbar:function(){return ELEM_ID.PREVIEWTOOLBARCONTAINER}};var f=function(e){_()&&LayoutManager.toggleRichEdit("close");var t=n();t&&m(t,"close"),i(e),m(e,"open"),PubSub.publish("Document/LayoutChanged",t,e)},m=function(e,t){h[e][t]()},g=function(e,t){e=_()?"close":"open",h[LAYOUTS.RICHEDIT][e](t)},T=function(e){t=e},_=function(){return t},E=function(){var e={},t=n();return e=t?h[t].getLayoutProps():{marginTop:"44px",marginLeft:"0px",width:window.innerWidth+"px",height:window.innerHeight+"px"}},v=function(e){return h[e].getLayoutProps()},S=function(){var e=n();return h[e].getToolbar()},b=function(e){var t=TopbandHandler.getToolbarState(e);t||TopbandHandler.showToolbar(e),TopbandHandler.showToolbarHideBtn(),TopbandHandler.updateHideBtnState(t)};return{loadLayout:f,getLayoutType:c,getLayoutProps:v,toggleRichEdit:g,isRichEditActive:_,getCurrentLayout:n,getCurrentLayoutProps:E,getCurrentToolbar:S}}(),EditorLayout=function(){"use strict";var e=function(){Z(ELEM_ID.MAINOUTERDIV).bind(TransitionEndEvent,function(e){e.target.id==ELEM_ID.MAINOUTERDIV?(editor.onResize(),EditorUtil.focusMultiByteSpan()):e.target.id==ELEM_ID.EDITORPANECONTAINER&&(editor.onResize(),EditorUtil.focusMultiByteSpan(),CurUtil.blinkCursor())})},t=function(e,t){if(!e||!t){var n=editor.doc.createElement(NODE_TYPE.BODY);e||(e=n.attr(ATTR_BODY.DS_PS)),t||(t=n.attr(ATTR_BODY.DS_OR))}var i=PageLayout.Paper[e];return i[t].width.pixel},n=function(e){e||(e=editor.doc.getPaperWidth(!0)),editor.jeditorPane[0].style.width=e+"px";var t=Z(ELEM_ID.REVIEWRIGHTPANE),n=e*editor.zoomFactor;if(t&&t.is(":visible")&&EditorLayout.isEnoughGapToFitRightPanelIn(Z(ELEM_ID.EDITOROUTERDIV).outerWidth())){var o=Z(ELEM_ID.REVIEWRIGHTPANE).outerWidth();n+=o}i(n),editor.widthVariant=(Z(ELEM_ID.EDITOROUTERDIV)[0].offsetWidth-n)/2,editor.widthVariant=editor.widthVariant>0?editor.widthVariant:0,r(ELEM_ID.EDITORPANECONTAINER,{width:n+"px",left:editor.widthVariant+"px"}),d(),PubSub.publish("UiEvents/EditorParentOffsetChanged")},i=function(e){r(ELEM_ID.EDITORPANEWRAPPER,{width:e+"px"})},o=function(){var e;e=LayoutManager.isRichEditActive()?LayoutManager.getLayoutProps(LAYOUTS.RICHEDIT):LayoutManager.getCurrentLayoutProps(),EditorLayout.updateElemCSS(ELEM_ID.MAINOUTERDIV,e),Z("bottombar").css({width:window.innerWidth-parseFloat(e.marginLeft)}),n()},r=function(e,t){var n=Z(e)[0];if(n)for(var i in t)n.style[i]=t[i]},a=function(){var e=TopbandHandler.getBandHeight();return e},s=function(){Z(ELEM_ID.EDITORRIGHTPANEL)[0].style.display="block",PubSub.publish("Layout/RightPanelOpened")},l=function(){Z(ELEM_ID.EDITORRIGHTPANEL)[0].style.display="none",PubSub.publish("Layout/RightPanelClosed")},d=function(){var e=Z(ELEM_ID.EDITORRIGHTPANEL);if(e.is(":visible")){var t=a();if(EditorLayout.isEnoughGapToFitRightPanelIn(Z(ELEM_ID.EDITOROUTERDIV).outerWidth())){var n=2,i=editor.widthVariant+n;e.css({right:i,top:t})}else e.css({right:"0px",top:t})}},c=function(e){var t=editor.jeditorPane.outerWidth()*editor.zoomFactor+Z(ELEM_ID.EDITORRIGHTPANEL).outerWidth();return e>=t};return{init:e,getPageWidth:t,updateElemCSS:r,updateEditorParentOffset:n,updateMainOuterDivProps:o,updateEditorWidth:i,showRightPanel:s,hideRightPanel:l,isEnoughGapToFitRightPanelIn:c}}();CommonError.prototype={errorMsg:"",title:"",type:"error",openCommonErrorPopup:function(e,t,n,i,o,r,a,s,l){return CommonError.errorMsg="",CommonError.isConfirm=!1,CommonError.isError=!1,CommonError.callback=void 0,CommonError.type="",CommonError.title="",CommonError.buttonsLabel=l,CommonError.callBackForCancel=void 0,a&&(CommonError.fromMsg=a),CommonError.errorMsg=e,!!e&&(t&&(CommonError.title=t),n&&(CommonError.type=n),i&&(CommonError.callback=i),s&&(CommonError.callBackForCancel=s),o&&(CommonError.isError=!0),r&&(CommonError.isConfirm=!0),void(e.toLowerCase().indexOf("cut")!=-1?J.dialogutil.open("commonerrorcut",void 0,this.info):e.toLowerCase().indexOf("copy")!=-1?J.dialogutil.open("commonerrorcpy",void 0,this.info):e.toLowerCase().indexOf("paste")!=-1?J.dialogutil.open("commonerrorpste",void 0,this.info):e.toLowerCase().indexOf("unsupported")!=-1?J.dialogutil.open("importError",void 0,this.info):J.dialogutil.open("commonerror",void 0,this.info)))},openBuildChangePopup:function(e){var t=e||{},n=[J.i18n("writer.common.RELOAD")],i=editorProps.deployment.zohowriter;t.force||n.push(J.i18n("writer.common.CANCEL")),MsgDialog.showMessage(n,CONST.SEVERITY_WARNING,J.i18n("writer.common.SERVERUPDATE",[i]),J.i18n("writer.common.STATIC_RELOAD_MSG",[i]),null,function(e){switch(e){case CONST.BUTTON_1_CLICKED:location.reload()}})},reloadTimer:function(e){var t=15,n=setInterval(function(){J("#notifyDiv").find("#"+e).html(t),t<=1&&(CommonError.callback(),clearInterval(n)),t--},1e3)},importErrorCallback:function(){CommonError.callback&&(editor.setEditable(!0),CommonError.callback()),J.dialogutil.close("importError"),J("#importbrowse").click()},execCallback:function(){CommonError.callback&&(editor.setEditable(!0),CommonError.callback()),J.dialogutil.close("commonerror"),J.dialogutil.close("commonerrorcut"),J.dialogutil.close("commonerrorcpy"),J.dialogutil.close("commonerrorpste")},info:{init:function(){var e=J("#commonerror_cancel"),t=J("#commonerror_ok"),n=J("#commonerror_reload");e.hide(),n.hide(),t.hide(),CommonError.title||(CommonError.title=J.i18n("writer.common.ERROR"));var i=J("#notifyDiv"),o=(J("#notifySpan"),i.find(".ui-wdialog-info")),r=i.find(".ui-wdialog-title");r.html(CommonError.title),"error"==CommonError.type?o.addClass("ui-wdialog-alert"):o.addClass("ui-wdialog-"+CommonError.type),CommonError.isConfirm&&e.show(),CommonError.isError?n.show():t.show(),CommonError.buttonsLabel?2===CommonError.buttonsLabel.length?(t.button("option","label",CommonError.buttonsLabel[0]),e.button("option","label",CommonError.buttonsLabel[1])):3===CommonError.buttonsLabel.length&&(t.button("option","label",CommonError.buttonsLabel[0]),e.button("option","label",CommonError.buttonsLabel[1]),n.button("option","label",CommonError.buttonsLabel[2])):(t.button("option","label",J.i18n("writer.common.OK")),e.button("option","label",J.i18n("writer.common.CANCEL"))),CommonError.callBackForCancel?J("#commonerror_cancel").unbind("click").bind({click:function(){CommonError.callBackForCancel(),J("#commonerrorzdialog").dialog("close")}}):J("#commonerror_cancel").unbind("click").bind({click:function(){J("#commonerrorzdialog").dialog("close")}}),CommonError.type="error",CommonError.title=J.i18n("writer.common.ERROR")},get:function(e){if("error"==e){var t=J("#notifyDiv"),n=t.find(".ui-wdialog-title"),i=t.find(".ui-werrror-content");if(CommonError.fromMsg&&"read"==CommonError.fromMsg)return n.html(J.i18n("common","PERMISSIONCHANGED")),i.text(CommonError.errorMsg),void J("#commonerror_ok").button("option","label","Reload with unsaved changes");if(CommonError.fromMsg&&"write"==CommonError.fromMsg)return n.html(J.i18n("common","PERMISSIONCHANGED")),i.text(CommonError.errorMsg),void J("#commonerror_ok").button("option","label",J.i18n("writer.common.CLOSE"));if(CommonError.fromMsg&&"import"==CommonError.fromMsg)return;return CommonError.fromMsg&&"access"==CommonError.fromMsg?(n.html(J.i18n("common","ACCESS")),i.text(CommonError.errorMsg+J.i18n("common","AUTOMATICALLY_CLOSE")),i.append("<span id='reLoadTimer'>15</span>"),i.append("&nbsp;<span>"+J.i18n("common","SECONDS")+"</span>"),t.find(".ui-wdialog-info").addClass("ui-wdialog-alert"),J("#commonerror_ok").button("option","label",J.i18n("writer.common.CLOSE")),void CommonError.reloadTimer("reLoadTimer")):(CommonError.fromMsg&&"trash"==CommonError.fromMsg?(J("#commonerror_ok").button("option","label",J.i18n("components.zimport.yes.label")),J("#commonerror_cancel").button("option","label",J.i18n("components.zimport.no.label"))):CommonError.fromMsg&&"trashnormal"==CommonError.fromMsg&&(J("#commonerror_ok").button("option","label",J.i18n("components.zimport.yes.label")),J("#commonerror_cancel").button("option","label",J.i18n("components.zimport.no.label")),i.text(CommonError.errorMsg)),CommonError.errorMsg)}},set:function(e,t,n){}}};var CommonError=new CommonError,RestoreResourceId;RestoreDocumentProperVersion.init=function(e){e&&(RestoreResourceId=e),UIUtils.openDialog("restoredocument")},RestoreDocumentProperVersion.restoreToNextProperVersion=function(e,t){UIUtils.closeDialog("restoredocument");var n={};e||(e=RestoreResourceId),e=e?e:editor.doc.getDocInfo().RID,n.rid=e,RestoreDocumentProperVersion.lastRestoreVersion&&(n.lastRestoreVersion=RestoreDocumentProperVersion.lastRestoreVersion,n.overWrite="true"),n.sid=editor.uuid,n.tstamp=(new Date).getTime(),Utils.setCsrfParam(n);var i=Utils.getUrl("restore");J.ajax({type:"POST",global:!1,dataType:"json",url:i,data:n,success:function(e){"FAILED"==e.RESPONSE?UIUtils.showMessagePopup(J.i18n("common","UNABLE_TO_LOAD_VERSION"),J.i18n("error","OOPS"),"error",function(){var e=editor.getBaseURL()+"/ropen.do";window.open(e,"_self")}):RestoreDocumentProperVersion.lastRestoreVersion=e.RESTORE_VERSION},error:function(e,t,n){0==e.status?UIUtils.showNetworkError():UIUtils.showMessagePopup(J.i18n("common","UNABLE_TO_LOAD_VERSION"),J.i18n("error","OOPS"),"error",function(){var e=editor.getBaseURL()+"/ropen.do";window.open(e,"_self")})}}),UIUtils.hideLoadingMsg()};var Dates=function(){"use strict";var e=!1,t=J(document.getElementById("inlineDatemenu")),n=function(){PopupHandler.addPopup("inlineDatemenu",{open:o,close:r,beforeOpen:function(){},popupTimer:null}),editor.jeditorPane.on("click",".autodate",function(e){J(e.target).closestParent(".header_primary.unselectableSection,.footer_primary.unselectableSection,.zw-contentpane.unselectableSection,.zw-endnotepane.unselectableSection,.zw-footnotepane.unselectableSection")[0]||(J(this).addClass("ui-auto-date-selected"),PopupHandler.openPopup("inlineDatemenu"))}),t.find("#datepicker").datepicker({onSelect:function(n,o){var r=J("#dateSelect").val(),a=new Date(n).getTime();J("#dateCheckBx").prop("checked",!1),e=!1,i(a,r),p(),t.find("#datePickerContainer,#datepicker").show()},changeMonth:!0,yearRange:"-300:+300",changeYear:!0}),t.find("#dateCheckBx").change(function(){e=this.checked;var n=editor.doc.getRawFormatAt(editor.doc.getSelection().getStart());n&&"autofield"==n.type&&i(n.val,n.datefmt),p(),t.find("#datePickerContainer,#datepicker").datepicker("setDate",null)})},i=function(t,n){var i=editor.doc.getSelection().getStart(),o=editor.doc.getRawFormatAt(i);o[ATTR_AUTOFIELD.ISAUTO]=e?1:0,o.val=e||!t?(new Date).getTime():t,o.datefmt=n,Utils.updateAutoField([i,o]),J(editor.clientActiveSection).find('div.field_text_node[data-fieldinfo="'+o.id+'"]').parent().addClass("ui-auto-date-selected")},o=function(){if(!editor.doc.getSelection().isCollapsed()||!editor.isEditable())return!1;var e=a();return t.css({display:"block",top:e.top,left:e.left}).focus(),l(),p(),t.find("#datePickerContainer,#datepicker").datepicker("setDate",null).hide(),!0},r=function(){t.hide(),J("span.autodate").removeClass("ui-auto-date-selected")},a=function(){var e=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start"),t=s(e);return t.top+=t.height,t},s=function(e){var t=editor.jeditorPane.offset(),n=e.offset(),i=e.height(),o=n.left-t.left,r=n.top-t.top;return{left:o,top:r,height:i}},l=function(){var e=editor.doc.getRawFormatAt(editor.doc.getSelection().getStart());e&&(t.find("#dateSelect").zcombo("setValue",e.datefmt).end().find("#dateCheckBx").prop("checked",!!e.isauto),J(editor.clientActiveSection).find('div.field_text_node[data-fieldinfo="'+e.id+'"]').parent().addClass("ui-auto-date-selected"))},d=function(){UIUtils.initComponent("inlineDatemenu");var t=editorProps.userInfo.settings.autoDateFmt||J("#dateSelect").val()||"M/d/yy",n=(new Date).getTime();return editor.doc.execCmd("autofield",["autodate",n,t,e]),!1},c=function(){var t="h:mm am/pm",n=(new Date).getTime();return editor.doc.execCmd("autofield",["autodate",n,t,e]),!1},u=function(e){var t=J("#dateSelect").val(),n=editor.doc.getRawFormatAt(editor.doc.getSelection().getStart()),o=n&&n.val;i(o,t),p()},p=function(e){J("#dateSelect,#timeSelect,#dateTimeSelect").zcombo("removeAllOptions");var n=["M/d/yy","MMM. d, yy","MMMM d, yyyy","d MMMM, yyyy","dd/MM/yyyy","dd.MM.yyyy","dddd, MMMM d, y","yyyy/MM/dd","yyyy-MM-dd","h:mm am/pm","h:mm:ss am/pm","d/M/yyyy HH:mm:ss"];e=e?e:editor.doc.getRawFormatAt(editor.doc.getSelection().getStart());for(var i=e.isauto?(new Date).getTime():new Date(e.val),o=0;o<n.length;o++){var r={label:moment(i).format(Utils.getMomentFmt(n[o])),value:n[o]};t.find("#dateSelect").zcombo("addOption",r)}if(t.find("#dateSelect").zcombo("setValue",e.datefmt),"REMOTE"!=editor.getEditorType()&&"ANYONEWITHLINK"!=editor.getEditorType()){var a=t.find("#setAsDefaultFmt");e.datefmt==editorProps.userInfo.settings.autoDateFmt?a.hide():a.show()}},h=function(){var e=editor.doc.getSelection().getStart(),t=editor.doc.getRawFormatAt(e),n=t.datefmt,i={};Settings.DateFmt=n,i[ATTR_BODY.DS_AUTODATEFORMAT]=n,Settings.updateUserSettings(i),Utils.setCsrfParam(i),J.post(Utils.getNiceUrlPrefix("user/settings/options"),i),J("#setAsDefaultFmt").hide()},f=function(){var e=editor.doc.getSelection().getStart(),t=editor.doc.getRawFormatAt(e),n=editor.doc.createElement(NODE_TYPE.AUTOFIELD,{});n.setStart(1),n.setEnd(editor.doc.contStr.length),n.updateAllFileds("autodate",t),Op.sendMsg()};return{bindevents:n,changeOptions:u,insertCurrentDate:d,insertCurrentTime:c,updateDefaultDateFmt:h,updateAllDateFields:f}}(),NavigatorModel=Backbone.Model.extend({defaults:{items:[],currentIdx:-1},initialize:function(){this.listenTo(this,"change:items",function(){this.set("currentIdx",-1)})}}),NavigatorView=Backbone.View.extend({tagName:"div",template:"#navigator-view",events:{"click #nav-prev":"prev","click #nav-next":"next"},initialize:function(e){this.template=e.template||this.template,this.template=Handlebars.compile(jQuery(this.template).html()),this.focusCallback=e.onFocus,this.listenTo(this.model,"change:currentIdx",this.focus)},prev:function(e){var t=this.model.get("currentIdx");t<=0?this.model.set("currentIdx",this.model.get("items").length-1,{focus:!0}):this.model.set("currentIdx",t-1,{focus:!0})},next:function(e){var t=this.model.get("currentIdx");t>=this.model.get("items").length-1?this.model.set("currentIdx",0,{focus:!0}):this.model.set("currentIdx",t+1,{focus:!0})},focus:function(e,t,n){if(n&&n.focus){var i=e.get("items")[t];i&&this.focusCallback&&this.focusCallback(i)}this.render()},render:function(){var e=this.model.get("items").length,t=this.model.get("currentIdx"),n=this.template({total:e,currentIdx:t+1});return this.$el.html(n),this.delegateEvents(),this}}),RemoteDiff=function(){var e=function(e){var t=HistoryDiffUI.getChanges(e),n=new NavigatorModel;n.set("items",t);var i=new NavigatorView({model:n,onFocus:HistoryDiffUI.focusDiff});J("#diff-nav-container").html(i.render().$el).show(),HistoryDiffUI.showBulletins(t)},t=function(){if(RemoteEditor.options.isDiff){var t=editor.documentContent,n=docProps.compareContent,i=editor.doc.docInfo.DOCUMENT_NAME,o=RemoteEditor.options.compare_document_name;J("#topband-filename-container,#topband-remoteview-print").remove(),Z(ELEM_ID.BOTTOMBAR).remove(),Z("remotediff-source-title").text(i),Z("remotediff-target-title").text(o),Z("remotediff-title-container").show(),editor.setView(EDITOR_VIEWS.HISTORY),HistoryUI.setView(HistoryUI.HISTORY_VIEWS.QUICKDIFF);var r=ReviewUtil.omitTcDeletions(t.content,t.styles),a=ReviewUtil.omitTcDeletions(n.content,n.styles);t.content=r.contStr,t.styles=r.styles,n.content=a.contStr,n.styles=a.styles;var s=new QuickDiff;try{var l=s.quickdiff(t,n)}catch(e){return void HistoryUI.onQuickDiffError(e,1,1.1)}s.renderDiff(l,e.bind(null,l))}},n=function(){PubSub.subscribe("Document/FirstTimeComponentReady",t)};return{addSubscribers:n,loadDiff:t}}();!function(){"use strict";if(window.ZMacros={extend:function(){},bind:function(){},unbind:function(){}},window!==parent){var e=function(e,t){var n=t&&t.source||parent,i=t&&t.origin||"*";if(n&&i)return e.event&&(e.id=Date.now()),!e.id&&t.data.id&&(e.id=t.data.id),n.postMessage(e,i),!1},t={},n={};!function(){var n={SelectionChanged:["Cursor/Collapsed","Cursor/Selected"]};for(var i in n){var o=n[i];!function(n,i){PubSub.subscribe(i,function(i){var o=t[n];if(o&&o.length)for(var r=0,a=o.length;r<a;r++){var s=o[r].apply(null,Array.prototype.slice.call(arguments));e({event:[n,s]})}})}(i,o)}}(),PubSub.subscribe("ZMacros/Execute",function(t){var i,o=t.data.execute||[];i=n.hasOwnProperty(o[0])?n[o[0]].call(null,t,o[1]):{response:["TypeError",{status:0,data:o[0]+" is not a defined"}]},e(i,t)}),ZMacros.bind=function(e){var n,i,o;for(n in e){i=t[n]||(t[n]=[]),o=!1;for(var r=0,a=i.length;r<a;r++)if(e[n]===i[r]){o=!0;break}!o&&i.push(e[n])}},ZMacros.unbind=function(e){var n,i;for(n in e){i=t[n],t[n]=[];for(var o=0,r=i.length;o<r;o++)e[n]!==i[o]&&t[n].push(i[o])}},ZMacros.extend=function(e){extend(n,e)};var i={};i.InsertNote=function(e,t){var n={status:0},i={response:[e.data.execute[0],n]},o=editor.doc.getSelection().getTargetRange();if("content"!==DocTreeManager.doc.getSection(o.start).name)return n.data="Not allowed to insert here!",i;var r=(t.type||ATTR_BODY.DS_EN).toLowerCase(),a={};t.startNumber&&(a.startNumber=parseInt(t.startNumber)),t.format&&(a.format=RemoteEditor.NotesNumerFormat[t.format]);var s={content:t.content||""};return editor.doc.execCmd("insertnote",{type:r,noteProps:a,noteData:s,options:{focusElement:!1}}),n.status=1,i},ZMacros.extend(i)}}(),function(){"use strict";ZMacros.bind({DocumentLoaded:function(){return!0}}),ZMacros.extend({InsertContent:function(e,t){var n,i={status:0},o={response:[e.data.execute[0],i]},r=t.content,a=t.type||NODE_TYPE.TEXT;if(r?/^(text|html)$/.test(a=a.toLowerCase())||(n="Type is invalid"):n="Content not found",n)return i.data=n,o;var s=J(document.createElement("body"))[a](r);return PasteUtil.insertCustomContent(s[0],CONST.PASTE_DESTINATIONFORMAT),i.status=1,o},FindAndReplace:function(e,t){var n={status:0},i={response:[e.data.execute[0],n]},o=t.findText;if(!o)return n.data="Parameters not found",i;var r=t.replaceText,a=t.replaceStyle,s=t.findOptions||{},l=[];if(a){var d=document.createElement("body"),c="";for(var u in a)c+=u+":"+a[u]+";";d.innerHTML="<span style='"+c+"'>#</span>",l=PasteUtil.getOpForCustomConent(d)||[]}Replace.casesensitive=t.matchCase;for(var p,h,f,m=Replace.getRegExForSearchStr(o),g=editor.doc.getContent();(p=m.exec(g))&&(h=m.lastIndex-o.length,f=[{r:h},{ds:editor.doc.getContent(h,h+o.length)}],l.shift()&&f.push(l.shift()),f.push({is:r}),l.shift()&&f.push(l.shift()),Op.processMsg(f),s.replaceAll););return Op.sendMsg(),n.status=1,i},ReviewChanges:function(e,t){var n,i={status:0},o={response:[e.data.execute[0],i]};switch(t.action){case"AcceptAll":n=TcUtil.acceptAllFromRemoteClient;case"RejectAll":n||(n=TcUtil.rejectAllFromRemoteClient);default:n();return i.status=1,o}}})}(),function(){"use strict";var e={ht:"height",wid:"width",widgetSrc:"src",thumbnail:"thumbnail",customdata:"customdata"};ZMacros.bind({SelectionChanged:function(){var t=editor.getDocument(),n=t.getSelection().getTargetRange(),i=t.getNodeAt(n.start),o=i&&t.getComputedFormat(i)||{};if(o.type!==NODE_TYPE.WIDGET)return o;var r={};for(var a in e)o.hasOwnProperty(a)&&(r[e[a]]=o[a]);return r}}),ZMacros.extend({ImageOptions:function(e,t){var n={status:0},i={response:[e.data.execute[0],n]};return t&&(Imagelibrary.appData=t,n.status=1),i}})}();var RemoteEditor=function(){"use strict";var e={};e.quitWithoutSaving=!1,e.documentModified=!1,e.options={},e.imgLibAppData={},e.init=function(t){e.options=t,e.userStatusId=t.remoteUserStatusId,e.rsid=t.rsid,e.quitWithoutSaving=t.forcedeleteonclose},e.handleUIOptions=function(){var e=new RegExp(/false|no|null|undefined/i),t={blankpage:{removeSelectors:"#ins-lpnl-blnkpage"},browserprint:{removeSelectors:"#printusingbrowser"},chat:{removeSelectors:"#collaboratorPanelDiv"},dropcap:{removeSelectors:"#fmt-lpnl-dropcap-btn,#fmt-lpnl-dropcap-btnDropDown"},export:{removeSelectors:"#filemenu-export,#filemenu_separator_saveastemplate,#mm-preview-downloadoption,#mm-preview-download"},logo:{removeSelectors:"#power-by-zohoimage"},pagecount:{removeSelectors:"#ins-lpnl-pagecnt"},pagelayout:{removeSelectors:"#menu-pagelayout-parent"},pagenumber:{removeSelectors:"#ins-lpnl-pageno"},print:{removeSelectors:"#filemenu-print,#filemenu-print-chrome,#mm-preview-printoption,#mm-preview-print,#readonly-tb-print,#topband-remoteview-print"},save:{removeSelectors:"#filemenu-save,#topband-save"},savebutton:{disableSelectors:"#filemenu-save",callback:function(){UIUtils.updateSaveButton("disable")}},shapes:{removeSelectors:"#ins-lpnl-shapes"},textbox:{removeSelectors:"#ins-lpnl-txtbox"},tools:{removeSelectors:"#menu-tools-parent"},topband:{removeSelectors:"#topband-filename-container,#power-by-zohoimage",callback:editor.onResize},view:{removeSelectors:"#menu-view-parent"}},n=function(i){var o,r;for(o in i)if(i.hasOwnProperty(o))if(r=i[o],"object"==typeof r)n(r);else if(e.test(r)){if(!(r=t[o]))continue;J(r.removeSelectors).remove(),J(r.disableSelectors).disable(),"function"==typeof r.callBack&&r.callBack()}};return n}(),e.imagelibraryData=function(t){var n=t.data.params||{};e.imgLibAppData=JSON.parse(n),t.source.postMessage('{"code":"200","message":"Message received","action":"imagelibraryData"}',t.origin)},e.remoteSave=function(t){var n=!1;t.data.params&&(n=t.data.params[0]);var i=function(e){var n=e.STATUS_CODE,i=e.RESPONSE;t.source.postMessage('{"code":'+n+',"message":"'+i+'","action":"remoteSave"}',t.origin)};e.save(n,i)},e.save=function(t,n){var i={};if("REMOTE"==editor.getEditorType()&&!e.documentModified)return t?(i.STATUS_CODE=302,i.RESPONSE="",void(n&&n(i))):void UIUtils.showLoadingMsg(J.i18n("writer.remotesave.DOCUMENT_ALREADY_SAVED"),3e3);var o={};o.rsid=e.rsid,Utils.setCsrfParam(o),t||UIUtils.showLoadingMsg(J.i18n("writer.editor.SAVING")),J.ajax({type:"POST",global:!1,url:Utils.getContextUrl("remotesave.im"),dataType:"json",data:o,error:function(e,o,r){var a=e.responseJSON,s=a.statusValue||a.RESPONSE;return t?(i.STATUS_CODE=500,i.RESPONSE=s,void(n&&n(i))):void(REMOTE_MESSAGE[s]?UIUtils.showLoadingMsg(J.i18n(REMOTE_MESSAGE[s]),5e3):UIUtils.showLoadingMsg(s?s:J.i18n("writer.remotesave.REMOTESAVE_ERR_MSG1"),5e3))},success:function(o){if(!o){if(t)return i.STATUS_CODE=500,i.RESPONSE="",void(n&&n(i));UIUtils.showLoadingMsg(J.i18n("writer.remotesave.REMOTESAVE_ERR_MSG1"),5e3)}var r=o.statusCode||o.STATUS_CODE,a=o.statusValue||o.RESPONSE;return t?(i.STATUS_CODE=r,i.RESPONSE=a,void(n&&n(i))):void(REMOTE_MESSAGE[a]?UIUtils.showLoadingMsg(J.i18n(REMOTE_MESSAGE[a]),5e3):"datasaved"==a||200==r?(UIUtils.showLoadingMsg("datasaved"==a?J.i18n("writer.remotesave.SUCCESS"):a,5e3),e.documentModified=!1):UIUtils.showLoadingMsg(a?a:J.i18n("writer.remotesave.REMOTESAVE_ERR_MSG1"),5e3))}})};var t=["RemoteEditor.isDocumentModified","RemoteEditor.insertParagraph","RemoteEditor.insertText","RemoteEditor.insertContent","RemoteEditor.findnreplace","RemoteEditor.findnreplaceHTML","RemoteEditor.remoteSave","RemoteEditor.acceptAll","RemoteEditor.rejectAll","RemoteEditor.insertEndNote","RemoteEditor.insertFootNote","RemoteEditor.imagelibraryData","RemoteEditor.insertHTML"];e.listener=function(n){if("message"===n.type){if(!e.isTrustedDomainList(n.origin))return void n.source.postMessage('{"code":"400","message":"Domain not registered"}',n.origin);if(!n.data)return void n.source.postMessage('{"code":"400","message":"Invalid arugment"}',n.origin);if(n.data.func){if(t.contains(n.data.func)){var i=Utils.getAsFunction(n.data.func).fn;if("function"==typeof i){var o=Array.prototype.slice.call(arguments);return void i.apply(null,o)}return void n.source.postMessage('{"code":"400","message":"Invalid function"}',n.origin)}return void n.source.postMessage('{"code":"400","message":"operation does not exist"}',n.origin)}PubSub.publish("ZMacros/Execute",n)}},e.isTrustedDomainList=function(t){if("undefined"!=typeof e.options.postMsgAllowedDomain){var n=e.options.postMsgAllowedDomain.split(",");if(n.contains(t))return!0}return!1},e.isDocumentModified=function(t){t.source.postMessage('{"code":"200","message":'+e.documentModified+',"action":"isDocumentModified"}',t.origin)};var n=function(e){var t={};return e.thumbnail&&(t[ATTR_WIDGET.THUMBNAIL]=e.thumbnail),e.customdata&&(t[ATTR_WIDGET.CUSTOM_DATA]=e.customdata),e.src&&(t[ATTR_WIDGET.SRC]=e.src),e.height&&(t[ATTR_WIDGET.HT]=e.height),e.width&&(t[ATTR_WIDGET.WID]=e.width),t};return e.selectWidget=function(e){parent.postMessage(e,"*")},e.insertWidget=function(e){var t=e.data.params;t=n(t);Widget.insert(t)},e.updateWidget=function(e){var t=e.data.params;t=n(t);Widget.update(t)},e.acceptAll=function(e){var t=TcUtil.acceptAllFromRemoteClient();"SUCCESS"===t.RESPONSE?e.source.postMessage('{"code":"200","message":'+t.RESPONSE+',"action":"acceptAll"}',e.origin):e.source.postMessage('{"code":"400","message":'+t.ERROR_CODE+',"action":"acceptAll"}',e.origin)},e.rejectAll=function(e){var t=TcUtil.rejectAllFromRemoteClient();"SUCCESS"===t.RESPONSE?e.source.postMessage('{"code":"200","message":'+t.RESPONSE+',"action":"rejectAll"}',e.origin):e.source.postMessage('{"code":"400","message":'+t.ERROR_CODE+',"action":"rejectAll"}',e.origin)},e.insertParagraph=function(t){var n="p";e.insertContent(t,n)},e.insertText=function(t){var n="span";e.insertContent(t,n)},e.insertContent=function(t,n){var i=t.data.params[0]||!1;if(!i)return void t.source.postMessage('{"code":"400","message":"content not found","action":"insertContent"}',t.origin);var o=t.data.params[1]||{};if("string"==typeof o)try{o=JSON.parse(o)}catch(e){o={CUSTOMKEY:"NOT PROPER"}}var r;n?"p"===n?r="insertParagraph":"span"===n&&(r="insertText"):r="insertContent",n=n||"p",e.insertCustomContent(i,n,o),t.source.postMessage('{"code":"200","message":"success","action":'+r+"}",t.origin)},e.insertCustomContent=function(){var e=function(e){var t=document.createElement("span");return t.innerText=e,t.outerHTML},t=function(){var e=document.createElement("span"),t=J(e),n={type:"autofield",ftype:"autodate",isauto:0,datefmt:"M/d/yy",val:Date.now()};return t.attr("data-data_type","autofield"),t.attr("data-data_attr",JSON.stringify(n)),e.innerText="{date}",e.outerHTML},n=function(n,i,o){if(n&&i){for(var r="",a=n.split("{date}"),s=0,l=a.length;s<l;s++)""!=a[s]&&(r+=e(a[s])),s+1<l&&(r+=t());var d=document.createElement(i);if(!J.isEmptyObject(o)){var c=J(d);c.attr("data-custom_data",JSON.stringify(o))}d.innerHTML=r;var u=document.createElement("body");u.appendChild(d),PasteUtil.insertCustomContent(u,CONST.PASTE_DESTINATIONFORMAT)}};return n}(),e.insertHTML=function(e){var t=e.data.params[0]||!1;if(!t)return void e.source.postMessage('{"code":"400","message":"HTML not found","action":"insertHTML"}',e.origin);var n=document.createElement("body");n.innerHTML=t,PasteUtil.insertCustomContent(n,CONST.PASTE_DESTINATIONFORMAT),e.source.postMessage('{"code":"200","message":"success","action":"insertHTML"}',e.origin)},e.findnreplace=function(e){var t=e.data.params[0],n=e.data.params[1];if(!t||!n)return void e.source.postMessage('{"code":"400","message":"params not found","action":"findnreplace"}',e.origin);var i=!!e.data.params[2];Replace.searchFor=t,Replace.replaceStr=n,Replace.pos=0,i===!0?Replace.replaceAll():(Replace.findNext(),Replace.replace()),e.source.postMessage('{"code":"200","message":"success","action":"findnreplace"}',e.origin)},e.findnreplaceHTML=function(e){var t=e.data.params[0],n=e.data.params[1];if(!t||!n)return void e.source.postMessage('{"code":"400","message":"params not found","action":"findnreplaceHTML"}',e.origin);var i=!!e.data.params[2],o=document.createElement("body");o.innerHTML=n;var r=PasteUtil.getOpForCustomConent(o);r.shift();var a,s,l,d=Replace.getRegExForSearchStr(t),c=editor.doc.getContent();for(editor.getDocument();(a=d.exec(c))&&(s=d.lastIndex-t.length,l=[{r:s},{ds:editor.doc.getContent(s,s+t.length)}],l=l.concat(Utils.clone(r)||[]),Op.processMsg(l),i););Op.sendMsg(),e.source.postMessage('{"code":"200","message":"success","action":"findnreplaceHTML"}',e.origin)},e.NotesNumerFormat={1:"num",2:"alphasml",3:"alphacap",4:"romansml",5:"romancap"},e.insertEndNote=function(t){var n=DocTreeManager.doc.getSection(editor.doc.getSelection().getTargetRange().start);if("content"!=n.name)return void t.source.postMessage('{"code":"400","message":"Endnote is not allowed here","action":"insertEndNote"}',t.origin);var i=t.data.params[0]||"",o=t.data.params[1]||{};if("string"==typeof o)try{o=JSON.parse(o)}catch(e){o={}}var r={};o.startNumber&&(r.startNumber=parseInt(o.startNumber)),o.format&&(r.format=e.NotesNumerFormat[o.format]);var a={content:i};editor.doc.execCmd("insertnote",{type:"endnote",noteProps:r,noteData:a,options:{focusElement:!1}}),t.source.postMessage('{"code":"200","message":"success","action":"insertEndNote"}',t.origin)},e.insertFootNote=function(t){var n=DocTreeManager.doc.getSection(editor.doc.getSelection().getTargetRange().start);if("content"!=n.name)return void t.source.postMessage('{"code":"400","message":"Footnote is not allowed here","action":"insertFootNote"}',t.origin);var i=t.data.params[0]||"",o=t.data.params[1]||{};if("string"==typeof o)try{o=JSON.parse(o)}catch(e){o={}}var r={};o.startNumber&&(r.startNumber=parseInt(o.startNumber)),o.format&&(r.format=e.NotesNumerFormat[o.format]);var a={content:i};editor.doc.execCmd("insertnote",{type:"footnote",noteProps:r,noteData:a,options:{focusElement:!1}}),t.source.postMessage('{"code":"200","message":"success","action":"insertFootNote"}',t.origin)},e.insertDateContent=function(e){e.data.params[0]},PubSub.subscribe("Document/FirstTimeComponentReady",function(){window!==parent&&parent.postMessage('{"code":"200","message":"DocumentLoadComplete"}',"*"),e.handleUIOptions(e.options),docProps.MM_DETAILS||"REMOTE"!=editor.getEditorType()||J("#tools-lpn-mm-cont").remove(),J("#wmscollapsebar").remove()}),window!==parent&&PubSub.subscribe("Document/LoadingComplete",function(){parent.postMessage('{"code":"202","message":"DocumentLoadInProgress"}',"*")}),e}();