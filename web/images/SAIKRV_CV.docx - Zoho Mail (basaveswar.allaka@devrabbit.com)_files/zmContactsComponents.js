window.zmAdd=function(){"use strict";var a,b,c,d,e,f,g,h="",i={},j=!1,k="a",l=!0,m=[],n={},o=[],p=function(a,c,e){var f=$(a).attr("data-eid");if(!$(a).hasClass("SC_no")){if(!a||$(a).find("i").hasClass("msi-tick")&&"all"!==e)a&&($(a).find("i").removeClass("msi-tick"),$(a).removeClass("sel"),$("#zmabk_sel div[data-eid='"+f+"']").remove(),$(".SC_conSel").find("[data-eid = '"+f+"']").remove(),delete i[f]);else{if($(a).find("i").addClass("msi-tick"),$(a).addClass("sel"),!$("#zmabk_sel").length){var h=document.createElement("div");h.id="zmabk_sel",$("#zmabk").after(h),$("#zmabk_sel").css({height:"auto",overflow:"hidden"}).click(function(a){var c=a.target;$(c).hasClass("msi-close")&&b($(c).parent())})}if(!i[f]){var j=$(a).find("div").html(),k=j.substring(0,j.indexOf("<")),l="",m="";j.indexOf("<font>")!==-1&&(l=j.substring(j.indexOf("</b>")+4,j.indexOf("</font"))),m=$(a).find("img").attr("src"),i[f]={fn:k,nn:l,eid:f,photo:m};var n=_zm.getDOM(["DIV",{attrs:{"class":"SC_cs","data-eid":f},child:[["SPAN",{child:[["text",k]]}],["I",{attrs:{"class":"msi-close"}}]]}]);if(zmail.ContactBook.get(f).done(function(a){$(a[0].avatar()).insertBefore($(n).find("span"))}),$("#zmsdialog_zmabk").find(".SC_conSelLst").append(n),zmail.showFeature){var o=Object.keys(i).length;g(),o>3?$(d).css("display","block"):$(d).css("display","none")}var p=$("#zmsdialog_zmabk").find(".SC_conSelLst")[0];p.scrollHeight>0&&(p.scrollTop=p.scrollHeight)}}zmAdd.resizeSelPane()}};b=function(a){var b=$(a).attr("data-eid");$("#zmabk li[data-eid='"+b+"']")[0]?p($("#zmabk li[data-eid='"+b+"']")):($(a).remove(),delete i[b])},g=function(){0===$(".SC_mkeGrp").eq(0).length&&($(d).css("display","none"),$(d).insertBefore(".SC_PUbtm"),$(d).on("click",function(a){e(a)}))},e=function(a){var b,c=a.target,e=function(){var a=$(".SC_grpName");a.removeClass("SC_dyn"),a.on("keyup",function(){a[0].value.length>0?(b=$(d).find(".msi-edit"),$(b).attr("class","msi-tick"),$(b).on("click",function(){f(a[0].value)})):(b=$(d).find(".msi-tick"),$(b).attr("class","msi-edit"))})};"SC_mkeGrpTxt"===c.className?($(c).addClass("SC_dyn"),e()):"msi-close"===c.className||"grp_close"===c.className?$(d).remove():"msi-edit"!==c.className&&"grp_save"!==c.className&&"msi-tick"!==c.className||($(".SC_mkeGrpTxt").addClass("SC_dyn"),e())},f=function(a){var b=function(a){_zm.succErrMsg("e",a["Error : "])},c=function(a,b){_zm.succErrMsg("e","Category Added Successfully"),$(d).remove()},e=Object.keys(i),f=e.toString(),g={};g.mode="addToCategory",g.query="ad",g.ignoreCategoryCheck="true",g.categoryName=a,g.email=f,zmAjq.XHR({u:zmail.conPath+"/getContactsAlias.do",t:"POST",p:g,fn:c,efn:b,csr:"s"})};var q=function(){$("#zmabk_srch input").mousedown(function(a){$("#zmsdialog_zmabk #zmabk_srch input").focus(),zmUtil.stopEvents(a)}).keyup(function(a){""===$(this).val().trim()?(h="a",$("#zmabk_s li").remove(),zmAdd.loadAlpt("a")):zmAdd.loadAlpt($(this).val(),"search"),zmUtil.stopEvents(a)}),$("#zmabks_sel").click(function(a){var b=a.target;"I"===b.tagName&&p(b,a)}),$("#zmabk ul").click(function(a){var b=a.target;"LI"!==b.tagName&&(b=$(a.target).parents("li")),p(b,a)}),$("#zmabk ul").scroll(function(a){j||zmAdd.loadAlpt("","orgper")}),$(".SC_conSel").click(function(a){var c=a.target;"msi-close"===c.className&&b(c.closest("div"))})};c=_zm.getDOM(["DIV",{attrs:{"class":" SC_Psa"},child:[["I",{attrs:{"class":""}}],["text",zmText.get("zmContactsComponents","addressBook.labels.selectAll")]]}]);var r=function(a){for(var b=$("#zmabk_c").children(),c=b.length,d=a.attr,e=0;e<c;e++)p(b[e],"",d)},s=function(){var a=$(c).find("i");$(c).insertAfter("#zmabk_hdr");var b=$("#zmabk_c li").length,d=$("#zmabk_c li.sel").length;b===d?a.addClass("msi-check").removeClass("msi-uncheck"):a.addClass("msi-uncheck").removeClass("msi-check")},t=function(){var a=_zm("<","SELECT",_zm("#","zmabk_hdr"))[0],b=a.value;if("my"===b)$("#zmabk_s")[0].innerHTML="",$("#zmabk_c")[0].innerHTML="",$("#zmabk_a")[0].innerHTML="",$("#zmabk ul").hide(),$("#zmabk .SC_Psa ").remove(),$("#zmabk_a").show().scrollTop(0),h="a",k="a",zmAdd.loadAlpt(h),l=!0,m=o;else{zmAdd.loadAlpt(b,"category");var d=$(c).find("i");$(c).off().on("click",function(){"msi-uncheck"===d[0].className?(d.addClass("msi-check").removeClass("msi-uncheck"),r({attr:"category"})):(d.addClass("msi-uncheck").removeClass("msi-check"),r({attr:""}))}),o=m}$(a).blur()},u={showBook:function(b,c,e){if(l=!0,h="a",!$("#zmabk").length){var f=["DIV",{attrs:{id:"zmabk"},child:[["DIV",{attrs:{id:"zmabk_hdr","class":"SC_PUhd"},child:[["DIV",{attrs:{"class":"SC_sch SC_frt",id:"zmabk_srch"},child:[["I",{attrs:{"class":"msi-search"}}],["INPUT",{attrs:{type:"text",placeholder:zmText.get("zmContactsComponents","addressBook.placeholders.searchContact")}}]]}],["DIV",{attrs:{"class":"SC_select"},child:[["SELECT",{child:[["OPTION",{attrs:{value:"my"},child:[["text",zmText.get("zmContactsComponents","addressBook.labels.allContacts")]]}]]}]]}]]}],["UL",{attrs:{"class":"SC_P2r SC_Phr","data-index":0,id:"zmabk_c",style:"display:none"}}],["UL",{attrs:{"class":"SC_P2r SC_Phr","data-index":0,id:"zmabk_a"}}],["UL",{attrs:{"class":"SC_P2r SC_Phr",id:"zmabk_s","data-index":0,style:"display:none"}}]]}];a=e.target.innerText,$("body").append(_zm.getDOM(f))}var j,k,m=document.getElementById(c).getBoundingClientRect();k=m.top+10;var n={title:"",buttons:[{txt:zmText.get("zmContactsComponents","addressBook.labels.insert"),callback:function(){zmAdd.insertCont(b)}},{txt:zmText.get("zmContactsComponents","addressBook.labels.cancel"),isCancel:!0,callback:function(){zmAdd.closeAddBook()}}],mask:!0,pos:"left"};zmsDialog.create("zmabk",n);var o=$("#zmsdialog_zmabk").parent();o.attr("class","SC_pe SC_PopTop"),o.css("top","70px"),$("#zmabk li").remove(),$("#zmabk_sel").html(""),$("#zmabk").scrollTop(0);var p,r,s,u,v=_zm("<","SELECT",_zm("#","zmabk_hdr"))[0];for(p=zmail.ContactBook.getCategories(),s=p?p.length:0,r=0;r<s;r++)u=_zm.getDOM(["OPTION",{attrs:{value:p[r].attrs.cid},child:[["text",p[r].attrs.cname]]}]),v.appendChild(u);_zm.bind(v,"change",t),$("#zmsdialog_zmabk").css("max-width","500px"),"To"===a?a=zmText.get("zmContactsComponents","addressBook.labels.To"):"Cc"===a?a=zmText.get("zmContactsComponents","addressBook.labels.Cc"):"Bcc"===a&&(a=zmText.get("zmContactsComponents","addressBook.labels.Bcc"));var w=_zm.getDOM(["DIV",{attrs:{"class":"SC_conSel"},child:[["DIV",{attrs:{"class":"SC_conLbl SC_thm"},child:[["text",a]]}],["DIV",{attrs:{"class":"SC_conSelLst"}}]]}]);d=_zm.getDOM(["DIV",{attrs:{"class":"SC_mkeGrp"},child:[["SPAN",{attrs:{"class":"SC_mkeGrpTxt"},child:[["text","create category"]]}],["INPUT",{attrs:{"class":"SC_grpName SC_dyn",type:"text",placeholder:"Enter category Name"}}],["SPAN",{attrs:{"class":"grp_save"},child:[["I",{attrs:{"class":"msi-edit"}}]]}],["SPAN",{attrs:{"class":"grp_close"},child:[["I",{attrs:{"class":"msi-close"}}]]}]]}]),$(w).insertAfter("#zmsdialogcont_zmabk"),zmail.showFeature&&g(),j=60*document.body.getBoundingClientRect().height/100-k,j<0&&(j=60*document.body.getBoundingClientRect().height/120),q(),$("#zmabk").attr("data-def",j),$("#zmabk").show().children("ul").css({height:j+"px",width:"500px",overflow:"hidden","overflow-y":"auto"}),zmAdd.loadAlpt(h),i={},$("#zmsdialog_zmabk #zmabk_srch input").focus(),zmUtil.stopEvents(e)},loadAlpt:function(a,b){var c,d="abcdefghijklmnopqrstuvwxyz";if("orgper"===b){if(k="a",!l)return;c=d.indexOf(h),h=d.substring(c+1,c+2),"z"===h&&(l=!1)}else{if("category"===b)return $("#zmabk ul").hide(),$("#zmabk_c")[0].innerHTML="",k="c",j=!0,h="a",void zmail.ContactBook.get({categoryid:a}).done(function(a){n=a,zmAdd.constructContacts(n),s()});if("search"===b)return $("#zmabk ul").hide(),$("#zmabk_s")[0].innerHTML="",$("#zmabk_a").hide(),$("#zmabk_c")[0].innerHTML="",k="s",j=!0,h="a",void zmail.ContactBook.get(a,1e3).done(function(a){if(n=a,0===n.length){var b=_zm("#","zmabk_"+k),c=_zm.getDOM(["LI",{attrs:{"class":"SC_no"},child:[["DIV",{child:[["I"],["SPAN"]]}],["DIV",{child:[["text",zmText.get("zmContactsComponents","addressBook.labels.noMatchFound")]]}]]}]);return b.appendChild(c),void _zm.show(b)}zmAdd.constructContacts(n)})}j=!1,zmail.ContactBook.get({fn:h,expected:5e3}).done(function(a){$("#zmabk_c").hide(),$("#zmabk_s").hide(),n=a,zmAdd.constructContacts(n,"orgper")})},constructContacts:function(a,b){var c,d,e,f=function(a,b,c,d){$(d).insertAfter($(b).find("div"));for(var e in i)e===b.getAttribute("data-eid")&&(b.className="sel",$(b).find("i").addClass("msi-tick"));c.appendChild(b)},g=a,h=g.length;for(c=0;c<h;c++){var j=n[c].attrs,l="",m="";if(j.eid&&(!j.eid||j.eid.indexOf("List")===-1)){$("#zmabk_sel .SC_cs").length&&void 0!==i[j.eid]&&(l="msi-tick",m="sel"),j.photo||(j.photo=zmail.defaultPhoto);var o=j.fn;j.ln&&(o+=" "+j.ln);var p=_zm.getDOM(["DIV",{attrs:{"class":"SC_avtr"}}]);d=_zm.getDOM(["LI",{attrs:{"data-eid":j.eid,"class":m},child:[["DIV",{child:[["text",o],["SPAN",{child:[["text",j.eid]]}]]}],p,["FONT",{child:[["I",{attrs:{"class":l}}]]}]]}]),e=_zm("#","zmabk_"+k),_zm.show(e),p=n[c].avatar(),f({},d,e,p)}}$("#zmabk_a")[0].scrollHeight<=$("#zmabk_a")[0].clientHeight&&"orgper"===b&&zmAdd.loadAlpt("","orgper")},resizeSelPane:function(){var a=document.getElementById("zmabk_sel");$("#zmabk_sel").height()>=60&&($("#zmabk_sel").css({height:"60px",overflow:"auto"}),a.scrollHeight<a.getBoundingClientRect().height&&0===a.scrollTop&&$("#zmabk_sel").css({height:"auto",overflow:"hidden"})),$("#zmabk_sel .SC_cs").length?$("#zmabk_sel").show():$("#zmabk_sel").hide();var b,c=parseInt($("#zmabk").data("def"));b="search"===h?_zm("#","zmabk_s"):1===h.length?_zm("#","zmabk_a"):_zm("#","zmabk_c");var d=c-_zm("#","zmabk_sel").getBoundingClientRect().height;b.style.height=d+"px"},insertCont:function(a){var b=[],c=0;for(var d in i)b[c]=i[d],c++;a&&"function"==typeof a&&a(b),zmAdd.closeAddBook()},closeAddBook:function(){_zm("#","zmabk_a").setAttribute("data-index",0),_zm("#","zmabk_c").setAttribute("data-index",0),_zm("#","zmabk_s").setAttribute("data-index",0),m=[],zmsDialog.remove(),$("#zmabk_sel").remove(),$("#zmabk").remove(),i={}}};return u}();