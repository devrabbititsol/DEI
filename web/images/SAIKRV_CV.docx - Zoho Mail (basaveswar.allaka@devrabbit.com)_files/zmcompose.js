"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Compose.SuggestedContactsMenu"),c=zmail.Components.InputSuggestionMenu,d={headerLabel:"Often grouped with"},e={HEADER:["font-size: 11pt","font-weight: 600","padding: 10px","color: #0088cc"].join("; ")+";",HEADER_ICON:["color: #0088cc","padding: 0px","font-size: 15pt","margin-right: 10px","vertical-align: middle"].join("; ")+";",HEADER_LABEL:["display: inline-block","vertical-align: middle","margin-left: 5px"].join("; ")+";"},f={LIST:['<div class="SC_dd SC_zi900" ref="wrapper">','<div class="content-wrapper" ref="contentWrapper">','<div class="header" style="'+e.HEADER+'">','<i class="msi-contacts" style="'+e.HEADER_ICON+'"></i>','<span style="'+e.HEADER_LABEL+'">'+d.headerLabel+"</span>","</div>",'<ul class="SC_P2r" ref="listWrapper">',"</ul>","</div>","</div>"].join("")},g=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:"getTemplate",value:function(){return f.LIST}}]),b}(c.BaseClass),h=function(a){var b=$.Deferred();return setTimeout(function(){zmAppLoader.load("autoComplete").done(function(){b.resolve(new g(a))})},0),b.promise()};b.createMenu=h,b.Events=c.Events}(),window.zmComp=function(){var a=0,b=function(){var a=zmText.get("zmcompose");return a}(),c={},d={},e={},f={},g={},h={},i={},j=function(){this.to="",this.cc="",this.bcc="",this.isCC="",this.isBCC="",this.from="",this.replyto="",this.msgId="",this.askreceipt="no"},k=function(a,b){this.composeId=a,this.listObj=[],this.composerType=b},l=function(a){this.mode=a,"reply"!==a&&"replyall"!==a&&"fwdi"!==a||(this.inlineMode=a),this.modified=0,this.editor="",this.lastModified=0,this.prevModified=0,this.replyto=e.setRepto,this.charset=e.charset,this.refHeader="",this.inReplyTo="",this.mailId="",this.mymId="",this.priority="Medium",this.attTmpObj=[],this.process=!1,this.subject="",this.isChanged=!1,this.accId=zmail.accId,this.dmailid="",this.dftId="",this.tempId="",this.data_mailId="",this.data_inReplyTo="",this.data_refHeader="",this.fromAddr=zmComp.getDefaultFrom(),this.uplpending=0,this.imagepending=0,this.discard_close=!1,0===e.askReceipt&&(this.askreceipt="yes")},m=function(){var a=zmail.cmpdata;e.askReceipt=a.ASKRECEIPT,e.charset=a.CHAR_SET,a.DEFFRM_ADDR&&zmComp.setDefaultFrom(a.DEFFRM_ADDR),e.smType=a.HTML_ENABLED,e.outIntr=a.OUT_INTERVAL,e.setRepto=a.SETREPTO,e.showBcc=a.SHOWBCC,zmComp.setFromObj(zmComp.frmListObj(a.FROM_LIST)),zmComp.setSignObj(a.SIGN_INFO),zmComp.setEncodeList(a.ENCODE_LIST)},n=function(a,b){var c,f=["myAttachchment","zDocs","otherCloud","desktop"];d[a]&&zmComp.getAccId(a)&&(c=zmComp.getAccId(a));var g={componentId:"zmEdi_"+a,attachFrom:f,isNewImp:!0,currentAttachedSize:0,autoLaunch:!1,eleId:"zmAttLst_"+a,onAddElement:function(){zmComp.updateAttachment(a,"ele","add")},onRemoveElement:function(){zmComp.updateAttachment(a,"ele","remove")},onAddAttachment:function(){zmComp.updateAttachment(a,"att","add")},onRemoveAttachment:function(){zmComp.updateAttachment(a,"att","remove")},preAttachedFile:b,insertDocsLink:zmComp.insertDocsLink};c&&(g.accId=c);var h="richtext";0===e.smType&&(h="plaintext"),g.renameSupport=!0,("richtext"===h||zmail.showFeature)&&(g.showZDocsAsLinkOption=!0),zmUtil.initAttachComponent(g,function(b){d[a]&&(d[a].attCompRef=b)})},o=function(a,b){var c={5:"reply",6:"replyall",7:"fwdi"},d={reply:"5",replyall:"6",fwdi:"7"},e="";return"string"===a&&(e=c[b]),"int"===a&&(e=d[b]),e},p=function(a,b,c){var e={},f="",g="",h="";"reply"===b?f=c.REPLYTO:"replyall"===b?(f=c.REPLYTO,g=c.REPLYCC,d[a].groupEmailId&&(g?g+=","+d[a].groupEmailId:g=d[a].groupEmailId)):"draft"!==b&&"template"!==b&&"outbox"!==b&&"eanew"!==b&&"compose"!==b||(f=c.TO,g=c.CC,h=c.BCC),f=f||"",g=g||"";var i;zmComp.getFID(a)&&(i=zmComp.getFID(a));var j=!1;return"reply"!==b&&"replyall"!==b||(j=!0),i&&zmail.folId.sId===i&&c&&c.BCC&&j&&(h=c.BCC),h=h||"",e.TO=f,e.CC=g,e.BCC=h,e},q=function(a,b){var c={};if(d[a])if("st"===d[a].type)d[a].smartData&&d[a].smartData.recipients&&(c=d[a].smartData.recipients[b]);else{var e="zm"+b+"txt_"+a;c=zmAutoFill.getAddress($("#"+e),"String",!0)}return c},r=function(a){d[a]&&d[a].data&&d[a].data.EXTIMG&&zmCUtil.loadExtImages(a,d[a].data.EXTIMG)},s=function(a){var b;d[a]&&d[a].data&&d[a].data.SHDOC&&(b=d[a].data.SHDOC);var c,e,f=[],g=[],h=[];if(b&&b.SHDOCID){var i=b.SHDOCID;i.indexOf(",")!==-1?g=i.split(","):g.push(i),g.length&&(c=zmComp.getEditor(a),e=c.doc,f=$(e).find('a[name="ZM_SHAREDOC"]'))}if(f.length)for(var j=f.length,k=0;k<j;k++){var l=f[k],m=l.href;if(m){var n=m.split("/");if(n.length){var o=n[n.length-1];$.inArray(o,g)>=0&&h.push({docId:o,docEle:l})}}}if(h.length){c=zmComp.getEditor(a),e=c.doc;var p=$(e.head).find('style[id="docHOVER_'+a+'"]');p.length||$(e.head).append(zmComp.docHover(a));for(var q=0;q<h.length;q++){var r={};r.docId=h[q].docId;var s=$(h[q].docEle).html();r.docName=s,$(h[q].docEle).closest("table").replaceWith($(zmComp._zdocTxt(a,r)))}}},t=function(a){var b=[],c=zmComp.getEditor(a).getContent(),d=/https:\/\/docs.zoho.com\/file\/.[(a-z)(A-Z)(0-9]*/g,e=c.match(d);if(e&&e.length)for(var f=e.length,g=/https:\/\/docs.zoho.com\/file\//g,h=0;h<f;h++){var i=e[h].replace(g,"");b.push(i)}return b},u=function(a,b){var c=b.doc,d=$(c).find("[class=zmail_extra]");return d.length&&(d.show(),"ZM_SHWTRIM"===d.prev().attr("name")&&d.prev().remove()),b.getContent()},v=function(a,b){b=b||window.event;var c=b.target||b.srcElement;if(c&&"ZM_SHWTRIM"===$(c).attr("name")){b&&zmUtil.stopEvents(b),$(c).remove();var d=zmComp.getEditor(a).doc;$(d).find("[class=zmail_extra]").show()}else{if(c&&"ZM_SHAREDOC"===$(c).attr("name")&&$(c).is("a"))return window.open($(c).attr("href"),"_blank"),b&&zmUtil.stopEvents(b),!1;if(c&&"ZM_SHAREDOC"===$(c).attr("name")&&$(c).is("div")){var e=$(c).closest("table").attr("data-zmdocname");zmComp.clearZDoc(c,a,e)}else c&&$(c).closest("table").attr("data-zmdocname")&&b&&zmUtil.stopEvents(b)}},w=function(a,b,c){var e={},f={},g={};e=q(a,"to"),f=q(a,"cc"),g=q(a,"bcc"),e.address&&(b.to=e.address),f.address&&(b.cc=f.address,b.isCC=!0),g.address&&(b.bcc=g.address,b.isBCC=!0);var h=d[a].mode;"compose"!==h&&"fwdi"!==h&&"fwdme"!==h||(b.isCC=!0),b.from=zmComp.getFromAddr(a),b.subject=zmComp.getSubject(a),b.replyto=zmComp.getReplyto(a),zmComp.getMymId(a)&&(b.msgId=zmComp.getMymId(a)),b.askreceipt=zmComp.getAskReceipt(a);var i=zmComp.getPriorityDom(a),j=i.elem;j&&j.is(":visible")&&(b.isPriority=!0);var k;d[a]&&d[a].type&&(k=d[a].type),zmComp.prvClose(a,k,b.msgId,"close",c)},x=function(a){var b="";return zmComp.getFromObj()[a]&&zmComp.getFromObj()[a].FRM_DISN&&(b=zmComp.getFromObj()[a].FRM_DISN),b},y=function(a){if(a&&""!==$.trim(a)){var b=x(a);b=zmCUtil.getText(b),b&&(a=b+" <"+a+">")}return a},z=function(a){if(a&&""!==$.trim(a)){var b=x(a);b=zmCUtil._entityText(b),b&&(a=b+"&nbsp;&lt;"+a+"&gt;")}return a},A=function(a,b){var c=b.REPLYFROM;return"outbox"===a||"draft"===a||"template"===a?c=b.FROM:"fwdi"===a&&(c=zmComp.getDefaultFrom()),zmComp.getFromObj()[c]||(c=zmComp.getDefaultFrom()),c},B=function(a){var b=!1;if(d[a]){var c=zmComp.getLastModified(a),e=zmComp.getPrevModified(a),f=zmComp.getModified(a);(1===f||c>e)&&(b=!0)}return b},C=function(a){var b=a.cmpId;if(B(b)){a.action="sdraft",a.sendIm=!1;var c=a.viaType;c&&"adraft"===c&&(a.autosave=c),zmComp.sendMail(a)}},D=function(a){var b=setInterval(function(){var b={};b.cmpId=a,b.viaType="adraft",b.calleeType="interval",C(b)},6e4);zmComp.setInterVal(a,b)},E=function(a,c,e){var f=$("#zmRepLst_"+a).closest("li");$("#zmRepLst_"+a).off("click").on("click",function(){var c={},d=[{htm:b.reply,data:{action:"reply",msgId:e,par:f}},{htm:b.replyall,data:{action:"replyall",msgId:e,par:f}},{htm:b.forward,data:{action:"fwdi",msgId:e,par:f}}];c.align="pleft",c.list=d,c.clk=function(a){zmComp.chgReply(a.action,a.type,a.msgId,a.par),zmUtil.hideMenu()},c.par=f,$("#zmRepLst_"+a).closest("b").addClass("SC_ddn"),zmUtil.showMenu(c)});var g=c;d[a].inlineMode&&(g=d[a].inlineMode);var h="msi-reply";"replyall"===g?h="msi-replyall":"fwdi"===g?h="msi-forward":"eanew"===g&&(h="msi-edit"),$("#zmRepIcn_"+a).removeClass().addClass(h)},F=function(a){zmAutoFill.resizeInput(a)},G=function(a,b){var c="",e=!1,f=zmComp.getFromObj(),g=zmail.fromAddr;zmComp.getFromAddr(a)&&(g=zmComp.getFromAddr(a));var h=(f[g]||{}).FRM_SIGID;if(h&&"null"!==h){var i=zmComp.getSignObj();i[h]&&(c='<div id="Zm-_Id_-Sgn">'+i[h].SIG_CONT+"</div>",1===i[h].SIG_POS&&(e=!0))}var j=b;return d&&d[a]&&d[a].prm&&"note"===d[a].prm.entityType&&(e=!1),j=e?"<br><br>"+c+"<br>"+j:"<br><br>"+j+"<br>"+c},H=_.debounce(function(a){var b={};b.cmpId=a,C(b)},5e3),I=function(a,b,c){try{var e="zm"+b+"txt_"+a;c=zmUtil.replaceHTMLEntities(c),zmAutoFill.contactFill(c,$("#"+e),!0,[],{source:"compose",modifyDOM:function(a){a=a||{},zmComp.debugLog(a.contact),zmComp.debugLog(a.dom)}}),d[a]||$("#"+e).attr("disabled",!0)}catch(f){zmComp.debugLog(f)}},J=function(a,b){return zmail.showFeature&&(b.getSmiley=function(a){var b=zmSmiley.getSmiley(a);return b}),b.handleAutoFill=!0,b.getNewAutofillContacts=zmCUtil.getContacts,b.triggerOnMention=function(b){try{if(d[a]&&!d[a]._atMentionObj&&(d[a]._atMentionObj=[]),d[a]._atMentionObj&&d[a]._atMentionObj.indexOf(b.eid)===-1){d[a]._atMentionObj.push(b.eid);var c=b.fn+" <"+b.eid+">";I(a,"to",c)}}catch(e){zmComp.debugLog(e)}},b},K=function(c,e){return e.handlePasteImages=!0,e.processPastedFile=function(e,f,g,h,i){e.dataURI&&(e.file=zmCUtil.dataURItoBlob(e.dataURI));var j;zmAttachComponent.imageEditTool.init({file:e.file,onAttach:function(a){e.file=a.blob,j()},onClose:function(){},handBckObj:function(){}}),j=function(){if(e.file){var f,j=a,k="pastImg_"+c+"_uId"+j,l=(new Date).getTime()+".png",m=0;if(e&&e.file){if(e.file&&(f=e.file,e.file.name&&(l=e.file.name)),l.lastIndexOf(".")!==-1){var n=l.substr(l.lastIndexOf("."));"png"!==n&&(l+=".png")}else l+=".png";e.file.size&&(m=e.file.size)}var o=3145728;if(m>o){var p=b.imageupload_size_exceeds,q="<h4>"+p+"</h4>",r=$("<div/>");r.attr("id","zmcmp_pasteupload_"+c),r.html(q);var s={};return s.cmpId=c,s.$content=r,s.ignoreMouseDown=!1,s.dialogDidMount=function(a){$("#zmcmp_pasteupload_"+c)[0].zmcmp_pasteupload_dialog_ele=a;var b=a.$els.$maskWrapper;b.on("mousedown",function(b){var c=b.target||b.srcElement;$(c).closest("div.SC_pe").length?$(c).trigger("click"):a.remove()})},s.defaultNavigator=!1,s.navigator=new zmail.Navigator({onEscape:function(){$("#zmcmp_pasteupload_"+c)[0].zmcmp_pasteupload_dialog_ele.remove()}}),s.buttons=[{name:b.ok,callback:function(a){a.remove(),e.file&&(e.file.name||(e.file.name="Screenshot_"+(new Date).getTime()+".png"),zmComp.getAttRef(c).uploadFiles([e.file]))}},{name:b.cancel,isCancel:!0,callback:function(a){a.remove()}}],void Dialog["new"](s)}var t=new XMLHttpRequest;d[c].imagepending++,t.upload.addEventListener("loadstart",function(){g(k)},!1);var u=new FormData,v=zmAjq.getCookie("zmcsr");u.append("aId",zmail.accId),u.append("frm","c"),u.append("uploadMode","drop"),u.append("mode","composeSet"),u.append("context","zm"),u.append("zmrcsr",v),u.append("img_file",f,l),t.onreadystatechange=function(){if(4===t.readyState)if(d[c].imagepending--,200===t.status){var a,b=$.parseJSON(t.responseText),e=b.fileName,f=b.aId,g=b.storeName,j=b.frm;e&&f&&g&&j?(a="/mail/ImageSignature?fileName="+e,a+="&accountId="+f+"&storeName="+g,"c"===j&&(a+="&frm=c"),h(a,k)):i(k)}else i(500===t.status||400===t.status?k:k)},t.open("POST",zmail.conPath+"/zeUploadImage.do",!0),t.send(u),a++}}},e},L=function(a){var b=zmComp.getZDocLoc(a);if(b.length&&"plaintext"===zmComp.getEditor(a).mode&&(d[a].plaindoclink=b),d[a].newsave){var c={};c.cmpId=a,c.calleeType="afterEditorLoad",C(c)}d[a].aftersave&&zmComp.afterSave(a,"close_false",d[a].aftersave);var e=d[a].editor;r(a),s(a);var f=!0;d[a].type&&"p"===d[a].type&&(f=!1);var g=e.doc.body;"plaintext"===e.mode&&(g=e._textarea),f&&g.setAttribute("data-enableShortcuts","true"),zmComponent.keybindings.listener.add(e.doc),zmComponent.bind({ev:"click",fn:zmUtil.hideMenu,args:[!0,!1],elm:e.doc,capture:!0}),navigator.userAgent.indexOf("Safari")!==-1?e.doc.addEventListener("mousedown",function(b){v(a,b)},!0):e.doc.attachEvent?e.doc.attachEvent("onmousedown",function(b){v(a,b)}):e.doc.addEventListener&&e.doc.addEventListener("mousedown",function(b){v(a,b)},!0),ZE_Init.inlineImage=zmWUtil.editorInlineImage,zmComp.setLastModified(a,0),zmComp.setPrevModified(a,0)},M=function(a,b,c,d,e){var f=zmCUtil.getfontFamily(zmail.mailOpt.ff);"Default"!==f&&(ZE_Init.defaultFontFamily=f),zmail.mailOpt.fs&&(ZE_Init.defaultFontSize=zmail.mailOpt.fs+"pt");var g="";"compose"===d||"fwdi"===d||"fwdme"===d?ZE_Init.needEditorFocus=!1:ZE_Init.needEditorFocus=!0,ZE_Init.fileUpload=zmComp.editorDropUpload,e&&"inline"===e?ZE_Init.toolbarOrder=zmCUtil.getInlineToolbar():ZE_Init.toolbarOrder=zmCUtil.getTabToolbar();var h={};h.id="zmEdi_"+a,h.contentChanged=function(){zmail.showFeature&&H(a),zmComp.setLastModified(a,(new Date).getTime()),zmComp.setModified(a,1)},h=J(a,h),h=K(a,h),"plaintext"===b&&(c=ZE.getText(c),h.mode="plaintext"),h.content=c,g=ZE.create(h),zmComp.setEditor(a,g);try{var i=function(a){return function(){L(a)}};zmComp.getEditor(a).afterEditorLoad(i(a,d))}catch(j){}},N=function(a,b,c,d){var f=c;"draft"!==b&&"template"!==b&&"outbox"!==b&&"eanew"!==b&&(f=G(a,c));var g="richtext";0===e.smType&&(g="plaintext"),M(a,g,f,b,d)},O=function(a){var b="",c=!1,e=zmComp.getMode(a);return!e||"reply"!==e&&"replyall"!==e||(c=!0),d&&d[a]&&zmComp.getShareId(a)&&c&&zmComp.delegateEID(a)&&(b=zmComp.delegateEID(a)),b},P=function(a,b,c){var d=[];c&&c.NEWATT&&"replyall"!==b&&"reply"!==b&&(d=c.NEWATT),n(a,d)},Q=function(a){var b=[];d&&d[a]&&d[a].attCompRefList&&(b=d[a].attCompRefList),n(a,b)},R=function(a,c,d){var e=A(c,d),f=!1;O(a)&&(e=O(a),f=!0);var g=y(e);if($("#zm_fromaddr_"+a).text(g),zmComp.setFromAddr(a,e),f){var h=$("#zm_fSel_"+a),i='<font id="zm_fdeleSel_'+a+'">';i+=b.shared_from_address_info,i+="</font>",$(h).append(i)}else $("#zm_fdeleSel_"+a).remove()},S=function(a,b){var c=b.SENTTIME||"",d=b.SENDER||"",e=b.FROM||"",f=b.TO||"",g=b.CC||"",h=b.SUBJECT||"",i="";return d&&(d=_zm.escapeTags(d)),"fwdi"!==a?(i="<div id='Zm-_Id_-Sgn1'><br>",""!==c&&(i+=" ---- On "+c),""===d&&""===e||(i+=""!==d&&d!==e?"&nbsp;<b>"+d+" &lt;"+e+"&gt;</b>":"&nbsp;<b>&lt;"+e+"&gt;</b>",i+=" wrote ---- </div><br>")):(i="<div id='Zm-_Id_-Sgn1'><br>============ Forwarded message ============<br>",""===d&&""===e||(i+=""!==d&&d!==e?"From : "+d+" &lt;"+e+"&gt;":"From : "+e,i+="<br>"),""!==f&&(i+="To : "+f+"<br>"),""!==g&&(i+="Cc : "+g+"<br>"),""!==c&&(i+="Date : "+c+"<br>"),""!==h&&(i+="Subject : "+h),i+="<br>============ Forwarded message ============</div><br>"),i},T=function(a){var b={contentArray:"",compare:["fn","ln","nn","eid"],LType:"1",OType:"1",onBubbleDOMCreate:function(b){if(b=b||{},zmail.showFeature&&d[a].info&&d[a].info.recipientList&&b.contact&&b.dom){var c=d[a].info.recipientList;c&&b.contact.eid&&"SUCCESS"!==c[b.contact.eid]&&$(b.dom).addClass("zmfail"),c&&b.contact.eid&&"SUCCESS"===c[b.contact.eid]&&$(b.dom).addClass("zmsuc")}}};"outbox"===d[a].mode?b.actionCallback=zmComp.modifyOutbox:b.actionCallback=zmComp.modifyRecipients,b.onInputFocusBlur=function(a){var b,c,d=zmCUtil.getElemId(a);if(d){b=d.cmpId,c=d.eleType;var e=a.type;"blur"===e&&b?d&&zmCUtil.hideSugMenu(b):"focus"===e&&_zm._isPrivilegedUser()&&zmCUtil.getSugContacts(b,c)}},b.onInputChange=function(a){var b,c,d=zmCUtil.getElemId(a);if(d){b=d.cmpId,c=d.eleType;var e=a.elem.value;e=$.trim(e),e.length&&zmCUtil.isSugMenu(b,c)&&zmCUtil.hideSugMenu(b,c)}},b.onEscKeyPress=function(a){var b,c,d=zmCUtil.getElemId(a);d&&(b=d.cmpId,c=d.eleType,zmCUtil.hideSugMenu(b,c))},zmAutoFill.setAutofill(b,$("#zmdArea_"+a+" .zm_sgst"))},U=function(a,b,c){var e="";if(c.CONTENT&&(e=c.CONTENT,c.BLCKCON&&(e+=c.BLCKCON)),e=zmComp.parseHTML(e),"reply"===b||"replyall"===b||"fwdi"===b){var f=S(b,c),g=f,h="style='border-left: 1px solid #cccccc; padding-left: 6px; margin:0 0 0 5px'";g+="<blockquote "+h+">"+e+"</blockquote>";var i=!1,j=d[a].type;if("p"!==j||"reply"!==b&&"replyall"!==b||(i=!0),zmComp.isIE()&&(i=!1),i){var k="name='ZM_SHWTRIM' ";k+="title='Show trimmed content' ";var l="background-image:url("+zmail.imgPath+"zms.png);";l+="background-position: -60px -57px;",l+="background-repeat: no-repeat;cursor: pointer;",l+="display: inline-block;",l+="height: 20px;",l+="margin: 0 auto;",l+="vertical-align: middle;",l+="width: 22px;",k+="style='"+l+"'",e="<div "+k+"></div>",e+="<div class='zmail_extra' style='display:none;'>"+g+"</div>"}else e="<div class='zmail_extra'>"+g+"</div>"}return e},V=function(a,b,c){P(a,b,c),c.MAILID&&zmComp.setMailId(a,c.MAILID),c.REFHEADER&&zmComp.setRefHeader(a,c.REFHEADER),c.INREPLYTO&&zmComp.setInReplyTo(a,c.INREPLYTO),zmComp.setCmpHeader(a,b),T(a);var d=p(a,b,c),e=d.TO,f=d.CC,g=d.BCC;e&&""!==$.trim(e)&&I(a,"to",e),f&&""!==$.trim(f)&&(I(a,"cc",f),zmComp.shCBc(a,"c")),g&&$.trim(g)&&(I(a,"bcc",g),zmComp.shCBc(a,"b"))},W=function(a){var b=a.find("input");b.length&&b.focus(),$(".SC_cs.zmfc").removeClass("zmfc")},X=function(a){var b=$.extend({},zmComp.getFromObj());if(O(a)){var c=O(a);b[c]=zmail.cmpdata.FROM_LIST[c]}var d,e={},f=[];for(var g in b)d={htm:z(g),data:{frm:g,signId:(b[g]||{}).FRM_SIGID}},f.push(d);e.list=f,e.par=$("#zm_fSel_"+a),e.align="pleft",e.clk=function(b){zmCUtil.cmpSTVal(b.signId,b.frm,a),zmUtil.cmpHideMenu()},zmUtil.showMenu(e)},Y=function(a){var b,c=zmComp.getReplyToLst(),d={},e=[];for(var f in c)b={htm:f,data:{frm:f}},e.push(b);d.list=e,d.par=$("#zmrTo_"+a),d.align="pleft",d.clk=function(b){zmCUtil.repSTVal(b.frm,a)},zmUtil.showMenu(d)},Z=function(a){var b=$.extend({},zmComp.getFromObj());if(O(a)){var c=O(a);b[c]=zmail.cmpdata.FROM_LIST[c]}var d=zmComp.objSize(b);1===d?$("#zm_fSel_"+a).children().eq(0).removeClass().addClass("SC_cs SC_np SC_ni"):d>1&&$("#zm_fSel_"+a).off("click").on("click",function(){X(a)});var e=zmComp.objSize(zmComp.getReplyToLst());1===e?$("#zmrTo_"+a).children().eq(0).removeClass().addClass("SC_cs SC_np SC_ni"):e>1&&$("#zmrTo_"+a).off("click").on("click",function(){Y(a)})},aa=function(a,b){"fwdi"===b?$("#zmto_"+a).get(0).scrollIntoView():d[a].info&&!d[a].info.disableScrollIntoView&&$("#zmEdi_"+a).get(0).scrollIntoView()},ba=function(a,b,c){c&&""!==$.trim(c)&&(c=zmCUtil.getText(c),"reply"!==b&&"replyall"!==b||c.match(/^Re:/gi)?"fwdi"!==b||c.match(/^Fwd:/gi)||(c="Fwd: "+c):c="Re: "+c,c=c.substr(0,1e3),$("#zmsub_"+a).val(c),zmComp.setSubject(a,c))},ca=function(a){$("#zmsub_"+a).keyup(function(){d[a]&&"t"===d[a].type&&zmComp.updateTitle(a);var b=$("#zmsub_"+a).val();b&&""!==$.trim(b)&&(zmComp.setModified(a,1),zmComp.setSubject(a,b))}),zmail.showFeature&&zmComp.dropAttachment(a)},da=function(a,b){var c=zmComp.getFwdAtt(a,b.FWDMSG,b.FWDTID),d=c.fwdLst,e=[],f=[];if(d.length){for(var g=c.subject,h=d.length,i=0;i<h;i++)d[i].thrd?f.push(d[i].mId):e.push(d[i].mId),zmComp.attach_fwdme(a,d[i]);zmComp.setFwdThrd(a,f),zmComp.setFwdMsg(a,e),g&&""!==$.trim(g)&&($("#zmsub_"+a).val(b.SUBJECT),zmComp.setSubject(a,g))}},ea=function(a,b){zmComp.removeDiscard();var c="CmpW"+(new Date).getTime(),e=b.mode,f=b.msgId;m(),zmComp.windowCmpId=c,b.data?(a=b.data,a.mdata&&(a=a.mdata)):a.mdata&&(a=a.mdata),d[c]=new l(e),d[c].type="w",d[c].askreceipt?zmComp.setAskReceipt(c,"yes"):zmComp.setAskReceipt(c,"no"),d[c].type=b.type,d[c].info=b.info,a&&!$.isEmptyObject(a)&&(d[c].data=a);var g={};g.cmpId=c,g.type="w";var h=zmCompOpt.headerDOM(g),i=zmCompOpt.recipientDOM(g),j=zmCompOpt.editorDOM(g),k=zmCompOpt.attDOM(g);$("#zmComposeWrapper").append(h,i,j,k),$("#zm_repSel_"+c).addClass("SC_dyn"),zmComp.getReplyto(c)&&$("#zm_repSel_"+c).removeClass("SC_dyn"),$("#zm_fromaddr_"+c).text(zmail.fromAddr),$("#zm_replyto_addr_"+c).text(zmComp.getReplyto(c)),zmComp.setMymId(c,f),b&&b.shId&&zmComp.setShareId(c,b.shId),R(c,e,a),ba(c,e,a.SUBJECT),b.isFwd&&(d[c]._referOpener=!0),b.isPopMail&&(d[c].isPopMail=!0),da(c,a),!a.STATUS2ID||5!==a.STATUS2ID&&6!==a.STATUS2ID&&7!==a.STATUS2ID||(d[c].inlineMode=zmComp.getModeObj("string",a.STATUS2ID)),b.info&&b.info.draftId&&(a.MAILID&&(d[c].discard_mailId=a.MAILID),a.INREPLYTO&&(d[c].discard_inReplyTo=a.INREPLYTO),a.REFHEADER&&(d[c].discard_refHeader=a.REFHEADER)),f&&zmail.mailObj&&zmail.mailObj[f]&&zmail.mailObj[f].FD&&(zmail.folId.teId===zmail.mailObj[f].FD&&(d[c].tempId=f),zmComp.setFID(c,zmail.mailObj[f].FD)),E(c,e);var n=U(c,e,a);V(c,e,a,b);var o="tab";"p"===d[c].type&&(o="inline"),N(c,e,n,o);var p=!1;"reply"!==e&&"replyall"!==e&&"fwdi"!==e||(d[c].loadType="drafted",d[c].changeData=!0,p=!0),b.info&&b.info.loadType&&"drafted"===b.info.loadType&&(d[c].loadType=b.info.loadType,d[c].changeData=!1,p=!1),d[c].loadType&&"drafted"===d[c].loadType&&zmComp.updateMsgObj(f,c),p&&(d[c].loadsave=!0),"compose"!==e&&"fwdi"!==e&&"fwdme"!==e||W($("#zmto_"+c)),F($("#zmto_"+c+" :input")),F($("#zmcc_"+c+" :input")),F($("#zmbcc_"+c+" :input")),F($("#zmsub_"+c)),zmComp.setHeight(c,"w"),Z(c),aa(c,e),D(c,b.type),zmUtil.addCmpAppId(),ca(c),"outbox"===e&&zmComp.updateOutbox()},fa=function(a,c){zmComp.removeDiscard();var e=zmUtil.getCmpAppId(),f=c.mode,g=c.msgId;m(),c.data?(a=c.data,a.mdata&&(a=a.mdata)):a=a.mdata?a.mdata:zmContentCache.get(g),d[e]=new l(f),d[e].askreceipt?zmComp.setAskReceipt(e,"yes"):zmComp.setAskReceipt(e,"no"),d[e].type=c.type,d[e].info=c.info,a&&!$.isEmptyObject(a)&&(d[e].data=a);var h=c.info.prevDOM;if(!h)return void zmComp.showMsg(e,"i","2"+b.preview_notload,"p");var i={};i.cmpId=e,i.type="p",i.msgId=g;var j=zmCompOpt.headerDOM(i),k=zmCompOpt.recipientDOM(i),n=zmCompOpt.editorDOM(i),o=zmCompOpt.attDOM(i),p=$("<div/>");p.attr("class","zm_cmp"),p.attr("id",e+"_"+g),p.append(j,k,n,o),h.html(p),zmUtil.setInlineCmpScope(!0),zmComp.setMymId(e,g),c.info.draftId&&(d[e].discard_Id=c.info.draftId),c&&c.shId&&zmComp.setShareId(e,c.shId),R(e,f,a),ba(e,f,a.SUBJECT),!a.STATUS2ID||5!==a.STATUS2ID&&6!==a.STATUS2ID&&7!==a.STATUS2ID||(d[e].inlineMode=zmComp.getModeObj("string",a.STATUS2ID)),c.info&&c.info.draftId&&(a.MAILID&&(d[e].discard_mailId=a.MAILID),a.INREPLYTO&&(d[e].discard_inReplyTo=a.INREPLYTO),a.REFHEADER&&(d[e].discard_refHeader=a.REFHEADER)),g&&zmail.mailObj&&zmail.mailObj[g]&&zmail.mailObj[g].FD&&(zmail.folId.teId===zmail.mailObj[g].FD&&(d[e].tempId=g),zmComp.setFID(e,zmail.mailObj[g].FD)),E(e,f);var q=U(e,f,a);V(e,f,a,c);var r="tab";"p"===d[e].type&&(r="inline"),N(e,f,q,r);var s=!1;"reply"!==f&&"replyall"!==f&&"fwdi"!==f||(d[e].loadType="drafted",d[e].changeData=!0,s=!0),c.info&&c.info.loadType&&"drafted"===c.info.loadType&&(d[e].loadType=c.info.loadType,d[e].changeData=!1,s=!1),d[e].loadType&&"drafted"===d[e].loadType&&zmComp.updateMsgObj(g,e),s&&(d[e].loadsave=!0),"compose"!==f&&"fwdi"!==f&&"fwdme"!==f||W($("#zmto_"+e)),F($("#zmto_"+e+" :input")),F($("#zmcc_"+e+" :input")),F($("#zmbcc_"+e+" :input")),F($("#zmsub_"+e)),zmComp.setHeight(e),zmComp.updAtMention(e),Z(e),aa(e,f),D(e,c.type),zmUtil.addCmpAppId(),ca(e)},ga=function(a,c){var d=function(){return zmText.get("mailsuite","compose")},e={appname:b.nosubject,defaultAppName:zmText.get("mailsuite","compose"),appId:a,data:{CNodes:"2"},onDelete:zmComp.delCompObj,noPreview:!0,appIcon:"msi-edit",shortcuts:zmshCut.compose,allowDefaultShortcutScope:!1,titleProvider:d,hashKey:"compose",hashChangeHandler:function(a){var b=this;zmUtil.debugLog("Compose hash url changed",a,b)}};zmsuite.isWorkspaceAvailable(a)?c.restore&&zmsuite.resetWorkspace(a,e):zmsuite.setWorkSpace(e)},ha=function(a,c){zmComp.removeDiscard(),ga(a,c);var d=zmsuite.getCenter(),f=d[0].getNodes(),g=["msi-send SC_thm",{txt:b.send}];e.outIntr!==-1&&g.push("msi-barrow");var h={iconList:g,tooltip:b.send,data:"s",dropAction:!0},i={iconList:["msi-schdRecur"],tooltip:b.schedule+" / "+b.recurring,data:"cmp_schedule",separator:!0},j={iconList:["msi-mailReminder"],tooltip:zmText.get("zmreminder").watch.remind,data:"watch",separator:!0};0===e.askReceipt?zmComp.setAskReceipt(a,"yes"):zmComp.setAskReceipt(a,"no");var k=[{txt:b.save_draft,hide_txt:!0},"msi-barrow"],l={iconList:k,tooltip:b.save_as_draft,data:"svedrp",dropAction:!0},m={iconList:["msi-trash"],tooltip:b.discard_draft,data:"d",separator:!0},n={iconList:["msi-action"],tooltip:b.options,separator:!0,data:"o"},o={iconList:[{txt:b.share}],tooltip:b.sharedraft,data:"cmp_share",separator:!0},p={iconList:["msi-priority"],tooltip:b.priority,data:"p",separator:!0},q={iconList:["msi-close"],tooltip:b.close,separator:!0,data:"c"},r=[h,m,n],s=[{groupId:"saveOptions",actionArr:[l]},{groupId:"compPriority",actionArr:[p]},{groupId:"scheduledTime",actionArr:[o]}];s.push({groupId:"schedule",actionArr:[i]}),zmUtil.isZohoAccount(zmail.accId)&&s.push({groupId:"remind",actionArr:[j]}),s.push({groupId:"compRIcons",actionArr:[q]});var t={list:{left:[{groupId:"compIcons",actionArr:r}],right:s},clk:function(c,d,e){var f,g,h=c.target||c.srcElement;if(f=$(h).closest("li"),"s"===e)g={},g.action="compose",g.sendIm=!1,g.cmpId=a,zmCDrop.showDropDown(c,g);else if("cmp_schedule"===e)g={},g.id=a,g.ele=f,g.title=b.schedule+" / "+b.recurring,g.component="compose",g.type=2,zmSchedule.initScRec(g);else if("d"===e){var i={};i.cmpId=a,zmComp.discardCmp(i)}else if("p"===e)g={},g.cmpId=a,g.par=f,g.id="zm_priLst",zmCDrop.show(g),zmUtil.stopEvents(c);else if("o"===e)g={},g.id="zm_compactLst",g.par=f,g.cmpId=a,zmCDrop.show(g);else if("c"===e){var j={};j.cmpId=a,zmComp.comClose(j)}else"ar"===e?zmCUtil.askRepTab(a):"watch"===e?(g={},g.msgId=a,g.loadType="popup",g.openWatch="compose_tab",g.elem=f,zmWatch.showWatch(g)):"svedrp"===e&&("msi-barrow"===d?(g={},g.id="zm_SveLst",g.par=f,g.cmpId=a,zmCDrop.show(g),zmUtil.stopEvents(c)):zmComp.updateDraft(a))}};return f[0].push(t.list),f[0].setListener("click",t.clk),zmsuite.renderWorkSpace(),f[1].$el},ia=function(a,b,c){R(a,b,c),ba(a,b,c.SUBJECT),da(a,c),P(a,b,c),c.MAILID&&zmComp.setMailId(a,c.MAILID),c.REFHEADER&&zmComp.setRefHeader(a,c.REFHEADER),c.INREPLYTO&&zmComp.setInReplyTo(a,c.INREPLYTO),zmComp.setCmpHeader(a,b),T(a);var d=p(a,b,c),e=d.TO,f=d.CC,g=d.BCC;e&&""!==$.trim(e)&&I(a,"to",e),f&&""!==$.trim(f)&&(I(a,"cc",f),zmComp.shCBc(a,"c")),g&&$.trim(g)&&(I(a,"bcc",g),zmComp.shCBc(a,"b")),"fwdi"!==b&&"fwdme"!==b||zmComp.shCBc(a,"c")},ja=function(a){d[a].discard_close=!1,d[a].type="t";var b=ha(a),c={};c.cmpId=a,c.type="t";var e=zmCompOpt.recipientDOM(c),g=zmCompOpt.editorDOM(c),h=zmCompOpt.attDOM(c);b.append(e,g,h),b.addClass("zmCnew"),zmsuite.getCenter()[0].$el.addClass("zm_Ctab");var i=f[a],j=i.from,k=y(j);$("#zm_fromaddr_"+a).text(k);var l=zmComp.getSubject(a);$("#zmsub_"+a).val(l),T(a);var m=i.to,n=i.cc,o=i.bcc,p=i.isCC,q=i.isBCC;m&&""!==$.trim(m)&&I(a,"to",m),p&&zmComp.shCBc(a,"c"),n&&""!==$.trim(n)&&I(a,"cc",n),o&&$.trim(o)&&I(a,"bcc",o),q&&zmComp.shCBc(a,"b"),Q(a),zmsuite.showWorkSpace(a),i.isPriority?(zmsuite.getCenter(a)[0].getNodes()[0].showGroup("compPriority"),zmComp.updatePriority(a)):zmsuite.getCenter(a)[0].getNodes()[0].hideGroup("compPriority"),zmsuite.getCenter(a)[0].getNodes()[0].hideGroup("scheduledTime");var r=zmComp.getEditor(a),s=r.getContent(),t=r.mode,u=zmCUtil.getfontFamily(zmail.mailOpt.ff);"Default"!==u&&(ZE_Init.defaultFontFamily=u),zmail.mailOpt.fs&&(ZE_Init.defaultFontSize=zmail.mailOpt.fs+"pt");var v=zmComp.getMode(a);"compose"===v||"fwdi"===v||"fwdme"===v?ZE_Init.needEditorFocus=!1:ZE_Init.needEditorFocus=!0,ZE_Init.fileUpload=zmComp.editorDropUpload;var w={};w.id="zmEdi_"+a,w.contentChanged=function(){zmail.showFeature&&H(a),zmComp.setLastModified(a,(new Date).getTime()),zmComp.setModified(a,1)},w=J(a,w),w=K(a,w),"plaintext"===t&&(s=ZE.getText(s),w.mode="plaintext"),w.content=s,r=ZE.create(w),zmComp.setEditor(a,r);try{var x=function(a){return function(){zmComp.setModified(a,1),L(a,v)}};zmComp.getEditor(a).afterEditorLoad(x(a,v))}catch(z){}"compose"!==v&&"fwdi"!==v&&"fwdme"!==v||W($("#zmto_"+a)),F($("#zmto_"+a+" :input")),F($("#zmcc_"+a+" :input")),F($("#zmbcc_"+a+" :input")),F($("#zmsub_"+a)),zmComp.setHeight(a),Z(a),zmComp.updateTitle(a),ca(a),zmComp.updateComposer(a,"load_undo_discard")},ka=function(a,b){var c=zmTab.getTabObject(a);$.publish("zmail/SaveTabState",[{appId:a,app:"cmp",appObj:{appId:c.appId,appname:c.appname,appIcon:c.appIcon,data:{cNodes:"2"}},category:"compose_tab",data:b}])},la=function(a,b){var c=zmsuite.getAppRouter(a);c.setParams(b),c.update()},ma=function(a,b,c,e,f){if(zmContentCache.isCached(b)&&!f.newdata)e=zmContentCache.get(b);else{var g={};g.mdata=e.mdata,f.shId||"outbox"===c||"draft"===c||"template"===c||zmUtil.prevCache(b,g),e=g.mdata}return f.data&&(e=f.data,f.data.mdata&&(e=f.data.mdata)),e&&!$.isEmptyObject(e)&&(d[a].data=e),e},na=function(a,b,c,e,f){var g={},h=!1;if(e&&e.shId||f&&f.shId){var i=e.shId||f.shId;zmComp.setShareId(a,i)}if(e&&e.groupId&&(d[a].groupId=e.groupId,d[a].streamsView=e.streamsView),d[a].info&&d[a].info.groupId&&(d[a].groupId=d[a].info.groupId),d[a].info&&d[a].info.streamsView&&(d[a].streamsView=d[a].info.streamsView),d[a].groupId&&d[a].streamsView&&e.REPLYFROM&&(d[a].groupEmailId=e.REPLYFROM),zmComp.setMymId(a,b),!e.STATUS2ID||5!==e.STATUS2ID&&6!==e.STATUS2ID&&7!==e.STATUS2ID||(d[a].inlineMode=zmComp.getModeObj("string",e.STATUS2ID)),d[a]._draftParentId&&!d[a].inlineMode&&(d[a].inlineMode=zmComp.getModeObj("string",7)),d[a]._draftParentId){var j=zmComp.getCmpObjId(d[a]._draftParentId);j.cmpId&&(d[a].update_cmpId=j.cmpId)}if(f.draft_opt&&(d[a].discard_Id=b,d[a].enableDiscard=!0,e.MAILID&&(d[a].discard_mailId=e.MAILID),e.INREPLYTO&&(d[a].discard_inReplyTo=e.INREPLYTO),e.REFHEADER&&(d[a].discard_refHeader=e.REFHEADER)),e.PRIORITY){h=!0;var k="Medium",l=e.PRIORITY;4===l?k="Low":2===l&&(k="High"),zmComp.setPriority(a,k),g.priority=k}g.showPriority=h;var m=!1;e.RMOBJ&&!$.isEmptyObject(e.RMOBJ)&&zmUtil.isZohoAccount(zmComp.getAccId(a))&&(m=!0),g._allowWatch=m,b&&(f.draft_opt||"outbox"===c)&&m&&(d[a].RMOBJ=e.RMOBJ,d[a]._reminder_draft=!0);var n=!1;if(e.SCO&&0!==e.SCO.OT){1===e.SCO.OT?zmSchedule.processScheduleObject(a,e.SCO):2===e.SCO.OT&&zmSchedule.processRecurringObject(a,e.SCO),n=!0;var o="";zmSchedule.getScheduleObject(a)?o=zmSchedule.getScheduleTitle(a):zmSchedule.getRecurringObject(a)&&(o=zmSchedule.showTitle(a)),g.scheduleTitle=o}g._allowSchedule=n,b&&zmail.mailObj&&zmail.mailObj[b]&&zmail.mailObj[b].FD&&zmComp.setFID(a,zmail.mailObj[b].FD),b&&zmail.mailObj&&zmail.mailObj[b]&&zmail.mailObj[b].CT&&(g.cmt=zmail.mailObj[b].CT);var p=A(c,e);return g.from=p,zmComp.setFromAddr(a,p),e.MAILID&&zmComp.setMailId(a,e.MAILID),e.REFHEADER&&zmComp.setRefHeader(a,e.REFHEADER),e.INREPLYTO&&zmComp.setInReplyTo(a,e.INREPLYTO),zmComp.setCmpHeader(a,c),D(a),f.restore||zmUtil.addCmpAppId(),g},oa=function(a,b,c,e,f){zmComp.setType(a,"st");var g=ma(a,b,c,e,f),h=na(a,b,c,g,f),i={};i.data=zmComp.cmpData(),i.appobj=d[a],i.cmpId=a,i.mdata=g,i.updateProp=h;var j={eType:"1",type:"popup",data:i};zmUtil.loadSmartCompose(j)},pa=function(a,b){var c;c=b.restore?b.restoreAppId:zmUtil.getCmpAppId();var e=b.mode;if(!b.restore&&zmsuite.isWorkspaceAvailable(c))return zmsuite.showExistingApp(c),!1;if(m(),d[c]=new l(e),d[c].type=b.type,b&&(d[c].prm=b),b.info&&(d[c].info=b.info),b.draft_threadId&&a.tdata){var f=zmComp.draftParentId(b.msgId,a.tdata);
f&&(d[c]._draftParentId=f)}b.fol_opt&&"tmp"===b.fol_opt&&(d[c].fol_opt="tmp"),b.tempId&&(d[c].tempId=b.tempId);var g=b.msgId,h=zmInit.getListingDetObj();if(h){var i=h.fId;if(i&&i===zmail.folId.dId&&b.draft_opt&&"draft"===b.mode&&_zm._isPrivilegedUser())return void oa(c,g,e,a,b)}var j=ha(c,b),k={};k.cmpId=c,k.type="t";var n=zmCompOpt.recipientDOM(k),o=zmCompOpt.editorDOM(k),p=zmCompOpt.attDOM(k);j.append(n,o,p),j.addClass("zmCnew");var q=!1;"reply"!==e&&"replyall"!==e&&"fwdi"!==e||(q=!0),zmail.allowInline&&(q||d[c]._draftParentId)&&j.removeClass("zmCnew"),zmsuite.getCenter()[0].$el.addClass("zm_Ctab");var r="",s=!1;if(g||b.data){if(a=ma(c,g,e,a,b),a&&a.shId||b&&b.shId){var t=a.shId||b.shId;zmComp.setShareId(c,t)}if(a&&a.groupId&&(d[c].groupId=a.groupId,d[c].streamsView=a.streamsView),d[c].info&&d[c].info.groupId&&(d[c].groupId=d[c].info.groupId),d[c].info&&d[c].info.streamsView&&(d[c].streamsView=d[c].info.streamsView),d[c].groupId&&d[c].streamsView&&a.REPLYFROM&&(d[c].groupEmailId=a.REPLYFROM),zmComp.setMymId(c,g),!a.STATUS2ID||5!==a.STATUS2ID&&6!==a.STATUS2ID&&7!==a.STATUS2ID||(d[c].inlineMode=zmComp.getModeObj("string",a.STATUS2ID)),d[c]._draftParentId&&!d[c].inlineMode&&(d[c].inlineMode=zmComp.getModeObj("string",7)),d[c]._draftParentId){var u=zmComp.getCmpObjId(d[c]._draftParentId);u.cmpId&&(d[c].update_cmpId=u.cmpId)}b.draft_opt&&(d[c].discard_Id=g,d[c].enableDiscard=!0,a.MAILID&&(d[c].discard_mailId=a.MAILID),a.INREPLYTO&&(d[c].discard_inReplyTo=a.INREPLYTO),a.REFHEADER&&(d[c].discard_refHeader=a.REFHEADER)),a.PRIORITY&&(s=!0,zmComp.updPriority(c,a.PRIORITY));var v=!1;if(a.RMOBJ&&!$.isEmptyObject(a.RMOBJ)&&zmUtil.isZohoAccount(zmComp.getAccId(c))&&(v=!0),g&&(b.draft_opt||"outbox"===e)&&v&&(zmWUtil.addWatchTheme(c),d[c].RMOBJ=a.RMOBJ,d[c]._reminder_draft=!0),a.SCO&&0!==a.SCO.OT){1===a.SCO.OT?zmSchedule.processScheduleObject(c,a.SCO):2===a.SCO.OT&&zmSchedule.processRecurringObject(c,a.SCO);var w="",x=zmsuite.getCenter(c)[0].getNodes()[0].$el,y=$(x).find("[data-event='cmp_schedule']");zmSchedule.getScheduleObject(c)?w=zmSchedule.getScheduleTitle(c):zmSchedule.getRecurringObject(c)&&(w=zmSchedule.showTitle(c)),y.addClass("SC_thm"),zmComponent.tooltip({elm:y[0],text:w,arrow:"top"})}g&&zmail.mailObj&&zmail.mailObj[g]&&zmail.mailObj[g].FD&&zmComp.setFID(c,zmail.mailObj[g].FD),r=U(c,e,a),ia(c,e,a)}else P(c),T(c),zmComp.shCBc(c,"c");zmsuite.showWorkSpace(c),zmComp.hideShare(c),s?zmsuite.getCenter(c)[0].getNodes()[0].showGroup("compPriority"):zmsuite.getCenter(c)[0].getNodes()[0].hideGroup("compPriority"),d&&d[c]&&d[c].prm&&"note"===d[c].prm.entityType&&zmComp.enableSave(c),g&&E(c,e,g),N(c,e,r),"reply"!==e&&"replyall"!==e&&"fwdi"!==e||(d[c].loadType="drafted",d[c].changeData=!0),b.info&&b.info.loadType&&"drafted"===b.info.loadType&&(d[c].loadType=b.info.loadType,d[c].changeData=!1),g&&d[c].loadType&&"drafted"===d[c].loadType&&zmComp.updateMsgObj(g,c),d[c].update_cmpId&&zmComp.updateComposer(d[c].update_cmpId,"open_draft_folder"),"compose"!==e&&"fwdi"!==e&&"fwdme"!==e||W($("#zmto_"+c)),F($("#zmto_"+c+" :input")),F($("#zmcc_"+c+" :input")),F($("#zmbcc_"+c+" :input")),F($("#zmsub_"+c)),zmComp.setHeight(c),zmComp.updAtMention(c),Z(c),zmComp.updateTitle(c),ca(c),D(c),b.restore||zmUtil.addCmpAppId(),!g||"draft"!==e&&"template"!==e||(la(c,["draft",g]),ka(c,{mode:"draft",msgId:g})),g&&b.draft_opt&&zmComp.setPrintId(c,g),g&&b.draft_opt&&zmail.isOrg&&zmUtil.isZohoAccount(zmComp.getAccId(c))&&zmComp.draftComments(c,g,"load_draft"),"outbox"===e&&zmComp.updateOutboxView()},qa=function(a,c){zmComp.removeDiscard();var e=f[a],g=zmComp.getMode(a),h=c.msgId,i=c.prevDOM;if(!i)return void zmComp.showMsg(a,"i","1"+b.preview_notload,"p");var j={};j.cmpId=a,j.type="p",j.msgId=h;var k=zmCompOpt.headerDOM(j),l=zmCompOpt.recipientDOM(j),m=zmCompOpt.editorDOM(j),n=zmCompOpt.attDOM(j),o=$("<div/>");o.attr("class","zm_cmp"),o.attr("id",a+"_"+h),o.append(k,l,m,n),i.html(o),d[a].info=c,zmUtil.setInlineCmpScope(!0);var p=e.from;zmComp.setFromAddr(a,p),T(a);var q=e.to,r=e.cc,s=e.bcc,t=e.isCC,u=e.isBCC;q&&""!==$.trim(q)&&I(a,"to",q),t&&zmComp.shCBc(a,"c"),r&&""!==$.trim(r)&&I(a,"cc",r),s&&$.trim(s)&&I(a,"bcc",s),u&&zmComp.shCBc(a,"b"),Q(a),E(a,g),d[a].aftersave="reload_preview";var v=zmComp.getEditor(a),w=v.mode,x=v.getContent();M(a,w,x,zmComp.getMode(a)),zmComp.setHeight(a),"compose"!==g&&"fwdi"!==g&&"fwdme"!==g||W($("#zmto_"+a)),F($("#zmto_"+a+" :input")),F($("#zmcc_"+a+" :input")),F($("#zmbcc_"+a+" :input")),aa(a)},ra=function(a){d[a].type="t";var b=ha(a),c={};c.cmpId=a,c.type="t";var e=zmCompOpt.recipientDOM(c),g=zmCompOpt.editorDOM(c),h=zmCompOpt.attDOM(c);b.append(e,g,h),zmsuite.getCenter()[0].$el.addClass("zm_Ctab");var i=f[a],j=i.from,k=y(j);$("#zm_fromaddr_"+a).text(k);var l=zmComp.getSubject(a);$("#zmsub_"+a).val(l),T(a);var m=i.to,n=i.cc,o=i.bcc,p=i.isCC,q=i.isBCC;m&&""!==$.trim(m)&&I(a,"to",m),p&&zmComp.shCBc(a,"c"),n&&""!==$.trim(n)&&I(a,"cc",n),o&&$.trim(o)&&I(a,"bcc",o),q&&zmComp.shCBc(a,"b"),Q(a),zmsuite.showWorkSpace(a),zmsuite.getCenter(a)[0].getNodes()[0].hideGroup("compPriority"),zmsuite.getCenter(a)[0].getNodes()[0].hideGroup("scheduledTime"),d[a].aftersave="move_tab";var r=zmComp.getEditor(a),s=r.mode,t=u(a,r),v="tab";"p"===d[a].type&&(v="inline"),M(a,s,t,zmComp.getMode(a),v);var w=d[a].info.msgId,x=zmComp.getMode(a);E(a,x,w),"compose"!==x&&"fwdi"!==x&&"fwdme"!==x||W($("#zmto_"+a)),F($("#zmto_"+a+" :input")),F($("#zmcc_"+a+" :input")),F($("#zmbcc_"+a+" :input")),F($("#zmsub_"+a)),zmComp.setHeight(a),zmComp.updAtMention(a),Z(a),zmComp.updateTitle(a),ca(a)},sa=function(a){if(!isNaN(a)){var b=[" bytes"," KB"," MB"," GB"," TB"," PB"," EB"," ZB"," YB"],c=Math.floor(Math.log(Number(a))/Math.log(2));c<1&&(c=0);var d=Math.floor(c/10);return a=Number(a)/Math.pow(2,10*d),a.toString().length>a.toFixed(1).toString().length&&(a=a.toFixed(1)),a+b[d]}},ta=function(a,b){var c="";b&&(c=b),"send"===c&&d[a]&&zmComp.setStatus(a,!1),"save"===c&&d[a]&&(d[a].saveReq=!1,d[a].savedraft=!1)},ua=function(a){var c=a.cmpId,e=a.errType,f=a.type,g=a.resp,h=a.triggerType;if(ta(c,h),e&&"serverError"===e&&g){var i="HTML";g.errorCode&&g.errorCode!==-1&&7020!==g.errorCode&&(i="TEXT"),zmComp.showMsg(c,"e",g.error,f,void 0,i)}if(e&&"sendError"===e){var j="Request failed";g&&g.msg&&(j=g.msg),zmComp.showMsg(c,"e",j,f)}if("save"===h&&d&&d[c]){var k=b.save_draft;if(d[c].draft_saved_txt){var l=b.save_lastmodified;k=zmText.applyArgs(l,{TIME:d[c].draft_saved_txt})}zmComp.updDraftText(c,k)}},va=function(a,b){var c={};c.cmpId=b.cmpId,c.resp=a,c.type=b.type,c.errType="sendError",c.triggerType=b.triggerType,ua(c)},wa=function(a){var b={};b.cmpId=a.cmpId,b.type=a.type,b.errType="networkError",b.triggerType=a.triggerType,ua(b)},xa=function(a,b){var c={};c.cmpId=b.cmpId,c.resp=a,c.type=b.type,c.errType="serverError",c.triggerType=b.triggerType,ua(c)},ya=function(a){if(d&&d[a]&&d[a].auto_mailId){var b=zmComp.getAccId(a),c=d[a].auto_mailId;zmComp.clearDraft(b,c)}},za=function(a,b){ta(a,b.triggerType)},Aa=function(a,c){var f,g=c.cmpId,h=c.act,i=c.mode,j=c.sendImm,k=c.tempact,l=c.type,m=c.mymId;d&&d[g]&&d[g].capSave&&a&&a.dmailid&&(f=$.trim(a.dmailid),d[g].auto_mailId=f,d[g].capSave=!1),c._dupDraft&&d&&d[g]&&ya(g),za(g,c);var n,o=!1,p="",q="";if(a.error)xa(a,c);else{zmComp.setModified(g,0),zmComp.setLastModified(g,0),zmComp.setPrevModified(g,(new Date).getTime()),d[g].changeData=!1,zmail.userOptions&&1===zmail.userOptions.autoAddContacts&&zmComp.addContacts(g);var r={},s={};if(s.cmpId=g,s.msgId=m,"sdraft"===h||"stemplate"===h){var t=$.trim(a.msgId);if(t&&zmComp.setPrintId(g,t),a.msgObj&&zmComp.setMetaObj(g,a.msgObj),"sdraft"===h&&c&&c.close)r.draftId=$.trim(a.msgId),d[g].dftId=$.trim(a.msgId),d[g]&&d[g].mymId&&(r.msgId=d[g].mymId),d[g]&&d[g]._draftParentId&&(r.msgId=d[g]._draftParentId),p="Draft saved @ "+a.dftst,zmComp.showMsg(g,"s",p,l),s.triggerType="close_preview_aftersave",d[c.cmpId].smartData&&d[c.cmpId].smartData.afterClose&&(s.afterClose=d[c.cmpId].smartData.afterClose),zmComp.comClose(s);else if("sdraft"===h){var u=$.trim(a.msgId);$.publish("/compose/savedraft",{draftId:u}),r.draftId=$.trim(a.msgId),d[g].dftId=$.trim(a.msgId),d[g]&&d[g].mymId&&(r.msgId=d[g].mymId),d[g]&&d[g]._draftParentId&&(r.msgId=d[g]._draftParentId),f=$.trim(a.dmailid);var v=$.trim(a.msgId);d[g].discard_mailId=f,d[g].discard_Id=v,v&&(d[g].draftId=v),f&&(d[g].dmailid=f),c.refHeader&&(d[g].discard_refHeader=c.refHeader),c.inReplyTo&&(d[g].discard_inReplyTo=c.inReplyTo),zmail.folId&&zmComp.setFID(g,zmail.folId.dId),q=b.save_lastmodified,p=zmText.applyArgs(q,{TIME:a.dftst}),d[g].draft_saved_txt=a.dftst,zmComp.updDraftText(g,p),!zmail.isComposeMail&&zmComp.getCurrentCompId()&&(la(g,["drafts",u]),ka(g,{mode:"draft",msgId:u}));var w=zmUtil.isZohoAccount(zmComp.getAccId(g));if("p"!==d[g].type&&zmail.isOrg&&w)if(d[g].shareloaded)zmComp.loadNotify(g,v);else{zmComp.showShare(g);var x=zmComp.getShareEle(g),y=x.liObj,z=x.txtObj;z.text(b.share),y.off("click").on("click",function(){zmComp.draftComments(g,v,"load_share")})}}else if("stemplate"===h){var A=$.trim(a.msgId);A&&(d[g].tempId=A),zmail.folId&&zmComp.setFID(g,zmail.folId.teId),p=k?b.template_modified:b.template_saved,zmComp.showMsg(g,"s",p,l)}}else{var B="";e.outIntr===-1||j||(o=!0),a.scheduledTime?(q=b.scheduled_time,p=zmText.applyArgs(q,{TIME:a.scheduledTime}),B=p):o?B=b.message_scheduled:_zm._isPrivilegedUser()?zmRecall.showRecallBand(a.UUID):B=b.message_sent,n=d[g].discard_Id,d[g]&&d[g].type&&"d"===d[g].type&&(d[g].closeQuick=!0),s.triggerType="close_view_aftersend",s.msgTxt=B,d[g].smartData&&d[g].smartData.afterClose&&(s.afterClose=d[g].smartData.afterClose),zmComp.comClose(s),c.bcc&&$.publish("/compose/bccpresent",{cmpID:g,mailID:d[g]?d[g]._draftParentId||d[g].mymId:""})}var C="";zmail.isComposeMail&&(C="w");var D=zmComp.getOpener();D&&D.zmUtil.postMailActionsOnSend({action:h,msgId:m,draftObj:a.msgObj,draftDataObj:r,draftId:n,schedule:o,mode:i,cmpType:C}),zmail.isComposeMail||zmUtil.postMailActionsOnSend({action:h,msgId:m,draftObj:a.msgObj,draftDataObj:r,draftId:n,schedule:o,mode:i,cmpType:C})}},Ba=function(a){for(var b,c=[],d=0;d<a.length;d++)a[d]!==b&&c.push(a[d]);return a=c},Ca=function(a,c,e,f){var g=d[a].type,h="";if(""===c.address&&""===e.address&&""===f.address&&(h=b.please_select_recipients,c.error!==!0&&e.error!==!0&&f.error!==!0||(h=b.address_invalid)),h){zmComp.showMsg(a,"i",h,g);var i;if("st"===g){var j=d[a].smartData.domLst.toPar;i=$(j).find("input").eq(0)}else i=$("#zmto_"+a);return W(i),!1}return!0},Da=function(a,b){for(var c in d)if(!zmComp.discard_cmpId||zmComp.discard_cmpId!==c){if(zmail.allowInline){var e=!1;"reply"!==b&&"replyall"!==b&&"fwdi"!==b||(e=!0);var f=!1;if(d[c].loadType&&"drafted"===d[c].loadType&&(f=!0),d[c].mymId===a&&f&&e)return c}if("template"===b)return!1;if(d[c].mode===b&&d[c].mymId===a||d[c].dftId===a)return c}return!1},Ea=function(a){var b,c,e={},f=!1,g=!1,i=!1;for(var j in d){if(d[j].loadType&&"drafted"===d[j].loadType&&(f=!0,e._loadType="drafted"),d[j].discard_close||(g=!0,e._discard=!0),d[j]._draftParentId&&d[j]._draftParentId===a&&(i=!0,e.__draftParentId=!0),d[j].draftId&&d[j].draftId===a&&(i=!0),i&&g){b=j;break}if(d[j].mymId===a&&f&&g){b=j;break}}if(b&&d[b].type&&"t"===d[b].type)c=zmComp.constants.DRAFT_LOAD_TAB;else if(b&&d[b].type&&"p"===d[b].type){var l=new k(b,"p");l.listObj.push(d[b].info.prevDOM),h[b]=l,c=zmComp.constants.DRAFT_LOAD_INLINE}return b&&(e.cmpId=b),c&&(e.composerType=c),e},Fa=function(){zmUtil.loadZDocs(),window.onbeforeunload=function(a){if(zmComp.chkModified()){var c=b.unsent_alert;return"undefined"==typeof a&&(a=window.event),a&&(a.returnValue=c),c}},$.subscribe("ZMAIL_MOUSE_DOWN_EVENT",function(){try{for(var a in d)zmCUtil.hideSugMenu(a)}catch(b){}}),$.subscribe("smartCompose/onClose",function(a,b){try{if(b.mailObj){var c=b.mailObj.cmpId;d[c].discard_close||delete d[c]}zmUtil.stopEvents(a)}catch(e){}}),$(window).resize(function(){var a=zmComp.getCurrentCompId();if(a&&d[a]){var b=d[a].type;a&&b&&"t"===b?zmComp.setTabHeight(a):a&&b&&"w"===b&&zmComp.setWindowHeight(a)}zmComp.resizeDialog(),zmComp.resizeAllTab()}),$.subscribe("mailsuite/appOpened",function(a,b){b&&b===zmComp.getCurrentCompId()&&d&&d[b]&&d[b].resizeTab&&(d[b].resizeTab=!1,zmComp.setTabHeight(b))}),$.subscribe("/announcement/show",function(){zmComp.resizeCmpTab()}),$.subscribe("/announcement/hide",function(){zmComp.resizeCmpTab()})},Ga={cleanArray:Ba,getSize:sa,I18N:b,windowCmpId:null,compose:function(a,b){var c={act:"compose",mode:"compose"};a&&(c.data=a),b&&b.entityType&&(c.entityType=b.entityType),c.type="t",pa({},c)},getFwdAtt:function(a,b,c){var e,f={},g=[],h="",i=zmail.mailObj;if(d[a]._referOpener){var j=zmComp.getOpener();j&&(i=j.zmail.mailObj)}if(b&&b.length)for(var k=b.length,l=0;l<k;l++)e={},e.mId=b[l],e.thrd=!1,e.sub=i[b[l]].SB,h=i[b[0]].SB,g.push(e);if(c&&c.length)for(var m=c.length,n=0;n<m;n++)e={},e.thrd=!0,e.mId=i[c[n]].T,e.sub=i[c[n]].SB,""===h&&(h=i[c[0]].SB),g.push(e);return f.subject=h,f.fwdLst=g,f},cmpFwd:function(a,b,c){var d,e,f={},g=zmUtil.getFwdArr(c,b);g.mId&&g.mId.length&&(f.FWDMSG=g.mId),g.tId&&g.tId.length&&(f.FWDTID=g.tId);var h={act:"compose",mode:"fwdme"};h.data=f,h.type="t",g.folderId&&(h.folderId=g.folderId),d&&zmUtil.isSharedFolder(d)&&(e=zmUtil.getShareId(d)),e&&(h.shId=e),pa({},h)},chgReply:function(a,b,c,e){var f="";"replyall"===a?f="msi-replyall":"reply"===a?f="msi-reply":"fwdi"===a?f="msi-forward":"eanew"===a&&(f="msi-edit"),$($(e).find("i")[0]).removeClass().addClass(f);var g=$(e).parent().attr("cmprid");g||(g=$(e).closest("ul").attr("cmprid"));var h;g&&(h=g.split("_")[1]),b||(b=d[h].type);var i=!1;if(d[h].isChanged||(i=!0),d[h].changeData||(i=!1),i){var j=zmContentCache.get(c),k=U(h,a,j);k||(k="&nbsp;"),zmComp.getEditor(h).setContent(k),ba(h,a,j.SUBJECT)}zmComp.updRepView(h,b,a,c),"fwdi"===a&&W($("#zmto_"+h))},modeInline:function(a){var b=a.mode,c=!1,d=!1;return"reply"!==b&&"replyall"!==b&&"fwdi"!==b||(d=!0),a.loadType&&"drafted"===a.loadType&&(d=!0),a.prevDOM&&a.prevDOM.length&&d&&(c=!0),c},cmpReply:function(a){var b,c,d=a.mode,e=a.type,f=a.msgId;f&&(c=zmComp.getCmpObjId(f),c.cmpId&&(b=c.cmpId));var g=d;a.loadMode&&(g=a.loadMode);var h=!1;if("reply"!==g&&"replyall"!==g&&"fwdi"!==g||(h=!0),zmail.allowInline&&b&&h)return void zmComp.cmpRE(b,g,e,f,a);var i=!1,j=zmComp.modeInline(a);a.data&&$.isEmptyObject(a.data)&&a.reopen&&(i=!0);var k=!1;zmail.allowInline&&j&&e&&"p"===e&&!i?(!$.isEmptyObject(a.data)&&a.draftId&&(k=!0),!a.draftId&&zmContentCache.get(f)&&(k=!0),b&&(a.cmpId=b),k?zmComp.cmpPrev(a):zmComp.addComposer(a)):"fwdme"===d?zmComp.cmpFwd(d,e,f):("p"===e&&(e="t"),zmComp.cmpRF(d,e,f,a))},setCmpId:function(a,b){i[a]=b},getCmpId:function(a){return i[a]},setMsgId:function(a,b){g[a]=b},getMsgId:function(a){return g[a]},cmpRE:function(a,c,e,f){var g,h;if(!zmUtil.isChildWindow()&&zmsuite.isWorkspaceAvailable(a)){zmsuite.showExistingApp(a);var i=!1;if(d[a].isChanged||(i=!0),d[a].changeData||(i=!1),i){var j=zmContentCache.get(f),k=U(a,c,j);k||(k="&nbsp;"),zmComp.getEditor(a).setContent(k)}g=c,h="msi-reply","replyall"===g?h="msi-replyall":"fwdi"===g?h="msi-forward":"eanew"===g&&(h="msi-edit"),zmComp.setModified(a,1),$("#zmRepIcn_"+a).removeClass().addClass(h),zmComp.updRepView(a,e,c,f),"fwdi"===c&&W($("#zmto_"+a))}else{g=c,h="msi-reply","replyall"===g?h="msi-replyall":"fwdi"===g?h="msi-forward":"eanew"===g&&(h="msi-edit"),zmComp.setModified(a,1),$("#zmRepIcn_"+a).removeClass().addClass(h),zmComp.updRepView(a,e,c,f),aa(a),"fwdi"===c?W($("#zmto_"+a)):zmComp.getEditor(a).win.focus();var l=b.already_editing+"(1)";d[a].loadPrevious=l}},cmpPrev:function(a){var c=a.mode,e=a.type,f=a.msgId,g=a.cmpId;if(g)if(zmsuite.isWorkspaceAvailable(g))zmsuite.showExistingApp(g);else{var h=b.already_editing+"(3)";d[g].loadPrevious=h,zmComp.loadPreview(g,a)}else{var i={mode:c,msgId:f,type:e};if(i.type="p",zmComp.getFolId(f)){var j=zmComp.getFolId(f);zmUtil.isSharedFolder(j)&&(i.shId=zmUtil.getShareId(j))}i.info=a,a.loadType&&"drafted"===a.loadType?(i.data=a.data,fa({},i)):fa({mdata:zmContentCache.get(f)},i)}},cmpRF:function(a,c,e,f){var g;if(e)g=e;else if("r"===c)g=zmInit.rclkId,g.indexOf("t")!==-1&&(g=zmComp.zmsubStr(g,"t"));else{var h=zmUtil.getSelectedMails(),i=[];h[0].length?i=h[0]:h[1].length&&(i=h[1]),g=i[0]}var j=Da(g,a);if(j)if(zmsuite.isWorkspaceAvailable(j))zmsuite.showExistingApp(j);else{var k=b.already_editing+"(4)";d[j].loadPrevious=k}else{var l={accId:zmail.accId,act:"compose"};"outbox"===a&&(l.mode=a);var m={mode:a,msgId:g};if(zmComp.getFolId(g)){var n=zmComp.getFolId(g);if(zmail.folId.teId===n&&(m.fol_opt="tmp",m.tempId=g),zmail.folId.dId===n){m.draft_opt=!0;var o=zmComp.draftThreadId(g);o&&(m.draft_threadId=o)}"outbox"===a&&(l.folId=n,m.folId=n),zmUtil.isSharedFolder(n)&&(l.shId=zmUtil.getShareId(n),m.shId=zmUtil.getShareId(n))}m.type="t";var p=!0;if(f&&!$.isEmptyObject(f)&&(m.info=f,f.restore&&(m.restore=f.restore,m.restoreAppId=f.restoreAppId),f.msgId&&(l.msgId=f.msgId),f.accId&&(l.accId=f.accId),f.entityId&&(l.entityId=f.entityId),f.groupId&&(l.groupId=f.groupId),f.streamsView&&(l.streamsView=f.streamsView),f.entityType&&(l.entityType=f.entityType),f.actionType&&(l.actionType=f.actionType)),zmContentCache.isCached(g)&&!zmContentCache.get(g).SHRINKED&&"outbox"!==a&&(p=!1),m.draft_opt&&(p=!0,m.newdata=!0),f.reqData&&(p=!0),p){l.msgId=g,l.vfc=!0,m.draft_threadId&&(l.summary=!0,l.thId=m.draft_threadId);var q={u:zmail.conPath+"/compose.do",t:"GET",act:"compose",fn:pa,p:l,ep:m};zmAjq.XHR(q)}else pa({mdata:zmContentCache.get(g)},m)}},getFolId:function(a){var b=null;return zmail.mailObj[a]&&zmail.mailObj[a].FD&&(b=zmail.mailObj[a].FD),b},draftThreadId:function(a){var b=null;return zmail.mailObj[a]&&zmail.mailObj[a].T&&(b=zmail.mailObj[a].T),b},addRefHeader:function(a,b){return a&&a.indexOf(b)===-1&&(a=a+" "+b),a},getRlyType:function(a){var b=!1;return"outbox"===a||"draft"===a||"compose"===a||"eanew"===a||"fwdme"===a?b=!1:"reply"!==a&&"replyall"!==a&&"fwdi"!==a||(b=!0),b},setCmpHeader:function(a,b){var c=zmComp.getMailId(a),e=zmComp.getInReplyTo(a),f=zmComp.getRefHeader(a),g=zmComp.getRlyType(b);g?(c&&(d[a].data_inReplyTo=c),e&&(d[a].data_refHeader=zmComp.addRefHeader(f,e))):(c&&(d[a].data_mailId=c),e&&(d[a].data_inReplyTo=e),f&&(d[a].data_refHeader=f))},getCmpHeader:function(a){var b={};return d[a].data_mailId&&(b.mailId=d[a].data_mailId),d[a].data_inReplyTo&&(b.inReplyTo=d[a].data_inReplyTo),d[a].data_refHeader&&(b.refHeader=d[a].data_refHeader),b},sendMail:function(a){var c,f,g,h,i,j,k,l;a&&(c=a.action,f=a.sendIm,g=a.cmpId,h=a.actVal,i=a.type,j=a.autosave,k=a.data,l=a.tmpUpdate),g||(g=zmComp.getCurrentCompId()),i=d[g].type;var m="compose";"sdraft"===c?m="draft":"stemplate"===c?m="template":d[g].mode&&(m=d[g].mode),"compose"!==c||"draft"!==m&&"template"!==m||(m="compose");var n="";n="template"===m?"template":"draft"!==m?"send":"save";var o=zmComp.getStatus(g),p=!1;if(o&&"send"===n&&(p=!0),o&&j&&"adraft"===j&&(p=!0),"save"===n&&d[g]&&d[g].savedraft&&!d[g].dmailid&&(p=!0),!p){var r={accId:d[g].accId},s={cmpId:g};if(s.type=i,"template"===m&&d&&d[g]&&d[g].tempId){if(!l)return void zmComp.tempOverWrite(g);r.tempact=!0,s.tempact=!0}var t=zmComp.getMymId(g);t&&(d[g]&&"eanew"!==d[g].mode&&"template"!==n&&(r.mymId=t),s.mymId=t),r.originalMode=m,s.mode=m,s.act=c;var u=d[g].inlineMode;if(u&&("reply"===u||"replyall"===u||"fwdi"===u)){var v=zmComp.getModeObj("int",u);v&&(r.fwdInlineMode=v,s.fwdInlineMode=v)}k&&(d[g].smartData=k);var w="",x="",y="",z={},A={},B={};z=q(g,"to"),A=q(g,"cc"),B=q(g,"bcc"),z.address&&(w=z.address),A.address&&(x=A.address),B.address&&(y=B.address);var C,D;if(zmComp.getAttRef(g)&&(D=zmComp.getAttRef(g),C=D.getStoreAttachments(!0),D.isUploadInProgress()&&(!j||"adraft"!==j)))return void zmComp.showMsg(g,"e",b.process_alert,i,"u");if(d[g].imagepending)return void zmComp.showMsg(g,"e",b.imageupload_process,i,"u");var E=!0;if("draft"!==m&&"template"!==m&&(E=Ca(g,z,A,B,i)),E&&E){var F=zmComp.getFromAddr(g),G=zmComp.getFromObj(),H="";G[F]&&G[F].FRM_DISN&&(H=G[F].FRM_DISN),H&&(H='"'+H.replace(/(^|[^\\])"/g,'$1\\"')+'"',F=H+" <"+F+">"),r.from=F,r.to=w,r.cc=x,r.bcc=y,r.bcc&&(s.bcc=r.bcc);var I="";I="st"===i?zmComp.getSubject(g):$("#zmsub_"+g).val(),I&&(I=$.trim(I));var J=!1;"draft"!==m&&"template"!==m&&(J=!0),d[g].sendImm=!1,f&&(d[g].sendImm=!0);var K=d[g].subfalse;if(""===I&&J&&!K)return void zmComp.boxSubject(g);var L=!1;if(e.outIntr===-1||f||(L=!0),L&&I&&I.length>251)return zmComp.showMsg(g,"e",b.lengthy_subject,i),void $("#zmsub_"+g).focus();var M,N,O,P=!1;C&&(N=C.myAttachment,O=C.tempLocation);var Q=zmComp.getEditor(g),R=!0;h&&"attfalse"===h&&(R=!1);var S=!1;switch(m){case"compose":case"reply":case"replyall":case"fwdi":case"fwdme":case"eanew":S=!0}if(S&&R){var T=!1;if(N&&N.length?T=!0:O&&O.length&&(T=!0),!T&&(M=Q.getContent(),P="plaintext"===Q.mode?zmAttReminder.isFileNeedToAttach(M):zmAttReminder.isFileNeedToAttach(zmCUtil.removeNotToParse(M))))return void zmComp.remindAtt(g,P)}if("richtext"===Q.mode&&zmComp.getZDStr(g)&&(r.docId=zmComp.getZDStr(g),r.shareType="private"),"plaintext"===Q.mode&&zmComp.getZDocLink(g).length&&(r.docId=zmComp.getZDocLink(g),r.shareType="private"),"send"===n&&zmComp.getZDStr(g)&&"send_with"===a.zDocShare){var U=a._sReq;if(U)for(var V in U)r[V]=U[V],s[V]=U[V]}if(!a.zDocShare&&"send"===n&&zmComp.getZDStr(g))return void zmCDoc.showBox(g,$.extend({},a));r.subject=I,s.subject=I;var W=zmComp.getAskReceipt(g);W&&"yes"===W&&(r.askReceipt=W),r.sendImm=!1,s.sendImm=!1,f&&(r.sendImm=!0,s.sendImm=!0);var X=0,Y="",Z=Q.mode;if(M="send"===n?Q.getRawContent():Q.getContent(),"plaintext"!==Z&&(X=2,"draft"!==m&&"template"!==m&&M.indexOf("Zm-_Id_-Sgn")!==-1&&(M=M.replace(/Zm-_Id_-Sgn/gi,""))),"outbox"!==m&&"plaintext"!==Z){if("reply"===m||"replyall"===m||"draft"===m||"template"===m){var _=$(Q.doc.body),aa=_.find("div[name=ZM_SHWTRIM]");aa.length&&aa.remove();var ba=_.find("div.zmail_extra");ba.length&&ba.show(),M="send"===n?Q.getRawContent():Q.getContent()}Y="<div style='font-size:"+zmail.mailOpt.fs+"pt;";var ca=zmCUtil.getfontFamily(zmail.mailOpt.ff);"Default"!==ca&&(Y+="font-family:"+ca+";"),Y+="'>"+M+"</div>"}else Y=M;r.content=Y,r.smType=X,r.charSet=zmComp.getCharSet(g),r.replyTo=zmComp.getReplyto(g),r.priority=zmComp.getPriority(g);var da=!1;!zmUtil.isChildWindow()&&zmWatch&&zmWatch.getAvoidWatch(g)&&(da=!0);var ea=!1;!zmUtil.isChildWindow()&&zmWatch&&zmWatch.getModified(g)&&(ea=!0);var fa;if(da||ea||!d[g].RMOBJ?!zmUtil.isChildWindow()&&zmWatch&&zmWatch.allowWatch(g)&&!da&&(fa=zmWatch.getWatchType(g),1!==fa&&2!==fa&&3!==fa||(r.watchType=fa,r.reminderMode=0,r.reminderDesc=zmWatch.getReminderDesc(g),!fa||1!==fa&&2!==fa||(r.reminderType=zmWatch.getReminderType(g),r.reminderMode=zmWatch.getReminderMode(g),r.rDate=zmWatch.getReminderDate(g)+":00"))):(fa=d[g].RMOBJ.WT,1!==fa&&2!==fa&&3!==fa||(r.watchType=fa,r.reminderMode=0,r.reminderDesc=d[g].RMOBJ.RMDSC,1!==fa&&2!==fa||(d[g].RMOBJ.RMM&&"undefined"!=typeof d[g].RMOBJ.RMM&&(r.reminderMode=d[g].RMOBJ.RMM),d[g].RMOBJ.RMT&&"undefined"!=typeof d[g].RMOBJ.RMT&&(r.reminderType=d[g].RMOBJ.RMT),d[g].RMOBJ.RMD&&(r.rDate=d[g].RMOBJ.RMD)))),!zmUtil.isChildWindow()&&zmSchedule){var ga=zmSchedule.getScheduleObject(g);ga&&(f=!1,r.OT="1",r.SCT=ga.scheduleType,""!==ga.customTime&&(r.SCTI=ga.customTime+":00"));var ha=zmSchedule.getRecurringObject(g);ha&&(r=$.extend(r,ha),f=!1,r.OT="2")}var ia=!0;if("eanew"!==zmComp.getMode(g)&&"fwdme"!==zmComp.getMode(g)||(ia=!1),(d[g].newsave||d[g].fol_opt&&"tmp"===d[g].fol_opt)&&(ia=!1),ia){var ja=zmComp.getCmpHeader(g);ja.mailId&&(r.mailId=ja.mailId),ja.inReplyTo&&(r.inReplyTo=ja.inReplyTo),ja.refHeader&&(r.refHeader=ja.refHeader)}d[g].discard_refHeader&&(r.refHeader=d[g].discard_refHeader),d[g].discard_inReplyTo&&(r.inReplyTo=d[g].discard_inReplyTo),d[g].dmailid&&(r.mailId=d[g].dmailid),"template"===n&&d[g].tempId&&(r.mymId=d[g].tempId,s.tempId=d[g].tempId),r.refHeader&&(s.refHeader=r.refHeader),r.inReplyTo&&(s.inReplyTo=r.inReplyTo),N&&N.length&&(r.attEntObj=JSON.stringify(N),D&&D.isStreamView()&&(r.streamsView=!0)),O&&O.length&&(r.attTmpObj=JSON.stringify(O));var ka=zmComp.getFwdMsg(g);ka&&ka.length&&(r.fwdMsgIds=ka);var la=zmComp.getFwdThrd(g);if(la&&la.length&&(r.fwdtId=la),h&&"close"===h)s.close=!0;else{var ma=I&&(I.length>150?I.substring(0,150):I)||b.nosubject,na=zmText.applyArgs(b.sending_subject,{SUBJECT:ma}),oa=!1;"draft"===m?(na=d[g].newsave?b.resaving_draft:b.saving_draft,i&&"p"===i&&(na=b.saving),oa=!0):"template"===m&&(na=b.saving_temp),oa?zmComp.updDraftText(g,na):zmComp.showMsg(g,"s",na,i,"i")}d&&d[g]&&d[g].groupId&&(r.groupId=s.groupId=d[g].groupId,r.streamsView=s.streamsView=d[g].streamsView),zmComp.getShareId(g)&&(r.shId=zmComp.getShareId(g),s.shId=zmComp.getShareId(g)),"save"!==n||r.mailId||(d[g].savedraft=!0),"save"===n&&!r.mailId&&j&&"adraft"===j&&(d[g].capSave=!0),"send"===n&&d[g].saveReq&&d[g].capSave&&(s._dupDraft=!0),s.triggerType="send","save"===n&&(s.triggerType="save",d[g].saveReq=!0),"send"===n&&zmComp.setStatus(g,!0),zmAjq.XHR({u:zmail.conPath+"/send.do",t:"POST",fn:Aa,p:r,ep:s,csr:"s",onerror:va,onnetfailure:wa})}}},getPriority:function(a){return d[a].priority},setPriority:function(a,b){d[a].priority=b},getMymId:function(a){return d[a].mymId},setMymId:function(a,b){d[a].mymId=b},getPrintId:function(a){return d[a].printId},setPrintId:function(a,b){d[a].printId=b},getMetaObj:function(a){return d[a].metaobj},setMetaObj:function(a,b){d[a].metaobj=b},getMailId:function(a){return d[a].mailId},setMailId:function(a,b){d[a].mailId=b},getInReplyTo:function(a){return d[a].inReplyTo},setInReplyTo:function(a,b){d[a].inReplyTo=b},setPrevModified:function(a,b){d[a].prevModified=b},getPrevModified:function(a){return d[a].prevModified},setLastModified:function(a,b){d[a].lastModified=b},getLastModified:function(a){return d[a].lastModified},getRefHeader:function(a){return d[a].refHeader},setRefHeader:function(a,b){d[a].refHeader=b},getCharSet:function(a){return d[a].charset},setCharSet:function(a,b){d[a].charset=b},getStatus:function(a){return d[a].process},setStatus:function(a,b){d[a].process=b},getSubject:function(a){return d[a].subject},setSubject:function(a,b){d[a].subject=b},getFromAddr:function(a){return d[a].fromAddr},setFromAddr:function(a,b){d[a].fromAddr=b},getReplyto:function(a){return d[a].replyto},setReplyto:function(a,b){d[a].replyto=b},getShareId:function(a){return d[a].shareId},setShareId:function(a,b){d[a].shareId=b},getInterVal:function(a){return d[a].interval},setInterVal:function(a,b){d[a].interval=b},getAttTmp:function(a){return d[a].attTmpObj},setAttTmp:function(a,b){d[a].attTmpObj.push(b)},getFwdThrd:function(a){return d[a].fwdThrdObj},setFwdThrd:function(a,b){d[a].fwdThrdObj=b},getFwdMsg:function(a){return d[a].fwdMsgObj},setFwdMsg:function(a,b){d[a].fwdMsgObj=b},getAttEnt:function(a){return d[a].attEntObj},setAttEnt:function(a,b){zmComp.getAttEnt(a)?d[a].attEntObj=d[a].attEntObj.concat(b):d[a].attEntObj=b},getAttEntity:function(a){return d[a].attEntity},setAttEntity:function(a,b){zmComp.getAttEntity(a)?d[a].attEntity=d[a].attEntity.concat(b):d[a].attEntity=b},getEditor:function(a){return d[a].editor},setEditor:function(a,b){d[a].editor=b},getAttRef:function(a){return d[a].attCompRef},setAttRef:function(a,b){d[a].attCompRef=b},getType:function(a){return d[a].type},setType:function(a,b){d[a].type=b},getSmartData:function(a){return d[a].smartData},setSmartData:function(a,b){d[a].smartData=b},getTemplate:function(){return c.tempObj},setTemplate:function(a){c.tempObj=a},getEncodeList:function(){return c.encode},setEncodeList:function(a){c.encode=a.split(",")},getSignObj:function(){return c.signObj},setSignObj:function(a){c.signObj=a},getDefault:function(){return e},getDefaultFrom:function(){return zmail.fromAddr},setDefaultFrom:function(a){zmail.fromAddr=a},setFromObj:function(a){c.fromObj=a},getFID:function(a){return d[a].fId},setFID:function(a,b){d[a].fId=b},getModified:function(a){return d[a].modified},setModified:function(a,b){1===b&&zmComp.enableSave(a),d[a].modified=b},getMode:function(a){return d[a].mode},setMode:function(a,b){d[a].mode=b},getAskReceipt:function(a){return d[a].askreceipt},setAskReceipt:function(a,b){d[a].askreceipt=b},updateAttachment:function(a,b,c){if(d[a]&&zmComp.getAttRef(a)&&"att"===b&&zmComp.setModified(a,1),"ele"===b){if("add"===c)$("#zmAtt_"+a).is(":visible")||$("#zmAtt_"+a).removeClass("SC_dyn");else if("remove"===c){var e=$("#zmAttLst_"+a+" > div");e.length||$("#zmAtt_"+a).addClass("SC_dyn")}zmComp.setHeight(a)}},delAttFwd:function(a,b,c,d){var e=[];e=c?zmComp.getFwdThrd(a):zmComp.getFwdMsg(a);var f=e.indexOf(b);f!==-1&&e.splice(f,1),d.remove(),zmComp.attachHeight(a)},modeChange:function(a){var b=1;"plaintext"===a&&(b=0),zmail.cmpdata.HTML_ENABLED=b;var c={mode:"editor",etype:b};zmAjq.XHR({u:zmail.conPath+"/chgEditor.do",t:"POST",fn:"",p:c,csr:"s"})},resetRepView:function(a){$("#zmtotxt_"+a).parent().children(".SC_cs").each(function(){zmAutoFill.removeContact($(this))}),$("#zmcctxt_"+a).parent().children(".SC_cs").each(function(){zmAutoFill.removeContact($(this))}),$("#zmbcctxt_"+a).parent().children(".SC_cs").each(function(){zmAutoFill.removeContact($(this))})},updRepView:function(a,b,c,e,f){var g=d[a].data;if(d[a].mode=c,d[a].inlineMode=c,!$.isEmptyObject(g)){zmComp.resetRepView(a),T(a);var h=p(a,c,g),i=h.TO,j=h.CC,k=h.BCC;j&&""!==$.trim(j)?(I(a,"cc",j),zmComp.shCBc(a,"c",f,b,e)):($("#zmcc_"+a).hide(),$("#scc_"+a).show()),k&&$.trim(k)?(I(a,"bcc",k),zmComp.shCBc(a,"b",f,b,e)):($("#zmbcc_"+a).hide(),$("#sbcc_"+a).show()),i&&""!==$.trim(i)&&I(a,"to",i)}},shCBc:function(a,b){var c="#zmcc_"+a;"b"===b?(c="#zmbcc_"+a,$("#sbcc_"+a).hide()):"c"===b&&$("#scc_"+a).hide(),$(c).removeClass("SC_dyn"),W($(c)),F($(c).find("input")),zmComp.setHeight(a),window.event&&zmUtil.stopEvents(window.event)},editorDropUpload:function(a,b){var c=a.initobj.id.split("_")[1];zmComp.getAttRef(c).uploadFiles(b)},maxUpload:function(a,c){var d=!0,e=20971520;zmail.maxAttSz&&(e=zmail.maxAttSz);for(var f=c.length,g=0,h=0;h<f;h++){var i=c[h],j=i.size;try{g+=j}catch(k){g=0}var l=zmComp.getSizeAtt(a),m=l+g;if(m>e){var n=e/1048576;d=!1;var o=b.upload_alert_maxsize;return o=zmText.applyArgs(o,{tmpAttSz:n}),Dialog.alert(o),!1}}return d},minUpload:function(a){var b=20971520;zmail.maxAttSz&&(b=zmail.maxAttSz);var c=zmComp.getSizeAtt(a);return b-=c},getSizeAtt:function(a){var b=0,c=0;if(zmComp.getAttEntity(a))for(var d=zmComp.getAttEntity(a),e=d.length,f=0;f<e;f++)c=parseInt(d[f].fs),isNaN(c)||(b+=c);if(zmComp.getAttTmp(a))for(var g=zmComp.getAttTmp(a),h=g.length,i=0;i<h;i++)c=parseInt(g[i].size),isNaN(c)||(b+=c);return b},smartClose:function(a,b,c,e,f,g){d[a].smartData&&d[a].smartData.afterClose&&(g.afterClose=d[a].smartData.afterClose);var h=!1;h=!(!e||"close"!==e)||zmComp.delCompObj(a,b,c,f),h&&g.afterClose&&g.afterClose()},prvClose:function(a,b,c,e,f){var g=!1;if(g=!(!e||"close"!==e)||zmComp.delCompObj(a,b,c,f),g&&c&&b&&"p"===b&&d[a]&&d[a].info.prevDOM){zmUtil.setInlineCmpScope(!1),zmComp.updateComposer(a,f);var h=d[a].info.prevDOM;h.find(".zm_cmp").remove()}},comClose:function(a){var b,c,e,f,g;b=a.cmpId,c=d[b].type,e=a.msgId,a.triggerType&&(f=a.triggerType),a.msgId&&(e=a.msgId),a.msgTxt&&(g=a.msgTxt),d&&d[b]&&d[b].type&&(c=d[b].type);var h;if(zmail.isComposeMail&&c&&"w"===c){var i={},j=zmComp.getOpener();window.self!==top&&(i.close=!0,window.parent.postMessage(i,"*")),j&&(i.cmpId=b,i.close=!0,j.postMessage(i,"*"));try{window.close()}catch(k){h()}}else c&&"p"===c?zmComp.prvClose(b,c,e,h,f):c&&"d"===c?d[b].closeQuick?(d[b].closeQuick=!1,zmComp.closeDialog(b)):zmComp.hideDialog(b):c&&"st"===c?(e||(e=zmComp.getMymId(b),a.msgId=e),zmComp.smartClose(b,c,e,h,f,a)):(zmComp.updateComposer(b,f),zmsuite.closeWorkspace(b));g&&zmUtil.succErrMsg("s",g)},updModified:function(a){zmComp.setModified(a,0),zmComp.setLastModified(a,0),zmComp.setPrevModified(a,0)},chkModified:function(){var a=!1;for(var b in d){var c=0,e=0;try{if(d[b].discard_close)continue;c=zmComp.getLastModified(b),e=zmComp.getPrevModified(b);var f=zmComp.getModified(b);(1===f||c>e)&&(a=!0);break}catch(g){a=!1}}return a;
},cmpAlt:function(a){$("#zmCmpAlt").length?$("#zmCmpAlt").html(a):$("body").append('<div id="zmCmpAlt">'+a+"</div>");var c={style:{width:"600px"},buttons:[{txt:b.ok,selected:!0,callback:function(){zmsDialog.remove()}}],drag:!0,mask:!0,pos:"center"};zmsDialog.create("zmCmpAlt",c)},tempOverWrite:function(a){var c=b.template_overwrite_alert,d="<h4>"+c+"</h4>",e=$("<div/>");e.attr("id","zmcmp_tempatt_"+a),e.html(d);var f={};f.cmpId=a,f.$content=e,f.ignoreMouseDown=!1,f.dialogDidMount=function(b){$("#zmcmp_tempatt_"+a)[0].zmcmp_confirm_dialog_ele=b;var c=b.$els.$maskWrapper;c.on("mousedown",function(a){var c=a.target||a.srcElement;$(c).closest("div.SC_pe").length?$(c).trigger("click"):b.remove()})},f.defaultNavigator=!1,f.navigator=new zmail.Navigator({onEscape:function(){$("#zmcmp_tempatt_"+a)[0].zmcmp_confirm_dialog_ele.remove()}}),f.buttons=[{name:b.ok,callback:function(b){zmComp.sendMail({action:"stemplate",sendIm:!1,cmpId:a,tmpUpdate:!0}),b.remove()}},{name:b.cancel,isCancel:!0,callback:function(a){a.remove()}}],Dialog["new"](f)},remindAtt:function(a,c){var e=b.attachment_reminder_alert;e=zmText.applyArgs(e,{USER_INPUT:c});var f="<h4>"+e+"</h4>",g=$("<div/>");g.attr("id","zmcmp_confirm_"+a),g.html(f);var h={};h.cmpId=a,h.$content=g,h.ignoreMouseDown=!1,h.dialogDidMount=function(b){$("#zmcmp_confirm_"+a)[0].zmcmp_confirm_dialog_ele=b;var c=b.$els.$maskWrapper;c.on("mousedown",function(a){var c=a.target||a.srcElement;$(c).closest("div.SC_pe").length?$(c).trigger("click"):b.remove()})},h.defaultNavigator=!1,h.navigator=new zmail.Navigator({onEscape:function(){$("#zmcmp_confirm_"+a)[0].zmcmp_confirm_dialog_ele.remove()}}),h.buttons=[{name:b.ok,callback:function(b){zmComp.sendMail({action:"compose",sendIm:d[a].sendImm,cmpId:a,actVal:"attfalse"}),b.remove()}},{name:b.cancel,isCancel:!0,callback:function(a){a.remove()}}],Dialog["new"](h)},cmpConfirm:function(a){var c,e=a.cmpId,f=a.msgId,g=a.textMsg;d[e]&&d[e].discard_Id&&(c=d[e].discard_mailId);var h=b.discardTxt;c&&(h=b.deleteTxt);var i=function(a){zmComp.sendMail({action:"sdraft",sendIm:!1,cmpId:a,actVal:"close"})},j=function(a,b){zmComp.updModified(a);var c={};c.cmpId=a,c.msgId=b,d[e].smartData&&d[e].smartData.afterClose&&(c.afterClose=d[e].smartData.afterClose),zmComp.comClose(c)},k=$("<div/>");k.attr("id","zmcmp_alt_"+e),k.text(g);var l={};if(l.cmpId=e,l.$content=k,l.ignoreMouseDown=!1,l.dialogDidMount=function(a){$("#zmcmp_alt_"+e)[0].zmcmp_alt_dialog_ele=a;var b=a.$els.$maskWrapper;b.on("mousedown",function(b){var c=b.target||b.srcElement;$(c).closest("div.SC_pe").length?$(c).trigger("click"):a.remove()})},l.defaultNavigator=!1,l.navigator=new zmail.Navigator({onEscape:function(a){a.remove()}}),l.buttons=[{name:b.save_draft,callback:function(a){i(e),a.remove()}},{name:h,isCancel:!0,callback:function(a){var b={};b.cmpId=e,zmComp.discardCmp(b),a.remove()}}],zmail.showFeature){var m={name:"Just close it",isCancel:!0,callback:function(a){j(e,f),a.remove()}};l.buttons.push(m)}Dialog["new"](l)},discardCmp:function(a){var b,c,e=a.cmpId,f=d[e].type,g={cmpId:e,type:f,_cloObj:a};if(d[e]&&d[e].discard_Id&&(b=d[e].discard_mailId,c=d[e].discard_Id),b){var h={aId:d[e].accId};h.mode="discard",h.mailId=b,g.discard_Id=c,zmAjq.XHR({u:zmail.conPath+"/cOpt.do",t:"POST",fn:zmComp.discardResp,p:h,csr:"s",ep:g})}else d[e].isChanged&&(d[e].newsave=!0),zmComp.discardClose(g)},discardResp:function(a,b){"success"===a.status&&(d[b.cmpId].newsave=!0,zmComp.discardClose(b))},discardClose:function(a){var b=a._cloObj;if(d[a.cmpId].smartData&&d[a.cmpId].smartData.afterClose&&(b.afterClose=d[a.cmpId].smartData.afterClose),d[a.cmpId].enableDiscard){d[a.cmpId].discard_close=!0;var c="";"st"===d[a.cmpId].type?c=zmComp.getSubject(a.cmpId):(c=$("#zmsub_"+a.cmpId).val(),d[a.cmpId].type&&"p"===d[a.cmpId].type&&(c=zmComp.getSubject(a.cmpId))),c=c.substr(0,1e3),zmComp.setSubject(a.cmpId,c),f[a.cmpId]=new j,zmComp.backupAttCompRef(a.cmpId),w(a.cmpId,f[a.cmpId],"discard_preview"),zmComp.comClose(b),zmComp.discardMsg(a.cmpId),a.discard_Id&&zmUtil.deleteMsg(a.discard_Id)}else zmComp.comClose(b)},delCompObj:function(a,c,e,f){var g=!0;try{var h=!1;if(B(a)&&(h=!0),d[a]&&d[a].discard_close&&(h=!1),h){var i="";if("outbox"===zmComp.getMode(a))i=b.unsaved_content_alert,g=window.confirm(i),g&&zmComp.updateOutbox(a);else{i=b.save_content_alert;var j={};j.cmpId=a,j.textMsg=i,j.msgId=e,g=zmComp.cmpConfirm(j)}}else"outbox"===zmComp.getMode(a)&&zmComp.updateOutbox(a);if(g){var k=Ba(arguments),l=k.length;if(1===l&&zmComp.updateComposer(a,"close_tab"),d[a]&&d[a].type&&"d"===d[a].type)zmComp.closeDialog(a,!0);else if(g&&e&&c&&"p"===c&&d[a]&&d[a].info.prevDOM){zmUtil.setInlineCmpScope(!1);var m="close_preview";f&&(m=f),zmComp.updateComposer(a,m);var n=d[a].info.prevDOM;n.find(".zm_cmp").remove()}clearInterval(zmComp.getInterVal(a)),$("#zmdArea_"+a+" input").each(function(){zmAutoFill.clearData($(this))}),zmCUtil.deleteSugMenu(a),$("#zm_smsg_"+a)&&zmComp.hideMsg(a),d[a].discard_close||delete d[a]}}catch(o){zmComp.debugLog(o)}return g},cmpRevert:function(a){zmComp.revert_cmpId=a,ja(a)},updShowMsg:function(a,b){var c,d=2e3;"u"===b&&(b="s",c=2e3),"s"===b?(d=1e3,$("#zm_smsg_"+a).attr("data-status","s")):"i"===b?$("#zm_smsg_"+a).attr("data-status","i"):"e"===b&&$("#zm_smsg_"+a).attr("data-status","e"),c&&(d=c),setTimeout(function(){"s"===$("#zm_smsg_"+a).attr("data-status")&&zmComp.hideMsg(a)},d)},hideMsg:function(a){$("#zm_smsg_"+a).removeClass().addClass("SC_msg")},removeMsg:function(){$("#zm_smsg_discard").remove()},removeDiscard:function(){clearTimeout(zmComp.discard_timer);var a=!0;zmComp.discard_cmpId&&zmComp.discard_cmpId===zmComp.revert_cmpId&&(a=!1),a&&delete d[zmComp.discard_cmpId],zmComp.removeMsg()},updateTitle:function(a,c){c||(c=$("#zmsub_"+a).val()),c&&""!==$.trim(c)?(c=c.replace(/</gi,"&lt;"),c=c.replace(/>/gi,"&gt;")):""===c&&(c=b.nosubject);var d=zmTab.getTabObject(a);d.appname=c,zmTab.updateTabLst(d)},discardMsg:function(a){zmComp.removeDiscard();var c="cursor:pointer;text-decoration:underline;font-weight:bold",d="<font style='font-weight:bold'>"+b.discard_msg+"</font>";if(d+="&nbsp;&nbsp;<font style='"+c+"' id='zm_discard_back'>",d+=b.undo_discard,d+="</font><i class='msi-close' onclick='zmComp.removeDiscard()'></i>",!$("#zm_smsg_discard").length){var e=["DIV",{attrs:{id:"zm_smsg_discard","class":"SC_msg SC_imsg"},child:[["SPAN",{}]]}];$("body").append(_zm.getDOM(e))}$("#zm_smsg_discard").removeClass().addClass("SC_msg SC_imsg").children("span").html(d),$("#zm_discard_back").off("click").on("click",function(){zmComp.cmpRevert(a)}),zmComp.discard_timer=setTimeout(function(){zmComp.removeDiscard()},6e3),zmComp.discard_cmpId=a},showMsg:function(a,b,c,e,f,g){var h=!1;b&&"s"!==b&&(h=!0);var i="";if("s"===b?i="SC_msg SC_smsg":"e"===b?i="SC_msg SC_emsg":"i"===b&&(i="SC_msg SC_imsg"),!e&&d[a]&&d[a].type&&(e=d[a].type),!$("#zm_smsg_"+a).length){var j=null;if(zmUtil.isChildWindow()||zmail.isComposeMail)j=$("body");else if(e&&"p"===e)j=zmsuite.getAppObj("zm_Container").centerObj.$el;else if(e&&"d"===e){var k=d[a]._dDialog;j=k.$els.$contentWrapper}else j=e&&"st"===e?d[a].errorPar:zmsuite.getAppObj(a).centerObj.$el;var l="";zmail.isComposeMail&&(l='style="top:0"');var m='id="zm_smsg_'+a+'" class="'+i+'" '+l,n='<font></font><i class="msi-close"></i>',o=["<div "+m+"><span>"+n+"</span></div>"];e&&"st"===e?j[0].appendChild($(o.join(""))[0]):j.append(o.join(""))}var p=$("#zm_smsg_"+a);g&&"HTML"===g?(c&&(c=c.replace(/&lt;/g,"<"),c=c.replace(/&gt;/g,">")),p.children("span").find("font").html(c)):p.children("span").find("font").text(c),p.removeClass().addClass(i),h?p.children("span").find("i").off("click").on("click",function(){zmComp.hideMsg(a)}):p.children("span").find("i").remove(),f&&(b=f),zmComp.updShowMsg(a,b)},loadInsertImage:function(a,b,c,d,e){var f="/mail/ImageSignature?fileName=";f+=a+"&accountId="+c+"&storeName="+b,f+="c"===e?"&frm=c":"&frm=s",ZE.activeEditor.previewImage(f)},triggerUpload:function(a){var b=zmComp.getCurrentCompId();a&&!zmComp.getCurrentCompId()&&(b=zmComp.zmsubStr(a,"zmEdi_")),zmComp.getAttRef(b).browseDesktop()},triggerCloudUpload:function(a){var b=zmComp.getCurrentCompId();!b&&a&&(b=zmComp.zmsubStr(a,"zmEdi_")),zmComp.getAttRef(b).init()},_zdocTxt:function(a,b){var c=b.docName,d=$("<span/>");d.text(c),c=d.html();var e=b.docId,f=location.protocol+"//"+zmail.urls.docsURL+"/file/"+e,g='background-color:#f5f5f5;border:#dcdcdc 1px solid;padding:1px;width:80%;"',h='id="zmdoc_share_{{CMPID}}" class="dochover" spellcheck="false" ';h+='contenteditable="false" data-avoidContext="true" ',h+='data-zmdocname="'+e+'" ',h+='data-zmdocshare="true" data-zmdoccmp="'+a+'" ',h+='style="'+g+'"';var i='name="ZM_SHAREDOC" data-hugatt="hugatt" ';i+='href="'+f+'" ',i+='target="_blank" ';var j="color:#004B91; text-decoration:none;cursor:pointer;";i+='style="'+j+'"';var k='name="ZM_SHAREDOC" data-hugatt="hugatt" ';k+='style="visibility:hidden;font-size:14px;cursor:pointer;color:#4A4A4A"';var l=["<table "+h+"><tr><td>","<a "+i+">"+c+"</a><br/>",'</td><td style="width:10px">',"<div "+k+">x</div></td>","</tr></table>"],m=l.join("");return m=m.replace(/{{CMPID}}/g,a)},getZDStr:function(a){var b="",c=zmComp.getZDObj(a);for(var d in c)""!==b&&(b+=","),b+=c[d].docId;return b},getZDArr:function(a){var b=[],c=zmComp.getZDObj(a);for(var d in c)b.push(c[d].docId);return b},docHover:function(a){var b='<style id="docHOVER_'+a+'">';return b+=".dochover {border:1px solid red} ",b+=".dochover:hover div{visibility:visible !important } ",b+=".dochover a:hover {text-decoration:underline!important;}</style>",$(b)},loadDocsLink:function(a,b){var c=b.cmpId,d=[],e=a.zohodocs;for(var f in e){var g=e[f];if(g.docId&&$.inArray(g.docId,zmComp.getZDArr(c))===-1){var h={};h.docId=g.docId,h.docName=g.docName,h.docType=g.docType,d.push("<div><br/></div>"),d.push(zmComp._zdocTxt(c,h))}}if(d.join("")){d.push("<div><br/></div>");var i=zmComp.getEditor(c),j=i.doc,k=$(j.head).find('style[id="docHOVER_'+c+'"]');k.length||$(j.head).append(zmComp.docHover(c)),i.insertHTML(d.join(""),!0)}},getZDObj:function(a){var b=zmComp.getEditor(a),c=b.doc,d=[],e=$(c).find('a[name="ZM_SHAREDOC"]');if(e.length)for(var f=e.length,g=0;g<f;g++){var h=e[g];if(!$(h).closest(".zmail_extra").length){var i=h.href;if(i){var j=i.split("/");if(j.length){var k=j[j.length-1],l=$(h).closest("table").attr("data-zmdocname");k===l&&d.push({docId:k})}}}}return d},clearZDoc:function(a,b,c){zmComp.updateZDoc(b,c);var d=$(a).parents("table").prev(),e=d.get(0);"DIV"===e.nodeName&&1===e.childNodes.length&&"BR"===e.childNodes[0].nodeName&&d.remove(),$(a).closest("table").remove()},updateZDoc:function(a,b){var c=zmComp.getZDObj(a);for(var d in c)if(c[d].docId===b){c.splice(d,1);break}},insertDocsLink:function(a){var b=a.eprm,c=a.loadType;if("link"===c){var d=$.parseJSON(a.docObj);zmComp.loadDocsLink(d,b)}},getCmpObj:function(){return d},getMsgObj:function(){return g},getCmpMsgObj:function(){return i},getPrvObj:function(){return f},getFromObj:function(){return c.fromObj},updateMsgObj:function(a,b){zmComp.setMsgId(b,a),zmComp.setCmpId(a,b)},setPrevHeight:function(a){var b;if(d[a].info&&d[a].info.prevDOM&&(b=d[a].info.prevDOM),b){var c=b.find(".zm_cmp");c.find(".zmCE").height("300px");var e=c.find(".ze_SCmb").outerHeight(),f=300-(e+4);c.find("iframe.ze_area").height(f),c.find("textarea.ze_area").height(f-30)}},resetHeight:function(a){var b=a.attr("id").split("_")[1];zmComp.setHeight(b)},setHeight:function(a,b){d[a]&&(b||(b=d[a].type),b&&"p"===b?zmComp.setPrevHeight(a):b&&"w"===b?zmComp.setWindowHeight(a):b&&"d"===b?zmComp.setQuickHeight(a):zmComp.setTabHeight(a))},setWindowHeight:function(a){var b=$(zmail.win).height(),c=$("#zmComposeWrapper"),e=c.find(".SCmb").eq(0).height(),f=c.find(".zmCR").height(),g=0;c.find(".zmCA").is(":visible")&&(g=c.find(".zmCA").height());var h=e+f+g,i=c.find(".ze_SCmb").height(),j=b-(h+16)+"px",k=b-(h+i+21);c.find(".zmCE").height(j),c.find("iframe.ze_area").height(k),c.find("textarea.ze_area").height(k-30),d[a]&&d[a].shareheight&&zmComp.shareHeight(a)},getCenter:function(a){var b;if(d[a]){var c;d[a].type&&(c=d[a].type),c&&"t"===c?b=zmsuite.getAppObj(a).centerObj.$el:c&&"d"===c&&(b=$("#zmQuick_compose_"+a))}return b},updateShare:function(a){var b=zmComp.getShareEle(a),c=b.liObj;c.removeClass("SC_op3 SC_nopntr").addClass("SC_thm")},draftComments:function(a,c,e){var f={draftID:c,onResize:function(b){b=b||{},b.context=b.context||{},b.context.composeID===a&&zmComp.shareHeight(a)},context:{composeID:a,draftID:c}};zmUtil.DraftShare.loadComments(f).done(function(b){if(d[a]){var f=zmComp.getShareEle(a);b.cmpId=a,b.msgId=c,b.liObj=f.liObj,b.txtObj=f.txtObj,b.loadType=e,b.entityExists&&(d[a].enableNotify=!0),"load_draft"!==e||b.entityExists?"load_draft"!==e&&"load_share"!==e||zmComp.loadComments(b):zmComp.loadShare(b)}}).fail(function(){zmComp.showMsg(a,"i",b.unable_load_comments,"t")})},notifyUpdate:function(a){var c=a.cmpId,d=a.liObj,e=a.msgId;zmUtil.DraftShare.notifyUpdate({draftID:e}).done(function(){d.removeClass("SC_thm")}).fail(function(){zmComp.showMsg(c,"i",b.prob_notify_invitees,"t"),d.addClass("SC_thm")})},showShare:function(a){if(d[a]){var b;d[a].type&&(b=d[a].type),b&&"t"===b?(zmComp.getShareEle(a).liObj.addClass("SC_thm"),zmsuite.getCenter(a)[0].getNodes()[0].showGroup("scheduledTime")):$("#zmShareM_"+a).removeClass("SC_dyn")}},hideShare:function(a){if(d[a]){var b;d[a].type&&(b=d[a].type),b&&"t"===b?zmsuite.getCenter(a)[0].getNodes()[0].hideGroup("scheduledTime"):$("#zmShareM_"+a).addClass("SC_dyn")}},getShareEle:function(a){var b,c={};if(d[a]){var e;if(d[a].type&&(e=d[a].type),e&&"t"===e){var f=$(zmsuite.getCenter(a)[0].getNodes()[0].$el);b=f.find("li[data-event='cmp_share']"),c.liObj=b,c.txtObj=b.find("span").eq(1)}else b=$("#zmShareM_"+a).find("li");c.liObj=b,c.txtObj=b.find("span").eq(1)}return c},loadNotify:function(a,c){if(d&&d[a]){var e=zmComp.getShareEle(a);e.cmpId=a,e.msgId=c;var f=e.liObj,g=e.txtObj;zmComp.showShare(a),g.text(b.notify_to_all),f.removeClass("SC_op3 SC_nopntr").addClass("SC_thm"),f.off("click").on("click",function(){zmComp.notifyUpdate(e)})}},loadComments:function(a){var c=a.cmpId,e=a.jqDOM,f=a.liObj,g=a.txtObj;zmComp.showShare(c),g.text(b.notify_to_all),f.off("click").on("click",function(){zmComp.notifyUpdate(a)}),zmComp.appendComments(c,e),d[c].shareloaded=!0,"load_share"===a.loadType&&a.focusComments()},loadShare:function(a){var c=a.cmpId,d=a.msgId,e=a.liObj,f=a.txtObj;zmComp.showShare(c),f.text(b.share),e.off("click").on("click",function(){zmComp.draftComments(c,d,"load_share")})},appendComments:function(a,b){var c,e;if(d[a]){var f;d[a].type&&(f=d[a].type),f&&"t"===f?c=zmsuite.getAppObj(a).centerObj.$el:f&&"d"===f&&(c=$("#zmQuick_compose_"+a))}e=c.find("#zmDftShare_"+a),e.length||(c.find(".zmCA").after('<div id="zmDftShare_'+a+'"></div>'),e=c.find("#zmDftShare_"+a)),e.html(b),d[a].shareheight=!0,zmComp.shareHeight(a)},shareHeight:function(a){var b=zmComp.getCurrentCompId();if(b&&(!b||a===b)){if(!zmsuite.getAppObj()[a])return void zmComp.debugLog("Wrong compose ID",a);var c=$(zmail.win).height(),d=$("#ztb-topband"),e=0;d.length&&(e=d.offset().top,e+=d.height());var f=zmsuite.getAppObj()[a].centerObj.$el,g=f.find(".SCmb").eq(0).height(),h=f.find(".zmCR").height(),i=0;f.find(".zmCA").is(":visible")&&(i=f.find(".zmCA").height());var j,k,l=$("#wmstoolbar").outerHeight(),m=e+g+h+i+l,n=f.find(".ze_SCmb").height(),o=c-(m+16),p=o/2,q=$("#zmDftShare_"+a).outerHeight();q>p?(j=p+"px",k=p-n+"px",f.find(".zmCE").height(j),f.find("iframe.ze_area").height(k),f.find("textarea.ze_area").height(k-30),$("#zmDftShare_"+a).css("max-height",p+"px"),$("#zmDftShare_"+a).css("overflow-y","auto")):(p=o-q,j=p+"px",k=p-n+"px",f.find(".zmCE").height(j),f.find("iframe.ze_area").height(k),f.find("textarea.ze_area").height(k-30),$("#zmDftShare_"+a).css("max-height",p+"px"),$("#zmDftShare_"+a).css("overflow-y","auto"))}},resizeWindow:function(){try{var a=zmComp.getCmpObj();for(var b in a)d&&d[b].type&&"w"===d[b].type&&zmComp.setWindowHeight(b)}catch(c){zmComp.debugLog("ZM: Resizing",c)}},resizeAllTab:function(){try{for(var a in d)d&&d[a]&&(d[a].resizeTab=!0)}catch(b){}},resizeCmpTab:function(){var a=zmComp.getCurrentCompId();a&&d[a]&&(d[a].resizeTab=!1,zmComp.setTabHeight(a)),zmComp.resizeAllTab()},getDialogObj:function(){var a=[];for(var b in d)d&&d[b]&&d[b].type&&"d"===d[b].type&&a.push(b);return a},resizeDialog:function(){var a=[],b=$(zmail.win).height();try{for(var c in d)d&&d[c]&&d[c].type&&"d"===d[c].type&&a.push(c);if(a.length)for(var e=a.length,f=0;f<e;f++){var g=a[f];g&&b>450&&zmComp.setQuickHeight(g)}}catch(h){}},setTabHeight:function(a){var b=$(zmail.win).height(),c=$("#ztb-topband"),e=0;c.length&&(e=c.offset().top,e+=c.height());var f=zmsuite.getAppObj()[a].centerObj.$el,g=f.find(".SCmb").eq(0).height(),h=f.find(".zmCR").height(),i=0;f.find(".zmCA").is(":visible")&&(i=f.find(".zmCA").height());var j=$("#wmstoolbar").outerHeight(),k=e+g+h+i+j,l=f.find(".ze_SCmb").height(),m=b-(k+16),n=b-(k+l+21);f.find(".zmCE").height(m),f.find("iframe.ze_area").height(n),f.find("textarea.ze_area").height(n-30),d[a]&&d[a].shareheight&&zmComp.shareHeight(a)},setQuickHeight:function(a){var b=$(zmail.win).height(),c=$(".zm_compose"),e=c.offset(),f=e.top,g=$("#wmstoolbar").outerHeight(),h=d[a]._dDialog,i=f+g,j=b-i;h.$els.$contentWrapper.css({"max-width":"700px",padding:"0px"});var k=h.$els.$contentWrapper,l=k.find(".SCmb").eq(0).height(),m=k.find(".zmCR").height(),n=0;k.find(".zmCA").is(":visible")&&(n=k.find(".zmCA").height());var o=f+l+m+n+g,p=k.find(".ze_SCmb").height(),q=j-(o+16+5),r=j-(o+p+21+5);k.find(".zmCE").height(q),k.find("iframe.ze_area").height(r),k.find("textarea.ze_area").height(r-30),d[a]&&d[a].shareheight&&zmComp.shareHeight(a)},isSave:function(a,b){var c=!1;return B(a)&&(c=!0),!b||"move_tab"!==b&&"reload_preview"!==b||(c=!0),d[a]&&d[a].loadsave&&(c=!0),c},moveTab:function(a){zmUtil.setInlineCmpScope(!1),f[a]=new j,zmComp.backupAttCompRef(a),w(a,f[a],"move_tab"),ra(a)},loadPreview:function(a,b){zmUtil.setInlineCmpScope(!0),f[a]=new j,zmComp.backupAttCompRef(a),w(a,f[a],"load_preview_other"),qa(a,b)},backupAttCompRef:function(a){var b=zmComp.getAttRef(a);if(d&&d[a]&&b){var c=b.getAllAttachedList();b.clearStoreAttachments(),d[a].attCompRefList=c}},txtFocus:function(a){W($(a))},updatePriority:function(a){var b=zmComp.getPriorityDom(a).elem,c=b.find("i.msi-priority"),d=zmComp.getPriority(a);"Low"===d?c.removeClass("SC_red SC_blue").addClass("SC_blue"):"High"===d?c.removeClass("SC_red SC_blue").addClass("SC_red"):c.removeClass("SC_red SC_blue")},updPriority:function(a,b){var c="Medium",d=$(zmsuite.getCenter(a)[0].getNodes()[0].$el).find("i.msi-priority");4===b?(c="Low",d.removeClass("SC_red SC_blue").addClass("SC_blue")):2===b?(c="High",d.removeClass("SC_red SC_blue").addClass("SC_red")):d.removeClass("SC_red SC_blue"),zmComp.setPriority(a,c)},updScheduleTime:function(a,c){var d=$(zmsuite.getCenter(a)[0].getNodes()[0].$el),e=d.find("li[data-event='cmp_share']");e.off("click").on("click",function(){zmUtil.DraftShare.notifyUpdate({draftID:c}).done(function(){e.addClass("SC_thm")}).fail(function(){e.removeClass("SC_thm"),zmComp.showMsg(a,"i",b.prob_notify_invitees,"t")})}),e.addClass("SC_thm")},objSize:function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},updateDraft:function(a){var b={cmpId:a};b.action="sdraft",zmComp.sendMail(b)},updDraftText:function(a,b){zmComp.getDraftDom(a).text(b)},getPriorityDom:function(a){var b,c,e={},f=d[a].type;return"w"===f||"d"===f||"p"===f?(b=$("#zmPriorityM_"+a).find("li"),c="d"):"st"===f?(b=d[a].priorityDOM,c="st"):(b=zmsuite.getCenter(a)[0].getNodes()[0].$el,b=b.find("li[data-event='p']"),c="t"),e.elem=b,e.appTy=c,e},getDraftDom:function(a){var b;if(zmail.isComposeMail)b=$("#zmSaveM_"+a).find("li");else if(d[a].type&&"d"===d[a].type)b=$("#zmSaveM_"+a).find("li");else if(d[a].type&&"p"===d[a].type)b=$("#zmSaveM_"+a).find("li");else if(d[a].type&&"st"===d[a].type)b=d[a].saveDOM;else{var c=zmsuite.getCenter(a)[0].getNodes()[0].$el;b=c.find("li[data-event='svedrp']")}return b.find("span").eq(1)},getReplyToLst:function(){var a=zmComp.getFromObj(),b={};b[e.setRepto]="1";for(var c in a)b[c]="1";return b},saveReply:function(a){for(var b=a.deferObj,c=a.cmpList,d=c.length,e=0;e<d;e++){var f=c[e].cmpId;zmComp.afterSave(f)}b.resolve(!0)},reopenPrev:qa,setCmpObj:function(a){d=a},afterSave:function(a,b,c){try{var e=!0;b&&"close_false"===b&&(e=!1);var f={action:"sdraft",sendIm:!1,cmpId:a};if(e&&(f.actVal="close"),zmComp.isSave(a,c))zmComp.sendMail(f);else{var g=d[a].type;if(g&&"p"===g&&d[a]&&d[a].info.prevDOM){zmUtil.setInlineCmpScope(!1),zmComp.updateComposer(a,"close_preview");var h=d[a].info.prevDOM;h.find(".zm_cmp").remove()}clearInterval(zmComp.getInterVal(a)),$("#zmdArea_"+a+" input").each(function(){zmAutoFill.clearData($(this))}),$("#zm_smsg_"+a)&&zmComp.hideMsg(a),d[a].discard_close||delete d[a]}}catch(i){zmComp.debugLog(i)}},send:function(a){var b={action:"compose",sendIm:!1,cmpId:a};zmComp.sendMail(b)},save:function(a,b){var c={action:"sdraft",sendIm:!1,cmpId:a};b&&(c.autosave=b),zmComp.sendMail(c)},getObj:function(a){return d[a]},confirmSend:function(){zmComp.sendMail({action:"outbox",schedule:!0,scheduled_type:"DATE"}),zmUtil.hideMenu()},constants:{DRAFT_LOAD_TAB:"tab",DRAFT_LOAD_INLINE:"inline"},folderId:function(a){var b;return a&&zmail.mailObj&&zmail.mailObj[a]&&zmail.mailObj[a].FD&&(b=zmail.mailObj[a].FD),b},getOpener:function(){var a;return window&&window.opener&&null!==window.opener.opener?a=window.opener.opener:window&&null!==window.opener&&(a=window.opener),a},draftParentId:function(a,b){for(var c={},d=b.length,e=0;e<d;e++)if(b[e].M===a&&b[e].FD===zmail.folId.dId){c=b[e].PA;break}return c},updateOutbox:function(a){var b={aId:zmComp.getAccId(a),mode:"updOut",mId:zmComp.getMymId(a)},c={u:zmail.conPath+"/cOpt.do",t:"POST",fn:zmComp.updateOutboxView,p:b};zmAjq.XHR(c)},updateOutboxView:function(){var a,b,c;if(zmail.isComposeMail){var d=zmComp.getOpener();d&&(a=d.zmInit.getListingDetObj(),b=a.fId,b&&b===d.zmail.folId.oId&&(c={fId:b,view:"",viewId:""},d.$.publish("/mail/listMails",c)))}else a=zmInit.getListingDetObj(),a&&(b=a.fId,b&&b===zmail.folId.oId&&(c={fId:b,view:"",viewId:"",retainPreview:!0},$.publish("/mail/listMails",c)))},modifyOutbox:function(a,b){var c=a.attr("id"),d=c.split("_")[1];zmComp.setModified(d,1),zmComp.modifyAtMention(d,b)},modifyAtMention:function(a,b){if(b&&b.type){var c;b.data&&b.data.eid&&(c=b.data.eid),d[a]._atMentionObj||(d[a]._atMentionObj=[]);var e;d[a]&&d[a]._atMentionObj&&(e=d[a]._atMentionObj),"add"===b.type&&c?e&&e.indexOf(c)===-1&&e.push(c):"remove"===b.type&&c&&e&&e.indexOf(c)!==-1&&e.splice(e.indexOf(c),1)}},modifyRecipients:function(a,b){var c=a.attr("id"),e=zmCUtil.getCmpIdType(c),f=e.cmpId,g=e.eleType;_zm._isPrivilegedUser()&&"add"===b.type&&zmCUtil.getSugContacts(f,g),zmComp.setModified(f,1),zmComp.modifyAtMention(f,b),"add"===b.type&&g&&"bcc"===g&&zmAutoFill.getAddress(a).length&&1===zmAutoFill.getAddress(a).length&&$.publish("/compose/bccpresent",{cmpID:f,mailID:d[f]?d[f]._draftParentId||d[f].mymId:""})},getCmpObjId:Ea,isModified:B,getModeObj:o,addComposer:function(a){var b={composeId:"reqDATA"};a.viewType&&(b.elemPrefix=a.viewType),a.prevDOM&&(b.prevDOM=a.prevDOM),a.msgId&&(b.msgId=a.msgId),a.draftId&&(b.draftId=a.draftId),b.actionType="replace_draft",b.composerType=zmComp.constants.DRAFT_LOAD_TAB,zmail.allowInline?$.publish("/mail/preview/draftClosed",b):$.publish("/mail/msgDiscarded",b)},updateComposer:function(a,b){try{var c,e,f,g={composeId:a};d[a]&&(d[a].info&&(d[a].info.draftId&&(c=d[a].info.draftId),d[a].info.prevDOM&&(g.prevDOM=d[a].info.prevDOM),d[a].info.msgId&&(e=d[a].info.msgId),d[a].info.elemPrefix&&(g.elemPrefix=d[a].info.elemPrefix)),d[a].draftId&&(c=d[a].draftId),d[a].msgId&&(e=d[a].msgId),d[a]._draftParentId&&(f=d[a]._draftParentId),c&&(g.draftId=c),e&&(g.msgId=e),f&&(g.msgId=f));var h;"close_view_aftersend"===b?(g.actionType="discard_draft",h=zmComp.constants.DRAFT_LOAD_INLINE):"close_preview_aftersave"===b?(g.actionType="replace_draft",h=zmComp.constants.DRAFT_LOAD_INLINE):"discard_preview"===b?(g.actionType="discard_draft",h=zmComp.constants.DRAFT_LOAD_TAB):"close_preview"===b&&c?(g.actionType="replace_draft",h=zmComp.constants.DRAFT_LOAD_INLINE):"close_preview"===b?(g.actionType="discard_draft",h=zmComp.constants.DRAFT_LOAD_INLINE):"move_tab"===b?(g.actionType="replace_draft",h=zmComp.constants.DRAFT_LOAD_TAB):"load_preview_other"===b?(g.actionType="replace_draft",h=zmComp.constants.DRAFT_LOAD_INLINE):"open_draft_folder"===b?(g.actionType="replace_draft",h=zmComp.constants.DRAFT_LOAD_TAB):"close_tab"===b&&f?(g.actionType="replace_draft",h=zmComp.constants.DRAFT_LOAD_INLINE):"close_tab"===b&&c?(g.actionType="replace_draft",h=zmComp.constants.DRAFT_LOAD_INLINE):"close_tab"===b?(g.actionType="discard_draft",h=zmComp.constants.DRAFT_LOAD_INLINE):"load_undo_discard"===b&&(g.actionType="replace_draft",h=zmComp.constants.DRAFT_LOAD_TAB),h&&(g.composerType=h,d[a].composerType=h),zmail.allowInline?$.publish("/mail/preview/draftClosed",g):$.publish("/mail/msgDiscarded",g)}catch(i){zmComp.debugLog(i)}},download:function(a,b,c){var d="",e={};"dwn"===c?zmUtil.downloadAttachment(b):"tmpdwn"===c&&(d+=zmail.conPath+"/FileDownload/"+zmUtil.encodeFileName(b.n),e={mode:"tmpdwn",entityType:1,accId:zmComp.getAccId(a),fpath:b.fP,fstorename:b.sN},zmAjq.formSubmit(e,d))},fileDOM:function(){var a=['<div class="zmL SC_Pbar" id="{{AT_UID}}">','<div class="zmLst">','<div class="zmDtl">','<div class="zmSze">','<span id="{{AT_UID}}_SZE" class="sum">&nbsp;</span>',"</div>",'<div class="zmFrm">','<span id="{{AT_UID}}_FRM"></span>',"</div>",'<div class="zmImg" id="{{AT_UID}}_IMG">','<i class="{{AT_CLS}}"></i>',"</div>",'<div class="SC_icn" id="{{AT_UID}}_DEL">','<i class="msi-close"></i>',"</div>",'<div class="zm_lbl" id="{{AT_UID}}_STATUS">','<div style="width:0%"></div>',"</div>","</div>","</div>","</div>"].join("");return a},attach_insert:function(a,b){var c=$("#zmAttLst_"+a);c.append(b),$("#zmAtt_"+a).removeClass("SC_dyn"),zmComp.setHeight(a)},attach_fwdme:function(a,b){var c=zmComp.fileDOM(),d="",e="";if(b.thrd?(d=(new Date).getTime()+"_"+b.mId+"_thrd",e="thread"):(d=(new Date).getTime()+"_"+b.mId+"_msg",e="mail"),c=c.replace(/{{AT_UID}}/g,d).replace(/{{AT_CLS}}/,"msi-attachment SC_big"),zmComp.attach_insert(a,c),$("#"+d)){$("#"+d).off("click").on("click",function(c){c=c||window.event;var d=c.target||c.srcElement,e=!1;"msi-close"!==d.className&&"SC_icn"!==d.className||(e=!0),e&&zmComp.delAttFwd(a,b.mId,b.thrd,$(this))});var f=b.sub;f&&(f=f.substring(0,21)),$("#"+d).attr("title",b.sub),$("#"+d+"_FRM").attr("title",b.sub),$("#"+d+"_FRM").text(f),$("#"+d+"_SZE").text(e),$("#"+d+"_STATUS").remove()}},attachHeight:function(a){var b=$("#zmAttLst_"+a+" > div");b.length||($("#zmAtt_"+a).hide(),zmComp.setHeight(a))},getPrevDOMLst:function(){return h},isIE:function(){var a=!1;return($.browser.msie||window.StyleMedia&&Boolean(document.documentMode))&&(a=!0),a},getAccId:function(a){var b=zmail.accId;return a&&d[a].accId&&(b=d[a].accId),b},zmsubStr:function(a,b){return a.indexOf(b)!==-1&&(a=a.substring(b.length,a.length)),a},delegateEID:function(a){var b=zmComp.getShareId(a),c=zmComp.shareListObj()[b],d="";return c&&zmail.shrTree[0][c]&&(d=zmail.shrTree[0][c].EID),d},shareListObj:function(){var a={};zmail.shrTree[0]&&(a=zmail.shrTree[0]);var b={};if(a&&!$.isEmptyObject(a))for(var c in a)a[c].SHID&&(b[a[c].SHID]=c);return b},frmListObj:function(a){var b={};for(var c in a)a[c]&&"undefined"!=typeof a[c].FRM_SIGMODE&&6!==a[c].FRM_SIGMODE&&(b[c]=a[c]);return b},boxSubject:function(a){var c=$("<input/>");c.attr("type","text"),c.attr("data-enableshortcuts",!0),c.addClass("SC_tiput"),c.width(560),c.val(""),c.attr("placeholder",b.specify_subject);var e=$("<li/>");e.addClass("SC_p10"),e.append(c);var f=$("<ul/>");f.append(e);var g=$("<div/>");g.addClass("SC_p10"),g.append(f);var h=$("<h4/>"),i=$("<font/>");i.html(b.subject_alert),h.append(i),h.append(g);var j=$("<div/>");j.attr("id","zmcmp_subjalt_"+a),j.html(h);var k={};k.cmpId=a,k.$content=j,k.ignoreMouseDown=!1,k.dialogDidMount=function(c){$("#zmcmp_subjalt_"+a)[0].zmcmp_subjalt_ele=c;var d=$("#zmcmp_subjalt_"+a).find("input").eq(0);d.focus(),d.select(),d.keyup(function(){var c=$("#zmcmp_subjalt_"+a)[0].zmcmp_subjalt_ele.$els.$buttonContainer,e=d.val(),f=b.send;e&&""===$.trim(e)&&(f=b.send_anyway),c.find("span").eq(0).text(f)});var e=c.$els.$maskWrapper;e.on("mousedown",function(a){var b=a.target||a.srcElement;$(b).closest("div.SC_pe").length?$(b).trigger("click"):c.remove()})},k.defaultNavigator=!1,k.navigator=new zmail.Navigator({onEscape:function(){$("#zmcmp_subjalt_"+a)[0].zmcmp_subjalt_ele.remove()}}),k.buttons=[{name:b.send_anyway,callback:function(b){var c=b.$els.$contentWrapper.find("input").eq(0).val();c&&""!==c&&($("#zmsub_"+a).val(c),zmComp.setSubject(a,c)),d[a].subfalse=!0,zmComp.sendMail({action:"compose",sendIm:d[a].sendImm,cmpId:a,actVal:"subfalse"}),b.remove()}},{name:b.cancel,isCancel:!0,callback:function(a){a.remove()}}],Dialog["new"](k)},clearDraft:function(a,b){var c={aId:a};c.mode="discard",c.mailId=b;var d=$.extend({},c);zmAjq.XHR({u:zmail.conPath+"/cOpt.do",t:"POST",p:c,csr:"s",ep:d})},allContacts:function(a){var b="";return b=zmComp.getContacts($("#zmtotxt_"+a),b),b=zmComp.getContacts($("#zmcctxt_"+a),b),b=zmComp.getContacts($("#zmbcctxt_"+a),b)},getContacts:function(a,b){""!==b&&(b+=",");for(var c="",d=zmAutoFill.getAddress(a),e=d.length,f=0;f<e;f++)f>0&&(c+=","),c+=d[f].fn+" <"+d[f].eid+">";return b+=c},pushContacts:function(a,b){$.publish("compose/addToContacts",{email:a,name:b})},addContacts:function(a){try{var b=zmComp.allContacts(a),c=zmConUtil.splitncheck(b,"object"),d="",e="";for(var f in c)c[f]&&c[f].eid&&!zmCont.isEmailExist(c[f].eid)&&(d=c[f].eid,c[f].fn&&(e=c[f].fn),zmComp.pushContacts(d,e))}catch(g){}},dropAttachment:function(a){var c="display:none; height: 100%; width: 100%; left: 0px; top: 0px; position: absolute;",d='<div style="'+c+'">';d+='<div class="SC_drag" style="height:70%"><span>',d+=b.dropMsg,d+="</span></div></div>";var e=$(d);e.on("drop",function(b){var c,d;return e.hide(),b=b||window.event,b.preventDefault&&b.preventDefault(),c=b.originalEvent.dataTransfer,d=c&&c.files,zmComp.getAttRef(a).uploadFiles(d),!1}),$("#zmsub_"+a).parent().on("dragover dragenter",function(a){a=a||window.event;var b=a.originalEvent.dataTransfer;if(b.types.indexOf?b.types.indexOf("Files")!==-1:b.types.contains("application/x-moz-file"))return b.dropEffect="copy",a.preventDefault&&a.preventDefault(),e.show(),!1}),e.on("dragleave",function(){return e.hide(),!1}),$("#zmsub_"+a).parent().append(e)},cmpDialog:function(a){zmComp.removeDiscard();var b=zmComp.getDialogObj();if(b.length){var c=b[0];if(d&&d[c]&&d[c]._dDialog){var e=d[c]._dDialog;return e.$els.$maskWrapper.addClass("SC_Pop"),e.show(),!1}}var f={act:"compose",mode:"compose"};a&&(f.data=a),f.type="d",zmComp.openDialog({},f)},openDialog:function(a,b){var c=zmUtil.getCmpAppId(),e=b.mode,f=b.msgId;m(),b.data?(a=b.data,a.mdata&&(a=a.mdata)):a.mdata&&(a=a.mdata),d[c]=new l(e),d[c].type="d",d[c].askreceipt?zmComp.setAskReceipt(c,"yes"):zmComp.setAskReceipt(c,"no"),d[c].info=b.info,$.isEmptyObject(a)||(d[c].data=a);var g={};g.cmpId=c,g.type="d";var h=zmCompOpt.headerDOM(g),i=zmCompOpt.recipientDOM(g),j=zmCompOpt.editorDOM(g),k=zmCompOpt.attDOM(g),n=$("<div/>");n.attr("id","zmQuick_compose_"+c),n.append(h,i,j,k);var o={};o.cmpId=c,o.$content=n,o.ignoreMouseDown=!1,o.defaultCloseIcon=!1,o.dialogDidMount=function(a){zmComp.updateDialog(a,c)},o.dialogWillMount=function(a){zmComp.modifyDialog(a,c)},o.defaultNavigator=!1,o.navigator=new zmail.Navigator({onEscape:function(){zmComp.hideDialog(c)}}),Dialog["new"](o),zmComp.setMymId(c,f),b&&b.shId&&zmComp.setShareId(c,b.shId),R(c,e,a),ba(c,e,a.SUBJECT),!a.STATUS2ID||5!==a.STATUS2ID&&6!==a.STATUS2ID&&7!==a.STATUS2ID||(d[c].inlineMode=zmComp.getModeObj("string",a.STATUS2ID)),b.info&&b.info.draftId&&(a.MAILID&&(d[c].discard_mailId=a.MAILID),
a.INREPLYTO&&(d[c].discard_inReplyTo=a.INREPLYTO),a.REFHEADER&&(d[c].discard_refHeader=a.REFHEADER)),f&&zmail.mailObj&&zmail.mailObj[f]&&zmail.mailObj[f].FD&&(zmail.folId.teId===zmail.mailObj[f].FD&&(d[c].tempId=f),zmComp.setFID(c,zmail.mailObj[f].FD)),E(c,e),zmComp.loadDialog(c,e,a,b)},hideDialog:function(a){var b=d[a]._dDialog;b.$els.$maskWrapper.removeClass("SC_Pop"),b.hide()},closeDialog:function(a,b){var c=d[a]._dDialog;b?c.remove():zmComp.delCompObj(a)},updateDialog:function(a,b){d[b]._dDialog=a,a.$els.$positionWrapper.addClass("SC_PopTop");var c=$(".zm_compose"),e=c.offset(),f=e.top+"px",g=e.left+c.width()+"px";a.$els.$positionWrapper.css("top",f),a.$els.$positionWrapper.css("left",g)},modifyDialog:function(a,b){a.$els.$maskWrapper.removeClass("SC_cent"),a.$els.$content.attr("id","zmQuick_compose_"+b),a.$els.$content.removeClass()},loadDialog:function(a,b,c,e){try{var f=U(a,b,c);V(a,b,c,e);var g="tab";"p"===d[a].type&&(g="inline"),N(a,b,f,g);var h=!1;if("reply"!==b&&"replyall"!==b&&"fwdi"!==b||(d[a].loadType="drafted",d[a].changeData=!0,h=!0),e.info&&e.info.loadType&&"drafted"===e.info.loadType&&(d[a].loadType=e.info.loadType,d[a].changeData=!1,h=!1),d[a].loadType&&"drafted"===d[a].loadType){var i;zmComp.updateMsgObj(i,a)}h&&(d[a].loadsave=!0),"compose"!==b&&"fwdi"!==b&&"fwdme"!==b||W($("#zmto_"+a)),F($("#zmto_"+a+" :input")),F($("#zmcc_"+a+" :input")),F($("#zmbcc_"+a+" :input")),F($("#zmsub_"+a)),zmComp.setHeight(a),Z(a),aa(a,b),D(a,e.type),zmUtil.addCmpAppId()}catch(j){zmComp.debugLog(j)}},enableSave:function(a){var b;d[a]&&"d"===d[a].type?b=$("#zmSaveM_"+a).find("li"):d[a]&&"p"===d[a].type?b=$("#zmSaveM_"+a).find("li"):d[a]&&"st"===d[a].type?b=d[a].saveDOM:zmail.isComposeMail?b=$("#zmSaveM_"+a).find("li"):!zmUtil.isChildWindow()&&zmsuite.getAppObj(a)&&zmsuite.getAppObj(a).centerObj&&(b=$(zmsuite.getCenter(a)[0].getNodes()[0].$el).find("li[data-event='svedrp']")),a&&d[a]&&(d[a].enableDiscard=!0),b&&b.removeClass("SC_op3 SC_nopntr")},updAtMention:function(a){d[a]._atMentionObj||(d[a]._atMentionObj=[]);for(var b=[$("#zmtotxt_"+a),$("#zmcctxt_"+a),$("#zmbcctxt_"+a)],c=[],e=0;e<b.length;e++){var f=zmAutoFill.getAddress(b[e]);if(f.length)for(var g=0;g<f.length;g++)c.push(f[g])}var h=c.length;if(h)for(var i=0;i<h;i++)d[a]&&d[a]._atMentionObj&&d[a]._atMentionObj.indexOf(c[i].eid)===-1&&d[a]._atMentionObj.push(c[i].eid)},parseHTML:function(a){return $("<div/>").append($.parseHTML(a)).html()},decodeEscape:function(a){return a.replace(/\\x([0-9A-Fa-f]{2})/g,function(){return String.fromCharCode(parseInt(arguments[1],16))})},shareEID:function(a){O(a)},composeMail:function(a,b){ea(a,b)},debugLog:function(a){zmUtil.debugLog(a)},insertAttachment:function(a,b){zmComp.getAttRef(a).addFiles(b.NEWATT)},cmpData:function(){m();var a={};return a.askReceipt=e.askReceipt,a.charset=e.charset,a.smType=e.smType,a.outIntr=e.outIntr,a.setRepto=e.setRepto,a.showBcc=e.showBcc,a.fromObj=zmComp.getFromObj(),a.signObj=zmComp.getSignObj(),a.encode=zmComp.getEncodeList(),a.fromAddr=zmComp.getDefaultFrom(),a},loadAppObj:function(a){return d[a]=new l("compose"),d[a].type="st",d[a]},loadSharedAttachments:function(a){var b,c=a.attArr,d=c.length,e=[],f=a.pid;f=f.indexOf("#")!==-1?f.substring(f.indexOf("#")+1,f.length):f;for(var g,h=a.actionType,i=a.groupId,j=a.elm,k="",l=0;l<d;l++)g=c[l],b={Id:g.id,e:f,et:g.et,fs:g.size,ft:g.ft,l:[],fn:g.name,p:g.part,thn:g.thn,tn:!0,type:h,u:g.u,gId:i},k&&(b.dn=k),e.push(b);var m;$(j).find(".zmImg").click(function(){m=$(this).parents(".zmL").data("detail"),zmUtil.initAttSlideShow(e,m)}),$(j).find(".SC_Pbar").click(function(b){m=$(this).data("detail"),zmAttach.util.bindoptions(b,{attList:e,from:"streams",pid:f,type:a.type,index:m,attClass:"SC_Pbar"})})},getAppDOM:function(a,b){a=a.mdata;var c="CmpDft"+(new Date).getTime(),d={};d.cmpId=c,d.type="st";var e=zmCompOpt.recipientDOM(d),f=zmCompOpt.editorDOM(d),g=zmCompOpt.attDOM(d),h=$("<div/>");h.attr("class","SC_Drft zmDrftMask"),h.attr("id",d.cmpId),h.append(e,f,g),b.postElm.html(h);var i=ZE.createDraftToolbar(zmCUtil.getSmartToolbar()),j=$("#zmEdi_"+c);j.append(i);var k=$("<div/>");k.addClass("ze_body zmDrftMask");var l=$("<div/>");l.attr("id","zmeditor_content"),l.css("overflow","auto"),l.css("padding","15px"),l.html(a.CONTENT),k.append(l),j.append(k),j.height("200px");var m=j.find(".ze_SCmb").outerHeight(),n=200-(m+30);if(j.find("#zmeditor_content").height(n),$("#zm_fromaddr_"+c).text(a.FROM),$("#zmsub_"+c).val(a.SUBJECT),a.NEWATT&&a.NEWATT.length){var o=zmAttach.build(a.NEWATT,{from:"compose",attClass:"SC_Pbar"});$("#zmAttLst_"+c).html(o),$("#zmAtt_"+c).removeClass("SC_dyn");var p={};p.attArr=a.NEWATT,p.cmpId=c,p.actionType=b.actionType,p.groupId=b.groupId,p.pid=b.pid,p.elm=$("#zmAttLst_"+c),zmComp.loadSharedAttachments(p)}var q=a.TO,r=a.CC,s=a.BCC;q&&""!==$.trim(q)&&I(c,"to",q),r&&""!==$.trim(r)&&(I(c,"cc",r),zmComp.shCBc(c,"c")),s&&$.trim(s)&&(I(c,"bcc",s),zmComp.shCBc(c,"b")),F($("#zmto_"+c+" :input")),F($("#zmcc_"+c+" :input")),F($("#zmbcc_"+c+" :input")),F($("#zmsub_"+c)),b.callback()},getZDocLoc:t,getZDocLink:function(a){var b=zmComp.getZDocLoc(a),c=[];return d[a]&&d[a].plaindoclink&&(c=d[a].plaindoclink),b=$.grep(b,function(a){return $.inArray(a,c)<0})},loadCmpDOMProp:function(a,b){d[a].saveDOM=b.saveDOM,d[a].priorityDOM=b.priorityDOM,d[a].errorPar=b.errorPar,d[a].type=b.type;var c=b.editor;zmComp.setEditor(a,c);var e={};e=K(a,e),c.updateConfigProperties(e),zmComp.setAttRef(a,b.attRef)},getCmpData:function(){var a={},b=zmUtil.getCmpAppId();return a.data=zmComp.cmpData(),a.appobj=zmComp.loadAppObj(b),a.cmpId=b,zmUtil.addCmpAppId(),a},print:function(a){var c=a.cmpId,d={},e="",f="",g="",h={},i={},j={};h=q(c,"to"),i=q(c,"cc"),j=q(c,"bcc"),h.address&&(e=h.address),i.address&&(f=i.address),j.address&&(g=j.address),d.TO=e,d.CC=f,d.BCC=g;var k=zmComp.getFromAddr(c);d.F=k;var l=zmComp.getFromObj(),m="";l[k]&&l[k].FRM_DISN&&(m=l[k].FRM_DISN),d.SN=m,m&&(m='"'+m.replace(/(^|[^\\])"/g,'$1\\"')+'"',k=m+" <"+k+">"),d.FROM=k,zmComp.getAttRef(c)&&(d.NEWATT=zmComp.getAttRef(c).getAllAttachedList());var n=$("#zmsub_"+c).val();n=$.trim(n),""===n&&(n=b.nosubject),d.SUBJECT=n;var o=zmComp.getEditor(c),p=$(o.doc.body),r=p.find("div[name=ZM_SHWTRIM]");r.length&&r.remove();var s=p.find("div.zmail_extra");s.length&&s.show();var t=o.getContent(),u="<div style='font-size:"+zmail.mailOpt.fs+"pt;",v=zmCUtil.getfontFamily(zmail.mailOpt.ff);"Default"!==v&&(u+="font-family:"+v+";"),u+="'>"+t+"</div>",d.CONTENT=u;var w=zmComp.getFwdMsg(c);w&&w.length&&(d.fwdMsgIds=w);var x=zmComp.getFwdThrd(c);x&&x.length&&(d.fwdtId=x);var y={mId:zmComp.getPrintId(c),contObj:d,type:"compose"},z={};if(zmComp.getMetaObj(c))z=zmComp.getMetaObj(c);else{var A="";zmail.folId&&(A=zmail.folId.dId),z.FD=A,z.SB=d.SUBJECT,z.M=zmComp.getPrintId(c),z.SN=d.SN,z.F=d.F}y.msgObj=z,zmAppLoader.load("mailPrinter").done(function(){mailPrinter.print(y)})},getFromDispN:y,lstFromDispN:z,getCurrentCompId:function(){var a;return zmail.isComposeMail?a=zmComp.windowCmpId:(!zmUtil.isChildWindow()&&zmTab&&(a=zmTab.currentTab),a&&a.indexOf("Cmp")===-1&&(a=null)),a}};return Fa(),Ga}(),window.zmCompOpt=function(){var a=function(){var a=zmText.get("zmcompose");return a}(),b={_send:function(){var b={};return b.cls="SCtxt",b.divclass="SC_hd",b.optclass="msi-send",b.txt=a.send,b.arrow=!0,b},_discard:function(){var a={};return a.cls="SC_lbr",a.divclass="SC_hd",a.optclass="msi-trash",a.arrow_hide=!0,a.txt_hide=!0,a},_more:function(){var a={};return a.cls="SC_lbr",a.optclass="msi-action",a.arrow_hide=!0,a.txt_hide=!0,a},_save:function(){var b={};return b.cls="SCtxt SC_op3 SC_nopntr",b.divclass="SC_hd",b.opt_hide=!0,b.txt=a.save_draft,b.arrow=!0,b},_priority:function(){var a={};return a.cls="SC_lbr",a.optclass="msi-priority",a.divclass="SC_hd",a.arrow_hide=!0,a.txt_hide=!0,a},_share:function(){var a={};return a.cls="SC_lbr SCtxt",a.divclass="SC_hd",a.txt="Share",a.arrow_hide=!0,a},_schedule:function(){var a={};return a.cls="SC_lbr",a.divclass="SC_hd",a.optclass="msi-schdRecur",a.arrow_hide=!0,a.txt_hide=!0,a},_watch:function(){var a={};return a.cls="SC_lbr",a.divclass="SC_hd",a.optclass="msi-mailReminder",a.arrow_hide=!0,a.txt_hide=!0,a},_moveTab:function(){var a={};return a.cls="SC_lbr",a.optclass="msi-popout",a.divclass="SC_hd",a.arrow_hide=!0,a.txt_hide=!0,a},_minimizeTab:function(){var a={};return a.cls="SC_lbr",a.optclass="msi-minus",a.divclass="SC_hd",a.arrow_hide=!0,a.txt_hide=!0,a},_close:function(){var a={};return a.cls="SC_lbr",a.optclass="msi-close",a.divclass="SC_hd",a.arrow_hide=!0,a.txt_hide=!0,a},headerDOM:function(b){var c,d=b.cmpId,e=b.type,f=b.msgId,g='<div class="SCmb"><div class="SC_frt SC_ptit"></div><div></div></div>',h=zmCompOpt.optDOM(zmCompOpt._send()),i=zmCompOpt.optDOM(zmCompOpt._discard()),j=zmCompOpt.optDOM(zmCompOpt._more()),k=zmCompOpt.optDOM(zmCompOpt._save()),l=zmCompOpt.optDOM(zmCompOpt._priority()),m=zmCompOpt.optDOM(zmCompOpt._share()),n=zmCompOpt.optDOM(zmCompOpt._schedule()),o=zmCompOpt.optDOM(zmCompOpt._watch()),p=zmCompOpt.optDOM(zmCompOpt._minimizeTab()),q=zmCompOpt.optDOM(zmCompOpt._moveTab()),r=zmCompOpt.optDOM(zmCompOpt._close()),s=$(g),t=$(s[0].childNodes[0]),u=$(s[0].childNodes[1]),v=$(h);zmComp.cmpData().outIntr===-1&&v.find("i.msi-barrow").addClass("SC_dyn"),v.attr("id","zmSendM_"+d),v.off("click").on("click",function(a){c={},c.action="compose",c.sendIm=!1,c.cmpId=d,c.type=e,zmCDrop.showDropDown(a,c)}),zmCUtil.tooltip({ele:h,tooltip:a.send});var w=$(i);w.attr("id","zmDiscardM_"+d),w.off("click").on("click",function(){var a={};a.cmpId=d,a.msgId=f,zmComp.discardCmp(a)}),zmCUtil.tooltip({ele:i,tooltip:a.discard_draft});var x=$(j);x.attr("id","zmMoveM_"+d),x.off("click").on("click",function(){c={},c.id="zm_compactLst",c.par=x.find(" > li").eq(0),c.cmpId=d,zmCDrop.show(c)}),zmCUtil.tooltip({ele:j,tooltip:a.options});var y=$(k);!e||"p"!==e&&"w"!==e||y.find("i.msi-barrow").addClass("SC_dyn"),y.attr("id","zmSaveM_"+d),y.off("click").on("click",function(a){var b,f,g;a&&(b=a.target||a.srcElement,f=b.nodeName,g=b.className),f&&"I"===f&&g&&"msi-barrow"===g?(c={},c.id="zm_SveLst",c.par=$(b).closest("li"),c.cmpId=d,zmCDrop.show(c),zmUtil.stopEvents(a)):(c={},c.cmpId=d,c.action="sdraft",c.type=e,c.sendIm=!1,zmComp.sendMail(c))}),zmCUtil.tooltip({ele:k,tooltip:a.save_as_draft});var z=$(l);z.attr("id","zmPriorityM_"+d),z.off("click").on("click",function(a){c={},c.cmpId=d,c.par=z.find(" > li").eq(0),c.id="zm_priLst",zmCDrop.show(c),zmUtil.stopEvents(a)}),zmCUtil.tooltip({ele:l,tooltip:a.priority});var A=$(m);A.attr("id","zmShareM_"+d),zmCUtil.tooltip({ele:m,tooltip:"Share draft"});var B=$(n);B.attr("id","zmScheduleM_"+d),B.off("click").on("click",function(){c={},c.id=d,c.ele=this,c.component="compose",c.type=2,zmSchedule.initScRec(c)}),zmCUtil.tooltip({ele:n,tooltip:a.schedule+" / "+a.recurring});var C=$(o);C.attr("id","zmWatchM_"+d),C.off("click").on("click",function(){c={},c.msgId=d,c.loadType="popup",c.openWatch="compose_tab",c.elem=$(this).find("li"),zmWatch.showWatch(c)}),zmCUtil.tooltip({ele:o,tooltip:zmText.get("zmreminder").watch.remind});var D=$(q);D.attr("id","zmMoveTabM_"+d),D.off("click").on("click",function(){zmComp.moveTab(d)}),zmCUtil.tooltip({ele:q,tooltip:"Move to Tab"});var E=$(p);E.attr("id","zmMinimizeM_"+d),E.off("click").on("click",function(){}),zmCUtil.tooltip({ele:p,tooltip:"Minimize"});var F=$(r);return F.attr("id","zmCloseM_"+d),F.off("click").on("click",function(){var a={};a.cmpId=d,a.type=e,a.msgId=f,zmComp.comClose(a)}),zmCUtil.tooltip({ele:r,tooltip:a.close}),e&&"w"===e?(u.append(v),u.append(w),u.append(x),t.append(y),t.append(z),z.addClass("SC_dyn"),t.append(A),A.addClass("SC_dyn"),t.append(B),t.append(C),t.append(F)):e&&"p"===e?(u.append(v),u.append(w),t.append(y),t.append(D),t.append(F)):e&&"d"===e&&(u.append(v),u.append(w),u.append(x),t.append(y),t.append(z),z.addClass("SC_dyn"),t.append(A),A.addClass("SC_dyn"),t.append(B),t.append(C),t.append(F)),s},dropMode:function(a){var b="<ul><li><b><div></div><span><i></i><i><i/></span></b></li></ul>",c=$(b)[0],d=c.childNodes[0],e=d.childNodes[0],f=e.childNodes[0],g=e.childNodes[1],h=g.childNodes[0],i=g.childNodes[1],j=$(c);j.attr("cmprid","zmTab_"+a);var k=$(f);k.attr("class","SC_hd");var l=$(h);l.attr("id","zmRepIcn_"+a),l.attr("class","msi-reply");var m=$(i);return m.attr("id","zmRepLst_"+a),m.attr("class","msi-barrow"),j},fromDOM:function(b){var c=b.cmpId,d=$("<div/>");d.attr("class","zmCTxt");var e=$("<font/>");e.text(a.from);var f=$("<span/>");f.attr("id","zm_fSel_"+c),f.off("click").on("click",function(){zmCUtil.shwFrm(this)});var g=$("<div/>");g.attr("class","SC_cs SC_np");var h=$("<span/>");h.attr("id","zm_fromaddr_"+c);var i=zmComp.getFromDispN(zmail.fromAddr);h.text(i);var j=$("<i/>");j.attr("class","msi-barrow"),g.append(h,j),f.append(g);var k=$("<div/>");k.attr("id","zm_repSel_"+c),k.attr("class","SC_frt SC_dyn");var l=$("<font/>");l.text(a.replyto);var m=$("<span/>");m.attr("id","zmrTo_"+c);var n=$("<div/>");n.attr("class","SC_cs SC_np");var o=$("<span/>");o.attr("id","zm_replyto_addr_"+c),"st"!==b.type&&zmComp.getReplyto(c)&&(k.removeClass("SC_dyn"),o.text(zmComp.getReplyto(c)));var p=$("<i/>");return p.attr("class","msi-barrow"),n.append(o,p),m.append(n),k.append(l,m),d.append(e,f,k),d},toDOM:function(b){var c=b.cmpId,d=b.type,e=$("<div/>");e.attr("class","zmCTxt zmdrop"),e.attr("id","zmto_"+c),e.off("click").on("click",function(){zmComp.txtFocus(this)});var f=function(a){zmAutoFill.fillContacts($("#zmtotxt_"+c),"",[a])},g=$("<font/>");g.text(a.to),g.off("click").on("click",function(a){zmAdd.showBook(f,"zmtotxt_"+c,a)});var h=$("<input/>");h.attr("type","text"),h.attr("id","zmtotxt_"+c),h.attr("class","zm_sgst"),d&&"p"!==d&&h.attr("data-enableShortcuts",!0);var i=$("<div/>");i.attr("class","SC_frt");var j=$("<em/>");j.attr("id","scc_"+c),j.off("click").on("click",function(){zmComp.shCBc(c,"c")}),j.text(a.cc);var k=$("<em/>");return k.attr("id","sbcc_"+c),k.off("click").on("click",function(){zmComp.shCBc(c,"b")}),0===zmComp.cmpData().showBcc&&k.addClass("SC_dyn"),k.text(a.bcc),i.append(j,k),e.append(g,h,i),e},ccDOM:function(b){var c=b.cmpId,d=b.type,e=$("<div/>");e.attr("class","zmCTxt zmdrop"),e.attr("id","zmcc_"+c),e.off("click").on("click",function(){zmComp.txtFocus(this)});var f=function(a){zmAutoFill.fillContacts($("#zmcctxt_"+c),"",[a])},g=$("<font/>");g.text(a.cc),g.off("click").on("click",function(a){zmAdd.showBook(f,"zmcctxt_"+c,a)});var h=$("<input/>");return h.attr("type","text"),h.attr("id","zmcctxt_"+c),h.attr("class","zm_sgst"),d&&"p"!==d&&h.attr("data-enableShortcuts",!0),e.append(g,h),e},bccDOM:function(b){var c=b.cmpId,d=b.type,e=$("<div/>");e.attr("class","zmCTxt zmdrop"),e.attr("id","zmbcc_"+c),e.off("click").on("click",function(){zmComp.txtFocus(this)});var f=function(a){zmAutoFill.fillContacts($("#zmbcctxt_"+c),"",[a])},g=$("<font/>");g.text(a.bcc),g.off("click").on("click",function(a){zmAdd.showBook(f,"zmbcctxt_"+c,a)});var h=$("<input/>");return h.attr("type","text"),h.attr("id","zmbcctxt_"+c),h.attr("class","zm_sgst"),d&&"p"!==d&&h.attr("data-enableShortcuts",!0),e.append(g,h),e},subDOM:function(b){var c=b.cmpId,d=b.type,e=$("<div/>");e.attr("class","zmCTxt");var f=$("<input/>");return f.attr("type","text"),f.attr("id","zmsub_"+c),f.attr("maxlength","1000"),f.attr("placeholder",a.subject),d&&"p"!==d&&f.attr("data-enableShortcuts",!0),e.append(f),e},recipientDOM:function(a){var b=a.cmpId,c="<div><div><div></div><div></div></div></div>",d=$(c)[0],e=d.childNodes[0],f=e.childNodes[0],g=e.childNodes[1],h=$(d);h.attr("id","zmdArea_"+b),h.attr("class","zmCR");var i=$(e);i.attr("class","zmCmd");var j=$(f);j.attr("class","SCmb"),j.append(zmCompOpt.dropMode(b));var k=$(g);k.attr("id","zmrep_"+b);var l=$("<div/>");l.attr("id","zmrepall_"+b),l.append(zmCompOpt.fromDOM(a));var m=zmCompOpt.toDOM(a),n=zmCompOpt.ccDOM(a),o=zmCompOpt.bccDOM(a);return 1===zmComp.cmpData().showBcc&&(n.addClass("SC_dyn"),o.addClass("SC_dyn")),l.append(m,n,o),l.append(zmCompOpt.subDOM(a)),k.append(l),h},editorDOM:function(a){var b=a.cmpId,c=$("<div/>");return c.attr("id","zmEdi_"+b),c.attr("class","zmCE"),c},attDOM:function(a){var b=a.cmpId,c="<div><div></div></div>",d=$(c)[0],e=d.childNodes[0],f=$(d);f.attr("id","zmAtt_"+b),f.attr("class","zmCA SC_dyn");var g=$(e);return g.attr("id","zmAttLst_"+b),g.attr("class","zmCAt"),g.height(50),d},optDOM:function(a){var b='<span><i></i><span></span><i class="msi-barrow"></i></span>',c="<ul><li><b><div></div>"+b+"</b></li></ul>",d=$(c)[0],e=d.childNodes[0],f=e.childNodes[0].childNodes[0],g=e.childNodes[0].childNodes[1],h=g.childNodes[0],i=g.childNodes[1],j=g.childNodes[2];return a=a||{},a.cls=a.cls||"",a.divclass=a.divclass||"SC_hd",a.ret=a.ret||"string",a.evt&&$(e).attr("data-event",a.evt),a.title&&$(e).attr("title",a.title),$(e).attr("class",a.cls),$(f).attr("class",a.divclass),$(h).attr("class",a.optclass),$(i).text(a.txt),a.opt_hide&&$(h).remove(),a.arrow_hide&&$(j).remove(),a.txt_hide&&$(i).remove(),a.sc_hd_hide&&$(f).remove(),d}};return b}(),window.zmCDrop=function(){var a=zmText.get("dropMenus"),b=function(){var a=zmText.get("zmcompose");return a}(),c=function(b,c){var d,e=!1;b&&"inline"===b&&(e=!0),c&&(d=c.cmpId);var f=[],g={htm:a.send};g.data={},g.data.action="s",e&&(g.data.cmpId=d);var h={htm:a.sendNow};h.data={},h.data.action="si",e&&(h.data.cmpId=d),f.push(g,h);var i={list:f,clk:function(a){var b=a.action,c=a.cmpId;"s"===b?(zmComp.sendMail({action:"compose",cmpId:c}),zmUtil.hideMenu()):"si"===b&&(zmComp.sendMail({action:"compose",sendIm:!0,cmpId:c}),zmUtil.hideMenu())}};return i},d=function(){var b=zmComp.getCurrentCompId(),c={list:[{htm:a.draft,data:{action:"sdraft",cmpId:b}},{htm:a.template,data:{action:"stemplate",cmpId:b}}],clk:function(a){var b=a.action,c=a.cmpId,d={cmpId:c};switch(b){case"sdraft":d.action="sdraft",zmComp.sendMail(d),zmUtil.hideMenu();break;case"stemplate":d.action="stemplate",zmComp.sendMail(d),zmUtil.hideMenu()}}};return c},e=function(a){var b=a.cmpId;zmComp.setCharSet(b,a.chrset),zmComp.setModified(b,1),zmUtil.hideMenu()},f=function(a){for(var b=zmComp.getCharSet(a),c=zmComp.getEncodeList(),d=c.length,f=[],g={},h=0;h<d;h++){var i=c[h];i=i===b?'<i class="msi-none msi-tick"></i>'+i:'<i class="msi-none"></i>'+i,f.push({htm:i,data:{chrset:c[h],cmpId:a}})}return g.list=f,g.divId="zm_EncLst",g.clk=function(a){e(a)},g},g=function(a){var b=a.cmpId,c=a.askVal;c="yes"===c?"no":"yes",zmComp.setAskReceipt(b,c),zmComp.setModified(b,1)},h=function(a){zmComp.print(a)},i=function(a){var b=a.cmpId,c=a.pTy,d="Medium",e=zmComp.getPriorityDom(b),f=e.elem;"l"===c?(d="Low",f.find("i.msi-priority").removeClass("SC_red SC_blue").addClass("SC_blue")):"h"===c?(d="High",f.find("i.msi-priority").removeClass("SC_red SC_blue").addClass("SC_red")):f.find("i.msi-priority").removeClass("SC_red SC_blue"),"d"===e.appTy?$("#zmPriorityM_"+b).removeClass("SC_dyn"):"st"===e.appTy?f.removeClass("SC_dyn"):"t"===e.appTy&&zmsuite.getCenter(b)[0].getNodes()[0].showGroup("compPriority"),zmComp.setPriority(b,d),zmComp.setModified(b,1)},j=function(a,b){var c=zmComp.getSignObj(),d=zmComp.getEditor(a),e=$(d.doc.body);if(e.find("#Zm-_Id_-Sgn").remove(),b&&""!==b&&"null"!==b){var f=c[b].SIG_CONT,g=c[b].SIG_POS;if("plaintext"===d.mode)d.insertHTML(f);else{if(0===g)e.append('<div id="Zm-_Id_-Sgn"></div>');else{var h=e.find("[name='ZM_SHWTRIM']");h.length||(h=e.find(".zmail_extra")),h.length?h.before('<div id="Zm-_Id_-Sgn"></div>'):e.append('<div id="Zm-_Id_-Sgn"></div>')}e.find("#Zm-_Id_-Sgn").html(f)}d.saveCurrentState()}zmUtil.hideMenu()},k=function(a){var c=a.cmpId,d=zmComp.getSignObj(),e=!0;d&&!$.isEmptyObject(d)&&(e=!1),0===$("#zm_insSign").length&&$("body").append('<div id="zm_insSign"></div>');var f={title:b.insert_signature,style:{width:"576px",left:"400px"},mask:!0,drag:!1,hide:!1};zmsDialog.create("zm_insSign",f);var g="",h="";if(e)h=b.no_signature;else{var i='title="'+b.remove_signature+'"';i+=" onClick=\"zmCDrop.signInsert('"+c+"','null')\"",g="<div "+i+" >",g+="<span>"+b.none+"</span></div>";for(var j in d)if(d[j].SIG_IMG){var k="onClick=\"zmCDrop.signInsert('"+c+"','"+j+"')\"";k+=" title='"+d[j].SIG_TIT+"'",h+="<div "+k+">",h+="<img src='"+zmail.conPath+"/SignatureImage?signatureId="+j+"'>",h+="</span></div>"}else{var l="onClick=\"zmCDrop.signInsert('"+c+"','"+j+"')\"";l+=" title='"+d[j].SIG_TIT+"'",h+="<div "+l+">",h+="<span>"+d[j].SIG_TIT+"</span></div>"}}var m="<ul class='SC_isig'><li>"+h+g+"</li></ul>";$("#zm_insSign").html(m)},l=function(a,c){var d=c.cmpId,e="<ul class='SC_insList'><li>";if(a&&a[0]&&a[0].tmp&&"e"===a[0].tmp)e+="<li>"+b.no_template+"</li>";else{zmComp.setTemplate(a);for(var f in a){var g=a[f].M;e+="<div class='SC_insTem' ",e+="onClick=\"zmCDrop.tmpInsert('"+g+"','"+d+"')\">",e+="<h3><span>"+a[f].SB,e+="</span></h3><div class='SC_temMsg'>"+a[f].SM+"</div></div>"}}e+="</li></ul>";var h=$("<div/>");h.attr("id","zmcmp_temp_"+d),h.html(e);var i={};i.cmpId=d,i.$content=h,i.title=b.insert_template,i.ignoreMouseDown=!1,i.dialogDidMount=function(a){$("#zmcmp_temp_"+d)[0].zmcmp_confirm_dialog_ele=a;var b=$("body").height();a.$els.$content.css("max-height",b-15*b/100+"px"),a.$els.$contentWrapper.width("600px");var c=a.$els.$maskWrapper;c.on("mousedown",function(b){var c=b.target||b.srcElement;$(c).closest("div.SC_pe").length||a.remove()})},i.defaultNavigator=!1,i.navigator=new zmail.Navigator({onEscape:function(){$("#zmcmp_temp_"+d)[0].zmcmp_confirm_dialog_ele.remove()}}),Dialog["new"](i)},m=function(a,b){a=a.mdata;var c=b.cmpId;zmComp.setModified(c,1);var d=a.SUBJECT;d=zmCUtil.getText(d);var e=a.CONTENT,f=$.trim($("#zmsub_"+c).val());if(""===f&&$("#zmsub_"+c).val(d),e&&""!==$.trim(e)){var g=zmComp.getEditor(c);g.doc.getElementById("Zm-_Id_-Sgn")&&(e=e.replace(/Zm-_Id_-Sgn/gi,"")),g.insertHTML(e)}a&&a.EXTIMG&&zmCUtil.loadExtImages(c,a.EXTIMG),a.NEWATT&&zmComp.insertAttachment(c,a);try{$("#zmcmp_temp_"+c)[0].zmcmp_confirm_dialog_ele.remove()}catch(h){zmComp.debugLog(h)}},n=function(a,b){var c={accId:zmail.accId,msgId:a,split:!1},d={msgId:a,cmpId:b};zmail.folId&&(c.folId=zmail.folId.teId,d.folId=zmail.folId.teId),zmAjq.XHR({u:zmail.conPath+"/md.do",t:"POST",fn:m,p:c,ep:d})},o=function(a){zmAjq.XHR({u:zmail.conPath+"/cUtil.do",t:"GET",fn:l,p:{accId:zmail.accId},ep:{cmpId:a.cmpId}})},p=function(c){var d,e,j=c.cmpId,l="",m="",n="",p={},q="",r="msi-rarrow";"st"===zmComp.getType(j)&&(r="msi-larrow"),d="msi-tick",e=zmComp.getPriority(j);var s=zmComp.getAskReceipt(j);"yes"===s&&(q=d);var t="",u=zmComp.getPrintId(j);u||(t="SC_op3 SC_nopntr"),"High"===e?l=d:"Low"===e?n=d:m=d;var v={};v.htm="<b> "+a.priority+" : </b>",v.nohover="nohr";var w={};w.htm="<i class='msi-none "+l+"'></i>"+a.high,w.data={},w.data.action="h",w.data.cmpId=j;var x={};x.htm="<i class='msi-none "+m+"'></i>"+a.medium,x.data={},x.data.action="m",x.data.cmpId=j;var y={};y.htm="<i class='msi-none "+n+"'></i>"+a.low,y.data={},y.data.action="l",y.data.cmpId=j;var z={};z.sep=!0;var A={};A.htm="<b>"+a.insert+" : </b>",A.nohover="nohr";var B={};B.htm=a.template,B.data={},B.data.action="insTemplate",B.data.cmpId=j;var C={};C.htm=a.signature,C.data={},C.data.action="sig",C.data.cmpId=j;var D={};D.htm=b.print,D.noclick=t,D.data={},D.data.action="draftprint",D.data.cmpId=j;var E={};E.htm=a.encoding+"<i class='"+r+"'></i>",E.childCls="SC_tin",E.child=function(){return f(j)};var F={};F.htm="<i class='"+q+"'></i>"+a.askreceipt,F.data={},F.data.action="askReceipt",F.data.cmpId=j,F.data.actVal=s;var G=[];return G.push(v),G.push(w),G.push(x),G.push(y),G.push(z),G.push(A),G.push(B),G.push(C),G.push(z),G.push(E),G.push(F),p={list:G,clk:function(a){var b=a.action,c=a.cmpId,d={cmpId:c},e=a.actVal;switch(b){case"sdraft":d.action="sdraft",zmComp.sendMail(d),zmUtil.hideMenu();break;case"stemplate":d.action="stemplate",zmComp.sendMail(d),zmUtil.hideMenu();break;case"insTemplate":o(d),zmUtil.hideMenu();break;case"sig":k(d),zmUtil.hideMenu();break;case"h":d.pTy="h",i(d),zmUtil.hideMenu();break;case"m":d.pTy="m",i(d),zmUtil.hideMenu();break;case"l":d.pTy="l",i(d),zmUtil.hideMenu();break;case"draftprint":h(d),zmUtil.hideMenu();break;case"askReceipt":d.askVal=e,g(d),zmUtil.hideMenu()}}}},q=function(b){var c,d,e=b.cmpId,f="",g="",h="",j={};return c="msi-tick",d=zmComp.getPriority(e),"High"===d?f=c:"Low"===d?h=c:g=c,j.list=[{htm:"<i class='msi-none "+f+"'></i>"+a.high,data:{action:"h",cmpId:e}},{htm:"<i class='msi-none "+g+"'></i>"+a.medium,data:{action:"m",cmpId:e}},{htm:"<i class='msi-none "+h+"'></i>"+a.low,data:{action:"l",cmpId:e}}],j.clk=function(a){var b=a.action,c={};switch(c.cmpId=a.cmpId,c.pTy=b,b){case"h":i(c),zmUtil.hideMenu();break;case"m":i(c),zmUtil.hideMenu();break;case"l":i(c),zmUtil.hideMenu()}},j},r={consDropDown:function(a){var b=new zmDropDownMenu(a);b.paint()},showDropDown:function(a,b){var c,d,e;a&&(c=a.target||a.srcElement,d=c.nodeName,e=c.className);var f,g;d&&"I"===d&&e&&"msi-barrow"===e?(f=$(c).closest("li"),b.snd_type="inline",zmDrop.show("zm_SndLst",f,g,b),zmUtil.stopEvents(a)):zmComp.sendMail(b)},getDropOptions:p,getPriorityOptions:q,tmpInsert:n,signInsert:function(a,b){j(a,b),zmCUtil.closeDialog("zm_insSign")},signUpdate:j,show:function(a){var b=a.id,e=a.par;switch(e.find("b").addClass("SC_ddn"),b){case"zm_priLst":a.ulClass="SC_tin";var f=zmCDrop.getPriorityOptions(a);a.list=f.list,a.clk=f.clk,a.align="pright",a.parWidth=!0;break;case"zm_compactLst":a.ulClass="SC_tin";var g=zmCDrop.getDropOptions(a);a.list=g.list,a.clk=g.clk;break;case"zm_SndLst":var h=c(a);a.list=h.list,a.clk=h.clk;break;case"zm_SveLst":var i=d(a);a.list=i.list,a.clk=i.clk,a.align="pright",a.loadCopt=!0,a.parWidth=!0}a.align=a.align||"pleft","pleft"!==a.align&&"pright"!==a.align||!e.attr("data-drop")?zmDrop.consDropDown(a):(e.removeAttr("data-drop"),zmUtil.hideMenu())}};return r}(),window.zmCUtil=function(){var a=function(){var a=zmText.get("zmcompose");return a}(),b=function(a){var b,c,d=zmComp.getCurrentCompId(),e="",f="",g="",h={},i="";b="msi-tick",c=zmComp.getPriority(zmComp.getCurrentCompId());var j=zmComp.getAskReceipt(d);"yes"===j&&(i=b),"High"===c?e=b:"Low"===c?g=b:f=b;var k=zmText.get("dropMenus");return h={list:[{htm:"<b> "+k.priority+" : </b>",nohover:"nohr"},{htm:"<i class='msi-none "+e+"'></i>"+k.high,data:{action:"h",par:a}},{htm:"<i class='msi-none "+f+"'></i>"+k.medium,data:{action:"m",par:a}},{htm:"<i class='msi-none "+g+"'></i>"+k.low,data:{action:"l",par:a}},{sep:!0},{htm:"<b>"+k.insert+" : </b>",nohover:"nohr"},{htm:k.template,data:{action:"insTemplate",cmpId:d}},{htm:k.signature,data:{action:"sig",cmpId:d}},{sep:!0},{htm:k.encoding+"<i class='msi-rarrow'></i>",childCls:"SC_tin",child:function(){return zmCUtil.compLst("encod",d)}},{sep:!0},{htm:"<i class='"+i+"'></i>"+k.askreceipt,data:{action:"askReceipt",par:j}}],clk:function(a){var b=a.action,c=a.cmpId,d=a.par,e={cmpId:c};switch(b){case"sdraft":e.action="sdraft",zmComp.sendMail(e),zmUtil.hideMenu();break;case"stemplate":e.action="stemplate",zmComp.sendMail(e),zmUtil.hideMenu();break;case"insTemplate":zmCUtil.insTemplate(c),zmUtil.hideMenu();break;case"sig":zmCUtil.insSign(c),zmUtil.hideMenu();break;case"h":zmCUtil.chgPriority("h",d),zmUtil.hideMenu();break;case"m":zmCUtil.chgPriority("m",d),zmUtil.hideMenu();break;case"l":zmCUtil.chgPriority("l",d),zmUtil.hideMenu();break;case"askReceipt":zmCUtil.askRepChk(d,zmComp.getCurrentCompId()),zmUtil.hideMenu()}}}},c=function(){for(var a=zmComp.getCurrentCompId(),b=zmComp.getCharSet(a),c=zmComp.getEncodeList(),d=c.length,e=[],f={},g=0;g<d;g++){var h=c[g];h=h===b?'<i class="msi-none msi-tick"></i>'+h:'<i class="msi-none"></i>'+h,e.push({htm:h,data:{action:c[g]}})}return f.list=e,f.divId="zm_EncLst",f.clk=function(a){a=a.action,zmCUtil.chgEncode(a)},f},d=function(a){return a=a.replace(/&nbsp;/gi," "),a=a.replace(/&lt;/gi,"<"),a=a.replace(/&gt;/gi,">"),a=a.replace(/&amp;/gi,"&"),a=a.replace(/&#39;/g,"'"),a=a.replace(/&quot;/g,'"')},e=function(a){return a=a.replace(/</gi,"&lt;"),a=a.replace(/>/gi,"&gt;")},f={getCmpDropList:b,getfontFamily:function(a){var b="";switch(a){case"Arial":b="Arial,Helvetica,sans-serif";break;case"Courier":b="Courier New,Courier,monospace";break;case"Georgia":b="Georgia,Times New Roman,Times,serif";break;case"Tahoma":b="Tahoma,Arial,Helvetica,sans-serif";break;case"Times":b="Times New Roman,Times,serif";break;case"Trebuchet":b="Trebuchet ms,Arial,Helvetica,sans-serif";break;case"Verdana":b="Verdana,Arial,Helvetica,sans-serif";break;case"Comic Sans MS":b="Comic Sans MS";break;case"Serif":b="Serif";break;case"Default":b="Default";break;case"Calibri":b="Calibri,Arial,Verdana,sans-serif";break;case"MS Mincho":case"MS Gothic":case"MS PMincho":case"MS PGothic":b=a}return b},closeDialog:function(a){zmsDialog.remove(),$("#"+a).remove()},chgEncode:function(a){var b=zmComp.getCurrentCompId();zmComp.setCharSet(b,a),zmComp.setModified(b,1),zmUtil.hideMenu()},loadExtImages:function(a,b){var c,d,e,f=zmComp.getEditor(a);if(b.externalURL?(c=b.externalURL,d=b.externalLink):b.exturl&&b.extlink&&(c=b.exturl.split(","),d=b.extlink.split(",")),d&&d.length){e=d.length;for(var g,h,i=f.doc,j=0;j<e;j++)g=d[j],h=c[j].replace(/&amp;/gi,"&"),$(i).find("img#"+g).attr("src",h)}},chgPriority:function(a){var b="Medium",c=zmComp.getCurrentCompId(),d=zmComp.getPriorityDom(c);zmail.isComposeMail||zmsuite.getCenter(c)[0].getNodes()[0].showGroup("compPriority"),"l"===a?(b="Low",d.find("i.msi-priority").removeClass("SC_red SC_blue").addClass("SC_blue")):"h"===a?(b="High",d.find("i.msi-priority").removeClass("SC_red SC_blue").addClass("SC_red")):d.find("i.msi-priority").removeClass("SC_red SC_blue"),zmComp.setPriority(c,b),zmComp.setModified(c,1)},askRepChk:function(a,b){a="yes"===a?"no":"yes",zmComp.setAskReceipt(b,a),zmComp.setModified(b,1)},shwFrm:function(a){if(a=$(a).find("> div"),$("#zm_fLst").is(":visible"))$("#zm_fLst").hide();else{var b=$(a).offset(),c=b.left,d=b.top+$(a).height();$("#zm_fLst").css({left:c+"px",top:d+"px"}).show()}},repSTVal:function(a,b){$("#zm_dropDown").remove(),zmComp.setReplyto(b,a),$("#zmrTo_"+b+" span").html(a)},cmpSTVal:function(b,c,d){var e=!1;zmComp.shareEID(d)&&(c=zmComp.shareEID(d),e=!0);var f=zmComp.getFromDispN(c);if($("#zm_fromaddr_"+d).text(f),zmComp.setFromAddr(d,c),e){var g=$("#zm_fSel_"+d),h=$("<font/>");h.attr("id","zm_fdeleSel_"+d),h.val(a.shared_from_address_info),$(g).append(h)}else $("#zm_fdeleSel_"+d).remove();zmCDrop.signUpdate(d,b)},bindDatePicker:function(a,b){if("undefined"!=typeof ZEVENTS){var c=zmail.userDateFormat.toUpperCase(),d=zmail.userDateVal;void 0!==a&&ZEVENTS(a).picker("date",{dform:c,wkst:0,mode:"popup",update:"yes",range:[d,""],minhgt:251}).on("dateclick",function(){b&&b(this.getDate().getDateBy(c))}).bind()}},bindTimePicker:function(a){"undefined"!=typeof ZEVENTS&&void 0!==a&&ZEVENTS(a).picker("time",{tform:"HH:mm ss"}).bind()},hideDatePicker:function(){$(".zcal_cn").remove()},hideTimePicker:function(){$(".zcal_tilst").remove()},_rPath:function(a){var b=!1,c=[],d=a.FROM;if(a.RETURNPATH){var e=a.RETURNPATH;e=e.replace(/</gi,""),e=e.replace(/>/gi,""),c=e.split(","),c=_.uniq(c);for(var f=0;f<=c.length;f++){var g=c[f];g&&(g.indexOf("zmgrbounces")===-1&&g.toLowerCase()!==d.toLowerCase()||(c.splice(f,1),f--))}}return c.length&&(b=!0),b},compLst:function(a){var b={};return"encod"===a&&(b=c()),b},dataURItoBlob:function(a){var b,c,d;b=a.split(",")[0].indexOf("base64")>=0?window.atob(a.split(",")[1]):window.unescape(a.split(",")[1]),c=a.split(",")[0].split(":")[1].split(";")[0],d=new Uint8Array(b.length);for(var e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([d],{type:c})},getTabToolbar:function(){var a="tableGrid",b=[[["attach","Attachment","zei-attachment"]],[["bold","Bold (Ctrl+B)","zei-bold"],["italic","Italic (Ctrl+I)","zei-italic"],["underline","Underline (Ctrl+U)","zei-underline"],["strikethrough","Strikethrough","zei-strike"]],[["fontfamily","Font","zei-fontfamily"]],[["fontsize","Font Size","zei-arrow"]],[["forecolor","Font color","zei-textclr"],["backcolor","Background Color","zei-bgclr"]],[["alignoptions","Fontstyle Options","zei-textleft"],["listoptions","List Options","zei-unorder"],["indentoptions","Indent Options","zei-outdent"],["directionoptions","Text Direction Options","zei-rtl"]],[["image","Insert Image","zei-image"],["link","Insert Link","zei-link"],["insertHTML",zmText.get("editorInteg","tooltip").insertHtml,"zei-html"]],[["quote","Insert Quote","zei-quote"],["removeformat","Remove Formatting","zei-removeformat"]],[[a,"Insert Table","zei-table"],["inserthorizontalrule","Insert Horizontal Rule","zei-line"]],[["smiley","Insert smiley","zei-smiley"]],[["spellcheck","Check Spelling","zei-spellCheck"]],[["otheroptions","Plain Text","zei-arrow ze-big"]]];
return b},getSmartToolbar:function(){var a=[[["bold","Bold (Ctrl+B)","zei-bold"],["italic","Italic (Ctrl+I)","zei-italic"],["underline","Underline (Ctrl+U)","zei-underline"],["strikethrough","Strikethrough","zei-strike"]],[["fontfamily","Font","zei-fontfamily"]],[["forecolor","Font color","zei-textclr"],["backcolor","Background Color","zei-bgclr"]],[["smiley","Insert smiley","zei-smiley"]],[["otheroptions","Spell Check Languages","zei-arrow ze-big"]]];return a},getInlineToolbar:function(){var a=[[["attach","Attachment","zei-attachment"]],[["image","Insert Image","zei-image"],["link","Insert Link","zei-link"]],[["spellcheck","Check Spelling","zei-spellCheck"]],[["otheroptions","Spell Check Languages","zei-arrow ze-big"]]];return a},getText:d,tooltip:function(a){a.ele&&zmComponent.tooltip({elm:a.ele,text:a.tooltip,arrow:"top"})},getContactsEmails:function(a,b){for(var c="",d="#zm"+b+"txt_"+a,e=zmAutoFill.getAddress($(d)),f=e.length,g=0;g<f;g++)g>0&&(c+=","),c+=e[g].eid;return c},contactsObj:{},loadContactMenu:function(a){var b=$.Deferred(),c=a.list,d=a.cmpId,e=a.type;return zmail.Compose.SuggestedContactsMenu.createMenu().done(function(a){var f="zm"+e+"txt_"+d;a.init({input:$("#"+f)[0],list:c}),a.render(),a.mount(),a.show(),$(a).on("itemSelected",function(a,b){var c=zmConUtil.constructContact(zmCUtil.contactsObj[b.id]);zmAutoFill.contactFill(c,$("#"+f),!0,[],{source:"compose",modifyDOM:function(a){a=a||{},zmComp.debugLog(a.contact),zmComp.debugLog(a.dom)}}),zmCUtil.hideSugMenu(d),zmCUtil.getSugContacts(d,e)}),b.resolve(a)}),b.promise()},fillContactObj:function(a){if(a.length)for(var b=a.length,c=0;c<b;c++)zmCUtil.contactsObj[a[c].emailAddress]=a[c]},resultContacts:function(){},sugContacts:function(a,b){var c=a.missedContacts||[],d=b.cmpId,e=b.type;if(c.length){var f={};f.eid=c,zmail.ContactBook.get(f).done(function(a){var b=a.map(function(a){return a.attrs}),c=b.map(function(a){var b={};return b.firstName=a.fn,b.lastName=a.ln,b.nickName=a.nn,b.emailAddress=a.eid,b});zmCUtil.fillContactObj(c);var f=b.map(function(a){var b={};return b.name=a.fn+" "+a.ln,b.email=a.eid,b.photo=a.photo,b});if(f.length){var g={};if(g.cmpId=d,g.type=e,g.list=f,zmCUtil.isSugMenu(d,e)){var h=zmCUtil.getSugMenu(d,e);zmCUtil.updateList(g,h)}else zmCUtil.loadContactMenu(g).done(function(a){zmCUtil.setSugMenu(d,e,a)})}})}},getEmailsList:function(a,b){var c=zmCUtil.getContactsEmails(a,b);if("cc"===b){var d=zmCUtil.getContactsEmails(a,"to");d&&(c&&""!==c?c+=","+d:c=d)}else if("to"===b){var e=zmCUtil.getContactsEmails(a,"cc");e&&(c&&""!==c?c+=","+e:c=e)}return c},uniqSugContacts:function(a,b){var c=zmCUtil.getEmailsList(a,b);return c&&(c=c.split(","),c.length>=2&&(c=c.filter(function(a,b,c){return c.indexOf(a)===b}))),c},chkWrongContacts:function(a,b){var c=zmCUtil.uniqSugContacts(a,b);if(c.length>=3){var d={};d.cmpId=a,d.eleType=b,d.mode="wrong",d.emailLst=c,zmCUtil.reqWrongContacts(d)}},getSugContacts:function(a,b){zmCUtil.previousIcontactReq&&"pending"===zmCUtil.previousIcontactReq.state()&&zmCUtil.previousIcontactReq.abort();var c=zmCUtil.uniqSugContacts(a,b);if(c.length>=2){var d={};d.cmpId=a,d.eleType=b,d.mode="missed",d.emailLst=c,zmCUtil.reqSugContacts(d)}else zmCUtil.hideSugMenu(a)},wrongContacts:function(a){zmComp.debugLog(a)},reqWrongContacts:function(a){var b=a.cmpId,c=a.eleType,d="";d=a.emailLst?a.emailLst:zmCUtil.uniqSugContacts(b,c);var e={};e.mode=a.mode,e.contact=d;var f={};f.mode=a.mode,f.contact=d,f.cmpId=b,f.type=c,zmCUtil.previousIcontactReq=zmAjq.XHR({u:zmail.conPath+"/ircontact.do",t:"POST",p:e,ep:f,csr:"s",fn:zmCUtil.wrongContacts})},reqSugContacts:function(a){var b=a.cmpId,c=a.eleType,d="";d=a.emailLst?a.emailLst:zmCUtil.uniqSugContacts(b,c);var e={};e.mode=a.mode,e.contact=d;var f={};f.mode=a.mode,f.contact=d,f.cmpId=b,f.type=c,zmCUtil.previousIcontactReq=zmAjq.XHR({u:zmail.conPath+"/ircontact.do",t:"POST",p:e,ep:f,csr:"s",fn:zmCUtil.sugContacts})},updateList:function(a,b){a&&b&&(b.list=a.list,b.render(),b.show())},getCmpIdType:function(a){var b=a.split("_")[1],c=a.split("_")[0];c&&(c=c.replace(/zm/g,""),c=c.replace(/txt/g,""));var d={};return d.cmpId=b,d.eleType=c,d},getElemId:function(a){var b=a.elem,c=null;return b&&b.id&&(c=zmCUtil.getCmpIdType(b.id)),c},getAllMenu:function(a){var b=zmCUtil.getSugMenu(a,"to"),c=zmCUtil.getSugMenu(a,"cc"),d=zmCUtil.getSugMenu(a,"bcc"),e={};return b&&(e.to=b),c&&(e.cc=c),d&&(e.bcc=d),e},hideSugMenu:function(a){var b=zmCUtil.getAllMenu(a);try{var c=b.to;c&&c.hide();var d=b.cc;d&&d.hide();var e=b.bcc;e&&e.hide()}catch(f){zmComp.debugLog(f)}},deleteSugMenu:function(a){var b=zmCUtil.getAllMenu(a);try{var c=b.to;c&&c.destroy();var d=b.cc;d&&d.destroy();var e=b.bcc;e&&e.destroy(),zmCUtil.menuList&&zmCUtil.menuList[a]&&delete zmCUtil.menuList[a]}catch(f){zmComp.debugLog(f)}},isSugMenu:function(a,b){return Boolean(zmCUtil.menuList&&zmCUtil.menuList[a]&&zmCUtil.menuList[a][b])},setSugMenu:function(a,b,c){zmCUtil.menuList||(zmCUtil.menuList={}),zmCUtil.menuList&&(zmCUtil.menuList[a]?zmCUtil.menuList[a][b]||(zmCUtil.menuList[a][b]=c):(zmCUtil.menuList[a]={},zmCUtil.menuList[a][b]||(zmCUtil.menuList[a][b]=c)))},getSugMenu:function(a,b){var c;return zmCUtil.menuList&&zmCUtil.menuList[a]&&(c=zmCUtil.menuList[a][b]),c},_entityText:e,getContacts:function(a){var b=$.Deferred(),c={},d={};return d.str=a,d.expected=10,zmail.ContactBook.get(d).done(function(a){var d=[],e=a.map(function(a){return a.attrs});e.length&&(d=e.map(function(a){var b={};return b.fn=a.fn+" "+a.ln,b.eid=a.eid,b.photo=a.photo,b})),c.result=d,b.resolve(c)}),b.promise()},getCmpObj:function(a){return zmComp.getCmpObj()[a]},setTempReqCnt:function(a,b){var c=zmCUtil.getCmpObj(a);c&&(c.tempReqCnt=b)},getTempReqCnt:function(a){var b,c=zmCUtil.getCmpObj(a);return c&&c.tempReqCnt&&(b=c.tempReqCnt),b},setTempReq:function(a,b){var c=zmCUtil.getCmpObj(a);c&&(c.tempReq=b)},getTempReq:function(a){var b,c=zmCUtil.getCmpObj(a);return c&&c.tempReq&&(b=c.tempReq),b},getSignature:function(a){var b=zmComp.getSignObj(),c="",d="";return a&&""!==a&&"null"!==a&&(c=b[a].SIG_CONT,d=b[a].SIG_POS),{SIG_CONT:c,SIG_POS:d}},trendingtags:function(a){var b,c,d=[];_.each(a,function(a){c=a.id||a.name,b=[["FONT",{attrs:{"class":"SClbl",style:"background-color:"+a.color}}],["text",a.dispName]],d.push(["SPAN",{attrs:{"data-text":c},child:b}])});var e="Filter by tag",f=["LI",{child:[["DIV",{child:[["STRONG",{child:[["text",e]]}],["DIV",{attrs:{"class":"SCS_tTags"},child:d}]]}]]}];return[_zm.getDOM(f)]},createPopup:function(a){var b=zmCUtil.trendingtags(zmUtil.getTagList("default")),c={par:a.parent,showArrow:!0,liDom:b,ulClass:a.ulclass,spanClass:a.parentClass,id:"zms_dropdown"};return a.callback&&(c.clk=a.callback),a.buttons&&a.buttons.length>0&&(c.buttons=a.buttons),a.hoverElm&&$(a.hoverElm).addClass("SC_ddn"),a.direction&&(c.direction=a.direction),a.noArrow&&(c.showArrow=!1),void 0!==a.liHover&&(c.liHover=a.liHover),a.align&&(c.align=a.align),a.container&&(c.container=a.container),a.onhide&&(c.onHide=a.onhide),a.avoidScroll&&(c.avoidScroll=a.avoidScroll),zmsuite.showMenu(c),a.done&&a.done($("#zm_dropDown")),$("#zm_dropDown")},removeNotToParse:function(a){var b;return b||(b=$("<div/>")),b.html(a),b.find(".zmail_extra").remove(),b.html()}};return f}(),window.zmCDocTemplate=function(){var a=function(){var a=zmText.get("zmcompose");return a}(),b=["<b>"+a.docshare_choosefiles+"</b>"],c=['<div class="zmL nohr" id="zmcdoc_recipients_tit_{{CMPID}}" data-shareopt="private">','<div class="zmLst">','<div class="zmFlt"><i class="msi-option" data-shareopt="option"></i></div>','<div class="zmDtl">','<div class="zmFrm"><span>'+a.docshare_recipientsthisemail+"</span></div>",'<div class="zmSub"><span class="sum">'+a.docshare_recipientsalone+"</span></div>","</div>","</div>","</div>",'<div class="shrPUOdata" id="zmcdoc_recipients_opt_{{CMPID}}" data-shareopt="private"><label> ',a.docshare_setpermissions+":</label>",'<div class="SC_select" style="width:135px;">','<select id="zmcdoc_recipients_select_{{CMPID}}">','<option value="1">'+a.docshare_readonly+"</option>",'<option value="2">'+a.docshare_readwrite+"</option>","</select>","</div>","</div>"],d=['<div class="zmL nohr" id="zmcdoc_org_tit_{{CMPID}}" data-shareopt="orgshare">','<div class="zmLst">','<div class="zmFlt"> <i class="msi-unoption" data-shareopt="option"></i> </div>','<div class="zmDtl">','<div class="zmFrm"><span>'+a.docshare_everyonewithme+"</span> </div>",'<div class="zmSub"><span class="sum">'+a.docshare_orgmemberhaslink+"</span></div>","</div>","</div>","</div>",'<div class="shrPUOdata" id="zmcdoc_org_opt_{{CMPID}}" data-shareopt="orgshare"><label> ',a.docshare_setpermissions+":</label>",'<div class="SC_select" style="width:135px;">','<select id="zmcdoc_org_select_{{CMPID}}">','<option value="1">'+a.docshare_readonly+"</option>",'<option value="2">'+a.docshare_readwrite+"</option>","</select>","</div>","</div>"],e=['<div class="zmL nohr" id="zmcdoc_internet_tit_{{CMPID}}" data-shareopt="linkshare">','<div class="zmLst">','<div class="zmFlt"> <i class="msi-unoption" data-shareopt="option"></i> </div>','<div class="zmDtl">','<div class="zmFrm"><span>'+a.docshare_everyoneinnet+"</span> </div>",'<div class="zmSub"><span class="sum">'+a.docshare_anyonehaslink+"</span></div>","</div>","</div>","</div>",'<div class="shrPUOdata" id="zmcdoc_internet_opt_{{CMPID}}" data-shareopt="linkshare">','<div style="min-height:39px;">','<i class="msi-uncheck" id="zmcdoc_internet_checkbox_{{CMPID}}"></i> ',a.docshare_setexpirydate,' <input id="zmcdoc_internet_text_date_{{CMPID}}" placeholder="" type="text" readonly>',"</div>","</div>"],f=['<div class="SC_PUbtm" id="button_share_{{CMPID}}">','<span class="sel" id="button_sharesend_{{CMPID}}">',a.docshare_shareandsend+'</span><span id="button_cancel_{{CMPID}}" data-val="Cancel">',a.docshare_cancel+"</span>",'<label class="SC_lnk SC_frt" id="button_sendwithout_{{CMPID}}">',a.docshare_sendwithoutshare+"</label>","</div>"],g={_getCenter:function(){var a=b.join("");return a+=c.join(""),zmail.isOrg&&(a+=d.join("")),a+=e.join("")},_getButton:f};return g}(),window.zmCDoc=function(){var a=function(a){var b=zmCDocTemplate._getCenter();return b=b.replace(/{{CMPID}}/g,a)},b=function(a){var b=zmCDocTemplate._getButton.join("");return b=b.replace(/{{CMPID}}/g,a)},c={},d={showMore:function(a){$("#moreopt_sharedata_"+a).removeClass("SC_dyn"),$("#moreopt_share_"+a).addClass("SC_dyn")},hideMore:function(a){$("#moreopt_sharedata_"+a).addClass("SC_dyn"),$("#moreopt_share_"+a).removeClass("SC_dyn")},shareSend:function(a){var b=c[a]._sObj,d=c[a].shareType,e={};"private"===d?e.permission=$("#zmcdoc_recipients_select_"+a).find("option:selected").val():"orgshare"===d?e.permission=$("#zmcdoc_org_select_"+a).find("option:selected").val():"linkshare"===d?(e.permission=1,$("#zmcdoc_internet_checkbox_"+a).hasClass("msi-check")&&(e.expiryDate=$("#zmcdoc_internet_text_date_"+a).val())):"userpwdlink"===d&&(e.permission=1,e.sendPasswordInMail=!0,$("#zmcdoc_pwdlink_checkbox_"+a).hasClass("msi-check")&&(e.expiryDate=$("#zmcdoc_pwdlink_text_date_"+a).val()),e.password=$("#zmcdoc_pwdlink_inpPass_"+a).val()),e.expiryDate&&(e.expiryDate=zmCDoc.getDocDate(e.expiryDate)),c[a]._dialogDOCSHARE.remove(),e.shareType=d,b._sReq=e,b.zDocShare="send_with",zmComp.sendMail(b)},getDocDate:function(a){var b=zmail.userDateFormat.toUpperCase();if("DD/MM/YYYY"===b){var c=a.split("/");a=c[1]+"/"+c[0]+"/"+c[2]}return a},shareCancel:function(a){c[a]._dialogDOCSHARE.remove()},shareWithout:function(a){c[a]._dialogDOCSHARE.remove(),c[a]._sObj.zDocShare="send_without",zmComp.sendMail(c[a]._sObj)},setShowMore:function(a){$("#moreopt_share_"+a).off("click").on("click",function(){zmCDoc.showMore(a)})},setShareSend:function(a){$("#button_sharesend_"+a).off("click").on("click",function(){zmCDoc.shareSend(a)})},setShareCancel:function(a){$("#button_cancel_"+a).off("click").on("click",function(){zmCDoc.shareCancel(a)})},setShareWithout:function(a){$("#button_sendwithout_"+a).off("click").on("click",function(){zmCDoc.shareWithout(a)})},resetShareModes:function(a){for(var b=["zmcdoc_recipients_tit","zmcdoc_org_tit","zmcdoc_internet_tit","zmcdoc_pwdlink_tit"],c=0;c<b.length;c++){var d=$("#"+b[c]+"_"+a).find('i[data-shareopt="option"]').eq(0);d.removeClass("msi-option").addClass("msi-unoption")}},binderPrivate:function(a){var b=$("#zmcdoc_recipients_tit_"+a);b.off("click").on("click",function(){zmCDoc.resetShareModes(a),c[a].shareType="private";var d=b.find('i[data-shareopt="option"]').eq(0);d.removeClass("msi-unoption").addClass("msi-option")})},binderOrgshare:function(a){var b=$("#zmcdoc_org_tit_"+a);b.off("click").on("click",function(){zmCDoc.resetShareModes(a),c[a].shareType="orgshare";var d=b.find('i[data-shareopt="option"]').eq(0);d.removeClass("msi-unoption").addClass("msi-option")})},binderLinkshare:function(a){var b=zmCDoc.getDate(),d=$("#zmcdoc_internet_text_date_"+a).get(0);$("#zmcdoc_internet_text_date_"+a).val(b),zmCDoc.bindDatePicker(d,function(b){c[a]._date_val=b});var e=$("#zmcdoc_internet_tit_"+a);e.off("click").on("click",function(){zmCDoc.resetShareModes(a),c[a].shareType="linkshare";var b=e.find('i[data-shareopt="option"]').eq(0);b.removeClass("msi-unoption").addClass("msi-option")});var f=$("#zmcdoc_internet_opt_"+a).find("i").eq(0);f.off("click").on("click",function(){f.hasClass("msi-check")?f.removeClass("msi-check").addClass("msi-uncheck"):f.removeClass("msi-uncheck").addClass("msi-check")})},bindBox:function(a){zmCDoc.setShowMore(a),zmCDoc.setShareSend(a),zmCDoc.setShareCancel(a),zmCDoc.setShareWithout(a),zmCDoc.binderPrivate(a),zmCDoc.binderOrgshare(a),zmCDoc.binderLinkshare(a)},bindDatePicker:function(a,b){var c;if("undefined"!=typeof ZEVENTS){var d=zmCDoc.getDate(),e=zmail.userDateFormat.toUpperCase();void 0!==a&&(c=ZEVENTS(a).picker("date",{dform:e,wkst:0,mode:"popup",update:"yes",range:[d,""],minhgt:251}).on("dateclick",function(){b&&b(this.getDate().getDateBy(e))}).bind())}return c},getDocObj:function(a){var b={};return b.docObj=c,b.cmpId=c[a],b},getDate:function(){var a=new Date,b=2;a.setDate(a.getDate()+b);var c=a.getDate(),d=a.getMonth()+1,e=a.getFullYear();return c<10&&(c="0"+c),d<10&&(d="0"+d),a=c+"/"+d+"/"+e},shareDialog:function(a){var b={servicename:"zmail",docsURL:"//"+zmail.urls.docsURL,isnewui:!0};ATTACHDIALOG.setSharingTypeForSelectedUser(b.callback,zmComp.getZDObj(a))},showBox:function(d,e){var f=a(d),g=b(d),h=$(f),i=$(g),j={};j.cmpId=d,j.$content=h,j.title="Share Files",j.ignoreMouseDown=!1,j.dialogDidMount=function(a){a.$els.$content.attr("id","zmshare_"+d);var b=a.$els.$content;b.append(h),b.after(i),b.addClass("shrPU");var f="";try{f=ATTACHDIALOG.getDocAsLink().ZD_USER_PLAN_TYPE}catch(g){zmUtil.debugLog(g)}"FREE"===f&&$("#zmcdoc_internet_opt_"+d).remove(),zmCDoc.bindBox(d),c[d]={},c[d]._dialogDOCSHARE=a,c[d]._sObj=e,c[d].shareType="private"},Dialog["new"](j)}};return d}();